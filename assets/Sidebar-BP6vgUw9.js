import{b as te,j as t,a as H,c as se,g as ie,s as X,d as Y,f as $,u as le,e as de,i as ce,h as ge}from"./index-Dp8KZbdM.js";import{r as g,L as ue,C as Q,y as Z,h as B,ai as me,a9 as pe,H as xe,aj as fe,U as ee,ac as he,J as be,X as ye,w as ke,j as ve,ak as we,al as Te}from"./icons-B-AFu83W.js";import"./react-DavUf6mE.js";import"./firebase-B-qVQrGd.js";import"./date-BnkIBH9d.js";const Ne=()=>{const{theme:b,setTheme:d}=te(),I=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"system",label:"System"}];return t.jsx("div",{className:"grid grid-cols-3 gap-1",children:I.map(({value:l,label:c})=>t.jsx("button",{onClick:()=>d(l),className:`px-2 py-2 text-xs rounded-lg transition-colors ${b===l?"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"}`,title:`${c} ëª¨ë“œ`,children:c},l))})},ae=()=>{const{getGoogleAccessToken:b,currentUser:d,loading:I,disconnectGoogleTasks:l}=H(),{addTodo:c,updateTodo:p,deleteTodo:u,todos:r,loading:A}=se(),[E,G]=g.useState(!1),[_,x]=g.useState(null),S=g.useRef(!1),i=g.useRef(r);i.current=r;const L=g.useRef(d);return L.current=d,{syncGoogleTasks:g.useCallback(async y=>{if(A)return console.log("â³ Firestore ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ë™ê¸°í™”ë¥¼ ëŒ€ê¸°í•©ë‹ˆë‹¤..."),!1;if(S.current)return!1;if(S.current=!0,!b)return y?.silent||x("ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤."),S.current=!1,!1;G(!0),y?.silent||x(null);try{const h=await b({silent:y?.silent});if(!h){if(!y?.silent)throw new Error("êµ¬ê¸€ ì¸ì¦ í† í°ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");return S.current=!1,G(!1),!1}const w=await ie.getAllTasks(h);let C=0,T=0,N=0;const U=new Map,z=new Set;i.current.forEach(e=>{e.googleTaskId&&U.set(e.googleTaskId,e),e.subTasks&&Array.isArray(e.subTasks)&&e.subTasks.forEach(s=>{s.googleTaskId&&z.add(s.googleTaskId)})});const k=new Set,O=new Map,R=new Map,q=[];for(const e of w)for(const s of e.tasks){if(!s.id)continue;const m={...s,listId:e.listId,listName:e.listName};if(O.set(s.id,m),s.parent){const j=R.get(s.parent)||[];j.push(m),R.set(s.parent,j)}else q.push(m)}for(const e of q){const s=U.get(e.id),m=e.status==="completed",j=R.get(e.id)||[];if(s){if(s.googleTaskListId||(console.log(`ğŸ”§ Google Task List ID ë³µêµ¬: [${s.title}] -> ${e.listId}`),await p(s.id,{googleTaskListId:e.listId}),s.googleTaskListId=e.listId),e.deleted){const o=s.updatedAt?new Date(s.updatedAt).getTime():0;if(Date.now()-o<6e4){console.log(`ğŸ›¡ï¸ ìµœê·¼ ìˆ˜ì •ëœ í•­ëª© ì‚­ì œ ë°©ì§€ (Safety Guard): [${s.title}]`);continue}console.log(`ğŸ—‘ï¸ êµ¬ê¸€ì—ì„œ ì‚­ì œëœ í•  ì¼ ê°ì§€: [${s.title}]`),await u(s.id),N++;continue}if(s.googleTaskId&&X.has(s.googleTaskId))continue;const v=e.title&&e.title!==s.title,f=e.notes!==void 0&&e.notes!==s.description,P=s.completed!==m,oe=e.due?new Date(e.due).toDateString():null,ne=s.dueDate?new Date(s.dueDate).toDateString():null,J=oe!==ne;let M=!1;const K=s.subTasks||[];let W=[...K];for(const o of j){if(o.deleted)continue;const F=K.find(V=>V.googleTaskId===o.id);F?(F.title!==o.title||F.completed!==(o.status==="completed"))&&(W=W.map(V=>V.id===F.id?{...V,title:o.title,completed:o.status==="completed",updatedAt:new Date}:V),M=!0):k.has(o.id)||(W.push({id:Y(),title:o.title,completed:o.status==="completed",priority:"medium",createdAt:new Date,updatedAt:new Date,googleTaskId:o.id}),M=!0,k.add(o.id))}if(v||f||P||J||M){console.log(`ğŸ”„ êµ¬ê¸€ íƒœìŠ¤í¬ ë³€ê²½ ê°ì§€: [${e.title}]`);const o={};v&&(o.title=e.title),f&&(o.description=e.notes||""),P&&(o.completed=m,o.completedAt=m?e.completed?new Date(e.completed):new Date:null),J&&(o.dueDate=e.due?new Date(e.due):void 0),M&&(o.subTasks=W),s.googleTaskListId||(o.googleTaskListId=e.listId),await p(s.id,o),T++}continue}if(e.deleted||k.has(e.id))continue;if(e.parent){console.log(`ğŸ›¡ï¸ Parentê°€ ìˆëŠ” íƒœìŠ¤í¬ëŠ” Root Todoë¡œ ìƒì„±í•˜ì§€ ì•ŠìŒ: [${e.title}]`);continue}if(X.has(e.id)){console.log(`ğŸ›¡ï¸ ë°©ê¸ˆ ìƒì„±ëœ íƒœìŠ¤í¬ Import ê±´ë„ˆëœ€ (Registry): [${e.title}]`),k.add(e.id);continue}if(z.has(e.id)){console.log(`ğŸ›¡ï¸ ì´ë¯¸ SubTaskë¡œ ì¡´ì¬í•˜ëŠ” í•­ëª©ì˜ ì¤‘ë³µ ìƒì„± ë°©ì§€: [${e.title}]`),k.add(e.id);continue}const a=j.filter(n=>!n.deleted).map(n=>(k.add(n.id),{id:Y(),title:n.title,completed:n.status==="completed",priority:"medium",createdAt:new Date,updatedAt:new Date,googleTaskId:n.id}));k.add(e.id),await c({title:e.title||"(No Title)",description:e.notes||"",completed:m,priority:"medium",type:a.length>0?"project":"simple",recurrence:"none",tags:["Google Tasks"],googleTaskId:e.id,googleTaskListId:e.listId,completedAt:e.completed?new Date(e.completed):void 0,dueDate:e.due?new Date(e.due):void 0,subTasks:a}),C++}const D=[];for(const e of i.current){if(!e.googleTaskId)continue;const s=O.get(e.googleTaskId);if(s&&s.parent){const m=e.updatedAt?new Date(e.updatedAt).getTime():0;if(Date.now()-m<6e4){console.log(`ğŸ›¡ï¸ Cleanup ì‚­ì œ ë°©ì§€ (Safety Guard): [${e.title}]`);continue}console.log(`ğŸ§¹ ì¤‘ë³µ ì œê±°: í•˜ìœ„ ì‘ì—…ìœ¼ë¡œ ì „í™˜ëœ Todo ì‚­ì œ [${e.title}] (${e.id})`),D.push(e.id)}}if(D.length>0)for(const e of D)await u(e),N++;if(y?.silent?(C>0||T>0||N>0)&&console.log(`âœ… Google Tasks ë™ê¸°í™”: ê°€ì ¸ì˜¤ê¸° ${C}, ì—…ë°ì´íŠ¸ ${T}, ì‚­ì œ ${N}`):(C>0||T>0||N>0?x(`ê°€ì ¸ì˜¤ê¸° ${C}ê°œ, ì—…ë°ì´íŠ¸ ${T}ê°œ, ì‚­ì œ ${N}ê°œ ì™„ë£Œ!`):x("ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."),setTimeout(()=>x(null),3e3)),L.current)try{(await $.getUserSettings(L.current.uid))?.googleTasks?.linked||await $.updateGoogleTasksSettings(L.current.uid,{linked:!0})}catch(e){console.warn("Failed to update linked status (likely quota)",e)}return!0}catch(h){if(console.error("Google Tasks Sync failed",h),h.message==="INSUFFICIENT_SCOPE")return y?.silent?console.log("Silent sync failed with INSUFFICIENT_SCOPE. Pausing without disconnect."):(console.error("INSUFFICIENT_SCOPE during interactive sync. Disconnecting to force re-login."),x("ê¶Œí•œ ê°±ì‹  í•„ìš” - ë‹¤ì‹œ ì—°ê²°í•´ì£¼ì„¸ìš”"),l()),!1;if(!y?.silent){const w=h.message||"Unknown error";w.includes("popup")?x("Popup blocked?"):w.includes("network")?x("Network Error"):x(`Error: ${w.substring(0,15)}...`),setTimeout(()=>x(null),5e3)}return(h.code===401||h.message.includes("401"))&&l(),!1}finally{G(!1),S.current=!1}},[b,c,p,u,A,l]),loading:E,message:_,msg:_}};function je(){const{currentUser:b,isGoogleTasksConnected:d,signInWithGoogle:I,tokenExpiration:l}=H(),{syncGoogleTasks:c,loading:p,message:u}=ae(),r=d&&l&&Date.now()>l-6e4,A=async()=>{if(!d||r)try{await I(),c()}catch(E){console.error("Link failed",E)}else c()};return b?t.jsx("div",{className:"px-4",children:t.jsxs("button",{onClick:A,disabled:p,className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl \r
                   text-gray-600 dark:text-gray-400 \r
                   hover:bg-white/50 dark:hover:bg-gray-800/50 \r
                   hover:text-gray-900 dark:hover:text-gray-200 \r
                   transition-all duration-200 group border border-transparent hover:shadow-sm`,children:[t.jsx("div",{className:`p-2 rounded-lg transition-colors ${d?r?"bg-orange-100/50 dark:bg-orange-900/30":"bg-green-100/50 dark:bg-green-900/30":"bg-gray-100/50 dark:bg-gray-800/50 group-hover:bg-white dark:group-hover:bg-gray-700"}`,children:p?t.jsx(ue,{className:"w-5 h-5 animate-spin text-blue-500"}):u?t.jsx(Q,{className:"w-5 h-5 text-blue-500"}):d?r?t.jsxs("div",{className:"relative",children:[t.jsx(Z,{className:"w-5 h-5 text-orange-500"}),t.jsxs("span",{className:"absolute -top-1 -right-1 flex h-2.5 w-2.5",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-orange-500"})]})]}):t.jsx(Q,{className:"w-5 h-5 text-green-500"}):t.jsx(Z,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 group-hover:text-blue-500 transition-colors"})}),t.jsxs("div",{className:"flex flex-col items-start",children:[t.jsxs("span",{className:"font-medium text-sm flex items-center gap-2",children:[u||"Google Tasks",!u&&d&&!r&&t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),!u&&r&&t.jsx("span",{className:"text-xs text-orange-500 font-bold",children:"(Expired)"})]}),!u&&t.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:d?r?"Tap to renew session":"Sync active":"Click to connect"})]})]})}):null}const $e=({currentView:b,onViewChange:d,isOpen:I,onToggle:l,isMobile:c=!1,forceMobile:p=null,onToggleForceMobile:u})=>{const{t:r}=le(),{getOverdueTodos:A,getTomorrowTodos:E,getYesterdayIncompleteTodos:G,recurringTemplates:_,getRecurringTodos:x,getTodayTodos:S}=se(),{currentUser:i}=H(),{showVacationsInTodos:L,toggleVacationDisplay:re}=de(),{currentTheme:y,isDark:h}=te(),w=A(),C=E(),T=G(),N=S(),U=!!y.bg,z=_.filter(a=>a.isActive),[k,O]=g.useState(0),[R,q]=g.useState(0),{syncGoogleTasks:D}=ae();g.useEffect(()=>{let a;const n=async()=>{if(i?.uid){const f=await $.getUserSettings(i.uid);return f?.autoSyncGoogleTasks&&await D({silent:!0}).catch(P=>ge.warn("Auto-sync blocked/failed",P)),f?.autoSyncGoogleTasks}return!1},v=()=>{n()};return n().then(f=>{f&&(a=setInterval(async()=>{await D({silent:!0}).catch(()=>{})},30*1e3),window.addEventListener("focus",v))}),()=>{a&&clearInterval(a),window.removeEventListener("focus",v)}},[i?.uid,D]),g.useEffect(()=>{if(!i?.email)return;const a=$.subscribeToIncomingInvitations(i.email,n=>O(n.length));return()=>a()},[i?.email]),g.useEffect(()=>{if(!i?.uid)return;const a=$.subscribeToSharingNotifications(i.uid,n=>{const v=n.filter(f=>!f.read&&!f.isRead).length;q(v)});return()=>a()},[i?.uid]);const e=k+R,[s,m]=g.useState([]);g.useEffect(()=>{const a=$.subscribeToVacationAccessList(n=>{m(n)});return()=>a()},[]);const j=[{id:"today",label:r("nav.today"),icon:B,count:N.filter(a=>!a.completed).length},{id:"week",label:r("nav.week"),icon:me},{id:"month",label:r("nav.month"),icon:B},{id:"board",label:r("nav.board")||"Kanban",icon:pe},{id:"recurring",label:r("nav.recurring"),icon:xe,count:z.length},{id:"history",label:r("nav.history"),icon:fe},{id:"sharing",label:r("nav.sharing")||"ê³µìœ  ì„¤ì •",icon:ee,count:e,highlight:e>0},{id:"analytics",label:r("nav.analytics"),icon:ee},{id:"vacation",label:r("nav.vacation"),icon:B},{id:"guide",label:r("guide.title"),icon:he},{id:"settings",label:r("nav.settings"),icon:be}];return t.jsxs(t.Fragment,{children:[c&&I&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 transition-opacity duration-300",onClick:l}),t.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-full transition-all duration-300 ease-in-out 
          ${I?"translate-x-0":"-translate-x-full"} 
          ${c?"w-[280px]":"w-64"}
          glass-card
          ${U?"shadow-none border-r border-white/30 dark:border-white/20 transition-[background-color] duration-200 backdrop-blur-none":"border-r border-white/40 dark:border-gray-700/40 shadow-2xl transition-[background-color] duration-200"}
          flex flex-col pt-[env(safe-area-inset-top)] rounded-none`,style:U?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[t.jsxs("div",{className:"p-6 flex items-center justify-between relative overflow-hidden shrink-0",children:[t.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-primary-500/10 to-purple-500/10 dark:from-primary-500/5 dark:to-purple-500/5 pointer-events-none"}),t.jsx("h1",{className:"text-2xl font-bold text-gradient-primary relative z-10 tracking-tight",children:"Todo List"}),c&&t.jsx("button",{onClick:l,className:"p-2 rounded-xl hover:bg-white/50 dark:hover:bg-gray-700/50 text-gray-500 dark:text-gray-400 transition-colors relative z-10",children:t.jsx(ye,{className:"w-5 h-5"})})]}),t.jsxs("nav",{className:"flex-1 overflow-y-auto px-4 py-2 space-y-1 custom-scrollbar",children:[j.map(a=>{if(a.id==="analytics"&&!ce(i?.email)||a.id==="vacation"&&!(i?.email==="lkd0115lkd@gmail.com"||i?.email&&s.includes(i.email)))return null;const n=b===a.id,v=a.icon;return t.jsxs("button",{onClick:()=>{d(a.id),c&&l()},className:`w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all duration-200 group
                  ${n?"bg-primary-500/10 dark:bg-primary-500/20 text-primary-600 dark:text-primary-400 shadow-sm border border-primary-100/50 dark:border-primary-500/30 backdrop-blur-sm":"text-gray-600 dark:text-gray-400 hover:bg-white/50 dark:hover:bg-gray-800/50 hover:text-gray-900 dark:hover:text-gray-200 hover:shadow-sm border border-transparent"}`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-lg transition-colors ${n?"bg-primary-100 dark:bg-primary-900/40":"bg-gray-100/50 dark:bg-gray-800/50 group-hover:bg-white dark:group-hover:bg-gray-700"}`,children:t.jsx(v,{className:`w-5 h-5 ${n?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-200"}`})}),t.jsx("span",{className:"font-medium",children:a.label})]}),a.count!==void 0&&a.count>0&&t.jsx("span",{className:`px-2 py-0.5 text-xs font-bold rounded-full ${a.highlight?"bg-red-500 text-white animate-pulse":n?"bg-primary-100 dark:bg-primary-900/40 text-primary-600 dark:text-primary-400":"bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400"}`,children:a.count})]},a.id)}),t.jsx("div",{className:"my-4 border-t border-gray-200/50 dark:border-gray-700/50"}),t.jsxs("div",{className:"space-y-3 px-1",children:[T.length>0&&t.jsxs("div",{className:"glass-panel p-4 rounded-xl border-l-4 border-l-orange-400 group hover:scale-[1.02] transition-transform duration-200 bg-orange-50/30 dark:bg-orange-900/10",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-orange-600 dark:text-orange-400",children:[t.jsx(ke,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-bold",children:r("nav.summary.yesterday")})]}),t.jsxs("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:[T.length,t.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:r("nav.summary.count")})]})]}),w.length>0&&t.jsxs("div",{className:"glass-panel p-4 rounded-xl border-l-4 border-l-red-500 group hover:scale-[1.02] transition-transform duration-200 bg-red-50/30 dark:bg-red-900/10",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-red-600 dark:text-red-400",children:[t.jsx(ve,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-bold",children:r("nav.summary.overdue")})]}),t.jsxs("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:[w.length,t.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:r("nav.summary.count")})]})]}),t.jsxs("div",{className:"glass-panel p-4 rounded-xl border-l-4 border-l-primary-400 group hover:scale-[1.02] transition-transform duration-200 bg-primary-50/30 dark:bg-primary-900/10",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-primary-600 dark:text-primary-400",children:[t.jsx(B,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-bold",children:r("nav.summary.tomorrow")})]}),t.jsxs("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:[C.length,t.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:r("nav.summary.count")})]})]})]})]}),t.jsx(je,{}),t.jsxs("div",{className:"p-4 border-t border-gray-200/50 dark:border-gray-700/50 bg-white/30 dark:bg-gray-900/30 backdrop-blur-sm shrink-0 space-y-4",children:[t.jsx(Ne,{}),t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-200/30 dark:border-gray-700/30",children:[t.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 font-medium",children:"v1.2.1 â€¢ Premium"}),u&&t.jsx("button",{onClick:()=>u(!p),className:`p-1.5 rounded-lg transition-all ${p?"bg-primary-100 text-primary-600 dark:bg-primary-900/30 dark:text-primary-400":"hover:bg-white/50 dark:hover:bg-gray-700/50 text-gray-500 dark:text-gray-400"}`,title:p?"ë°ìŠ¤í¬í†± ë·°ë¡œ ì „í™˜":"ëª¨ë°”ì¼ ë·° í…ŒìŠ¤íŠ¸",children:p?t.jsx(we,{className:"w-4 h-4"}):t.jsx(Te,{className:"w-4 h-4"})})]})]})]})]})};export{$e as default};
