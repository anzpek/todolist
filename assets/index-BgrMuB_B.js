const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./web-BaNTHTPQ.js","./firebase-B-qVQrGd.js","./react-DavUf6mE.js","./icons-B-AFu83W.js","./date-BnkIBH9d.js","./web-B8Tol5uP.js","./web-Boy594eP.js","./web-BXJVtYCe.js","./web-CGVgj_e2.js","./LoginScreen-Bd5aZq7E.js","./Sidebar-GsqfFPw_.js","./PWAInstallPrompt-Ih9FCJxq.js","./ErrorBoundary-CAKimGbI.js","./OfflineNotification-Z3BrWp9M.js","./BottomNavigation-DR16nMUA.js"])))=>i.map(i=>d[i]);
var By=Object.defineProperty;var Hy=(t,e,r)=>e in t?By(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Ht=(t,e,r)=>Hy(t,typeof e!="symbol"?e+"":e,r);import{r as Gy,a as Gg}from"./react-DavUf6mE.js";import{r as p,P as ct,C as Yt,X as rt,a as zg,U as tr,S as Zo,R as Za,A as zy,b as Ql,c as Kg,T as $t,d as Yg,e as fa,f as el,F as pa,g as Yn,h as at,i as Cn,j as gr,k as tl,L as qs,l as Ky,m as qg,n as Jl,M as Zl,o as ei,p as ec,q as gs,s as Ze,t as Yy,u as qy,v as Xy,w as Qy,x as Jy,y as Zy,Z as Xg,z as Qg,B as Jg,D as ex,E as tx,G as rl,H as Zg,I as Ad,J as em,K as co,N as rx,O as sx,Q as Li,V as tc,W as nx,Y as tm,_ as Rd,$ as ax,a0 as ix,a1 as ox,a2 as lx,a3 as cx,a4 as dx,a5 as Pd,a6 as qn,a7 as ux,a8 as Md,a9 as hx,aa as gx,ab as mx,ac as fx,ad as px,ae as rm,af as sm,ag as uo,ah as yx}from"./icons-B-AFu83W.js";import{_ as Xn,C as Qn,r as Kr,S as rc,a as nm,F as sc,g as nc,b as br,c as ya,d as am,i as ac,p as im,u as om,e as lm,E as cm,o as xx,f as bx,L as dm,h as um,j as vx,k as hm,l as gm,m as mm,n as wx,q as kx,G as Ps,s as Ee,t as Jt,v as Rt,w as wt,x as Tx,y as _s,z as Od,A as Tt,B as Pe,D as He,H as Ld,I as Gt,J as We,K as Re,M as Lr,N as Ge,O as Vt,P as $d,Q as Nx,R as Sx,T as Fd,U as jx,V as _x,W as Dx,X as Cx,Y as Ex,Z as oe,$ as ht,a0 as ic,a1 as Ir,a2 as Xs,a3 as ti,a4 as Ix,a5 as Ax,a6 as Rx,a7 as xa,a8 as oc,a9 as lc,aa as Px,ab as Mx,ac as Ox,ad as Wd,ae as fm,af as Lx,ag as $x,ah as $i,ai as Fx,aj as Wx}from"./firebase-B-qVQrGd.js";import{b as ho,a as vn,c as wn,d as Vx,e as xs,g as ri,i as Ut,f as qe,h as sn,j as Vd,k as Ud,s as go,l as Ux,m as In,n as as,o as is,p as pm,q as Bx,r as sl,t as An,u as ym,v as Ha,w as nl,x as Hx,y as si,z as xm,A as Ds}from"./date-BnkIBH9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var mo={exports:{}},kn={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bd;function Gx(){if(Bd)return kn;Bd=1;var t=Gy(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,d){var u,h={},g=null,m=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(u in c)s.call(c,u)&&!i.hasOwnProperty(u)&&(h[u]=c[u]);if(l&&l.defaultProps)for(u in c=l.defaultProps,c)h[u]===void 0&&(h[u]=c[u]);return{$$typeof:e,type:l,key:g,ref:m,props:h,_owner:n.current}}return kn.Fragment=r,kn.jsx=o,kn.jsxs=o,kn}var Hd;function zx(){return Hd||(Hd=1,mo.exports=Gx()),mo.exports}var a=zx(),Pa={},Gd;function Kx(){if(Gd)return Pa;Gd=1;var t=Gg();return Pa.createRoot=t.createRoot,Pa.hydrateRoot=t.hydrateRoot,Pa}var Yx=Kx();const qx="modulepreload",Xx=function(t,e){return new URL(t,e).href},zd={},Je=function(e,r,s){let n=Promise.resolve();if(r&&r.length>0){let d=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");n=d(r.map(u=>{if(u=Xx(u,s),u in zd)return;zd[u]=!0;const h=u.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(!!s)for(let f=o.length-1;f>=0;f--){const y=o[f];if(y.href===u&&(!h||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${g}`))return;const x=document.createElement("link");if(x.rel=h?"stylesheet":qx,h||(x.as="script"),x.crossOrigin="",x.href=u,c&&x.setAttribute("nonce",c),document.head.appendChild(x),h)return new Promise((f,y)=>{x.addEventListener("load",f),x.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function fo(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}function Qx(t){return t.toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function Fi(t){switch(t){case 1:return"ì²«ì§¸ì£¼";case 2:return"ë‘˜ì§¸ì£¼";case 3:return"ì…‹ì§¸ì£¼";case 4:return"ë„·ì§¸ì£¼";case 5:return"ë§ˆì§€ë§‰ì£¼";case-1:return"ë§ˆì§€ë§‰ì£¼";default:return`${t}ì£¼ì°¨`}}function Jx(t){return{2024:["2024-01-01","2024-02-09","2024-02-10","2024-02-11","2024-02-12","2024-03-01","2024-04-10","2024-05-05","2024-05-06","2024-05-15","2024-06-06","2024-08-15","2024-09-16","2024-09-17","2024-09-18","2024-10-03","2024-10-09","2024-12-25"],2025:["2025-01-01","2025-01-28","2025-01-29","2025-01-30","2025-03-01","2025-05-05","2025-05-13","2025-06-06","2025-08-15","2025-10-05","2025-10-06","2025-10-07","2025-10-08","2025-10-03","2025-10-09","2025-12-25"],2026:["2026-01-01","2026-02-16","2026-02-17","2026-02-18","2026-03-01","2026-05-05","2026-05-02","2026-06-06","2026-08-15","2026-09-24","2026-09-25","2026-09-26","2026-10-03","2026-10-09","2026-12-25"]}[t.toString()]||[]}function Zx(t){return{2024:[{date:"2024-01-01",name:"ì‹ ì •",isHoliday:!0},{date:"2024-02-09",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2024-02-10",name:"ì„¤ë‚ ",isHoliday:!0},{date:"2024-02-11",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2024-02-12",name:"ëŒ€ì²´ê³µíœ´ì¼",isHoliday:!0},{date:"2024-03-01",name:"ì‚¼ì¼ì ˆ",isHoliday:!0},{date:"2024-04-10",name:"êµ­íšŒì˜ì›ì„ ê±°",isHoliday:!0},{date:"2024-05-05",name:"ì–´ë¦°ì´ë‚ ",isHoliday:!0},{date:"2024-05-06",name:"ëŒ€ì²´ê³µíœ´ì¼",isHoliday:!0},{date:"2024-05-15",name:"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",isHoliday:!0},{date:"2024-06-06",name:"í˜„ì¶©ì¼",isHoliday:!0},{date:"2024-08-15",name:"ê´‘ë³µì ˆ",isHoliday:!0},{date:"2024-09-16",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2024-09-17",name:"ì¶”ì„",isHoliday:!0},{date:"2024-09-18",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2024-10-03",name:"ê°œì²œì ˆ",isHoliday:!0},{date:"2024-10-09",name:"í•œê¸€ë‚ ",isHoliday:!0},{date:"2024-12-25",name:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",isHoliday:!0}],2025:[{date:"2025-01-01",name:"ì‹ ì •",isHoliday:!0},{date:"2025-01-28",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2025-01-29",name:"ì„¤ë‚ ",isHoliday:!0},{date:"2025-01-30",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2025-03-01",name:"ì‚¼ì¼ì ˆ",isHoliday:!0},{date:"2025-05-05",name:"ì–´ë¦°ì´ë‚ ",isHoliday:!0},{date:"2025-05-13",name:"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",isHoliday:!0},{date:"2025-06-06",name:"í˜„ì¶©ì¼",isHoliday:!0},{date:"2025-08-15",name:"ê´‘ë³µì ˆ",isHoliday:!0},{date:"2025-10-05",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2025-10-06",name:"ì¶”ì„",isHoliday:!0},{date:"2025-10-07",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2025-10-08",name:"ëŒ€ì²´ê³µíœ´ì¼",isHoliday:!0},{date:"2025-10-03",name:"ê°œì²œì ˆ",isHoliday:!0},{date:"2025-10-09",name:"í•œê¸€ë‚ ",isHoliday:!0},{date:"2025-12-25",name:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",isHoliday:!0}],2026:[{date:"2026-01-01",name:"ì‹ ì •",isHoliday:!0},{date:"2026-02-16",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2026-02-17",name:"ì„¤ë‚ ",isHoliday:!0},{date:"2026-02-18",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2026-03-01",name:"ì‚¼ì¼ì ˆ",isHoliday:!0},{date:"2026-05-05",name:"ì–´ë¦°ì´ë‚ ",isHoliday:!0},{date:"2026-05-02",name:"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",isHoliday:!0},{date:"2026-06-06",name:"í˜„ì¶©ì¼",isHoliday:!0},{date:"2026-08-15",name:"ê´‘ë³µì ˆ",isHoliday:!0},{date:"2026-09-24",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2026-09-25",name:"ì¶”ì„",isHoliday:!0},{date:"2026-09-26",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2026-10-03",name:"ê°œì²œì ˆ",isHoliday:!0},{date:"2026-10-09",name:"í•œê¸€ë‚ ",isHoliday:!0},{date:"2026-12-25",name:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",isHoliday:!0}]}[t.toString()]||[]}function bm(t){const e=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n=`${e}-${r}-${s}`;return Jx(e).includes(n)}function Br(t){const e=t.getDay();return e===0||e===6}function vm(t){return Br(t)||bm(t)}function cc(t){const e=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n=`${e}-${r}-${s}`;return Zx(e).find(o=>o.date===n)||null}function wm(t,e){const r=new Date(t,e-1,1);let s=new Date(r);for(;vm(s);)s.setDate(s.getDate()+1);return s}function km(t,e){const r=new Date(t,e,0);let s=new Date(r);for(;vm(s);)s.setDate(s.getDate()-1);return s}function ni(t,e){if(bm(t))return!0;const r=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),i=`${r}-${s}-${n}`,o=`${s}-${n}`;return e.some(l=>{if(!!l.isRecurring){const d=l.date.split("-");if(d.length===3){const u=d[1].padStart(2,"0"),h=d[2].padStart(2,"0");return`${u}-${h}`===o}return l.date.endsWith(o)}return l.date===i})}class eb{constructor(){Ht(this,"templates",[])}setTemplates(e){this.templates=e}hasConflictingInstance(e,r,s){const n=this.templates.find(o=>o.title===s.targetTemplateTitle&&o.id!==r);if(!n)return!1;const i=this.generateInstancesForTemplate(n);for(const o of i)if(this.checkDateConflict(e,o.date,s.scope))return console.log(`[Conflict] ${e.toDateString()}ì— ${n.title}ì™€(ê³¼) ì¶©ëŒ ë°œìƒ`),!0;return!1}checkDateConflict(e,r,s){switch(s){case"same_date":return e.toDateString()===r.toDateString();case"same_week":const n=new Date(e);n.setDate(e.getDate()-e.getDay());const i=new Date(r);return i.setDate(r.getDate()-r.getDay()),n.toDateString()===i.toDateString();case"same_month":return e.getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth();default:return!1}}generateInstancesForTemplate(e,r=[]){if(!e.isActive)return[];switch(e.recurrenceType){case"daily":return this.generateDailyInstancesRaw(e,r);case"weekly":return this.generateWeeklyInstancesRaw(e,r);case"monthly":return this.generateMonthlyInstancesRaw(e,r);default:return[]}}calculateWeekOfMonth(e){const r=e.getFullYear(),s=e.getMonth(),n=e.getDate(),i=new Date(r,s,1),o=new Date(r,s+1,0),l=i.getDay(),c=Math.ceil((n+l)/7),d=o.getDate(),u=Math.ceil((d+l)/7);return console.log(`  firstWeekday=${l}, weekOfMonth=${c}, totalWeeks=${u}`),c===u?(console.log("  ë§ˆì§€ë§‰ì£¼ë¡œ íŒì •: -1 ë°˜í™˜"),-1):(console.log(`  ì¼ë°˜ ì£¼ì°¨: ${c} ë°˜í™˜`),c)}isLastOccurrenceOfWeekdayInMonth(e){const r=e.getFullYear(),s=e.getMonth(),n=e.getDay(),i=new Date(r,s+1,0);for(let o=i.getDate();o>=1;o--){const l=new Date(r,s,o);if(l.getDay()===n){const c=e.getDate()===o;return console.log(`  ${e.toDateString()}: ê°™ì€ ìš”ì¼(${n})ì˜ ë§ˆì§€ë§‰ ë‚ ì€ ${l.toDateString()}, ì¼ì¹˜: ${c}`),c}}return!1}adjustForHolidays(e,r="show",s=[]){let n=new Date(e);if(r==="show")return n;const i=ni(n,s),o=Br(n);if(!i&&!o)return console.log("   âœ… ì´ë¯¸ í‰ì¼ì´ë¯€ë¡œ ì¡°ì • ë¶ˆí•„ìš”"),n;n.getMonth();let l=0;const c=15;for(;l<c;){r==="before"?(n.setDate(n.getDate()-1),console.log(`   â† í•˜ë£¨ ì´ì „ìœ¼ë¡œ: ${n.toDateString()}`)):(n.setDate(n.getDate()+1),console.log(`   â†’ í•˜ë£¨ ì´í›„ë¡œ: ${n.toDateString()}`));const d=ni(n,s),u=Br(n);if(console.log(`   ì²´í¬: ê³µíœ´ì¼=${d}, ì£¼ë§=${u}`),!d&&!u){console.log(`   âœ… í‰ì¼ ë°œê²¬: ${n.toDateString()}`);break}l++}return l>=c?(console.warn(`âš ï¸ ê³µíœ´ì¼ ì¡°ì • ìµœëŒ€ ì‹œë„ ì´ˆê³¼ (${c}íšŒ), ì›ë˜ ë‚ ì§œ ë°˜í™˜`),console.log(`   ì›ë˜ ë‚ ì§œ ë°˜í™˜: ${e.toDateString()}`),e):n}hasDuplicateOnDate(e,r,s){return!1}isExceptionDate(e,r,s){if(!r||r.length===0)return!1;for(const n of r)switch(n.type){case"date":const i=e.getDate();if(n.values.includes(i))return!0;break;case"weekday":const o=e.getDay();if(n.values.includes(o))return!0;break;case"week":const l=this.calculateWeekOfMonth(e);if(console.log("ì˜ˆì™¸ ì²´í¬:",e.toDateString(),"ì£¼ì°¨:",l,"ì˜ˆì™¸ ê°’ë“¤:",n.values),n.values.includes(-1)){const d=this.isLastOccurrenceOfWeekdayInMonth(e);if(console.log("ë§ˆì§€ë§‰ì£¼ ì²´í¬:",e.toDateString(),"í•´ë‹¹ ìš”ì¼ì˜ ë§ˆì§€ë§‰ ë°œìƒì¼:",d),d)return console.log("ì˜ˆì™¸ ë‚ ì§œ ì œì™¸ (ë§ˆì§€ë§‰ì£¼):",e.toDateString()),!0}if(n.values.includes(l))return console.log("ì˜ˆì™¸ ë‚ ì§œ ì œì™¸:",e.toDateString(),"ì£¼ì°¨:",l),!0;break;case"month":const c=e.getMonth()+1;if(n.values.includes(c))return!0;break;case"conflict":if(s){const d=n.values;for(const u of d)if(console.log("ì¤‘ë³µ ì˜ˆì™¸ ê²€ì‚¬:",e.toDateString(),u),this.hasConflictingInstance(e,s,u))return console.log("ì¤‘ë³µìœ¼ë¡œ ì¸í•œ ì˜ˆì™¸ ì²˜ë¦¬:",e.toDateString()),!0}break}return!1}generateDailyInstancesRaw(e,r=[]){if(e.recurrenceType!=="daily")return[];const s=[],n=new Date,i=new Date(e.createdAt),o=new Date(n);o.setFullYear(n.getFullYear()+1);let l=new Date(i);for(;l<=o;){const c=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(new Date(l.getFullYear(),l.getMonth(),l.getDate())>=c&&!this.isExceptionDate(l,e.exceptions,e.id)){const u=e.holidayHandling||"show",h=this.adjustForHolidays(l,u,r);if(!this.hasDuplicateOnDate(h,e.id,e.title)){const g=`${h.getFullYear()}-${(h.getMonth()+1).toString().padStart(2,"0")}-${h.getDate().toString().padStart(2,"0")}`,m=`${e.id}_${g}`;s.push({id:m,templateId:e.id,date:h,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3})}}l.setDate(l.getDate()+1)}return s}generateWeeklyInstancesRaw(e,r=[]){if(e.recurrenceType!=="weekly"||e.weekday===void 0)return[];const s=[],n=new Date,i=new Date(e.createdAt),o=new Date(n);o.setFullYear(n.getFullYear()+1);const l=e.weekday;let c=new Date(i);const d=(l-i.getDay()+7)%7;d>0&&c.setDate(i.getDate()+d);let u=new Date(c);for(;u<=o;){const h=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(new Date(u.getFullYear(),u.getMonth(),u.getDate())>=h&&!this.isExceptionDate(u,e.exceptions,e.id)){const m=e.holidayHandling||"show";console.log(`[${e.title}] ì›ë³¸ ë‚ ì§œ: ${u.toDateString()}, ê³µíœ´ì¼ ì²˜ë¦¬: ${m}`),console.log(`[${e.title}] í…œí”Œë¦¿ ì „ì²´ ë°ì´í„°:`,e);const x=cc(u)!==null,f=Br(u);console.log(`[${e.title}] ê³µíœ´ì¼ ì—¬ë¶€: ${x}, ì£¼ë§ ì—¬ë¶€: ${f}`);const y=this.adjustForHolidays(u,m,r);if(y.getTime()!==u.getTime()&&console.log(`[${e.title}] ê³µíœ´ì¼ ì¡°ì •: ${u.toDateString()} â†’ ${y.toDateString()}`),this.hasDuplicateOnDate(y,e.id,e.title))console.log(`ğŸš« ì¤‘ë³µ í• ì¼ ë°œê²¬ìœ¼ë¡œ ìƒì„± ì œì™¸: "${e.title}" - ${y.toDateString()}`);else{const w=`${y.getFullYear()}-${(y.getMonth()+1).toString().padStart(2,"0")}-${y.getDate().toString().padStart(2,"0")}`,v=`${e.id}_${w}`;e.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")&&(console.log("ğŸ“‹ ì›”ê°„ì—…ë¬´ë³´ê³  ì¸ìŠ¤í„´ìŠ¤ ìƒì„±:"),console.log(`   ìµœì¢… ë‚ ì§œ: ${y.toDateString()} (${y.getDate()}ì¼)`),console.log(`   ìƒì„±ëœ ID: ${v}`)),s.push({id:v,templateId:e.id,date:y,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3})}}u.setDate(u.getDate()+7)}return s}findNthWeekdayOfMonth(e,r,s,n){const i=new Date(e,r-1,1),o=i.getDay();if(console.log(`   findNthWeekdayOfMonth: ${e}ë…„ ${r}ì›”, ${s} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼`),console.log(`   ì²«ì§¸ ë‚ : ${i.toDateString()}, ì²«ì§¸ ë‚  ìš”ì¼: ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][o]}`),s==="last"){const l=new Date(e,r,0);console.log(`   ë§ˆì§€ë§‰ ë‚ : ${l.toDateString()}`);for(let c=l.getDate();c>=1;c--){const d=new Date(e,r-1,c);if(d.getDay()===n)return console.log(`   ë§ˆì§€ë§‰ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼: ${d.toDateString()}`),d}}else{const c={first:1,second:2,third:3,fourth:4}[s];let d=(n-o+7)%7,u=new Date(e,r-1,1+d);console.log(`   ì²« ë²ˆì§¸ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼: ${u.toDateString()}`);let h=new Date(u);return h.setDate(h.getDate()+(c-1)*7),console.log(`   ${c}ë²ˆì§¸ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼: ${h.toDateString()}`),h.getMonth()===r-1?h:(console.log(`   âŒ ${c}ë²ˆì§¸ ì£¼ê°€ í•´ë‹¹ ì›”ì„ ë²—ì–´ë‚¨`),null)}return null}generateMonthlyInstancesRaw(e,r=[]){if(e.recurrenceType!=="monthly")return[];console.log(`
ğŸ”¥ [${e.title}] ìƒˆë¡œìš´ ì›”ê°„ ë°˜ë³µ ë¡œì§ ì‹œì‘`),console.log("   ì „ì²´ í…œí”Œë¦¿ ë°ì´í„°:",JSON.stringify(e,null,2)),console.log(`   monthlyDate: ${e.monthlyDate}`),console.log(`   monthlyPattern: ${e.monthlyPattern}`),console.log(`   monthlyWeek: ${e.monthlyWeek}`),console.log(`   monthlyWeekday: ${e.monthlyWeekday}`);const s=[],n=new Set,i=new Date,o=i.getFullYear(),l=i.getMonth()+1,c=i.getDate();console.log(`   í˜„ì¬: ${o}ë…„ ${l}ì›” ${c}ì¼`);for(let d=0;d<12;d++){let u=o,h=l+d;h>12&&(u+=Math.floor((h-1)/12),h=(h-1)%12+1),console.log(`
ğŸ“… ì²˜ë¦¬ ì¤‘: ${u}ë…„ ${h}ì›”`);let g=null;if(e.monthlyPattern==="weekday"&&e.monthlyWeek&&e.monthlyWeekday!==void 0)console.log(`   íŒ¨í„´: ë§¤ì›” ${e.monthlyWeek} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][e.monthlyWeekday]}ìš”ì¼`),g=this.findNthWeekdayOfMonth(u,h,e.monthlyWeek,e.monthlyWeekday),console.log(g?`   ${e.monthlyWeek} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][e.monthlyWeekday]}ìš”ì¼: ${g.toDateString()}`:`   âŒ ${u}ë…„ ${h}ì›”ì— ${e.monthlyWeek} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][e.monthlyWeekday]}ìš”ì¼ì´ ì—†ìŒ`);else if(e.monthlyDate===-1)g=new Date(u,h,0),console.log(`   ë§ì¼: ${g.toDateString()}`);else if(e.monthlyDate===-2)g=wm(u,h),console.log(`   ì²« ë²ˆì§¸ ê·¼ë¬´ì¼: ${g.toDateString()}`);else if(e.monthlyDate===-3)g=km(u,h),console.log(`   ë§ˆì§€ë§‰ ê·¼ë¬´ì¼: ${g.toDateString()}`);else if(e.monthlyDate&&e.monthlyDate>0){if(g=new Date(u,h-1,e.monthlyDate),g.getMonth()!==h-1){console.log(`   âš ï¸ ${u}ë…„ ${h}ì›”ì—ëŠ” ${e.monthlyDate}ì¼ì´ ì—†ìŒ`);continue}console.log(`   íŠ¹ì • ë‚ ì§œ ${e.monthlyDate}ì¼: ${g.toDateString()}`)}else g=new Date(u,h-1,1),console.log(`   ê¸°ë³¸ê°’ (ë§¤ì›” 1ì¼): ${g.toDateString()}`);if(!g){console.log("   âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ");continue}const m=new Date(o,l-1,c);if(g<m){console.log(`   â° ê³¼ê±° ë‚ ì§œ ì œì™¸: ${g.toDateString()}`);continue}let x=g;if(e.monthlyDate&&e.monthlyDate>0){const w=e.holidayHandling||"show";x=this.adjustForHolidays(g,w,r),x.getTime()!==g.getTime()&&console.log(`   ğŸ”„ ê³µíœ´ì¼ ì¡°ì •: ${g.toDateString()} â†’ ${x.toDateString()}`)}if(this.isExceptionDate(x,e.exceptions,e.id)){console.log(`   ğŸš« ì˜ˆì™¸ ë‚ ì§œ ì œì™¸: ${x.toDateString()}`);continue}const f=`${x.getFullYear()}-${(x.getMonth()+1).toString().padStart(2,"0")}-${x.getDate().toString().padStart(2,"0")}`;if(n.has(f)){console.log(`   ğŸš« ì¤‘ë³µ ë°©ì§€: ${f} ì´ë¯¸ ìƒì„±ë¨`);continue}const y=`${e.id}_${f}`;n.add(f),s.push({id:y,templateId:e.id,date:x,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3}),console.log(`   âœ… ì¸ìŠ¤í„´ìŠ¤ ìƒì„±: ${x.toDateString()} (ID: ${y})`)}return console.log(`ğŸ¯ [${e.title}] ì´ ${s.length}ê°œ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ`),s}calculateMonthlyWeekday(e,r,s,n){const i=r-1,o=new Date(e,i+1,0);if(console.log(`ğŸ—“ï¸ calculateMonthlyWeekday: ${e}ë…„ ${r}ì›” ${s} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼`),console.log(`ğŸ—“ï¸ í•´ë‹¹ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ : ${o.getDate()}ì¼`),s==="last"){console.log(`ğŸ” ë§ˆì§€ë§‰ ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼ì„ ì°¾ëŠ” ì¤‘...`);for(let l=o.getDate();l>=1;l--){const c=new Date(e,i,l);if(c.getDay()===n)return console.log(`âœ… ë§ˆì§€ë§‰ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼ ë°œê²¬: ${c.getFullYear()}ë…„ ${c.getMonth()+1}ì›” ${c.getDate()}ì¼`),c}}else{const c={first:1,second:2,third:3,fourth:4}[s];let d=0;for(let u=1;u<=o.getDate();u++){const h=new Date(e,i,u);if(h.getDay()===n&&(d++,d===c))return h}}return null}generateDailyInstances(e,r=[]){return this.generateDailyInstancesRaw(e,r)}generateWeeklyInstances(e,r=[]){return this.generateWeeklyInstancesRaw(e,r)}generateMonthlyInstances(e,r=[]){return this.generateMonthlyInstancesRaw(e,r)}generateInstances(e,r=[]){if(!e.isActive)return[];let s=[];switch(e.recurrenceType){case"daily":s=this.generateDailyInstances(e,r);break;case"weekly":s=this.generateWeeklyInstances(e,r);break;case"monthly":s=this.generateMonthlyInstances(e,r);break;default:return[]}return this.removeDuplicateInstances(s)}removeDuplicateInstances(e){const r=new Map;for(const s of e){const n=`${s.templateId}_${s.date.toDateString()}`;(!r.has(n)||r.get(n).createdAt<s.createdAt)&&(r.has(n)&&console.log(`ğŸ”§ ì¤‘ë³µ ì¸ìŠ¤í„´ìŠ¤ ì œê±°: ${s.date.toDateString()}`),r.set(n,s))}return Array.from(r.values()).sort((s,n)=>s.date.getTime()-n.date.getTime())}convertToTodo(e,r){const s=`recurring_${e.id}`,i=r.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")||r.title.includes("ì›”ê°„ ì—…ë¬´ë³´ê³ ")||r.title.includes("ì—…ë¬´ë³´ê³ ")||r.title.includes("ì—…ë¬´ ë³´ê³ ")?"urgent":r.priority,o=new Date(e.date);o.setHours(12,0,0,0);const l={id:s,title:r.title,description:r.description,completed:e.completed,priority:i,type:r.type,dueDate:void 0,startDate:o,createdAt:e.createdAt,updatedAt:e.updatedAt,completedAt:e.completedAt,tags:[...r.tags||[]],order:e.order,_isRecurringInstance:!0,_instanceId:e.id,_templateId:r.id};return e.id==="PUH4xT3lVY5aK2vuQyUe_2025-08-21"&&(console.log("ğŸ“‹ğŸ“‹ğŸ“‹ convertToTodo ê²°ê³¼ - ì£¼ê°„ì—…ë¬´ë³´ê³ "),console.log("  ì¶œë ¥ todo.completed:",l.completed,typeof l.completed),console.log("  ì¶œë ¥ todo ì „ì²´:",JSON.stringify(l,null,2))),l}getTodayInstances(e){const s=new Date().toDateString();return e.filter(n=>n.date.toDateString()===s)}getWeekInstances(e){const r=new Date,s=new Date(r);s.setDate(r.getDate()-r.getDay());const n=new Date(s);return n.setDate(s.getDate()+6),e.filter(i=>i.date>=s&&i.date<=n)}getMonthInstances(e){const r=new Date,s=new Date(r.getFullYear(),r.getMonth(),1),n=new Date(r.getFullYear(),r.getMonth()+1,0);return e.filter(i=>i.date>=s&&i.date<=n)}removeDuplicateTodos(e){const r=new Map,s=[];for(const o of e){if(!o._isRecurringInstance){s.push(o);continue}const l=`${o.title}_${o.dueDate?.toDateString()||"no-date"}`;r.has(l)?console.log(`ğŸ—‘ï¸ ì¤‘ë³µ ë°˜ë³µ í• ì¼ ì œê±°: "${o.title}" - ${o.dueDate?.toDateString()}`):(r.set(l,o),console.log(`ğŸ“‹ ë°˜ë³µ í• ì¼ ìœ ì§€: "${o.title}" - ${o.dueDate?.toDateString()}`))}const n=Array.from(r.values()),i=[...s,...n];return console.log(`ğŸ“Š ì¤‘ë³µ ì œê±° ê²°ê³¼: ${e.length} â†’ ${i.length} (${e.length-i.length}ê°œ ì œê±°)`),i.sort((o,l)=>{const c=o.order||0,d=l.order||0;if(c!==d)return c-d;const u=o.dueDate||new Date(0),h=l.dueDate||new Date(0);return u.getTime()-h.getTime()})}}const Ms=new eb;/*! Capacitor: https://capacitorjs.com/ - MIT License */var bs;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(bs||(bs={}));class Ga extends Error{constructor(e,r,s){super(e),this.message=e,this.code=r,this.data=s}}const tb=t=>{var e,r;return t?.androidBridge?"android":!((r=(e=t?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},rb=t=>{const e=t.CapacitorCustomPlatform||null,r=t.Capacitor||{},s=r.Plugins=r.Plugins||{},n=()=>e!==null?e.name:tb(t),i=()=>n()!=="web",o=h=>{const g=d.get(h);return!!(g?.platforms.has(n())||l(h))},l=h=>{var g;return(g=r.PluginHeaders)===null||g===void 0?void 0:g.find(m=>m.name===h)},c=h=>t.console.error(h),d=new Map,u=(h,g={})=>{const m=d.get(h);if(m)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),m.proxy;const x=n(),f=l(h);let y;const w=async()=>(!y&&x in g?y=typeof g[x]=="function"?y=await g[x]():y=g[x]:e!==null&&!y&&"web"in g&&(y=typeof g.web=="function"?y=await g.web():y=g.web),y),v=(T,_)=>{var P,C;if(f){const A=f?.methods.find(B=>_===B.name);if(A)return A.rtype==="promise"?B=>r.nativePromise(h,_.toString(),B):(B,z)=>r.nativeCallback(h,_.toString(),B,z);if(T)return(P=T[_])===null||P===void 0?void 0:P.bind(T)}else{if(T)return(C=T[_])===null||C===void 0?void 0:C.bind(T);throw new Ga(`"${h}" plugin is not implemented on ${x}`,bs.Unimplemented)}},k=T=>{let _;const P=(...C)=>{const A=w().then(B=>{const z=v(B,T);if(z){const W=z(...C);return _=W?.remove,W}else throw new Ga(`"${h}.${T}()" is not implemented on ${x}`,bs.Unimplemented)});return T==="addListener"&&(A.remove=async()=>_()),A};return P.toString=()=>`${T.toString()}() { [capacitor code] }`,Object.defineProperty(P,"name",{value:T,writable:!1,configurable:!1}),P},b=k("addListener"),j=k("removeListener"),D=(T,_)=>{const P=b({eventName:T},_),C=async()=>{const B=await P;j({eventName:T,callbackId:B},_)},A=new Promise(B=>P.then(()=>B({remove:C})));return A.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await C()},A},N=new Proxy({},{get(T,_){switch(_){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?D:b;case"removeListener":return j;default:return k(_)}}});return s[h]=N,d.set(h,{name:h,proxy:N,platforms:new Set([...Object.keys(g),...f?[x]:[]])}),N};return r.convertFileSrc||(r.convertFileSrc=h=>h),r.getPlatform=n,r.handleError=c,r.isNativePlatform=i,r.isPluginAvailable=o,r.registerPlugin=u,r.Exception=Ga,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},sb=t=>t.Capacitor=rb(t),Ke=sb(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ar=Ke.registerPlugin;class dc{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,r){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(r);const i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i),s&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,r);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,r,s){const n=this.listeners[e];if(!n){if(s){let i=this.retainedEventArguments[e];i||(i=[]),i.push(r),this.retainedEventArguments[e]=i}return}n.forEach(i=>i(r))}hasListeners(e){var r;return!!(!((r=this.listeners[e])===null||r===void 0)&&r.length)}registerWindowListener(e,r){this.windowListeners[r]={registered:!1,windowEventName:e,pluginEventName:r,handler:s=>{this.notifyListeners(r,s)}}}unimplemented(e="not implemented"){return new Ke.Exception(e,bs.Unimplemented)}unavailable(e="not available"){return new Ke.Exception(e,bs.Unavailable)}async removeListener(e,r){const s=this.listeners[e];if(!s)return;const n=s.indexOf(r);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const r=this.retainedEventArguments[e];r&&(delete this.retainedEventArguments[e],r.forEach(s=>{this.notifyListeners(e,s)}))}}const Kd=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Yd=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class nb extends dc{async getCookies(){const e=document.cookie,r={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[n,i]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=Yd(n).trim(),i=Yd(i).trim(),r[n]=i}),r}async setCookie(e){try{const r=Kd(e.key),s=Kd(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${r}=${s||""}${n}; path=${i}; ${o};`}catch(r){return Promise.reject(r)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const r of e)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Ar("CapacitorCookies",{web:()=>new nb});const ab=async t=>new Promise((e,r)=>{const s=new FileReader;s.onload=()=>{const n=s.result;e(n.indexOf(",")>=0?n.split(",")[1]:n)},s.onerror=n=>r(n),s.readAsDataURL(t)}),ib=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(n=>n.toLocaleLowerCase()).reduce((n,i,o)=>(n[i]=t[e[o]],n),{})},ob=(t,e=!0)=>t?Object.entries(t).reduce((s,n)=>{const[i,o]=n;let l,c;return Array.isArray(o)?(c="",o.forEach(d=>{l=e?encodeURIComponent(d):d,c+=`${i}=${l}&`}),c.slice(0,-1)):(l=e?encodeURIComponent(o):o,c=`${i}=${l}`),`${s}&${c}`},"").substr(1):null,Tm=(t,e={})=>{const r=Object.assign({method:t.method||"GET",headers:t.headers},e),n=ib(t.headers)["content-type"]||"";if(typeof t.data=="string")r.body=t.data;else if(n.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[o,l]of Object.entries(t.data||{}))i.set(o,l);r.body=i.toString()}else if(n.includes("multipart/form-data")||t.data instanceof FormData){const i=new FormData;if(t.data instanceof FormData)t.data.forEach((l,c)=>{i.append(c,l)});else for(const l of Object.keys(t.data))i.append(l,t.data[l]);r.body=i;const o=new Headers(r.headers);o.delete("content-type"),r.headers=o}else(n.includes("application/json")||typeof t.data=="object")&&(r.body=JSON.stringify(t.data));return r};class lb extends dc{async request(e){const r=Tm(e,e.webFetchExtra),s=ob(e.params,e.shouldEncodeUrlParams),n=s?`${e.url}?${s}`:e.url,i=await fetch(n,r),o=i.headers.get("content-type")||"";let{responseType:l="text"}=i.ok?e:{};o.includes("application/json")&&(l="json");let c,d;switch(l){case"arraybuffer":case"blob":d=await i.blob(),c=await ab(d);break;case"json":c=await i.json();break;case"document":case"text":default:c=await i.text()}const u={};return i.headers.forEach((h,g)=>{u[g]=h}),{data:c,headers:u,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Ar("CapacitorHttp",{web:()=>new lb});const ms=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:Ke,CapacitorException:Ga,get ExceptionCode(){return bs},WebPlugin:dc,buildRequestInit:Tm,registerPlugin:Ar},Symbol.toStringTag,{value:"Module"}));var qd;(function(t){t.IndexedDbLocal="INDEXED_DB_LOCAL",t.InMemory="IN_MEMORY",t.BrowserLocal="BROWSER_LOCAL",t.BrowserSession="BROWSER_SESSION"})(qd||(qd={}));var Xd;(function(t){t.APPLE="apple.com",t.FACEBOOK="facebook.com",t.GAME_CENTER="gc.apple.com",t.GITHUB="github.com",t.GOOGLE="google.com",t.MICROSOFT="microsoft.com",t.PLAY_GAMES="playgames.google.com",t.TWITTER="twitter.com",t.YAHOO="yahoo.com",t.PASSWORD="password",t.PHONE="phone"})(Xd||(Xd={}));const po=Ar("FirebaseAuthentication",{web:()=>Je(()=>import("./web-BaNTHTPQ.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>new t.FirebaseAuthenticationWeb)});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nm="firebasestorage.googleapis.com",cb="storageBucket",db=120*1e3,ub=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr extends sc{constructor(e,r,s=0){super(yo(e),`Firebase Storage: ${r} (${yo(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return yo(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var yr;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(yr||(yr={}));function yo(t){return"storage/"+t}function hb(){const t="An unknown error occurred, please check the error payload for server response.";return new vr(yr.UNKNOWN,t)}function gb(){return new vr(yr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function mb(){return new vr(yr.CANCELED,"User canceled the upload/download.")}function fb(t){return new vr(yr.INVALID_URL,"Invalid URL '"+t+"'.")}function pb(t){return new vr(yr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Qd(t){return new vr(yr.INVALID_ARGUMENT,t)}function Sm(){return new vr(yr.APP_DELETED,"The Firebase app was deleted.")}function yb(t){return new vr(yr.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let s;try{s=rr.makeFromUrl(e,r)}catch{return new rr(e,"")}if(s.path==="")return s;throw pb(e)}static makeFromUrl(e,r){let s=null;const n="([A-Za-z0-9.\\-_]+)";function i(b){b.path.charAt(b.path.length-1)==="/"&&(b.path_=b.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+n+o,"i"),c={bucket:1,path:3};function d(b){b.path_=decodeURIComponent(b.path)}const u="v[A-Za-z0-9_]+",h=r.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",m=new RegExp(`^https?://${h}/${u}/b/${n}/o${g}`,"i"),x={bucket:1,path:3},f=r===Nm?"(?:storage.googleapis.com|storage.cloud.google.com)":r,y="([^?#]*)",w=new RegExp(`^https?://${f}/${n}/${y}`,"i"),k=[{regex:l,indices:c,postModify:i},{regex:m,indices:x,postModify:d},{regex:w,indices:{bucket:1,path:2},postModify:d}];for(let b=0;b<k.length;b++){const j=k[b],D=j.regex.exec(e);if(D){const N=D[j.indices.bucket];let T=D[j.indices.path];T||(T=""),s=new rr(N,T),j.postModify(s);break}}if(s==null)throw fb(e);return s}}class xb{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(t,e,r){let s=1,n=null,i=null,o=!1,l=0;function c(){return l===2}let d=!1;function u(...y){d||(d=!0,e.apply(null,y))}function h(y){n=setTimeout(()=>{n=null,t(m,c())},y)}function g(){i&&clearTimeout(i)}function m(y,...w){if(d){g();return}if(y){g(),u.call(null,y,...w);return}if(c()||o){g(),u.call(null,y,...w);return}s<64&&(s*=2);let k;l===1?(l=2,k=0):k=(s+Math.random())*1e3,h(k)}let x=!1;function f(y){x||(x=!0,g(),!d&&(n!==null?(y||(l=2),clearTimeout(n),h(0)):y||(l=1)))}return h(0),i=setTimeout(()=>{o=!0,f(!0)},r),f}function vb(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wb(t){return t!==void 0}function Jd(t,e,r,s){if(s<e)throw Qd(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>r)throw Qd(`Invalid value for '${t}'. Expected ${r} or less.`)}function kb(t){const e=encodeURIComponent;let r="?";for(const s in t)if(t.hasOwnProperty(s)){const n=e(s)+"="+e(t[s]);r=r+n+"&"}return r=r.slice(0,-1),r}var ai;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ai||(ai={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tb(t,e){const r=t>=500&&t<600,n=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return r||n||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(e,r,s,n,i,o,l,c,d,u,h,g=!0,m=!1){this.url_=e,this.method_=r,this.headers_=s,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=u,this.connectionFactory_=h,this.retry=g,this.isUsingEmulator=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((x,f)=>{this.resolve_=x,this.reject_=f,this.start_()})}start_(){const e=(s,n)=>{if(n){s(!1,new Ma(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const l=i.getErrorCode()===ai.NO_ERROR,c=i.getStatus();if(!l||Tb(c,this.additionalRetryCodes_)&&this.retry){const u=i.getErrorCode()===ai.ABORT;s(!1,new Ma(!1,null,u));return}const d=this.successCodes_.indexOf(c)!==-1;s(!0,new Ma(d,i))})},r=(s,n)=>{const i=this.resolve_,o=this.reject_,l=n.connection;if(n.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());wb(c)?i(c):i()}catch(c){o(c)}else if(l!==null){const c=hb();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(n.canceled){const c=this.appDelete_?Sm():mb();o(c)}else{const c=gb();o(c)}};this.canceled_?r(!1,new Ma(!1,null,!0)):this.backoffId_=bb(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&vb(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ma{constructor(e,r,s){this.wasSuccessCode=e,this.connection=r,this.canceled=!!s}}function Sb(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function jb(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function _b(t,e){e&&(t["X-Firebase-GMPID"]=e)}function Db(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function Cb(t,e,r,s,n,i,o=!0,l=!1){const c=kb(t.urlParams),d=t.url+c,u=Object.assign({},t.headers);return _b(u,e),Sb(u,r),jb(u,i),Db(u,s),new Nb(d,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function Ib(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,r){this._service=e,r instanceof rr?this._location=r:this._location=rr.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new ii(e,r)}get root(){const e=new rr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Ib(this._location.path)}get storage(){return this._service}get parent(){const e=Eb(this._location.path);if(e===null)return null;const r=new rr(this._location.bucket,e);return new ii(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw yb(e)}}function Zd(t,e){const r=e?.[cb];return r==null?null:rr.makeFromBucketSpec(r,t)}function Ab(t,e,r,s={}){t.host=`${e}:${r}`;const n=ac(e);n&&(im(`https://${t.host}/b`),om("Storage",!0)),t._isUsingEmulator=!0,t._protocol=n?"https":"http";const{mockUserToken:i}=s;i&&(t._overrideAuthToken=typeof i=="string"?i:lm(i,t.app.options.projectId))}class Rb{constructor(e,r,s,n,i,o=!1){this.app=e,this._authProvider=r,this._appCheckProvider=s,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=Nm,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=db,this._maxUploadRetryTime=ub,this._requests=new Set,n!=null?this._bucket=rr.makeFromBucketSpec(n,this._host):this._bucket=Zd(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=rr.makeFromBucketSpec(this._url,e):this._bucket=Zd(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Jd("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Jd("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){if(nm(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ii(this,e)}_makeRequest(e,r,s,n,i=!0){if(this._deleted)return new xb(Sm());{const o=Cb(e,this._appId,s,n,r,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,r){const[s,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,s,n).getPromise()}}const eu="@firebase/storage",tu="0.13.14";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm="storage";function Pb(t=nc(),e){t=br(t);const s=ya(t,jm).getImmediate({identifier:e}),n=am("storage");return n&&Mb(s,...n),s}function Mb(t,e,r,s={}){Ab(t,e,r,s)}function Ob(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),n=t.getProvider("app-check-internal");return new Rb(r,s,n,e,rc)}function Lb(){Xn(new Qn(jm,Ob,"PUBLIC").setMultipleInstances(!0)),Kr(eu,tu,""),Kr(eu,tu,"esm2017")}Lb();const _m="@firebase/installations",uc="0.6.18";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dm=1e4,Cm=`w:${uc}`,Em="FIS_v2",$b="https://firebaseinstallations.googleapis.com/v1",Fb=3600*1e3,Wb="installations",Vb="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ub={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},vs=new cm(Wb,Vb,Ub);function Im(t){return t instanceof sc&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am({projectId:t}){return`${$b}/projects/${t}/installations`}function Rm(t){return{token:t.token,requestStatus:2,expiresIn:Hb(t.expiresIn),creationTime:Date.now()}}async function Pm(t,e){const s=(await e.json()).error;return vs.create("request-failed",{requestName:t,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function Mm({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function Bb(t,{refreshToken:e}){const r=Mm(t);return r.append("Authorization",Gb(e)),r}async function Om(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Hb(t){return Number(t.replace("s","000"))}function Gb(t){return`${Em} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zb({appConfig:t,heartbeatServiceProvider:e},{fid:r}){const s=Am(t),n=Mm(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const o={fid:r,authVersion:Em,appId:t.appId,sdkVersion:Cm},l={method:"POST",headers:n,body:JSON.stringify(o)},c=await Om(()=>fetch(s,l));if(c.ok){const d=await c.json();return{fid:d.fid||r,registrationStatus:2,refreshToken:d.refreshToken,authToken:Rm(d.authToken)}}else throw await Pm("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb=/^[cdef][\w-]{21}$/,al="";function qb(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const r=Xb(t);return Yb.test(r)?r:al}catch{return al}}function Xb(t){return Kb(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $m=new Map;function Fm(t,e){const r=Wi(t);Wm(r,e),Qb(r,e)}function Wm(t,e){const r=$m.get(t);if(r)for(const s of r)s(e)}function Qb(t,e){const r=Jb();r&&r.postMessage({key:t,fid:e}),Zb()}let os=null;function Jb(){return!os&&"BroadcastChannel"in self&&(os=new BroadcastChannel("[Firebase] FID Change"),os.onmessage=t=>{Wm(t.data.key,t.data.fid)}),os}function Zb(){$m.size===0&&os&&(os.close(),os=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ev="firebase-installations-database",tv=1,ws="firebase-installations-store";let xo=null;function hc(){return xo||(xo=xx(ev,tv,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(ws)}}})),xo}async function oi(t,e){const r=Wi(t),n=(await hc()).transaction(ws,"readwrite"),i=n.objectStore(ws),o=await i.get(r);return await i.put(e,r),await n.done,(!o||o.fid!==e.fid)&&Fm(t,e.fid),e}async function Vm(t){const e=Wi(t),s=(await hc()).transaction(ws,"readwrite");await s.objectStore(ws).delete(e),await s.done}async function Vi(t,e){const r=Wi(t),n=(await hc()).transaction(ws,"readwrite"),i=n.objectStore(ws),o=await i.get(r),l=e(o);return l===void 0?await i.delete(r):await i.put(l,r),await n.done,l&&(!o||o.fid!==l.fid)&&Fm(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gc(t){let e;const r=await Vi(t.appConfig,s=>{const n=rv(s),i=sv(t,n);return e=i.registrationPromise,i.installationEntry});return r.fid===al?{installationEntry:await e}:{installationEntry:r,registrationPromise:e}}function rv(t){const e=t||{fid:qb(),registrationStatus:0};return Um(e)}function sv(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const n=Promise.reject(vs.create("app-offline"));return{installationEntry:e,registrationPromise:n}}const r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=nv(t,r);return{installationEntry:r,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:av(t)}:{installationEntry:e}}async function nv(t,e){try{const r=await zb(t,e);return oi(t.appConfig,r)}catch(r){throw Im(r)&&r.customData.serverCode===409?await Vm(t.appConfig):await oi(t.appConfig,{fid:e.fid,registrationStatus:0}),r}}async function av(t){let e=await ru(t.appConfig);for(;e.registrationStatus===1;)await Lm(100),e=await ru(t.appConfig);if(e.registrationStatus===0){const{installationEntry:r,registrationPromise:s}=await gc(t);return s||r}return e}function ru(t){return Vi(t,e=>{if(!e)throw vs.create("installation-not-found");return Um(e)})}function Um(t){return iv(t)?{fid:t.fid,registrationStatus:0}:t}function iv(t){return t.registrationStatus===1&&t.registrationTime+Dm<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ov({appConfig:t,heartbeatServiceProvider:e},r){const s=lv(t,r),n=Bb(t,r),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const o={installation:{sdkVersion:Cm,appId:t.appId}},l={method:"POST",headers:n,body:JSON.stringify(o)},c=await Om(()=>fetch(s,l));if(c.ok){const d=await c.json();return Rm(d)}else throw await Pm("Generate Auth Token",c)}function lv(t,{fid:e}){return`${Am(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mc(t,e=!1){let r;const s=await Vi(t.appConfig,i=>{if(!Bm(i))throw vs.create("not-registered");const o=i.authToken;if(!e&&uv(o))return i;if(o.requestStatus===1)return r=cv(t,e),i;{if(!navigator.onLine)throw vs.create("app-offline");const l=gv(i);return r=dv(t,l),l}});return r?await r:s.authToken}async function cv(t,e){let r=await su(t.appConfig);for(;r.authToken.requestStatus===1;)await Lm(100),r=await su(t.appConfig);const s=r.authToken;return s.requestStatus===0?mc(t,e):s}function su(t){return Vi(t,e=>{if(!Bm(e))throw vs.create("not-registered");const r=e.authToken;return mv(r)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function dv(t,e){try{const r=await ov(t,e),s=Object.assign(Object.assign({},e),{authToken:r});return await oi(t.appConfig,s),r}catch(r){if(Im(r)&&(r.customData.serverCode===401||r.customData.serverCode===404))await Vm(t.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await oi(t.appConfig,s)}throw r}}function Bm(t){return t!==void 0&&t.registrationStatus===2}function uv(t){return t.requestStatus===2&&!hv(t)}function hv(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Fb}function gv(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function mv(t){return t.requestStatus===1&&t.requestTime+Dm<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fv(t){const e=t,{installationEntry:r,registrationPromise:s}=await gc(e);return s?s.catch(console.error):mc(e).catch(console.error),r.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pv(t,e=!1){const r=t;return await yv(r),(await mc(r,e)).token}async function yv(t){const{registrationPromise:e}=await gc(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xv(t){if(!t||!t.options)throw bo("App Configuration");if(!t.name)throw bo("App Name");const e=["projectId","apiKey","appId"];for(const r of e)if(!t.options[r])throw bo(r);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function bo(t){return vs.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hm="installations",bv="installations-internal",vv=t=>{const e=t.getProvider("app").getImmediate(),r=xv(e),s=ya(e,"heartbeat");return{app:e,appConfig:r,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},wv=t=>{const e=t.getProvider("app").getImmediate(),r=ya(e,Hm).getImmediate();return{getId:()=>fv(r),getToken:n=>pv(r,n)}};function kv(){Xn(new Qn(Hm,vv,"PUBLIC")),Xn(new Qn(bv,wv,"PRIVATE"))}kv();Kr(_m,uc);Kr(_m,uc,"esm2017");const vo="@firebase/remote-config",nu="0.6.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm="remote-config",au=100;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tv={"already-initialized":"Remote Config already initialized","registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser","custom-signal-max-allowed-signals":"Setting more than {$maxSignals} custom signals is not supported."},Ot=new cm("remoteconfig","Remote Config",Tv);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(t=nc(),e={}){var r,s;t=br(t);const n=ya(t,Gm);if(n.isInitialized()){const o=n.getOptions();if(hm(o,e))return n.getImmediate();throw Ot.create("already-initialized")}n.initialize({options:e});const i=n.getImmediate();return e.initialFetchResponse&&(i._initializePromise=Promise.all([i._storage.setLastSuccessfulFetchResponse(e.initialFetchResponse),i._storage.setActiveConfigEtag(((r=e.initialFetchResponse)===null||r===void 0?void 0:r.eTag)||""),i._storageCache.setLastSuccessfulFetchTimestampMillis(Date.now()),i._storageCache.setLastFetchStatus("success"),i._storageCache.setActiveConfig(((s=e.initialFetchResponse)===null||s===void 0?void 0:s.config)||{})]).then(),i._isInitializationComplete=!0),i}function Sv(t){const e=br(t);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(e,r,s,n){this.client=e,this.storage=r,this.storageCache=s,this.logger=n}isCachedDataFresh(e,r){if(!r)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const s=Date.now()-r,n=s<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${s}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${n}.`),n}async fetch(e){const[r,s]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(s&&this.isCachedDataFresh(e.cacheMaxAgeMillis,r))return s;e.eTag=s&&s.eTag;const n=await this.client.fetch(e),i=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return n.status===200&&i.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(i),n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _v(t=navigator){return t.languages&&t.languages[0]||t.language}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(e,r,s,n,i,o){this.firebaseInstallations=e,this.sdkVersion=r,this.namespace=s,this.projectId=n,this.apiKey=i,this.appId=o}async fetch(e){const[r,s]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,o={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},l={sdk_version:this.sdkVersion,app_instance_id:r,app_instance_id_token:s,app_id:this.appId,language_code:_v(),custom_signals:e.customSignals},c={method:"POST",headers:o,body:JSON.stringify(l)},d=fetch(i,c),u=new Promise((y,w)=>{e.signal.addEventListener(()=>{const v=new Error("The operation was aborted.");v.name="AbortError",w(v)})});let h;try{await Promise.race([d,u]),h=await d}catch(y){let w="fetch-client-network";throw y?.name==="AbortError"&&(w="fetch-timeout"),Ot.create(w,{originalErrorMessage:y?.message})}let g=h.status;const m=h.headers.get("ETag")||void 0;let x,f;if(h.status===200){let y;try{y=await h.json()}catch(w){throw Ot.create("fetch-client-parse",{originalErrorMessage:w?.message})}x=y.entries,f=y.state}if(f==="INSTANCE_STATE_UNSPECIFIED"?g=500:f==="NO_CHANGE"?g=304:(f==="NO_TEMPLATE"||f==="EMPTY_CONFIG")&&(x={}),g!==304&&g!==200)throw Ot.create("fetch-status",{httpStatus:g});return{status:g,eTag:m,config:x}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cv(t,e){return new Promise((r,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(r,n);t.addEventListener(()=>{clearTimeout(i),s(Ot.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Ev(t){if(!(t instanceof sc)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class Iv{constructor(e,r){this.client=e,this.storage=r}async fetch(e){const r=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,r)}async attemptFetch(e,{throttleEndTimeMillis:r,backoffCount:s}){await Cv(e.signal,r);try{const n=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),n}catch(n){if(!Ev(n))throw n;const i={throttleEndTimeMillis:Date.now()+vx(s),backoffCount:s+1};return await this.storage.setThrottleMetadata(i),this.attemptFetch(e,i)}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Av=60*1e3,Rv=720*60*1e3;class Pv{get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}constructor(e,r,s,n,i){this.app=e,this._client=r,this._storageCache=s,this._storage=n,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:Av,minimumFetchIntervalMillis:Rv},this.defaultConfig={}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function za(t,e){const r=t.target.error||void 0;return Ot.create(e,{originalErrorMessage:r&&r?.message})}const $r="app_namespace_store",Mv="firebase_remote_config",Ov=1;function Lv(){return new Promise((t,e)=>{try{const r=indexedDB.open(Mv,Ov);r.onerror=s=>{e(za(s,"storage-open"))},r.onsuccess=s=>{t(s.target.result)},r.onupgradeneeded=s=>{const n=s.target.result;switch(s.oldVersion){case 0:n.createObjectStore($r,{keyPath:"compositeKey"})}}}catch(r){e(Ot.create("storage-open",{originalErrorMessage:r?.message}))}})}class zm{getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}getCustomSignals(){return this.get("custom_signals")}}class $v extends zm{constructor(e,r,s,n=Lv()){super(),this.appId=e,this.appName=r,this.namespace=s,this.openDbPromise=n}async setCustomSignals(e){const s=(await this.openDbPromise).transaction([$r],"readwrite"),n=await this.getWithTransaction("custom_signals",s),i=Km(e,n||{});return await this.setWithTransaction("custom_signals",i,s),i}async getWithTransaction(e,r){return new Promise((s,n)=>{const i=r.objectStore($r),o=this.createCompositeKey(e);try{const l=i.get(o);l.onerror=c=>{n(za(c,"storage-get"))},l.onsuccess=c=>{const d=c.target.result;s(d?d.value:void 0)}}catch(l){n(Ot.create("storage-get",{originalErrorMessage:l?.message}))}})}async setWithTransaction(e,r,s){return new Promise((n,i)=>{const o=s.objectStore($r),l=this.createCompositeKey(e);try{const c=o.put({compositeKey:l,value:r});c.onerror=d=>{i(za(d,"storage-set"))},c.onsuccess=()=>{n()}}catch(c){i(Ot.create("storage-set",{originalErrorMessage:c?.message}))}})}async get(e){const s=(await this.openDbPromise).transaction([$r],"readonly");return this.getWithTransaction(e,s)}async set(e,r){const n=(await this.openDbPromise).transaction([$r],"readwrite");return this.setWithTransaction(e,r,n)}async delete(e){const r=await this.openDbPromise;return new Promise((s,n)=>{const o=r.transaction([$r],"readwrite").objectStore($r),l=this.createCompositeKey(e);try{const c=o.delete(l);c.onerror=d=>{n(za(d,"storage-delete"))},c.onsuccess=()=>{s()}}catch(c){n(Ot.create("storage-delete",{originalErrorMessage:c?.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class Fv extends zm{constructor(){super(...arguments),this.storage={}}async get(e){return Promise.resolve(this.storage[e])}async set(e,r){return this.storage[e]=r,Promise.resolve(void 0)}async delete(e){return this.storage[e]=void 0,Promise.resolve()}async setCustomSignals(e){const r=this.storage.custom_signals||{};return this.storage.custom_signals=Km(e,r),Promise.resolve(this.storage.custom_signals)}}function Km(t,e){const r=Object.assign(Object.assign({},e),t),s=Object.fromEntries(Object.entries(r).filter(([n,i])=>i!==null).map(([n,i])=>typeof i=="number"?[n,i.toString()]:[n,i]));if(Object.keys(s).length>au)throw Ot.create("custom-signal-max-allowed-signals",{maxSignals:au});return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}getCustomSignals(){return this.customSignals}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),r=this.storage.getLastSuccessfulFetchTimestampMillis(),s=this.storage.getActiveConfig(),n=this.storage.getCustomSignals(),i=await e;i&&(this.lastFetchStatus=i);const o=await r;o&&(this.lastSuccessfulFetchTimestampMillis=o);const l=await s;l&&(this.activeConfig=l);const c=await n;c&&(this.customSignals=c)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}async setCustomSignals(e){this.customSignals=await this.storage.setCustomSignals(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vv(){Xn(new Qn(Gm,t,"PUBLIC").setMultipleInstances(!0)),Kr(vo,nu),Kr(vo,nu,"esm2017");function t(e,{options:r}){const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate(),{projectId:i,apiKey:o,appId:l}=s.options;if(!i)throw Ot.create("registration-project-id");if(!o)throw Ot.create("registration-api-key");if(!l)throw Ot.create("registration-app-id");const c=r?.templateId||"firebase",d=bx()?new $v(l,s.name,c):new Fv,u=new Wv(d),h=new dm(vo);h.logLevel=um.ERROR;const g=new Dv(n,rc,c,i,o,l),m=new Iv(g,d),x=new jv(m,d,u,h),f=new Pv(s,x,u,d,h);return Sv(f),f}}Vv();const ne={log:(t,e)=>{},warn:(t,e)=>{},error:(t,e)=>{console.error(t,e?.message||e)},info:(t,e)=>{},time:t=>{},timeEnd:t=>{}},il={apiKey:"AIzaSyD8aBPw-o13mciSdV8gzRJN6TfaAy3OoWg",authDomain:"todolist-116f3.firebaseapp.com",databaseURL:"https://todolist-116f3-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"todolist-116f3",storageBucket:"todolist-116f3.firebasestorage.app",messagingSenderId:"470825187407",appId:"1:470825187407:web:4bd3f8c621c96890b2d23a",measurementId:"G-HS8CDYHDT1"},Uv=()=>{const t=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"];for(const e of t)if(!il[e])throw new Error(`Firebase configuration missing: ${e}`);if(!il.apiKey.startsWith("AIzaSy"))throw new Error("Invalid Firebase API key format")};let Qs;try{Uv();const t=gm();t.length===0?(Qs=mm(il),ne.log("Firebase app initialized")):(Qs=t[0],ne.log("Using existing Firebase app"))}catch(t){throw ne.error("Firebase initialization failed:",t),t}const jt=wx(Qs),Z=kx(Qs);Pb(Qs);const Bv=Nv(Qs);Bv.settings.minimumFetchIntervalMillis=36e5;const ba=new Ps;ba.addScope("email");ba.addScope("profile");ba.addScope("https://www.googleapis.com/auth/userinfo.email");ba.addScope("https://www.googleapis.com/auth/userinfo.profile");ba.setCustomParameters({prompt:"select_account"});const Hv=()=>{};try{Hv(),ne.log("Firebase í”„ë¡œë•ì…˜ ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ")}catch(t){ne.error("Firebase security validation failed:",t)}class Tr extends Error{constructor(e,r="UNKNOWN_ERROR",s){super(e),this.code=r,this.originalError=s,this.name="TodoError"}}const Os=(t,e)=>{if(t&&typeof t=="object"&&"code"in t){const r=t;switch(r.code){case"permission-denied":return new Tr("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.","PERMISSION_DENIED",t);case"not-found":return new Tr("ìš”ì²­í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","NOT_FOUND",t);case"unavailable":return new Tr("ì„œë²„ì— ì¼ì‹œì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.","UNAVAILABLE",t);case"failed-precondition":return new Tr("ë°ì´í„° ìƒíƒœê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.","FAILED_PRECONDITION",t);case"already-exists":return new Tr("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ì…ë‹ˆë‹¤.","ALREADY_EXISTS",t);default:return new Tr(`${e} ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${r.message}`,r.code||"FIRESTORE_ERROR",t)}}return t instanceof Error?new Tr(`${e} ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${t.message}`,"GENERAL_ERROR",t):new Tr(`${e} ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`,"UNKNOWN_ERROR",t)},Gv=t=>["unavailable","deadline-exceeded","internal","NETWORK_ERROR"].includes(t.code.toLowerCase()),kr=async(t,e=3,r=1e3)=>{let s;for(let n=1;n<=e;n++)try{return await t()}catch(i){const o=i instanceof Tr?i:Os(i,"Operation");if(s=o,!Gv(o)||n===e)throw o;const l=r*Math.pow(2,n-1);await new Promise(c=>setTimeout(c,l))}throw s},ve=t=>{if(t){if(t instanceof Date)return t;if(typeof t?.toDate=="function")return t.toDate();if(typeof t=="string")return new Date(t)}},hr=t=>{if(t==null)return t;if(Array.isArray(t))return t.map(hr);if(t instanceof Date)return t;if(typeof t=="object"){const e={};return Object.keys(t).forEach(r=>{const s=t[r];s!==void 0&&(e[r]=hr(s))}),e}return t},zv=(t,e,r)=>{switch(r){case"same_date":return t.toDateString()===e.toDateString();case"same_week":const s=new Date(t);s.setDate(t.getDate()-t.getDay());const n=new Date(e);return n.setDate(e.getDate()-e.getDay()),s.toDateString()===n.toDateString();case"same_month":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth();default:return!1}},Kv=t=>{const r=new Date(t.getFullYear(),t.getMonth(),1).getDay();return Math.ceil((t.getDate()+r)/7)},Yv=t=>{const e=t.getFullYear(),r=t.getMonth(),s=t.getDay(),n=new Date(e,r+1,0);for(let i=n.getDate();i>=1;i--)if(new Date(e,r,i).getDay()===s)return t.getDate()===i;return!1},qv=(t,e,r,s)=>{const n=e-1;if(r==="last"){const i=new Date(t,n+1,0);for(let o=i.getDate();o>=1;o--){const l=new Date(t,n,o);if(l.getDay()===s)return l}}else{const o={first:1,second:2,third:3,fourth:4}[r];let l=0;const c=new Date(t,n+1,0).getDate();for(let d=1;d<=c;d++){const u=new Date(t,n,d);if(u.getDay()===s&&(l++,l===o))return u}}return null},Xv=(t,e="show",r=[])=>{let s=new Date(t);if(e==="show")return s;const n=ni(s,r),i=Br(s);if(!n&&!i)return s;let o=0;for(;o<15;){e==="before"?s.setDate(s.getDate()-1):s.setDate(s.getDate()+1);const l=ni(s,r),c=Br(s);if(!l&&!c)break;o++}return s},te={getTodos:async t=>kr(async()=>{try{if(!t)throw new Error("User ID is required");const e=Pe(Z,`users/${t}/todos`),r=He(e,Gt("createdAt","desc")),n=(await Ge(r)).docs.map(f=>{const y=f.data();return{...y,id:f.id,createdAt:ve(y.createdAt)||new Date,updatedAt:ve(y.updatedAt)||new Date,dueDate:ve(y.dueDate),startDate:ve(y.startDate),completedAt:ve(y.completedAt),subTasks:y.subTasks?y.subTasks.map(w=>({...w,createdAt:ve(w.createdAt)||new Date,updatedAt:ve(w.updatedAt)||new Date,completedAt:w.completedAt?ve(w.completedAt):null})):[],myPermission:"admin"}}),i=Pe(Z,"shared_todos"),o=He(i,We("ownerId","==",t)),l=He(i,We("sharedWithUids","array-contains",t)),[c,d]=await Promise.all([Ge(o),Ge(l)]),u=f=>{const y=f.data();let w="read";if(y.ownerId===t)w="admin";else if(y.sharedWith){const v=y.sharedWith.find(k=>k.uid===t);v&&(w=v.permission)}return{...y,id:f.id,createdAt:ve(y.createdAt)||new Date,updatedAt:ve(y.updatedAt)||new Date,dueDate:ve(y.dueDate),startDate:ve(y.startDate),completedAt:ve(y.completedAt),subTasks:y.subTasks?y.subTasks.map(v=>({...v,createdAt:ve(v.createdAt)||new Date,updatedAt:ve(v.updatedAt)||new Date,completedAt:v.completedAt?ve(v.completedAt):null})):[],myPermission:w}},h=[...c.docs,...d.docs],g=new Map;h.forEach(f=>{g.has(f.id)||g.set(f.id,u(f))});const m=Array.from(g.values());return ne.log("Firestore getTodos ì„±ê³µ:",{private:n.length,shared:m.length,uid:t}),[...n,...m].sort((f,y)=>{const w=f.createdAt instanceof Date?f.createdAt.getTime():0;return(y.createdAt instanceof Date?y.createdAt.getTime():0)-w})}catch(e){throw ne.error("Firestore getTodos ì‹¤íŒ¨:",e),Os(e,"getTodos")}}),addTodo:async(t,e)=>kr(async()=>{try{if(!e||!t.title?.trim())throw new Error("User ID and todo title are required");const r=t.visibility?.isShared||!1,s=r?"shared_todos":`users/${e}/todos`,n=Pe(Z,s);console.log("ğŸ“¤ addTodo called:",{isShared:r,collectionPath:s,sharedWith:t.sharedWith,sharedWithUids:t.sharedWith?.map(m=>m.uid)||[],sharedWithCount:t.sharedWith?.length||0,sharedGroupId:t.sharedGroupId,ownerId:e});const i=hr(t),o=t.sharedWith?t.sharedWith.map(m=>m.uid):[],l=t.sharedWith?t.sharedWith.filter(m=>m.permission==="edit"||m.permission==="admin").map(m=>m.uid):[];let c=t.sharedWith?t.sharedWith.filter(m=>m.permission==="admin").map(m=>m.uid):[];const d=t.sharedGroupId,u=t.sharedGroupOwnerId;if(r&&d&&u)try{const m=Ee(Z,`users/${u}/sharing_groups`,d),x=await Tt(m);if(x.exists()){const y=(x.data().members||[]).filter(w=>w.permission==="admin").map(w=>w.uid);c=[...new Set([...c,...y])],console.log("ğŸ“‹ ê³µìœ  ê·¸ë£¹ admin í¬í•¨:",y)}}catch(m){console.warn("âš ï¸ ê³µìœ  ê·¸ë£¹ admin ì¡°íšŒ ì‹¤íŒ¨:",m)}c.includes(e)||c.push(e);const h={...i,ownerId:e,sharedWithUids:o,editorUids:l,adminUids:c,createdAt:Re(),updatedAt:Re()},g=await Lr(n,h);return ne.log(`Firestore addTodo ì„±ê³µ (${r?"Shared":"Private"}):`,g.id),g.id}catch(r){throw ne.error("Firestore addTodo ì‹¤íŒ¨:",r),Os(r,"addTodo")}}),updateTodo:async(t,e,r)=>{let s=!1,n=!1;try{const i=Ee(Z,`users/${r}/todos`,t),o=Ee(Z,"shared_todos",t);ne.log(`Trying to read private todo: ${t} at ${i.path}`);const l=await Tt(i);let c;if(l.exists())s=!0;else try{ne.log(`Trying to read shared todo: ${t} at ${o.path}`),c=await Tt(o),n=c.exists()}catch(x){if(x.code==="permission-denied")ne.warn(`Shared todo permission denied (treated as not found): ${t}`),n=!1;else throw x}if(!s&&!n){ne.warn(`í• ì¼ ë¬¸ì„œ ${t}ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì—…ë°ì´íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.`);return}const d=s?i:o,u=s?l.data():c.data(),h=e.visibility,g=h?.isShared;if(s&&g===!0||n&&g===!1&&h!==void 0){const x=d,f=s?Ee(Z,"shared_todos",t):Ee(Z,`users/${r}/todos`,t),y=e.sharedWith?e.sharedWith.map(b=>b.uid):u.sharedWith?u.sharedWith.map(b=>b.uid):[],w=e.sharedWith?e.sharedWith.filter(b=>b.permission==="edit"||b.permission==="admin").map(b=>b.uid):u.sharedWith?u.sharedWith.filter(b=>b.permission==="edit"||b.permission==="admin").map(b=>b.uid):[],v={...u,...e,ownerId:u.ownerId||r,sharedWithUids:y,editorUids:w,adminUids:e.sharedWith?e.sharedWith.filter(b=>b.permission==="admin").map(b=>b.uid):u.sharedWith?u.sharedWith.filter(b=>b.permission==="admin").map(b=>b.uid):[],updatedAt:Re()},k=Vt(Z);k.set(f,v),k.delete(x),await k.commit(),ne.log(`Todo migrated: ${s?"Private -> Shared":"Shared -> Private"}`)}else{const x={...e};e.sharedWith&&(x.sharedWithUids=e.sharedWith.map(w=>w.uid),x.editorUids=e.sharedWith.filter(w=>w.permission==="edit"||w.permission==="admin").map(w=>w.uid),x.adminUids=e.sharedWith.filter(w=>w.permission==="admin").map(w=>w.uid));const y={...hr(x),updatedAt:Re()};n&&(y.lastModifiedBy=r),await wt(d,y),ne.log(`Firestore updateTodo ì„±ê³µ (${t})`)}}catch(i){throw ne.error("Firestore updateTodo ì‹¤íŒ¨:",{error:i,context:JSON.stringify({id:t,uid:r,targetPath:s?`users/${r}/todos/${t}`:`shared_todos/${t}`,isPrivate:s,isShared:n})}),i}},deleteTodo:async(t,e)=>{try{console.log("ğŸ—‘ï¸ deleteTodo ì‹œì‘:",{id:t,uid:e});const r=Ee(Z,`users/${e}/todos`,t),s=Ee(Z,"shared_todos",t);let n=0;(await Tt(r)).exists()&&(await Jt(r),console.log("âœ… ê°œì¸ í• ì¼ ì‚­ì œ ì™„ë£Œ:",t),n++);const o=await Tt(s);if(o.exists()){const l=o.data();let c=(l.adminUids||[]).includes(e);if(!c&&l.sharedGroupId&&l.sharedGroupOwnerId)try{const d=Ee(Z,`users/${l.sharedGroupOwnerId}/sharing_groups`,l.sharedGroupId),u=await Tt(d);if(u.exists()&&(c=(u.data().members||[]).filter(m=>m.permission==="admin").some(m=>m.uid===e),c)){const m=[...new Set([...l.adminUids||[],e])];await wt(s,{adminUids:m}),console.log("ğŸ“‹ adminUids ì—…ë°ì´íŠ¸ë¨:",m)}}catch(d){console.warn("âš ï¸ ê·¸ë£¹ admin í™•ì¸ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰):",d)}if(l.ownerId===e||c){const d=l.visibility?.isPersonal===!0,u=l.ownerId!==e;d&&u?(await wt(s,{"visibility.isShared":!1,sharedWith:[],sharedWithUids:[],editorUids:[],adminUids:[l.ownerId],updatedAt:Re()}),console.log("âœ… ê³µìœ  í•´ì œë¨ - ì†Œìœ ì ì „ìš©ìœ¼ë¡œ ë³€ê²½:",t)):(await Jt(s),console.log("âœ… ê³µìœ  í• ì¼ ì˜êµ¬ ì‚­ì œ ì™„ë£Œ (ì†Œìœ ì/ê´€ë¦¬ì):",t))}else{const d=(l.sharedWithUids||[]).filter(m=>m!==e),u=(l.sharedWith||[]).filter(m=>m.uid!==e),h=(l.editorUids||[]).filter(m=>m!==e),g=(l.adminUids||[]).filter(m=>m!==e);await wt(s,{sharedWithUids:d,sharedWith:u,editorUids:h,adminUids:g,updatedAt:Re()}),console.log("âœ… ê³µìœ  í• ì¼ ë‚˜ê°€ê¸° ì™„ë£Œ (ë¹„ì†Œìœ ì):",t)}n++}n===0&&console.warn("âš ï¸ ì‚­ì œí•  í• ì¼ì„ Firestoreì—ì„œ ì°¾ì§€ ëª»í•¨ (ì´ë¯¸ ì‚­ì œë¨?):",t)}catch(r){throw console.error("âŒ Firestore deleteTodo ì‹¤íŒ¨:",r),r}},subscribeTodos:(t,e)=>{try{let r=[],s=[],n=()=>{};const i=()=>{const N=[...r,...s].sort((T,_)=>{const P=T.createdAt instanceof Date?T.createdAt.getTime():0;return(_.createdAt instanceof Date?_.createdAt.getTime():0)-P});e(N)},o=Pe(Z,`users/${t}/todos`),l=new Date;l.setDate(l.getDate()-7);const c=He(o,We("completed","==",!1)),d=He(o,We("completed","==",!0),We("completedAt",">=",l));let u=[],h=[];const g=()=>{const N=[...u,...h],T=new Map;N.forEach(_=>T.set(_.id,_)),r=Array.from(T.values()),i()},m=N=>{const T=N.data();return{...T,id:N.id,createdAt:ve(T.createdAt)||new Date,updatedAt:ve(T.updatedAt)||new Date,dueDate:ve(T.dueDate),startDate:ve(T.startDate),completedAt:ve(T.completedAt),subTasks:T.subTasks?T.subTasks.map(_=>({..._,createdAt:ve(_.createdAt)||new Date,updatedAt:ve(_.updatedAt)||new Date,completedAt:_.completedAt?ve(_.completedAt):null})):[],myPermission:"admin"}},x=Rt(c,N=>{u=N.docs.map(m),g()},N=>console.error("âŒ Active Todos êµ¬ë… ì˜¤ë¥˜:",N)),f=Rt(d,N=>{h=N.docs.map(m),g()},N=>console.error("âŒ Recent Todos êµ¬ë… ì˜¤ë¥˜:",N)),y=()=>{x(),f()};let w=[],v=[],k=()=>{},b=()=>{};const j=()=>{const N=[...w,...v],T=new Map;N.forEach(_=>T.set(_.id,_)),s=Array.from(T.values()),i()},D=N=>{const T=N.data();let _="read";if(T.ownerId===t)_="admin";else if(T.sharedWith){const P=T.sharedWith.find(C=>C.uid===t);P&&(_=P.permission)}return{...T,id:N.id,createdAt:ve(T.createdAt)||new Date,updatedAt:ve(T.updatedAt)||new Date,dueDate:ve(T.dueDate),startDate:ve(T.startDate),completedAt:ve(T.completedAt),subTasks:T.subTasks?T.subTasks.map(P=>({...P,createdAt:ve(P.createdAt)||new Date,updatedAt:ve(P.updatedAt)||new Date,completedAt:P.completedAt?ve(P.completedAt):null})):[],myPermission:_}};try{const N=Pe(Z,"shared_todos"),T=He(N,We("ownerId","==",t));k=Rt(T,P=>{w=P.docs.map(D),j()},P=>{console.error("âŒ ë‚´ ê³µìœ  í• ì¼ êµ¬ë… ì˜¤ë¥˜:",P)});const _=He(N,We("sharedWithUids","array-contains",t));b=Rt(_,P=>{v=P.docs.map(D),j()},P=>{console.error("âŒ ê³µìœ ë°›ì€ í• ì¼ êµ¬ë… ì˜¤ë¥˜:",P)}),n=()=>{k(),b()}}catch(N){console.error("âŒ ê³µìœ  í• ì¼ ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨:",N)}return()=>{y(),n()}}catch(r){return console.error("âŒ Firestore subscribeTodos ì´ˆê¸°í™” ì‹¤íŒ¨:",r),e([]),()=>{}}},getCompletedTodos:async(t,e,r)=>{try{const s=Pe(Z,`users/${t}/todos`),n=new Date(e);n.setHours(0,0,0,0);const i=new Date(r);i.setHours(23,59,59,999);const o=He(s,We("completed","==",!0),We("completedAt",">=",n),We("completedAt","<=",i));return(await Ge(o)).docs.map(c=>{const d=c.data();return{...d,id:c.id,createdAt:ve(d.createdAt)||new Date,updatedAt:ve(d.updatedAt)||new Date,dueDate:ve(d.dueDate),startDate:ve(d.startDate),completedAt:ve(d.completedAt),subTasks:d.subTasks?d.subTasks.map(u=>({...u,createdAt:ve(u.createdAt)||new Date,updatedAt:ve(u.updatedAt)||new Date,completedAt:u.completedAt?ve(u.completedAt):null})):[],myPermission:"admin"}})}catch(s){return console.error("âŒ getCompletedTodos ì‹¤íŒ¨:",s),[]}},addSubTask:async(t,e,r)=>{const s=Ee(Z,`users/${e}/todos`,r);await wt(s,{subTasks:Od(t),updatedAt:Re()})},updateSubTask:async(t,e,r,s)=>{const n=Ee(Z,`users/${r}/todos`,s),i=await Tt(n);if(!i.exists())throw new Error("í• ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const c=(i.data().subTasks||[]).map(d=>d.id===t?{...d,...e,updatedAt:new Date}:d);await wt(n,{subTasks:c,updatedAt:Re()})},deleteSubTask:async(t,e,r)=>{const s=Ee(Z,`users/${e}/todos`,r),n=await Tt(s);if(!n.exists())throw new Error("í• ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const l=(n.data().subTasks||[]).filter(c=>c.id!==t);await wt(s,{subTasks:l,updatedAt:Re()})},getRecurringTemplates:async t=>{const e=Pe(Z,`users/${t}/recurringTemplates`),r=He(e,Gt("createdAt","desc"));return(await Ge(r)).docs.map(n=>({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate()||new Date,updatedAt:n.data().updatedAt?.toDate()||new Date}))},addRecurringTemplate:async(t,e)=>{const r=Pe(Z,`users/${e}/recurringTemplates`),n={...hr(t),createdAt:Re(),updatedAt:Re()};return(await Lr(r,n)).id},updateRecurringTemplate:async(t,e,r)=>{const s=Ee(Z,`users/${r}/recurringTemplates`,t),n=hr(e);await wt(s,{...n,updatedAt:Re()})},deleteRecurringTemplate:async(t,e)=>{const r=Vt(Z),s=Ee(Z,`users/${e}/recurringTemplates`,t);r.delete(s);const n=Pe(Z,`users/${e}/recurringInstances`),i=He(n,We("templateId","==",t));(await Ge(i)).forEach(l=>r.delete(l.ref)),await r.commit()},subscribeProjectTemplates:(t,e)=>{try{const r=Pe(Z,`users/${t}/projectTemplates`),s=He(r,Gt("createdAt","desc"));return Rt(s,i=>{const o=i.docs.map(l=>{const c=l.data();return{id:l.id,...c,createdAt:ve(c.createdAt)||new Date,updatedAt:ve(c.updatedAt)||new Date}});e(o)},i=>{console.error("í”„ë¡œì íŠ¸ í…œí”Œë¦¿ êµ¬ë… ì˜¤ë¥˜:",i),e([])})}catch(r){return console.error("í”„ë¡œì íŠ¸ í…œí”Œë¦¿ êµ¬ë… ì´ˆê¸°í™” ì‹¤íŒ¨:",r),e([]),()=>{}}},addProjectTemplate:async(t,e)=>{const r=Pe(Z,`users/${e}/projectTemplates`),n={...hr(t),createdAt:Re(),updatedAt:Re()};return(await Lr(r,n)).id},updateProjectTemplate:async(t,e,r)=>{const s=Ee(Z,`users/${r}/projectTemplates`,t),n=hr(e);await wt(s,{...n,updatedAt:Re()})},deleteProjectTemplate:async(t,e)=>{const r=Ee(Z,`users/${e}/projectTemplates`,t);await Jt(r)},subscribeRecurringTemplates:(t,e)=>{const r=Pe(Z,`users/${t}/recurringTemplates`),s=He(r,Gt("createdAt","desc"));return Rt(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:ve(o.data().createdAt)||new Date,updatedAt:ve(o.data().updatedAt)||new Date}));e(i)})},getRecurringInstances:async t=>{const e=Pe(Z,`users/${t}/recurringInstances`),r=He(e,Gt("date","asc"));return(await Ge(r)).docs.map(n=>({id:n.id,...n.data(),date:ve(n.data().date)||new Date,createdAt:ve(n.data().createdAt)||new Date,updatedAt:ve(n.data().updatedAt)||new Date,completedAt:ve(n.data().completedAt)}))},addRecurringInstance:async(t,e)=>{const r=Pe(Z,`users/${e}/recurringInstances`),s=hr(t);return(await Lr(r,{...s,createdAt:Re(),updatedAt:Re()})).id},updateRecurringInstance:async(t,e,r)=>{const s=Ee(Z,`users/${r}/recurringInstances`,t),n=hr(e);await wt(s,{...n,updatedAt:Re()})},deleteRecurringInstance:async(t,e)=>{const r=Ee(Z,`users/${e}/recurringInstances`,t);await Jt(r)},subscribeRecurringInstances:(t,e)=>{const r=Pe(Z,`users/${t}/recurringInstances`),s=new Date;s.setDate(s.getDate()-30);const n=He(r,We("completed","==",!1),Gt("date","asc")),i=He(r,We("completed","==",!0),We("date",">=",s),Gt("date","asc"));let o=[],l=[];const c=()=>{const g=[...o,...l];g.sort((m,x)=>{const f=m.date instanceof Date?m.date.getTime():0,y=x.date instanceof Date?x.date.getTime():0;return f-y}),e(g)},d=g=>({id:g.id,...g.data(),date:ve(g.data().date)||new Date,createdAt:ve(g.data().createdAt)||new Date,updatedAt:ve(g.data().updatedAt)||new Date,completedAt:ve(g.data().completedAt)}),u=Rt(n,g=>{o=g.docs.map(d),c()},g=>console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤(Active) êµ¬ë… ì˜¤ë¥˜:",g)),h=Rt(i,g=>{l=g.docs.map(d),c()},g=>console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤(Recent) êµ¬ë… ì˜¤ë¥˜:",g));return()=>{u(),h()}},async _isExceptionDate(t,e,r,s){if(s||!e.exceptions)return!1;for(const n of e.exceptions)switch(n.type){case"date":if(n.values.includes(t.getDate()))return!0;break;case"weekday":if(n.values.includes(t.getDay()))return!0;break;case"week":const i=Kv(t);if(n.values.includes(i)||n.values.includes(-1)&&Yv(t))return!0;break;case"month":if(n.values.includes(t.getMonth()+1))return!0;break;case"conflict":const o=n.values;for(const l of o)if(await this._hasConflictingInstance(t,e.id,l,r))return!0;break}return!1},async _hasConflictingInstance(t,e,r,s){const n=Pe(Z,`users/${s}/recurringTemplates`),i=He(n,We("title","==",r.targetTemplateTitle)),l=(await Ge(i)).docs.find(u=>u.id!==e);if(!l)return!1;const c={id:l.id,...l.data()},d=await this.generateInstancesForTemplate(c,s,!0,[]);for(const u of d)if(zv(t,u.date,r.scope))return ne.log(`[Conflict] ${t.toDateString()} on ${e} conflicts with ${c.title}`),!0;return!1},async generateInstancesForTemplate(t,e,r=!1,s=[]){if(!t.isActive)return[];const n=[],i=new Set,o=new Date,l=new Date(o);l.setFullYear(o.getFullYear()+1);let c=new Date(o.getFullYear(),o.getMonth(),1);for(;c<=l;){let d=null;if(t.recurrenceType==="daily")d=new Date(c);else if(t.recurrenceType==="weekly")c.getDay()===t.weekday&&(d=new Date(c));else if(t.recurrenceType==="monthly"){let u=null;if(t.monthlyPattern==="weekday"&&t.monthlyWeek&&t.monthlyWeekday!==void 0)u=qv(c.getFullYear(),c.getMonth()+1,t.monthlyWeek,t.monthlyWeekday);else{const h=t.monthlyDate;if(h===-1)u=new Date(c.getFullYear(),c.getMonth()+1,0);else if(h===-2)u=wm(c.getFullYear(),c.getMonth()+1);else if(h===-3)u=km(c.getFullYear(),c.getMonth()+1);else if(h&&h>0){const g=new Date(c.getFullYear(),c.getMonth(),h);g.getMonth()===c.getMonth()&&(u=g)}}u&&u.getFullYear()===c.getFullYear()&&u.getMonth()===c.getMonth()&&(d=u)}if(d&&d>=new Date(new Date().setHours(0,0,0,0))){let u=Xv(d,t.holidayHandling,s);if(!await this._isExceptionDate(u,t,e,r)){const g=`${u.getFullYear()}-${(u.getMonth()+1).toString().padStart(2,"0")}-${u.getDate().toString().padStart(2,"0")}`;i.has(g)||(n.push({id:`${t.id}_${g}`,templateId:t.id,date:u,completed:!1,createdAt:new Date,updatedAt:new Date}),i.add(g))}}t.recurrenceType==="monthly"?(c.setMonth(c.getMonth()+1),c.setDate(1)):c.setDate(c.getDate()+1)}return n},async _copyCollection(t,e,r){const s=Pe(Z,`users/${t}/${r}`),n=Pe(Z,`users/${e}/${r}`),i=await Ge(s),o=Vt(Z);i.forEach(l=>{const c=l.data();o.set(Ee(n,l.id),{...c,createdAt:c.createdAt||Re(),updatedAt:Re()})}),await o.commit()},async _deleteCollection(t,e){const r=Pe(Z,`users/${t}/${e}`),s=await Ge(r),n=Vt(Z);s.forEach(i=>{n.delete(i.ref)}),await n.commit()},migrateUserData:async(t,e)=>kr(async()=>{try{if(!t||!e)throw new Error("Old UID and New UID are required for migration.");if(t===e)throw new Error("Cannot migrate data to the same UID.");ne.log(`Starting data migration from old UID: ${t} to new UID: ${e}`),await te._copyCollection(t,e,"todos"),await te._copyCollection(t,e,"recurringTemplates"),await te._copyCollection(t,e,"recurringInstances"),await te._copyCollection(t,e,"projectTemplates"),ne.log(`Deleting old data for UID: ${t}`),await te._deleteCollection(t,"todos"),await te._deleteCollection(t,"recurringTemplates"),await te._deleteCollection(t,"recurringInstances"),await te._deleteCollection(t,"projectTemplates"),ne.log(`User data migrated from ${t} to ${e}`)}catch(r){throw ne.error("Migration failed:",r),Os(r,"migrateUserData")}}),sendSharingInvitation:async(t,e,r,s,n,i)=>kr(async()=>{try{ne.log("sendSharingInvitation: Sending invitation",{fromUser:t.email,toEmail:e,groupId:r,groupName:s});const o=Pe(Z,"sharing_requests"),l=He(o,We("fromUid","==",t.uid),We("toEmail","==",e),We("groupId","==",r),We("status","==","pending"));if(!(await Ge(l)).empty)throw ne.log("sendSharingInvitation: Already invited"),new Error("Already invited this user to this group.");const d={fromUid:t.uid,fromEmail:t.email,toEmail:e,groupId:r,groupName:s,todoId:r,todoTitle:s,shareName:i||"",permission:n,status:"pending",createdAt:Re()};ne.log("sendSharingInvitation: Creating request with data",d);const u=await Lr(o,d);return ne.log("sendSharingInvitation: Invitation sent successfully:",u.id),u.id}catch(o){throw ne.error("sendSharingInvitation: Failed to send invitation:",o),Os(o,"sendSharingInvitation")}}),subscribeToIncomingInvitations:(t,e)=>{try{ne.log("subscribeToIncomingInvitations: Subscribing for email:",t);const r=Pe(Z,"sharing_requests"),s=He(r,We("toEmail","==",t),We("status","==","pending"),Gt("createdAt","desc"));return Rt(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:ve(o.data().createdAt)||new Date}));ne.log("subscribeToIncomingInvitations: Received requests: "+i.length),e(i)},n=>{ne.error("subscribeToIncomingInvitations: Subscription error:",n),e([])})}catch(r){return ne.error("subscribeToIncomingInvitations: Failed to subscribe:",r),e([]),()=>{}}},subscribeToSentInvitations:(t,e)=>{try{const r=Pe(Z,"sharing_requests"),s=He(r,We("fromUid","==",t),Gt("createdAt","desc"));return Rt(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:ve(o.data().createdAt)||new Date}));e(i)},n=>{ne.error("Sent invitation subscription error:",n),e([])})}catch(r){return ne.error("Failed to subscribe sent invitations:",r),e([]),()=>{}}},respondToInvitation:async(t,e,r)=>{try{console.log("ğŸ“© respondToInvitation called:",{requestId:t,response:e,currentUser:r.email});const s=Ee(Z,"sharing_requests",t),n=await Tt(s);if(!n.exists())throw console.error("âŒ Invitation not found:",t),new Error("Invitation not found");const i=n.data();if(console.log("ğŸ“„ Request data:",i),i.toEmail.toLowerCase()!==r.email.toLowerCase())throw console.error("âŒ Not authorized:",i.toEmail,"!==",r.email),new Error("Not authorized to respond to this invitation");if(await wt(s,{status:e,respondedAt:Re()}),console.log("âœ… Request status updated to:",e),e==="accepted"){const o=i.groupId||i.todoId,l=i.fromUid;console.log("ğŸ‘¥ Adding user to group:",{groupId:o,groupOwnerId:l});const c=Ee(Z,`users/${l}/sharing_groups`,o),d=await Tt(c);if(d.exists()){const u=d.data(),h=u.members||[];if(h.some(m=>m.uid===r.uid))console.log("â„¹ï¸ User already in group");else{const m={uid:r.uid,email:r.email,displayName:r.displayName||"",permission:i.permission||"edit"};await wt(c,{members:[...h,m],updatedAt:Re()}),console.log("âœ… Member added to owner group:",r.email)}const g=Ee(Z,`users/${r.uid}/sharing_groups`,`ref_${o}`);await _s(g,{name:u.name,isReference:!0,originalGroupId:o,originalOwnerId:l,originalOwnerEmail:i.fromEmail,members:[...h,{uid:r.uid,email:r.email,displayName:r.displayName||"",permission:i.permission||"edit"}],createdAt:Re(),updatedAt:Re()}),console.log("âœ… Reference group created in my account")}else console.error("âŒ Group not found:",o)}}catch(s){throw console.error("âŒ Failed to respond invitation:",s),s}},regenerateRecurringInstances:async(t,e)=>kr(async()=>{try{if(!e||!t)throw new Error("User ID and template ID are required");ne.log("ì§€ëŠ¥í˜• ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹œì‘",{templateId:t,uid:e});const r=Pe(Z,`users/${e}/recurringInstances`),s=Ee(Z,`users/${e}/recurringTemplates`,t),n=He(r,We("templateId","==",t)),i=await Ge(n),o=new Map;i.forEach(f=>{o.set(f.id,f.data())}),ne.log("ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ ë³´ì¡´ ì™„ë£Œ",{count:o.size});const l=await Tt(s);if(!l.exists())throw new Error(`Template ${t} not found`);const c={id:l.id,...l.data()},d=Pe(Z,`users/${e}/custom_holidays`),h=(await Ge(d)).docs.map(f=>{const y=f.data();return{id:f.id,date:y.date,name:y.name,isRecurring:y.isRecurring,createdAt:y.createdAt}}),g=await te.generateInstancesForTemplate(c,e,!1,h);ne.log("ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ",{count:g.length});const m=Vt(Z),x=new Set;g.forEach(f=>{const y=Ee(r,f.id),w=o.get(f.id);w?(x.add(f.id),m.update(y,{...f,completed:w.completed||!1,completedAt:w.completedAt||null,skipped:w.skipped||!1,skippedReason:w.skippedReason||null,updatedAt:Re()})):(x.add(f.id),m.set(y,{...f,createdAt:Re(),updatedAt:Re()}))}),o.forEach((f,y)=>{if(!x.has(y)){const w=ve(f.date),v=new Date;v.setHours(0,0,0,0),f.completed||w&&w>=v?(m.delete(Ee(r,y)),ne.log("ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ (ì™„ë£Œë¨ ë˜ëŠ” ë¯¸ë˜)",{id:y})):ne.log("ìœ íš¨í•˜ì§€ ì•Šì§€ë§Œ ê³¼ê±°ì˜ ë¯¸ì™„ë£Œëœ ì¸ìŠ¤í„´ìŠ¤ ë³´ì¡´",{id:y})}}),await m.commit(),ne.log("ì§€ëŠ¥í˜• ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì„±ê³µ",{templateId:t})}catch(r){throw ne.error("ì§€ëŠ¥í˜• ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",r),Os(r,"regenerateRecurringInstances")}}),getUserSettings:async t=>kr(async()=>{try{const e=Ee(Z,"users",t),r=await Tt(e);return r.exists()?r.data():null}catch(e){throw ne.error("Firestore getUserSettings ì‹¤íŒ¨:",e),e}}),updateUserLanguage:async(t,e)=>kr(async()=>{try{const r=Ee(Z,"users",t);await _s(r,{language:e,updatedAt:Re()},{merge:!0}),ne.log(`User ${t} language updated to ${e}`)}catch(r){throw ne.error("Firestore updateUserLanguage ì‹¤íŒ¨:",r),r}}),updateGoogleTasksSettings:async(t,e)=>kr(async()=>{try{const r=Ee(Z,"users",t),s={updatedAt:Re()};e.linked!==void 0&&(s.googleTasksLinked=e.linked),e.autoSync!==void 0&&(s.autoSyncGoogleTasks=e.autoSync),await _s(r,s,{merge:!0}),ne.log(`User ${t} Google Tasks settings updated:`,e)}catch(r){throw ne.error("Firestore updateGoogleTasksSettings ì‹¤íŒ¨:",r),r}}),checkAndCreateUser:async t=>{if(!t.uid)return;const e=Ee(Z,"users",t.uid);try{await _s(e,{email:t.email,displayName:t.displayName,lastLoginAt:Re(),updatedAt:Re()},{merge:!0})}catch(r){ne.error("Failed to update user profile",r)}},findUserByEmail:async t=>{try{if(!t)return null;ne.log("findUserByEmail: Searching for email:",t);const e=Pe(Z,"users"),r=He(e,We("email","==",t),Ld(1)),s=await Ge(r);if(ne.log("findUserByEmail: Found docs:",s.size),s.empty)return ne.log("findUserByEmail: No user found with email:",t),null;const n=s.docs[0].data();return ne.log("findUserByEmail: User found:",n),{uid:s.docs[0].id,email:n.email,displayName:n.displayName||"",permission:"read"}}catch(e){return ne.error("Failed to find user by email",e),null}},updateUserStartScreen:async(t,e)=>kr(async()=>{try{const r=Ee(Z,"users",t);await _s(r,{startScreen:e,updatedAt:Re()},{merge:!0}),ne.log(`User ${t} startScreen updated to ${e}`)}catch(r){throw ne.error("Firestore updateUserStartScreen ì‹¤íŒ¨:",r),r}}),subscribeSharingGroups:(t,e)=>{try{const r=Pe(Z,`users/${t}/sharing_groups`),s=He(r,Gt("createdAt","desc"));return Rt(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:ve(o.data().createdAt)||new Date}));e(i)},n=>{ne.error("Sharing groups subscription error:",n),e([])})}catch(r){return ne.error("Failed to subscribe sharing groups:",r),e([]),()=>{}}},createSharingGroup:async(t,e)=>{try{const r=Pe(Z,`users/${t}/sharing_groups`),s=await Lr(r,{name:e.name,members:e.members,createdAt:Re(),updatedAt:Re()});return ne.log("Sharing group created:",s.id),s.id}catch(r){throw ne.error("Failed to create sharing group:",r),r}},updateSharingGroup:async(t,e,r)=>{try{console.log("ğŸ”„ updateSharingGroup ì‹œì‘:",{uid:t,groupId:e,updates:r});const s=Ee(Z,`users/${t}/sharing_groups`,e),n=await Tt(s),i=n.exists()?n.data().members||[]:[];if(console.log("ğŸ“‹ ê¸°ì¡´ ë©¤ë²„:",i.map(o=>({uid:o.uid,permission:o.permission}))),await wt(s,{...r,updatedAt:Re()}),console.log("âœ… ì†Œìœ ì ê·¸ë£¹ ì—…ë°ì´íŠ¸ ì™„ë£Œ:",e),r.members){console.log("ğŸ“ ì—…ë°ì´íŠ¸í•  ë©¤ë²„:",r.members.map(h=>({uid:h.uid,permission:h.permission})));const o=Pe(Z,"shared_todos"),l=He(o,We("sharedGroupId","==",e),We("ownerId","==",t)),c=await Ge(l);if(c.docs.length>0){const h=r.members.filter(y=>y.permission==="edit"||y.permission==="admin").map(y=>y.uid),g=r.members.filter(y=>y.permission==="admin").map(y=>y.uid),m=r.members.map(y=>y.uid),x=r.members.map(y=>({uid:y.uid,email:y.email,displayName:y.displayName,permission:y.permission})),f=Vt(Z);c.docs.forEach(y=>{f.update(y.ref,{sharedWith:x,sharedWithUids:m,editorUids:h,adminUids:g,updatedAt:Re()})}),await f.commit(),console.log(`âœ… ${c.docs.length}ê°œì˜ ê³µìœ  í• ì¼ ê¶Œí•œ ë™ê¸°í™”ë¨`)}const u=[...new Set([...i.map(h=>h.uid),...r.members.map(h=>h.uid)])].filter(h=>h!==t).map(async h=>{try{const g=Ee(Z,`users/${h}/sharing_groups`,`ref_${e}`);await wt(g,{...r,updatedAt:Re()}),console.log(`âœ… ë©¤ë²„ ${h}ì˜ ê·¸ë£¹ ì°¸ì¡° ì—…ë°ì´íŠ¸ë¨ (ref_${e})`)}catch(g){g.code==="not-found"?console.log(`â„¹ï¸ ë©¤ë²„ ${h}ì˜ ê·¸ë£¹ ì°¸ì¡°ê°€ ì—†ìŒ (ì´ˆëŒ€ ìˆ˜ë½ ì „)`):console.warn(`âš ï¸ ë©¤ë²„ ${h}ì˜ ê·¸ë£¹ ì°¸ì¡° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`,g.message)}});await Promise.allSettled(u)}}catch(s){throw ne.error("Failed to update sharing group:",s),s}},deleteSharingGroup:async(t,e)=>{try{console.log("ğŸ—‘ï¸ Deleting sharing group:",e);const r=Ee(Z,`users/${t}/sharing_groups`,e),s=await Tt(r);if(!s.exists()){console.warn("âŒ Group not found for deletion:",e);return}const o=(s.data().members||[]).filter(l=>l.uid!==t).map(async l=>{try{const c=`users/${l.uid}/sharing_groups/ref_${e}`;await Jt(Ee(Z,c)),console.log("âœ… Deleted reference for member:",l.email)}catch(c){console.warn(`âš ï¸ Failed to delete reference for ${l.email} (likely permission issue):`,c)}});await Promise.allSettled(o);try{const l=Pe(Z,"shared_todos"),c=He(l,We("sharedGroupId","==",e),We("ownerId","==",t)),d=await Ge(c);if(d.docs.length>0){const u=Vt(Z);d.docs.forEach(h=>{u.update(h.ref,{sharedGroupId:$d(),sharedGroupName:$d(),sharedWith:[],sharedWithUids:[],editorUids:[],adminUids:[],"visibility.isShared":!1,updatedAt:Re()})}),await u.commit(),console.log(`âœ… Unshared ${d.docs.length} todos associated with group.`)}}catch(l){console.warn("âš ï¸ Failed to unshare some todos (continuing with group deletion):",l)}try{await Jt(r),console.log("âœ… Sharing group deleted:",e)}catch(l){throw ne.error("Failed to delete group document:",l),l}}catch(r){throw ne.error("Failed to delete sharing group:",r),r}},processAcceptedInvitation:async t=>{const{id:e,groupId:r,fromUid:s,toEmail:n,permission:i}=t;console.log("ğŸ”„ Processing accepted invitation:",e);try{const o=await te.findUserByEmail(n);if(!o){console.warn("âŒ ì´ˆëŒ€ë¥¼ ìˆ˜ë½í•œ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:",n);return}const l={...o,permission:i},c=Ee(Z,`users/${s}/sharing_groups`,r),d=await Tt(c);if(d.exists()){const y=d.data().members||[];if(!y.some(w=>w.uid===o.uid)){const w=[...y,l];await wt(c,{members:w,updatedAt:Re()}),console.log("âœ… ê·¸ë£¹ ë©¤ë²„ ì¶”ê°€ ì™„ë£Œ:",r,o.uid)}}else{console.warn("âš ï¸ ê·¸ë£¹ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ (ì‚­ì œë˜ì—ˆì„ ìˆ˜ ìˆìŒ):",r),await Jt(Ee(Z,"sharing_requests",e));return}const u=Pe(Z,"shared_todos"),h=He(u,We("sharedGroupId","==",r)),g=await Ge(h),m=Vt(Z);let x=0;g.docs.forEach(f=>{const y=f.data(),w=y.sharedWith||[];if(!w.some(v=>v.uid===o.uid)){const v=[...w,l],k=[...y.sharedWithUids||[],o.uid],b={sharedWith:v,sharedWithUids:k,updatedAt:Re()};(i==="edit"||i==="admin")&&(b.editorUids=[...y.editorUids||[],o.uid]),i==="admin"&&(b.adminUids=[...y.adminUids||[],o.uid]),m.update(f.ref,b),x++}}),x>0&&(await m.commit(),console.log(`âœ… ${x}ê°œì˜ ê³µìœ  í• ì¼ì— ìƒˆ ë©¤ë²„ ì¶”ê°€ ì™„ë£Œ`)),await Jt(Ee(Z,"sharing_requests",e)),console.log("âœ… ì´ˆëŒ€ ìš”ì²­ ì²˜ë¦¬ ì™„ë£Œ ë° ì‚­ì œ:",e)}catch(o){throw console.error("âŒ processAcceptedInvitation ì‹¤íŒ¨:",o),o}},leaveSharingGroup:async(t,e)=>{try{console.log("ğŸšª leaveSharingGroup ì‹œì‘:",{uid:t,groupId:e});const r=Pe(Z,"shared_todos"),s=He(r,We("sharedGroupId","==",e),We("sharedWithUids","array-contains",t)),n=await Ge(s),i=Vt(Z);let o=0;n.docs.forEach(c=>{const d=c.data(),u=(d.sharedWith||[]).filter(x=>x.uid!==t),h=(d.sharedWithUids||[]).filter(x=>x!==t),g=(d.editorUids||[]).filter(x=>x!==t),m=(d.adminUids||[]).filter(x=>x!==t);i.update(c.ref,{sharedWith:u,sharedWithUids:h,editorUids:g,adminUids:m,updatedAt:Re()}),o++}),o>0&&(await i.commit(),console.log(`âœ… ${o}ê°œì˜ ê³µìœ  í• ì¼ì—ì„œ ë‚˜ê°€ê¸° ì²˜ë¦¬ë¨.`));const l=Ee(Z,`users/${t}/sharing_groups`,e);await Jt(l),console.log("âœ… ê³µìœ  ê·¸ë£¹ ëª©ë¡ì—ì„œ ì‚­ì œ ì™„ë£Œ:",e)}catch(r){throw console.error("âŒ leaveSharingGroup ì‹¤íŒ¨:",r),r}},sendPermissionChangeNotification:async(t,e,r,s,n,i)=>{try{const o=Pe(Z,"sharing_notifications"),l={type:"permission_change",targetUid:e,fromUid:t.uid,fromEmail:t.email,groupId:r,groupName:s,previousPermission:n,newPermission:i,createdAt:Re(),read:!1},c=await Lr(o,l);return console.log("âœ… ê¶Œí•œ ë³€ê²½ ì•Œë¦¼ ë°œì†¡:",c.id),c.id}catch(o){throw console.error("âŒ ê¶Œí•œ ë³€ê²½ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨:",o),o}},subscribeToSharingNotifications:(t,e)=>{const r=Pe(Z,"sharing_notifications"),s=He(r,We("targetUid","==",t),Gt("createdAt","desc"),Ld(50));return Rt(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:ve(o.data().createdAt)||new Date}));e(i)})},markNotificationAsRead:async t=>{try{const e=Ee(Z,"sharing_notifications",t);await wt(e,{read:!0}),console.log("âœ… ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬:",t)}catch(e){throw console.error("âŒ ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:",e),e}},getVacationAccessList:async()=>{try{const t=Ee(Z,"settings","vacation_access"),e=await Tt(t);return e.exists()?e.data().allowedEmails||[]:[]}catch(t){return console.error("Error fetching vacation access list:",t),[]}},addVacationAccessEmail:async t=>{try{const e=Ee(Z,"settings","vacation_access");await _s(e,{allowedEmails:Od(t)},{merge:!0})}catch(e){throw console.error("Error adding vacation access email:",e),e}},removeVacationAccessEmail:async t=>{try{const e=Ee(Z,"settings","vacation_access");await wt(e,{allowedEmails:Tx(t)})}catch(e){throw console.error("Error removing vacation access email:",e),e}},subscribeToVacationAccessList:t=>{const e=Ee(Z,"settings","vacation_access");return Rt(e,r=>{r.exists()?t(r.data().allowedEmails||[]):t([])})},deleteNotification:async t=>{try{const e=Ee(Z,"sharing_notifications",t);await Jt(e),console.log("âœ… ì•Œë¦¼ ì‚­ì œ:",t)}catch(e){throw console.error("âŒ ì•Œë¦¼ ì‚­ì œ ì‹¤íŒ¨:",e),e}}},Ym=p.createContext(void 0),Qv=({children:t})=>{const[e,r]=p.useState(null),[s,n]=p.useState(null),[i,o]=p.useState(null),[l,c]=p.useState(!0),[d,u]=p.useState(!1),[h,g]=p.useState(!1);p.useEffect(()=>{if(!jt){console.log("Auth: Firebase disabled, using localStorage only"),c(!1);return}const N=Nx(jt,T=>{T?(r({uid:T.uid,email:T.email,displayName:T.displayName,photoURL:T.photoURL,isAnonymous:T.isAnonymous}),!T.isAnonymous&&T.email&&te.checkAndCreateUser({uid:T.uid,email:T.email,displayName:T.displayName}).catch(_=>console.error("User profile sync failed:",_)),u(T.isAnonymous)):(r(null),u(!1),n(null),o(null),g(!1),localStorage.removeItem("google_access_token"),localStorage.removeItem("google_token_expiration")),c(!1)});return()=>N()},[]),p.useEffect(()=>{const N=localStorage.getItem("google_access_token"),T=localStorage.getItem("google_token_expiration");if(N&&T){g(!0);const _=parseInt(T,10);Date.now()<_&&(n(N),o(_))}},[]),p.useEffect(()=>{typeof window<"u"&&(window.authContext={signInWithGoogle:v})},[]);const m=async()=>{console.log("Auth: Use signInWithGoogle or signIn instead")},x=async()=>{if(jt){if(await Ex(jt),Ke.isNativePlatform())try{await po.signOut()}catch(N){console.log("GoogleAuth signOut failed (maybe not signed in)",N)}}else r(null);n(null),o(null),g(!1),localStorage.removeItem("google_access_token"),localStorage.removeItem("google_token_expiration")},f=async()=>{jt?await Cx(jt):(r({uid:"local-user",email:null,displayName:"Local User",photoURL:null,isAnonymous:!0}),u(!0))},y=async(N,T)=>{jt?await Dx(jt,N,T):console.log("Auth: SignIn not available in localStorage mode",{email:N,password:T})},w=async(N,T,_)=>{if(jt){const P=await jx(jt,N,T);_&&P.user&&await _x(P.user,{displayName:_})}else console.log("Auth: SignUp not available in localStorage mode",{email:N,password:T,displayName:_})},v=async()=>{if(!jt)throw new Error("Firebase ì¸ì¦ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");try{if(Ke.isNativePlatform()){console.log("Starting Native Google Sign-In (Capacitor Firebase)...");const N=await po.signInWithGoogle();console.log("FirebaseAuthentication Result:",JSON.stringify(N));const T=N.credential?.accessToken;if(T){n(T);const C=3500*1e3;o(Date.now()+C)}const _=Ps.credential(N.credential?.idToken),P=await Sx(jt,_);return console.log("Mobile Google Sign-In Success:",P.user),P.user}else{const N=new Ps;N.addScope("https://www.googleapis.com/auth/tasks"),N.setCustomParameters({prompt:"select_account consent"});const T=await Fd(jt,N);console.log("êµ¬ê¸€ ë¡œê·¸ì¸ ì„±ê³µ:",T.user);const P=Ps.credentialFromResult(T)?.accessToken;if(P){n(P);const C=3500*1e3,A=Date.now()+C;o(A),g(!0),localStorage.setItem("google_access_token",P),localStorage.setItem("google_token_expiration",A.toString())}return T.user}}catch(N){throw console.error("êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨:",N),N.code==="auth/popup-closed-by-user"||N.code==="auth/cancelled-popup-request"?new Error("ë¡œê·¸ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."):N.code==="auth/network-request-failed"?new Error("ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”."):new Error("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: "+(N.message||JSON.stringify(N)))}},D={currentUser:e,loading:l,isAnonymous:d,login:m,logout:x,loginAnonymously:f,signIn:y,signUp:w,signInWithGoogle:v,signInAsGuest:async()=>{await f()},getGoogleAccessToken:async N=>{if(!jt)throw new Error("Firebase Auth not initialized");const T=Date.now();if(s&&i&&T<i)return s;const _=localStorage.getItem("google_access_token"),P=localStorage.getItem("google_token_expiration");if(_&&P){const C=parseInt(P,10);if(T<C)return n(_),o(C),g(!0),_;console.log("âš ï¸ Cached token expired. Access renewal required."),n(null),o(null)}if(N?.silent)return null;try{if(Ke.isNativePlatform()){if(s&&i&&Date.now()<i)return s;console.log("Native Token Expired or Missing. Attempting silent re-auth...");try{const C=await po.signInWithGoogle({scopes:["https://www.googleapis.com/auth/tasks"]});if(C.credential?.accessToken)return n(C.credential.accessToken),o(Date.now()+3500*1e3),g(!0),C.credential.accessToken}catch(C){console.error("Failed to refresh native token",C)}return null}else{const C=new Ps;C.addScope("https://www.googleapis.com/auth/tasks"),C.setCustomParameters({prompt:"consent"});const A=await Fd(jt,C),B=Ps.credentialFromResult(A),z=B?.accessToken||null;if(z){const X=Date.now()+35e5;n(z),o(X),g(!0),localStorage.setItem("google_access_token",z),localStorage.setItem("google_token_expiration",X.toString())}return console.log("ğŸ”‘ Google Auth Result:",{user:A.user.email,providerId:A.providerId,credentialScopes:B?.scope,accessToken:z?"Present (Hidden)":"Missing"}),z}}catch(C){throw console.error("Error getting Google Access Token:",C),C}},isGoogleTasksConnected:h,disconnectGoogleTasks:()=>{n(null),o(null),g(!1),localStorage.removeItem("google_access_token"),localStorage.removeItem("google_token_expiration")},tokenExpiration:i};return a.jsx(Ym.Provider,{value:D,children:t})},bt=()=>{const t=p.useContext(Ym);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},wo={cleanupOrphanedInstances:async t=>{try{console.log("ğŸ§¹ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹œì‘");const e=Pe(Z,`users/${t}/recurringTemplates`),r=await Ge(e),s=new Set;r.forEach(u=>{s.add(u.id)}),console.log(`í™œì„± í…œí”Œë¦¿: ${s.size}ê°œ`);const n=Pe(Z,`users/${t}/recurringInstances`),i=await Ge(n),o=[];i.forEach(u=>{const h=u.data();s.has(h.templateId)||(o.push(u.id),console.log(`ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ ë°œê²¬: ${u.id} (í…œí”Œë¦¿: ${h.templateId})`))});const l=Pe(Z,`users/${t}/todos`),c=await Ge(l),d=[];if(c.forEach(u=>{const h=u.data();h._templateId&&!s.has(h._templateId)&&(d.push(u.id),console.log(`ê³ ì•„ í• ì¼ ë°œê²¬: ${h.title} (í…œí”Œë¦¿: ${h._templateId})`))}),o.length>0||d.length>0){const u=Vt(Z);o.forEach(h=>{const g=Ee(Z,`users/${t}/recurringInstances`,h);u.delete(g)}),d.forEach(h=>{const g=Ee(Z,`users/${t}/todos`,h);u.delete(g)}),await u.commit(),console.log(`âœ… ì •ë¦¬ ì™„ë£Œ: ì¸ìŠ¤í„´ìŠ¤ ${o.length}ê°œ, í• ì¼ ${d.length}ê°œ`)}else console.log("âœ… ì •ë¦¬í•  ê³ ì•„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");return{orphanedInstances:o.length,orphanedTodos:d.length,totalCleaned:o.length+d.length}}catch(e){throw console.error("âŒ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹¤íŒ¨:",e),e}},validateTemplateConsistency:async t=>{try{console.log("ğŸ” í…œí”Œë¦¿ ë°ì´í„° ì •í•©ì„± í™•ì¸ ì‹œì‘");const e=Pe(Z,`users/${t}/recurringTemplates`),r=await Ge(e),s=Pe(Z,`users/${t}/recurringInstances`),n=await Ge(s),i=Pe(Z,`users/${t}/todos`),o=await Ge(i),l=new Map;return r.forEach(c=>{const d=c.data();l.set(c.id,{templateTitle:d.title,instances:0,todos:0,isActive:d.isActive!==!1})}),n.forEach(c=>{const u=c.data().templateId;l.has(u)&&l.get(u).instances++}),o.forEach(c=>{const u=c.data()._templateId;u&&l.has(u)&&l.get(u).todos++}),console.log(`
ğŸ“Š í…œí”Œë¦¿ë³„ ë°ì´í„° í˜„í™©:`),console.log("=".repeat(60)),l.forEach((c,d)=>{console.log(`${c.templateTitle} (${d}):`),console.log(`  í™œì„±: ${c.isActive}`),console.log(`  ì¸ìŠ¤í„´ìŠ¤: ${c.instances}ê°œ`),console.log(`  í• ì¼: ${c.todos}ê°œ`),c.instances>0&&c.todos===0&&console.log("  âš ï¸ ë¬¸ì œ: ì¸ìŠ¤í„´ìŠ¤ë§Œ ìˆê³  ì‹¤ì œ í• ì¼ ì—†ìŒ"),console.log("")}),l}catch(e){throw console.error("âŒ ë°ì´í„° ì •í•©ì„± í™•ì¸ ì‹¤íŒ¨:",e),e}},regenerateAllInstances:async t=>{try{console.log("ğŸ”„ ì „ì²´ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹œì‘");const e=Pe(Z,`users/${t}/recurringInstances`),r=await Ge(e),s=Vt(Z);r.forEach(n=>{s.delete(n.ref)}),await s.commit(),console.log(`âœ… ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ${r.size}ê°œ ì‚­ì œ ì™„ë£Œ`),console.log("ğŸ’¡ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ í™œì„± í…œí”Œë¦¿ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìë™ ì¬ìƒì„±ë©ë‹ˆë‹¤")}catch(e){throw console.error("âŒ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",e),e}},smartCleanupInstances:async t=>{try{console.log("ğŸ§¹ ìŠ¤ë§ˆíŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹œì‘"),console.log("ì™„ë£Œëœ ì¸ìŠ¤í„´ìŠ¤ì™€ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì •ë¦¬í•©ë‹ˆë‹¤...");const e=Pe(Z,`users/${t}/recurringTemplates`),r=await Ge(e),s=new Set;r.forEach(c=>{const d=c.data();d.isActive!==!1&&(s.add(c.id),console.log(`í™œì„± í…œí”Œë¦¿: ${d.title} (${c.id})`))}),console.log(`í™œì„± í…œí”Œë¦¿: ${s.size}ê°œ`),console.log("2ï¸âƒ£ ì •ë¦¬ ëŒ€ìƒ ì¸ìŠ¤í„´ìŠ¤ ê²€ìƒ‰ ì¤‘...");const n=Pe(Z,`users/${t}/recurringInstances`),i=await Ge(n),o=[],l=[];if(i.forEach(c=>{const d=c.data(),u=d.templateId,h=d.completed===!0;!s.has(u)?o.push(c.id):l.push(c.id)}),console.log(`ğŸ“Š ì •ë¦¬ ê²°ê³¼: ì‚­ì œ ${o.length}ê°œ, ìœ ì§€ ${l.length}ê°œ`),o.length>0){console.log("3ï¸âƒ£ ì„ ë³„ëœ ì¸ìŠ¤í„´ìŠ¤ë“¤ ì‚­ì œ ì¤‘...");const c=[];let d=Vt(Z),u=0;o.forEach(h=>{const g=Ee(Z,`users/${t}/recurringInstances`,h);d.delete(g),u++,u>=500&&(c.push(d),d=Vt(Z),u=0)}),u>0&&c.push(d);for(let h=0;h<c.length;h++)await c[h].commit(),console.log(`ë°°ì¹˜ ${h+1}/${c.length} ì‚­ì œ ì™„ë£Œ`);console.log(`âœ… ì´ ${o.length}ê°œ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ ì™„ë£Œ`)}else console.log("ì‚­ì œí•  ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤");return console.log("âœ… ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì™„ë£Œ!"),console.log(`- í™œì„± í…œí”Œë¦¿: ${s.size}ê°œ`),console.log(`- ì‚­ì œëœ ì¸ìŠ¤í„´ìŠ¤: ${o.length}ê°œ`),console.log(`- ìœ ì§€ëœ ì¸ìŠ¤í„´ìŠ¤: ${l.length}ê°œ`),console.log(`- ì´ ì¸ìŠ¤í„´ìŠ¤: ${i.size}ê°œ`),{activeTemplates:s.size,deletedInstances:o.length,keptInstances:l.length,totalInstances:i.size}}catch(e){throw console.error("âŒ ëŒ€ëŸ‰ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹¤íŒ¨:",e),e}}},qm=p.createContext(void 0),Jv=({children:t})=>{const[e,r]=p.useState([]),[s,n]=p.useState(!0),{currentUser:i}=bt();p.useEffect(()=>{if(!i){r([]),n(!1);return}const d=He(Pe(Z,`users/${i.uid}/custom_holidays`),Gt("date","asc")),u=Rt(d,h=>{const g=h.docs.map(m=>({id:m.id,...m.data()}));r(g),n(!1)},h=>{console.error("Error fetching custom holidays:",h),n(!1)});return()=>u()},[i]);const o=async(d,u,h=!1)=>{if(i)try{await Lr(Pe(Z,`users/${i.uid}/custom_holidays`),{date:d,name:u,isRecurring:h,createdAt:Re()})}catch(g){throw console.error("Error adding custom holiday:",g),g}},l=async d=>{if(i)try{await Jt(Ee(Z,`users/${i.uid}/custom_holidays`,d))}catch(u){throw console.error("Error deleting custom holiday:",u),u}},c=d=>e.find(u=>{const h=new Date(u.date);h.setHours(0,0,0,0);const g=new Date(d);return g.setHours(0,0,0,0),h.getTime()===g.getTime()});return a.jsx(qm.Provider,{value:{customHolidays:e,addCustomHoliday:o,deleteCustomHoliday:l,getCustomHoliday:c,loading:s},children:t})},nn=()=>{const t=p.useContext(qm);if(t===void 0)throw new Error("useCustomHolidays must be used within a CustomHolidayProvider");return t},Cs="https://www.googleapis.com/tasks/v1",ts={async getTaskLists(t){try{const e=await fetch(`${Cs}/users/@me/lists`,{method:"GET",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!e.ok){let s="";try{const n=await e.json();if(s=JSON.stringify(n),console.error("Google Tasks API Error Details:",n),e.status===403){const i=n.error?.message||"";if((n.error?.errors?.[0]?.reason||"")==="insufficientPermissions"||i.includes("insufficient authentication scopes"))throw new Error("INSUFFICIENT_SCOPE")}}catch(n){if(n.message==="INSUFFICIENT_SCOPE")throw n;s="Could not parse error response"}throw new Error(`Failed to fetch task lists: ${e.status} ${e.statusText} - ${s}`)}return(await e.json()).items||[]}catch(e){throw ne.error("Error fetching Google Task lists:",e),e}},async getTasksFromList(t,e){try{const r=new Date;r.setDate(r.getDate()-30);const s=r.toISOString(),n=await fetch(`${Cs}/lists/${e}/tasks?showHidden=true&showDeleted=true&updatedMin=${s}`,{method:"GET",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Failed to fetch tasks from list ${e}: ${n.statusText}`);return(await n.json()).items||[]}catch(r){throw ne.error("Error fetching Google Tasks:",r),r}},async getAllTasks(t){const e=await this.getTaskLists(t),r=[];for(const s of e){const n=await this.getTasksFromList(t,s.id);n.length>0&&r.push({listName:s.title,listId:s.id,tasks:n})}return r},async updateTask(t,e,r,s){try{const n={...s};n.due&&n.due.includes(".")&&(n.due=n.due.split(".")[0]+"Z");const i=await fetch(`${Cs}/lists/${e}/tasks/${r}`,{method:"PATCH",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const o=await i.json().catch(()=>({}));return console.error("Failed to update Google Task:",i.status,o),null}return await i.json()}catch(n){return ne.error("Error updating Google Task:",n),window.location.protocol.includes("http")===!1||window.location.hostname,null}},async updateTaskStatus(t,e,r,s){return this.updateTask(t,e,r,{status:s?"completed":"needsAction",completed:s?new Date().toISOString():null})},async deleteTask(t,e,r){try{const s=await fetch(`${Cs}/lists/${e}/tasks/${r}`,{method:"DELETE",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return s.ok?!0:(console.error("Failed to delete Google Task:",s.status),!1)}catch(s){return ne.error("Error deleting Google Task:",s),!1}},async insertTask(t,e,r){try{const s={...r};s.due&&s.due.includes(".")&&(s.due=s.due.split(".")[0]+"Z");const n=await fetch(`${Cs}/lists/${e}/tasks`,{method:"POST",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok){const i=await n.json().catch(()=>({}));return console.error("Failed to insert Google Task:",n.status,i),null}return await n.json()}catch(s){return ne.error("Error inserting Google Task:",s),null}},async moveTask(t,e,r,s,n){try{const i=new URLSearchParams;s&&i.append("parent",s),n&&i.append("previous",n);const o=await fetch(`${Cs}/lists/${e}/tasks/${r}/move?${i.toString()}`,{method:"POST",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!o.ok){const l=await o.json().catch(()=>({}));return console.error("Failed to move Google Task:",o.status,l),null}return await o.json()}catch(i){return ne.error("Error moving Google Task:",i),null}}},Rn={_recentIds:new Set,register:t=>{Rn._recentIds.add(t),setTimeout(()=>{Rn._recentIds.delete(t)},6e4)},has:t=>Rn._recentIds.has(t)},Xm=p.createContext(void 0),Zv={todos:[],recurringTemplates:[],recurringInstances:[],sharingGroups:[],loading:!1,error:null,syncing:!1,fetchedMonths:new Set};function ew(t,e){switch(e.type){case"SET_LOADING":return{...t,loading:e.payload};case"SET_SYNCING":return{...t,syncing:e.payload};case"SET_ERROR":return{...t,error:e.payload};case"SET_TODOS":const r=e.payload,s=new Set(r.map(h=>h.id)),o=[...t.todos.filter(h=>s.has(h.id)?!1:h.completed),...r].filter((h,g,m)=>m.findIndex(x=>x.id===h.id)===g);return{...t,todos:o};case"MERGE_TODOS":const l=e.payload,c=new Map(t.todos.map(h=>[h.id,h]));return l.forEach(h=>c.set(h.id,h)),{...t,todos:Array.from(c.values()).sort((h,g)=>{const m=h.createdAt instanceof Date?h.createdAt.getTime():0;return(g.createdAt instanceof Date?g.createdAt.getTime():0)-m})};case"MARK_MONTH_FETCHED":return{...t,fetchedMonths:new Set(t.fetchedMonths).add(e.payload)};case"ADD_TODO":return t.todos.some(h=>h.id===e.payload.id)?t:{...t,todos:[e.payload,...t.todos]};case"UPDATE_TODO":return{...t,todos:t.todos.map(h=>h.id===e.payload.id?{...h,...e.payload.updates,updatedAt:new Date}:h)};case"DELETE_TODO":return{...t,todos:t.todos.filter(h=>h.id!==e.payload)};case"TOGGLE_TODO":{const h=new Date;return{...t,todos:t.todos.map(g=>{if(g.id===e.payload){const m=!g.completed;return m&&setTimeout(()=>{Je(async()=>{const{notificationManager:x}=await Promise.resolve().then(()=>Nl);return{notificationManager:x}},void 0,import.meta.url).then(({notificationManager:x})=>{x.showCompletionCelebration(g)})},0),{...g,completed:m,completedAt:m?h:void 0,updatedAt:h}}return g})}}case"ADD_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:[...h.subTasks||[],e.payload.subTask],updatedAt:new Date}:h)};case"UPDATE_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:h.subTasks?.map(g=>g.id===e.payload.subTaskId?{...g,...e.payload.updates,updatedAt:new Date}:g)||[],updatedAt:new Date}:h)};case"DELETE_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:h.subTasks?.filter(g=>g.id!==e.payload.subTaskId)||[],updatedAt:new Date}:h)};case"TOGGLE_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:h.subTasks?.map(g=>g.id===e.payload.subTaskId?{...g,completed:!g.completed,updatedAt:new Date}:g)||[],updatedAt:new Date}:h)};case"SET_RECURRING_TEMPLATES":return{...t,recurringTemplates:e.payload};case"SET_SHARING_GROUPS":return{...t,sharingGroups:e.payload};case"ADD_RECURRING_TEMPLATE":return{...t,recurringTemplates:[e.payload,...t.recurringTemplates]};case"UPDATE_RECURRING_TEMPLATE":return{...t,recurringTemplates:t.recurringTemplates.map(h=>h.id===e.payload.id?{...h,...e.payload.updates,updatedAt:new Date}:h)};case"DELETE_RECURRING_TEMPLATE":return{...t,recurringTemplates:t.recurringTemplates.filter(h=>h.id!==e.payload),recurringInstances:t.recurringInstances.filter(h=>h.templateId!==e.payload)};case"SET_RECURRING_INSTANCES":const u=e.payload.find(h=>h.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");return u&&console.log(`   ğŸ”§ Firebase ì›”ê°„ì—…ë¬´ë³´ê³  ìƒíƒœ: completed=${u.completed}`),{...t,recurringInstances:e.payload};case"UPDATE_RECURRING_INSTANCE":return{...t,recurringInstances:t.recurringInstances.map(h=>h.id===e.payload.id?{...h,...e.payload.updates,updatedAt:new Date}:h)};case"GENERATE_RECURRING_INSTANCES":{let h=[],g=[];try{const m=localStorage.getItem("recurringInstances");m&&(g=JSON.parse(m).map(f=>({...f,date:new Date(f.date),createdAt:new Date(f.createdAt),updatedAt:new Date(f.updatedAt),completedAt:f.completedAt?new Date(f.completedAt):void 0})),console.log("ğŸ“‚ localStorageì—ì„œ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ë³µì›:",g.length,"ê°œ"))}catch(m){console.error("âŒ localStorage ì¸ìŠ¤í„´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:",m)}return console.log("ğŸ‘¤ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì - ë¡œì»¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œì‘"),t.recurringTemplates.filter(m=>m.isActive).forEach(m=>{try{const f=Ms.generateInstances(m).map(y=>{const w=g.find(v=>v.id===y.id);return w?(console.log(`ğŸ”„ localStorage ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ ë³µì›: ${y.id} (ì™„ë£Œ: ${w.completed})`),{...y,completed:w.completed,completedAt:w.completedAt,updatedAt:w.updatedAt}):y});h=[...h,...f]}catch(x){console.error(`í…œí”Œë¦¿ ${m.id} ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:`,x)}}),{...t,recurringInstances:h}}default:return t}}const tw=({children:t})=>{const[e,r]=p.useReducer(ew,Zv),{currentUser:s,loading:n,getGoogleAccessToken:i}=bt(),{customHolidays:o}=nn(),[l,c]=p.useState(""),[d,u]=p.useState("all"),[h,g]=p.useState("all"),[m,x]=p.useState([]),f=p.useRef(null),y=p.useRef(null),w=p.useRef(null),v=p.useRef(null),k=p.useCallback(()=>{if(e.recurringTemplates.length===0||e.recurringInstances.length===0)return[];const $=e.recurringInstances.filter(M=>!M.skipped).map(M=>{const F=e.recurringTemplates.find(U=>U.id===M.templateId);return F?Ms.convertToTodo(M,F):null}).filter(M=>M!==null),R=new Set;return $.filter(M=>R.has(M.id)?!1:(R.add(M.id),!0))},[e.recurringTemplates,e.recurringInstances]),b=p.useCallback(async(S,$)=>{if(s){if(console.log(`ğŸ”„ Syncing changes to Google Task [${S.title}]`,{updates:$,gId:S.googleTaskId}),!S.googleTaskId||!S.googleTaskListId){$&&S.googleTaskId&&console.warn("âš ï¸ Google Sync Skip - Missing IDs:",{id:S.id,gId:S.googleTaskId,listId:S.googleTaskListId});return}Rn.register(S.googleTaskId);try{const R=await i({silent:!0});if(!R)return;const M={...S,...$},F={title:M.title,notes:M.description||""};if(M.completed!==void 0&&(F.status=M.completed?"completed":"needsAction",F.completed=M.completed?(M.completedAt||new Date).toISOString():null),M.dueDate){const U=new Date(M.dueDate);F.due=new Date(Date.UTC(U.getFullYear(),U.getMonth(),U.getDate())).toISOString()}else F.due=null;console.log(`ğŸ”„ Google Tasks ì „ë°©í–¥ ë™ê¸°í™”: [${M.title}]`),await ts.updateTask(R,S.googleTaskListId,S.googleTaskId,F)}catch(R){console.error("âŒ Google Tasks ë™ê¸°í™” ì¤‘ ì—ëŸ¬ ë°œìƒ:",R)}}},[s,i]),j=p.useCallback(async S=>{if(!(!S.googleTaskId||!S.googleTaskListId||!s))try{const $=await i({silent:!0});if(!$)return;await ts.deleteTask($,S.googleTaskListId,S.googleTaskId),console.log(`ğŸ—‘ï¸ Google Tasksì—ì„œ ì‚­ì œ ì™„ë£Œ: [${S.title}]`)}catch($){console.error("âŒ Google Tasks ì‚­ì œ ì¤‘ ì—ëŸ¬ ë°œìƒ:",$)}},[s,i]),D=p.useCallback(async S=>{const $=M=>{const F=e.todos.filter(ae=>ae.priority===M&&!ae.completed);if(F.length===0)return{urgent:0,high:1e3,medium:2e3,low:3e3}[M]||2e3;const U=Math.min(...F.map(ae=>ae.order||999));return Math.max(0,U-1)},R={...S,id:fo(),createdAt:new Date,updatedAt:new Date,order:$(S.priority)};try{if(s){if(R.googleTaskId)console.log(`ğŸ“¥ Google Tasks Import ê°ì§€: Push ê±´ë„ˆëœ€ [${R.title}]`);else try{const F=await te.getUserSettings(s.uid);if(F?.autoSyncGoogleTasks){const U=await i({silent:!0});if(U){const ae=await ts.insertTask(U,F.defaultGoogleTaskListId||"@default",{title:R.title,notes:R.description,due:R.dueDate?new Date(Date.UTC(R.dueDate.getFullYear(),R.dueDate.getMonth(),R.dueDate.getDate())).toISOString():void 0});ae&&(console.log(`âœ… Google Tasksì— ì¶”ê°€ë¨: [${R.title}]`),R.googleTaskId=ae.id,R.googleTaskListId=F.defaultGoogleTaskListId||"@default",Rn.register(ae.id))}}}catch(F){console.error("âš ï¸ Google Tasks ì¶”ê°€ ì‹¤íŒ¨ (ë¡œì»¬ ì €ì¥ì€ ì§„í–‰):",F)}const M=await te.addTodo(R,s.uid);r({type:"ADD_TODO",payload:{...R,id:M}})}else r({type:"ADD_TODO",payload:R})}catch(M){console.error("í• ì¼ ì¶”ê°€ ì‹¤íŒ¨:",M)}},[s,e.todos,i]),N=p.useCallback(async(S,$)=>{try{const R=e.todos.find(M=>M.id===S);s?(await te.updateTodo(S,$,s.uid),R&&b(R,$)):r({type:"UPDATE_TODO",payload:{id:S,updates:$}})}catch(R){console.error("í• ì¼ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",R)}},[s,e.todos,b]),T=p.useCallback(async S=>{try{const R=[...e.todos,...k()].find(F=>F.id===S);if(S.startsWith("recurring_")||R?._isRecurringInstance){let F=R?._instanceId||(S.startsWith("recurring_")?S.replace("recurring_",""):null);if(!F)return;const U={skipped:!0,skippedReason:"manual_deletion"};r({type:"SET_RECURRING_INSTANCES",payload:e.recurringInstances.map(ae=>ae.id===F?{...ae,...U}:ae)}),s&&await te.updateRecurringInstance(F,U,s.uid);return}s&&(R&&j(R),await te.deleteTodo(S,s.uid).catch(()=>{})),r({type:"DELETE_TODO",payload:S})}catch($){console.error("í• ì¼ ì‚­ì œ ì‹¤íŒ¨:",$)}},[s,e.todos,e.recurringInstances,k,r]),_=p.useCallback(async S=>{const R=[...e.todos,...k()].find(U=>U.id===S),M=e.todos.find(U=>U.id===S);if(M&&M.startDate&&M.dueDate&&!M._isRecurringInstance){const U={completed:!M.completed,completedAt:M.completed?null:new Date};try{r({type:"TOGGLE_TODO",payload:S}),s&&(await te.updateTodo(S,U,s.uid),b(M,U));return}catch(ae){console.error("âŒ ê¸°ê°„ í• ì¼ í† ê¸€ ì‹¤íŒ¨:",ae),r({type:"TOGGLE_TODO",payload:S});return}}if(R&&R._isRecurringInstance){let U=R._instanceId||(S.startsWith("recurring_")?S.replace("recurring_",""):null);if(!U)return;const ae=e.recurringInstances.find(Te=>Te.id===U);if(ae){const Te={...ae,completed:!ae.completed,completedAt:ae.completed?null:new Date,updatedAt:new Date};try{r({type:"SET_RECURRING_INSTANCES",payload:e.recurringInstances.map(Ne=>Ne.id===U?Te:Ne)}),s&&await te.updateRecurringInstance(U,{completed:Te.completed,completedAt:Te.completedAt},s.uid);return}catch(Ne){console.error("âŒ ë°˜ë³µ í• ì¼ í† ê¸€ ì‹¤íŒ¨:",Ne),r({type:"SET_RECURRING_INSTANCES",payload:e.recurringInstances});return}}}const F=e.todos.find(U=>U.id===S);if(F)try{if(r({type:"TOGGLE_TODO",payload:S}),s){const U={completed:!F.completed,completedAt:F.completed?null:new Date};await te.updateTodo(S,U,s.uid),b(F,U)}}catch(U){console.error("âŒ ì¼ë°˜ í• ì¼ í† ê¸€ ì‹¤íŒ¨:",U),r({type:"TOGGLE_TODO",payload:S})}},[s,e.todos,e.recurringInstances,k,b,r]),P=p.useCallback(()=>{const S=e.todos.filter(F=>!F.completed&&(F.order===void 0||F.order===null)),$=k().filter(F=>!F.completed&&(F.order===void 0||F.order===null)),R=[...S,...$];if(R.length===0)return;const M={urgent:R.filter(F=>F.priority==="urgent"),high:R.filter(F=>F.priority==="high"),medium:R.filter(F=>F.priority==="medium"),low:R.filter(F=>F.priority==="low")};Object.entries(M).forEach(([F,U],ae)=>{if(U.length===0)return;const Te=U.sort((ge,_e)=>new Date(ge.createdAt).getTime()-new Date(_e.createdAt).getTime()),Ne=ae*1e3;Te.forEach((ge,_e)=>{const ye=Ne+_e*10;if(ge._isRecurringInstance){const De=ge._instanceId;r({type:"UPDATE_RECURRING_INSTANCE",payload:{id:De,updates:{order:ye}}})}else s&&te.updateTodo(ge.id,{order:ye},s.uid).catch(()=>{}),r({type:"UPDATE_TODO",payload:{id:ge.id,updates:{order:ye}}})})})},[e.todos,k,s]);p.useEffect(()=>{if(n)return;if(!s){console.log("âŒ ë¹„ë¡œê·¸ì¸ ìƒíƒœ"),A();return}return console.log("âœ… ë¡œê·¸ì¸ ìƒíƒœ - ì‚¬ìš©ì:",s.uid),r({type:"SET_LOADING",payload:!0}),f.current&&(f.current(),f.current=null),y.current&&(y.current(),y.current=null),w.current&&(w.current(),w.current=null),v.current&&(v.current(),v.current=null),(async()=>{try{if(await z(),!s)return;console.log("ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ êµ¬ë… ì‹œì‘ - ì‚¬ìš©ì:",s.uid),console.log("ğŸ”— Firestore í• ì¼ êµ¬ë… ì‹œì‘ - ì‚¬ìš©ì ID:",s.uid),f.current=te.subscribeTodos(s.uid,F=>{r({type:"SET_TODOS",payload:F}),r({type:"SET_LOADING",payload:!1}),r({type:"SET_ERROR",payload:null})}),y.current=te.subscribeRecurringTemplates(s.uid,F=>{r({type:"SET_RECURRING_TEMPLATES",payload:F}),console.log("ë°˜ë³µ í…œí”Œë¦¿ Firestoreì—ì„œ ë¡œë“œë¨:",F.length,"ê°œ")}),v.current=te.subscribeSharingGroups(s.uid,F=>{r({type:"SET_SHARING_GROUPS",payload:F}),console.log("ê³µìœ  ê·¸ë£¹ Firestoreì—ì„œ ë¡œë“œë¨:",F.length,"ê°œ")}),console.log("ğŸš€ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì‹œì‘..."),console.log("ğŸ” ì‹¤ì‹œê°„ êµ¬ë… ì „ì— ì§ì ‘ ë°ì´í„° ì¡°íšŒë¡œ í™•ì¸..."),console.log("ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ì •ë³´:"),console.log("  UID:",s.uid),console.log("  Email:",s.email),console.log("  DisplayName:",s.displayName),console.log("ğŸ“ Firestore ê²½ë¡œ: users/"+s.uid+"/recurringInstances");const R=(await te.getRecurringInstances(s.uid)).find(F=>F.id==="PUH4xT3lVY5aK2vuQyUe_2025-08-21");R&&(console.log("ğŸ¯ğŸ¯ğŸ¯ ì§ì ‘ ì¡°íšŒí•œ ì£¼ê°„ì—…ë¬´ë³´ê³  ë°ì´í„°:"),console.log("  completed:",R.completed,typeof R.completed),console.log("  completedAt:",R.completedAt),console.log("  ì „ì²´ ê°ì²´:",JSON.stringify(R,null,2)),console.log("ğŸ“ í•´ë‹¹ ë¬¸ì„œì˜ ì „ì²´ ê²½ë¡œ: users/"+s.uid+"/recurringInstances/PUH4xT3lVY5aK2vuQyUe_2025-08-21"));const M=te.subscribeRecurringInstances(s.uid,F=>{r({type:"SET_RECURRING_INSTANCES",payload:F})});M?(w.current=M,setTimeout(async()=>{try{const F=await te.getRecurringInstances(s.uid);r({type:"SET_RECURRING_INSTANCES",payload:F})}catch(F){console.error("âŒ Firebase ê°•ì œ ë™ê¸°í™” ì‹¤íŒ¨:",F)}},3e3)):console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì‹¤íŒ¨")}catch($){console.error("Firestore ì´ˆê¸°í™” ì‹¤íŒ¨:",$),r({type:"SET_LOADING",payload:!1}),r({type:"SET_ERROR",payload:"Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})}})(),()=>{f.current&&f.current(),y.current&&y.current(),w.current&&w.current(),v.current&&v.current()}},[s,n]),p.useEffect(()=>{if(e.recurringTemplates.length===0)return;(async()=>{try{if(!s){const $=[];for(const R of e.recurringTemplates)try{const M=Ms.generateInstances(R,o);$.push(...M)}catch(M){console.error(`âŒ í…œí”Œë¦¿ ${R.title} ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:`,M)}r({type:"SET_RECURRING_INSTANCES",payload:$});return}for(const $ of e.recurringTemplates)try{await te.regenerateRecurringInstances($.id,s.uid)}catch(R){console.error(`âŒ Firebase í…œí”Œë¦¿ ${$.title} ì¬ìƒì„± ì‹¤íŒ¨:`,R)}}catch($){console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",$)}})()},[e.recurringTemplates,s,o]),p.useEffect(()=>{if(!s||e.recurringInstances.length===0)return;(async()=>{try{const $=await te.getRecurringInstances(s.uid),R=new Set($.map(F=>F.id)),M=e.recurringInstances.filter(F=>{const U=!R.has(F.id);return U});if(M.length>0)for(const F of M)try{const U=await te.addRecurringInstance({...F,id:F.id},s.uid)}catch(U){console.error(`âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ Firebase ì¶”ê°€ ì‹¤íŒ¨: ${F.id}`,U)}}catch($){console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ Firebase ë™ê¸°í™” ì‹¤íŒ¨:",$)}})()},[s,e.recurringInstances.length,e.recurringInstances]);const C=p.useCallback(async(S,$)=>{if(!s)return;const R=`${S}-${$}`;if(e.fetchedMonths.has(R)){console.log(`ğŸ§  Cache Hit: Historical todos for ${R} already loaded.`);return}console.log(`ğŸŒ Fetching Historical todos for ${R}...`),r({type:"SET_LOADING",payload:!0});try{const M=new Date(S,$-1,1),F=new Date(S,$,0),U=await te.getCompletedTodos(s.uid,M,F);U.length>0?(console.log(`ğŸ“¥ Loaded ${U.length} historical todos.`),r({type:"MERGE_TODOS",payload:U})):console.log(`ğŸ¤·â€â™‚ï¸ No historical todos found for ${R}.`),r({type:"MARK_MONTH_FETCHED",payload:R})}catch(M){console.error("Failed to load historical todos:",M)}finally{r({type:"SET_LOADING",payload:!1})}},[s,e.fetchedMonths]);p.useEffect(()=>{const S=async()=>{try{const{Capacitor:R}=await Je(async()=>{const{Capacitor:U}=await Promise.resolve().then(()=>ms);return{Capacitor:U}},void 0,import.meta.url);if(R.getPlatform()!=="android")return;const{LocalNotifications:M}=await Je(async()=>{const{LocalNotifications:U}=await Promise.resolve().then(()=>r_);return{LocalNotifications:U}},void 0,import.meta.url),F=await M.addListener("localNotificationActionPerformed",async U=>{console.log("ğŸ”” Notification Action Performed:",U.actionId);const ae=U.actionId,Te=U.notification.extra?.todoId;if(ae==="COMPLETE"&&Te)console.log("âœ… Completing task via notification:",Te),r({type:"TOGGLE_TODO",payload:Te}),s&&e.todos.find(ge=>ge.id===Te)&&await te.updateTodo(Te,{completed:!0,completedAt:new Date,updatedAt:new Date},s.uid),await M.removeAllDeliveredNotifications();else if(ae==="SNOOZE"&&Te){console.log("zzz Snoozing task:",Te);const Ne=new Date(Date.now()+900*1e3),{notificationManager:ge}=await Je(async()=>{const{notificationManager:ye}=await Promise.resolve().then(()=>Nl);return{notificationManager:ye}},void 0,import.meta.url);e.todos.find(ye=>ye.id===Te)&&await M.schedule({notifications:[{title:U.notification.title||"Snoozed Task",body:U.notification.body||"Reminder",id:U.notification.id+1,schedule:{at:Ne},actionTypeId:"REMINDER_ACTIONS",extra:{todoId:Te}}]})}else ae==="OPEN_APP"?console.log("ğŸ“± Daily briefing: ì–´í”Œë¡œ í™•ì¸ í´ë¦­ - ì•± ì—´ê¸°"):ae==="DISMISS"&&console.log("âŒ Daily briefing: ë‹«ê¸° í´ë¦­")});return()=>{F.remove()}}catch(R){console.warn("Failed to setup notification listeners",R)}};let $;return S().then(R=>$=R),()=>{$&&$()}},[e.todos,s]),p.useEffect(()=>{const S=async()=>{try{const{Capacitor:$}=await Je(async()=>{const{Capacitor:F}=await Promise.resolve().then(()=>ms);return{Capacitor:F}},void 0,import.meta.url);if($.getPlatform()!=="android")return;const{notificationManager:R}=await Je(async()=>{const{notificationManager:F}=await Promise.resolve().then(()=>Nl);return{notificationManager:F}},void 0,import.meta.url);let M=null;if(s&&(M=await te.getUserSettings(s.uid)),!M){const F=localStorage.getItem("notification-settings");F&&(M=JSON.parse(F))}M||(M={dailyReminder:!0,dailyReminderTime:"09:00",dailyRecurrence:[1,2,3,4,5]}),await R.scheduleDailyBriefing(M,e.todos,[]),console.log("ğŸ“… Daily briefing scheduled on app startup")}catch($){console.warn("Failed to initialize daily briefing",$)}};(e.todos.length>0||!e.loading)&&S()},[e.todos,e.loading]);const A=()=>{try{if(console.log("=== localStorageì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œì‘ ==="),s){console.log("ğŸ‘¤ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - ê°œì¸ Firebase ë°ì´í„°ë§Œ ì‚¬ìš©"),r({type:"SET_TODOS",payload:[]}),r({type:"SET_RECURRING_TEMPLATES",payload:[]}),r({type:"SET_LOADING",payload:!1});return}if(s)console.log("ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - localStorage í• ì¼ ë¡œë“œ ê±´ë„ˆëœ€ (Firestore ì‚¬ìš©)");else{const S=localStorage.getItem("todos");if(S){const R=JSON.parse(S).map(M=>({...M,createdAt:new Date(M.createdAt),updatedAt:new Date(M.updatedAt),dueDate:M.dueDate?new Date(M.dueDate):void 0,startDate:M.startDate?new Date(M.startDate):void 0,completedAt:M.completedAt?new Date(M.completedAt):void 0}));console.log("localStorageì—ì„œ í• ì¼ ë¡œë“œ (ë¹„ë¡œê·¸ì¸):",R.length,"ê°œ"),r({type:"SET_TODOS",payload:R})}}if(s)console.log("ğŸš« ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - localStorage í…œí”Œë¦¿ ë¡œë“œ ì™„ì „ ë¹„í™œì„±í™” (Firestore ì „ìš©)");else{const S=localStorage.getItem("recurringTemplates");if(S){const R=JSON.parse(S).map(M=>({...M,createdAt:new Date(M.createdAt),updatedAt:new Date(M.updatedAt)}));console.log("localStorageì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ë¡œë“œ:",R.length,"ê°œ"),r({type:"SET_RECURRING_TEMPLATES",payload:R})}}r({type:"SET_LOADING",payload:!1}),console.log("=== localStorage ë°ì´í„° ë¡œë“œ ì™„ë£Œ ===")}catch(S){console.error("localStorage ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"localStorage ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}),r({type:"SET_LOADING",payload:!1})}},B=()=>{if(s){console.log("ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - localStorage ì €ì¥ ê±´ë„ˆëœ€");return}try{localStorage.setItem("todos",JSON.stringify(e.todos)),localStorage.setItem("recurringTemplates",JSON.stringify(e.recurringTemplates)),console.log("localStorageì— ë°ì´í„° ì €ì¥ ì™„ë£Œ (ë¹„ë¡œê·¸ì¸)")}catch(S){console.error("localStorage ì €ì¥ ì‹¤íŒ¨:",S)}},z=async()=>{if(s)try{if(console.log("=== localStorage â†’ Firestore ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸ ==="),!s)return;if(console.log("ğŸ”„ ë¡œê·¸ì¸ ì‚¬ìš©ì - localStorage ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œë„"),localStorage.getItem(`migrated_${s.uid}`)){console.log("ì´ë¯¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œëœ ì‚¬ìš©ì:",s.uid);return}console.log("ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘ - ì‚¬ìš©ì:",s.uid);const $=localStorage.getItem("todos"),R=localStorage.getItem("recurringTemplates");if($||R){if(console.log("ë§ˆì´ê·¸ë ˆì´ì…˜í•  localStorage ë°ì´í„° ë°œê²¬"),$){const F=JSON.parse($);if(F.length>0){console.log(`${F.length}ê°œì˜ í• ì¼ì„ Firestoreë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜`);for(const U of F)try{await te.addTodo({...U,createdAt:new Date(U.createdAt),updatedAt:new Date(U.updatedAt),dueDate:U.dueDate?new Date(U.dueDate):void 0,startDate:U.startDate?new Date(U.startDate):void 0,completedAt:U.completedAt?new Date(U.completedAt):void 0},s.uid),console.log(`í• ì¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ: ${U.title}`)}catch(ae){console.error(`í• ì¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${U.title}`,ae)}}}if(R){const F=JSON.parse(R);if(F.length>0){console.log(`${F.length}ê°œì˜ ë°˜ë³µ í…œí”Œë¦¿ì„ Firestoreë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜`);for(const U of F)try{await te.addRecurringTemplate({...U,createdAt:new Date(U.createdAt),updatedAt:new Date(U.updatedAt)},s.uid),console.log(`ë°˜ë³µ í…œí”Œë¦¿ ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ: ${U.title}`)}catch(ae){console.error(`ë°˜ë³µ í…œí”Œë¦¿ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${U.title}`,ae)}}}const M={todos:$?JSON.parse($):[],recurringTemplates:R?JSON.parse(R):[],migratedAt:new Date().toISOString(),userId:s.uid};localStorage.setItem(`migrated_backup_${s.uid}`,JSON.stringify(M)),localStorage.setItem(`migrated_${s.uid}`,new Date().toISOString()),localStorage.removeItem("todos"),localStorage.removeItem("recurringTemplates"),console.log("=== ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ: localStorage ë°ì´í„° ì •ë¦¬ë¨ ===")}else console.log("ë§ˆì´ê·¸ë ˆì´ì…˜í•  localStorage ë°ì´í„°ê°€ ì—†ìŒ"),localStorage.setItem(`migrated_${s.uid}`,new Date().toISOString())}catch(S){console.error("ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}};p.useEffect(()=>{if(s){console.log("ğŸš« ë¡œê·¸ì¸ ì‚¬ìš©ì - simpleRecurringSystem ë™ê¸°í™” ì°¨ë‹¨!");return}Ms.setTemplates(e.recurringTemplates)},[e.recurringTemplates,s]),p.useEffect(()=>{!s&&!n&&(console.log("ğŸ“¦ localStorage ì €ì¥ ì¤‘ - todos ë³€ê²½:",e.todos.length),B())},[e.todos,s,n]),p.useEffect(()=>{!s&&!n&&(console.log("ğŸ“¦ localStorage ì €ì¥ ì¤‘ - í…œí”Œë¦¿ ë³€ê²½:",e.recurringTemplates.length),B())},[e.recurringTemplates,s,n]);const W=async()=>{if(s){r({type:"SET_SYNCING",payload:!0});try{const S=await te.getTodos(s.uid);r({type:"SET_TODOS",payload:S}),r({type:"SET_ERROR",payload:null}),setTimeout(()=>{P()},500),typeof window<"u"&&(window.initializeOrderValues=P,window.forceFirebaseSync=async()=>{if(!s){console.log("âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");return}try{console.log("ğŸ”§ ìˆ˜ë™ Firebase ê°•ì œ ë™ê¸°í™” ì‹œì‘...");const $=await te.getRecurringInstances(s.uid),R=$.find(M=>M.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");R&&console.log("ğŸ”§ ìˆ˜ë™ ë™ê¸°í™” - Firebase ì›”ê°„ì—…ë¬´ë³´ê³  ìƒíƒœ:",R.completed),r({type:"SET_RECURRING_INSTANCES",payload:$}),console.log("âœ… ìˆ˜ë™ Firebase ë™ê¸°í™” ì™„ë£Œ!"),setTimeout(()=>{const M=$.find(F=>F.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");M&&console.log("ğŸ” ìˆ˜ë™ ë™ê¸°í™” í›„ í™•ì¸:",M.completed)},1e3)}catch($){console.error("âŒ ìˆ˜ë™ Firebase ë™ê¸°í™” ì‹¤íŒ¨:",$)}},console.log("ğŸ”§ ë””ë²„ê·¸ í•¨ìˆ˜ ë“±ë¡ë¨: window.forceFirebaseSync()"))}catch(S){console.error("Firestore ë™ê¸°í™” ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}finally{r({type:"SET_SYNCING",payload:!1})}}},X=async(S,$)=>{const R=e.todos.find(U=>U.id===S);let M;if(R?.googleTaskId&&R?.googleTaskListId&&s)try{const U=await i({silent:!0});if(U){const ae=await ts.insertTask(U,R.googleTaskListId,{title:$});ae&&(await ts.moveTask(U,R.googleTaskListId,ae.id,R.googleTaskId),M=ae.id,console.log(`âœ… Google Tasksì— í•˜ìœ„ í• ì¼ ìƒì„± ë° ì´ë™ ì™„ë£Œ: [${$}]`))}}catch(U){console.error("âŒ Google Tasks í•˜ìœ„ í• ì¼ ìƒì„± ì‹¤íŒ¨:",U)}const F={id:fo(),title:$,completed:!1,priority:"medium",createdAt:new Date,updatedAt:new Date,googleTaskId:M||null};try{s?await te.addSubTask(F,s.uid,S):r({type:"ADD_SUBTASK",payload:{todoId:S,subTask:F}})}catch(U){console.error("ì„œë¸ŒíƒœìŠ¤í¬ ì¶”ê°€ ì‹¤íŒ¨:",U),r({type:"SET_ERROR",payload:"í•˜ìœ„ ì‘ì—… ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},V=async(S,$,R)=>{try{const M=e.todos.find(U=>U.id===S),F=M?.subTasks?.find(U=>U.id===$);if(s){if(await te.updateSubTask($,R,s.uid,S),M?.googleTaskListId&&F?.googleTaskId)try{const U=await i({silent:!0});if(U){const ae={};R.title!==void 0&&(ae.title=R.title),R.completed!==void 0&&(ae.status=R.completed?"completed":"needsAction",ae.completed=R.completed?new Date().toISOString():null),R.dueDate!==void 0&&(ae.due=R.dueDate?R.dueDate.toISOString():null),await ts.updateTask(U,M.googleTaskListId,F.googleTaskId,ae),console.log(`âœ… Google Tasks í•˜ìœ„ í• ì¼ ì—…ë°ì´íŠ¸ ì™„ë£Œ: [${R.title||F.title}]`)}}catch(U){console.error("âŒ Google Tasks í•˜ìœ„ í• ì¼ ë™ê¸°í™” ì‹¤íŒ¨:",U)}}else r({type:"UPDATE_SUBTASK",payload:{todoId:S,subTaskId:$,updates:R}})}catch(M){console.error("ì„œë¸ŒíƒœìŠ¤í¬ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",M),r({type:"SET_ERROR",payload:"í•˜ìœ„ ì‘ì—… ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},ce=async(S,$)=>{try{const R=e.todos.find(F=>F.id===S),M=R?.subTasks?.find(F=>F.id===$);if(s){if(await te.deleteSubTask($,s.uid,S),R?.googleTaskListId&&M?.googleTaskId)try{const F=await i({silent:!0});F&&(await ts.deleteTask(F,R.googleTaskListId,M.googleTaskId),console.log(`ğŸ—‘ï¸ Google Tasks í•˜ìœ„ í• ì¼ ì‚­ì œ ì™„ë£Œ: [${M.title}]`))}catch(F){console.error("âŒ Google Tasks í•˜ìœ„ í• ì¼ ì‚­ì œ ì‹¤íŒ¨:",F)}}else r({type:"DELETE_SUBTASK",payload:{todoId:S,subTaskId:$}})}catch(R){console.error("ì„œë¸ŒíƒœìŠ¤í¬ ì‚­ì œ ì‹¤íŒ¨:",R),r({type:"SET_ERROR",payload:"í•˜ìœ„ ì‘ì—… ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},ke=async(S,$)=>{console.log("ğŸ”„ ì„œë¸ŒíƒœìŠ¤í¬ í† ê¸€ ì‹œì‘:",{todoId:S,subTaskId:$});const M=e.todos.find(ae=>ae.id===S)?.subTasks?.find(ae=>ae.id===$);if(!M){console.error("âŒ ì„œë¸ŒíƒœìŠ¤í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:",{todoId:S,subTaskId:$});return}const F=!M.completed;console.log("ğŸ“Š ì„œë¸ŒíƒœìŠ¤í¬ ìƒíƒœ:",{í˜„ì¬ì™„ë£Œìƒíƒœ:M.completed,ë³€ê²½í›„ìƒíƒœ:F,ê¸°ì¡´ì™„ë£Œì‹œê°„:M.completedAt});const U={completed:F,completedAt:F?new Date:null};console.log("ğŸ“ ì—…ë°ì´íŠ¸ ë°ì´í„°:",U),await V(S,$,U)},Se=S=>{const $=new Map,R=[];S.forEach(F=>{const U=F._isRecurringInstance||F.id.startsWith("recurring_"),ae=F._templateId;U&&ae?($.has(ae)||$.set(ae,[]),$.get(ae).push(F)):R.push(F)});const M=[];return $.forEach(F=>{const U=F.filter(Te=>Te.completed);M.push(...U);const ae=F.filter(Te=>!Te.completed);ae.length>0&&(ae.sort((Te,Ne)=>{const ge=Te.startDate?new Date(Te.startDate).getTime():0,_e=Ne.startDate?new Date(Ne.startDate).getTime():0;return ge-_e}),M.push(ae[0]),ae.length>1&&console.log(`ğŸ”’ ìˆœì°¨ì  í•„í„°ë§: ${ae[0].title} (í‘œì‹œ), ${ae.length-1}ê°œ ìˆ¨ê¹€`))}),[...R,...M]},me=S=>{const $=S?new Date(S):new Date;$.setHours(0,0,0,0);const R=e.todos.filter(Ne=>{if(Ne.completed){if(Ne.completedAt){const ye=new Date(Ne.completedAt);if(ye.setHours(0,0,0,0),ye.getTime()===$.getTime())return!0}return Ne.subTasks&&Ne.subTasks.length>0&&Ne.subTasks.some(De=>{if(De.completed&&De.completedAt&&De.completedAt!==null)try{const Me=new Date(De.completedAt);return Me.setHours(0,0,0,0),Me.getTime()===$.getTime()}catch{return!1}return!1})?(console.log(`ğŸ“‹ "${Ne.title}" - ì˜¤ëŠ˜ ì™„ë£Œëœ ì„œë¸ŒíƒœìŠ¤í¬ ìˆìŒ`),!0):!1}const ge=Ne.startDate?new Date(Ne.startDate):null,_e=Ne.dueDate?new Date(Ne.dueDate):null;return ge&&ge.setHours(0,0,0,0),_e&&_e.setHours(0,0,0,0),ge&&_e?$.getTime()>=ge.getTime()&&$.getTime()<=_e.getTime():ge&&!_e?$.getTime()>=ge.getTime():!ge&&_e?_e.getTime()>=$.getTime():!Ne.dueDate&&!Ne.startDate}),F=k().filter(Ne=>{if(Ne.startDate){const ge=new Date(Ne.startDate);if(ge.setHours(0,0,0,0),ge.getTime()===$.getTime()||ge.getTime()<$.getTime()&&!Ne.completed)return!0}if(Ne.completed&&Ne.completedAt){const ge=new Date(Ne.completedAt);if(ge.setHours(0,0,0,0),ge.getTime()===$.getTime())return!0}return!1}),U=new Set,Te=[...R,...F].filter(Ne=>U.has(Ne.id)?!1:(U.add(Ne.id),!0));return Se(Te)},ue=()=>{const S=new Date;S.setHours(0,0,0,0),k().filter(ye=>ye.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")).length>0;const M=new Date(S);M.setDate(S.getDate()-S.getDay()),M.setHours(0,0,0,0);const F=new Date(M);F.setDate(M.getDate()+6),F.setHours(0,0,0,0);const U=e.todos.filter(ye=>{if(ye.completed&&ye.completedAt){const De=new Date(ye.completedAt);return De.setHours(0,0,0,0),De>=M&&De<=F}if(!ye.completed){const De=ye.startDate?new Date(ye.startDate):null,Me=ye.dueDate?new Date(ye.dueDate):null;if(De&&De.setHours(0,0,0,0),Me&&Me.setHours(0,0,0,0),De&&Me)return Me.getTime()>=M.getTime()&&De.getTime()<=F.getTime();if(De&&!Me)return De<=F;if(!De&&Me)return Me>=S;if(!De&&!Me)return!0}return!1}),Te=k().filter(ye=>{if(ye.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ "),ye.completed){if(ye.completedAt){const st=new Date(ye.completedAt);st.setHours(0,0,0,0);const mt=st>=M&&st<=F;return ye.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ "),mt}return ye.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ "),!1}const De=ye.startDate?new Date(ye.startDate):null,Me=ye.dueDate?new Date(ye.dueDate):null;return De&&De.setHours(0,0,0,0),Me&&Me.setHours(0,0,0,0),De&&Me?Me.getTime()>=M.getTime()&&De.getTime()<=F.getTime():De&&!Me?De<=F:!De&&Me?Me>=M:!De&&!Me}),Ne=[...U,...Te],ge={urgent:0,high:1,medium:2,low:3},_e=Ne.sort((ye,De)=>{const Me=ge[ye.priority]-ge[De.priority];if(Me!==0)return Me;const st=ye.order||0,mt=De.order||0;return st!==mt?st-mt:new Date(ye.createdAt).getTime()-new Date(De.createdAt).getTime()});return Se(_e)},Y=()=>{const S=new Date;S.setHours(0,0,0,0);const $=new Date(S.getFullYear(),S.getMonth(),1);$.setHours(0,0,0,0);const R=new Date(S.getFullYear(),S.getMonth()+1,0);R.setHours(0,0,0,0);const M=e.todos.filter(ge=>{if(ge.completed&&ge.completedAt){const _e=new Date(ge.completedAt);return _e.setHours(0,0,0,0),_e>=$&&_e<=R}if(!ge.completed){const _e=ge.startDate?new Date(ge.startDate):null,ye=ge.dueDate?new Date(ge.dueDate):null;if(_e&&_e.setHours(0,0,0,0),ye&&ye.setHours(0,0,0,0),_e&&ye)return ye.getTime()>=$.getTime()&&_e.getTime()<=R.getTime();if(_e&&!ye)return _e<=R;if(!_e&&ye)return ye>=S;if(!_e&&!ye)return!0}return!1}),U=k().filter(ge=>{if(ge.completed){if(ge.completedAt){const De=new Date(ge.completedAt);return De.setHours(0,0,0,0),De>=$&&De<=R}return!1}const _e=ge.startDate?new Date(ge.startDate):null,ye=ge.dueDate?new Date(ge.dueDate):null;return _e&&_e.setHours(0,0,0,0),ye&&ye.setHours(0,0,0,0),_e&&ye?ye.getTime()>=$.getTime()&&_e.getTime()<=R.getTime():_e&&!ye?_e<=R:!_e&&ye?ye>=$:!_e&&!ye}),ae=[...M,...U];console.log("ğŸ“Š getMonthTodos ì •ë ¬ ì „ ì›”ê°„ì—…ë¬´ë³´ê³  ê°œìˆ˜:",ae.filter(ge=>ge.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")).length);const Te={urgent:0,high:1,medium:2,low:3},Ne=ae.sort((ge,_e)=>{const ye=Te[ge.priority]-Te[_e.priority];if(ye!==0)return ye;const De=ge.order||0,Me=_e.order||0;return De!==Me?De-Me:new Date(ge.createdAt).getTime()-new Date(_e.createdAt).getTime()});return console.log("ğŸ“Š getMonthTodos ì •ë ¬ í›„ ì›”ê°„ì—…ë¬´ë³´ê³ :",Ne.filter(ge=>ge.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")).map(ge=>`${ge.title}: ${ge.priority}`)),Se(Ne)},ie=()=>{const S=new Date;return S.setHours(0,0,0,0),e.todos.filter($=>{if(!$.dueDate||$.completed)return!1;const R=new Date($.dueDate);return R.setHours(0,0,0,0),R<S})},de=S=>{const $=S||new Date,R=new Date($);return R.setDate(R.getDate()+1),e.todos.filter(M=>M.dueDate?new Date(M.dueDate).toDateString()===R.toDateString():!1)},be=S=>{const $=S||new Date,R=new Date($);return R.setHours(0,0,0,0),e.todos.filter(M=>{if(M.completed||!M.dueDate)return!1;const F=new Date(M.dueDate);return F.setHours(0,0,0,0),F.getTime()<R.getTime()})},fe=S=>{if(S.completed||!S.dueDate)return!1;const $=new Date;$.setHours(0,0,0,0);const R=new Date(S.dueDate);return R.setHours(0,0,0,0),R.getTime()<$.getTime()},E=async(S,$)=>{if(S.startsWith("recurring_")){const M=S.replace("recurring_","");r({type:"UPDATE_RECURRING_INSTANCE",payload:{id:M,updates:{order:$}}}),console.log("ë°˜ë³µ í• ì¼ ìˆœì„œ ì—…ë°ì´íŠ¸ ì„±ê³µ",{todoId:S,instanceId:M,newOrder:$})}else if(r({type:"UPDATE_TODO",payload:{id:S,updates:{order:$,updatedAt:new Date}}}),s?.uid)try{await te.updateTodo(S,{order:$},s.uid),console.log("í• ì¼ ìˆœì„œ Firestore ì €ì¥ ì„±ê³µ",{todoId:S,newOrder:$})}catch(M){console.error("í• ì¼ ìˆœì„œ Firestore ì €ì¥ ì‹¤íŒ¨:",M)}},ee=async(S,$,R)=>{const M=Array.from(R),[F]=M.splice(S,1);M.splice($,0,F);const U=M.map((ae,Te)=>E(ae.id,Te));try{await Promise.all(U),console.log("ëª¨ë“  í• ì¼ ìˆœì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ",{count:U.length})}catch(ae){console.error("í• ì¼ ìˆœì„œ ì—…ë°ì´íŠ¸ ì¤‘ ì¼ë¶€ ì‹¤íŒ¨:",ae)}},Q=S=>{const $=[...e.todos,...k()],R=new Date;return R.setHours(0,0,0,0),$.filter(M=>{if(M.startDate&&!S.completionDateFilter){const F=new Date(M.startDate);if(F.setHours(0,0,0,0),F>R)return!1}if(S.searchTerm){const F=S.searchTerm.toLowerCase(),U=M.title.toLowerCase().includes(F),ae=M.description?.toLowerCase().includes(F)||!1,Te=M.tags?.some(Ne=>Ne.toLowerCase().includes(F))||!1;if(!U&&!ae&&!Te)return!1}if(S.priorityFilter&&S.priorityFilter!=="all"&&M.priority!==S.priorityFilter||S.typeFilter&&S.typeFilter!=="all"&&M.type!==S.typeFilter||S.projectFilter&&S.projectFilter!=="all"&&M.project!==S.projectFilter)return!1;if(S.tagFilter&&S.tagFilter.length>0){const F=M.tags||[];if(!S.tagFilter.some(ae=>F.includes(ae)))return!1}if(S.sharingFilterState){const{showPersonal:F,showMyShared:U,showGroupShared:ae,selectedGroupId:Te}=S.sharingFilterState;if(Te&&M.sharedGroupId!==Te&&M.sharedGroupOwnerId!==Te&&M.sharedGroupId!==Te)return!1;const Ne=M.visibility?.isPersonal!==!1,ge=M.visibility?.isShared===!0,_e=ge&&M.ownerId===s?.uid,ye=ge&&M.ownerId!==s?.uid;let De=!1;if(F&&Ne&&!ge&&(De=!0),U&&_e&&(De=!0),ae&&ye&&(De=!0),!De)return!1}else if(S.sharingFilter&&S.sharingFilter!=="all"){const F=M.visibility?.isPersonal!==!1,U=M.visibility?.isShared===!0,ae=U&&M.ownerId===s?.uid,Te=U&&M.ownerId!==s?.uid;if(S.sharingFilter==="private"){if(U||!F)return!1}else if(S.sharingFilter==="shared"){if(!Te)return!1}else if(S.sharingFilter==="my_shared"){if(!ae)return!1}else if(M.sharedGroupId!==S.sharingFilter)return!1}if(S.completionDateFilter&&S.completionDateFilter!=="all"&&M.completedAt){const F=new Date(M.completedAt),U=new Date;switch(S.completionDateFilter){case"today":if(F.toDateString()!==U.toDateString())return!1;break;case"yesterday":const ae=new Date;if(ae.setDate(U.getDate()-1),F.toDateString()!==ae.toDateString())return!1;break;case"thisWeek":const Te=new Date(U);if(Te.setDate(U.getDate()-U.getDay()),Te.setHours(0,0,0,0),F<Te)return!1;break;case"lastWeek":const Ne=new Date(U);Ne.setDate(U.getDate()-U.getDay()-7),Ne.setHours(0,0,0,0);const ge=new Date(U);if(ge.setDate(U.getDate()-U.getDay()-1),ge.setHours(23,59,59,999),F<Ne||F>ge)return!1;break;case"thisMonth":const _e=new Date(U.getFullYear(),U.getMonth(),1);if(F<_e)return!1;break}}return!(S.includeCompleted===!1&&M.completed)})},H=async S=>{console.log("=== ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì‹œì‘ ==="),console.log("currentUser:",s),console.log("templateData:",S);try{if(s){console.log("Firestore ëª¨ë“œë¡œ ì €ì¥ ì‹œë„");const $=await te.addRecurringTemplate(S,s.uid);console.log("ë°˜ë³µ í…œí”Œë¦¿ Firestore ì €ì¥ ì„±ê³µ:",$),console.log("âœ… í…œí”Œë¦¿ ì €ì¥ ì™„ë£Œ - ì¸ìŠ¤í„´ìŠ¤ëŠ” useEffectì—ì„œ ìë™ ìƒì„±ë¨")}else{console.log("ë¹„ë¡œê·¸ì¸ ëª¨ë“œ: ë©”ëª¨ë¦¬ì— ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€");const $={...S,id:fo(),createdAt:new Date,updatedAt:new Date};r({type:"ADD_RECURRING_TEMPLATE",payload:$})}console.log("=== ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì™„ë£Œ ===")}catch($){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì‹¤íŒ¨:",$),r({type:"SET_ERROR",payload:"ë°˜ë³µ í• ì¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},I=async(S,$)=>{console.log("ğŸ”§ ë°˜ë³µ í…œí”Œë¦¿ ìˆ˜ì • ì‹œì‘"),console.log("í…œí”Œë¦¿ ID:",S),console.log("ìˆ˜ì • ë°ì´í„°:",$);try{if(s)console.log("ğŸ”¥ Firebase ì‚¬ìš©ì - í…œí”Œë¦¿ë§Œ ì—…ë°ì´íŠ¸ (ì¸ìŠ¤í„´ìŠ¤ëŠ” useEffectì—ì„œ ìë™ ì²˜ë¦¬)"),console.log("1ï¸âƒ£ Firestore í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ë§Œ ìˆ˜í–‰"),await te.updateRecurringTemplate(S,$,s.uid),console.log("âœ… ë°˜ë³µ í…œí”Œë¦¿ Firestore ì—…ë°ì´íŠ¸ ì™„ë£Œ:",S),console.log("2ï¸âƒ£ ë¡œì»¬ ìƒíƒœ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸"),r({type:"UPDATE_RECURRING_TEMPLATE",payload:{id:S,updates:$}}),console.log("âœ… ë¡œì»¬ ìƒíƒœ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì™„ë£Œ"),console.log("ğŸ’¡ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„±ì€ useEffectì—ì„œ ìë™ ì²˜ë¦¬ë©ë‹ˆë‹¤.");else{console.log("ë¹„ë¡œê·¸ì¸ ëª¨ë“œ: ë©”ëª¨ë¦¬ì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸");const R=e.todos.filter(M=>M._templateId===S);console.log(`í…œí”Œë¦¿ ${S}ì—ì„œ ìƒì„±ëœ í• ì¼ ${R.length}ê°œ ë°œê²¬`);for(const M of R)console.log(`í• ì¼ ì‚­ì œ: ${M.title} (${M.id})`),r({type:"DELETE_TODO",payload:M.id});r({type:"UPDATE_RECURRING_TEMPLATE",payload:{id:S,updates:$}}),setTimeout(()=>{console.log("ì—…ë°ì´íŠ¸ëœ í…œí”Œë¦¿ìœ¼ë¡œ ìƒˆë¡œìš´ í• ì¼ ìƒì„± ì‹œì‘"),L()},100)}console.log("=== ë°˜ë³µ í…œí”Œë¦¿ ìˆ˜ì • ì™„ë£Œ ===")}catch(R){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",R),r({type:"SET_ERROR",payload:"ë°˜ë³µ í• ì¼ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},J=async S=>{try{s?(r({type:"DELETE_RECURRING_TEMPLATE",payload:S}),console.log("âœ… ì¦‰ì‹œ UIì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ì œê±°:",S),await te.deleteRecurringTemplate(S,s.uid),console.log("âœ… ë°˜ë³µ í…œí”Œë¦¿ Firestore ì‚­ì œ ì„±ê³µ:",S)):(console.log("ë¹„ë¡œê·¸ì¸ ëª¨ë“œ: ë©”ëª¨ë¦¬ì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ì‚­ì œ"),r({type:"DELETE_RECURRING_TEMPLATE",payload:S}),console.log("ğŸš« ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì - localStorage ì‚¬ìš© ë¹„í™œì„±í™”, ë©”ëª¨ë¦¬ë§Œ ì—…ë°ì´íŠ¸"))}catch($){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì‚­ì œ ì‹¤íŒ¨:",$),r({type:"SET_ERROR",payload:"ë°˜ë³µ í• ì¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},le=async()=>{if(!s)return;const S={};e.recurringTemplates.forEach(R=>{const F=[R.title,R.recurrenceType,R.recurrenceType==="weekly"?R.weekday:"",R.recurrenceType==="monthly"?`${R.monthlyDate}-${R.monthlyPattern}-${R.monthlyWeek}-${R.monthlyWeekday}`:""].join("|");S[F]||(S[F]=[]),S[F].push(R)});const $=Object.values(S).filter(R=>R.length>1);if($.length>0){console.log(`âŒ ${$.length}ê°œ ê·¸ë£¹ì˜ ì¤‘ë³µ í…œí”Œë¦¿ ë°œê²¬`);for(const R of $){const M=R.sort((ae,Te)=>new Date(Te.createdAt).getTime()-new Date(ae.createdAt).getTime()),F=M[0],U=M.slice(1);console.log(`ğŸ—‘ï¸ '${F.title}' ì¤‘ë³µ ${U.length}ê°œ ì‚­ì œ ì˜ˆì •`);for(const ae of U)await J(ae.id)}console.log("âœ… ì¤‘ë³µ ì •ë¦¬ ì™„ë£Œ")}};p.useEffect(()=>{if(e.recurringTemplates.length>0&&s){const S=setTimeout(()=>{le()},2e3);return()=>clearTimeout(S)}},[e.recurringTemplates,s]);const L=()=>{if(s){console.log("ğŸš«ğŸš«ğŸš« ë¡œê·¸ì¸ ì‚¬ìš©ì - ë¡œì»¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ì „ ì°¨ë‹¨!");return}if(n){console.log("â³ ì¸ì¦ ë¡œë”© ì¤‘ - ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ëŒ€ê¸°");return}let S=[];e.recurringTemplates.filter($=>$.isActive).forEach($=>{try{const R=Ms.generateInstances($);S=[...S,...R]}catch(R){console.error(`í…œí”Œë¦¿ ${$.id} ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:`,R)}}),r({type:"SET_RECURRING_INSTANCES",payload:S})},G=async()=>{if(!s){console.log("âŒ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ");return}console.log("ğŸ”„ Firestore ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹œì‘..."),r({type:"SET_LOADING",payload:!0});try{const S=await te.getTodos(s.uid);console.log("âœ… ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì„±ê³µ:",S.length,"ê°œ í• ì¼"),r({type:"SET_TODOS",payload:S}),r({type:"SET_ERROR",payload:null})}catch(S){console.error("âŒ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"ë°ì´í„° ìƒˆë¡œê³ ì¹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})}finally{r({type:"SET_LOADING",payload:!1})}},O=async()=>{if(!s){console.log("âŒ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì");return}console.log("ğŸš¨ ê¸´ê¸‰ ìˆ˜ì •: Firebase ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì™„ì „ ì¬ìƒì„± ì‹œì‘");try{console.log("1ï¸âƒ£ ëª¨ë“  ê¸°ì¡´ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ ì¤‘...");const S=await te.getRecurringInstances(s.uid);console.log(`ì‚­ì œí•  ì¸ìŠ¤í„´ìŠ¤ ê°œìˆ˜: ${S.length}`);for(const R of S)await te.deleteRecurringInstance(R.id,s.uid),console.log(`âœ… ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ: ${R.id}`);console.log("2ï¸âƒ£ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì¤‘...");const $=e.recurringTemplates.filter(R=>R.isActive);console.log(`í™œì„± í…œí”Œë¦¿ ê°œìˆ˜: ${$.length}`);for(const R of $){console.log(`ğŸ”„ í…œí”Œë¦¿ ì²˜ë¦¬: ${R.title} (monthlyDate: ${R.monthlyDate})`);const M=Ms.generateInstances(R);console.log(`ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤: ${M.length}ê°œ`);for(const F of M){const U={templateId:F.templateId,date:F.date,completed:!1,createdAt:F.createdAt,updatedAt:F.updatedAt},ae=await te.addRecurringInstance(U,s.uid);console.log(`âœ… ì¸ìŠ¤í„´ìŠ¤ ì €ì¥: ${ae} - ${F.date.toDateString()}`)}}console.log("3ï¸âƒ£ ë¡œì»¬ ìƒíƒœ ìƒˆë¡œê³ ì¹¨ ì¤‘..."),await G(),console.log("âœ… ê¸´ê¸‰ ìˆ˜ì • ì™„ë£Œ!"),alert(`âœ… ë°˜ë³µ í• ì¼ ë¬¸ì œê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!
í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`)}catch(S){console.error("âŒ ê¸´ê¸‰ ìˆ˜ì • ì‹¤íŒ¨:",S),alert("âŒ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},se=async()=>{if(!s){console.log("âŒ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì");return}console.log("ğŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘ (ì‚­ì œ í›„ í˜¸ì¶œ)");try{const S=await te.getTodos(s.uid);console.log("âœ… ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì„±ê³µ:",S.length,"ê°œ í• ì¼"),r({type:"SET_TODOS",payload:S})}catch(S){console.error("âŒ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:",S)}},he=p.useCallback(async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ í™•ì¸ ì¤‘...");return}try{console.log("ğŸ§¹ ê³ ì•„ ë°ì´í„° ì •ë¦¬ ì‹œì‘");const S=await wo.cleanupOrphanedInstances(s.uid);console.log("âœ… ê³ ì•„ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ:",S),alert(`âœ… ì •ë¦¬ ì™„ë£Œ!
- ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤: ${S.orphanedInstances}ê°œ
- ê³ ì•„ í• ì¼: ${S.orphanedTodos}ê°œ
- ì´ ì •ë¦¬: ${S.totalCleaned}ê°œ`),await G()}catch(S){console.error("âŒ ê³ ì•„ ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨:",S),alert("âŒ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[s]),pe=p.useCallback(async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ í™•ì¸ ì¤‘...");return}try{console.log("ğŸ” ë°ì´í„° ì •í•©ì„± ê²€ì¦ ì‹œì‘");const S=await wo.validateTemplateConsistency(s.uid);console.log("âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦ ì™„ë£Œ - ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”"),alert(`âœ… ê²€ì¦ ì™„ë£Œ!
ì´ ${S.size}ê°œ í…œí”Œë¦¿ì˜ ë°ì´í„° í˜„í™©ì„ ì½˜ì†”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.`)}catch(S){console.error("âŒ ë°ì´í„° ì •í•©ì„± ê²€ì¦ ì‹¤íŒ¨:",S),alert("âŒ ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[s]),re=p.useCallback(async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ í™•ì¸ ì¤‘...");return}if(!window.confirm(`ğŸ§¹ ì•ˆì „í•œ ì •ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

ğŸ—‘ï¸ ì‚­ì œ: ì‚­ì œëœ í…œí”Œë¦¿ì˜ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ë§Œ
âœ… ìœ ì§€: ëª¨ë“  í™œì„± í…œí”Œë¦¿ì˜ ì¸ìŠ¤í„´ìŠ¤

ë°˜ë³µ í• ì¼ë“¤ì€ ê·¸ëŒ€ë¡œ ë³´ì…ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){console.log("âŒ ì‚¬ìš©ìê°€ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤");return}try{console.log("ğŸ§¹ ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì‹œì‘");const $=await wo.smartCleanupInstances(s.uid);console.log("âœ… ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì™„ë£Œ:",$),alert(`âœ… ì•ˆì „ ì •ë¦¬ ì™„ë£Œ!

ì‚­ì œ: ${$.deletedInstances}ê°œ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤
ìœ ì§€: ${$.keptInstances}ê°œ í™œì„± ì¸ìŠ¤í„´ìŠ¤

ë°˜ë³µ í• ì¼ë“¤ ê·¸ëŒ€ë¡œ ë³´ì…ë‹ˆë‹¤! ğŸ‰`),setTimeout(()=>{window.location.reload()},1e3)}catch($){console.error("âŒ ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì‹¤íŒ¨:",$),alert("âŒ ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[s]);p.useEffect(()=>{typeof window<"u"&&(window.fixRecurringInstances=O,window.cleanupOrphanedData=he,window.validateDataConsistency=pe,window.smartCleanupInstances=re,window.checkLoginStatus=()=>{console.log("ë¡œê·¸ì¸ ìƒíƒœ:",s?"âœ… ë¡œê·¸ì¸ë¨":"âŒ ë¡œê·¸ì¸ ì•ˆë¨"),s&&console.log("ì‚¬ìš©ì:",s.email)},window.forceRegenerateInstances=async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í•„ìš”");return}console.log("ğŸ”„ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ê°•ì œ ì¬ìƒì„± ì‹œì‘...");try{await Promise.all(e.recurringTemplates.filter(S=>S.isActive!==!1).map(S=>te.regenerateRecurringInstances(S.id,s.uid))),console.log("âœ… ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”."),setTimeout(()=>window.location.reload(),1e3)}catch(S){console.error("âŒ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",S)}},window.fixBusinessTripTemplate=async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í•„ìš”");return}try{console.log("ğŸ”§ ì¶œì¥ë¹„ ì§€ê¸‰ ì‹ ì²­ í…œí”Œë¦¿ ìˆ˜ì • ì‹œì‘...");const S=e.recurringTemplates.find(R=>R.title.includes("ì¶œì¥ë¹„")&&R.title.includes("ì§€ê¸‰")&&R.title.includes("ì‹ ì²­"));if(!S){console.log("âŒ ì¶œì¥ë¹„ ì§€ê¸‰ ì‹ ì²­ í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),console.log("ğŸ“‹ í˜„ì¬ í…œí”Œë¦¿ë“¤:",e.recurringTemplates.map(R=>R.title));return}console.log("ğŸ“‹ ê¸°ì¡´ í…œí”Œë¦¿ ë°ì´í„°:",S);const $={monthlyPattern:"weekday",monthlyWeek:"fourth",monthlyWeekday:2,monthlyDate:void 0};console.log("ğŸ” ìš”ì¼ í™•ì¸:"),console.log("  0=ì¼, 1=ì›”, 2=í™”, 3=ìˆ˜, 4=ëª©, 5=ê¸ˆ, 6=í† "),console.log(`  ì„¤ì •ê°’ 2 = ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][2]}ìš”ì¼`),console.log("ğŸ”§ ì ìš©í•  ì—…ë°ì´íŠ¸:",$),await te.updateRecurringTemplate(S.id,$,s.uid),console.log("âœ… ì¶œì¥ë¹„ ì§€ê¸‰ ì‹ ì²­ í…œí”Œë¦¿ ìˆ˜ì • ì™„ë£Œ!"),console.log("ğŸ”„ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì¤‘..."),await te.regenerateRecurringInstances(S.id,s.uid),console.log("ğŸ¯ ëª¨ë“  ì‘ì—… ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”."),setTimeout(()=>window.location.reload(),1e3)}catch(S){console.error("âŒ í…œí”Œë¦¿ ìˆ˜ì • ì‹¤íŒ¨:",S)}},console.log("  - cleanupOrphanedData(): ê³ ì•„ ë°ì´í„° ì •ë¦¬"))},[]);const Ae=p.useCallback(()=>{const S={todos:e.todos,recurringTemplates:e.recurringTemplates,recurringInstances:e.recurringInstances,exportedAt:new Date().toISOString(),version:"1.0.0"};return JSON.stringify(S,null,2)},[e]),K=p.useCallback(async S=>{try{const $=JSON.parse(S);if(!$.todos)throw new Error("Invalid data format");const R=$.todos.map(M=>({...M,createdAt:new Date(M.createdAt),updatedAt:new Date(M.updatedAt),dueDate:M.dueDate?new Date(M.dueDate):void 0,startDate:M.startDate?new Date(M.startDate):void 0,completedAt:M.completedAt?new Date(M.completedAt):void 0}));return r(s?{type:"SET_TODOS",payload:R}:{type:"SET_TODOS",payload:R}),!0}catch($){return console.error("Import failed:",$),!1}},[s]),xe=p.useCallback(async()=>{const S=e.todos.filter($=>$.completed);for(const $ of S)await T($.id)},[e.todos,T]),Fe=p.useCallback(async()=>{await W()},[W]),q=p.useMemo(()=>({total:e.todos.length,completed:e.todos.filter(S=>S.completed).length,pending:e.todos.filter(S=>!S.completed).length}),[e.todos]),we=p.useMemo(()=>{const S=new Set;return e.todos.forEach($=>{$.tags?.forEach(R=>S.add(R))}),Array.from(S).sort()},[e.todos]),Be=p.useMemo(()=>({...e,addTodo:D,updateTodo:N,deleteTodo:T,toggleTodo:_,addSubTask:X,updateSubTask:V,deleteSubTask:ce,toggleSubTask:ke,syncWithFirestore:W,getTodayTodos:me,getWeekTodos:ue,getMonthTodos:Y,getOverdueTodos:ie,getTomorrowTodos:de,getYesterdayIncompleteTodos:be,isYesterdayIncompleteTodo:fe,updateTodoOrder:E,reorderTodos:ee,getFilteredTodos:Q,addRecurringTemplate:H,updateRecurringTemplate:I,deleteRecurringTemplate:J,generateRecurringInstances:L,getRecurringTodos:k,cleanupDuplicateTemplates:le,forceRefresh:G,manualRefresh:se,initializeOrderValues:P,fixRecurringInstances:O,cleanupOrphanedData:he,validateDataConsistency:pe,smartCleanupInstances:re,exportData:Ae,importData:K,clearCompleted:xe,syncWithCloud:Fe,stats:q,searchQuery:l,setSearchQuery:c,filterStatus:d,setFilterStatus:u,filterPriority:h,setFilterPriority:g,filterTags:m,setFilterTags:x,allTags:we,loadHistoricalTodos:C}),[e,D,N,T,_,X,V,ce,ke,W,me,ue,Y,ie,de,be,fe,E,ee,Q,H,I,J,L,k,le,G,se,P,O,he,pe,re,Ae,K,xe,Fe,q,l,d,h,m,we,C]);return a.jsx(Xm.Provider,{value:Be,children:t})},ot=()=>{const t=p.useContext(Xm);if(t===void 0)throw new Error("useTodos must be used within a TodoProvider");return t},rw=""+new URL("spring-BGWA7yXD.png",import.meta.url).href,sw=""+new URL("summer-CjIC62DS.png",import.meta.url).href,nw=""+new URL("autumn-BG-LnTZL.png",import.meta.url).href,aw=""+new URL("winter-DAuiEEo5.png",import.meta.url).href,iw=""+new URL("cairo-I1imc-3j.png",import.meta.url).href,ow=""+new URL("london-BoQJuASl.png",import.meta.url).href,lw=""+new URL("la-B40MlFfI.png",import.meta.url).href,cw=""+new URL("moscow-D9umQ37v.png",import.meta.url).href,dw=""+new URL("seoul-B24cE2-E.png",import.meta.url).href,uw=""+new URL("busan-Bf0kI0T7.png",import.meta.url).href,hw=""+new URL("jeju-B6AoNdX5.png",import.meta.url).href,gw=""+new URL("gyeongju-BrzVrSPq.png",import.meta.url).href,mw=""+new URL("gwangju-BRYg9XQh.png",import.meta.url).href,fw=""+new URL("tokyo-BBaYvFGH.png",import.meta.url).href,pw=""+new URL("beijing-ZpOGQqN0.png",import.meta.url).href,yw=""+new URL("hongkong-BNpYcxIk.png",import.meta.url).href,xw=""+new URL("bangkok-DXzlawOf.png",import.meta.url).href,bw=""+new URL("hanoi-Bs9-it64.png",import.meta.url).href,ls={colors:[{id:"blue",nameKey:"settings.colorTheme.blue",color:"blue",colorClass:"bg-blue-500"},{id:"sky",nameKey:"settings.colorTheme.sky",color:"sky",colorClass:"bg-sky-500"},{id:"teal",nameKey:"settings.colorTheme.teal",color:"teal",colorClass:"bg-teal-500"},{id:"green",nameKey:"settings.colorTheme.forest",color:"green",colorClass:"bg-green-500"},{id:"lime",nameKey:"settings.colorTheme.lime",color:"lime",colorClass:"bg-lime-500"},{id:"orange",nameKey:"settings.colorTheme.sunset",color:"orange",colorClass:"bg-orange-500"},{id:"red",nameKey:"settings.colorTheme.red",color:"red",colorClass:"bg-red-500"},{id:"pink",nameKey:"settings.colorTheme.berry",color:"pink",colorClass:"bg-pink-500"},{id:"purple",nameKey:"settings.colorTheme.purple",color:"purple",colorClass:"bg-purple-500"},{id:"indigo",nameKey:"settings.colorTheme.indigo",color:"indigo",colorClass:"bg-indigo-500"},{id:"gray",nameKey:"settings.colorTheme.gray",color:"gray",colorClass:"bg-gray-500"}],seasonal:[{id:"spring",nameKey:"settings.seasonal.spring",color:"pink",colorClass:"bg-pink-500",bg:rw,overlay:"bg-white/60 dark:bg-black/40"},{id:"summer",nameKey:"settings.seasonal.summer",color:"blue",colorClass:"bg-blue-500",bg:sw,overlay:"bg-white/60 dark:bg-black/40"},{id:"autumn",nameKey:"settings.seasonal.autumn",color:"orange",colorClass:"bg-orange-500",bg:nw,overlay:"bg-white/60 dark:bg-black/40"},{id:"winter",nameKey:"settings.seasonal.winter",color:"sky",colorClass:"bg-sky-500",bg:aw,overlay:"bg-white/60 dark:bg-black/40"}],city:[{id:"cairo",nameKey:"settings.city.cairo",color:"orange",colorClass:"bg-orange-500",bg:iw,overlay:"bg-white/70 dark:bg-black/50"},{id:"london",nameKey:"settings.city.london",color:"sky",colorClass:"bg-sky-500",bg:ow,overlay:"bg-white/70 dark:bg-black/50"},{id:"la",nameKey:"settings.city.la",color:"purple",colorClass:"bg-purple-500",bg:lw,overlay:"bg-white/60 dark:bg-black/40"},{id:"moscow",nameKey:"settings.city.moscow",color:"indigo",colorClass:"bg-indigo-500",bg:cw,overlay:"bg-white/60 dark:bg-black/50"},{id:"seoul",nameKey:"settings.city.seoul",color:"blue",colorClass:"bg-blue-600",bg:dw,overlay:"bg-white/60 dark:bg-black/40"},{id:"busan",nameKey:"settings.city.busan",color:"sky",colorClass:"bg-sky-500",bg:uw,overlay:"bg-white/60 dark:bg-black/40"},{id:"jeju",nameKey:"settings.city.jeju",color:"green",colorClass:"bg-green-500",bg:hw,overlay:"bg-white/60 dark:bg-black/30"},{id:"gyeongju",nameKey:"settings.city.gyeongju",color:"orange",colorClass:"bg-orange-600",bg:gw,overlay:"bg-white/60 dark:bg-black/50"},{id:"gwangju",nameKey:"settings.city.gwangju",color:"teal",colorClass:"bg-teal-600",bg:mw,overlay:"bg-white/60 dark:bg-black/40"},{id:"tokyo",nameKey:"settings.city.tokyo",color:"pink",colorClass:"bg-pink-500",bg:fw,overlay:"bg-white/60 dark:bg-black/40"},{id:"beijing",nameKey:"settings.city.beijing",color:"red",colorClass:"bg-red-600",bg:pw,overlay:"bg-white/60 dark:bg-black/40"},{id:"hongkong",nameKey:"settings.city.hongkong",color:"purple",colorClass:"bg-purple-600",bg:yw,overlay:"bg-white/60 dark:bg-black/40"},{id:"bangkok",nameKey:"settings.city.bangkok",color:"orange",colorClass:"bg-orange-500",bg:xw,overlay:"bg-white/60 dark:bg-black/40"},{id:"hanoi",nameKey:"settings.city.hanoi",color:"green",colorClass:"bg-green-600",bg:bw,overlay:"bg-white/60 dark:bg-black/40"}]},Qm=p.createContext(void 0),Et=()=>{const t=p.useContext(Qm);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t},vw=({children:t})=>{const[e,r]=p.useState(()=>localStorage.getItem("theme")||"system"),[s,n]=p.useState(!1),[i,o]=p.useState(()=>{const h=localStorage.getItem("themeTransparency");return h?parseFloat(h):.1}),[l,c]=p.useState(()=>{const h=localStorage.getItem("visualThemeId");if(!h){const g=localStorage.getItem("colorTheme");return g==="sunset"?"orange":g==="forest"?"green":g==="berry"?"pink":"blue"}return h}),u=(h=>[...ls.colors,...ls.seasonal,...ls.city].find(m=>m.id===h)||ls.colors[0])(l);return p.useEffect(()=>{const h=window.document.documentElement,g=()=>{h.classList.remove("dark");let m;e==="system"?m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":m=e,m==="dark"&&h.classList.add("dark"),n(m==="dark")};if(g(),localStorage.setItem("theme",e),e==="system"){const m=window.matchMedia("(prefers-color-scheme: dark)"),x=()=>g();return m.addEventListener("change",x),()=>m.removeEventListener("change",x)}},[e]),p.useEffect(()=>{const h=window.document.documentElement,g=document.body,m=["blue","orange","green","pink","purple","red","teal","sky","lime","indigo","gray"];h.classList.remove(...m.map(x=>`theme-${x}`)),h.classList.remove("theme-sunset","theme-forest","theme-berry"),u.color!=="blue"&&h.classList.add(`theme-${u.color}`),u.bg?(g.style.backgroundImage=`url('${u.bg}')`,g.style.backgroundSize="cover",g.style.backgroundPosition="center",g.style.backgroundAttachment="fixed",h.classList.add("has-visual-theme"),h.style.setProperty("--glass-opacity",i.toString())):(g.style.backgroundImage="",g.style.backgroundSize="",g.style.backgroundPosition="",g.style.backgroundAttachment="",h.classList.remove("has-visual-theme"),h.style.removeProperty("--glass-opacity")),localStorage.setItem("visualThemeId",l),localStorage.setItem("themeTransparency",i.toString())},[l,u,i]),a.jsx(Qm.Provider,{value:{theme:e,setTheme:r,isDark:s,currentThemeId:l,setCurrentThemeId:c,currentTheme:u,transparency:i,setTransparency:o},children:t})},ww=["lkd0115lkd@gmail.com"],Hr=t=>t?ww.includes(t):!1;var iu={};const ou="@firebase/database",lu="1.0.20";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jm="";function kw(t){Jm=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,r){r==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ht(r))}get(e){const r=this.domStorage_.getItem(this.prefixedName_(e));return r==null?null:ic(r)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,r){r==null?delete this.cache_[e]:this.cache_[e]=r}get(e){return Ir(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zm=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Tw(e)}}catch{}return new Nw},cs=Zm("localStorage"),Sw=Zm("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gs=new dm("@firebase/database"),jw=function(){let t=1;return function(){return t++}}(),ef=function(t){const e=Ix(t),r=new Ax;r.update(e);const s=r.digest();return Rx.encodeByteArray(s)},va=function(...t){let e="";for(let r=0;r<t.length;r++){const s=t[r];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=va.apply(null,s):typeof s=="object"?e+=ht(s):e+=s,e+=" "}return e};let Pn=null,cu=!0;const _w=function(t,e){oe(!0,"Can't turn on custom loggers persistently."),Gs.logLevel=um.VERBOSE,Pn=Gs.log.bind(Gs)},Nt=function(...t){if(cu===!0&&(cu=!1,Pn===null&&Sw.get("logging_enabled")===!0&&_w()),Pn){const e=va.apply(null,t);Pn(e)}},wa=function(t){return function(...e){Nt(t,...e)}},ol=function(...t){const e="FIREBASE INTERNAL ERROR: "+va(...t);Gs.error(e)},Dr=function(...t){const e=`FIREBASE FATAL ERROR: ${va(...t)}`;throw Gs.error(e),new Error(e)},Lt=function(...t){const e="FIREBASE WARNING: "+va(...t);Gs.warn(e)},Dw=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Lt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},tf=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Cw=function(t){if(document.readyState==="complete")t();else{let e=!1;const r=function(){if(!document.body){setTimeout(r,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&r()}),window.attachEvent("onload",r))}},Js="[MIN_NAME]",ks="[MAX_NAME]",an=function(t,e){if(t===e)return 0;if(t===Js||e===ks)return-1;if(e===Js||t===ks)return 1;{const r=du(t),s=du(e);return r!==null?s!==null?r-s===0?t.length-e.length:r-s:-1:s!==null?1:t<e?-1:1}},Ew=function(t,e){return t===e?0:t<e?-1:1},Tn=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+ht(e))},fc=function(t){if(typeof t!="object"||t===null)return ht(t);const e=[];for(const s in t)e.push(s);e.sort();let r="{";for(let s=0;s<e.length;s++)s!==0&&(r+=","),r+=ht(e[s]),r+=":",r+=fc(t[e[s]]);return r+="}",r},rf=function(t,e){const r=t.length;if(r<=e)return[t];const s=[];for(let n=0;n<r;n+=e)n+e>r?s.push(t.substring(n,r)):s.push(t.substring(n,n+e));return s};function Ft(t,e){for(const r in t)t.hasOwnProperty(r)&&e(r,t[r])}const sf=function(t){oe(!tf(t),"Invalid JSON number");const e=11,r=52,s=(1<<e-1)-1;let n,i,o,l,c;t===0?(i=0,o=0,n=1/t===-1/0?1:0):(n=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),s),i=l+s,o=Math.round(t*Math.pow(2,r-l)-Math.pow(2,r))):(i=0,o=Math.round(t/Math.pow(2,1-s-r))));const d=[];for(c=r;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(n?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let g=parseInt(u.substr(c,8),2).toString(16);g.length===1&&(g="0"+g),h=h+g}return h.toLowerCase()},Iw=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Aw=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Rw(t,e){let r="Unknown Error";t==="too_big"?r="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?r="Client doesn't have permission to access the desired data.":t==="unavailable"&&(r="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+r);return s.code=t.toUpperCase(),s}const Pw=new RegExp("^-?(0*)\\d{1,10}$"),Mw=-2147483648,Ow=2147483647,du=function(t){if(Pw.test(t)){const e=Number(t);if(e>=Mw&&e<=Ow)return e}return null},on=function(t){try{t()}catch(e){setTimeout(()=>{const r=e.stack||"";throw Lt("Exception was thrown by user callback.",r),e},Math.floor(0))}},Lw=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Mn=function(t,e){const r=setTimeout(t,e);return typeof r=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(r):typeof r=="object"&&r.unref&&r.unref(),r};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,r){this.appCheckProvider=r,this.appName=e.name,nm(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=r?.getImmediate({optional:!0}),this.appCheck||r?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((r,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(r,s):r(null)},0)})}addTokenChangeListener(e){var r;(r=this.appCheckProvider)===null||r===void 0||r.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){Lt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e,r,s){this.appName_=e,this.firebaseOptions_=r,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(n=>this.auth_=n)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(r=>r&&r.code==="auth/token-not-initialized"?(Nt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(r)):new Promise((r,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(r,s):r(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(r=>r.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(r=>r.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Lt(e)}}class Ka{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ka.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pc="5",nf="v",af="s",of="r",lf="f",cf=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,df="ls",uf="p",ll="ac",hf="websocket",gf="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e,r,s,n,i=!1,o="",l=!1,c=!1,d=null){this.secure=r,this.namespace=s,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=cs.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&cs.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",r=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${r}`}}function Ww(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function ff(t,e,r){oe(typeof e=="string","typeof type must == string"),oe(typeof r=="object","typeof params must == object");let s;if(e===hf)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===gf)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Ww(t)&&(r.ns=t.namespace);const n=[];return Ft(r,(i,o)=>{n.push(i+"="+o)}),s+n.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(){this.counters_={}}incrementCounter(e,r=1){Ir(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=r}get(){return $x(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ko={},To={};function yc(t){const e=t.toString();return ko[e]||(ko[e]=new Vw),ko[e]}function Uw(t,e){const r=t.toString();return To[r]||(To[r]=e()),To[r]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,r){this.closeAfterResponse=e,this.onClose=r,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,r){for(this.pendingResponses[e]=r;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let n=0;n<s.length;++n)s[n]&&on(()=>{this.onMessage_(s[n])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu="start",Hw="close",Gw="pLPCommand",zw="pRTLPCB",pf="id",yf="pw",xf="ser",Kw="cb",Yw="seg",qw="ts",Xw="d",Qw="dframe",bf=1870,vf=30,Jw=bf-vf,Zw=25e3,ek=3e4;class $s{constructor(e,r,s,n,i,o,l){this.connId=e,this.repoInfo=r,this.applicationId=s,this.appCheckToken=n,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wa(e),this.stats_=yc(r),this.urlFn=c=>(this.appCheckToken&&(c[ll]=this.appCheckToken),ff(r,gf,c))}open(e,r){this.curSegmentNum=0,this.onDisconnect_=r,this.myPacketOrderer=new Bw(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ek)),Cw(()=>{if(this.isClosed_)return;this.scriptTagHolder=new xc((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===uu)this.id=l,this.password=c;else if(o===Hw)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[uu]="t",s[xf]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[Kw]=this.scriptTagHolder.uniqueCallbackIdentifier),s[nf]=pc,this.transportSessionId&&(s[af]=this.transportSessionId),this.lastSessionId&&(s[df]=this.lastSessionId),this.applicationId&&(s[uf]=this.applicationId),this.appCheckToken&&(s[ll]=this.appCheckToken),typeof location<"u"&&location.hostname&&cf.test(location.hostname)&&(s[of]=lf);const n=this.urlFn(s);this.log_("Connecting via long-poll to "+n),this.scriptTagHolder.addTag(n,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){$s.forceAllow_=!0}static forceDisallow(){$s.forceDisallow_=!0}static isAvailable(){return $s.forceAllow_?!0:!$s.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Iw()&&!Aw()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const r=ht(e);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const s=Fx(r),n=rf(s,Jw);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,r){this.myDisconnFrame=document.createElement("iframe");const s={};s[Qw]="t",s[pf]=e,s[yf]=r,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const r=ht(e).length;this.bytesReceived+=r,this.stats_.incrementCounter("bytes_received",r)}}class xc{constructor(e,r,s,n){this.onDisconnect=s,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=jw(),window[Gw+this.uniqueCallbackIdentifier]=e,window[zw+this.uniqueCallbackIdentifier]=r,this.myIFrame=xc.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){Nt("frame writing exception"),l.stack&&Nt(l.stack),Nt(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Nt("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,r){for(this.myID=e,this.myPW=r,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[pf]=this.myID,e[yf]=this.myPW,e[xf]=this.currentSerial;let r=this.urlFn(e),s="",n=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+vf+s.length<=bf;){const o=this.pendingSegs.shift();s=s+"&"+Yw+n+"="+o.seg+"&"+qw+n+"="+o.ts+"&"+Xw+n+"="+o.d,n++}return r=r+s,this.addLongPollTag_(r,this.currentSerial),!0}else return!1}enqueueSegment(e,r,s){this.pendingSegs.push({seg:e,ts:r,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,r){this.outstandingRequests.add(r);const s=()=>{this.outstandingRequests.delete(r),this.newRequest_()},n=setTimeout(s,Math.floor(Zw)),i=()=>{clearTimeout(n),s()};this.addTag(e,i)}addTag(e,r){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const n=s.readyState;(!n||n==="loaded"||n==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),r())},s.onerror=()=>{Nt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tk=16384,rk=45e3;let li=null;typeof MozWebSocket<"u"?li=MozWebSocket:typeof WebSocket<"u"&&(li=WebSocket);class er{constructor(e,r,s,n,i,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wa(this.connId),this.stats_=yc(r),this.connURL=er.connectionURL_(r,o,l,n,s),this.nodeAdmin=r.nodeAdmin}static connectionURL_(e,r,s,n,i){const o={};return o[nf]=pc,typeof location<"u"&&location.hostname&&cf.test(location.hostname)&&(o[of]=lf),r&&(o[af]=r),s&&(o[df]=s),n&&(o[ll]=n),i&&(o[uf]=i),ff(e,hf,o)}open(e,r){this.onDisconnect=r,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,cs.set("previous_websocket_failure",!0);try{let s;Wx(),this.mySock=new li(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const n=s.message||s.data;n&&this.log_(n),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const n=s.message||s.data;n&&this.log_(n),this.onClosed_()}}start(){}static forceDisallow(){er.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const r=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(r);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&li!==null&&!er.forceDisallow_}static previouslyFailed(){return cs.isInMemoryStorage||cs.get("previous_websocket_failure")===!0}markConnectionHealthy(){cs.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const r=this.frames.join("");this.frames=null;const s=ic(r);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(oe(this.frames===null,"We already have a frame buffer"),e.length<=6){const r=Number(e);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const r=e.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{const s=this.extractFrameCount_(r);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const r=ht(e);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const s=rf(r,tk);s.length>1&&this.sendString_(String(s.length));for(let n=0;n<s.length;n++)this.sendString_(s[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(rk))}sendString_(e){try{this.mySock.send(e)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}er.responsesRequiredToBeHealthy=2;er.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{static get ALL_TRANSPORTS(){return[$s,er]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const r=er&&er.isAvailable();let s=r&&!er.previouslyFailed();if(e.webSocketOnly&&(r||Lt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[er];else{const n=this.transports_=[];for(const i of Jn.ALL_TRANSPORTS)i&&i.isAvailable()&&n.push(i);Jn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Jn.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sk=6e4,nk=5e3,ak=10*1024,ik=100*1024,No="t",hu="d",ok="s",gu="r",lk="e",mu="o",fu="a",pu="n",yu="p",ck="h";class dk{constructor(e,r,s,n,i,o,l,c,d,u){this.id=e,this.repoInfo_=r,this.applicationId_=s,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wa("c:"+this.id+":"),this.transportManager_=new Jn(r),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const r=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(r,s)},Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=Mn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ik?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>ak?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return r=>{e===this.conn_?this.onConnectionLost_(r):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return r=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(r):e===this.secondaryConn_?this.onSecondaryMessageReceived_(r):this.log_("message on old connection"))}}sendRequest(e){const r={t:"d",d:e};this.sendData_(r)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(No in e){const r=e[No];r===fu?this.upgradeIfSecondaryHealthy_():r===gu?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):r===mu&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const r=Tn("t",e),s=Tn("d",e);if(r==="c")this.onSecondaryControl_(s);else if(r==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+r)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:yu,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:fu,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:pu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const r=Tn("t",e),s=Tn("d",e);r==="c"?this.onControl_(s):r==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const r=Tn(No,e);if(hu in e){const s=e[hu];if(r===ck){const n=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(n.h=this.repoInfo_.host),this.onHandshake_(n)}else if(r===pu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let n=0;n<this.pendingDataMessages.length;++n)this.onDataMessage_(this.pendingDataMessages[n]);this.pendingDataMessages=[],this.tryCleanupConnection()}else r===ok?this.onConnectionShutdown_(s):r===gu?this.onReset_(s):r===lk?ol("Server Error: "+s):r===mu?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ol("Unknown control packet command: "+r)}}onHandshake_(e){const r=e.ts,s=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,r),pc!==s&&Lt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const r=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(r,s),Mn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(sk))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,r){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(r,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Mn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(nk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:yu,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(cs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{put(e,r,s,n){}merge(e,r,s,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,r,s){}onDisconnectMerge(e,r,s){}onDisconnectCancel(e,r){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kf=class{constructor(e){this.allowedEvents_=e,this.listeners_={},oe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...r){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let n=0;n<s.length;n++)s[n].callback.apply(s[n].context,r)}}on(e,r,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:r,context:s});const n=this.getInitialEvent(e);n&&r.apply(s,n)}off(e,r,s){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===r&&(!s||s===n[i].context)){n.splice(i,1);return}}validateEventType_(e){oe(this.allowedEvents_.find(r=>r===e),"Unknown event: "+e)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci extends kf{static getInstance(){return new ci}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!fm()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return oe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xu=32,bu=768;class ze{constructor(e,r){if(r===void 0){this.pieces_=e.split("/");let s=0;for(let n=0;n<this.pieces_.length;n++)this.pieces_[n].length>0&&(this.pieces_[s]=this.pieces_[n],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=r}toString(){let e="";for(let r=this.pieceNum_;r<this.pieces_.length;r++)this.pieces_[r]!==""&&(e+="/"+this.pieces_[r]);return e||"/"}}function Ve(){return new ze("")}function Oe(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Yr(t){return t.pieces_.length-t.pieceNum_}function Ye(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new ze(t.pieces_,e)}function Tf(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function uk(t){let e="";for(let r=t.pieceNum_;r<t.pieces_.length;r++)t.pieces_[r]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[r])));return e||"/"}function Nf(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Sf(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let r=t.pieceNum_;r<t.pieces_.length-1;r++)e.push(t.pieces_[r]);return new ze(e,0)}function gt(t,e){const r=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)r.push(t.pieces_[s]);if(e instanceof ze)for(let s=e.pieceNum_;s<e.pieces_.length;s++)r.push(e.pieces_[s]);else{const s=e.split("/");for(let n=0;n<s.length;n++)s[n].length>0&&r.push(s[n])}return new ze(r,0)}function $e(t){return t.pieceNum_>=t.pieces_.length}function Dt(t,e){const r=Oe(t),s=Oe(e);if(r===null)return e;if(r===s)return Dt(Ye(t),Ye(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function bc(t,e){if(Yr(t)!==Yr(e))return!1;for(let r=t.pieceNum_,s=e.pieceNum_;r<=t.pieces_.length;r++,s++)if(t.pieces_[r]!==e.pieces_[s])return!1;return!0}function sr(t,e){let r=t.pieceNum_,s=e.pieceNum_;if(Yr(t)>Yr(e))return!1;for(;r<t.pieces_.length;){if(t.pieces_[r]!==e.pieces_[s])return!1;++r,++s}return!0}class hk{constructor(e,r){this.errorPrefix_=r,this.parts_=Nf(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=$i(this.parts_[s]);jf(this)}}function gk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=$i(e),jf(t)}function mk(t){const e=t.parts_.pop();t.byteLength_-=$i(e),t.parts_.length>0&&(t.byteLength_-=1)}function jf(t){if(t.byteLength_>bu)throw new Error(t.errorPrefix_+"has a key path longer than "+bu+" bytes ("+t.byteLength_+").");if(t.parts_.length>xu)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+xu+") or object contains a cycle "+ss(t))}function ss(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc extends kf{static getInstance(){return new vc}constructor(){super(["visible"]);let e,r;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(r="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(r="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(r="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(r="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,r&&document.addEventListener(r,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return oe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nn=1e3,fk=300*1e3,vu=30*1e3,pk=1.3,yk=3e4,xk="server_kill",wu=3;class _r extends wf{constructor(e,r,s,n,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=r,this.onDataUpdate_=s,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=_r.nextPersistentConnectionId_++,this.log_=wa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Nn,this.maxReconnectDelay_=fk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");vc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ci.getInstance().on("online",this.onOnline_,this)}sendRequest(e,r,s){const n=++this.requestNumber_,i={r:n,a:e,b:r};this.log_(ht(i)),oe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[n]=s)}get(e){this.initConnection_();const r=new lc,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),r.promise}listen(e,r,s,n){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),oe(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:n,hashFn:r,query:e,tag:s};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const r=this.outstandingGets_[e];this.sendRequest("g",r.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(s)})}sendListen_(e){const r=e.query,s=r._path.toString(),n=r._queryIdentifier;this.log_("Listen on "+s+" for "+n);const i={p:s},o="q";e.tag&&(i.q=r._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;_r.warnOnListenWarnings_(c,r),(this.listens.get(s)&&this.listens.get(s).get(n))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(s,n),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,r){if(e&&typeof e=="object"&&Ir(e,"w")){const s=Xs(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const n='".indexOn": "'+r._queryParams.getIndex().toString()+'"',i=r._path.toString();Lt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${n} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Mx(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=vu)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,r=Ox(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(r,s,n=>{const i=n.s,o=n.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const r=e.s,s=e.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,s)})}unlisten(e,r){const s=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+n),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,n)&&this.connected_&&this.sendUnlisten_(s,n,e._queryObject,r)}sendUnlisten_(e,r,s,n){this.log_("Unlisten on "+e+" for "+r);const i={p:e},o="n";n&&(i.q=s,i.t=n),this.sendRequest(o,i)}onDisconnectPut(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:r,onComplete:s})}onDisconnectMerge(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:r,onComplete:s})}onDisconnectCancel(e,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(e,r,s,n){const i={p:r,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{n&&setTimeout(()=>{n(o.s,o.d)},Math.floor(0))})}put(e,r,s,n){this.putInternal("p",e,r,s,n)}merge(e,r,s,n){this.putInternal("m",e,r,s,n)}putInternal(e,r,s,n,i){this.initConnection_();const o={p:r,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(e){const r=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,s,i=>{this.log_(r+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),n&&n(i.s,i.d)})}reportStats(e){if(this.connected_){const r={c:e};this.log_("reportStats",r),this.sendRequest("s",r,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ht(e));const r=e.r,s=this.requestCBHash_[r];s&&(delete this.requestCBHash_[r],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,r){this.log_("handleServerMessage",e,r),e==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):e==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):e==="c"?this.onListenRevoked_(r.p,r.q):e==="ac"?this.onAuthRevoked_(r.s,r.d):e==="apc"?this.onAppCheckRevoked_(r.s,r.d):e==="sd"?this.onSecurityDebugPacket_(r):ol("Unrecognized action received from server: "+ht(e)+`
Are you using the latest client?`)}onReady_(e,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){oe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Nn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Nn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>yk&&(this.reconnectDelay_=Nn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let r=Math.max(0,this.reconnectDelay_-e);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*pk)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),n=this.id+":"+_r.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},d=function(h){oe(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,g]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?Nt("getToken() completed but was canceled"):(Nt("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=g&&g.token,l=new dk(n,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,s,m=>{Lt(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(xk)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Lt(h),c())}}}interrupt(e){Nt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Nt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Wd(this.interruptReasons_)&&(this.reconnectDelay_=Nn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const r=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const r=this.outstandingPuts_[e];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,r){let s;r?s=r.map(i=>fc(i)).join("$"):s="default";const n=this.removeListen_(e,s);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,r){const s=new ze(e).toString();let n;if(this.listens.has(s)){const i=this.listens.get(s);n=i.get(r),i.delete(r),i.size===0&&this.listens.delete(s)}else n=void 0;return n}onAuthRevoked_(e,r){Nt("Auth token revoked: "+e+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=wu&&(this.reconnectDelay_=vu,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,r){Nt("App check token revoked: "+e+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=wu&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const r of e.values())this.sendListen_(r);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let r="js";e["sdk."+r+"."+Jm.replace(/\./g,"-")]=1,fm()?e["framework.cordova"]=1:Lx()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ci.getInstance().currentlyOnline();return Wd(this.interruptReasons_)&&e}}_r.nextPersistentConnectionId_=0;_r.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,r){this.name=e,this.node=r}static Wrap(e,r){return new Le(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,r){const s=new Le(Js,e),n=new Le(Js,r);return this.compare(s,n)!==0}minPost(){return Le.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oa;class _f extends Ui{static get __EMPTY_NODE(){return Oa}static set __EMPTY_NODE(e){Oa=e}compare(e,r){return an(e.name,r.name)}isDefinedOn(e){throw xa("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,r){return!1}minPost(){return Le.MIN}maxPost(){return new Le(ks,Oa)}makePost(e,r){return oe(typeof e=="string","KeyIndex indexValue must always be a string."),new Le(e,Oa)}toString(){return".key"}}const zs=new _f;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,r,s,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=r?s(e.key,r):1,n&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),r;if(this.resultGenerator_?r=this.resultGenerator_(e.key,e.value):r={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return r}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class pt{constructor(e,r,s,n,i){this.key=e,this.value=r,this.color=s??pt.RED,this.left=n??Pt.EMPTY_NODE,this.right=i??Pt.EMPTY_NODE}copy(e,r,s,n,i){return new pt(e??this.key,r??this.value,s??this.color,n??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,s){let n=this;const i=s(e,n.key);return i<0?n=n.copy(null,null,null,n.left.insert(e,r,s),null):i===0?n=n.copy(null,r,null,null,null):n=n.copy(null,null,null,null,n.right.insert(e,r,s)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return Pt.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,r){let s,n;if(s=this,r(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,r),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),r(e,s.key)===0){if(s.right.isEmpty())return Pt.EMPTY_NODE;n=s.right.min_(),s=s.copy(n.key,n.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,r))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,pt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,pt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}pt.RED=!0;pt.BLACK=!1;class bk{copy(e,r,s,n,i){return this}insert(e,r,s){return new pt(e,r,null)}remove(e,r){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Pt{constructor(e,r=Pt.EMPTY_NODE){this.comparator_=e,this.root_=r}insert(e,r){return new Pt(this.comparator_,this.root_.insert(e,r,this.comparator_).copy(null,null,pt.BLACK,null,null))}remove(e){return new Pt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,pt.BLACK,null,null))}get(e){let r,s=this.root_;for(;!s.isEmpty();){if(r=this.comparator_(e,s.key),r===0)return s.value;r<0?s=s.left:r>0&&(s=s.right)}return null}getPredecessorKey(e){let r,s=this.root_,n=null;for(;!s.isEmpty();)if(r=this.comparator_(e,s.key),r===0){if(s.left.isEmpty())return n?n.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else r<0?s=s.left:r>0&&(n=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new La(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,r){return new La(this.root_,e,this.comparator_,!1,r)}getReverseIteratorFrom(e,r){return new La(this.root_,e,this.comparator_,!0,r)}getReverseIterator(e){return new La(this.root_,null,this.comparator_,!0,e)}}Pt.EMPTY_NODE=new bk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vk(t,e){return an(t.name,e.name)}function wc(t,e){return an(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cl;function wk(t){cl=t}const Df=function(t){return typeof t=="number"?"number:"+sf(t):"string:"+t},Cf=function(t){if(t.isLeafNode()){const e=t.val();oe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ir(e,".sv"),"Priority must be a string or number.")}else oe(t===cl||t.isEmpty(),"priority of unexpected type.");oe(t===cl||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ku;class ft{static set __childrenNodeConstructor(e){ku=e}static get __childrenNodeConstructor(){return ku}constructor(e,r=ft.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=r,this.lazyHash_=null,oe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Cf(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ft(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ft.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return $e(e)?this:Oe(e)===".priority"?this.priorityNode_:ft.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,r){return null}updateImmediateChild(e,r){return e===".priority"?this.updatePriority(r):r.isEmpty()&&e!==".priority"?this:ft.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,r).updatePriority(this.priorityNode_)}updateChild(e,r){const s=Oe(e);return s===null?r:r.isEmpty()&&s!==".priority"?this:(oe(s!==".priority"||Yr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,ft.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ye(e),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,r){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Df(this.priorityNode_.val())+":");const r=typeof this.value_;e+=r+":",r==="number"?e+=sf(this.value_):e+=this.value_,this.lazyHash_=ef(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ft.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ft.__childrenNodeConstructor?-1:(oe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const r=typeof e.value_,s=typeof this.value_,n=ft.VALUE_TYPE_ORDER.indexOf(r),i=ft.VALUE_TYPE_ORDER.indexOf(s);return oe(n>=0,"Unknown leaf type: "+r),oe(i>=0,"Unknown leaf type: "+s),n===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const r=e;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}ft.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ef,If;function kk(t){Ef=t}function Tk(t){If=t}class Nk extends Ui{compare(e,r){const s=e.node.getPriority(),n=r.node.getPriority(),i=s.compareTo(n);return i===0?an(e.name,r.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,r){return!e.getPriority().equals(r.getPriority())}minPost(){return Le.MIN}maxPost(){return new Le(ks,new ft("[PRIORITY-POST]",If))}makePost(e,r){const s=Ef(e);return new Le(r,new ft("[PRIORITY-POST]",s))}toString(){return".priority"}}const it=new Nk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=Math.log(2);class jk{constructor(e){const r=i=>parseInt(Math.log(i)/Sk,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=r(e+1),this.current_=this.count-1;const n=s(this.count);this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const di=function(t,e,r,s){t.sort(e);const n=function(c,d){const u=d-c;let h,g;if(u===0)return null;if(u===1)return h=t[c],g=r?r(h):h,new pt(g,h.node,pt.BLACK,null,null);{const m=parseInt(u/2,10)+c,x=n(c,m),f=n(m+1,d);return h=t[m],g=r?r(h):h,new pt(g,h.node,pt.BLACK,x,f)}},i=function(c){let d=null,u=null,h=t.length;const g=function(x,f){const y=h-x,w=h;h-=x;const v=n(y+1,w),k=t[y],b=r?r(k):k;m(new pt(b,k.node,f,null,v))},m=function(x){d?(d.left=x,d=x):(u=x,d=x)};for(let x=0;x<c.count;++x){const f=c.nextBitIsOne(),y=Math.pow(2,c.count-(x+1));f?g(y,pt.BLACK):(g(y,pt.BLACK),g(y,pt.RED))}return u},o=new jk(t.length),l=i(o);return new Pt(s||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let So;const Es={};class jr{static get Default(){return oe(Es&&it,"ChildrenNode.ts has not been loaded"),So=So||new jr({".priority":Es},{".priority":it}),So}constructor(e,r){this.indexes_=e,this.indexSet_=r}get(e){const r=Xs(this.indexes_,e);if(!r)throw new Error("No index defined for "+e);return r instanceof Pt?r:null}hasIndex(e){return Ir(this.indexSet_,e.toString())}addIndex(e,r){oe(e!==zs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let n=!1;const i=r.getIterator(Le.Wrap);let o=i.getNext();for(;o;)n=n||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let l;n?l=di(s,e.getCompare()):l=Es;const c=e.toString(),d=Object.assign({},this.indexSet_);d[c]=e;const u=Object.assign({},this.indexes_);return u[c]=l,new jr(u,d)}addToIndexes(e,r){const s=ti(this.indexes_,(n,i)=>{const o=Xs(this.indexSet_,i);if(oe(o,"Missing index implementation for "+i),n===Es)if(o.isDefinedOn(e.node)){const l=[],c=r.getIterator(Le.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),di(l,o.getCompare())}else return Es;else{const l=r.get(e.name);let c=n;return l&&(c=c.remove(new Le(e.name,l))),c.insert(e,e.node)}});return new jr(s,this.indexSet_)}removeFromIndexes(e,r){const s=ti(this.indexes_,n=>{if(n===Es)return n;{const i=r.get(e.name);return i?n.remove(new Le(e.name,i)):n}});return new jr(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sn;class je{static get EMPTY_NODE(){return Sn||(Sn=new je(new Pt(wc),null,jr.Default))}constructor(e,r,s){this.children_=e,this.priorityNode_=r,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Cf(this.priorityNode_),this.children_.isEmpty()&&oe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Sn}updatePriority(e){return this.children_.isEmpty()?this:new je(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const r=this.children_.get(e);return r===null?Sn:r}}getChild(e){const r=Oe(e);return r===null?this:this.getImmediateChild(r).getChild(Ye(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,r){if(oe(r,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(r);{const s=new Le(e,r);let n,i;r.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(n=this.children_.insert(e,r),i=this.indexMap_.addToIndexes(s,this.children_));const o=n.isEmpty()?Sn:this.priorityNode_;return new je(n,o,i)}}updateChild(e,r){const s=Oe(e);if(s===null)return r;{oe(Oe(e)!==".priority"||Yr(e)===1,".priority must be the last token in a path");const n=this.getImmediateChild(s).updateChild(Ye(e),r);return this.updateImmediateChild(s,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const r={};let s=0,n=0,i=!0;if(this.forEachChild(it,(o,l)=>{r[o]=l.val(e),s++,i&&je.INTEGER_REGEXP_.test(o)?n=Math.max(n,Number(o)):i=!1}),!e&&i&&n<2*s){const o=[];for(const l in r)o[l]=r[l];return o}else return e&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Df(this.getPriority().val())+":"),this.forEachChild(it,(r,s)=>{const n=s.hash();n!==""&&(e+=":"+r+":"+n)}),this.lazyHash_=e===""?"":ef(e)}return this.lazyHash_}getPredecessorChildName(e,r,s){const n=this.resolveIndex_(s);if(n){const i=n.getPredecessorKey(new Le(e,r));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const r=this.resolveIndex_(e);if(r){const s=r.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const r=this.getFirstChildName(e);return r?new Le(r,this.children_.get(r)):null}getLastChildName(e){const r=this.resolveIndex_(e);if(r){const s=r.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const r=this.getLastChildName(e);return r?new Le(r,this.children_.get(r)):null}forEachChild(e,r){const s=this.resolveIndex_(e);return s?s.inorderTraversal(n=>r(n.name,n.node)):this.children_.inorderTraversal(r)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,r){const s=this.resolveIndex_(r);if(s)return s.getIteratorFrom(e,n=>n);{const n=this.children_.getIteratorFrom(e.name,Le.Wrap);let i=n.peek();for(;i!=null&&r.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,r){const s=this.resolveIndex_(r);if(s)return s.getReverseIteratorFrom(e,n=>n);{const n=this.children_.getReverseIteratorFrom(e.name,Le.Wrap);let i=n.peek();for(;i!=null&&r.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ka?-1:0}withIndex(e){if(e===zs||this.indexMap_.hasIndex(e))return this;{const r=this.indexMap_.addIndex(e,this.children_);return new je(this.children_,this.priorityNode_,r)}}isIndexed(e){return e===zs||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const r=e;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){const s=this.getIterator(it),n=r.getIterator(it);let i=s.getNext(),o=n.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=n.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===zs?null:this.indexMap_.get(e.toString())}}je.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class _k extends je{constructor(){super(new Pt(wc),je.EMPTY_NODE,jr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return je.EMPTY_NODE}isEmpty(){return!1}}const ka=new _k;Object.defineProperties(Le,{MIN:{value:new Le(Js,je.EMPTY_NODE)},MAX:{value:new Le(ks,ka)}});_f.__EMPTY_NODE=je.EMPTY_NODE;ft.__childrenNodeConstructor=je;wk(ka);Tk(ka);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dk=!0;function xt(t,e=null){if(t===null)return je.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),oe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const r=t;return new ft(r,xt(e))}if(!(t instanceof Array)&&Dk){const r=[];let s=!1;if(Ft(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=xt(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),r.push(new Le(o,c)))}}),r.length===0)return je.EMPTY_NODE;const i=di(r,vk,o=>o.name,wc);if(s){const o=di(r,it.getCompare());return new je(i,xt(e),new jr({".priority":o},{".priority":it}))}else return new je(i,xt(e),jr.Default)}else{let r=je.EMPTY_NODE;return Ft(t,(s,n)=>{if(Ir(t,s)&&s.substring(0,1)!=="."){const i=xt(n);(i.isLeafNode()||!i.isEmpty())&&(r=r.updateImmediateChild(s,i))}}),r.updatePriority(xt(e))}}kk(xt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck extends Ui{constructor(e){super(),this.indexPath_=e,oe(!$e(e)&&Oe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,r){const s=this.extractChild(e.node),n=this.extractChild(r.node),i=s.compareTo(n);return i===0?an(e.name,r.name):i}makePost(e,r){const s=xt(e),n=je.EMPTY_NODE.updateChild(this.indexPath_,s);return new Le(r,n)}maxPost(){const e=je.EMPTY_NODE.updateChild(this.indexPath_,ka);return new Le(ks,e)}toString(){return Nf(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek extends Ui{compare(e,r){const s=e.node.compareTo(r.node);return s===0?an(e.name,r.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,r){return!e.equals(r)}minPost(){return Le.MIN}maxPost(){return Le.MAX}makePost(e,r){const s=xt(e);return new Le(r,s)}toString(){return".value"}}const Ik=new Ek;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(t){return{type:"value",snapshotNode:t}}function Zs(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Zn(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function ea(t,e,r){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:r}}function Ak(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(e){this.index_=e}updateChild(e,r,s,n,i,o){oe(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(r);return l.getChild(n).equals(s.getChild(n))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(r)?o.trackChildChange(Zn(r,l)):oe(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Zs(r,s)):o.trackChildChange(ea(r,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(r,s).withIndex(this.index_)}updateFullNode(e,r,s){return s!=null&&(e.isLeafNode()||e.forEachChild(it,(n,i)=>{r.hasChild(n)||s.trackChildChange(Zn(n,i))}),r.isLeafNode()||r.forEachChild(it,(n,i)=>{if(e.hasChild(n)){const o=e.getImmediateChild(n);o.equals(i)||s.trackChildChange(ea(n,i,o))}else s.trackChildChange(Zs(n,i))})),r.withIndex(this.index_)}updatePriority(e,r){return e.isEmpty()?je.EMPTY_NODE:e.updatePriority(r)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e){this.indexedFilter_=new kc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ta.getStartPost_(e),this.endPost_=ta.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const r=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return r&&s}updateChild(e,r,s,n,i,o){return this.matches(new Le(r,s))||(s=je.EMPTY_NODE),this.indexedFilter_.updateChild(e,r,s,n,i,o)}updateFullNode(e,r,s){r.isLeafNode()&&(r=je.EMPTY_NODE);let n=r.withIndex(this.index_);n=n.updatePriority(je.EMPTY_NODE);const i=this;return r.forEachChild(it,(o,l)=>{i.matches(new Le(o,l))||(n=n.updateImmediateChild(o,je.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,s)}updatePriority(e,r){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const r=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),r)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const r=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),r)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e){this.withinDirectionalStart=r=>this.reverse_?this.withinEndPost(r):this.withinStartPost(r),this.withinDirectionalEnd=r=>this.reverse_?this.withinStartPost(r):this.withinEndPost(r),this.withinStartPost=r=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),r);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=r=>{const s=this.index_.compare(r,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new ta(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,r,s,n,i,o){return this.rangedFilter_.matches(new Le(r,s))||(s=je.EMPTY_NODE),e.getImmediateChild(r).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,r,s,n,i,o):this.fullLimitUpdateChild_(e,r,s,i,o)}updateFullNode(e,r,s){let n;if(r.isLeafNode()||r.isEmpty())n=je.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<r.numChildren()&&r.isIndexed(this.index_)){n=je.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=r.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=r.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))n=n.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{n=r.withIndex(this.index_),n=n.updatePriority(je.EMPTY_NODE);let i;this.reverse_?i=n.getReverseIterator(this.index_):i=n.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:n=n.updateImmediateChild(l.name,je.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,s)}updatePriority(e,r){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,r,s,n,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(g,m)=>h(m,g)}else o=this.index_.getCompare();const l=e;oe(l.numChildren()===this.limit_,"");const c=new Le(r,s),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(r)){const h=l.getImmediateChild(r);let g=n.getChildAfterChild(this.index_,d,this.reverse_);for(;g!=null&&(g.name===r||l.hasChild(g.name));)g=n.getChildAfterChild(this.index_,g,this.reverse_);const m=g==null?1:o(g,c);if(u&&!s.isEmpty()&&m>=0)return i?.trackChildChange(ea(r,s,h)),l.updateImmediateChild(r,s);{i?.trackChildChange(Zn(r,h));const f=l.updateImmediateChild(r,je.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(i?.trackChildChange(Zs(g.name,g.node)),f.updateImmediateChild(g.name,g.node)):f}}else return s.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(Zn(d.name,d.node)),i.trackChildChange(Zs(r,s))),l.updateImmediateChild(r,s).updateImmediateChild(d.name,je.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=it}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return oe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return oe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Js}hasEnd(){return this.endSet_}getIndexEndValue(){return oe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return oe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ks}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return oe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===it}copy(){const e=new Tc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Pk(t){return t.loadsAllData()?new kc(t.getIndex()):t.hasLimit()?new Rk(t):new ta(t)}function Tu(t){const e={};if(t.isDefault())return e;let r;if(t.index_===it?r="$priority":t.index_===Ik?r="$value":t.index_===zs?r="$key":(oe(t.index_ instanceof Ck,"Unrecognized index type!"),r=t.index_.toString()),e.orderBy=ht(r),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=ht(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+ht(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=ht(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+ht(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Nu(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let r=t.viewFrom_;r===""&&(t.isViewFromLeft()?r="l":r="r"),e.vf=r}return t.index_!==it&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui extends wf{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,r){return r!==void 0?"tag$"+r:(oe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,r,s,n){super(),this.repoInfo_=e,this.onDataUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=n,this.log_=wa("p:rest:"),this.listens_={}}listen(e,r,s,n){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=ui.getListenId_(e,s),l={};this.listens_[o]=l;const c=Tu(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(i,h,!1,s),Xs(this.listens_,o)===l){let g;d?d===401?g="permission_denied":g="rest_error:"+d:g="ok",n(g,null)}})}unlisten(e,r){const s=ui.getListenId_(e,r);delete this.listens_[s]}get(e){const r=Tu(e._queryParams),s=e._path.toString(),n=new lc;return this.restRequest_(s+".json",r,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(s,l,!1,null),n.resolve(l)):n.reject(new Error(l))}),n.promise}refreshAuthToken(e){}restRequest_(e,r={},s){return r.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(r.auth=n.accessToken),i&&i.token&&(r.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Px(r);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=ic(l.responseText)}catch{Lt("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&Lt("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{constructor(){this.rootNode_=je.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,r){this.rootNode_=this.rootNode_.updateChild(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hi(){return{value:null,children:new Map}}function Rf(t,e,r){if($e(e))t.value=r,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,r);else{const s=Oe(e);t.children.has(s)||t.children.set(s,hi());const n=t.children.get(s);e=Ye(e),Rf(n,e,r)}}function dl(t,e,r){t.value!==null?r(e,t.value):Ok(t,(s,n)=>{const i=new ze(e.toString()+"/"+s);dl(n,i,r)})}function Ok(t,e){t.children.forEach((r,s)=>{e(s,r)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),r=Object.assign({},e);return this.last_&&Ft(this.last_,(s,n)=>{r[s]=r[s]-n}),this.last_=e,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Su=10*1e3,$k=30*1e3,Fk=300*1e3;class Wk{constructor(e,r){this.server_=r,this.statsToReport_={},this.statsListener_=new Lk(e);const s=Su+($k-Su)*Math.random();Mn(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),r={};let s=!1;Ft(e,(n,i)=>{i>0&&Ir(this.statsToReport_,n)&&(r[n]=i,s=!0)}),s&&this.server_.reportStats(r),Mn(this.reportStats_.bind(this),Math.floor(Math.random()*2*Fk))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(nr||(nr={}));function Pf(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Nc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Sc(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,r,s){this.path=e,this.affectedTree=r,this.revert=s,this.type=nr.ACK_USER_WRITE,this.source=Pf()}operationForChild(e){if($e(this.path)){if(this.affectedTree.value!=null)return oe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const r=this.affectedTree.subtree(new ze(e));return new gi(Ve(),r,this.revert)}}else return oe(Oe(this.path)===e,"operationForChild called for unrelated child."),new gi(Ye(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e,r){this.source=e,this.path=r,this.type=nr.LISTEN_COMPLETE}operationForChild(e){return $e(this.path)?new ra(this.source,Ve()):new ra(this.source,Ye(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e,r,s){this.source=e,this.path=r,this.snap=s,this.type=nr.OVERWRITE}operationForChild(e){return $e(this.path)?new Ts(this.source,Ve(),this.snap.getImmediateChild(e)):new Ts(this.source,Ye(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e,r,s){this.source=e,this.path=r,this.children=s,this.type=nr.MERGE}operationForChild(e){if($e(this.path)){const r=this.children.subtree(new ze(e));return r.isEmpty()?null:r.value?new Ts(this.source,Ve(),r.value):new sa(this.source,Ve(),r)}else return oe(Oe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new sa(this.source,Ye(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qr{constructor(e,r,s){this.node_=e,this.fullyInitialized_=r,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if($e(e))return this.isFullyInitialized()&&!this.filtered_;const r=Oe(e);return this.isCompleteForChild(r)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Uk(t,e,r,s){const n=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Ak(o.childName,o.snapshotNode))}),jn(t,n,"child_removed",e,s,r),jn(t,n,"child_added",e,s,r),jn(t,n,"child_moved",i,s,r),jn(t,n,"child_changed",e,s,r),jn(t,n,"value",e,s,r),n}function jn(t,e,r,s,n,i){const o=s.filter(l=>l.type===r);o.sort((l,c)=>Hk(t,l,c)),o.forEach(l=>{const c=Bk(t,l,i);n.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function Bk(t,e,r){return e.type==="value"||e.type==="child_removed"||(e.prevName=r.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Hk(t,e,r){if(e.childName==null||r.childName==null)throw xa("Should only compare child_ events.");const s=new Le(e.childName,e.snapshotNode),n=new Le(r.childName,r.snapshotNode);return t.index_.compare(s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bi(t,e){return{eventCache:t,serverCache:e}}function On(t,e,r,s){return Bi(new qr(e,r,s),t.serverCache)}function Mf(t,e,r,s){return Bi(t.eventCache,new qr(e,r,s))}function mi(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ns(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jo;const Gk=()=>(jo||(jo=new Pt(Ew)),jo);class Qe{static fromObject(e){let r=new Qe(null);return Ft(e,(s,n)=>{r=r.set(new ze(s),n)}),r}constructor(e,r=Gk()){this.value=e,this.children=r}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,r){if(this.value!=null&&r(this.value))return{path:Ve(),value:this.value};if($e(e))return null;{const s=Oe(e),n=this.children.get(s);if(n!==null){const i=n.findRootMostMatchingPathAndValue(Ye(e),r);return i!=null?{path:gt(new ze(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if($e(e))return this;{const r=Oe(e),s=this.children.get(r);return s!==null?s.subtree(Ye(e)):new Qe(null)}}set(e,r){if($e(e))return new Qe(r,this.children);{const s=Oe(e),i=(this.children.get(s)||new Qe(null)).set(Ye(e),r),o=this.children.insert(s,i);return new Qe(this.value,o)}}remove(e){if($e(e))return this.children.isEmpty()?new Qe(null):new Qe(null,this.children);{const r=Oe(e),s=this.children.get(r);if(s){const n=s.remove(Ye(e));let i;return n.isEmpty()?i=this.children.remove(r):i=this.children.insert(r,n),this.value===null&&i.isEmpty()?new Qe(null):new Qe(this.value,i)}else return this}}get(e){if($e(e))return this.value;{const r=Oe(e),s=this.children.get(r);return s?s.get(Ye(e)):null}}setTree(e,r){if($e(e))return r;{const s=Oe(e),i=(this.children.get(s)||new Qe(null)).setTree(Ye(e),r);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new Qe(this.value,o)}}fold(e){return this.fold_(Ve(),e)}fold_(e,r){const s={};return this.children.inorderTraversal((n,i)=>{s[n]=i.fold_(gt(e,n),r)}),r(e,this.value,s)}findOnPath(e,r){return this.findOnPath_(e,Ve(),r)}findOnPath_(e,r,s){const n=this.value?s(r,this.value):!1;if(n)return n;if($e(e))return null;{const i=Oe(e),o=this.children.get(i);return o?o.findOnPath_(Ye(e),gt(r,i),s):null}}foreachOnPath(e,r){return this.foreachOnPath_(e,Ve(),r)}foreachOnPath_(e,r,s){if($e(e))return this;{this.value&&s(r,this.value);const n=Oe(e),i=this.children.get(n);return i?i.foreachOnPath_(Ye(e),gt(r,n),s):new Qe(null)}}foreach(e){this.foreach_(Ve(),e)}foreach_(e,r){this.children.inorderTraversal((s,n)=>{n.foreach_(gt(e,s),r)}),this.value&&r(e,this.value)}foreachChild(e){this.children.inorderTraversal((r,s)=>{s.value&&e(r,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(e){this.writeTree_=e}static empty(){return new ar(new Qe(null))}}function Ln(t,e,r){if($e(e))return new ar(new Qe(r));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const n=s.path;let i=s.value;const o=Dt(n,e);return i=i.updateChild(o,r),new ar(t.writeTree_.set(n,i))}else{const n=new Qe(r),i=t.writeTree_.setTree(e,n);return new ar(i)}}}function ju(t,e,r){let s=t;return Ft(r,(n,i)=>{s=Ln(s,gt(e,n),i)}),s}function _u(t,e){if($e(e))return ar.empty();{const r=t.writeTree_.setTree(e,new Qe(null));return new ar(r)}}function ul(t,e){return Ss(t,e)!=null}function Ss(t,e){const r=t.writeTree_.findRootMostValueAndPath(e);return r!=null?t.writeTree_.get(r.path).getChild(Dt(r.path,e)):null}function Du(t){const e=[],r=t.writeTree_.value;return r!=null?r.isLeafNode()||r.forEachChild(it,(s,n)=>{e.push(new Le(s,n))}):t.writeTree_.children.inorderTraversal((s,n)=>{n.value!=null&&e.push(new Le(s,n.value))}),e}function Gr(t,e){if($e(e))return t;{const r=Ss(t,e);return r!=null?new ar(new Qe(r)):new ar(t.writeTree_.subtree(e))}}function hl(t){return t.writeTree_.isEmpty()}function en(t,e){return Of(Ve(),t.writeTree_,e)}function Of(t,e,r){if(e.value!=null)return r.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((n,i)=>{n===".priority"?(oe(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):r=Of(gt(t,n),i,r)}),!r.getChild(t).isEmpty()&&s!==null&&(r=r.updateChild(gt(t,".priority"),s)),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(t,e){return Wf(e,t)}function zk(t,e,r,s,n){oe(s>t.lastWriteId,"Stacking an older write on top of newer ones"),n===void 0&&(n=!0),t.allWrites.push({path:e,snap:r,writeId:s,visible:n}),n&&(t.visibleWrites=Ln(t.visibleWrites,e,r)),t.lastWriteId=s}function Kk(t,e){for(let r=0;r<t.allWrites.length;r++){const s=t.allWrites[r];if(s.writeId===e)return s}return null}function Yk(t,e){const r=t.allWrites.findIndex(l=>l.writeId===e);oe(r>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[r];t.allWrites.splice(r,1);let n=s.visible,i=!1,o=t.allWrites.length-1;for(;n&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=r&&qk(l,s.path)?n=!1:sr(s.path,l.path)&&(i=!0)),o--}if(n){if(i)return Xk(t),!0;if(s.snap)t.visibleWrites=_u(t.visibleWrites,s.path);else{const l=s.children;Ft(l,c=>{t.visibleWrites=_u(t.visibleWrites,gt(s.path,c))})}return!0}else return!1}function qk(t,e){if(t.snap)return sr(t.path,e);for(const r in t.children)if(t.children.hasOwnProperty(r)&&sr(gt(t.path,r),e))return!0;return!1}function Xk(t){t.visibleWrites=Lf(t.allWrites,Qk,Ve()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Qk(t){return t.visible}function Lf(t,e,r){let s=ar.empty();for(let n=0;n<t.length;++n){const i=t[n];if(e(i)){const o=i.path;let l;if(i.snap)sr(r,o)?(l=Dt(r,o),s=Ln(s,l,i.snap)):sr(o,r)&&(l=Dt(o,r),s=Ln(s,Ve(),i.snap.getChild(l)));else if(i.children){if(sr(r,o))l=Dt(r,o),s=ju(s,l,i.children);else if(sr(o,r))if(l=Dt(o,r),$e(l))s=ju(s,Ve(),i.children);else{const c=Xs(i.children,Oe(l));if(c){const d=c.getChild(Ye(l));s=Ln(s,Ve(),d)}}}else throw xa("WriteRecord should have .snap or .children")}}return s}function $f(t,e,r,s,n){if(!s&&!n){const i=Ss(t.visibleWrites,e);if(i!=null)return i;{const o=Gr(t.visibleWrites,e);if(hl(o))return r;if(r==null&&!ul(o,Ve()))return null;{const l=r||je.EMPTY_NODE;return en(o,l)}}}else{const i=Gr(t.visibleWrites,e);if(!n&&hl(i))return r;if(!n&&r==null&&!ul(i,Ve()))return null;{const o=function(d){return(d.visible||n)&&(!s||!~s.indexOf(d.writeId))&&(sr(d.path,e)||sr(e,d.path))},l=Lf(t.allWrites,o,e),c=r||je.EMPTY_NODE;return en(l,c)}}}function Jk(t,e,r){let s=je.EMPTY_NODE;const n=Ss(t.visibleWrites,e);if(n)return n.isLeafNode()||n.forEachChild(it,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(r){const i=Gr(t.visibleWrites,e);return r.forEachChild(it,(o,l)=>{const c=en(Gr(i,new ze(o)),l);s=s.updateImmediateChild(o,c)}),Du(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=Gr(t.visibleWrites,e);return Du(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function Zk(t,e,r,s,n){oe(s||n,"Either existingEventSnap or existingServerSnap must exist");const i=gt(e,r);if(ul(t.visibleWrites,i))return null;{const o=Gr(t.visibleWrites,i);return hl(o)?n.getChild(r):en(o,n.getChild(r))}}function eT(t,e,r,s){const n=gt(e,r),i=Ss(t.visibleWrites,n);if(i!=null)return i;if(s.isCompleteForChild(r)){const o=Gr(t.visibleWrites,n);return en(o,s.getNode().getImmediateChild(r))}else return null}function tT(t,e){return Ss(t.visibleWrites,e)}function rT(t,e,r,s,n,i,o){let l;const c=Gr(t.visibleWrites,e),d=Ss(c,Ve());if(d!=null)l=d;else if(r!=null)l=en(c,r);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),g=i?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let m=g.getNext();for(;m&&u.length<n;)h(m,s)!==0&&u.push(m),m=g.getNext();return u}else return[]}function sT(){return{visibleWrites:ar.empty(),allWrites:[],lastWriteId:-1}}function fi(t,e,r,s){return $f(t.writeTree,t.treePath,e,r,s)}function jc(t,e){return Jk(t.writeTree,t.treePath,e)}function Cu(t,e,r,s){return Zk(t.writeTree,t.treePath,e,r,s)}function pi(t,e){return tT(t.writeTree,gt(t.treePath,e))}function nT(t,e,r,s,n,i){return rT(t.writeTree,t.treePath,e,r,s,n,i)}function _c(t,e,r){return eT(t.writeTree,t.treePath,e,r)}function Ff(t,e){return Wf(gt(t.treePath,e),t.writeTree)}function Wf(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT{constructor(){this.changeMap=new Map}trackChildChange(e){const r=e.type,s=e.childName;oe(r==="child_added"||r==="child_changed"||r==="child_removed","Only child changes supported for tracking"),oe(s!==".priority","Only non-priority child changes can be tracked.");const n=this.changeMap.get(s);if(n){const i=n.type;if(r==="child_added"&&i==="child_removed")this.changeMap.set(s,ea(s,e.snapshotNode,n.snapshotNode));else if(r==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(r==="child_removed"&&i==="child_changed")this.changeMap.set(s,Zn(s,n.oldSnap));else if(r==="child_changed"&&i==="child_added")this.changeMap.set(s,Zs(s,e.snapshotNode));else if(r==="child_changed"&&i==="child_changed")this.changeMap.set(s,ea(s,e.snapshotNode,n.oldSnap));else throw xa("Illegal combination of changes: "+e+" occurred after "+n)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iT{getCompleteChild(e){return null}getChildAfterChild(e,r,s){return null}}const Vf=new iT;class Dc{constructor(e,r,s=null){this.writes_=e,this.viewCache_=r,this.optCompleteServerCache_=s}getCompleteChild(e){const r=this.viewCache_.eventCache;if(r.isCompleteForChild(e))return r.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new qr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _c(this.writes_,e,s)}}getChildAfterChild(e,r,s){const n=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ns(this.viewCache_),i=nT(this.writes_,n,r,1,s,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oT(t){return{filter:t}}function lT(t,e){oe(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),oe(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function cT(t,e,r,s,n){const i=new aT;let o,l;if(r.type===nr.OVERWRITE){const d=r;d.source.fromUser?o=gl(t,e,d.path,d.snap,s,n,i):(oe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!$e(d.path),o=yi(t,e,d.path,d.snap,s,n,l,i))}else if(r.type===nr.MERGE){const d=r;d.source.fromUser?o=uT(t,e,d.path,d.children,s,n,i):(oe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=ml(t,e,d.path,d.children,s,n,l,i))}else if(r.type===nr.ACK_USER_WRITE){const d=r;d.revert?o=mT(t,e,d.path,s,n,i):o=hT(t,e,d.path,d.affectedTree,s,n,i)}else if(r.type===nr.LISTEN_COMPLETE)o=gT(t,e,r.path,s,i);else throw xa("Unknown operation type: "+r.type);const c=i.getChanges();return dT(e,o,c),{viewCache:o,changes:c}}function dT(t,e,r){const s=e.eventCache;if(s.isFullyInitialized()){const n=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=mi(t);(r.length>0||!t.eventCache.isFullyInitialized()||n&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&r.push(Af(mi(e)))}}function Uf(t,e,r,s,n,i){const o=e.eventCache;if(pi(s,r)!=null)return e;{let l,c;if($e(r))if(oe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Ns(e),u=d instanceof je?d:je.EMPTY_NODE,h=jc(s,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const d=fi(s,Ns(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=Oe(r);if(d===".priority"){oe(Yr(r)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=Cu(s,r,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=Ye(r);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const g=Cu(s,r,o.getNode(),c);g!=null?h=o.getNode().getImmediateChild(d).updateChild(u,g):h=o.getNode().getImmediateChild(d)}else h=_c(s,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,n,i):l=o.getNode()}}return On(e,l,o.isFullyInitialized()||$e(r),t.filter.filtersNodes())}}function yi(t,e,r,s,n,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if($e(r))d=u.updateFullNode(c.getNode(),s,null);else if(u.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(r,s);d=u.updateFullNode(c.getNode(),m,null)}else{const m=Oe(r);if(!c.isCompleteForPath(r)&&Yr(r)>1)return e;const x=Ye(r),y=c.getNode().getImmediateChild(m).updateChild(x,s);m===".priority"?d=u.updatePriority(c.getNode(),y):d=u.updateChild(c.getNode(),m,y,x,Vf,null)}const h=Mf(e,d,c.isFullyInitialized()||$e(r),u.filtersNodes()),g=new Dc(n,h,i);return Uf(t,h,r,n,g,l)}function gl(t,e,r,s,n,i,o){const l=e.eventCache;let c,d;const u=new Dc(n,e,i);if($e(r))d=t.filter.updateFullNode(e.eventCache.getNode(),s,o),c=On(e,d,!0,t.filter.filtersNodes());else{const h=Oe(r);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),s),c=On(e,d,l.isFullyInitialized(),l.isFiltered());else{const g=Ye(r),m=l.getNode().getImmediateChild(h);let x;if($e(g))x=s;else{const f=u.getCompleteChild(h);f!=null?Tf(g)===".priority"&&f.getChild(Sf(g)).isEmpty()?x=f:x=f.updateChild(g,s):x=je.EMPTY_NODE}if(m.equals(x))c=e;else{const f=t.filter.updateChild(l.getNode(),h,x,g,u,o);c=On(e,f,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Eu(t,e){return t.eventCache.isCompleteForChild(e)}function uT(t,e,r,s,n,i,o){let l=e;return s.foreach((c,d)=>{const u=gt(r,c);Eu(e,Oe(u))&&(l=gl(t,l,u,d,n,i,o))}),s.foreach((c,d)=>{const u=gt(r,c);Eu(e,Oe(u))||(l=gl(t,l,u,d,n,i,o))}),l}function Iu(t,e,r){return r.foreach((s,n)=>{e=e.updateChild(s,n)}),e}function ml(t,e,r,s,n,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;$e(r)?d=s:d=new Qe(null).setTree(r,s);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,g)=>{if(u.hasChild(h)){const m=e.serverCache.getNode().getImmediateChild(h),x=Iu(t,m,g);c=yi(t,c,new ze(h),x,n,i,o,l)}}),d.children.inorderTraversal((h,g)=>{const m=!e.serverCache.isCompleteForChild(h)&&g.value===null;if(!u.hasChild(h)&&!m){const x=e.serverCache.getNode().getImmediateChild(h),f=Iu(t,x,g);c=yi(t,c,new ze(h),f,n,i,o,l)}}),c}function hT(t,e,r,s,n,i,o){if(pi(n,r)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if($e(r)&&c.isFullyInitialized()||c.isCompleteForPath(r))return yi(t,e,r,c.getNode().getChild(r),n,i,l,o);if($e(r)){let d=new Qe(null);return c.getNode().forEachChild(zs,(u,h)=>{d=d.set(new ze(u),h)}),ml(t,e,r,d,n,i,l,o)}else return e}else{let d=new Qe(null);return s.foreach((u,h)=>{const g=gt(r,u);c.isCompleteForPath(g)&&(d=d.set(u,c.getNode().getChild(g)))}),ml(t,e,r,d,n,i,l,o)}}function gT(t,e,r,s,n){const i=e.serverCache,o=Mf(e,i.getNode(),i.isFullyInitialized()||$e(r),i.isFiltered());return Uf(t,o,r,s,Vf,n)}function mT(t,e,r,s,n,i){let o;if(pi(s,r)!=null)return e;{const l=new Dc(s,e,n),c=e.eventCache.getNode();let d;if($e(r)||Oe(r)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=fi(s,Ns(e));else{const h=e.serverCache.getNode();oe(h instanceof je,"serverChildren would be complete if leaf node"),u=jc(s,h)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=Oe(r);let h=_c(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,Ye(r),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,je.EMPTY_NODE,Ye(r),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=fi(s,Ns(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||pi(s,Ve())!=null,On(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(e,r){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,n=new kc(s.getIndex()),i=Pk(s);this.processor_=oT(i);const o=r.serverCache,l=r.eventCache,c=n.updateFullNode(je.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(je.EMPTY_NODE,l.getNode(),null),u=new qr(c,o.isFullyInitialized(),n.filtersNodes()),h=new qr(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Bi(h,u),this.eventGenerator_=new Vk(this.query_)}get query(){return this.query_}}function pT(t){return t.viewCache_.serverCache.getNode()}function yT(t){return mi(t.viewCache_)}function xT(t,e){const r=Ns(t.viewCache_);return r&&(t.query._queryParams.loadsAllData()||!$e(e)&&!r.getImmediateChild(Oe(e)).isEmpty())?r.getChild(e):null}function Au(t){return t.eventRegistrations_.length===0}function bT(t,e){t.eventRegistrations_.push(e)}function Ru(t,e,r){const s=[];if(r){oe(e==null,"A cancel should cancel all event registrations.");const n=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(r,n);o&&s.push(o)})}if(e){let n=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))n.push(o);else if(e.hasAnyCallback()){n=n.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=n}else t.eventRegistrations_=[];return s}function Pu(t,e,r,s){e.type===nr.MERGE&&e.source.queryId!==null&&(oe(Ns(t.viewCache_),"We should always have a full cache before handling merges"),oe(mi(t.viewCache_),"Missing event cache, even though we have a server cache"));const n=t.viewCache_,i=cT(t.processor_,n,e,r,s);return lT(t.processor_,i.viewCache),oe(i.viewCache.serverCache.isFullyInitialized()||!n.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,Bf(t,i.changes,i.viewCache.eventCache.getNode(),null)}function vT(t,e){const r=t.viewCache_.eventCache,s=[];return r.getNode().isLeafNode()||r.getNode().forEachChild(it,(i,o)=>{s.push(Zs(i,o))}),r.isFullyInitialized()&&s.push(Af(r.getNode())),Bf(t,s,r.getNode(),e)}function Bf(t,e,r,s){const n=s?[s]:t.eventRegistrations_;return Uk(t.eventGenerator_,e,r,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xi;class Hf{constructor(){this.views=new Map}}function wT(t){oe(!xi,"__referenceConstructor has already been defined"),xi=t}function kT(){return oe(xi,"Reference.ts has not been loaded"),xi}function TT(t){return t.views.size===0}function Cc(t,e,r,s){const n=e.source.queryId;if(n!==null){const i=t.views.get(n);return oe(i!=null,"SyncTree gave us an op for an invalid query."),Pu(i,e,r,s)}else{let i=[];for(const o of t.views.values())i=i.concat(Pu(o,e,r,s));return i}}function Gf(t,e,r,s,n){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=fi(r,n?s:null),c=!1;l?c=!0:s instanceof je?(l=jc(r,s),c=!1):(l=je.EMPTY_NODE,c=!1);const d=Bi(new qr(l,c,!1),new qr(s,n,!1));return new fT(e,d)}return o}function NT(t,e,r,s,n,i){const o=Gf(t,e,s,n,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),bT(o,r),vT(o,r)}function ST(t,e,r,s){const n=e._queryIdentifier,i=[];let o=[];const l=Xr(t);if(n==="default")for(const[c,d]of t.views.entries())o=o.concat(Ru(d,r,s)),Au(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(n);c&&(o=o.concat(Ru(c,r,s)),Au(c)&&(t.views.delete(n),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!Xr(t)&&i.push(new(kT())(e._repo,e._path)),{removed:i,events:o}}function zf(t){const e=[];for(const r of t.views.values())r.query._queryParams.loadsAllData()||e.push(r);return e}function zr(t,e){let r=null;for(const s of t.views.values())r=r||xT(s,e);return r}function Kf(t,e){if(e._queryParams.loadsAllData())return Gi(t);{const s=e._queryIdentifier;return t.views.get(s)}}function Yf(t,e){return Kf(t,e)!=null}function Xr(t){return Gi(t)!=null}function Gi(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bi;function jT(t){oe(!bi,"__referenceConstructor has already been defined"),bi=t}function _T(){return oe(bi,"Reference.ts has not been loaded"),bi}let DT=1;class Mu{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Qe(null),this.pendingWriteTree_=sT(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function qf(t,e,r,s,n){return zk(t.pendingWriteTree_,e,r,s,n),n?Na(t,new Ts(Pf(),e,r)):[]}function ds(t,e,r=!1){const s=Kk(t.pendingWriteTree_,e);if(Yk(t.pendingWriteTree_,e)){let i=new Qe(null);return s.snap!=null?i=i.set(Ve(),!0):Ft(s.children,o=>{i=i.set(new ze(o),!0)}),Na(t,new gi(s.path,i,r))}else return[]}function Ta(t,e,r){return Na(t,new Ts(Nc(),e,r))}function CT(t,e,r){const s=Qe.fromObject(r);return Na(t,new sa(Nc(),e,s))}function ET(t,e){return Na(t,new ra(Nc(),e))}function IT(t,e,r){const s=Ic(t,r);if(s){const n=Ac(s),i=n.path,o=n.queryId,l=Dt(i,e),c=new ra(Sc(o),l);return Rc(t,i,c)}else return[]}function vi(t,e,r,s,n=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||Yf(o,e))){const c=ST(o,e,r,s);TT(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!n){const u=d.findIndex(g=>g._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(g,m)=>Xr(m));if(u&&!h){const g=t.syncPointTree_.subtree(i);if(!g.isEmpty()){const m=PT(g);for(let x=0;x<m.length;++x){const f=m[x],y=f.query,w=Zf(t,f);t.listenProvider_.startListening($n(y),na(t,y),w.hashFn,w.onComplete)}}}!h&&d.length>0&&!s&&(u?t.listenProvider_.stopListening($n(e),null):d.forEach(g=>{const m=t.queryToTagMap.get(zi(g));t.listenProvider_.stopListening($n(g),m)}))}MT(t,d)}return l}function Xf(t,e,r,s){const n=Ic(t,s);if(n!=null){const i=Ac(n),o=i.path,l=i.queryId,c=Dt(o,e),d=new Ts(Sc(l),c,r);return Rc(t,o,d)}else return[]}function AT(t,e,r,s){const n=Ic(t,s);if(n){const i=Ac(n),o=i.path,l=i.queryId,c=Dt(o,e),d=Qe.fromObject(r),u=new sa(Sc(l),c,d);return Rc(t,o,u)}else return[]}function fl(t,e,r,s=!1){const n=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(n,(g,m)=>{const x=Dt(g,n);i=i||zr(m,x),o=o||Xr(m)});let l=t.syncPointTree_.get(n);l?(o=o||Xr(l),i=i||zr(l,Ve())):(l=new Hf,t.syncPointTree_=t.syncPointTree_.set(n,l));let c;i!=null?c=!0:(c=!1,i=je.EMPTY_NODE,t.syncPointTree_.subtree(n).foreachChild((m,x)=>{const f=zr(x,Ve());f&&(i=i.updateImmediateChild(m,f))}));const d=Yf(l,e);if(!d&&!e._queryParams.loadsAllData()){const g=zi(e);oe(!t.queryToTagMap.has(g),"View does not exist, but we have a tag");const m=OT();t.queryToTagMap.set(g,m),t.tagToQueryMap.set(m,g)}const u=Hi(t.pendingWriteTree_,n);let h=NT(l,e,r,u,i,c);if(!d&&!o&&!s){const g=Kf(l,e);h=h.concat(LT(t,e,g))}return h}function Ec(t,e,r){const n=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Dt(o,e),d=zr(l,c);if(d)return d});return $f(n,e,i,r,!0)}function RT(t,e){const r=e._path;let s=null;t.syncPointTree_.foreachOnPath(r,(d,u)=>{const h=Dt(d,r);s=s||zr(u,h)});let n=t.syncPointTree_.get(r);n?s=s||zr(n,Ve()):(n=new Hf,t.syncPointTree_=t.syncPointTree_.set(r,n));const i=s!=null,o=i?new qr(s,!0,!1):null,l=Hi(t.pendingWriteTree_,e._path),c=Gf(n,e,l,i?o.getNode():je.EMPTY_NODE,i);return yT(c)}function Na(t,e){return Qf(e,t.syncPointTree_,null,Hi(t.pendingWriteTree_,Ve()))}function Qf(t,e,r,s){if($e(t.path))return Jf(t,e,r,s);{const n=e.get(Ve());r==null&&n!=null&&(r=zr(n,Ve()));let i=[];const o=Oe(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=r?r.getImmediateChild(o):null,u=Ff(s,o);i=i.concat(Qf(l,c,d,u))}return n&&(i=i.concat(Cc(n,t,s,r))),i}}function Jf(t,e,r,s){const n=e.get(Ve());r==null&&n!=null&&(r=zr(n,Ve()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=r?r.getImmediateChild(o):null,d=Ff(s,o),u=t.operationForChild(o);u&&(i=i.concat(Jf(u,l,c,d)))}),n&&(i=i.concat(Cc(n,t,s,r))),i}function Zf(t,e){const r=e.query,s=na(t,r);return{hashFn:()=>(pT(e)||je.EMPTY_NODE).hash(),onComplete:n=>{if(n==="ok")return s?IT(t,r._path,s):ET(t,r._path);{const i=Rw(n,r);return vi(t,r,null,i)}}}}function na(t,e){const r=zi(e);return t.queryToTagMap.get(r)}function zi(t){return t._path.toString()+"$"+t._queryIdentifier}function Ic(t,e){return t.tagToQueryMap.get(e)}function Ac(t){const e=t.indexOf("$");return oe(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new ze(t.substr(0,e))}}function Rc(t,e,r){const s=t.syncPointTree_.get(e);oe(s,"Missing sync point for query tag that we're tracking");const n=Hi(t.pendingWriteTree_,e);return Cc(s,r,n,null)}function PT(t){return t.fold((e,r,s)=>{if(r&&Xr(r))return[Gi(r)];{let n=[];return r&&(n=zf(r)),Ft(s,(i,o)=>{n=n.concat(o)}),n}})}function $n(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(_T())(t._repo,t._path):t}function MT(t,e){for(let r=0;r<e.length;++r){const s=e[r];if(!s._queryParams.loadsAllData()){const n=zi(s),i=t.queryToTagMap.get(n);t.queryToTagMap.delete(n),t.tagToQueryMap.delete(i)}}}function OT(){return DT++}function LT(t,e,r){const s=e._path,n=na(t,e),i=Zf(t,r),o=t.listenProvider_.startListening($n(e),n,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(s);if(n)oe(!Xr(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!$e(d)&&u&&Xr(u))return[Gi(u).query];{let g=[];return u&&(g=g.concat(zf(u).map(m=>m.query))),Ft(h,(m,x)=>{g=g.concat(x)}),g}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening($n(u),na(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{constructor(e){this.node_=e}getImmediateChild(e){const r=this.node_.getImmediateChild(e);return new Pc(r)}node(){return this.node_}}class Mc{constructor(e,r){this.syncTree_=e,this.path_=r}getImmediateChild(e){const r=gt(this.path_,e);return new Mc(this.syncTree_,r)}node(){return Ec(this.syncTree_,this.path_)}}const $T=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Ou=function(t,e,r){if(!t||typeof t!="object")return t;if(oe(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return FT(t[".sv"],e,r);if(typeof t[".sv"]=="object")return WT(t[".sv"],e);oe(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},FT=function(t,e,r){switch(t){case"timestamp":return r.timestamp;default:oe(!1,"Unexpected server value: "+t)}},WT=function(t,e,r){t.hasOwnProperty("increment")||oe(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&oe(!1,"Unexpected increment value: "+s);const n=e.node();if(oe(n!==null&&typeof n<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!n.isLeafNode())return s;const o=n.getValue();return typeof o!="number"?s:o+s},VT=function(t,e,r,s){return Oc(e,new Mc(r,t),s)},ep=function(t,e,r){return Oc(t,new Pc(e),r)};function Oc(t,e,r){const s=t.getPriority().val(),n=Ou(s,e.getImmediateChild(".priority"),r);let i;if(t.isLeafNode()){const o=t,l=Ou(o.getValue(),e,r);return l!==o.getValue()||n!==o.getPriority().val()?new ft(l,xt(n)):t}else{const o=t;return i=o,n!==o.getPriority().val()&&(i=i.updatePriority(new ft(n))),o.forEachChild(it,(l,c)=>{const d=Oc(c,e.getImmediateChild(l),r);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e="",r=null,s={children:{},childCount:0}){this.name=e,this.parent=r,this.node=s}}function $c(t,e){let r=e instanceof ze?e:new ze(e),s=t,n=Oe(r);for(;n!==null;){const i=Xs(s.node.children,n)||{children:{},childCount:0};s=new Lc(n,s,i),r=Ye(r),n=Oe(r)}return s}function ln(t){return t.node.value}function tp(t,e){t.node.value=e,pl(t)}function rp(t){return t.node.childCount>0}function UT(t){return ln(t)===void 0&&!rp(t)}function Ki(t,e){Ft(t.node.children,(r,s)=>{e(new Lc(r,t,s))})}function sp(t,e,r,s){r&&e(t),Ki(t,n=>{sp(n,e,!0)})}function BT(t,e,r){let s=t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Sa(t){return new ze(t.parent===null?t.name:Sa(t.parent)+"/"+t.name)}function pl(t){t.parent!==null&&HT(t.parent,t.name,t)}function HT(t,e,r){const s=UT(r),n=Ir(t.node.children,e);s&&n?(delete t.node.children[e],t.node.childCount--,pl(t)):!s&&!n&&(t.node.children[e]=r.node,t.node.childCount++,pl(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GT=/[\[\].#$\/\u0000-\u001F\u007F]/,zT=/[\[\].#$\u0000-\u001F\u007F]/,_o=10*1024*1024,np=function(t){return typeof t=="string"&&t.length!==0&&!GT.test(t)},ap=function(t){return typeof t=="string"&&t.length!==0&&!zT.test(t)},KT=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),ap(t)},ip=function(t,e,r,s){s&&e===void 0||Fc(oc(t,"value"),e,r)},Fc=function(t,e,r){const s=r instanceof ze?new hk(r,t):r;if(e===void 0)throw new Error(t+"contains undefined "+ss(s));if(typeof e=="function")throw new Error(t+"contains a function "+ss(s)+" with contents = "+e.toString());if(tf(e))throw new Error(t+"contains "+e.toString()+" "+ss(s));if(typeof e=="string"&&e.length>_o/3&&$i(e)>_o)throw new Error(t+"contains a string greater than "+_o+" utf8 bytes "+ss(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let n=!1,i=!1;if(Ft(e,(o,l)=>{if(o===".value")n=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!np(o)))throw new Error(t+" contains an invalid key ("+o+") "+ss(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);gk(s,o),Fc(t,l,s),mk(s)}),n&&i)throw new Error(t+' contains ".value" child '+ss(s)+" in addition to actual children.")}},op=function(t,e,r,s){if(!ap(r))throw new Error(oc(t,e)+'was an invalid path = "'+r+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},YT=function(t,e,r,s){r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),op(t,e,r)},Wc=function(t,e){if(Oe(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},qT=function(t,e){const r=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!np(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||r.length!==0&&!KT(r))throw new Error(oc(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Vc(t,e){let r=null;for(let s=0;s<e.length;s++){const n=e[s],i=n.getPath();r!==null&&!bc(i,r.path)&&(t.eventLists_.push(r),r=null),r===null&&(r={events:[],path:i}),r.events.push(n)}r&&t.eventLists_.push(r)}function lp(t,e,r){Vc(t,r),cp(t,s=>bc(s,e))}function xr(t,e,r){Vc(t,r),cp(t,s=>sr(s,e)||sr(e,s))}function cp(t,e){t.recursionDepth_++;let r=!0;for(let s=0;s<t.eventLists_.length;s++){const n=t.eventLists_[s];if(n){const i=n.path;e(i)?(QT(t.eventLists_[s]),t.eventLists_[s]=null):r=!1}}r&&(t.eventLists_=[]),t.recursionDepth_--}function QT(t){for(let e=0;e<t.events.length;e++){const r=t.events[e];if(r!==null){t.events[e]=null;const s=r.getEventRunner();Pn&&Nt("event: "+r.toString()),on(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JT="repo_interrupt",ZT=25;class eN{constructor(e,r,s,n){this.repoInfo_=e,this.forceRestClient_=r,this.authTokenProvider_=s,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new XT,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=hi(),this.transactionQueueTree_=new Lc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function tN(t,e,r){if(t.stats_=yc(t.repoInfo_),t.forceRestClient_||Lw())t.server_=new ui(t.repoInfo_,(s,n,i,o)=>{Lu(t,s,n,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>$u(t,!0),0);else{if(typeof r<"u"&&r!==null){if(typeof r!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ht(r)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new _r(t.repoInfo_,e,(s,n,i,o)=>{Lu(t,s,n,i,o)},s=>{$u(t,s)},s=>{rN(t,s)},t.authTokenProvider_,t.appCheckProvider_,r),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=Uw(t.repoInfo_,()=>new Wk(t.stats_,t.server_)),t.infoData_=new Mk,t.infoSyncTree_=new Mu({startListening:(s,n,i,o)=>{let l=[];const c=t.infoData_.getNode(s._path);return c.isEmpty()||(l=Ta(t.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),Bc(t,"connected",!1),t.serverSyncTree_=new Mu({startListening:(s,n,i,o)=>(t.server_.listen(s,i,n,(l,c)=>{const d=o(l,c);xr(t.eventQueue_,s._path,d)}),[]),stopListening:(s,n)=>{t.server_.unlisten(s,n)}})}function dp(t){const r=t.infoData_.getNode(new ze(".info/serverTimeOffset")).val()||0;return new Date().getTime()+r}function Uc(t){return $T({timestamp:dp(t)})}function Lu(t,e,r,s,n){t.dataUpdateCount++;const i=new ze(e);r=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,r):r;let o=[];if(n)if(s){const c=ti(r,d=>xt(d));o=AT(t.serverSyncTree_,i,c,n)}else{const c=xt(r);o=Xf(t.serverSyncTree_,i,c,n)}else if(s){const c=ti(r,d=>xt(d));o=CT(t.serverSyncTree_,i,c)}else{const c=xt(r);o=Ta(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=qi(t,i)),xr(t.eventQueue_,l,o)}function $u(t,e){Bc(t,"connected",e),e===!1&&aN(t)}function rN(t,e){Ft(e,(r,s)=>{Bc(t,r,s)})}function Bc(t,e,r){const s=new ze("/.info/"+e),n=xt(r);t.infoData_.updateSnapshot(s,n);const i=Ta(t.infoSyncTree_,s,n);xr(t.eventQueue_,s,i)}function up(t){return t.nextWriteId_++}function sN(t,e,r){const s=RT(t.serverSyncTree_,e);return s!=null?Promise.resolve(s):t.server_.get(e).then(n=>{const i=xt(n).withIndex(e._queryParams.getIndex());fl(t.serverSyncTree_,e,r,!0);let o;if(e._queryParams.loadsAllData())o=Ta(t.serverSyncTree_,e._path,i);else{const l=na(t.serverSyncTree_,e);o=Xf(t.serverSyncTree_,e._path,i,l)}return xr(t.eventQueue_,e._path,o),vi(t.serverSyncTree_,e,r,null,!0),i},n=>(Yi(t,"get for query "+ht(e)+" failed: "+n),Promise.reject(new Error(n))))}function nN(t,e,r,s,n){Yi(t,"set",{path:e.toString(),value:r,priority:s});const i=Uc(t),o=xt(r,s),l=Ec(t.serverSyncTree_,e),c=ep(o,l,i),d=up(t),u=qf(t.serverSyncTree_,e,c,d,!0);Vc(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(g,m)=>{const x=g==="ok";x||Lt("set at "+e+" failed: "+g);const f=ds(t.serverSyncTree_,d,!x);xr(t.eventQueue_,e,f),cN(t,n,g,m)});const h=pp(t,e);qi(t,h),xr(t.eventQueue_,h,[])}function aN(t){Yi(t,"onDisconnectEvents");const e=Uc(t),r=hi();dl(t.onDisconnect_,Ve(),(n,i)=>{const o=VT(n,i,t.serverSyncTree_,e);Rf(r,n,o)});let s=[];dl(r,Ve(),(n,i)=>{s=s.concat(Ta(t.serverSyncTree_,n,i));const o=pp(t,n);qi(t,o)}),t.onDisconnect_=hi(),xr(t.eventQueue_,Ve(),s)}function iN(t,e,r){let s;Oe(e._path)===".info"?s=fl(t.infoSyncTree_,e,r):s=fl(t.serverSyncTree_,e,r),lp(t.eventQueue_,e._path,s)}function oN(t,e,r){let s;Oe(e._path)===".info"?s=vi(t.infoSyncTree_,e,r):s=vi(t.serverSyncTree_,e,r),lp(t.eventQueue_,e._path,s)}function lN(t){t.persistentConnection_&&t.persistentConnection_.interrupt(JT)}function Yi(t,...e){let r="";t.persistentConnection_&&(r=t.persistentConnection_.id+":"),Nt(r,...e)}function cN(t,e,r,s){e&&on(()=>{if(r==="ok")e(null);else{const n=(r||"error").toUpperCase();let i=n;s&&(i+=": "+s);const o=new Error(i);o.code=n,e(o)}})}function hp(t,e,r){return Ec(t.serverSyncTree_,e,r)||je.EMPTY_NODE}function Hc(t,e=t.transactionQueueTree_){if(e||Xi(t,e),ln(e)){const r=mp(t,e);oe(r.length>0,"Sending zero length transaction queue"),r.every(n=>n.status===0)&&dN(t,Sa(e),r)}else rp(e)&&Ki(e,r=>{Hc(t,r)})}function dN(t,e,r){const s=r.map(d=>d.currentWriteId),n=hp(t,e,s);let i=n;const o=n.hash();for(let d=0;d<r.length;d++){const u=r[d];oe(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=Dt(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{Yi(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let g=0;g<r.length;g++)r[g].status=2,u=u.concat(ds(t.serverSyncTree_,r[g].currentWriteId)),r[g].onComplete&&h.push(()=>r[g].onComplete(null,!0,r[g].currentOutputSnapshotResolved)),r[g].unwatcher();Xi(t,$c(t.transactionQueueTree_,e)),Hc(t,t.transactionQueueTree_),xr(t.eventQueue_,e,u);for(let g=0;g<h.length;g++)on(h[g])}else{if(d==="datastale")for(let h=0;h<r.length;h++)r[h].status===3?r[h].status=4:r[h].status=0;else{Lt("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<r.length;h++)r[h].status=4,r[h].abortReason=d}qi(t,e)}},o)}function qi(t,e){const r=gp(t,e),s=Sa(r),n=mp(t,r);return uN(t,n,s),s}function uN(t,e,r){if(e.length===0)return;const s=[];let n=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=Dt(r,c.path);let u=!1,h;if(oe(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,n=n.concat(ds(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=ZT)u=!0,h="maxretry",n=n.concat(ds(t.serverSyncTree_,c.currentWriteId,!0));else{const g=hp(t,c.path,o);c.currentInputSnapshot=g;const m=e[l].update(g.val());if(m!==void 0){Fc("transaction failed: Data returned ",m,c.path);let x=xt(m);typeof m=="object"&&m!=null&&Ir(m,".priority")||(x=x.updatePriority(g.getPriority()));const y=c.currentWriteId,w=Uc(t),v=ep(x,g,w);c.currentOutputSnapshotRaw=x,c.currentOutputSnapshotResolved=v,c.currentWriteId=up(t),o.splice(o.indexOf(y),1),n=n.concat(qf(t.serverSyncTree_,c.path,v,c.currentWriteId,c.applyLocally)),n=n.concat(ds(t.serverSyncTree_,y,!0))}else u=!0,h="nodata",n=n.concat(ds(t.serverSyncTree_,c.currentWriteId,!0))}xr(t.eventQueue_,r,n),n=[],u&&(e[l].status=2,function(g){setTimeout(g,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(h),!1,null))))}Xi(t,t.transactionQueueTree_);for(let l=0;l<s.length;l++)on(s[l]);Hc(t,t.transactionQueueTree_)}function gp(t,e){let r,s=t.transactionQueueTree_;for(r=Oe(e);r!==null&&ln(s)===void 0;)s=$c(s,r),e=Ye(e),r=Oe(e);return s}function mp(t,e){const r=[];return fp(t,e,r),r.sort((s,n)=>s.order-n.order),r}function fp(t,e,r){const s=ln(e);if(s)for(let n=0;n<s.length;n++)r.push(s[n]);Ki(e,n=>{fp(t,n,r)})}function Xi(t,e){const r=ln(e);if(r){let s=0;for(let n=0;n<r.length;n++)r[n].status!==2&&(r[s]=r[n],s++);r.length=s,tp(e,r.length>0?r:void 0)}Ki(e,s=>{Xi(t,s)})}function pp(t,e){const r=Sa(gp(t,e)),s=$c(t.transactionQueueTree_,e);return BT(s,n=>{Do(t,n)}),Do(t,s),sp(s,n=>{Do(t,n)}),r}function Do(t,e){const r=ln(e);if(r){const s=[];let n=[],i=-1;for(let o=0;o<r.length;o++)r[o].status===3||(r[o].status===1?(oe(i===o-1,"All SENT items should be at beginning of queue."),i=o,r[o].status=3,r[o].abortReason="set"):(oe(r[o].status===0,"Unexpected transaction status in abort"),r[o].unwatcher(),n=n.concat(ds(t.serverSyncTree_,r[o].currentWriteId,!0)),r[o].onComplete&&s.push(r[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?tp(e,void 0):r.length=i+1,xr(t.eventQueue_,Sa(e),n);for(let o=0;o<s.length;o++)on(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hN(t){let e="";const r=t.split("/");for(let s=0;s<r.length;s++)if(r[s].length>0){let n=r[s];try{n=decodeURIComponent(n.replace(/\+/g," "))}catch{}e+="/"+n}return e}function gN(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const r of t.split("&")){if(r.length===0)continue;const s=r.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Lt(`Invalid query segment '${r}' in query '${t}'`)}return e}const Fu=function(t,e){const r=mN(t),s=r.namespace;r.domain==="firebase.com"&&Dr(r.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&r.domain!=="localhost"&&Dr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),r.secure||Dw();const n=r.scheme==="ws"||r.scheme==="wss";return{repoInfo:new mf(r.host,r.secure,s,n,e,"",s!==r.subdomain),path:new ze(r.pathString)}},mN=function(t){let e="",r="",s="",n="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(n=hN(t.substring(u,h)));const g=gN(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const m=e.slice(0,d);if(m.toLowerCase()==="localhost")r="localhost";else if(m.split(".").length<=2)r=m;else{const x=e.indexOf(".");s=e.substring(0,x).toLowerCase(),r=e.substring(x+1),i=s}"ns"in g&&(i=g.ns)}return{host:e,port:c,domain:r,subdomain:s,secure:o,scheme:l,pathString:n,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",fN=function(){let t=0;const e=[];return function(r){const s=r===t;t=r;let n;const i=new Array(8);for(n=7;n>=0;n--)i[n]=Wu.charAt(r%64),r=Math.floor(r/64);oe(r===0,"Cannot push at time == 0");let o=i.join("");if(s){for(n=11;n>=0&&e[n]===63;n--)e[n]=0;e[n]++}else for(n=0;n<12;n++)e[n]=Math.floor(Math.random()*64);for(n=0;n<12;n++)o+=Wu.charAt(e[n]);return oe(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pN{constructor(e,r,s,n){this.eventType=e,this.eventRegistration=r,this.snapshot=s,this.prevName=n}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ht(this.snapshot.exportVal())}}class yN{constructor(e,r,s){this.eventRegistration=e,this.error=r,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(e,r){this.snapshotCallback=e,this.cancelCallback=r}onValue(e,r){this.snapshotCallback.call(null,e,r)}onCancel(e){return oe(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e,r,s,n){this._repo=e,this._path=r,this._queryParams=s,this._orderByCalled=n}get key(){return $e(this._path)?null:Tf(this._path)}get ref(){return new Rr(this._repo,this._path)}get _queryIdentifier(){const e=Nu(this._queryParams),r=fc(e);return r==="{}"?"default":r}get _queryObject(){return Nu(this._queryParams)}isEqual(e){if(e=br(e),!(e instanceof Gc))return!1;const r=this._repo===e._repo,s=bc(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return r&&s&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+uk(this._path)}}class Rr extends Gc{constructor(e,r){super(e,r,new Tc,!1)}get parent(){const e=Sf(this._path);return e===null?null:new Rr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class aa{constructor(e,r,s){this._node=e,this.ref=r,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const r=new ze(e),s=ia(this.ref,e);return new aa(this._node.getChild(r),s,it)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,n)=>e(new aa(n,ia(this.ref,s),it)))}hasChild(e){const r=new ze(e);return!this._node.getChild(r).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function dr(t,e){return t=br(t),t._checkNotDeleted("ref"),e!==void 0?ia(t._root,e):t._root}function ia(t,e){return t=br(t),Oe(t._path)===null?YT("child","path",e):op("child","path",e),new Rr(t._repo,gt(t._path,e))}function xN(t,e){t=br(t),Wc("push",t._path),ip("push",e,t._path,!0);const r=dp(t._repo),s=fN(r),n=ia(t,s),i=ia(t,s);let o;return o=Promise.resolve(i),n.then=o.then.bind(o),n.catch=o.then.bind(o,void 0),n}function Vu(t){return Wc("remove",t._path),Ls(t,null)}function Ls(t,e){t=br(t),Wc("set",t._path),ip("set",e,t._path,!1);const r=new lc;return nN(t._repo,t._path,e,null,r.wrapCallback(()=>{})),r.promise}function Co(t){t=br(t);const e=new yp(()=>{}),r=new Qi(e);return sN(t._repo,t,r).then(s=>new aa(s,new Rr(t._repo,t._path),t._queryParams.getIndex()))}class Qi{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,r){const s=r._queryParams.getIndex();return new pN("value",this,new aa(e.snapshotNode,new Rr(r._repo,r._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,r){return this.callbackContext.hasCancelCallback?new yN(this,e,r):null}matches(e){return e instanceof Qi?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function bN(t,e,r,s,n){const i=new yp(r,void 0),o=new Qi(i);return iN(t._repo,t,o),()=>oN(t._repo,t,o)}function Uu(t,e,r,s){return bN(t,"value",e)}wT(Rr);jT(Rr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vN="FIREBASE_DATABASE_EMULATOR_HOST",yl={};let wN=!1;function kN(t,e,r,s){const n=e.lastIndexOf(":"),i=e.substring(0,n),o=ac(i);t.repoInfo_=new mf(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,r),s&&(t.authTokenProvider_=s)}function TN(t,e,r,s,n){let i=s||t.options.databaseURL;i===void 0&&(t.options.projectId||Dr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Nt("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Fu(i,n),l=o.repoInfo,c;typeof process<"u"&&iu&&(c=iu[vN]),c?(i=`http://${c}?ns=${l.namespace}`,o=Fu(i,n),l=o.repoInfo):o.repoInfo.secure;const d=new Fw(t.name,t.options,e);qT("Invalid Firebase Database URL",o),$e(o.path)||Dr("Database URL must point to the root of a Firebase Database (not including a child path).");const u=SN(l,t,d,new $w(t,r));return new jN(u,t)}function NN(t,e){const r=yl[e];(!r||r[t.key]!==t)&&Dr(`Database ${e}(${t.repoInfo_}) has already been deleted.`),lN(t),delete r[t.key]}function SN(t,e,r,s){let n=yl[e.name];n||(n={},yl[e.name]=n);let i=n[t.toURLString()];return i&&Dr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new eN(t,wN,r,s),n[t.toURLString()]=i,i}class jN{constructor(e,r){this._repoInternal=e,this.app=r,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(tN(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Rr(this._repo,Ve())),this._rootInternal}_delete(){return this._rootInternal!==null&&(NN(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Dr("Cannot call "+e+" on a deleted database.")}}function _N(t=nc(),e){const r=ya(t,"database").getImmediate({identifier:e});if(!r._instanceStarted){const s=am("database");s&&DN(r,...s)}return r}function DN(t,e,r,s={}){t=br(t),t._checkNotDeleted("useEmulator");const n=`${e}:${r}`,i=t._repoInternal;if(t._instanceStarted){if(n===t._repoInternal.repoInfo_.host&&hm(s,i.repoInfo_.emulatorOptions))return;Dr("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Dr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ka(Ka.OWNER);else if(s.mockUserToken){const l=typeof s.mockUserToken=="string"?s.mockUserToken:lm(s.mockUserToken,t.app.options.projectId);o=new Ka(l)}ac(e)&&(im(e),om("Database",!0)),kN(i,n,s,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CN(t){kw(rc),Xn(new Qn("database",(e,{instanceIdentifier:r})=>{const s=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return TN(s,n,i,r)},"PUBLIC").setMultipleInstances(!0)),Kr(ou,lu,t),Kr(ou,lu,"esm2017")}_r.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};_r.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};CN();const EN={apiKey:"AIzaSyCaQ6ndqGrR_x6fvTrZxdf5cHTNnRIj2Gg",authDomain:"busvacation-e894a.firebaseapp.com",databaseURL:"https://busvacation-e894a-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"busvacation-e894a",storageBucket:"busvacation-e894a.appspot.com",messagingSenderId:"919121046118",appId:"1:919121046118:web:033047c3f1bba2164e5ba7"},IN=()=>{const t=gm().find(e=>e.name==="vacation-management");return t||mm(EN,"vacation-management")},AN=IN(),ur=_N(AN);class RN{constructor(){Ht(this,"listeners");this.listeners=new Map}sanitizeDepartmentCode(e){try{return btoa(encodeURIComponent(e)).replace(/[/+=]/g,"_")}catch{return e.replace(/[^a-zA-Z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")}}getDepartmentPath(e,r){return`departments/${this.sanitizeDepartmentCode(e)}/${r}`}async getEmployees(e){const r=this.getDepartmentPath(e,"employees");try{const s=await Co(dr(ur,r));return s.exists()?s.val():[]}catch(s){return console.error(`âŒ [${e}] ì§ì› ë°ì´í„° ì½ê¸° ì‹¤íŒ¨:`,s),[]}}async saveEmployees(e,r){const s=this.getDepartmentPath(e,"employees");try{return await Ls(dr(ur,s),r),console.log(`âœ… [${e}] ì§ì› ë°ì´í„° ì €ì¥ ì™„ë£Œ`),{success:!0}}catch(n){return console.error(`âŒ [${e}] ì§ì› ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}async getVacations(e){const r=this.getDepartmentPath(e,"vacations");try{const s=await Co(dr(ur,r));if(s.exists()){const n=s.val();return Array.isArray(n)?n:Object.keys(n||{}).map(i=>({...n[i],id:i}))}return[]}catch(s){return console.error(`âŒ [${e}] íœ´ê°€ ë°ì´í„° ì½ê¸° ì‹¤íŒ¨:`,s),[]}}async saveVacations(e,r){const s=this.getDepartmentPath(e,"vacations");try{return await Ls(dr(ur,s),r),console.log(`âœ… [${e}] íœ´ê°€ ë°ì´í„° ì €ì¥ ì™„ë£Œ`),{success:!0}}catch(n){return console.error(`âŒ [${e}] íœ´ê°€ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}async addVacation(e,r){const s=this.getDepartmentPath(e,"vacations");try{const n=dr(ur,s),i=xN(n),o={...r,id:i.key,createdAt:Date.now(),updatedAt:Date.now()};return await Ls(i,o),console.log(`âœ… [${e}] íœ´ê°€ ì¶”ê°€ ì™„ë£Œ:`,o.id),{success:!0,vacation:o}}catch(n){return console.error(`âŒ [${e}] íœ´ê°€ ì¶”ê°€ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}async updateVacation(e,r,s){const n=`${this.getDepartmentPath(e,"vacations")}/${r}`;try{const i={...s,updatedAt:Date.now()};return await Ls(dr(ur,n),i),console.log(`âœ… [${e}] íœ´ê°€ ìˆ˜ì • ì™„ë£Œ:`,r),{success:!0}}catch(i){return console.error(`âŒ [${e}] íœ´ê°€ ìˆ˜ì • ì‹¤íŒ¨:`,i),{success:!1,error:i}}}async deleteVacation(e,r){const s=`${this.getDepartmentPath(e,"vacations")}/${r}`;try{return await Vu(dr(ur,s)),console.log(`âœ… [${e}] íœ´ê°€ ì‚­ì œ ì™„ë£Œ:`,r),{success:!0}}catch(n){return console.error(`âŒ [${e}] íœ´ê°€ ì‚­ì œ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}subscribeToVacations(e,r){const s=this.getDepartmentPath(e,"vacations"),n=dr(ur,s),i=Uu(n,l=>{const c=l.exists()?l.val():[],d=Array.isArray(c)?c:Object.keys(c||{}).map(u=>({...c[u],id:u}));r(d)}),o=`vacations_${e}`;return this.listeners.set(o,{ref:n,unsubscribe:i}),()=>{i(),this.listeners.delete(o)}}subscribeToEmployees(e,r){const s=this.getDepartmentPath(e,"employees"),n=dr(ur,s),i=Uu(n,l=>{const c=l.exists()?l.val():[];r(c)}),o=`employees_${e}`;return this.listeners.set(o,{ref:n,unsubscribe:i}),()=>{i(),this.listeners.delete(o)}}async testConnection(){try{const e=dr(ur,"connection_test");await Ls(e,{timestamp:Date.now(),test:!0});const r=await Co(e),s=r.exists()&&r.val().test===!0;return s&&await Vu(e),console.log(`ğŸ”¥ ë¶€ì„œíœ´ê°€ê´€ë¦¬ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ${s?"ì„±ê³µ":"ì‹¤íŒ¨"}`),s}catch(e){return console.error("ë¶€ì„œíœ´ê°€ê´€ë¦¬ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:",e),!1}}cleanup(){console.log("ğŸ§¹ ë¶€ì„œíœ´ê°€ê´€ë¦¬ Firebase ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ ì¤‘..."),this.listeners.forEach(({unsubscribe:e},r)=>{e(),console.log(`âœ… ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ë¨: ${r}`)}),this.listeners.clear()}}const Bu=new RN,xp=p.createContext(void 0),PN=({children:t})=>{const{currentUser:e}=bt(),[r,s]=p.useState([]),[n,i]=p.useState([]),[o,l]=p.useState(!1),[c,d]=p.useState(()=>{const y=localStorage.getItem("showVacationsInTodos");return y?JSON.parse(y):!0}),u=p.useMemo(()=>{const y=new Map;return n.forEach(w=>{const v=y.get(w.date)||[];v.push(w),y.set(w.date,v)}),y},[n]),h=p.useCallback(()=>{d(y=>{const w=!y;return localStorage.setItem("showVacationsInTodos",JSON.stringify(w)),w})},[]),g=p.useCallback(async()=>{if(!(!e||!Hr(e.email))){l(!0);try{const[y,w]=await Promise.all([Bu.getEmployees("ë³´ìƒì§€ì›ë¶€"),Bu.getVacations("ë³´ìƒì§€ì›ë¶€")]);s(y),i(w)}catch(y){console.error("íœ´ê°€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",y)}finally{l(!1)}}},[e]),m=p.useCallback(y=>{if(!c)return[];const w=y.getFullYear(),v=String(y.getMonth()+1).padStart(2,"0"),k=String(y.getDate()).padStart(2,"0"),b=`${w}-${v}-${k}`;return u.get(b)||[]},[c,u]),x=p.useCallback(async(y,w)=>{n.length===0&&e&&Hr(e.email||"")&&await g()},[n.length,e,g]);p.useEffect(()=>{e&&Hr(e.email)&&g()},[e,g]);const f=p.useMemo(()=>({employees:r,vacations:n,loading:o,showVacationsInTodos:c,toggleVacationDisplay:h,refreshVacationData:g,getVacationsForDate:m,loadMonthVacations:x}),[r,n,o,c,h,g,m,x]);return a.jsx(xp.Provider,{value:f,children:t})},cn=()=>{const t=p.useContext(xp);if(t===void 0)throw new Error("useVacation must be used within a VacationProvider");return t},bp=p.createContext(void 0),MN=({children:t,onOpenAddTodo:e,onFocusSearch:r,onToggleSidebar:s,onSwitchToTodayView:n,onSwitchToWeekView:i,onSwitchToMonthView:o})=>{const l={openAddTodoModal:e,focusSearch:r,toggleSidebar:s,switchToTodayView:n,switchToWeekView:i,switchToMonthView:o};return a.jsx(bp.Provider,{value:l,children:t})},ON=()=>{const t=p.useContext(bp);if(t===void 0)throw new Error("useKeyboard must be used within a KeyboardProvider");return t},vp=p.createContext(void 0),LN=()=>{const t=p.useContext(vp);if(t===void 0)throw new Error("useFontSize must be used within a FontSizeProvider");return t},$N=({children:t})=>{const[e,r]=p.useState(()=>{const s=localStorage.getItem("fontSizeLevel");if(s){const n=parseInt(s,10);if(n>=1&&n<=7)return n}return 4});return p.useEffect(()=>{localStorage.setItem("fontSizeLevel",e.toString());const s=document.documentElement;s.classList.remove("font-size-1","font-size-2","font-size-3","font-size-4","font-size-5","font-size-6","font-size-7"),s.classList.add(`font-size-${e}`);const n={1:.55,2:.65,3:.75,4:.85,5:.95,6:1.05,7:1.15};s.style.setProperty("--font-scale",n[e].toString())},[e]),a.jsx(vp.Provider,{value:{fontSizeLevel:e,setFontSizeLevel:r},children:t})},FN=()=>{const{openAddTodoModal:t,focusSearch:e,toggleSidebar:r,switchToTodayView:s,switchToWeekView:n,switchToMonthView:i}=ON();p.useEffect(()=>{const o=c=>{if(c.ctrlKey||c.metaKey)switch(c.key.toLowerCase()){case"1":c.preventDefault(),s();break;case"2":c.preventDefault(),n();break;case"3":c.preventDefault(),i();break;case"b":c.preventDefault(),r();break;case"n":c.preventDefault(),t();break;case"f":c.preventDefault(),e();break;case"k":c.preventDefault(),l();break}if(c.key==="Escape"){const d=document.querySelectorAll('[role="dialog"]');if(d.length>0){c.preventDefault();const u=d[d.length-1].querySelector('[aria-label="ë‹«ê¸°"], [data-close]');u&&u.click()}}},l=()=>{alert(`ğŸ¯ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤:

`+["Ctrl+1: ì˜¤ëŠ˜ ë·°","Ctrl+2: ì£¼ê°„ ë·°","Ctrl+3: ì›”ê°„ ë·°","Ctrl+N: ìƒˆ í• ì¼ ì¶”ê°€","Ctrl+F: ê²€ìƒ‰","Ctrl+B: ì‚¬ì´ë“œë°” í† ê¸€","Ctrl+K: ë‹¨ì¶•í‚¤ ë„ì›€ë§","ESC: ëª¨ë‹¬ ë‹«ê¸°"].join(`
`))};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t,e,r,s,n,i])};class WN{constructor(){Ht(this,"metrics",[]);Ht(this,"observers",[]);this.setupObservers(),this.measureInitialLoad()}setupObservers(){try{if("PerformanceObserver"in window){const e=new PerformanceObserver(i=>{const o=i.getEntries(),l=o[o.length-1];this.recordMetric("LCP",l.startTime,this.getRating("LCP",l.startTime))});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e);const r=new PerformanceObserver(i=>{for(const o of i.getEntries()){const l=o.processingStart-o.startTime;this.recordMetric("FID",l,this.getRating("FID",l))}});r.observe({entryTypes:["first-input"]}),this.observers.push(r);let s=0;const n=new PerformanceObserver(i=>{for(const o of i.getEntries())o.hadRecentInput||(s+=o.value);this.recordMetric("CLS",s,this.getRating("CLS",s))});n.observe({entryTypes:["layout-shift"]}),this.observers.push(n)}}catch(e){ne.error("Performance observer setup failed:",e)}}measureInitialLoad(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.collectNavigationMetrics()):this.collectNavigationMetrics()}collectNavigationMetrics(){if(performance.getEntriesByType){const e=performance.getEntriesByType("navigation")[0];if(e){const r=e.responseStart-e.requestStart;this.recordMetric("TTFB",r,this.getRating("TTFB",r));const s=e.domContentLoadedEventEnd-e.domContentLoadedEventStart;this.recordMetric("DOM_LOADED",s,this.getRating("DOM_LOADED",s));const n=e.loadEventEnd-e.loadEventStart;this.recordMetric("LOAD_COMPLETE",n,this.getRating("LOAD_COMPLETE",n))}}}getRating(e,r){const n={LCP:{good:2500,poor:4e3},FID:{good:100,poor:300},CLS:{good:.1,poor:.25},TTFB:{good:800,poor:1800},DOM_LOADED:{good:1e3,poor:3e3},LOAD_COMPLETE:{good:2e3,poor:5e3}}[e];return!n||r<=n.good?"good":r<=n.poor?"needs-improvement":"poor"}recordMetric(e,r,s){const n={name:e,value:r,rating:s,timestamp:Date.now()};this.metrics.push(n),ne.log(`Performance metric: ${e} = ${r.toFixed(2)}ms (${s})`),s==="poor"&&ne.warn(`Poor performance detected: ${e} = ${r.toFixed(2)}ms`)}measureMemoryUsage(){}getMetrics(){return[...this.metrics]}getSummary(){const e={};return[...new Set(this.metrics.map(s=>s.name))].forEach(s=>{const n=this.metrics.filter(i=>i.name===s).sort((i,o)=>o.timestamp-i.timestamp)[0];n&&(e[s]={value:n.value,rating:n.rating})}),e}cleanup(){this.observers.forEach(e=>e.disconnect()),this.observers=[],this.metrics=[]}}const VN=new WN,UN=t=>{const e=performance.now();return()=>{const s=performance.now()-e;ne.log(`Render time for ${t}: ${s.toFixed(2)}ms`),s>16.67&&ne.warn(`Slow render detected: ${t} took ${s.toFixed(2)}ms`)}};class BN{constructor(){Ht(this,"errors",[]);Ht(this,"maxErrors",100);this.setupGlobalErrorHandling()}setupGlobalErrorHandling(){window.addEventListener("error",e=>{this.trackError({message:e.message,stack:e.error?.stack,severity:"high",context:{filename:e.filename,lineno:e.lineno,colno:e.colno}})}),window.addEventListener("unhandledrejection",e=>{const r=e.reason;this.trackError({message:r?.message||"Unhandled promise rejection",stack:r?.stack,severity:"high",context:{type:"unhandled_promise_rejection",reason:r}})}),window.addEventListener("error",e=>{e.target!==window&&this.trackError({message:"Resource loading failed",severity:"medium",context:{type:"resource_error",element:e.target?.tagName,source:e.target?.src||e.target?.href}})},!0)}trackError(e){const r={id:this.generateErrorId(),message:e.message,stack:e.stack,severity:e.severity,timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent,userId:e.userId,context:e.context,resolved:!1};return this.errors.push(r),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors)),r.severity==="critical"||r.severity==="high"?ne.error(`[ErrorTracker] ${r.severity.toUpperCase()}: ${r.message}`,{id:r.id,stack:r.stack,context:r.context}):ne.warn(`[ErrorTracker] ${r.severity.toUpperCase()}: ${r.message}`),r.id}trackReactError(e,r,s){return this.trackError({message:`React Error: ${e.message}`,stack:e.stack,severity:"high",context:{type:"react_error",componentStack:r.componentStack,errorBoundary:r.errorBoundary},userId:s})}trackFirebaseError(e,r,s){const n=this.getFirebaseErrorSeverity(e.code);return this.trackError({message:`Firebase Error in ${r}: ${e.message}`,stack:e.stack,severity:n,context:{type:"firebase_error",code:e.code,operation:r,customData:e.customData},userId:s})}trackUserActionError(e,r,s){return this.trackError({message:`User Action Error (${e}): ${r.message}`,stack:r.stack,severity:"medium",context:{type:"user_action_error",action:e,timestamp:Date.now()},userId:s})}getFirebaseErrorSeverity(e){const r=["internal","unavailable","data-loss"],s=["permission-denied","unauthenticated","failed-precondition"],n=["not-found","already-exists","invalid-argument"];return r.includes(e)?"critical":s.includes(e)?"high":n.includes(e)?"medium":"low"}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}resolveError(e){const r=this.errors.find(s=>s.id===e);return r?(r.resolved=!0,!0):!1}getErrorStats(){const e=this.errors.length,r=this.errors.filter(o=>o.resolved).length,s=e-r,n=this.errors.reduce((o,l)=>(o[l.severity]=(o[l.severity]||0)+1,o),{}),i=this.errors.slice(-10).sort((o,l)=>l.timestamp-o.timestamp);return{total:e,resolved:r,unresolved:s,bySeverity:n,recent:i}}getCriticalErrors(){return this.errors.filter(e=>(e.severity==="critical"||e.severity==="high")&&!e.resolved)}searchErrors(e){const r=e.toLowerCase();return this.errors.filter(s=>s.message.toLowerCase().includes(r)||s.stack?.toLowerCase().includes(r))}exportErrors(){return JSON.stringify(this.errors,null,2)}cleanup(){this.errors=[]}}const wp=new BN,xR=t=>(e,r)=>{wp.trackReactError(e,{componentStack:r.componentStack,errorBoundary:t})},HN=()=>{const t=document.querySelector('meta[http-equiv="Content-Security-Policy"]');t&&ne.log("CSP policy found:",t.getAttribute("content"))},GN=()=>{try{const t="_security_test",e="test";localStorage.setItem(t,e);const r=localStorage.getItem(t);localStorage.removeItem(t),r!==e?ne.error("localStorage security test failed"):ne.log("localStorage security validation passed")}catch(t){ne.error("localStorage access error:",t)}},zN=async()=>{try{return typeof window<"u"&&window.firebase?(ne.log("Firebase is properly initialized"),!0):(ne.warn("Firebase not found or not initialized"),!1)}catch(t){return ne.error("Firebase validation error:",t),!1}},kp=()=>({https:window.location.protocol==="https:",secureContext:window.isSecureContext,cookieSecure:document.cookie.includes("Secure"),localStorage:!!window.localStorage,sessionStorage:!!window.sessionStorage}),KN=()=>{HN(),GN(),kp(),zN(),window.addEventListener("error",t=>{t.error&&t.error.name==="SecurityError"&&ne.error("Security error detected:",t.error)})},Hu=()=>{const t=[],e=kp(),r=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",s=e.https||r?"pass":"fail";return t.push({name:"HTTPS",status:s,details:e.https?"Site served over HTTPS":r?"Localhost allowed without HTTPS":"Site not served over HTTPS"}),t.push({name:"Secure Context",status:e.secureContext?"pass":"fail",details:e.secureContext?"Running in secure context":"Not running in secure context"}),t.push({name:"Local Storage",status:e.localStorage?"pass":"fail",details:e.localStorage?"localStorage available":"localStorage not available"}),{timestamp:Date.now(),checks:t}},Ie=t=>typeof t=="string",_n=()=>{let t,e;const r=new Promise((s,n)=>{t=s,e=n});return r.resolve=t,r.reject=e,r},Gu=t=>t==null?"":""+t,YN=(t,e,r)=>{t.forEach(s=>{e[s]&&(r[s]=e[s])})},qN=/###/g,zu=t=>t&&t.indexOf("###")>-1?t.replace(qN,"."):t,Ku=t=>!t||Ie(t),Fn=(t,e,r)=>{const s=Ie(e)?e.split("."):e;let n=0;for(;n<s.length-1;){if(Ku(t))return{};const i=zu(s[n]);!t[i]&&r&&(t[i]=new r),Object.prototype.hasOwnProperty.call(t,i)?t=t[i]:t={},++n}return Ku(t)?{}:{obj:t,k:zu(s[n])}},Yu=(t,e,r)=>{const{obj:s,k:n}=Fn(t,e,Object);if(s!==void 0||e.length===1){s[n]=r;return}let i=e[e.length-1],o=e.slice(0,e.length-1),l=Fn(t,o,Object);for(;l.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),l=Fn(t,o,Object),l?.obj&&typeof l.obj[`${l.k}.${i}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${i}`]=r},XN=(t,e,r,s)=>{const{obj:n,k:i}=Fn(t,e,Object);n[i]=n[i]||[],n[i].push(r)},wi=(t,e)=>{const{obj:r,k:s}=Fn(t,e);if(r&&Object.prototype.hasOwnProperty.call(r,s))return r[s]},QN=(t,e,r)=>{const s=wi(t,r);return s!==void 0?s:wi(e,r)},Tp=(t,e,r)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in t?Ie(t[s])||t[s]instanceof String||Ie(e[s])||e[s]instanceof String?r&&(t[s]=e[s]):Tp(t[s],e[s],r):t[s]=e[s]);return t},Is=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var JN={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const ZN=t=>Ie(t)?t.replace(/[&<>"'\/]/g,e=>JN[e]):t;class eS{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const r=this.regExpMap.get(e);if(r!==void 0)return r;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const tS=[" ",",","?","!",";"],rS=new eS(20),sS=(t,e,r)=>{e=e||"",r=r||"";const s=tS.filter(o=>e.indexOf(o)<0&&r.indexOf(o)<0);if(s.length===0)return!0;const n=rS.getRegExp(`(${s.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!n.test(t);if(!i){const o=t.indexOf(r);o>0&&!n.test(t.substring(0,o))&&(i=!0)}return i},xl=(t,e,r=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const s=e.split(r);let n=t;for(let i=0;i<s.length;){if(!n||typeof n!="object")return;let o,l="";for(let c=i;c<s.length;++c)if(c!==i&&(l+=r),l+=s[c],o=n[l],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&c<s.length-1)continue;i+=c-i+1;break}n=o}return n},oa=t=>t?.replace("_","-"),nS={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class ki{constructor(e,r={}){this.init(e,r)}init(e,r={}){this.prefix=r.prefix||"i18next:",this.logger=e||nS,this.options=r,this.debug=r.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,r,s,n){return n&&!this.debug?null:(Ie(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[r](e))}create(e){return new ki(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new ki(this.logger,e)}}var mr=new ki;class Ji{constructor(){this.observers={}}on(e,r){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const n=this.observers[s].get(r)||0;this.observers[s].set(r,n+1)}),this}off(e,r){if(this.observers[e]){if(!r){delete this.observers[e];return}this.observers[e].delete(r)}}emit(e,...r){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([n,i])=>{for(let o=0;o<i;o++)n(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([n,i])=>{for(let o=0;o<i;o++)n.apply(n,[e,...r])})}}class qu extends Ji{constructor(e,r={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const r=this.options.ns.indexOf(e);r>-1&&this.options.ns.splice(r,1)}getResource(e,r,s,n={}){const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,o=n.ignoreJSONStructure!==void 0?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,r],s&&(Array.isArray(s)?l.push(...s):Ie(s)&&i?l.push(...s.split(i)):l.push(s)));const c=wi(this.data,l);return!c&&!r&&!s&&e.indexOf(".")>-1&&(e=l[0],r=l[1],s=l.slice(2).join(".")),c||!o||!Ie(s)?c:xl(this.data?.[e]?.[r],s,i)}addResource(e,r,s,n,i={silent:!1}){const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let l=[e,r];s&&(l=l.concat(o?s.split(o):s)),e.indexOf(".")>-1&&(l=e.split("."),n=r,r=l[1]),this.addNamespaces(r),Yu(this.data,l,n),i.silent||this.emit("added",e,r,s,n)}addResources(e,r,s,n={silent:!1}){for(const i in s)(Ie(s[i])||Array.isArray(s[i]))&&this.addResource(e,r,i,s[i],{silent:!0});n.silent||this.emit("added",e,r,s)}addResourceBundle(e,r,s,n,i,o={silent:!1,skipCopy:!1}){let l=[e,r];e.indexOf(".")>-1&&(l=e.split("."),n=s,s=r,r=l[1]),this.addNamespaces(r);let c=wi(this.data,l)||{};o.skipCopy||(s=JSON.parse(JSON.stringify(s))),n?Tp(c,s,i):c={...c,...s},Yu(this.data,l,c),o.silent||this.emit("added",e,r,s)}removeResourceBundle(e,r){this.hasResourceBundle(e,r)&&delete this.data[e][r],this.removeNamespaces(r),this.emit("removed",e,r)}hasResourceBundle(e,r){return this.getResource(e,r)!==void 0}getResourceBundle(e,r){return r||(r=this.options.defaultNS),this.getResource(e,r)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const r=this.getDataByLanguage(e);return!!(r&&Object.keys(r)||[]).find(n=>r[n]&&Object.keys(r[n]).length>0)}toJSON(){return this.data}}var Np={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,r,s,n){return t.forEach(i=>{e=this.processors[i]?.process(e,r,s,n)??e}),e}};const Sp=Symbol("i18next/PATH_KEY");function aS(){const t=[],e=Object.create(null);let r;return e.get=(s,n)=>(r?.revoke?.(),n===Sp?t:(t.push(n),r=Proxy.revocable(s,e),r.proxy)),Proxy.revocable(Object.create(null),e).proxy}function bl(t,e){const{[Sp]:r}=t(aS());return r.join(e?.keySeparator??".")}const Xu={},Eo=t=>!Ie(t)&&typeof t!="boolean"&&typeof t!="number";class Ti extends Ji{constructor(e,r={}){super(),YN(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=mr.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,r={interpolation:{}}){const s={...r};if(e==null)return!1;const n=this.resolve(e,s);if(n?.res===void 0)return!1;const i=Eo(n.res);return!(s.returnObjects===!1&&i)}extractFromKey(e,r){let s=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const n=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let i=r.ns||this.options.defaultNS||[];const o=s&&e.indexOf(s)>-1,l=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!sS(e,s,n);if(o&&!l){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:Ie(i)?[i]:i};const d=e.split(s);(s!==n||s===n&&this.options.ns.indexOf(d[0])>-1)&&(i=d.shift()),e=d.join(n)}return{key:e,namespaces:Ie(i)?[i]:i}}translate(e,r,s){let n=typeof r=="object"?{...r}:r;if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";typeof e=="function"&&(e=bl(e,{...this.options,...n})),Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,o=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:l,namespaces:c}=this.extractFromKey(e[e.length-1],n),d=c[c.length-1];let u=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;u===void 0&&(u=":");const h=n.lng||this.language,g=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h?.toLowerCase()==="cimode")return g?i?{res:`${d}${u}${l}`,usedKey:l,exactUsedKey:l,usedLng:h,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:`${d}${u}${l}`:i?{res:l,usedKey:l,exactUsedKey:l,usedLng:h,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:l;const m=this.resolve(e,n);let x=m?.res;const f=m?.usedKey||l,y=m?.exactUsedKey||l,w=["[object Number]","[object Function]","[object RegExp]"],v=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,k=!this.i18nFormat||this.i18nFormat.handleAsObject,b=n.count!==void 0&&!Ie(n.count),j=Ti.hasDefaultValue(n),D=b?this.pluralResolver.getSuffix(h,n.count,n):"",N=n.ordinal&&b?this.pluralResolver.getSuffix(h,n.count,{ordinal:!1}):"",T=b&&!n.ordinal&&n.count===0,_=T&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${D}`]||n[`defaultValue${N}`]||n.defaultValue;let P=x;k&&!x&&j&&(P=_);const C=Eo(P),A=Object.prototype.toString.apply(P);if(k&&P&&C&&w.indexOf(A)<0&&!(Ie(v)&&Array.isArray(P))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const B=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,P,{...n,ns:c}):`key '${l} (${this.language})' returned an object instead of string.`;return i?(m.res=B,m.usedParams=this.getUsedParamsDetails(n),m):B}if(o){const B=Array.isArray(P),z=B?[]:{},W=B?y:f;for(const X in P)if(Object.prototype.hasOwnProperty.call(P,X)){const V=`${W}${o}${X}`;j&&!x?z[X]=this.translate(V,{...n,defaultValue:Eo(_)?_[X]:void 0,joinArrays:!1,ns:c}):z[X]=this.translate(V,{...n,joinArrays:!1,ns:c}),z[X]===V&&(z[X]=P[X])}x=z}}else if(k&&Ie(v)&&Array.isArray(x))x=x.join(v),x&&(x=this.extendTranslation(x,e,n,s));else{let B=!1,z=!1;!this.isValidLookup(x)&&j&&(B=!0,x=_),this.isValidLookup(x)||(z=!0,x=l);const X=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&z?void 0:x,V=j&&_!==x&&this.options.updateMissing;if(z||B||V){if(this.logger.log(V?"updateKey":"missingKey",h,d,l,V?_:x),o){const me=this.resolve(l,{...n,keySeparator:!1});me&&me.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let ce=[];const ke=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ke&&ke[0])for(let me=0;me<ke.length;me++)ce.push(ke[me]);else this.options.saveMissingTo==="all"?ce=this.languageUtils.toResolveHierarchy(n.lng||this.language):ce.push(n.lng||this.language);const Se=(me,ue,Y)=>{const ie=j&&Y!==x?Y:X;this.options.missingKeyHandler?this.options.missingKeyHandler(me,d,ue,ie,V,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(me,d,ue,ie,V,n),this.emit("missingKey",me,d,ue,x)};this.options.saveMissing&&(this.options.saveMissingPlurals&&b?ce.forEach(me=>{const ue=this.pluralResolver.getSuffixes(me,n);T&&n[`defaultValue${this.options.pluralSeparator}zero`]&&ue.indexOf(`${this.options.pluralSeparator}zero`)<0&&ue.push(`${this.options.pluralSeparator}zero`),ue.forEach(Y=>{Se([me],l+Y,n[`defaultValue${Y}`]||_)})}):Se(ce,l,_))}x=this.extendTranslation(x,e,n,m,s),z&&x===l&&this.options.appendNamespaceToMissingKey&&(x=`${d}${u}${l}`),(z||B)&&this.options.parseMissingKeyHandler&&(x=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${d}${u}${l}`:l,B?x:void 0,n))}return i?(m.res=x,m.usedParams=this.getUsedParamsDetails(n),m):x}extendTranslation(e,r,s,n,i){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const c=Ie(e)&&(s?.interpolation?.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(c){const h=e.match(this.interpolator.nestingRegexp);d=h&&h.length}let u=s.replace&&!Ie(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(u={...this.options.interpolation.defaultVariables,...u}),e=this.interpolator.interpolate(e,u,s.lng||this.language||n.usedLng,s),c){const h=e.match(this.interpolator.nestingRegexp),g=h&&h.length;d<g&&(s.nest=!1)}!s.lng&&n&&n.res&&(s.lng=this.language||n.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,(...h)=>i?.[0]===h[0]&&!s.context?(this.logger.warn(`It seems you are nesting recursively key: ${h[0]} in key: ${r[0]}`),null):this.translate(...h,r),s)),s.interpolation&&this.interpolator.reset()}const o=s.postProcess||this.options.postProcess,l=Ie(o)?[o]:o;return e!=null&&l?.length&&s.applyPostProcessor!==!1&&(e=Np.handle(l,e,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e,r={}){let s,n,i,o,l;return Ie(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(s))return;const d=this.extractFromKey(c,r),u=d.key;n=u;let h=d.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const g=r.count!==void 0&&!Ie(r.count),m=g&&!r.ordinal&&r.count===0,x=r.context!==void 0&&(Ie(r.context)||typeof r.context=="number")&&r.context!=="",f=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);h.forEach(y=>{this.isValidLookup(s)||(l=y,!Xu[`${f[0]}-${y}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(l)&&(Xu[`${f[0]}-${y}`]=!0,this.logger.warn(`key "${n}" for languages "${f.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach(w=>{if(this.isValidLookup(s))return;o=w;const v=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(v,u,w,y,r);else{let b;g&&(b=this.pluralResolver.getSuffix(w,r.count,r));const j=`${this.options.pluralSeparator}zero`,D=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(g&&(r.ordinal&&b.indexOf(D)===0&&v.push(u+b.replace(D,this.options.pluralSeparator)),v.push(u+b),m&&v.push(u+j)),x){const N=`${u}${this.options.contextSeparator||"_"}${r.context}`;v.push(N),g&&(r.ordinal&&b.indexOf(D)===0&&v.push(N+b.replace(D,this.options.pluralSeparator)),v.push(N+b),m&&v.push(N+j))}}let k;for(;k=v.pop();)this.isValidLookup(s)||(i=k,s=this.getResource(w,y,k,r))}))})}),{res:s,usedKey:n,exactUsedKey:i,usedLng:o,usedNS:l}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,r,s,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,r,s,n):this.resourceStore.getResource(e,r,s,n)}getUsedParamsDetails(e={}){const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!Ie(e.replace);let n=s?e.replace:e;if(s&&typeof e.count<"u"&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!s){n={...n};for(const i of r)delete n[i]}return n}static hasDefaultValue(e){const r="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&r===s.substring(0,r.length)&&e[s]!==void 0)return!0;return!1}}class Qu{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=mr.create("languageUtils")}getScriptPartFromCode(e){if(e=oa(e),!e||e.indexOf("-")<0)return null;const r=e.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(e){if(e=oa(e),!e||e.indexOf("-")<0)return e;const r=e.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(e){if(Ie(e)&&e.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(e)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let r;return e.forEach(s=>{if(r)return;const n=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(n))&&(r=n)}),!r&&this.options.supportedLngs&&e.forEach(s=>{if(r)return;const n=this.getScriptPartFromCode(s);if(this.isSupportedCode(n))return r=n;const i=this.getLanguagePartFromCode(s);if(this.isSupportedCode(i))return r=i;r=this.options.supportedLngs.find(o=>{if(o===i)return o;if(!(o.indexOf("-")<0&&i.indexOf("-")<0)&&(o.indexOf("-")>0&&i.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===i||o.indexOf(i)===0&&i.length>1))return o})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(e,r){if(!e)return[];if(typeof e=="function"&&(e=e(r)),Ie(e)&&(e=[e]),Array.isArray(e))return e;if(!r)return e.default||[];let s=e[r];return s||(s=e[this.getScriptPartFromCode(r)]),s||(s=e[this.formatLanguageCode(r)]),s||(s=e[this.getLanguagePartFromCode(r)]),s||(s=e.default),s||[]}toResolveHierarchy(e,r){const s=this.getFallbackCodes((r===!1?[]:r)||this.options.fallbackLng||[],e),n=[],i=o=>{o&&(this.isSupportedCode(o)?n.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return Ie(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):Ie(e)&&i(this.formatLanguageCode(e)),s.forEach(o=>{n.indexOf(o)<0&&i(this.formatLanguageCode(o))}),n}}const Ju={zero:0,one:1,two:2,few:3,many:4,other:5},Zu={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class iS{constructor(e,r={}){this.languageUtils=e,this.options=r,this.logger=mr.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,r){this.rules[e]=r}clearCache(){this.pluralRulesCache={}}getRule(e,r={}){const s=oa(e==="dev"?"en":e),n=r.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:n});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(s,{type:n})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Zu;if(!e.match(/-|_/))return Zu;const c=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(c,r)}return this.pluralRulesCache[i]=o,o}needsPlural(e,r={}){let s=this.getRule(e,r);return s||(s=this.getRule("dev",r)),s?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,r,s={}){return this.getSuffixes(e,s).map(n=>`${r}${n}`)}getSuffixes(e,r={}){let s=this.getRule(e,r);return s||(s=this.getRule("dev",r)),s?s.resolvedOptions().pluralCategories.sort((n,i)=>Ju[n]-Ju[i]).map(n=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${n}`):[]}getSuffix(e,r,s={}){const n=this.getRule(e,s);return n?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${n.select(r)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",r,s))}}const eh=(t,e,r,s=".",n=!0)=>{let i=QN(t,e,r);return!i&&n&&Ie(r)&&(i=xl(t,r,s),i===void 0&&(i=xl(e,r,s))),i},Io=t=>t.replace(/\$/g,"$$$$");class th{constructor(e={}){this.logger=mr.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(r=>r),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:r,escapeValue:s,useRawValueToEscape:n,prefix:i,prefixEscaped:o,suffix:l,suffixEscaped:c,formatSeparator:d,unescapeSuffix:u,unescapePrefix:h,nestingPrefix:g,nestingPrefixEscaped:m,nestingSuffix:x,nestingSuffixEscaped:f,nestingOptionsSeparator:y,maxReplaces:w,alwaysFormat:v}=e.interpolation;this.escape=r!==void 0?r:ZN,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=n!==void 0?n:!1,this.prefix=i?Is(i):o||"{{",this.suffix=l?Is(l):c||"}}",this.formatSeparator=d||",",this.unescapePrefix=u?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=g?Is(g):m||Is("$t("),this.nestingSuffix=x?Is(x):f||Is(")"),this.nestingOptionsSeparator=y||",",this.maxReplaces=w||1e3,this.alwaysFormat=v!==void 0?v:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(r,s)=>r?.source===s?(r.lastIndex=0,r):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,r,s,n){let i,o,l;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=m=>{if(m.indexOf(this.formatSeparator)<0){const w=eh(r,c,m,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(w,void 0,s,{...n,...r,interpolationkey:m}):w}const x=m.split(this.formatSeparator),f=x.shift().trim(),y=x.join(this.formatSeparator).trim();return this.format(eh(r,c,f,this.options.keySeparator,this.options.ignoreJSONStructure),y,s,{...n,...r,interpolationkey:f})};this.resetRegExp();const u=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:m=>Io(m)},{regex:this.regexp,safeValue:m=>this.escapeValue?Io(this.escape(m)):Io(m)}].forEach(m=>{for(l=0;i=m.regex.exec(e);){const x=i[1].trim();if(o=d(x),o===void 0)if(typeof u=="function"){const y=u(e,i,n);o=Ie(y)?y:""}else if(n&&Object.prototype.hasOwnProperty.call(n,x))o="";else if(h){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${x} for interpolating ${e}`),o="";else!Ie(o)&&!this.useRawValueToEscape&&(o=Gu(o));const f=m.safeValue(o);if(e=e.replace(i[0],f),h?(m.regex.lastIndex+=o.length,m.regex.lastIndex-=i[0].length):m.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),e}nest(e,r,s={}){let n,i,o;const l=(c,d)=>{const u=this.nestingOptionsSeparator;if(c.indexOf(u)<0)return c;const h=c.split(new RegExp(`${u}[ ]*{`));let g=`{${h[1]}`;c=h[0],g=this.interpolate(g,o);const m=g.match(/'/g),x=g.match(/"/g);((m?.length??0)%2===0&&!x||x.length%2!==0)&&(g=g.replace(/'/g,'"'));try{o=JSON.parse(g),d&&(o={...d,...o})}catch(f){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,f),`${c}${u}${g}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,c};for(;n=this.nestingRegexp.exec(e);){let c=[];o={...s},o=o.replace&&!Ie(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;const d=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(d!==-1&&(c=n[1].slice(d).split(this.formatSeparator).map(u=>u.trim()).filter(Boolean),n[1]=n[1].slice(0,d)),i=r(l.call(this,n[1].trim(),o),o),i&&n[0]===e&&!Ie(i))return i;Ie(i)||(i=Gu(i)),i||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),i=""),c.length&&(i=c.reduce((u,h)=>this.format(u,h,s.lng,{...s,interpolationkey:n[1].trim()}),i.trim())),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e}}const oS=t=>{let e=t.toLowerCase().trim();const r={};if(t.indexOf("(")>-1){const s=t.split("(");e=s[0].toLowerCase().trim();const n=s[1].substring(0,s[1].length-1);e==="currency"&&n.indexOf(":")<0?r.currency||(r.currency=n.trim()):e==="relativetime"&&n.indexOf(":")<0?r.range||(r.range=n.trim()):n.split(";").forEach(o=>{if(o){const[l,...c]=o.split(":"),d=c.join(":").trim().replace(/^'+|'+$/g,""),u=l.trim();r[u]||(r[u]=d),d==="false"&&(r[u]=!1),d==="true"&&(r[u]=!0),isNaN(d)||(r[u]=parseInt(d,10))}})}return{formatName:e,formatOptions:r}},rh=t=>{const e={};return(r,s,n)=>{let i=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(i={...i,[n.interpolationkey]:void 0});const o=s+JSON.stringify(i);let l=e[o];return l||(l=t(oa(s),n),e[o]=l),l(r)}},lS=t=>(e,r,s)=>t(oa(r),s)(e);class cS{constructor(e={}){this.logger=mr.create("formatter"),this.options=e,this.init(e)}init(e,r={interpolation:{}}){this.formatSeparator=r.interpolation.formatSeparator||",";const s=r.cacheInBuiltFormats?rh:lS;this.formats={number:s((n,i)=>{const o=new Intl.NumberFormat(n,{...i});return l=>o.format(l)}),currency:s((n,i)=>{const o=new Intl.NumberFormat(n,{...i,style:"currency"});return l=>o.format(l)}),datetime:s((n,i)=>{const o=new Intl.DateTimeFormat(n,{...i});return l=>o.format(l)}),relativetime:s((n,i)=>{const o=new Intl.RelativeTimeFormat(n,{...i});return l=>o.format(l,i.range||"day")}),list:s((n,i)=>{const o=new Intl.ListFormat(n,{...i});return l=>o.format(l)})}}add(e,r){this.formats[e.toLowerCase().trim()]=r}addCached(e,r){this.formats[e.toLowerCase().trim()]=rh(r)}format(e,r,s,n={}){const i=r.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(l=>l.indexOf(")")>-1)){const l=i.findIndex(c=>c.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,l)].join(this.formatSeparator)}return i.reduce((l,c)=>{const{formatName:d,formatOptions:u}=oS(c);if(this.formats[d]){let h=l;try{const g=n?.formatParams?.[n.interpolationkey]||{},m=g.locale||g.lng||n.locale||n.lng||s;h=this.formats[d](l,m,{...u,...n,...g})}catch(g){this.logger.warn(g)}return h}else this.logger.warn(`there was no format function for ${d}`);return l},e)}}const dS=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class uS extends Ji{constructor(e,r,s,n={}){super(),this.backend=e,this.store=r,this.services=s,this.languageUtils=s.languageUtils,this.options=n,this.logger=mr.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(s,n.backend,n)}queueLoad(e,r,s,n){const i={},o={},l={},c={};return e.forEach(d=>{let u=!0;r.forEach(h=>{const g=`${d}|${h}`;!s.reload&&this.store.hasResourceBundle(d,h)?this.state[g]=2:this.state[g]<0||(this.state[g]===1?o[g]===void 0&&(o[g]=!0):(this.state[g]=1,u=!1,o[g]===void 0&&(o[g]=!0),i[g]===void 0&&(i[g]=!0),c[h]===void 0&&(c[h]=!0)))}),u||(l[d]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(c)}}loaded(e,r,s){const n=e.split("|"),i=n[0],o=n[1];r&&this.emit("failedLoading",i,o,r),!r&&s&&this.store.addResourceBundle(i,o,s,void 0,void 0,{skipCopy:!0}),this.state[e]=r?-1:2,r&&s&&(this.state[e]=0);const l={};this.queue.forEach(c=>{XN(c.loaded,[i],o),dS(c,e),r&&c.errors.push(r),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(d=>{l[d]||(l[d]={});const u=c.loaded[d];u.length&&u.forEach(h=>{l[d][h]===void 0&&(l[d][h]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(c=>!c.done)}read(e,r,s,n=0,i=this.retryTimeout,o){if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:r,fcName:s,tried:n,wait:i,callback:o});return}this.readingCalls++;const l=(d,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(d&&u&&n<this.maxRetries){setTimeout(()=>{this.read.call(this,e,r,s,n+1,i*2,o)},i);return}o(d,u)},c=this.backend[s].bind(this.backend);if(c.length===2){try{const d=c(e,r);d&&typeof d.then=="function"?d.then(u=>l(null,u)).catch(l):l(null,d)}catch(d){l(d)}return}return c(e,r,l)}prepareLoading(e,r,s={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();Ie(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Ie(r)&&(r=[r]);const i=this.queueLoad(e,r,s,n);if(!i.toLoad.length)return i.pending.length||n(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,r,s){this.prepareLoading(e,r,{},s)}reload(e,r,s){this.prepareLoading(e,r,{reload:!0},s)}loadOne(e,r=""){const s=e.split("|"),n=s[0],i=s[1];this.read(n,i,"read",void 0,void 0,(o,l)=>{o&&this.logger.warn(`${r}loading namespace ${i} for language ${n} failed`,o),!o&&l&&this.logger.log(`${r}loaded namespace ${i} for language ${n}`,l),this.loaded(e,o,l)})}saveMissing(e,r,s,n,i,o={},l=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(r)){this.logger.warn(`did not save key "${s}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend?.create){const c={...o,isUpdate:i},d=this.backend.create.bind(this.backend);if(d.length<6)try{let u;d.length===5?u=d(e,r,s,n,c):u=d(e,r,s,n),u&&typeof u.then=="function"?u.then(h=>l(null,h)).catch(l):l(null,u)}catch(u){l(u)}else d(e,r,s,n,l,c)}!e||!e[0]||this.store.addResource(e[0],r,s,n)}}}const sh=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),Ie(t[1])&&(e.defaultValue=t[1]),Ie(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const r=t[3]||t[2];Object.keys(r).forEach(s=>{e[s]=r[s]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),nh=t=>(Ie(t.ns)&&(t.ns=[t.ns]),Ie(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),Ie(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),$a=()=>{},hS=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(r=>{typeof t[r]=="function"&&(t[r]=t[r].bind(t))})};class Wn extends Ji{constructor(e={},r){if(super(),this.options=nh(e),this.services={},this.logger=mr,this.modules={external:[]},hS(this),r&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,r),this;setTimeout(()=>{this.init(e,r)},0)}}init(e={},r){this.isInitializing=!0,typeof e=="function"&&(r=e,e={}),e.defaultNS==null&&e.ns&&(Ie(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const s=sh();this.options={...s,...this.options,...nh(e)},this.options.interpolation={...s.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=s.overloadTranslationOptionHandler);const n=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?mr.init(n(this.modules.logger),this.options):mr.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=cS;const u=new Qu(this.options);this.store=new qu(this.options.resources,this.options);const h=this.services;h.logger=mr,h.resourceStore=this.store,h.languageUtils=u,h.pluralResolver=new iS(u,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),d&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(h.formatter=n(d),h.formatter.init&&h.formatter.init(h,this.options),this.options.interpolation.format=h.formatter.format.bind(h.formatter)),h.interpolator=new th(this.options),h.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},h.backendConnector=new uS(n(this.modules.backend),h.resourceStore,h,this.options),h.backendConnector.on("*",(m,...x)=>{this.emit(m,...x)}),this.modules.languageDetector&&(h.languageDetector=n(this.modules.languageDetector),h.languageDetector.init&&h.languageDetector.init(h,this.options.detection,this.options)),this.modules.i18nFormat&&(h.i18nFormat=n(this.modules.i18nFormat),h.i18nFormat.init&&h.i18nFormat.init(this)),this.translator=new Ti(this.services,this.options),this.translator.on("*",(m,...x)=>{this.emit(m,...x)}),this.modules.external.forEach(m=>{m.init&&m.init(this)})}if(this.format=this.options.interpolation.format,r||(r=$a),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=(...u)=>this.store[d](...u)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=(...u)=>(this.store[d](...u),this)});const l=_n(),c=()=>{const d=(u,h)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(h),r(u,h)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),l}loadResources(e,r=$a){let s=r;const n=Ie(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(n?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const i=[],o=l=>{if(!l||l==="cimode")return;this.services.languageUtils.toResolveHierarchy(l).forEach(d=>{d!=="cimode"&&i.indexOf(d)<0&&i.push(d)})};n?o(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>o(c)),this.options.preload?.forEach?.(l=>o(l)),this.services.backendConnector.load(i,this.options.ns,l=>{!l&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(l)})}else s(null)}reloadResources(e,r,s){const n=_n();return typeof e=="function"&&(s=e,e=void 0),typeof r=="function"&&(s=r,r=void 0),e||(e=this.languages),r||(r=this.options.ns),s||(s=$a),this.services.backendConnector.reload(e,r,i=>{n.resolve(),s(i)}),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&Np.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let r=0;r<this.languages.length;r++){const s=this.languages[r];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,r){this.isLanguageChangingTo=e;const s=_n();this.emit("languageChanging",e);const n=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},i=(l,c)=>{c?this.isLanguageChangingTo===e&&(n(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,s.resolve((...d)=>this.t(...d)),r&&r(l,(...d)=>this.t(...d))},o=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const c=Ie(l)?l:l&&l[0],d=this.store.hasLanguageSomeTranslations(c)?c:this.services.languageUtils.getBestMatchFromCodes(Ie(l)?[l]:l);d&&(this.language||n(d),this.translator.language||this.translator.changeLanguage(d),this.services.languageDetector?.cacheUserLanguage?.(d)),this.loadResources(d,u=>{i(u,d)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),s}getFixedT(e,r,s){const n=(i,o,...l)=>{let c;typeof o!="object"?c=this.options.overloadTranslationOptionHandler([i,o].concat(l)):c={...o},c.lng=c.lng||n.lng,c.lngs=c.lngs||n.lngs,c.ns=c.ns||n.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||s||n.keyPrefix);const d=this.options.keySeparator||".";let u;return c.keyPrefix&&Array.isArray(i)?u=i.map(h=>(typeof h=="function"&&(h=bl(h,{...this.options,...o})),`${c.keyPrefix}${d}${h}`)):(typeof i=="function"&&(i=bl(i,{...this.options,...o})),u=c.keyPrefix?`${c.keyPrefix}${d}${i}`:i),this.t(u,c)};return Ie(e)?n.lng=e:n.lngs=e,n.ns=r,n.keyPrefix=s,n}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,r={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=r.lng||this.resolvedLanguage||this.languages[0],n=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const o=(l,c)=>{const d=this.services.backendConnector.state[`${l}|${c}`];return d===-1||d===0||d===2};if(r.precheck){const l=r.precheck(this,o);if(l!==void 0)return l}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(s,e)&&(!n||o(i,e)))}loadNamespaces(e,r){const s=_n();return this.options.ns?(Ie(e)&&(e=[e]),e.forEach(n=>{this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}),this.loadResources(n=>{s.resolve(),r&&r(n)}),s):(r&&r(),Promise.resolve())}loadLanguages(e,r){const s=_n();Ie(e)&&(e=[e]);const n=this.options.preload||[],i=e.filter(o=>n.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=n.concat(i),this.loadResources(o=>{s.resolve(),r&&r(o)}),s):(r&&r(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const n=new Intl.Locale(e);if(n&&n.getTextInfo){const i=n.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services?.languageUtils||new Qu(sh());return e.toLowerCase().indexOf("-latn")>1?"ltr":r.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},r){const s=new Wn(e,r);return s.createInstance=Wn.createInstance,s}cloneInstance(e={},r=$a){const s=e.forkResourceStore;s&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},i=new Wn(n);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(l=>{i[l]=this[l]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const l=Object.keys(this.store.data).reduce((c,d)=>(c[d]={...this.store.data[d]},c[d]=Object.keys(c[d]).reduce((u,h)=>(u[h]={...c[d][h]},u),c[d]),c),{});i.store=new qu(l,n),i.services.resourceStore=i.store}return e.interpolation&&(i.services.interpolator=new th(n)),i.translator=new Ti(i.services,n),i.translator.on("*",(l,...c)=>{i.emit(l,...c)}),i.init(n,r),i.translator.options=n,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const It=Wn.createInstance();It.createInstance;It.dir;It.init;It.loadResources;It.reloadResources;It.use;It.changeLanguage;It.getFixedT;It.t;It.exists;It.setDefaultNamespace;It.hasLoadedNamespace;It.loadNamespaces;It.loadLanguages;const gS=(t,e,r,s)=>{const n=[r,{code:e,...s||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(n,"warn","react-i18next::",!0);fs(n[0])&&(n[0]=`react-i18next:: ${n[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...n):console?.warn&&console.warn(...n)},ah={},vl=(t,e,r,s)=>{fs(r)&&ah[r]||(fs(r)&&(ah[r]=new Date),gS(t,e,r,s))},jp=(t,e)=>()=>{if(t.isInitialized)e();else{const r=()=>{setTimeout(()=>{t.off("initialized",r)},0),e()};t.on("initialized",r)}},wl=(t,e,r)=>{t.loadNamespaces(e,jp(t,r))},ih=(t,e,r,s)=>{if(fs(r)&&(r=[r]),t.options.preload&&t.options.preload.indexOf(e)>-1)return wl(t,r,s);r.forEach(n=>{t.options.ns.indexOf(n)<0&&t.options.ns.push(n)}),t.loadLanguages(e,jp(t,s))},mS=(t,e,r={})=>!e.languages||!e.languages.length?(vl(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:r.lng,precheck:(s,n)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!n(s.isLanguageChangingTo,t))return!1}}),fs=t=>typeof t=="string",fS=t=>typeof t=="object"&&t!==null,pS=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,yS={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"Â©","&#169;":"Â©","&reg;":"Â®","&#174;":"Â®","&hellip;":"â€¦","&#8230;":"â€¦","&#x2F;":"/","&#47;":"/"},xS=t=>yS[t],bS=t=>t.replace(pS,xS);let kl={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:bS};const vS=(t={})=>{kl={...kl,...t}},wS=()=>kl;let _p;const kS=t=>{_p=t},TS=()=>_p,NS={type:"3rdParty",init(t){vS(t.options.react),kS(t)}},SS=p.createContext();class jS{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const _S=(t,e)=>{const r=p.useRef();return p.useEffect(()=>{r.current=t},[t,e]),r.current},Dp=(t,e,r,s)=>t.getFixedT(e,r,s),DS=(t,e,r,s)=>p.useCallback(Dp(t,e,r,s),[t,e,r,s]),Xe=(t,e={})=>{const{i18n:r}=e,{i18n:s,defaultNS:n}=p.useContext(SS)||{},i=r||s||TS();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new jS),!i){vl(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const b=(D,N)=>fs(N)?N:fS(N)&&fs(N.defaultValue)?N.defaultValue:Array.isArray(D)?D[D.length-1]:D,j=[b,{},!1];return j.t=b,j.i18n={},j.ready=!1,j}i.options.react?.wait&&vl(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...wS(),...i.options.react,...e},{useSuspense:l,keyPrefix:c}=o;let d=n||i.options?.defaultNS;d=fs(d)?[d]:d||["translation"],i.reportNamespaces.addUsedNamespaces?.(d);const u=(i.isInitialized||i.initializedStoreOnce)&&d.every(b=>mS(b,i,o)),h=DS(i,e.lng||null,o.nsMode==="fallback"?d:d[0],c),g=()=>h,m=()=>Dp(i,e.lng||null,o.nsMode==="fallback"?d:d[0],c),[x,f]=p.useState(g);let y=d.join();e.lng&&(y=`${e.lng}${y}`);const w=_S(y),v=p.useRef(!0);p.useEffect(()=>{const{bindI18n:b,bindI18nStore:j}=o;v.current=!0,!u&&!l&&(e.lng?ih(i,e.lng,d,()=>{v.current&&f(m)}):wl(i,d,()=>{v.current&&f(m)})),u&&w&&w!==y&&v.current&&f(m);const D=()=>{v.current&&f(m)};return b&&i?.on(b,D),j&&i?.store.on(j,D),()=>{v.current=!1,i&&b&&b?.split(" ").forEach(N=>i.off(N,D)),j&&i&&j.split(" ").forEach(N=>i.store.off(N,D))}},[i,y]),p.useEffect(()=>{v.current&&u&&f(g)},[i,c,u]);const k=[x,i,u];if(k.t=x,k.i18n=i,k.ready=u,u||!u&&!l)return k;throw new Promise(b=>{e.lng?ih(i,e.lng,d,()=>b()):wl(i,d,()=>b())})},{slice:CS,forEach:ES}=[];function IS(t){return ES.call(CS.call(arguments,1),e=>{if(e)for(const r in e)t[r]===void 0&&(t[r]=e[r])}),t}function AS(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(t))}const oh=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,RS=function(t,e){const s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},n=encodeURIComponent(e);let i=`${t}=${n}`;if(s.maxAge>0){const o=s.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");i+=`; Max-Age=${Math.floor(o)}`}if(s.domain){if(!oh.test(s.domain))throw new TypeError("option domain is invalid");i+=`; Domain=${s.domain}`}if(s.path){if(!oh.test(s.path))throw new TypeError("option path is invalid");i+=`; Path=${s.path}`}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");i+=`; Expires=${s.expires.toUTCString()}`}if(s.httpOnly&&(i+="; HttpOnly"),s.secure&&(i+="; Secure"),s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s.partitioned&&(i+="; Partitioned"),i},lh={create(t,e,r,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(n.expires=new Date,n.expires.setTime(n.expires.getTime()+r*60*1e3)),s&&(n.domain=s),document.cookie=RS(t,e,n)},read(t){const e=`${t}=`,r=document.cookie.split(";");for(let s=0;s<r.length;s++){let n=r[s];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(e)===0)return n.substring(e.length,n.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var PS={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return lh.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:r,cookieMinutes:s,cookieDomain:n,cookieOptions:i}=e;r&&typeof document<"u"&&lh.create(r,t,s,n,i)}},MS={name:"querystring",lookup(t){let{lookupQuerystring:e}=t,r;if(typeof window<"u"){let{search:s}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));const i=s.substring(1).split("&");for(let o=0;o<i.length;o++){const l=i[o].indexOf("=");l>0&&i[o].substring(0,l)===e&&(r=i[o].substring(l+1))}}return r}},OS={name:"hash",lookup(t){let{lookupHash:e,lookupFromHashIndex:r}=t,s;if(typeof window<"u"){const{hash:n}=window.location;if(n&&n.length>2){const i=n.substring(1);if(e){const o=i.split("&");for(let l=0;l<o.length;l++){const c=o[l].indexOf("=");c>0&&o[l].substring(0,c)===e&&(s=o[l].substring(c+1))}}if(s)return s;if(!s&&r>-1){const o=n.match(/\/([a-zA-Z-]*)/g);return Array.isArray(o)?o[typeof r=="number"?r:0]?.replace("/",""):void 0}}}return s}};let As=null;const ch=()=>{if(As!==null)return As;try{if(As=typeof window<"u"&&window.localStorage!==null,!As)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{As=!1}return As};var LS={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&ch())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:r}=e;r&&ch()&&window.localStorage.setItem(r,t)}};let Rs=null;const dh=()=>{if(Rs!==null)return Rs;try{if(Rs=typeof window<"u"&&window.sessionStorage!==null,!Rs)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{Rs=!1}return Rs};var $S={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&dh())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:r}=e;r&&dh()&&window.sessionStorage.setItem(r,t)}},FS={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:r,userLanguage:s,language:n}=navigator;if(r)for(let i=0;i<r.length;i++)e.push(r[i]);s&&e.push(s),n&&e.push(n)}return e.length>0?e:void 0}},WS={name:"htmlTag",lookup(t){let{htmlTag:e}=t,r;const s=e||(typeof document<"u"?document.documentElement:null);return s&&typeof s.getAttribute=="function"&&(r=s.getAttribute("lang")),r}},VS={name:"path",lookup(t){let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?r[typeof e=="number"?e:0]?.replace("/",""):void 0}},US={name:"subdomain",lookup(t){let{lookupFromSubdomainIndex:e}=t;const r=typeof e=="number"?e+1:1,s=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(s)return s[r]}};let Cp=!1;try{document.cookie,Cp=!0}catch{}const Ep=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Cp||Ep.splice(1,1);const BS=()=>({order:Ep,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class Ip{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,r)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=IS(r,this.options||{},BS()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=n=>n.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=s,this.addDetector(PS),this.addDetector(MS),this.addDetector(LS),this.addDetector($S),this.addDetector(FS),this.addDetector(WS),this.addDetector(VS),this.addDetector(US),this.addDetector(OS)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return e.forEach(s=>{if(this.detectors[s]){let n=this.detectors[s].lookup(this.options);n&&typeof n=="string"&&(n=[n]),n&&(r=r.concat(n))}}),r=r.filter(s=>s!=null&&!AS(s)).map(s=>this.options.convertDetectedLanguage(s)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||r.forEach(s=>{this.detectors[s]&&this.detectors[s].cacheUserLanguage(e,this.options)}))}}Ip.type="languageDetector";const HS={loginTitle:"Login",loginSubtitle:"Select an account to continue",googleSignIn:"Continue with Google",guestSignIn:"Continue as Guest",or:"OR",terms:"By continuing, you agree to our Terms of Service and Privacy Policy.",brandTitle:"Manage your work",brandTitleHighlight:"efficiently.",brandSubtitle:`Manage complex schedules simply.
The best productivity tool for individuals, teams, and enterprises.`,features:{boardView:{title:"Intuitive Board View",desc:"Visualize your workflow at a glance"},sync:{title:"Real-time Sync",desc:"Seamless connection anywhere"},smartNotify:{title:"Smart Notifications",desc:"Never miss important events"}},footer:"Â© 2025 Todolist Corp. Trusted by leaders."},GS={today:"Today",week:"Weekly Calendar",month:"Monthly Calendar",board:"Kanban Board",recurring:"Recurring",history:"History",analytics:"Analytics",vacation:"Vacation",sharing:"Sharing Settings",settings:"Settings",summary:{yesterday:"Yesterday",overdue:"Overdue",tomorrow:"Tomorrow",count:"items"},notifications:"Notifications"},zS={widget:{title:"Widget Settings",transparency:"Background Transparency",transparencyDesc:"Adjust the transparency of the widget background on your home screen.",refresh:"Sync Widget",refreshDesc:"Try syncing manually if tasks do not appear."},title:"Settings",subtitle:"App settings & data management",account:{title:"Account",guest:"Guest User",guestDesc:"Using local storage",sync:"Cloud Sync",syncing:"Syncing...",logout:"Logout",confirmLogout:"Are you sure you want to logout?",loggedIn:"Logged in"},appearance:{title:"Appearance",transparency:"Background Transparency",light:"Light",dark:"Dark",system:"System",calendarLayout:"Monthly Calendar Layout",calendarLayoutSplit:"Split View (Calendar + List)",calendarLayoutFull:"Full Calendar"},seasonal:{spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},city:{cairo:"Cairo",london:"London",la:"Los Angeles",moscow:"Moscow",seoul:"Seoul",busan:"Busan",jeju:"Jeju",gyeongju:"Gyeongju",gwangju:"Gwangju",tokyo:"Tokyo",beijing:"Beijing",hongkong:"Hong Kong",bangkok:"Bangkok",hanoi:"Hanoi"},colorTheme:{title:"Accent Color",blue:"Blue",sky:"Sky",teal:"Teal",forest:"Forest",lime:"Lime",sunset:"Sunset",red:"Red",berry:"Berry",purple:"Purple",indigo:"Indigo",gray:"Gray"},tabs:{mode:"Mode",background:"Background",display:"Display",seasonal:"Seasonal",city:"City",colors:"Colors"},language:{title:"Language",desc:"Select application language",korean:"Korean",english:"English"},font:{title:"Font Size",small:"Small",large:"Large",preview:"The quick brown fox jumps over the lazy dog."},holiday:{title:"Custom Holidays",name:"Holiday Name",date:"Date",namePlaceholder:"Enter holiday name",datePlaceholder:"Select Date",addPlaceholder:"Holiday Name",recurring:"Repeat Yearly",noHolidays:"No holidays registered.",confirmDelete:"Delete this holiday?",yearly:"Yearly",everyYear:"Every Year"},data:{title:"Data Management",storage:"Storage Usage",localOnly:"Local Storage Only",backup:"Export Data",backupDesc:"Save current data to file",restore:"Restore Data",restoreDesc:"Restore from backup file",restoreSuccess:"Data restored successfully!",invalidFormat:"Invalid file format.",importError:"Failed to restore data.",confirmClear:"Delete {{count}} completed todos?",clearCompleted:"Clear Completed"},general:{startScreen:"Start Screen",lastView:"Last Used",today:"Today",week:"Weekly",month:"Monthly"},stats:{title:"Statistics",total:"Total",completed:"Done",pending:"Pending",storage:"Storage"},notification:{title:"Notifications",configure:"Configure Notifications",setup:"Setup Notifications",desc:"Deadlines, celebrations, etc."},notifications:{empty:"No new notifications",inviteTitle:"Invitation to share"},appInfo:"Designed for simplicity & productivity"},KS={title:"System Update",newFeatures:"What's New (v1.3.1)",changes:["New Sharing/Collaboration features (Create groups, Invite, Manage permissions)","Weekly Calendar Widget (Check schedule on home screen)","Notification Center (Check invites and changes)","Overall UI/UX improvements and stability fixes"],dontShowAgain:"Don't show again",close:"Close"},YS={loading:"Loading...",monthSuffix:"",error:"Error",success:"Success",confirm:"Confirm",cancel:"Cancel",save:"Save",delete:"Delete",edit:"Edit",add:"Add",close:"Close",today:"Today",addTodo:"Add Task",confirmExit:"Are you sure you want to exit?",progress:"Progress",accept:"Accept",decline:"Decline"},qS={sunday:"Sunday",monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday"},XS={title:"Appearance",theme:"Theme",calendarLayout:"Monthly Calendar Layout",calendarLayoutSplit:"Split View (Calendar + List)",calendarLayoutFull:"Full Calendar",transparency:"Transparency",transparencyDesc:"Adjust UI opacity (lower = more transparent)"},QS={yesterday:{title:"Incomplete Yesterday",empty:"No incomplete tasks from yesterday"},vacation:{title:"Today's Vacation"},inprogress:{title:"In Progress",empty:"No tasks"},completed:{title:"Completed",subtask:"Subtask",parentProject:"Parent Project",time:"Completed At"},tomorrow:{title:"Tomorrow",empty:"No tasks scheduled for tomorrow"}},JS={addTodo:{title:"New Task",taskTitle:"Title",placeholder:"Enter task name",naturalLanguageHint:"Ex: Meeting tomorrow 2pm #work !urgent",description:"Description",descPlaceholder:"Enter detailed description",type:"Type",simpleTask:"Simple Task",project:"Project",priority:"Priority",low:"Low",medium:"Medium",high:"High",urgent:"Urgent",projectCategory:"Project Category",manageTemplates:"Manage Templates",noTemplate:"No Template Selected",shortTerm:"Short-term",longTerm:"Long-term",subtasks:"Subtasks",addSubtaskPlaceholder:"Add subtask...",startDate:"Start Date",startTime:"Start Time",dueDate:"Due Date",dueTime:"Due Time",showDueDate:"Add Due Date (Optional)",hideDueDate:"Hide Due Date",tags:"Tags",addTag:"Add Tag",newTagPlaceholder:"Enter new tag",recurrence:"Recurrence",recurrenceNone:"None",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",selectDay:"Select Day",selectDate:"Select Date",selectWeek:"Select Week",recurrenceType:"Recurrence Type",byDate:"By Date (e.g. 15th)",byWeekday:"By Weekday (e.g. 1st Mon)",holidayHandling:"Holiday Handling",holidayShow:"Show as is (Default)",holidaySkip:"Skip",holidayNext:"Move to Next Day",holidayPrev:"Move to Previous Day",holidayHint:"* Set how to handle holidays for recurring tasks.",submit:"Add Task"}},ZS={manage:"Manage Templates",title:"Manage Templates",create:"Create New Template",newTemplate:"New Template",editTemplate:"Edit Template",name:"Template Name",namePlaceholder:"Ex: July Promotion Project",category:"Category",description:"Description",descPlaceholder:"Project Description",subTasks:"Subtasks",addSubTask:"Add Task",subTaskName:"Task Name",empty:"No saved templates.",emptyHint:"Save frequently used projects as templates.",use:"Use This Template",copySuffix:"(Copy)",save:"Save",saving:"Saving...",update:"Update",updating:"Updating...",deleteConfirm:"Are you sure you want to delete this template?",shortterm:"Short-term",longterm:"Long-term"},ej={week:"Week",daySuffix:"",thisMonth:"This Month",thisWeek:"This Week",prevWeek:"Previous Week",nextWeek:"Next Week",detailedInfo:"Weekly Details",today:"Today",tasksAndVacations:"Tasks & Vacations",more:" more",start:"Start",due:"Due",close:"Close",noTasks:"No tasks for this date.",completedCancel:"Undo Complete",complete:"Mark Complete",deleteConfirm:"Are you sure you want to delete this task?"},tj={placeholder:"Search tasks...",filter:"Filter",on:"ON",clear:"Clear Filters",priority:"Priority",type:"Type",projectCategory:"Project Category",tags:"Tags",completionDate:"Completion Date",noTags:"No tags available",countTags:" tags",all:"All",todayCompleted:"Completed Today",yesterdayCompleted:"Completed Yesterday",thisWeekCompleted:"Completed This Week",lastWeekCompleted:"Completed Last Week",thisMonthCompleted:"Completed This Month"},rj={title:"Project Analysis",distribution:"Project Distribution",totalProjects:"Total Projects",longTerm:"Long-term Projects",shortTerm:"Short-term Projects",singleTasks:"Single Tasks",total:"Total",project:"Project",single:"Single",longTermLabel:"Long-term",shortTermLabel:"Short-term"},sj={title:"Recurring Management",addTemplate:"Add Template",templates:"Templates",exceptions:"Exceptions",holidays:"Holidays",activeTemplates:"Active Templates",inactiveTemplates:"Inactive Templates",resume:"Resume",pause:"Pause",delete:"Delete",edit:"Edit",empty:"No recurring templates",emptyHint:"Add a new recurring template to automate your schedule.",addFirst:"Add First Template",exceptionTitle:"Exception Settings",monthlySettings:"Monthly Week Settings",firstWeek:"1st Week",secondWeek:"2nd Week",thirdWeek:"3rd Week",fourthWeek:"4th Week",lastWeek:"Last Week",weekHint:"* Last week refers to the final week of the month.",excludeSettings:"Exclude Weeks",excludeHint:"No recurring tasks will be created in checked weeks.",currentExcluded:"Currently Excluded",excludedHint:"New recurring tasks won't be created in these weeks.",exceptionDateTitle:"Date Exceptions",addExceptionDate:"Add Exception Date",exceptionDateHint:"Skip or move recurring tasks on specific dates.",holidayTitle:"Holiday Management",holidayDesc:"Holiday management features coming soon.",plannedFeatureList:{vacation:"Vacation Scheduling",autoAdjust:"Auto-adjust Recurring Tasks",notification:"Vacation Alerts",holidaySync:"Holiday Sync"},plannedFeatures:"Planned Features",totalTemplates:"Total Templates",active:"Active",todayInstances:"Today's Instances",editModalTitle:"Edit Recurring Template",updateSuccess:"Template updated successfully.",updateError:"Failed to update template.",form:{title:"Title",description:"Description",priority:"Priority",recurrenceType:"Recurrence Cycle",daily:"Daily",weekly:"Weekly",monthly:"Monthly",selectWeekday:"Select Weekday",monthlyPattern:"Monthly Pattern",byDate:"By Date (e.g., 15th)",byWeekday:"By Weekday (e.g., 1st Monday)",selectDate:"Select Date",lastDay:"Last Day",firstWorkDay:"First Workday",lastWorkDay:"Last Workday",week:"Week",weekday:"Weekday",holidayHandling:"Holiday Handling",moveBefore:"Move Before",moveAfter:"Move After",show:"Keep Date",exceptionSettings:"Exception Settings",addException:"Add Exception",byDateOption:"Exclude Date",byWeekdayOption:"Exclude Weekday",byWeekOption:"Exclude Week",byMonthOption:"Exclude Month",conflictOption:"Conflict with Other",conflictRule:"Conflict Rule",targetTemplate:"Target Template",selectTemplate:"Select Template",conflictCondition:"Conflict Condition",sameDate:"Same Date",sameWeek:"Same Week",sameMonth:"Same Month",addConflictRule:"Add Conflict Rule",save:"Save Changes",saving:"Saving..."}},nj={title:"Today's Tasks",completionRate:"Completion Rate",totalCompletion:"Total Completion",todayProgress:"Today Progress",weeklyProgress:"Weekly Progress",daily:"Today",weekly:"Weekly",overdueLabel:"Overdue",inProgress:"In Progress",scheduled:"Scheduled",overdue:"Overdue",urgent:"Urgent",high:"High",filter:"Filter"},aj={title:"Completion History",totalCount:"Total {{count}} tasks completed",period:"By Period",daily:"Daily",weekly:"Weekly",monthly:"Monthly",today:"Today",yesterday:"Yesterday",thisWeek:"This Week",lastWeek:"Last Week",thisMonth:"This Month",lastMonth:"Last Month",older:"Older Tasks",completedDay:"Days Completed",completedWeek:"Weeks Completed",completedMonth:"Months Completed",empty:"No completed tasks yet",emptyHint:"History will appear here when you complete tasks."},ij={title:"User Manual",subtitle:"Learn how to use 100% of the features in detail.",basics:{title:"1. Basics",add:"Add Task",addDesc:"Click the round '+' button at the bottom right or press 'N' on your keyboard to quickly add a new task. You can set the title, description, due date, and priority to manage your work efficiently.",complete:"Complete & Todo",completeDesc:"Click the checkbox to the left of an item to mark it as complete. If you completed it by mistake, you can undo it immediately or restore it from the 'History' tab.",edit:"Edit & Delete",editDesc:"Click on a task to open the details popup. You can edit the content or click the trash icon at the top right to delete it."},calendar:{title:"2. Schedule & Calendar",views:"Calendar Views",viewsDesc:"Switch between 'Today', 'Weekly', and 'Monthly' views via the sidebar or bottom menu. 'Weekly' is great for workflow, and 'Monthly' for overview.",nav:"Navigation",navDesc:"Use the navigation arrows (<, >) at the top to move to past or future dates. Click 'Today' to return to the current date immediately."},advanced:{title:"3. Advanced Features",recurring:"Recurring Management (Important)",recurringDesc:"**Note:** You cannot set 'recurrence' in the quick add popup. Recurring tasks (daily, weekly) must be registered and managed separately in the **'Recurring'** tab on the sidebar. More precise settings like exceptions are available there.",subtasks:"Subtasks",subtasksDesc:"Break down large projects into smaller steps. Use 'Add Subtask' in the task details view to track progress more granularly.",tags:"Tags & Filters",tagsDesc:"Use hashtags like #work or #personal when adding tasks. You can filter by specific tags or priority levels in the main search bar."},account:{title:"4. Account & Data",login:"Login Methods",loginDesc:"Login with Google to sync cloud data across multiple devices (PC, Tablet, Mobile). Guest mode saves data locally only.",security:"Security & Backup",securityDesc:"All data is securely transmitted and stored. Guest data may be lost if the app is deleted, so Google Login is recommended for data protection."},sharing:{title:"5. Sharing & Collaboration",createDetail:"Create New Group",createDetailDesc:"Create a new group in the 'Sharing Settings' menu and invite team members via email.",permissionDetail:"Permission Management",permissionDetailDesc:"Assign 'Can View', 'Can Edit', or 'Admin' permissions to team members for secure collaboration.",filterDetail:"Sharing Filters",filterDetailDesc:"Distinguish between 'My Tasks' and 'Shared Tasks' using the filters at the top of the main screen."},notifications:{title:"6. Notification Center",centerDetail:"Check Notifications",centerDetailDesc:"Click the bell icon at the top right to see new invite requests or project changes at a glance."},more:{title:"Have Questions?",contact:"If you need further assistance or have suggestions, please use 'Contact Us' in the Settings menu.",button:"Contact Us"}},oj={settingsTitle:"Sharing Settings",private:"Private",shared:"Shared",inviteUser:"Invite User",accessList:"Shared Users",noUsers:"No shared users.",inviteSent:"Invite sent!",pendingInvites:"Pending Invites",confirmRevoke:"Revoke access for this user?",shareName:"Share Name",sendInvite:"Send Invite",cannotShareSelf:"Cannot share with yourself.",alreadyAdded:"User already added.",userNotFound:"User not found.",alreadyInvited:"User already invited.",addToShared:"Add to shared list",myTask:"My Task",sharedTask:"Shared Task",selectTarget:"Select Sharing Target",selectTargetPlaceholder:"-- Select Sharing Target --",noGroups:"No sharing groups found. Please create a group in 'Sharing Settings' first.",filter:"Filter",personal:"My Tasks",myShared:"Shared by Me",groupShared:"Group Shared",filterPersonal:"Personal Tasks (Private)",filterMyShared:"Tasks Shared by Me",filterGroupShared:"Tasks Shared by Group",group:"Group",allGroups:"All",noGroupsShort:"No Groups",title:"Sharing Status",columnMember:"Member",columnPermission:"Permission",columnManage:"Manage",me:"(Me)",roleView:"Can View",roleEdit:"Can Edit",roleAdmin:"Admin",roleViewer:"Viewer",roleEditor:"Editor",removeMember:"Remove Member",waitingAccept:"Waiting for acceptance...",invited:"Invited",confirmDeleteGroup:"Are you sure you want to delete this group? All shared data will be deleted.",subtitle:"Share tasks and collaborate with your team",createNewGroup:"Create New Group",incomingInvites:"Incoming Invites",inviteMessage:"{{email}} invited you to '{{group}}'",accept:"Accept",reject:"Reject",permissionChange:"Permission Change",permissionChangeMessage:"{{email}} changed your permission in '{{group}}'",check:"OK",groupNamePlaceholder:"Group Name (e.g. Family, Marketing Team)",inviteMember:"Invite Member",searchEmailPlaceholder:"Search email address",search:"Search",add:"Add",createGroupSendInvite:"Create Group & Send Invites",cancel:"Cancel",owner:"Owner",leave:"Leave",deleteGroup:"Delete Group",referenceGroup:"Reference Group",inviteMemberPlaceholder:"Email to invite",savePermissionChanges:"Save Permission Changes",noGroupsDesc:"Create a new group to share tasks with your team!"},lj={auth:HS,nav:GS,settings:zS,updateNotification:KS,common:YS,days:qS,appearance:XS,todo:QS,modal:JS,projectTemplate:ZS,calendar:ej,search:tj,analysis:rj,recurring:sj,detailedStats:nj,history:aj,guide:ij,sharing:oj},cj={loginTitle:"ë¡œê·¸ì¸",loginSubtitle:"ê³„ì •ì„ ì„ íƒí•˜ì—¬ ê³„ì†í•˜ì„¸ìš”",googleSignIn:"Google ê³„ì •ìœ¼ë¡œ ê³„ì†í•˜ê¸°",guestSignIn:"ê²ŒìŠ¤íŠ¸ë¡œ ì²´í—˜í•˜ê¸°",or:"ë˜ëŠ”",terms:"ê³„ì† ì§„í–‰ì‹œ ì´ìš©ì•½ê´€ ë° ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤.",brandTitle:"Manage your work",brandTitleHighlight:"efficiently.",brandSubtitle:`ë³µì¡í•œ ì¼ì •ì„ ì‹¬í”Œí•˜ê²Œ ê´€ë¦¬í•˜ì„¸ìš”.
ê°œì¸, íŒ€, ê¸°ì—… ëª¨ë‘ë¥¼ ìœ„í•œ ìµœê³ ì˜ ìƒì‚°ì„± ë„êµ¬.`,features:{boardView:{title:"ì§ê´€ì ì¸ ë³´ë“œ ë·°",desc:"í•œëˆˆì— íŒŒì•…í•˜ëŠ” ì—…ë¬´ íë¦„"},sync:{title:"ì‹¤ì‹œê°„ ë™ê¸°í™”",desc:"ì–¸ì œ ì–´ë””ì„œë‚˜ ëŠê¹€ ì—†ëŠ” ì—°ê²°"},smartNotify:{title:"ìŠ¤ë§ˆíŠ¸í•œ ì•Œë¦¼",desc:"ë†“ì¹˜ì§€ ì•ŠëŠ” ì¤‘ìš”í•œ ì¼ì •"}},footer:"Â© 2025 Todolist Corp. Trusted by leaders."},dj={today:"ì˜¤ëŠ˜ í• ì¼",week:"ì£¼ê°„ ìº˜ë¦°ë”",month:"ì›”ê°„ ìº˜ë¦°ë”",board:"ì¹¸ë°˜ ë³´ë“œ",recurring:"ë°˜ë³µ ê´€ë¦¬",history:"ì™„ë£Œ ê¸°ë¡",analytics:"í†µê³„/ë¶„ì„",vacation:"íœ´ê°€ ê´€ë¦¬",sharing:"ê³µìœ  ì„¤ì •",settings:"ì„¤ì •",summary:{yesterday:"ì–´ì œ ë¯¸ì™„ë£Œ",overdue:"ì§€ì—°ëœ í• ì¼",tomorrow:"ë‚´ì¼ ì˜ˆì •",count:"ê°œ"},notifications:"ì•Œë¦¼"},uj={widget:{title:"ìœ„ì ¯ ì„¤ì •",transparency:"ë°°ê²½ íˆ¬ëª…ë„",transparencyDesc:"í™ˆ í™”ë©´ ìœ„ì ¯ì˜ ë°°ê²½ íˆ¬ëª…ë„ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤.",refresh:"ìœ„ì ¯ ë™ê¸°í™”",refreshDesc:"ìœ„ì ¯ì— í• ì¼ì´ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ë©´ ìˆ˜ë™ìœ¼ë¡œ ë™ê¸°í™”í•´ë³´ì„¸ìš”."},title:"ì„¤ì •",subtitle:"ì•± ì„¤ì • ë° ë°ì´í„° ê´€ë¦¬",account:{title:"ê³„ì •",guest:"ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì",guestDesc:"ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš© ì¤‘",sync:"í´ë¼ìš°ë“œ ë™ê¸°í™”",syncing:"ë™ê¸°í™” ì¤‘...",logout:"ë¡œê·¸ì•„ì›ƒ",confirmLogout:"ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",loggedIn:"ë¡œê·¸ì¸ë¨"},appearance:{title:"í™”ë©´ ì„¤ì •",theme:"í…Œë§ˆ",calendarLayout:"ì›”ê°„ ìº˜ë¦°ë” ë ˆì´ì•„ì›ƒ",calendarLayoutSplit:"ë¶„í•  í™”ë©´ (ìº˜ë¦°ë” + ë¦¬ìŠ¤íŠ¸)",calendarLayoutFull:"ì „ì²´ í™”ë©´ (ìº˜ë¦°ë”ë§Œ)",transparency:"íˆ¬ëª…ë„ ì¡°ì ˆ",transparencyDesc:"UIì˜ íˆ¬ëª…ë„ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤ (ë‚®ì„ìˆ˜ë¡ íˆ¬ëª…í•´ì§‘ë‹ˆë‹¤)",light:"ë¼ì´íŠ¸ ëª¨ë“œ",dark:"ë‹¤í¬ ëª¨ë“œ",system:"ì‹œìŠ¤í…œ ì„¤ì •"},seasonal:{spring:"ë´„",summer:"ì—¬ë¦„",autumn:"ê°€ì„",winter:"ê²¨ìš¸"},city:{cairo:"ì¹´ì´ë¡œ",london:"ëŸ°ë˜",la:"ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤",moscow:"ëª¨ìŠ¤í¬ë°”",seoul:"ì„œìš¸",busan:"ë¶€ì‚°",jeju:"ì œì£¼",gyeongju:"ê²½ì£¼",gwangju:"ê´‘ì£¼",tokyo:"ë„ì¿„",beijing:"ë² ì´ì§•",hongkong:"í™ì½©",bangkok:"ë°©ì½•",hanoi:"í•˜ë…¸ì´"},colorTheme:{title:"ê°•ì¡° ìƒ‰ìƒ",blue:"ë¸”ë£¨",sky:"ìŠ¤ì¹´ì´",teal:"í‹¸",forest:"í¬ë ˆìŠ¤íŠ¸",lime:"ë¼ì„",sunset:"ì„ ì…‹",red:"ë ˆë“œ",berry:"ë² ë¦¬",purple:"í¼í”Œ",indigo:"ì¸ë””ê³ ",gray:"ê·¸ë ˆì´"},tabs:{mode:"í™”ë©´ ëª¨ë“œ",background:"ë°°ê²½",display:"í™”ë©´",seasonal:"ê³„ì ˆ",city:"ë„ì‹œ",colors:"ìƒ‰ìƒ"},language:{title:"ì–¸ì–´",desc:"ì• í”Œë¦¬ì¼€ì´ì…˜ ì–¸ì–´ ì„ íƒ",korean:"í•œêµ­ì–´",english:"English"},font:{title:"ê¸€ì í¬ê¸°",small:"ì‘ê²Œ",large:"í¬ê²Œ",preview:"ë‹¤ëŒì¥ í—Œ ì³‡ë°”í€´ì— íƒ€ê³ íŒŒ. The quick brown fox jumps over the lazy dog."},holiday:{title:"ê³µíœ´ì¼ ì„¤ì •",name:"ê³µíœ´ì¼ ì´ë¦„",date:"ë‚ ì§œ",namePlaceholder:"ê³µíœ´ì¼ ì´ë¦„ ì…ë ¥",datePlaceholder:"ë‚ ì§œ ì„ íƒ",addPlaceholder:"ê³µíœ´ì¼ ì´ë¦„",recurring:"ë§¤ë…„ ë°˜ë³µ",noHolidays:"ë“±ë¡ëœ ê³µíœ´ì¼ì´ ì—†ìŠµë‹ˆë‹¤.",confirmDelete:"ì´ ê³µíœ´ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",yearly:"ë§¤ë…„",everyYear:"ë§¤ë…„"},data:{title:"ë°ì´í„° í†µê³„",storage:"ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš© ì¤‘",localOnly:"ì„œë²„ì— ì €ì¥ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ì…ë‹ˆë‹¤",backup:"ë°ì´í„° ë°±ì—…",backupDesc:"í˜„ì¬ ë°ì´í„°ë¥¼ íŒŒì¼ë¡œ ì €ì¥",restore:"ë°ì´í„° ë³µì›",restoreDesc:"ë°±ì—… íŒŒì¼ì—ì„œ ë³µì›",restoreSuccess:"ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!",invalidFormat:"ì˜¬ë°”ë¥´ì§€ ì•Šì€ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.",importError:"ë°ì´í„° ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",confirmClear:"ì™„ë£Œëœ í•­ëª© {{count}}ê°œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",clearCompleted:"ì™„ë£Œëœ í•­ëª© ì‚­ì œ",noCompleted:"ì‚­ì œí•  ì™„ë£Œëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."},general:{startScreen:"ì‹œì‘ í™”ë©´ ì„¤ì •",lastView:"ë§ˆì§€ë§‰ ì¢…ë£Œ í™”ë©´",today:"ì˜¤ëŠ˜ í•  ì¼",week:"ì£¼ê°„ ë‹¬ë ¥",month:"ì›”ê°„ ë‹¬ë ¥"},stats:{title:"ë°ì´í„° í†µê³„",total:"ì´ í• ì¼",completed:"ì™„ë£Œ",pending:"ì§„í–‰ì¤‘",storage:"ì €ì¥ê³µê°„"},notification:{title:"ì•Œë¦¼",configure:"ì•Œë¦¼ ì„¤ì •",setup:"ì•Œë¦¼ ì„¤ì •",desc:"ë§ˆê° ì•Œë¦¼, ì™„ë£Œ ì¶•í•˜ ë“± ì„¤ì •"},notifications:{empty:"ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.",inviteTitle:"ê³µìœ  ì´ˆëŒ€"},appInfo:"Designed for simplicity & productivity"},hj={title:"ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ì•ˆë‚´",newFeatures:"ìƒˆë¡œìš´ ê¸°ëŠ¥ (v1.3.1)",changes:["ìƒˆë¡œìš´ ê³µìœ /í˜‘ì—… ê¸°ëŠ¥ ì¶”ê°€ (ê·¸ë£¹ ìƒì„±, ì´ˆëŒ€, ê¶Œí•œ ê´€ë¦¬)","ì£¼ê°„ ìº˜ë¦°ë” ìœ„ì ¯ ì¶”ê°€ (í™ˆ í™”ë©´ì—ì„œ ì¼ì • í™•ì¸)","ì•Œë¦¼ ì„¼í„° ì¶”ê°€ (ê³µìœ  ì´ˆëŒ€, ë³€ë™ ì‚¬í•­ í™•ì¸)","ì „ì²´ì ì¸ UI/UX ê°œì„  ë° ì•ˆì •ì„± í–¥ìƒ"],dontShowAgain:"ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°",close:"ë‹«ê¸°"},gj={loading:"ë¡œë”© ì¤‘...",monthSuffix:"ì›”",error:"ì˜¤ë¥˜",success:"ì„±ê³µ",confirm:"í™•ì¸",cancel:"ì·¨ì†Œ",save:"ì €ì¥",delete:"ì‚­ì œ",edit:"ìˆ˜ì •",add:"ì¶”ê°€",close:"ë‹«ê¸°",today:"ì˜¤ëŠ˜",addTodo:"í• ì¼ ì¶”ê°€",confirmExit:"ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",progress:"ì§„í–‰ë¥ ",accept:"ìˆ˜ë½",decline:"ê±°ì ˆ"},mj={title:"ê³µìœ  ìƒíƒœ",settingsTitle:"ê³µìœ  ì„¤ì •",private:"ê°œì¸ (ë¹„ê³µê°œ)",shared:"ê³µìœ ë¨",inviteUser:"ì‚¬ìš©ì ì´ˆëŒ€",accessList:"ê³µìœ ëœ ì‚¬ìš©ì",noUsers:"ê³µìœ ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.",inviteSent:"ì´ˆëŒ€ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!",pendingInvites:"ëŒ€ê¸° ì¤‘ì¸ ì´ˆëŒ€",confirmRevoke:"ì´ ì‚¬ìš©ìì˜ ì ‘ê·¼ ê¶Œí•œì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",shareName:"ê³µìœ  ì´ë¦„",sendInvite:"ì´ˆëŒ€ ë³´ë‚´ê¸°",cannotShareSelf:"ìì‹ ì—ê²ŒëŠ” ê³µìœ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",alreadyAdded:"ì´ë¯¸ ì¶”ê°€ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.",userNotFound:"ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",alreadyInvited:"ì´ë¯¸ ì´ˆëŒ€ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.",addToShared:"ê³µìœ  ëª©ë¡ì— ì¶”ê°€",myTask:"ë‚´ í•  ì¼",sharedTask:"ê³µìœ  í•  ì¼",selectTarget:"ê³µìœ  ëŒ€ìƒ ì„ íƒ",selectTargetPlaceholder:"-- ê³µìœ  ëŒ€ìƒ ì„ íƒ --",noGroups:"ê³µìœ  ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì´ë“œë°” 'ê³µìœ  ì„¤ì •'ì—ì„œ ë¨¼ì € ê·¸ë£¹ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.",groupShared:"ê·¸ë£¹ ê³µìœ ",group:"ê·¸ë£¹",allGroups:"ì „ì²´",filter:"í•„í„°",personal:"ë‚´ í• ì¼",myShared:"ë‚´ê°€ ê³µìœ ",filterPersonal:"ê°œì¸ í• ì¼",filterMyShared:"ë‚´ê°€ ê³µìœ í•œ í• ì¼",filterGroupShared:"ê·¸ë£¹ì´ ê³µìœ í•œ í• ì¼",noGroupsShort:"ê·¸ë£¹ ì—†ìŒ",columnMember:"ë©¤ë²„",columnPermission:"ê¶Œí•œ",columnManage:"ê´€ë¦¬",me:"(ë‚˜)",roleView:"ë³´ê¸° ê°€ëŠ¥",roleEdit:"í¸ì§‘ ê°€ëŠ¥",roleAdmin:"ê´€ë¦¬ì",roleViewer:"ë·°ì–´",roleEditor:"í¸ì§‘ì",removeMember:"ë©¤ë²„ ë‚´ë³´ë‚´ê¸°",waitingAccept:"ìˆ˜ë½ ëŒ€ê¸° ì¤‘...",invited:"ì´ˆëŒ€ë¨",confirmDeleteGroup:"ê·¸ë£¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ê³µìœ  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.",subtitle:"íŒ€ì›ë“¤ê³¼ í• ì¼ì„ ê³µìœ í•˜ê³  í˜‘ì—…í•˜ì„¸ìš”",createNewGroup:"ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°",incomingInvites:"ë°›ì€ ì´ˆëŒ€ ìš”ì²­",inviteMessage:"{{email}}ë‹˜ì´ '{{group}}' ê·¸ë£¹ì— ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤",accept:"ìˆ˜ë½",reject:"ê±°ì ˆ",permissionChange:"ê¶Œí•œ ë³€ê²½ ì•Œë¦¼",permissionChangeMessage:"{{email}}ë‹˜ì´ '{{group}}' ê·¸ë£¹ì—ì„œ ê¶Œí•œì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤",check:"í™•ì¸",groupNamePlaceholder:"ê·¸ë£¹ ì´ë¦„ (ì˜ˆ: ê°€ì¡±, ë§ˆì¼€íŒ…íŒ€)",inviteMember:"ë©¤ë²„ ì´ˆëŒ€",searchEmailPlaceholder:"ì´ë©”ì¼ ì£¼ì†Œ ê²€ìƒ‰",search:"ê²€ìƒ‰",add:"ì¶”ê°€",createGroupSendInvite:"ê·¸ë£¹ ìƒì„± ë° ì´ˆëŒ€ ë°œì†¡",cancel:"ì·¨ì†Œ",owner:"ì†Œìœ ì",leave:"ë‚˜ê°€ê¸°",deleteGroup:"ê·¸ë£¹ ì‚­ì œ",referenceGroup:"ì°¸ì¡° ê·¸ë£¹",inviteMemberPlaceholder:"ì´ˆëŒ€í•  íŒ€ì›ì˜ ì´ë©”ì¼",savePermissionChanges:"ê¶Œí•œ ë³€ê²½ ì €ì¥",noGroupsDesc:"ìƒˆ ê·¸ë£¹ì„ ë§Œë“¤ì–´ íŒ€ì›ë“¤ê³¼ í• ì¼ì„ ê³µìœ í•´ë³´ì„¸ìš”!"},fj={sunday:"ì¼ìš”ì¼",monday:"ì›”ìš”ì¼",tuesday:"í™”ìš”ì¼",wednesday:"ìˆ˜ìš”ì¼",thursday:"ëª©ìš”ì¼",friday:"ê¸ˆìš”ì¼",saturday:"í† ìš”ì¼"},pj={yesterday:{title:"ì–´ì œ ëª»í•œ ì¼",empty:"ì–´ì œ ë¯¸ì™„ë£Œëœ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤"},vacation:{title:"ì˜¤ëŠ˜ì˜ íœ´ê°€"},inprogress:{title:"ì§„í–‰ ì¤‘ì¸ í• ì¼",empty:"í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤"},completed:{title:"ì™„ë£Œëœ í• ì¼",subtask:"í•˜ìœ„ì‘ì—…",parentProject:"ìƒìœ„ í”„ë¡œì íŠ¸",time:"ì™„ë£Œì‹œê°„"},tomorrow:{title:"ë‚´ì¼ í• ì¼",empty:"ë‚´ì¼ ì˜ˆì •ëœ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤"}},yj={addTodo:{title:"ìƒˆë¡œìš´ í• ì¼",taskTitle:"ì œëª©",placeholder:"í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”",naturalLanguageHint:"ì˜ˆ: ë‚´ì¼ ì˜¤í›„ 2ì‹œ íšŒì˜ !ê¸´ê¸‰ #ì—…ë¬´",description:"ì„¤ëª…",descPlaceholder:"í• ì¼ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”",type:"ìœ í˜•",simpleTask:"ë‹¨ì¼ íƒœìŠ¤í¬",project:"í”„ë¡œì íŠ¸",priority:"ìš°ì„ ìˆœìœ„",low:"ë‚®ìŒ",medium:"ë³´í†µ",high:"ë†’ìŒ",urgent:"ê¸´ê¸‰",projectCategory:"í”„ë¡œì íŠ¸ êµ¬ë¶„",manageTemplates:"í…œí”Œë¦¿ ê´€ë¦¬",noTemplate:"í…œí”Œë¦¿ ì„ íƒ ì•ˆí•¨",shortTerm:"ìˆí…€",longTerm:"ë¡±í…€",subtasks:"í•˜ìœ„ ì‘ì—…",addSubtaskPlaceholder:"í•˜ìœ„ ì‘ì—… ì¶”ê°€...",startDate:"ì‹œì‘ ë‚ ì§œ",startTime:"ì‹œì‘ ì‹œê°„",dueDate:"ë§ˆê° ë‚ ì§œ",dueTime:"ë§ˆê° ì‹œê°„",showDueDate:"ë§ˆê°ì¼ ì„¤ì • ì¶”ê°€ (ì„ íƒ)",hideDueDate:"ë§ˆê°ì¼ ì„¤ì • ìˆ¨ê¸°ê¸°",tags:"íƒœê·¸",addTag:"íƒœê·¸ ì¶”ê°€",newTagPlaceholder:"ìƒˆ íƒœê·¸ ì…ë ¥",recurrence:"ë°˜ë³µ ì„¤ì •",recurrenceNone:"ë°˜ë³µ ì•ˆí•¨",daily:"ë§¤ì¼",weekly:"ë§¤ì£¼",monthly:"ë§¤ë‹¬",yearly:"ë§¤ë…„",selectDay:"ìš”ì¼ ì„ íƒ",selectDate:"ë‚ ì§œ ì„ íƒ",selectWeek:"ì£¼ì°¨ ì„ íƒ",recurrenceType:"ë°˜ë³µ ë°©ì‹",byDate:"ë‚ ì§œ ê¸°ì¤€ (ì˜ˆ: ë§¤ì›” 15ì¼)",byWeekday:"ìš”ì¼ ê¸°ì¤€ (ì˜ˆ: ë§¤ì›” ì²«ì§¸ì£¼ ì›”ìš”ì¼)",holidayHandling:"ê³µíœ´ì¼ ì²˜ë¦¬",holidayShow:"ê·¸ëŒ€ë¡œ í‘œì‹œ (ê¸°ë³¸)",holidaySkip:"ê±´ë„ˆë›°ê¸°",holidayNext:"ë‹¤ìŒ ë‚ ë¡œ ë¯¸ë£¨ê¸°",holidayPrev:"ì´ì „ ë‚ ë¡œ ë‹¹ê¸°ê¸°",holidayHint:"* ë°˜ë³µ ì˜ˆì •ì¼ì´ ê³µíœ´ì¼ì¸ ê²½ìš° ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ì„¤ì •í•©ë‹ˆë‹¤.",submit:"ì¶”ê°€í•˜ê¸°"}},xj={manage:"í…œí”Œë¦¿ ê´€ë¦¬",title:"í”„ë¡œì íŠ¸ í…œí”Œë¦¿ ê´€ë¦¬",create:"ìƒˆ í…œí”Œë¦¿ ë§Œë“¤ê¸°",newTemplate:"ìƒˆ í…œí”Œë¦¿",editTemplate:"í…œí”Œë¦¿ ìˆ˜ì •",name:"í…œí”Œë¦¿ ì´ë¦„",namePlaceholder:"ì˜ˆ: 7ì›” ì§„í¥ì› êµìœ¡ í”„ë¡œì íŠ¸",category:"ì¹´í…Œê³ ë¦¬",description:"ì„¤ëª…",descPlaceholder:"í”„ë¡œì íŠ¸ ì„¤ëª…",subTasks:"í•˜ìœ„ ì‘ì—…",addSubTask:"ì‘ì—… ì¶”ê°€",subTaskName:"ì‘ì—…ëª…",empty:"ì €ì¥ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.",emptyHint:"ìì£¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í•´ë³´ì„¸ìš”.",use:"ì´ í…œí”Œë¦¿ ì‚¬ìš©",copySuffix:"(ë³µì‚¬ë³¸)",save:"ì €ì¥",saving:"ì €ì¥ ì¤‘...",update:"ìˆ˜ì • ì™„ë£Œ",updating:"ìˆ˜ì • ì¤‘...",deleteConfirm:"ì´ í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",shortterm:"ìˆí…€",longterm:"ë¡±í…€"},bj={week:"ì§¸ì£¼",daySuffix:"ì¼",thisMonth:"ì´ë²ˆ ë‹¬",thisWeek:"ì´ë²ˆ ì£¼",prevWeek:"ì´ì „ ì£¼",nextWeek:"ë‹¤ìŒ ì£¼",detailedInfo:"ì´ë²ˆ ì£¼ ìƒì„¸ ì •ë³´",today:"ì˜¤ëŠ˜",tasksAndVacations:"í• ì¼ ë° íœ´ê°€",more:"ê°œ ë”",start:"ì‹œì‘",due:"ë§ˆê°",close:"ë‹«ê¸°",noTasks:"ì„ íƒí•œ ë‚ ì§œì— í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤.",completedCancel:"ì™„ë£Œ ì·¨ì†Œ",complete:"ì™„ë£Œ ì²˜ë¦¬",deleteConfirm:"í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"},vj={placeholder:"í• ì¼ ê²€ìƒ‰...",filter:"í•„í„°",on:"ON",clear:"í•„í„° ì´ˆê¸°í™”",priority:"ìš°ì„ ìˆœìœ„",type:"íƒ€ì…",projectCategory:"í”„ë¡œì íŠ¸ êµ¬ë¶„",tags:"íƒœê·¸",completionDate:"ì™„ë£Œì¼",noTags:"íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤",countTags:"ê°œ íƒœê·¸",all:"ì „ì²´",todayCompleted:"ì˜¤ëŠ˜ ì™„ë£Œ",yesterdayCompleted:"ì–´ì œ ì™„ë£Œ",thisWeekCompleted:"ì´ë²ˆ ì£¼ ì™„ë£Œ",lastWeekCompleted:"ì§€ë‚œ ì£¼ ì™„ë£Œ",thisMonthCompleted:"ì´ë²ˆ ë‹¬ ì™„ë£Œ"},wj={title:"í”„ë¡œì íŠ¸ ë¶„ì„",distribution:"ì „ì²´ í”„ë¡œì íŠ¸ ë¶„í¬",totalProjects:"ì´ í”„ë¡œì íŠ¸",longTerm:"ë¡±í…€ í”„ë¡œì íŠ¸",shortTerm:"ìˆí…€ í”„ë¡œì íŠ¸",singleTasks:"ë‹¨ì¼ íƒœìŠ¤í¬",total:"Total",project:"í”„ë¡œì íŠ¸",single:"ë‹¨ì¼",longTermLabel:"ë¡±í…€",shortTermLabel:"ìˆí…€"},kj={title:"ë°˜ë³µ ê´€ë¦¬",addTemplate:"ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€",templates:"ë°˜ë³µ í…œí”Œë¦¿",exceptions:"ì˜ˆì™¸ ì²˜ë¦¬",holidays:"íœ´ê°€ ê´€ë¦¬",activeTemplates:"í™œì„± ë°˜ë³µ í• ì¼",inactiveTemplates:"ì¼ì‹œì •ì§€ëœ ë°˜ë³µ í• ì¼",resume:"ì¬ê°œ",pause:"ì¼ì‹œì •ì§€",delete:"ì‚­ì œ",edit:"ìˆ˜ì •",empty:"ë°˜ë³µ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤",emptyHint:"ìƒˆë¡œìš´ ë°˜ë³µ í• ì¼ í…œí”Œë¦¿ì„ ì¶”ê°€í•˜ì—¬ ì¼ì •ì„ ìë™í™”í•˜ì„¸ìš”.",addFirst:"ì²« ë²ˆì§¸ í…œí”Œë¦¿ ì¶”ê°€",exceptionTitle:"ë°˜ë³µ í• ì¼ ì˜ˆì™¸ ì²˜ë¦¬ ì„¤ì •",monthlySettings:"ì›”ë³„ ì£¼ ì„¤ì •",firstWeek:"ì²«ì§¸ì£¼",secondWeek:"ë‘˜ì§¸ì£¼",thirdWeek:"ì…‹ì§¸ì£¼",fourthWeek:"ë„·ì§¸ì£¼",lastWeek:"ë§ˆì§€ë§‰ì£¼",weekHint:"* ë§ˆì§€ë§‰ì£¼ëŠ” í•´ë‹¹ ë‹¬ì˜ ë§ˆì§€ë§‰ ì£¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. (4ì£¼ê°€ ìˆëŠ” ë‹¬ì€ 4ì£¼ì°¨, 5ì£¼ê°€ ìˆëŠ” ë‹¬ì€ 5ì£¼ì°¨)",excludeSettings:"íŠ¹ì • ì£¼ ì œì™¸ ì„¤ì •",excludeHint:"ì²´í¬ëœ ì£¼ì—ëŠ” ë°˜ë³µ í• ì¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",currentExcluded:"í˜„ì¬ ì œì™¸ëœ ì£¼",excludedHint:"ì´ ì£¼ë“¤ì—ëŠ” ìƒˆë¡œìš´ ë°˜ë³µ í• ì¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",exceptionDateTitle:"íŠ¹ì • ë‚ ì§œ ì˜ˆì™¸ ê´€ë¦¬",addExceptionDate:"ì˜ˆì™¸ ë‚ ì§œ ì¶”ê°€",exceptionDateHint:"íŠ¹ì • ë‚ ì§œì— ë°˜ë³µ í• ì¼ì„ ê±´ë„ˆë›°ê±°ë‚˜ ë‹¤ë¥¸ ë‚ ì§œë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",holidayTitle:"íœ´ê°€ ê´€ë¦¬ ê¸°ëŠ¥",holidayDesc:"íœ´ê°€ ì¼ì • ê´€ë¦¬ ê¸°ëŠ¥ì´ ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.",plannedFeatureList:{vacation:"íœ´ê°€ ì¼ì • ë“±ë¡",autoAdjust:"ë°˜ë³µ í• ì¼ ìë™ ì¡°ì •",notification:"íœ´ê°€ ê¸°ê°„ ì•Œë¦¼",holidaySync:"ê³µíœ´ì¼ ì—°ë™"},plannedFeatures:"ê³„íšëœ ê¸°ëŠ¥",totalTemplates:"ì´ í…œí”Œë¦¿",active:"í™œì„±",todayInstances:"ì˜¤ëŠ˜ ì¸ìŠ¤í„´ìŠ¤",editModalTitle:"ë°˜ë³µ í…œí”Œë¦¿ ìˆ˜ì •",updateSuccess:"í…œí”Œë¦¿ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",updateError:"í…œí”Œë¦¿ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",form:{title:"ì œëª©",description:"ì„¤ëª…",priority:"ìš°ì„ ìˆœìœ„",recurrenceType:"ë°˜ë³µ ì£¼ê¸°",daily:"ë§¤ì¼",weekly:"ë§¤ì£¼",monthly:"ë§¤ì›”",selectWeekday:"ìš”ì¼ ì„ íƒ",monthlyPattern:"ì›”ê°„ íŒ¨í„´",byDate:"ë‚ ì§œ ê¸°ì¤€ (ì˜ˆ: 15ì¼)",byWeekday:"ìš”ì¼ ê¸°ì¤€ (ì˜ˆ: ì²«ì§¸ì£¼ ì›”ìš”ì¼)",selectDate:"ë‚ ì§œ ì„ íƒ",lastDay:"ë§ì¼",firstWorkDay:"ì²« ë²ˆì§¸ ê·¼ë¬´ì¼",lastWorkDay:"ë§ˆì§€ë§‰ ê·¼ë¬´ì¼",week:"ì£¼ì°¨",weekday:"ìš”ì¼",holidayHandling:"ê³µíœ´ì¼ ì²˜ë¦¬",moveBefore:"ì´ì „ìœ¼ë¡œ ì´ë™",moveAfter:"ì´í›„ë¡œ ì´ë™",show:"ê·¸ëŒ€ë¡œ í‘œì‹œ",exceptionSettings:"ì˜ˆì™¸ ì„¤ì • (ì œì™¸í•  ì¡°ê±´)",addException:"ì˜ˆì™¸ ì¶”ê°€",byDateOption:"íŠ¹ì • ë‚ ì§œ ì œì™¸",byWeekdayOption:"íŠ¹ì • ìš”ì¼ ì œì™¸",byWeekOption:"íŠ¹ì • ì£¼ì°¨ ì œì™¸",byMonthOption:"íŠ¹ì • ë‹¬ ì œì™¸",conflictOption:"ë‹¤ë¥¸ í…œí”Œë¦¿ê³¼ ì¤‘ë³µ",conflictRule:"ì¤‘ë³µ ì˜ˆì™¸ ê·œì¹™",targetTemplate:"ëŒ€ìƒ í…œí”Œë¦¿",selectTemplate:"í…œí”Œë¦¿ ì„ íƒ",conflictCondition:"ì¤‘ë³µ ì¡°ê±´",sameDate:"ê°™ì€ ë‚ ì§œ ì¤‘ë³µ",sameWeek:"ê°™ì€ ì£¼ ì¤‘ë³µ",sameMonth:"ê°™ì€ ë‹¬ ì¤‘ë³µ",addConflictRule:"ì¤‘ë³µ ê·œì¹™ ì¶”ê°€",save:"ì €ì¥í•˜ê¸°",saving:"ì €ì¥ ì¤‘..."}},Tj={title:"ì˜¤ëŠ˜ í• ì¼",completionRate:"ì™„ë£Œìœ¨",totalCompletion:"ì „ì²´ ì™„ë£Œìœ¨",todayProgress:"ì˜¤ëŠ˜ ì§„í–‰ë¥ ",weeklyProgress:"ì£¼ê°„ ë‹¬ì„±",daily:"ì˜¤ëŠ˜",weekly:"ì£¼ê°„",overdueLabel:"ì§€ì—°",inProgress:"ì§„í–‰",scheduled:"ì˜ˆì •",overdue:"ì§€ì—°",urgent:"ê¸´ê¸‰",high:"ë†’ìŒ",filter:"í•„í„°"},Nj={title:"ì™„ë£Œ íˆìŠ¤í† ë¦¬",totalCount:"ì´ {{count}}ê°œì˜ í• ì¼ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤",period:"ê¸°ê°„ë³„",daily:"ì¼ë³„",weekly:"ì£¼ë³„",monthly:"ì›”ë³„",today:"ì˜¤ëŠ˜",yesterday:"ì–´ì œ",thisWeek:"ì´ë²ˆ ì£¼",lastWeek:"ì €ë²ˆ ì£¼",thisMonth:"ì´ë²ˆ ë‹¬",lastMonth:"ì €ë²ˆ ë‹¬",older:"ë” ì´ì „ì— ì™„ë£Œí•œ í• ì¼",completedDay:"ì™„ë£Œí•œ ë‚ ",completedWeek:"ì™„ë£Œí•œ ì£¼",completedMonth:"ì™„ë£Œí•œ ì›”",empty:"ì•„ì§ ì™„ë£Œí•œ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤",emptyHint:"í• ì¼ì„ ì™„ë£Œí•˜ë©´ ì—¬ê¸°ì— íˆìŠ¤í† ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤."},Sj={title:"ì‚¬ìš© ì„¤ëª…ì„œ",subtitle:"TodoList ì•±ì„ 100% í™œìš©í•˜ëŠ” ë°©ë²•ì„ ìƒì„¸í•˜ê²Œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.",basics:{title:"1. ê¸°ë³¸ ì‚¬ìš©ë²•",add:"í•  ì¼ ì¶”ê°€í•˜ê¸°",addDesc:"í™”ë©´ ìš°ì¸¡ í•˜ë‹¨ì˜ ì›í˜• '+' ë²„íŠ¼(í”Œë¡œíŒ… ë²„íŠ¼)ì„ ëˆ„ë¥´ê±°ë‚˜, í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ 'N'ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ í•  ì¼ì„ ë¹ ë¥´ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•  ì¼ì˜ ì œëª©, ì„¤ëª…, ë§ˆê°ì¼, ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.",complete:"ì™„ë£Œ ì²˜ë¦¬ ë° ì·¨ì†Œ",completeDesc:"í•  ì¼ ëª©ë¡ì—ì„œ í•­ëª© ì™¼ìª½ì˜ ì²´í¬ë°•ìŠ¤ë¥¼ í´ë¦­í•˜ë©´ ì™„ë£Œ ì²˜ë¦¬ë©ë‹ˆë‹¤. ì‹¤ìˆ˜ë¡œ ì™„ë£Œí•œ ê²½ìš°, í•˜ë‹¨ì˜ 'ì™„ë£Œ ì·¨ì†Œ' ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ 'ì™„ë£Œ ê¸°ë¡' íƒ­ì—ì„œ ë‹¤ì‹œ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",edit:"ìˆ˜ì • ë° ì‚­ì œ",editDesc:"ëª©ë¡ì—ì„œ í•  ì¼ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ìˆ˜ì • íŒì—…ì´ ì—´ë¦½ë‹ˆë‹¤. ë‚´ìš©ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ìš°ì¸¡ ìƒë‹¨ì˜ íœ´ì§€í†µ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."},calendar:{title:"2. ìº˜ë¦°ë” ë° ì¼ì • ê´€ë¦¬",views:"ë‹¤ì–‘í•œ ìº˜ë¦°ë” ë·°",viewsDesc:"ì‚¬ì´ë“œë°” ë˜ëŠ” í•˜ë‹¨ ë©”ë‰´ë¥¼ í†µí•´ 'ì˜¤ëŠ˜', 'ì£¼ê°„', 'ì›”ê°„' ë·°ë¥¼ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 'ì£¼ê°„' ë·°ì—ì„œëŠ” ì£¼ ë‹¨ìœ„ì˜ ì—…ë¬´ íë¦„ì„, 'ì›”ê°„' ë·°ì—ì„œëŠ” ì „ì²´ì ì¸ ì¼ì •ì„ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.",nav:"ë‚ ì§œ íƒìƒ‰",navDesc:"ìƒë‹¨ì˜ ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ í™”ì‚´í‘œ(<, >)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³¼ê±° ë˜ëŠ” ë¯¸ë˜ì˜ ë‚ ì§œë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 'ì˜¤ëŠ˜' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¦‰ì‹œ í˜„ì¬ ë‚ ì§œë¡œ ëŒì•„ì˜µë‹ˆë‹¤."},advanced:{title:"3. ê³ ê¸‰ ê¸°ëŠ¥ í™œìš©",recurring:"ë°˜ë³µ í•  ì¼ ê´€ë¦¬ (ì¤‘ìš”)",recurringDesc:"**ì£¼ì˜:** ìƒˆë¡œìš´ í•  ì¼ ì¶”ê°€ íŒì—…ì—ì„œëŠ” 'ë°˜ë³µ'ì„ ì„¤ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§¤ì¼ ë˜ëŠ” ë§¤ì£¼ ë°˜ë³µë˜ëŠ” ì¼ì •ì€ ì‚¬ì´ë“œë°”ì˜ **'ë°˜ë³µ ê´€ë¦¬'** íƒ­ì—ì„œ ë³„ë„ë¡œ ë“±ë¡í•˜ê³  ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. ì´ê³³ì—ì„œ ì˜ˆì™¸ ë‚ ì§œ ì²˜ë¦¬ ë“± ì •êµí•œ ì„¤ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.",subtasks:"í•˜ìœ„ ì‘ì—… (Subtasks)",subtasksDesc:"í•˜ë‚˜ì˜ í° í”„ë¡œì íŠ¸ë¥¼ ì—¬ëŸ¬ ê°œì˜ ì‘ì€ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”. í•  ì¼ ìƒì„¸ í™”ë©´ì—ì„œ 'í•˜ìœ„ ì‘ì—… ì¶”ê°€'ë¥¼ í†µí•´ ì§„í–‰ ìƒí™©ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",tags:"íƒœê·¸ ë° í•„í„°ë§",tagsDesc:"í•  ì¼ ì¶”ê°€ ì‹œ '#ì—…ë¬´', '#ê°œì¸'ê³¼ ê°™ì´ í•´ì‹œíƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë©”ì¸ í™”ë©´ì˜ ê²€ìƒ‰/í•„í„° ë°”ì—ì„œ íŠ¹ì • íƒœê·¸ë‚˜ ìš°ì„ ìˆœìœ„(ê¸´ê¸‰, ë†’ìŒ ë“±)ë³„ë¡œ í•„í„°ë§í•˜ì—¬ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."},account:{title:"4. ê³„ì • ë° ë°ì´í„°",login:"ë¡œê·¸ì¸ ë°©ì‹",loginDesc:"êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë©´ í´ë¼ìš°ë“œ ë™ê¸°í™”ê°€ ì§€ì›ë˜ì–´ ì—¬ëŸ¬ ê¸°ê¸°(PC, íƒœë¸”ë¦¿, ëª¨ë°”ì¼)ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²ŒìŠ¤íŠ¸ ëª¨ë“œëŠ” ê¸°ê¸° ë‚´ë¶€ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.",security:"ë³´ì•ˆ ë° ë°±ì—…",securityDesc:"ëª¨ë“  ë°ì´í„°ëŠ” ì•ˆì „í•˜ê²Œ ì „ì†¡ ë° ì €ì¥ë©ë‹ˆë‹¤. ì•± ì‚­ì œ ì‹œ ê²ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” ì†Œì‹¤ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì¤‘ìš”í•œ ë°ì´í„° ë³´í˜¸ë¥¼ ìœ„í•´ êµ¬ê¸€ ë¡œê·¸ì¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤."},sharing:{title:"5. ê³µìœ  ë° í˜‘ì—…",createDetail:"ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°",createDetailDesc:"ì‚¬ì´ë“œë°”ì˜ 'ê³µìœ  ì„¤ì •' ë©”ë‰´ì—ì„œ ìƒˆë¡œìš´ ê·¸ë£¹ì„ ë§Œë“¤ê³  íŒ€ì›ë“¤ì„ ì´ë©”ì¼ë¡œ ì´ˆëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",permissionDetail:"ê¶Œí•œ ê´€ë¦¬",permissionDetailDesc:"íŒ€ì›ë³„ë¡œ 'ë³´ê¸° ê°€ëŠ¥', 'í¸ì§‘ ê°€ëŠ¥', 'ê´€ë¦¬ì' ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ì•ˆì „í•˜ê²Œ í˜‘ì—…í•˜ì„¸ìš”.",filterDetail:"ê³µìœ  í•„í„°",filterDetailDesc:"ë©”ì¸ í™”ë©´ ìƒë‹¨ì˜ í•„í„°ë¥¼ í†µí•´ 'ê°œì¸ í• ì¼'ê³¼ 'ê³µìœ ëœ í• ì¼'ì„ êµ¬ë¶„í•´ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."},notifications:{title:"6. ì•Œë¦¼ ì„¼í„°",centerDetail:"ì•Œë¦¼ í™•ì¸",centerDetailDesc:"ìš°ì¸¡ ìƒë‹¨ì˜ ì¢… ëª¨ì–‘ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ ìƒˆë¡œìš´ ì´ˆëŒ€ ìš”ì²­ì´ë‚˜ í”„ë¡œì íŠ¸ ë³€ê²½ ì‚¬í•­ì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."},more:{title:"ë” ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?",contact:"ì¶”ê°€ì ì¸ ë„ì›€ì´ í•„ìš”í•˜ê±°ë‚˜ ê±´ì˜ì‚¬í•­ì´ ìˆë‹¤ë©´ ì„¤ì • ë©”ë‰´ì˜ 'ë¬¸ì˜í•˜ê¸°'ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.",button:"ë¬¸ì˜í•˜ê¸°"}},jj={auth:cj,nav:dj,settings:uj,updateNotification:hj,common:gj,sharing:mj,days:fj,todo:pj,modal:yj,projectTemplate:xj,calendar:bj,search:vj,analysis:wj,recurring:kj,detailedStats:Tj,history:Nj,guide:Sj};It.use(Ip).use(NS).init({resources:{en:{translation:lj},ko:{translation:jj}},fallbackLng:"ko",interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const _j={lessThanXSeconds:{one:"1ì´ˆ ë¯¸ë§Œ",other:"{{count}}ì´ˆ ë¯¸ë§Œ"},xSeconds:{one:"1ì´ˆ",other:"{{count}}ì´ˆ"},halfAMinute:"30ì´ˆ",lessThanXMinutes:{one:"1ë¶„ ë¯¸ë§Œ",other:"{{count}}ë¶„ ë¯¸ë§Œ"},xMinutes:{one:"1ë¶„",other:"{{count}}ë¶„"},aboutXHours:{one:"ì•½ 1ì‹œê°„",other:"ì•½ {{count}}ì‹œê°„"},xHours:{one:"1ì‹œê°„",other:"{{count}}ì‹œê°„"},xDays:{one:"1ì¼",other:"{{count}}ì¼"},aboutXWeeks:{one:"ì•½ 1ì£¼",other:"ì•½ {{count}}ì£¼"},xWeeks:{one:"1ì£¼",other:"{{count}}ì£¼"},aboutXMonths:{one:"ì•½ 1ê°œì›”",other:"ì•½ {{count}}ê°œì›”"},xMonths:{one:"1ê°œì›”",other:"{{count}}ê°œì›”"},aboutXYears:{one:"ì•½ 1ë…„",other:"ì•½ {{count}}ë…„"},xYears:{one:"1ë…„",other:"{{count}}ë…„"},overXYears:{one:"1ë…„ ì´ìƒ",other:"{{count}}ë…„ ì´ìƒ"},almostXYears:{one:"ê±°ì˜ 1ë…„",other:"ê±°ì˜ {{count}}ë…„"}},Dj=(t,e,r)=>{let s;const n=_j[t];return typeof n=="string"?s=n:e===1?s=n.one:s=n.other.replace("{{count}}",e.toString()),r?.addSuffix?r.comparison&&r.comparison>0?s+" í›„":s+" ì „":s},Cj={full:"yë…„ Mì›” dì¼ EEEE",long:"yë…„ Mì›” dì¼",medium:"y.MM.dd",short:"y.MM.dd"},Ej={full:"a Hì‹œ mmë¶„ ssì´ˆ zzzz",long:"a H:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Ij={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Aj={date:ho({formats:Cj,defaultWidth:"full"}),time:ho({formats:Ej,defaultWidth:"full"}),dateTime:ho({formats:Ij,defaultWidth:"full"})},Rj={lastWeek:"'ì§€ë‚œ' eeee p",yesterday:"'ì–´ì œ' p",today:"'ì˜¤ëŠ˜' p",tomorrow:"'ë‚´ì¼' p",nextWeek:"'ë‹¤ìŒ' eeee p",other:"P"},Pj=(t,e,r,s)=>Rj[t],Mj={narrow:["BC","AD"],abbreviated:["BC","AD"],wide:["ê¸°ì›ì „","ì„œê¸°"]},Oj={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1ë¶„ê¸°","2ë¶„ê¸°","3ë¶„ê¸°","4ë¶„ê¸°"]},Lj={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"],wide:["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"]},$j={narrow:["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "],short:["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "],abbreviated:["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "],wide:["ì¼ìš”ì¼","ì›”ìš”ì¼","í™”ìš”ì¼","ìˆ˜ìš”ì¼","ëª©ìš”ì¼","ê¸ˆìš”ì¼","í† ìš”ì¼"]},Fj={narrow:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},abbreviated:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},wide:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"}},Wj={narrow:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},abbreviated:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},wide:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"}},Vj=(t,e)=>{const r=Number(t);switch(String(e?.unit)){case"minute":case"second":return String(r);case"date":return r+"ì¼";default:return r+"ë²ˆì§¸"}},Uj={ordinalNumber:Vj,era:vn({values:Mj,defaultWidth:"wide"}),quarter:vn({values:Oj,defaultWidth:"wide",argumentCallback:t=>t-1}),month:vn({values:Lj,defaultWidth:"wide"}),day:vn({values:$j,defaultWidth:"wide"}),dayPeriod:vn({values:Fj,defaultWidth:"wide",formattingValues:Wj,defaultFormattingWidth:"wide"})},Bj=/^(\d+)(ì¼|ë²ˆì§¸)?/i,Hj=/\d+/i,Gj={narrow:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(ê¸°ì›ì „|ì„œê¸°)/i},zj={any:[/^(bc|ê¸°ì›ì „)/i,/^(ad|ì„œê¸°)/i]},Kj={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234]ì‚¬?ë¶„ê¸°/i},Yj={any:[/1/i,/2/i,/3/i,/4/i]},qj={narrow:/^(1[012]|[123456789])/,abbreviated:/^(1[012]|[123456789])ì›”/i,wide:/^(1[012]|[123456789])ì›”/i},Xj={any:[/^1ì›”?$/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},Qj={narrow:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]/,short:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]/,abbreviated:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]/,wide:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]ìš”ì¼/},Jj={any:[/^ì¼/,/^ì›”/,/^í™”/,/^ìˆ˜/,/^ëª©/,/^ê¸ˆ/,/^í† /]},Zj={any:/^(am|pm|ì˜¤ì „|ì˜¤í›„|ìì •|ì •ì˜¤|ì•„ì¹¨|ì €ë…|ë°¤)/i},e_={any:{am:/^(am|ì˜¤ì „)/i,pm:/^(pm|ì˜¤í›„)/i,midnight:/^ìì •/i,noon:/^ì •ì˜¤/i,morning:/^ì•„ì¹¨/i,afternoon:/^ì˜¤í›„/i,evening:/^ì €ë…/i,night:/^ë°¤/i}},t_={ordinalNumber:Vx({matchPattern:Bj,parsePattern:Hj,valueCallback:t=>parseInt(t,10)}),era:wn({matchPatterns:Gj,defaultMatchWidth:"wide",parsePatterns:zj,defaultParseWidth:"any"}),quarter:wn({matchPatterns:Kj,defaultMatchWidth:"wide",parsePatterns:Yj,defaultParseWidth:"any",valueCallback:t=>t+1}),month:wn({matchPatterns:qj,defaultMatchWidth:"wide",parsePatterns:Xj,defaultParseWidth:"any"}),day:wn({matchPatterns:Qj,defaultMatchWidth:"wide",parsePatterns:Jj,defaultParseWidth:"any"}),dayPeriod:wn({matchPatterns:Zj,defaultMatchWidth:"any",parsePatterns:e_,defaultParseWidth:"any"})},dn={code:"ko",formatDistance:Dj,formatLong:Aj,formatRelative:Pj,localize:Uj,match:t_,options:{weekStartsOn:0,firstWeekContainsDate:1}};var Tl;(function(t){t[t.Sunday=1]="Sunday",t[t.Monday=2]="Monday",t[t.Tuesday=3]="Tuesday",t[t.Wednesday=4]="Wednesday",t[t.Thursday=5]="Thursday",t[t.Friday=6]="Friday",t[t.Saturday=7]="Saturday"})(Tl||(Tl={}));const _t=Ar("LocalNotifications",{web:()=>Je(()=>import("./web-B8Tol5uP.js"),__vite__mapDeps([5,2,3,1,4]),import.meta.url).then(t=>new t.LocalNotificationsWeb)}),r_=Object.freeze(Object.defineProperty({__proto__:null,LocalNotifications:_t,get Weekday(){return Tl}},Symbol.toStringTag,{value:"Module"})),Sr=class Sr{constructor(){Ht(this,"notifications",[]);Ht(this,"listeners",[]);this.loadNotifications(),this.checkScheduledNotifications(),this.checkWeeklyReport(),this.initializeNativeNotifications(),setInterval(()=>{this.checkScheduledNotifications(),this.checkWeeklyReport()},6e4),Ke.isNativePlatform()&&_t.addListener("localNotificationActionPerformed",e=>{console.log("ğŸ”” Notification action performed:",e.actionId,e.notification.id)})}async ensureChannel(){if(Ke.isNativePlatform())try{await _t.createChannel({id:"todo_alert_channel",name:"Todo ì•Œë¦¼ (ì¤‘ìš”)",description:"ì¤‘ìš”í•œ í• ì¼ ì•Œë¦¼",importance:5,visibility:1,vibration:!0})}catch(e){console.error("Failed to create notification channel",e)}}async initializeNativeNotifications(){if(Ke.isNativePlatform()){await this.ensureChannel();try{await _t.requestPermissions()}catch(e){console.error("Failed to request permissions",e)}try{await _t.registerActionTypes({types:[{id:"REMINDER_ACTIONS",actions:[{id:"COMPLETE",title:"ì™„ë£Œí•˜ê¸°",foreground:!0},{id:"SNOOZE",title:"15ë¶„ ë’¤ ì•Œë¦¼",destructive:!1,foreground:!1}]},{id:"DAILY_BRIEFING_ACTIONS",actions:[{id:"OPEN_APP",title:"ì–´í”Œë¡œ í™•ì¸",foreground:!0},{id:"DISMISS",title:"ë‹«ê¸°",destructive:!1,foreground:!1}]}]})}catch(e){console.error("Failed to register action types",e)}console.log("Native notifications initialized")}}loadNotifications(){const e=localStorage.getItem("notifications");if(e)try{this.notifications=JSON.parse(e).map(r=>({...r,scheduledTime:new Date(r.scheduledTime),createdAt:new Date(r.createdAt)}))}catch(r){console.error("Failed to load notifications:",r)}}saveNotifications(){localStorage.setItem("notifications",JSON.stringify(this.notifications))}async showNotification(e){if(Ke.isNativePlatform())try{await this.ensureChannel(),await _t.schedule({notifications:[{title:e.title,body:e.body,id:Date.now()%1e5,schedule:{at:new Date(Date.now()+1e3)},channelId:"default"}]})}catch(r){console.error("Show notification failed",r)}else"Notification"in window&&Notification.permission==="granted"&&new Notification(e.title,{body:e.body,tag:e.tag})}checkScheduledNotifications(){if(Ke.isNativePlatform())return;const e=new Date;this.notifications.filter(s=>s.scheduledTime<=e&&s.scheduledTime>new Date(e.getTime()-6e4*5)&&!s.isRead).forEach(s=>{this.showBrowserNotification(s),this.listeners.forEach(n=>n(s))})}showBrowserNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification(e.title,{body:e.message,icon:"/favicon.ico",tag:e.tag||e.id})}async scheduleAllNotifications(e,r,s){const n=new Date;if(this.notifications=this.notifications.filter(i=>i.scheduledTime<=n),Ke.isNativePlatform())try{const i=await _t.getPending();i.notifications.length>0&&await _t.cancel({notifications:i.notifications})}catch(i){console.error("Failed to cancel native notifications",i)}await this.scheduleDailyBriefing(e,r,s),await this.scheduleWeeklyReport(e);for(const i of r)i.completed||(await this.scheduleReminder(i,e),await this.scheduleStartReminder(i,e));this.saveNotifications()}async scheduleDailyBriefing(e,r,s){if(!e.dailyReminder||!e.dailyReminderTime)return;const[n,i]=e.dailyReminderTime.split(":").map(Number),o=e.dailyRecurrence||[1,2,3,4,5],l=[];for(let c=0;c<14;c++){const d=xs(new Date,c);if(d.setHours(n,i,0,0),d<=new Date)continue;const u=ri(d);if(!o.includes(u)||e.dailyExcludeHolidays&&s.some(x=>Ut(d,new Date(x.date))))continue;const h=this.buildFutureBriefingMessage(r,d),g=(Sr.DAILY_ID_BASE+c).toString();this.notifications.push({id:g,type:"daily_briefing",title:"ì˜¤ëŠ˜ì˜ í• ì¼ ğŸ“‹",message:h,scheduledTime:d,isRead:!1,createdAt:new Date,tag:`daily_${c}`}),Ke.isNativePlatform()&&l.push({id:Sr.DAILY_ID_BASE+c,title:"ì˜¤ëŠ˜ì˜ í• ì¼ ğŸ“‹",body:h,schedule:{at:d,allowWhileIdle:!0},channelId:"todo_alert_channel",actionTypeId:"DAILY_BRIEFING_ACTIONS",extra:{type:"daily_briefing"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"})}l.length>0&&await _t.schedule({notifications:l})}buildFutureBriefingMessage(e,r){const s=qe(r,"yyyy-MM-dd"),n=e.filter(i=>{if(i.completed)return!1;const o=i.dueDate?qe(new Date(i.dueDate),"yyyy-MM-dd")===s:!1,l=i.startDate?qe(new Date(i.startDate),"yyyy-MM-dd")<=s:!1;return o||l});return n.length===0?"ì˜¤ëŠ˜ ì˜ˆì •ëœ í• ì¼ì„ í™•ì¸í•´ë³´ì„¸ìš”! ğŸ“":`ì˜¤ëŠ˜ ${n.length}ê°œì˜ í• ì¼ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`}async scheduleWeeklyReport(e){if(!e.weeklyReport||!e.weeklyReportTime)return;const[r,s]=e.weeklyReportTime.split(":").map(Number);let n=new Date;for(n.setHours(r,s,0,0);ri(n)!==1||n<=new Date;)n=xs(n,1),n.setHours(r,s,0,0);this.notifications.push({id:Sr.WEEKLY_REPORT_ID.toString(),type:"weekly_report",title:"ì£¼ê°„ ì„±ê³¼ ë¦¬í¬íŠ¸ ğŸ“Š",message:"ì§€ë‚œ í•œ ì£¼ì˜ ì„±ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!",scheduledTime:n,isRead:!1,createdAt:new Date}),Ke.isNativePlatform()&&await _t.schedule({notifications:[{id:Sr.WEEKLY_REPORT_ID,title:"ì£¼ê°„ ì„±ê³¼ ë¦¬í¬íŠ¸ ğŸ“Š",body:"ì§€ë‚œ í•œ ì£¼ì˜ ì„±ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!",schedule:{at:n,allowWhileIdle:!0,every:"week"},channelId:"todo_alert_channel",extra:{type:"weekly_report"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"}]})}async scheduleReminder(e,r){if(!r.dueReminders||!e.dueDate)return;let s=new Date(e.dueDate);if(r.dueReminderTiming!==void 0)s=new Date(s.getTime()-r.dueReminderTiming*6e4);else{s.setDate(s.getDate()-r.advanceDays);const[i,o]=r.time.split(":").map(Number);s.setHours(i,o,0,0)}if(s<=new Date)return;const n=this.hashCode(e.id);this.notifications.push({id:n.toString(),todoId:e.id,type:"reminder",title:"ë§ˆê° ì„ë°• ì•Œë¦¼",message:`"${e.title}" ë§ˆê° ì‹œê°„ì´ ë‹¤ê°€ì˜µë‹ˆë‹¤.`,scheduledTime:s,isRead:!1,createdAt:new Date,tag:`reminder-${e.id}`}),Ke.isNativePlatform()&&await _t.schedule({notifications:[{title:"ë§ˆê° ì„ë°• ì•Œë¦¼",body:`"${e.title}" ë§ˆê° ì‹œê°„ì´ ë‹¤ê°€ì˜µë‹ˆë‹¤.`,id:n,schedule:{at:s,allowWhileIdle:!0},channelId:"todo_alert_channel",actionTypeId:"REMINDER_ACTIONS",extra:{todoId:e.id,type:"reminder"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"}]})}async scheduleStartReminder(e,r){if(!r.startReminder||!e.startDate||!r.startReminderTime)return;const[s,n]=r.startReminderTime.split(":").map(Number),i=new Date(e.startDate);if(i.setHours(s,n,0,0),i<=new Date)return;const o=this.hashCode(e.id+"_start");this.notifications.push({id:o.toString(),todoId:e.id,type:"start_reminder",title:"í• ì¼ ì‹œì‘ ì•Œë¦¼ ğŸš€",message:`"${e.title}" ì‹œì‘ì¼ì…ë‹ˆë‹¤.`,scheduledTime:i,isRead:!1,createdAt:new Date,tag:`start-${e.id}`}),Ke.isNativePlatform()&&await _t.schedule({notifications:[{title:"í• ì¼ ì‹œì‘ ì•Œë¦¼ ğŸš€",body:`"${e.title}" ì‹œì‘ì¼ì…ë‹ˆë‹¤.`,id:o,schedule:{at:i,allowWhileIdle:!0},channelId:"default",actionTypeId:"REMINDER_ACTIONS",extra:{todoId:e.id,type:"start_reminder"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"}]})}hashCode(e){let r=0,s,n;if(e.length===0)return r;for(s=0;s<e.length;s++)n=e.charCodeAt(s),r=(r<<5)-r+n,r|=0;return Math.abs(r)}isSupported(){return Ke.isNativePlatform()?!0:"Notification"in window}async requestPermission(){return Ke.isNativePlatform()?(await _t.requestPermissions()).display==="granted":"Notification"in window?await Notification.requestPermission()==="granted":!1}async checkPermissions(){return Ke.isNativePlatform()?await _t.checkPermissions():"Notification"in window?{display:Notification.permission==="granted"?"granted":Notification.permission==="denied"?"denied":"prompt"}:{display:"denied"}}async cancelDailyBriefing(){}checkWeeklyReport(){}scheduleOverdueNotification(e){}suggestRecurringTask(e){}showCompletionCelebration(e){}markAsRead(e){}dismissNotification(e){}getUnreadNotifications(){return[]}getAllNotifications(){return[]}addListener(e){}removeListener(e){}async clearNotificationsForTodo(e){if(this.notifications=this.notifications.filter(r=>r.todoId!==e),this.saveNotifications(),Ke.isNativePlatform()){const r=this.hashCode(e),s=this.hashCode(e+"_start");await _t.cancel({notifications:[{id:r},{id:s}]})}}};Ht(Sr,"DAILY_ID_BASE",1e5),Ht(Sr,"START_REMINDER_ID_BASE",2e5),Ht(Sr,"WEEKLY_REPORT_ID",9e5);let Ni=Sr;const Nr=new Ni,Nl=Object.freeze(Object.defineProperty({__proto__:null,NotificationManager:Ni,notificationManager:Nr},Symbol.toStringTag,{value:"Module"})),s_=()=>{const{todos:t}=ot(),{customHolidays:e}=nn();return p.useEffect(()=>{const r=localStorage.getItem("notification-settings");if(r)try{const s=JSON.parse(r),n=setTimeout(()=>{Nr.scheduleAllNotifications(s,t,e)},2e3);return()=>clearTimeout(n)}catch(s){console.error("Failed to parse notification settings",s)}},[t,e]),null},Zi=(t,e={})=>{const{minSwipeDistance:r=50,preventDefaultTouchmoveEvent:s=!1}=e,n=p.useRef(null),i=p.useRef(null),o=p.useRef(null),l=p.useRef(null);return{onTouchStart:h=>{n.current=h.touches[0].clientX,i.current=h.touches[0].clientY},onTouchMove:h=>{s&&h.preventDefault()},onTouchEnd:h=>{if(!n.current||!i.current)return;o.current=h.changedTouches[0].clientX,l.current=h.changedTouches[0].clientY;const g=n.current-o.current,m=i.current-l.current;Math.abs(g)>Math.abs(m)&&Math.abs(g)>r&&(g>0?t.onSwipeLeft?.():t.onSwipeRight?.()),n.current=null,i.current=null,o.current=null,l.current=null}}},zc=p.forwardRef(({todoId:t,subTasks:e},r)=>{const{addSubTask:s,updateSubTask:n,deleteSubTask:i,toggleSubTask:o}=ot(),[l,c]=p.useState(""),[d,u]=p.useState(!1),[h,g]=p.useState(null),m=k=>{k&&k.preventDefault(),l.trim()&&(s(t,l.trim()),c(""),u(!1))};p.useImperativeHandle(r,()=>({savePending:()=>{l.trim()&&m(),h?.title.trim()&&f()}}));const x=k=>{g({id:k.id,title:k.title})},f=()=>{!h||!h.title.trim()||(n(t,h.id,{title:h.title.trim()}),g(null))},y=()=>{g(null)},w=k=>{confirm("ì´ í•˜ìœ„ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&i(t,k)},v=(k,b)=>{k.key==="Enter"?(k.preventDefault(),b==="add"?m(k):f()):k.key==="Escape"&&(b==="add"?(u(!1),c("")):y())};return a.jsxs("div",{className:"mt-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["í•˜ìœ„ ì‘ì—… (",e.length,")"]}),!d&&a.jsxs("button",{onClick:k=>{k.stopPropagation(),u(!0)},className:"flex items-center gap-1 px-2 py-1 text-xs text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",children:[a.jsx(ct,{className:"w-3 h-3"}),"ì¶”ê°€"]})]}),a.jsxs("div",{className:"space-y-2",children:[e.map(k=>a.jsx("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg group",children:h?.id===k.id?a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"checkbox",checked:k.completed,onChange:()=>o(t,k.id),onClick:b=>b.stopPropagation(),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),a.jsx("input",{type:"text",value:h.title,onChange:b=>g({...h,title:b.target.value}),onKeyDown:b=>v(b,"edit"),onClick:b=>b.stopPropagation(),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-600 dark:text-white",placeholder:"í•˜ìœ„ ì‘ì—… ì œëª©",autoFocus:!0}),a.jsx("button",{onClick:b=>{b.stopPropagation(),f()},className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded",title:"ì €ì¥",children:a.jsx(Yt,{className:"w-3 h-3"})}),a.jsx("button",{onClick:b=>{b.stopPropagation(),y()},className:"p-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded",title:"ì·¨ì†Œ",children:a.jsx(rt,{className:"w-3 h-3"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"checkbox",checked:k.completed,onChange:()=>o(t,k.id),onClick:b=>b.stopPropagation(),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:`text-sm ${k.completed?"line-through text-gray-500":"text-gray-700 dark:text-gray-300"}`,children:k.title}),k.completed&&k.completedAt&&k.completedAt!==null&&a.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["ì™„ë£Œ: ",(()=>{try{const b=new Date(k.completedAt);return isNaN(b.getTime())?(console.warn("Invalid Date detected for subtask:",k.id,k.completedAt),"ë‚ ì§œ ì˜¤ë¥˜"):b.toLocaleString("ko-KR")}catch(b){return console.error("Date parsing error:",b,k.completedAt),"ë‚ ì§œ ì˜¤ë¥˜"}})()]})]}),a.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx("button",{onClick:b=>{b.stopPropagation(),x(k)},className:"p-1 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded",title:"ìˆ˜ì •",children:a.jsx(zg,{className:"w-3 h-3"})}),a.jsx("button",{onClick:b=>{b.stopPropagation(),w(k.id)},className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",title:"ì‚­ì œ",children:a.jsx(rt,{className:"w-3 h-3"})})]})]})},k.id)),d&&a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[a.jsx("input",{type:"text",value:l,onChange:k=>c(k.target.value),onKeyDown:k=>v(k,"add"),onClick:k=>k.stopPropagation(),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-600 dark:text-white",placeholder:"í•˜ìœ„ ì‘ì—… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”",autoFocus:!0}),a.jsx("button",{type:"button",onClick:k=>{k.preventDefault(),k.stopPropagation(),m()},className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded",title:"ì¶”ê°€",children:a.jsx(Yt,{className:"w-3 h-3"})}),a.jsx("button",{type:"button",onClick:k=>{k.stopPropagation(),u(!1),c("")},className:"p-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded",title:"ì·¨ì†Œ",children:a.jsx(rt,{className:"w-3 h-3"})})]}),e.length===0&&!d&&a.jsx("div",{className:"text-center py-4 text-sm text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/30 rounded-lg border-2 border-dashed border-gray-200 dark:border-gray-600",children:"í•˜ìœ„ ì‘ì—…ì„ ì¶”ê°€í•´ë³´ì„¸ìš”"})]})]})});zc.displayName="SubTaskManager";const Wr=({todo:t,onEdit:e,compact:r=!1})=>{const{t:s,i18n:n}=Xe(),i=n.language==="ko"?dn:sn,{toggleTodo:o,deleteTodo:l,updateTodo:c}=ot(),{currentUser:d}=bt(),[u,h]=p.useState(!1),g=p.useRef(null),[m,x]=p.useState(!1),f=t.visibility?.isShared,y=24,w=new Date,v=f&&t.ownerId&&t.ownerId!==d?.uid&&t.createdAt&&Vd(w,new Date(t.createdAt))<=y,k=f&&t.lastModifiedBy&&t.lastModifiedBy!==d?.uid&&t.updatedAt&&t.createdAt&&new Date(t.updatedAt).getTime()!==new Date(t.createdAt).getTime()&&Vd(w,new Date(t.updatedAt))<=y,b=t.subTasks?.length||0,j=t.subTasks?.filter(X=>X.completed).length||0,D=b>0,N=D?j/b*100:0,T=t.dueDate&&Ud(new Date(t.dueDate),go(new Date))&&!t.completed;t.dueDate&&Ux(new Date(t.dueDate),go(new Date))&&Ud(new Date(t.dueDate),xs(go(new Date),1));const _=X=>qe(new Date(X),"yyyy.MM.dd",{locale:i}),P=()=>{if(!t.startDate&&!t.dueDate)return null;if(t.startDate&&t.dueDate)return a.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded",children:[a.jsx("span",{children:_(t.startDate)}),a.jsx("span",{className:"text-gray-400",children:"~"}),a.jsx("span",{className:`${T?"text-red-500 font-bold":""}`,children:_(t.dueDate)})]});if(t.startDate)return a.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded",children:[a.jsx(el,{className:"w-3 h-3 text-primary-500"}),a.jsx("span",{children:_(t.startDate)})]});if(t.dueDate)return a.jsxs("div",{className:`flex items-center gap-1 text-[10px] font-medium bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded ${T?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:[a.jsx(pa,{className:`w-3 h-3 ${T?"text-red-500 fill-red-500":"text-gray-400"}`}),a.jsx("span",{children:_(t.dueDate)})]})},C=()=>{u||o(t.id)},A=!t.myPermission||t.myPermission==="edit"||t.myPermission==="admin",B=!t.myPermission||t.myPermission==="admin",z=Zi({onSwipeLeft:()=>{B&&confirm(s("calendar.deleteConfirm"))&&l(t.id)},onSwipeRight:()=>{A&&o(t.id)}},{minSwipeDistance:50}),W=()=>{if(t.completed)return"border-gray-200 dark:border-gray-700";switch(t.priority){case"urgent":return"border-red-500 dark:border-red-500";case"high":return"border-orange-500 dark:border-orange-500";case"medium":return"border-primary-500 dark:border-primary-500";default:return"border-gray-200 dark:border-gray-700"}};return a.jsx("div",{ref:g,className:`
        relative group mb-3 transition-all duration-300 ease-out
        ${t.completed?"opacity-60":"opacity-100"}
      `,onClick:()=>{e?.(t)},...z,children:a.jsxs("div",{className:`
        relative p-5 rounded-2xl border backdrop-blur-sm transition-all duration-300
        ${t.completed?"bg-gray-50/50 dark:bg-gray-800/30 border-gray-200 dark:border-gray-700":`bg-white/70 dark:bg-gray-800/70 shadow-sm hover:shadow-md hover:-translate-y-0.5 ${W()} md:border-white/50 md:dark:border-gray-700`}
      `,children:[!r&&a.jsxs("div",{className:"hidden md:flex absolute top-4 right-20 flex-col items-end gap-1.5 z-10",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[t.visibility?.isShared&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 rounded-full border border-blue-200 dark:border-blue-800 flex items-center gap-1",children:[a.jsx(tr,{className:"w-3 h-3"}),s("sharing.shared")||"Shared"]}),v&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-green-500 text-white rounded-full flex items-center gap-1 animate-pulse",children:[a.jsx(Zo,{className:"w-3 h-3"}),"NEW"]}),!v&&k&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-orange-500 text-white rounded-full flex items-center gap-1",children:[a.jsx(Za,{className:"w-3 h-3"}),"ìµœê·¼ ìˆ˜ì •"]}),t.recurrence&&t.recurrence!=="none"&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 rounded-full border border-purple-200 dark:border-purple-800 flex items-center gap-1",children:[a.jsx(zy,{className:"w-3 h-3"}),s("modal.addTodo.recurrence")]}),t.priority&&t.priority!=="medium"&&a.jsx("span",{className:`px-2 py-0.5 text-[10px] font-bold rounded-full border flex items-center gap-1 ${t.priority==="urgent"?"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800":t.priority==="high"?"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/30 dark:text-orange-300 dark:border-orange-800":"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-900/30 dark:text-gray-300 dark:border-gray-800"}`,children:t.priority==="urgent"?s("modal.addTodo.urgent"):t.priority==="high"?s("modal.addTodo.high"):s("modal.addTodo.low")}),t.type==="project"&&a.jsxs("span",{className:"px-2 py-0.5 text-[10px] font-bold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 rounded-full border border-indigo-200 dark:border-indigo-800 flex items-center gap-1",children:[t.project==="longterm"?s("projectTemplate.longterm"):s("projectTemplate.shortterm"),D&&a.jsxs("span",{className:"ml-1 opacity-80",children:[j,"/",b]})]})]}),P()]}),a.jsxs("div",{className:"md:hidden absolute top-4 right-20 flex items-center gap-1.5 z-10",children:[v&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-green-500 text-white rounded-full flex items-center gap-0.5 animate-pulse",children:[a.jsx(Zo,{className:"w-3 h-3"}),"NEW"]}),!v&&k&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-orange-500 text-white rounded-full flex items-center gap-0.5",children:[a.jsx(Za,{className:"w-3 h-3"}),"ìˆ˜ì •ë¨"]}),t.visibility?.isShared&&a.jsx(tr,{className:"w-4 h-4 text-blue-500"}),t.recurrence&&t.recurrence!=="none"&&a.jsx(Ql,{className:"w-4 h-4 text-purple-500"}),t.type==="project"&&t.project==="longterm"&&a.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 rounded-full border border-indigo-200 dark:border-indigo-800",children:s("projectTemplate.longterm")})]}),a.jsx("div",{className:"absolute top-4 right-4 z-20 flex flex-col items-end gap-1",children:a.jsxs("div",{className:"flex items-center gap-1",children:[A&&a.jsx("button",{onClick:X=>{X.stopPropagation(),e?.(t)},className:"p-1.5 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",title:s("common.edit"),children:a.jsx(Kg,{className:"w-4 h-4"})}),B&&a.jsx("button",{onClick:X=>{X.stopPropagation(),window.confirm(s("common.deleteConfirm")||"ì´ í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&l(t.id)},className:"p-1.5 text-gray-400 hover:text-red-600 dark:hover:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",title:s("common.delete"),children:a.jsx($t,{className:"w-4 h-4"})})]})}),a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("button",{onClick:X=>{X.stopPropagation(),A&&C()},disabled:!A,className:`
              flex-shrink-0 w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all duration-300 mt-1
              ${t.completed?"bg-primary-500 border-primary-500 text-white scale-110":"border-gray-300 dark:border-gray-600 hover:border-primary-400 dark:hover:border-primary-400 bg-white dark:bg-gray-800"}
              ${A?"":"opacity-50 cursor-not-allowed"}
            `,children:t.completed&&a.jsx(Yt,{className:"w-4 h-4",strokeWidth:3})}),a.jsxs("div",{className:"flex-1 min-w-0 pt-0.5 pr-28 sm:pr-24",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("h3",{className:`
                text-base font-semibold leading-snug transition-all duration-300 break-words
                ${t.completed?"text-gray-400 dark:text-gray-500 line-through decoration-2 decoration-gray-300":"text-gray-900 dark:text-white"}
              `,children:t.title}),D&&a.jsx("button",{onClick:X=>{X.stopPropagation(),x(!m)},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:m?a.jsx(Yg,{className:"w-4 h-4"}):a.jsx(fa,{className:"w-4 h-4"})})]}),t.description&&a.jsx("p",{className:`mt-1.5 text-sm line-clamp-2 ${t.completed?"text-gray-400":"text-gray-600 dark:text-gray-300"}`,children:t.description}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[a.jsx("div",{className:r?"":"md:hidden",children:P()}),t.tags&&t.tags.length>0&&a.jsx("div",{className:"flex flex-wrap gap-1",children:t.tags.map((X,V)=>a.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-md font-medium",children:["#",X]},V))})]}),D&&!t.completed&&a.jsxs("div",{className:"mt-3 w-full",children:[a.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 mb-1",children:[a.jsx("span",{children:s("common.progress")}),a.jsxs("span",{children:[Math.round(N),"%"]})]}),a.jsx("div",{className:"h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden",children:a.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${N===100?"bg-green-500":"bg-primary-500"}`,style:{width:`${N}%`}})})]}),m&&a.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700/50 animate-fade-in-down",children:a.jsx(zc,{todoId:t.id,subTasks:t.subTasks||[]})})]})]})]})})},uh=({vacation:t,employee:e,compact:r=!1})=>{const s=n=>{switch(n){case"ì—°ì°¨":return"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800";case"ì˜¤ì „":return"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800";case"ì˜¤í›„":return"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-300 dark:border-purple-800";case"íŠ¹ë³„":return"bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800";case"ë³‘ê°€":return"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800";case"ì—…ë¬´":return"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600";default:return"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}};return r?a.jsx("div",{className:`p-2 mb-1.5 rounded border ${s(t.type)}`,children:a.jsxs("div",{className:"flex items-center gap-2",children:[e&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 rounded-full flex items-center justify-center text-white text-xs font-semibold flex-shrink-0",style:{backgroundColor:e.color},children:e.name.charAt(0)}),a.jsx("span",{className:"text-xs font-medium truncate",children:e.name})]}),a.jsx("span",{className:"text-[8px] font-medium px-1 py-0.5 rounded",children:t.type})]})}):a.jsx("div",{className:`p-3 rounded-lg border ${s(t.type)}`,children:a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"flex items-center gap-2",children:e?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-semibold",style:{backgroundColor:e.color},children:e.name.charAt(0)}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.name}),a.jsx("div",{className:"text-xs opacity-75",children:e.team})]})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Yn,{className:"w-5 h-5"}),a.jsxs("span",{className:"font-medium",children:["ì§ì› ID: ",t.employeeId]})]})}),a.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded",children:t.type})]})})},Sl=p.memo(({currentView:t,searchTerm:e="",priorityFilter:r="all",typeFilter:s="all",projectFilter:n="all",tagFilter:i=[],completionDateFilter:o="all",sharingFilter:l="all",sharingFilterState:c,selectedDate:d,onDateChange:u,onEdit:h})=>{const{t:g,i18n:m}=Xe(),{todos:x,getTodayTodos:f,getWeekTodos:y,getMonthTodos:w,reorderTodos:v,getYesterdayIncompleteTodos:k,getTomorrowTodos:b}=ot(),{currentUser:j}=bt(),{showVacationsInTodos:D,getVacationsForDate:N,employees:T}=cn(),[_,P]=p.useState(null),[C,A]=p.useState(null),B=Zi({onSwipeLeft:()=>{t==="today"&&u&&d&&u(xs(d,1))},onSwipeRight:()=>{t==="today"&&u&&d&&u(In(d))}},{minSwipeDistance:60}),z=p.useMemo(()=>{let H=[];switch(t){case"today":H=f(d);break;case"week":H=y();break;case"month":H=w();break;default:H=x}return H},[t,d,f,y,w,x]),W=p.useMemo(()=>(I=>{const J=new Set;return I.filter(L=>J.has(L.id)?!1:(J.add(L.id),!0)).filter(L=>{if(e){const G=e.toLowerCase(),O=L.title.toLowerCase().includes(G),se=L.description?.toLowerCase().includes(G)||!1;if(!O&&!se)return!1}if(r!=="all"&&L.priority!==r||s!=="all"&&L.type!==s||n!=="all"&&L.type==="project"&&L.project!==n||i.length>0&&(!L.tags||L.tags.length===0||!L.tags.some(O=>i.includes(O))))return!1;if(c){const{showPersonal:G,showMyShared:O,showGroupShared:se,selectedGroupId:he}=c;if(he&&L.sharedGroupId!==he)return!1;const pe=L.visibility?.isPersonal!==!1,re=L.visibility?.isShared===!0,Ae=re&&L.ownerId===j?.uid,K=re&&L.ownerId!==j?.uid;let xe=!1;if(G&&pe&&!re&&(xe=!0),O&&Ae&&(xe=!0),se&&K&&(xe=!0),G&&pe&&!re&&(xe=!0),G&&pe&&re&&(xe=!0),xe=!1,G&&pe&&!re&&(xe=!0),O&&Ae&&(xe=!0),se&&K&&(xe=!0),!xe)return!1}else if(l!=="all"){const G=L.visibility?.isPersonal!==!1,O=L.visibility?.isShared===!0,se=O&&L.ownerId===j?.uid,he=O&&L.ownerId!==j?.uid;if(l==="private"){if(O||!G)return!1}else if(l==="shared"){if(!he)return!1}else if(l==="my_shared"){if(!se)return!1}else if(L.sharedGroupId!==l)return!1}return!0})})(z),[z,e,r,s,n,i,o,l,c]),X=W.filter(H=>!H.completed),V=W.filter(H=>H.completed),ce=[];if(t==="today"){const H=d||new Date;H.setHours(0,0,0,0),W.forEach(I=>{I.subTasks&&I.subTasks.length>0&&I.subTasks.forEach(J=>{if(J.completed&&J.completedAt&&J.completedAt!==null)try{const le=new Date(J.completedAt);le.setHours(0,0,0,0),le.getTime()===H.getTime()&&ce.push({...J,type:"simple",recurrence:"none",isSubTask:!0,parentTitle:I.title,parentDescription:I.description,createdAt:J.createdAt,updatedAt:J.updatedAt})}catch{}})})}const ke=[...V,...ce],Se=()=>t==="today"&&d?d:new Date,ue=Hr(j?.email)&&D?N(Se()):[],Y=(H,I)=>{P(I),H.dataTransfer.effectAllowed="move",H.dataTransfer.setData("text/plain",I.toString())},ie=async(H,I)=>{if(H.preventDefault(),_!==null){try{if(_!==I){let J=I;I>_&&(J=I-1),await v(_,J,fe)}}catch(J){console.error("Drop error:",J)}P(null),A(null)}},de=()=>{P(null),A(null)},fe=(H=>{const I={urgent:0,high:1,medium:2,low:3};return H.sort((le,L)=>{const G=I[le.priority]-I[L.priority];if(G!==0)return G;const O=le.order,se=L.order;return O!==void 0&&se!==void 0&&O!==se?O-se:O!==void 0&&se===void 0?-1:O===void 0&&se!==void 0?1:le.dueDate&&L.dueDate?new Date(le.dueDate).getTime()-new Date(L.dueDate).getTime():le.dueDate?-1:L.dueDate?1:new Date(L.createdAt).getTime()-new Date(le.createdAt).getTime()})})(X),E=ke.sort((H,I)=>{const J=le=>{if(le.isSubTask&&le.completedAt)try{return new Date(le.completedAt).getTime()}catch{return 0}if(le.completedAt)try{return new Date(le.completedAt).getTime()}catch{return new Date(le.updatedAt).getTime()}return new Date(le.updatedAt).getTime()};return J(I)-J(H)}),ee=t==="today"?k(d):[],Q=t==="today"?b(d):[];return t==="today"?a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-8 items-start",onTouchStart:B.onTouchStart,onTouchMove:B.onTouchMove,onTouchEnd:B.onTouchEnd,children:[a.jsx("div",{className:"xl:col-span-2 space-y-4",children:a.jsxs("div",{className:"glass-card p-3 sm:p-4 rounded-xl",children:[a.jsxs("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-2",children:[a.jsx(Ql,{className:"w-4 h-4"}),g("todo.yesterday.title"),a.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded-full text-gray-600 dark:text-gray-300",children:ee.length})]}),a.jsx("div",{className:"space-y-2",children:ee.length>0?ee.map(H=>a.jsx("div",{className:"opacity-75 hover:opacity-100 transition-opacity",children:a.jsx(Wr,{todo:H,compact:!0,onEdit:h})},H.id)):a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 text-center py-4",children:g("todo.yesterday.empty")})})]})}),a.jsxs("div",{className:"xl:col-span-8 space-y-6",children:[ue.length>0&&a.jsxs("div",{className:"glass-card p-4 sm:p-6 relative overflow-hidden group mb-4 sm:mb-6",children:[a.jsxs("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-3 sm:mb-4 flex items-center gap-2 relative z-10",children:[a.jsx(at,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-500"}),g("todo.vacation.title")," ",a.jsxs("span",{className:"text-sm sm:text-base font-medium text-gray-500 dark:text-gray-300 ml-1",children:["(",ue.length,")"]})]}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:ue.map(H=>{const I=T.find(J=>J.id===H.employeeId);return a.jsx(uh,{vacation:H,employee:I,compact:!0},H.id)})})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:[g("todo.inprogress.title")," (",fe.length,")"]}),fe.length===0&&ue.length===0?a.jsx("div",{className:"glass-card p-12 text-center text-gray-500 dark:text-gray-400",children:a.jsx("p",{className:"text-lg",children:g("todo.inprogress.empty")})}):a.jsx("div",{className:"relative",onDragOver:H=>{if(H.preventDefault(),_===null)return;const I=H.currentTarget,J=I.getBoundingClientRect(),le=H.clientY-J.top,L=I.querySelectorAll("[data-todo-index]");let G=L.length;for(let O=0;O<L.length;O++){const se=L[O].getBoundingClientRect(),he=se.top-J.top,pe=se.bottom-J.top,re=he+(pe-he)/2;if(le<re){G=O;break}}if(G===_){A(null);return}A(G)},onDrop:H=>{H.preventDefault(),C!==null&&ie(H,C)},children:fe.map((H,I)=>a.jsxs("div",{className:"relative",children:[_!==null&&C===I&&a.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-500 z-30"}),a.jsx("div",{"data-todo-index":I,draggable:!0,onDragStart:J=>Y(J,I),onDragEnd:de,className:`
                          cursor-grab active:cursor-grabbing transition-all duration-200 relative
                          ${_===I?"scale-105 shadow-lg z-20":""}
                          mb-1
                        `,children:a.jsx(Wr,{todo:H,onEdit:h})}),_!==null&&C===I+1&&I===fe.length-1&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-blue-500 z-30"})]},H.id))})]}),E.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-300 mb-4 flex items-center gap-2",children:[a.jsx(Cn,{className:"w-5 h-5"}),g("todo.completed.title")," (",E.length,")"]}),a.jsx("div",{className:"space-y-2",children:E.map(H=>{if(H.isSubTask){const I=H,J=I.completedAt?new Date(I.completedAt):new Date(I.updatedAt);return a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Cn,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200 line-through",children:H.title}),a.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded border",children:g("todo.completed.subtask")})]}),a.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300",children:[a.jsxs("span",{className:"font-medium",children:[g("todo.completed.parentProject"),":"]})," ",I.parentTitle,I.parentDescription&&a.jsxs("span",{className:"ml-2 opacity-75",children:["â€¢ ",I.parentDescription]})]}),a.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[g("todo.completed.time"),": ",J.toLocaleTimeString(m.language==="ko"?"ko-KR":"en-US",{hour:"2-digit",minute:"2-digit"})]})]})]},`subtask-${H.id}`)}return a.jsx(Wr,{todo:H,onEdit:h},H.id)})})]})]}),a.jsx("div",{className:"xl:col-span-2 space-y-4",children:a.jsxs("div",{className:"glass-card p-3 sm:p-4 rounded-xl",children:[a.jsxs("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-2",children:[a.jsx(gr,{className:"w-4 h-4"}),g("todo.tomorrow.title"),a.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded-full text-gray-600 dark:text-gray-300",children:Q.length})]}),a.jsx("div",{className:"space-y-2",children:Q.length>0?Q.map(H=>a.jsx("div",{className:"opacity-75 hover:opacity-100 transition-opacity",children:a.jsx(Wr,{todo:H,compact:!0,onEdit:h})},H.id)):a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 text-center py-4",children:g("todo.tomorrow.empty")})})]})})]}):a.jsxs("div",{className:"space-y-6 relative",children:[ue.length>0&&a.jsxs("div",{className:"glass-card p-6 relative overflow-hidden group mb-6",children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2 relative z-10",children:[a.jsx(at,{className:"w-6 h-6 text-blue-500"}),g("todo.vacation.title")," ",a.jsxs("span",{className:"text-base font-medium text-gray-500 dark:text-gray-300 ml-1",children:["(",ue.length,")"]})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:ue.map(H=>{const I=T.find(J=>J.id===H.employeeId);return a.jsx(uh,{vacation:H,employee:I,compact:!1},H.id)})})]}),fe.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:[g("todo.inprogress.title")," (",fe.length,")"]}),a.jsx("div",{className:"relative",onDragOver:H=>{if(H.preventDefault(),_===null)return;const I=H.currentTarget,J=I.getBoundingClientRect(),le=H.clientY-J.top,L=I.querySelectorAll("[data-todo-index]");let G=L.length;for(let O=0;O<L.length;O++){const se=L[O].getBoundingClientRect(),he=se.top-J.top,pe=se.bottom-J.top,re=he+(pe-he)/2;if(le<re){G=O;break}}if(G===_){A(null);return}A(G)},onDrop:H=>{H.preventDefault(),C!==null&&ie(H,C)},children:fe.map((H,I)=>a.jsxs("div",{className:"relative",children:[_!==null&&C===I&&a.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-500 z-30"}),a.jsx("div",{"data-todo-index":I,draggable:!0,onDragStart:J=>Y(J,I),onDragEnd:de,className:`
                      cursor-grab active:cursor-grabbing transition-all duration-200 relative
                      ${_===I?"scale-105 shadow-lg z-20":""}
                      mb-1
                    `,children:a.jsx(Wr,{todo:H,onEdit:h})}),_!==null&&C===I+1&&I===fe.length-1&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-blue-500 z-30"})]},H.id))})]}),E.length>0&&(t==="week"||t==="month")&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-300 mb-4 flex items-center gap-2",children:[a.jsx(Cn,{className:"w-5 h-5"}),g("todo.completed.title")," (",E.length,")"]}),a.jsx("div",{className:"space-y-2",children:E.map(H=>{if(H.isSubTask){const I=H,J=I.completedAt?new Date(I.completedAt):new Date(I.updatedAt);return a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Cn,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200 line-through",children:H.title}),a.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded border",children:g("todo.completed.subtask")})]}),a.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300",children:[a.jsxs("span",{className:"font-medium",children:[g("todo.completed.parentProject"),":"]})," ",I.parentTitle,I.parentDescription&&a.jsxs("span",{className:"ml-2 opacity-75",children:["â€¢ ",I.parentDescription]})]}),a.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[g("todo.completed.time"),": ",J.toLocaleTimeString(m.language==="ko"?"ko-KR":"en-US",{hour:"2-digit",minute:"2-digit"})]})]})]},`subtask-${H.id}`)}return a.jsx(Wr,{todo:H,onEdit:h},H.id)})})]})]})});Sl.displayName="TodoList";var Ur=Gg();const n_=({todoId:t,todoTitle:e="Task",currentUserId:r,initialSharedWith:s,onUpdate:n,isOwner:i=!1,onClose:o})=>{const{t:l}=Xe(),{currentUser:c}=bt(),[d,u]=p.useState(s),[h,g]=p.useState([]),[m,x]=p.useState(""),[f,y]=p.useState(null),[w,v]=p.useState(""),[k,b]=p.useState("read"),[j,D]=p.useState(!1),[N,T]=p.useState(""),[_,P]=p.useState(!1);p.useEffect(()=>{if(u(s),x(""),y(null),T(""),v(e),t&&c){const W=te.subscribeToSentInvitations(c.uid,X=>{const V=X.filter(ce=>ce.todoId===t&&ce.status==="pending");g(V)});return()=>W()}},[s,t,c,e]);const C=async()=>{if(m.trim()){D(!0),T(""),y(null);try{const W=await te.findUserByEmail(m);W?W.uid===r?T(l("sharing.cannotShareSelf")||"Cannot share with yourself"):d.some(X=>X.uid===W.uid)?T(l("sharing.alreadyAdded")||"User already has access"):y({uid:W.uid,email:W.email,displayName:W.displayName,photoURL:W.photoURL,permission:"read"}):T(l("sharing.userNotFound")||"User not found")}catch(W){console.error("Search error:",W),T(l("common.error")||"Error occurred")}finally{D(!1)}}},A=async()=>{if(!(!f||!c))if(t){P(!0);try{const W={uid:c.uid,email:c.email,displayName:c.displayName||void 0,photoURL:c.photoURL,permission:"admin"};await te.sendSharingInvitation(W,f.email,t,e,k,w),y(null),x(""),v(e),await te.updateTodo(t,{visibility:{isPersonal:!0,isShared:!0}},c.uid),alert(l("sharing.inviteSent")||"Invitation sent!")}catch(W){console.error("Failed to send invite:",W),W.message==="Already invited this user to this task."?T(l("sharing.alreadyInvited")||"Invitation already pending"):alert("Failed to send invite")}finally{P(!1)}}else{const W={...f,permission:k},X=[...d,W];u(X),n?.(X),y(null),x("")}},B=async W=>{if(c)if(t){if(confirm(l("sharing.confirmRevoke")||"Revoke access for this user?")){const X=d.filter(V=>V.uid!==W);try{await te.updateTodo(t,{sharedWith:X,visibility:{isPersonal:!0,isShared:X.length>0||h.length>0}},c.uid),u(X)}catch(V){console.error("Revoke failed",V),alert("Failed to revoke access")}}}else{const X=d.filter(V=>V.uid!==W);u(X),n?.(X)}},z=async(W,X)=>{if(c)if(t){const V=d.map(ce=>ce.uid===W?{...ce,permission:X}:ce);try{await te.updateTodo(t,{sharedWith:V},c.uid),u(V)}catch(ce){console.error("Update permission failed",ce)}}else{const V=d.map(ce=>ce.uid===W?{...ce,permission:X}:ce);u(V),n?.(V)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("sharing.inviteUser")}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(tl,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),a.jsx("input",{type:"email",value:m,onChange:W=>x(W.target.value),onKeyPress:W=>W.key==="Enter"&&C(),placeholder:"email@example.com",className:"w-full pl-9 pr-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-xl focus:ring-2 focus:ring-blue-500 transition-all text-sm"})]}),a.jsx("button",{onClick:C,disabled:j||!m,className:"px-3 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl font-medium text-sm hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 transition-colors",children:j?a.jsx(qs,{className:"w-4 h-4 animate-spin"}):a.jsx(tl,{className:"w-4 h-4"})})]}),N&&a.jsx("p",{className:"text-xs text-red-500 ml-1",children:N}),f&&a.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-100 dark:border-blue-800 space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-200 dark:bg-blue-800 flex items-center justify-center text-sm font-bold text-blue-700 dark:text-blue-300",children:f.email[0].toUpperCase()}),a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:f.displayName||f.email}),a.jsx("p",{className:"text-xs text-gray-500",children:f.email})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:l("sharing.shareName")}),a.jsx("input",{type:"text",value:w,onChange:W=>v(W.target.value),className:"w-full mt-1 border-gray-200 dark:border-gray-700 rounded-lg text-sm bg-white dark:bg-gray-800",placeholder:"Task Name for Recipient"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:l("modal.addTodo.priority")}),a.jsxs("select",{value:k,onChange:W=>b(W.target.value),className:"w-full mt-1 border-gray-200 dark:border-gray-700 rounded-lg text-sm bg-white dark:bg-gray-800",children:[a.jsx("option",{value:"read",children:"Can View"}),a.jsx("option",{value:"edit",children:"Can Edit"}),a.jsx("option",{value:"admin",children:"Admin"})]})]})]}),a.jsxs("button",{onClick:A,disabled:_,className:"w-full py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 disabled:opacity-70 transition-colors flex items-center justify-center gap-2",children:[_?a.jsx(qs,{className:"w-4 h-4 animate-spin"}):a.jsx(Ky,{className:"w-4 h-4"}),l(t?"sharing.sendInvite":"sharing.addToShared")]})]})]}),t&&h.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[a.jsx(gr,{className:"w-4 h-4 text-orange-500"}),l("sharing.pendingInvites")]}),a.jsx("div",{className:"space-y-2 max-h-[120px] overflow-y-auto",children:h.map(W=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-orange-50 dark:bg-orange-900/10 rounded-lg border border-orange-100 dark:border-orange-800",children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"font-medium",children:W.toEmail}),a.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",W.permission,")"]})]}),a.jsx("span",{className:"text-xs text-orange-600 dark:text-orange-400 font-medium",children:"Waiting"})]},W.id))})]}),a.jsx("div",{className:"h-px bg-gray-100 dark:bg-gray-700"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[l("sharing.accessList")," (",d.length,")"]}),a.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto pr-1",children:d.length===0?a.jsx("p",{className:"text-center text-gray-400 text-sm py-2",children:l("sharing.noUsers")}):d.map(W=>a.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-xl transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-xs font-medium",children:W.displayName?.[0]||W.email[0].toUpperCase()}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:W.displayName||W.email.split("@")[0]}),W.uid===r&&a.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-1.5 rounded",children:"You"})]}),a.jsx("p",{className:"text-xs text-gray-500 truncate",children:W.email})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{value:W.permission,onChange:X=>z(W.uid,X.target.value),disabled:W.uid===r,className:"bg-transparent border-none text-xs font-medium text-gray-600 dark:text-gray-300 focus:ring-0 cursor-pointer disabled:cursor-default",children:[a.jsx("option",{value:"read",children:"Can View"}),a.jsx("option",{value:"edit",children:"Can Edit"}),a.jsx("option",{value:"admin",children:"Admin"})]}),W.uid!==r&&a.jsx("button",{onClick:()=>B(W.uid),className:"p-1.5 text-gray-400 hover:text-red-500 transition-colors",children:a.jsx(rt,{className:"w-4 h-4"})})]})]},W.uid))})]}),o&&a.jsx("div",{className:"pt-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-end",children:a.jsx("button",{onClick:o,className:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg shadow-sm transition-all dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600",children:l(t?"common.close":"common.done")})})]})},Kc=({isOpen:t,onClose:e,todo:r,isMobile:s=!1})=>{const{updateTodo:n,updateRecurringTemplate:i,deleteTodo:o}=ot(),{currentUser:l}=bt(),{t:c}=Xe(),[d,u]=p.useState({title:"",description:"",priority:"medium",type:"simple",startDate:"",startTime:"",dueDate:"",dueTime:"",showStartTime:!1,showDueTime:!1,recurrence:"none",recurrenceDay:1,recurrenceDate:1,project:"shortterm",tags:[],exceptions:[]}),[h,g]=p.useState({}),[m,x]=p.useState(!1),f=p.useRef(null),[y,w]=p.useState(!0),[v,k]=p.useState(!1),[b,j]=p.useState([]),[D,N]=p.useState(null),[T,_]=p.useState(null),[P,C]=p.useState([]);p.useEffect(()=>{if(!l?.uid)return;const Y=te.subscribeSharingGroups(l.uid,ie=>C(ie));return()=>Y()},[l?.uid]);const A=!r?.ownerId||r?.ownerId===l?.uid,B=!r||A||r.myPermission==="edit"||r.myPermission==="admin",z=!r||r.myPermission==="admin"||A;p.useEffect(()=>{if(r&&t){const Y=r.id.startsWith("recurring_");x(Y),u({title:r.title.replace("ğŸ”„ ",""),description:r.description||"",priority:r.priority,type:r.type,startDate:r.startDate?(()=>{const ie=new Date(r.startDate);return`${ie.getFullYear()}-${String(ie.getMonth()+1).padStart(2,"0")}-${String(ie.getDate()).padStart(2,"0")}`})():"",startTime:r.startTime||"",dueDate:r.dueDate?(()=>{const ie=new Date(r.dueDate);return`${ie.getFullYear()}-${String(ie.getMonth()+1).padStart(2,"0")}-${String(ie.getDate()).padStart(2,"0")}`})():"",dueTime:r.dueDate?new Date(r.dueDate).toTimeString().split(" ")[0].substring(0,5):r.dueTime||"",showStartTime:r.showStartTime||!1,showDueTime:r.showDueTime||!1,recurrence:r.recurrence||"none",recurrenceDay:r.recurrenceDay||1,recurrenceDate:r.recurrenceDate||1,project:r.project||"shortterm",tags:r.tags||[],exceptions:[]}),w(r.visibility?.isPersonal!==!1),k(r.visibility?.isShared||!1),j(r.sharedWith||[]),N(r.sharedGroupId||null),_(r.sharedGroupOwnerId||null)}},[r,t]);const W=()=>{const Y={};if(d.title.trim()||(Y.title="í• ì¼ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."),d.startDate&&d.dueDate)try{const ie=new Date(`${d.startDate}T${d.startTime||"00:00"}`),de=new Date(`${d.dueDate}T${d.dueTime||"23:59"}`);ie>=de&&(Y.startDate="ì‹œì‘ì¼ì€ ë§ˆê°ì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤")}catch(ie){console.error("ë‚ ì§œ ê²€ì¦ ì˜¤ë¥˜:",ie),Y.general="ë‚ ì§œ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”"}return g(Y),Object.keys(Y).length===0},X=async Y=>{if(Y.preventDefault(),!(!W()||!r)){if(!B){alert("í¸ì§‘ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");return}f.current&&f.current.savePending();try{if(m){const ie=r._templateId;ie&&i(ie,{title:d.title,description:d.description,priority:d.priority,type:d.type,tags:d.tags,exceptions:d.exceptions})}else{const ie=!r.ownerId||r.ownerId===l?.uid,de=ie?y:r.visibility?.isPersonal??!0,be=ie?v:r.visibility?.isShared??!0,fe={title:d.title.trim(),description:d.description.trim()||"",priority:d.priority,type:d.type,tags:d.tags,visibility:{isPersonal:de,isShared:be},...ie?{sharedWith:be?b:[],sharedGroupId:be?D:null,sharedGroupOwnerId:be?T:null}:{}};if(d.startDate)try{fe.startDate=new Date(d.startDate)}catch(E){throw console.error("ìˆ˜ì •: ì‹œì‘ì¼ íŒŒì‹± ì˜¤ë¥˜:",E),new Error("ì‹œì‘ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤")}else fe.startDate=null;if(d.startTime&&(fe.startTime=d.startTime),fe.showStartTime=d.showStartTime,fe.showDueTime=d.showDueTime,d.dueDate)try{const E=d.dueDate,ee=d.dueTime||"23:59",Q=`${E}T${ee}:00`;fe.dueDate=new Date(Q)}catch(E){throw console.error("ìˆ˜ì •: ë§ˆê°ì¼ íŒŒì‹± ì˜¤ë¥˜:",E),new Error(`ë§ˆê°ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ${d.dueDate} ${d.dueTime||""}`)}else fe.dueDate=null;d.type==="project"&&(fe.project=d.project),await n(r.id,fe)}e()}catch(ie){console.error("í• ì¼ ìˆ˜ì • ì‹¤íŒ¨:",ie),g({general:"í• ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}}},V=(Y,ie)=>{u(de=>({...de,[Y]:ie})),h[Y]&&g(de=>({...de,[Y]:""}))},ce=()=>{u(Y=>({...Y,exceptions:[...Y.exceptions,{type:"date",values:[]}]}))},ke=Y=>{u(ie=>({...ie,exceptions:ie.exceptions.filter((de,be)=>be!==Y)}))},Se=(Y,ie,de)=>{u(be=>({...be,exceptions:be.exceptions.map((fe,E)=>E===Y?{...fe,[ie]:de}:fe)}))},me=(Y,ie)=>{u(de=>({...de,exceptions:de.exceptions.map((be,fe)=>fe===Y?{...be,values:ie}:be)}))};if(!t||!r)return null;const ue=[{value:1,label:"ì›”ìš”ì¼"},{value:2,label:"í™”ìš”ì¼"},{value:3,label:"ìˆ˜ìš”ì¼"},{value:4,label:"ëª©ìš”ì¼"},{value:5,label:"ê¸ˆìš”ì¼"},{value:6,label:"í† ìš”ì¼"},{value:0,label:"ì¼ìš”ì¼"}];return Ur.createPortal(a.jsxs("div",{className:`fixed inset-0 z-50 flex items-center justify-center ${s?"":"p-4"}`,children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:e}),a.jsxs("div",{className:`relative z-10 bg-white dark:bg-gray-800 shadow-xl flex flex-col ${s?"w-full h-full fixed inset-0":"w-full max-w-2xl max-h-[90vh] rounded-lg"}`,children:[a.jsxs("div",{className:`flex-shrink-0 flex items-center justify-between border-b border-gray-200 dark:border-gray-700 ${s?"px-4 py-3":"p-6"}`,children:[a.jsxs("h2",{className:`font-semibold text-gray-900 dark:text-white ${s?"text-lg":"text-xl"}`,children:["í• ì¼ ìˆ˜ì • ",m?"(ë°˜ë³µ í• ì¼)":""]}),a.jsx("button",{onClick:e,className:`hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg ${s?"p-3":"p-2"}`,children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:X,className:"flex flex-col flex-1 min-h-0 overflow-hidden",children:[a.jsx("div",{className:`flex-1 overflow-y-auto min-h-0 ${s?"px-4 py-4":"p-6"}`,children:a.jsxs("div",{className:`${s?"space-y-4":"space-y-6"}`,children:[h.general&&a.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:h.general}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(qg,{className:"w-4 h-4 inline mr-1"}),"ì œëª© *"]}),a.jsx("input",{type:"text",value:d.title,onChange:Y=>V("title",Y.target.value),disabled:!B,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white disabled:opacity-60 disabled:cursor-not-allowed ${h.title?"border-red-500":"border-gray-300 dark:border-gray-600"}`,placeholder:"í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"}),h.title&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.title})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ì„¤ëª…"}),a.jsx("textarea",{value:d.description,onChange:Y=>V("description",Y.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"í• ì¼ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(Jl,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ìœ í˜•"]}),a.jsxs("select",{value:d.type,onChange:Y=>V("type",Y.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"simple",children:"ë‹¨ì¼ íƒœìŠ¤í¬"}),a.jsx("option",{value:"project",children:"í”„ë¡œì íŠ¸"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(pa,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ìš°ì„ ìˆœìœ„"]}),a.jsxs("select",{value:d.priority,onChange:Y=>V("priority",Y.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"low",children:"ë‚®ìŒ"}),a.jsx("option",{value:"medium",children:"ë³´í†µ"}),a.jsx("option",{value:"high",children:"ë†’ìŒ"}),a.jsx("option",{value:"urgent",children:"ê¸´ê¸‰"})]})]})]}),d.type==="project"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"í”„ë¡œì íŠ¸ êµ¬ë¶„"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"shortterm",checked:d.project==="shortterm",onChange:Y=>V("project",Y.target.value),className:"mr-2"}),"ìˆí…€ í”„ë¡œì íŠ¸"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"longterm",checked:d.project==="longterm",onChange:Y=>V("project",Y.target.value),className:"mr-2"}),"ë¡±í…€ í”„ë¡œì íŠ¸"]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(at,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ì‹œì‘ ë‚ ì§œ"]}),a.jsx("input",{type:"date",value:d.startDate,onChange:Y=>V("startDate",Y.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(gr,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ì‹œì‘ ì‹œê°„"]}),a.jsx("input",{type:"time",value:d.startTime,onChange:Y=>V("startTime",Y.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(at,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ë§ˆê° ë‚ ì§œ"]}),a.jsx("input",{type:"date",value:d.dueDate,onChange:Y=>V("dueDate",Y.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(gr,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ë§ˆê° ì‹œê°„"]}),a.jsx("input",{type:"time",value:d.dueTime,onChange:Y=>V("dueTime",Y.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),a.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:d.showStartTime,onChange:Y=>V("showStartTime",Y.target.checked),className:"mr-2"}),a.jsx(gr,{className:"w-4 h-4 inline mr-1"}),"ì‹œì‘ì‹œê°„ í‘œì‹œ"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:d.showDueTime,onChange:Y=>V("showDueTime",Y.target.checked),className:"mr-2"}),a.jsx(gr,{className:"w-4 h-4 inline mr-1"}),"ë§ˆê°ì‹œê°„ í‘œì‹œ"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"íƒœê·¸"}),a.jsx("input",{type:"text",value:d.tags.join(", "),onChange:Y=>V("tags",Y.target.value.split(",").map(ie=>ie.trim()).filter(ie=>ie)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"íƒœê·¸ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì—…ë¬´, ê°œì¸, ì¤‘ìš”)"})]}),d.type==="project"&&r&&!m&&a.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:a.jsx(zc,{ref:f,todoId:r.id,subTasks:r.subTasks||[]})}),m&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a.jsx(Zl,{className:"w-4 h-4 inline mr-1"}),"ì˜ˆì™¸ ì„¤ì • (ë°˜ë³µì—ì„œ ì œì™¸í•  ì¡°ê±´)"]}),a.jsxs("button",{type:"button",onClick:ce,className:"flex items-center gap-1 px-2 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/30",children:[a.jsx(ct,{className:"w-3 h-3"}),"ì˜ˆì™¸ ì¶”ê°€"]})]}),d.exceptions.map((Y,ie)=>a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("select",{value:Y.type,onChange:de=>Se(ie,"type",de.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"date",children:"íŠ¹ì • ë‚ ì§œ"}),a.jsx("option",{value:"weekday",children:"íŠ¹ì • ìš”ì¼"}),a.jsx("option",{value:"week",children:"íŠ¹ì • ì£¼"}),a.jsx("option",{value:"month",children:"íŠ¹ì • ë‹¬"})]}),a.jsx("button",{type:"button",onClick:()=>ke(ie),className:"ml-2 p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[Y.type==="date"&&Array.from({length:31},(de,be)=>be+1).map(de=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:Y.values.includes(de),onChange:be=>{const fe=Y.values,E=be.target.checked?[...fe,de]:fe.filter(ee=>ee!==de);me(ie,E)},className:"text-sm"}),a.jsxs("span",{className:"text-xs",children:[de,"ì¼"]})]},de)),Y.type==="weekday"&&ue.map(de=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:Y.values.includes(de.value),onChange:be=>{const fe=Y.values,E=be.target.checked?[...fe,de.value]:fe.filter(ee=>ee!==de.value);me(ie,E)},className:"text-sm"}),a.jsx("span",{className:"text-xs",children:de.label})]},de.value)),Y.type==="week"&&[1,2,3,4,-1].map(de=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:Y.values.includes(de),onChange:be=>{const fe=Y.values,E=be.target.checked?[...fe,de]:fe.filter(ee=>ee!==de);me(ie,E)},className:"text-sm"}),a.jsx("span",{className:"text-xs",children:Fi(de)})]},de)),Y.type==="month"&&Array.from({length:12},(de,be)=>be+1).map(de=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:Y.values.includes(de),onChange:be=>{const fe=Y.values,E=be.target.checked?[...fe,de]:fe.filter(ee=>ee!==de);me(ie,E)},className:"text-sm"}),a.jsxs("span",{className:"text-xs",children:[de,"ì›”"]})]},de))]}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:Y.values.length>0&&a.jsxs("span",{children:["ì„ íƒëœ ",Y.type==="date"?"ë‚ ì§œ":Y.type==="weekday"?"ìš”ì¼":Y.type==="week"?"ì£¼ì°¨":"ì›”",": ",Y.values.join(", ")]})})]},ie))]}),!m&&(!r?.ownerId||r.ownerId===l?.uid)&&a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:c("sharing.settingsTitle")}),a.jsxs("div",{className:"flex space-x-4 mb-3",children:[a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:y,onChange:Y=>w(Y.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c("sharing.myTask")})]}),a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v,onChange:Y=>k(Y.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c("sharing.sharedTask")})]})]}),v&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:c("sharing.selectTarget")}),a.jsxs("select",{value:D||"",onChange:Y=>{const ie=Y.target.value;if(ie){const de=P.find(be=>be.id===ie);de&&(j(de.members||[]),de.isReference?(N(de.originalGroupId||null),_(de.originalOwnerId||null)):(N(ie),_(l?.uid||null)))}else j([]),N(null),_(null)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm",children:[a.jsx("option",{value:"",children:c("sharing.selectTargetPlaceholder")}),P.map(Y=>a.jsxs("option",{value:Y.id,children:["ğŸ‘¥ ",Y.name," (",Y.members.length,"ëª…)"]},Y.id))]}),P.length===0&&a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ğŸ’¡ ",c("sharing.noGroups")]})]}),b.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(Y=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full text-xs text-gray-600 dark:text-gray-300",children:[a.jsx("span",{className:"w-4 h-4 rounded-full bg-gray-100 dark:bg-gray-600 flex items-center justify-center text-[10px] font-bold",children:Y.displayName?.[0]||Y.email[0].toUpperCase()}),Y.displayName||Y.email.split("@")[0]]},Y.uid))})]})]})]})}),a.jsxs("div",{className:"flex-none flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 z-10 rounded-b-2xl",children:[z&&a.jsx("button",{type:"button",onClick:()=>{window.confirm("ì •ë§ë¡œ ì´ í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(o(r.id),e())},className:"px-5 py-2.5 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors mr-auto",children:"ì‚­ì œ"}),a.jsx("button",{type:"button",onClick:e,className:"px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",children:B?"ì·¨ì†Œ":"ë‹«ê¸°"}),B&&a.jsxs("button",{type:"submit",className:`flex items-center gap-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 ${s?"px-6 py-3":"px-4 py-2"}`,children:[a.jsx(ei,{className:"w-4 h-4"}),"ì €ì¥"]})]})]})]})]}),document.body)},a_=({currentDate:t,onDateChange:e,searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,onAddTodo:u,isMobile:h=!1})=>{const{t:g,i18n:m}=Xe(),x=m.language==="ko"?dn:sn,{currentTheme:f,isDark:y}=Et(),w=!!f.bg,[v,k]=p.useState({}),[b,j]=p.useState(null),[D,N]=p.useState(!1),[T,_]=p.useState(!1),[P,C]=p.useState([]),[A,B]=p.useState(null),[z,W]=p.useState([]),{getFilteredTodos:X,toggleTodo:V,deleteTodo:ce}=ot(),{currentUser:ke}=bt(),{showVacationsInTodos:Se,getVacationsForDate:me,employees:ue}=cn(),{getCustomHoliday:Y}=nn(),ie=p.useMemo(()=>{const I=as(t,{weekStartsOn:0}),J=is(t,{weekStartsOn:0});return pm({start:I,end:J})},[t]),de=p.useMemo(()=>Bx(t,{weekStartsOn:0}),[t]);p.useEffect(()=>{(()=>{const J={};ie.forEach(le=>{const L=cc(le),G=Y(le);G?J[le.toISOString().split("T")[0]]={date:le.toISOString().split("T")[0],name:G.name,isHoliday:!0,type:"custom"}:L&&(J[le.toISOString().split("T")[0]]=L)}),k(J)})()},[ie]);const be=p.useMemo(()=>X({searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,includeCompleted:!0}),[r,s,n,i,o,l,c,d,X]),fe=I=>{const J=be.filter(L=>{if(L.completed&&L.completedAt)return Ut(L.completedAt,I);if(!L.completed){const G=L.startDate?new Date(L.startDate):null,O=L.dueDate?new Date(L.dueDate):null;if(G&&O){const se=new Date(I);return G.setHours(0,0,0,0),O.setHours(0,0,0,0),se.setHours(0,0,0,0),se.getTime()>=G.getTime()&&se.getTime()<=O.getTime()}if(G&&!O){const se=new Date(I);G.setHours(0,0,0,0),se.setHours(0,0,0,0);const he=new Date;return he.setHours(0,0,0,0),se.getTime()===G.getTime()?!0:se.getTime()>G.getTime()&&se.getTime()<=he.getTime()?!L.completed:!1}return!G&&O?Ut(O,I):!1}return!1}),le={urgent:0,high:1,medium:2,low:3};return J.sort((L,G)=>{const O=le[L.priority]-le[G.priority];if(O!==0)return O;const se=L.order||0,he=G.order||0;return se!==he?se-he:new Date(L.createdAt).getTime()-new Date(G.createdAt).getTime()})},E=()=>{e(An(t))},ee=()=>{e(ym(t,1))},Q=()=>{e(new Date)},H=Zi({onSwipeLeft:ee,onSwipeRight:E},{minSwipeDistance:60});return a.jsxs("div",{className:"space-y-4",...h?{onTouchStart:H.onTouchStart,onTouchMove:H.onTouchMove,onTouchEnd:H.onTouchEnd}:{},children:[a.jsxs("div",{className:`flex items-center ${h?"flex-col gap-2":"justify-between"}`,children:[a.jsxs("div",{className:`flex items-center ${h?"w-full justify-between":"gap-4"}`,children:[a.jsxs("h2",{className:`${h?"text-base":"text-xl"} font-semibold text-gray-900 dark:text-white ${h?"flex-1 text-center min-w-0":""}`,children:[qe(t,m.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:x})," ",de,g("calendar.week")]}),a.jsxs("div",{className:`flex items-center ${h?"gap-1":"gap-2"}`,children:[a.jsx("button",{onClick:E,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:g("calendar.prevWeek"),children:a.jsx(ec,{className:`${h?"w-3 h-3":"w-4 h-4"}`})}),a.jsx("button",{onClick:Q,className:`${h?"px-2 py-1 text-xs":"px-3 py-1 text-sm"} bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/40`,children:g("calendar.thisWeek")}),a.jsx("button",{onClick:ee,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:g("calendar.nextWeek"),children:a.jsx(gs,{className:`${h?"w-3 h-3":"w-4 h-4"}`})})]})]}),!h&&a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[qe(ie[0],m.language==="ko"?"Mì›” dì¼":"MMM d",{locale:x})," - ",qe(ie[6],m.language==="ko"?"Mì›” dì¼":"MMM d",{locale:x})]})]}),a.jsx("div",{className:`grid grid-cols-7 rounded-lg border overflow-hidden ${w?"glass-card backdrop-blur-none border-white/20":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}`,style:w?{backgroundColor:`rgba(${y?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:ie.map((I,J)=>{const le=fe(I);le.filter(re=>re.completed).length,le.length;const L=I.toISOString().split("T")[0],G=v[L],O=Br(I),se=sl(I),pe=Hr(ke?.email)&&Se?me(I):[];return a.jsxs("div",{className:"border-r border-gray-200 dark:border-gray-700 last:border-r-0 relative flex flex-col",children:[a.jsxs("div",{className:`${h?"p-1":"p-2"} border-b border-gray-200 dark:border-gray-700 text-center cursor-pointer hover:bg-opacity-80 transition-colors ${se?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":G||O?"bg-red-50 dark:bg-red-900/20":"bg-gray-50 dark:bg-gray-700/50"}`,onClick:()=>{C(le),W(pe),B(I),_(!0)},children:[a.jsx("div",{className:`text-xs font-medium mb-1 ${G||O?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"}`,children:qe(I,"E",{locale:x})}),a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:`text-lg font-semibold ${se?"text-blue-700 dark:text-blue-300":G||O?"text-red-700 dark:text-red-300":"text-gray-900 dark:text-white"}`,children:qe(I,"d")}),G&&!h&&a.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 font-medium ml-1",children:G.name})]})]}),a.jsxs("div",{className:`${h?"px-0.5 py-1 min-h-[150px] space-y-0.5":"p-2 min-h-[200px] space-y-1"} flex-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors`,onClick:re=>{C(le),W(pe),B(I),_(!0)},children:[pe.slice(0,Math.max(0,8-le.length)).map(re=>{const Ae=ue.find(K=>K.id===re.employeeId);return a.jsx("div",{className:`${h?"p-1 text-[9px]":"p-2 text-xs"} rounded border cursor-pointer hover:shadow-md transition-all ${re.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30":re.type==="ì˜¤ì „"||re.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30":re.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30":re.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800 hover:bg-yellow-100 dark:hover:bg-yellow-900/30"}`,title:Ae?`${Ae.name} - ${re.type}`:`ì§ì› ${re.employeeId} - ${re.type}`,children:a.jsx("div",{className:"truncate",children:h?`${re.type}`:Ae?`${Ae.name} ${re.type}`:`ì§ì›${re.employeeId} ${re.type}`})},`vacation-${re.id}`)}),le.slice(0,Math.max(0,8-pe.length)).map(re=>a.jsxs("div",{className:`group relative ${h?"p-1":"p-2"} rounded ${h?"text-[10px]":"text-xs"} border cursor-pointer hover:shadow-md transition-all ${re.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":re.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":re.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800 hover:bg-orange-100 dark:hover:bg-orange-900/30":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30"}`,onClick:Ae=>{Ae.stopPropagation(),j(re),N(!0)},children:[a.jsx("div",{className:`font-medium truncate ${h?"text-[10px]":"text-xs"} ${re.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:re.title}),a.jsxs("div",{className:`${h?"text-[9px]":"text-xs"} text-gray-500 dark:text-gray-400 ${h?"mt-0.5":"mt-1"}`,children:[re.showStartTime&&re.startTime&&a.jsxs("span",{children:[g("calendar.start"),": ",re.startTime]}),re.showStartTime&&re.startTime&&re.showDueTime&&re.dueDate&&new Date(re.dueDate).getHours()!==23&&new Date(re.dueDate).getMinutes()!==59&&a.jsx("span",{children:" | "}),re.showDueTime&&re.dueDate&&(()=>{const Ae=new Date(re.dueDate);return Ae.getHours()===23&&Ae.getMinutes()===59?null:a.jsxs("span",{children:[g("calendar.due"),": ",Ae.toTimeString().slice(0,5)]})})()]}),a.jsxs("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[a.jsx("button",{onClick:Ae=>{Ae.stopPropagation(),V(re.id)},className:"p-1.5 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-700",title:re.completed?g("calendar.completedCancel"):g("calendar.complete"),children:a.jsx("div",{className:`w-3 h-3 rounded-full ${re.completed?"bg-green-600":"border border-gray-400"}`})}),a.jsx("button",{onClick:Ae=>{Ae.stopPropagation(),confirm(g("calendar.deleteConfirm"))&&ce(re.id)},className:"p-1.5 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-900/30",title:g("common.delete"),children:a.jsx($t,{className:"w-3 h-3 text-red-600"})})]})]},re.id)),le.length+pe.length>8&&a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center py-1 cursor-pointer hover:text-blue-600",onClick:re=>{re.stopPropagation(),C(le),W(pe),B(I),_(!0)},children:["+",le.length+pe.length-8,g("calendar.more")]}),a.jsx("button",{onClick:re=>{re.stopPropagation(),u(I)},className:`w-full ${h?"h-6":"h-8"} border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center text-gray-400 hover:border-blue-400 hover:text-blue-400 transition-colors`,title:g("modal.addTodo.title"),children:a.jsx(ct,{className:`${h?"w-2.5 h-2.5":"w-3 h-3"}`})})]}),G&&h&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0",children:a.jsx("div",{className:"text-[9px] text-red-600 dark:text-red-400 font-medium text-center bg-red-50 dark:bg-red-900/20 py-0.5 leading-tight",children:G.name})})]},J)})}),ie.some(I=>{const J=fe(I),L=Hr(ke?.email)&&Se?me(I):[];return J.length>0||L.length>0})&&a.jsxs("div",{className:"mt-8",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:g("calendar.detailedInfo")}),a.jsx("div",{className:"space-y-2",children:ie.map(I=>{const J=fe(I),L=Hr(ke?.email)&&Se?me(I):[];return J.length===0&&L.length===0?null:a.jsxs("div",{children:[a.jsxs("h4",{className:"text-md font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[a.jsx(at,{className:"w-4 h-4"}),qe(I,m.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:x}),sl(I)&&a.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded",children:g("calendar.today")})]}),a.jsxs("div",{className:"space-y-2",children:[L.map(G=>{const O=ue.find(se=>se.id===G.employeeId);return a.jsx("div",{className:`p-3 rounded-lg border cursor-pointer hover:shadow-md transition-all ${G.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":G.type==="ì˜¤ì „"||G.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":G.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":G.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[O&&a.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:O.color},children:O.name.charAt(0)}),a.jsx("div",{className:"flex-1 truncate",children:a.jsx("div",{className:`font-medium text-gray-900 dark:text-white truncate ${h?"text-sm":"text-base"}`,children:O?O.name:`ì§ì› ${G.employeeId}`})}),a.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${G.type==="ì—°ì°¨"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":G.type==="ì˜¤ì „"||G.type==="ì˜¤í›„"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":G.type==="íŠ¹ë³„"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":G.type==="ë³‘ê°€"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:G.type})]})},`vacation-${G.id}`)}),J.map(G=>a.jsx(Wr,{todo:G},G.id))]})]},I.toISOString())})})]}),b&&a.jsx(Kc,{isOpen:D,onClose:()=>{N(!1),j(null)},todo:b,isMobile:h}),T&&A&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>_(!1),children:a.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-xl ${h?"w-[90vw] max-h-[80vh]":"w-[500px] max-h-[600px]"} overflow-hidden`,onClick:I=>I.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[qe(A,m.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:x}),a.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",P.length+z.length,"ê°œ)"]})]}),a.jsx("button",{onClick:()=>_(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"p-4 overflow-y-auto max-h-[500px]",children:P.length>0||z.length>0?a.jsxs("div",{className:"space-y-3",children:[z.map(I=>{const J=ue.find(le=>le.id===I.employeeId);return a.jsx("div",{className:`p-2 rounded border ${I.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":I.type==="ì˜¤ì „"||I.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":I.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":I.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[J&&a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:J.color},children:J.name.charAt(0)}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:J?J.name:`ì§ì› ${I.employeeId}`})}),a.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${I.type==="ì—°ì°¨"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":I.type==="ì˜¤ì „"||I.type==="ì˜¤í›„"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":I.type==="íŠ¹ë³„"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":I.type==="ë³‘ê°€"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:I.type})]})},`vacation-${I.id}`)}),P.map(I=>a.jsx("div",{className:`p-2 rounded border cursor-pointer hover:shadow-md transition-all ${I.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":I.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":I.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,onClick:()=>{j(I),N(!0),_(!1)},children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:`font-medium truncate ${I.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:I.title}),(I.showStartTime&&I.startTime||I.showDueTime&&I.dueDate)&&a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[I.showStartTime&&I.startTime&&a.jsxs("span",{children:[g("calendar.start"),": ",I.startTime]}),I.showStartTime&&I.startTime&&I.showDueTime&&I.dueDate&&(()=>{const J=new Date(I.dueDate);return J.getHours()===23&&J.getMinutes()===59?null:a.jsx("span",{children:" | "})})(),I.showDueTime&&I.dueDate&&(()=>{const J=new Date(I.dueDate);return J.getHours()===23&&J.getMinutes()===59?null:a.jsxs("span",{children:[g("calendar.due"),": ",J.toTimeString().slice(0,5)]})})()]})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[I.type==="project"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${I.project==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400"}`,children:I.project==="longterm"?g("projectTemplate.longterm")||"Long-term":g("projectTemplate.shortterm")||"Short-term"}),I.priority&&I.priority!=="medium"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${I.priority==="urgent"?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":I.priority==="high"?"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400":"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}`,children:I.priority==="urgent"?g("modal.addTodo.urgent"):I.priority==="high"?g("modal.addTodo.high"):g("modal.addTodo.low")}),a.jsx("button",{onClick:J=>{J.stopPropagation(),V(I.id)},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-600 border border-gray-200 dark:border-gray-600",title:I.completed?g("calendar.completedCancel"):g("calendar.complete"),children:a.jsx("div",{className:`w-3 h-3 rounded-full ${I.completed?"bg-green-600":"border border-gray-400"}`})}),a.jsx("button",{onClick:J=>{J.stopPropagation(),confirm(g("calendar.deleteConfirm"))&&(ce(I.id),P.filter(le=>le.id!==I.id))},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-800 border border-gray-200 dark:border-gray-600",title:g("common.delete"),children:a.jsx($t,{className:"w-3 h-3 text-red-600"})})]})]})},I.id))]}):a.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:g("calendar.noTasks")})}),a.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[a.jsxs("button",{onClick:()=>{A&&(u(A),_(!1))},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",title:g("modal.addTodo.title"),children:[a.jsx(ct,{className:"w-4 h-4"}),g("common.addTodo")]}),a.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:g("calendar.close")})]})]})})]})},i_=({currentDate:t,onDateChange:e,searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,onAddTodo:u,isMobile:h=!1})=>{const{t:g,i18n:m}=Xe(),{currentTheme:x,isDark:f}=Et(),y=!!x.bg,w=m.language==="ko"?dn:sn,[v,k]=p.useState({}),[b,j]=p.useState(null),[D,N]=p.useState(!1),[T,_]=p.useState(!1),[P,C]=p.useState([]),[A,B]=p.useState(null),[z,W]=p.useState([]),{getFilteredTodos:X,toggleTodo:V,deleteTodo:ce}=ot(),{currentUser:ke}=bt(),{showVacationsInTodos:Se,getVacationsForDate:me,employees:ue}=cn(),{getCustomHoliday:Y}=nn(),ie=Ha(t),de=nl(ie),be=as(ie,{weekStartsOn:0}),fe=is(de,{weekStartsOn:0}),E=p.useMemo(()=>pm({start:be,end:fe}),[be,fe]);p.useEffect(()=>{(()=>{const se={};E.forEach(he=>{const pe=cc(he),re=Y(he);re?se[he.toISOString().split("T")[0]]={date:he.toISOString().split("T")[0],name:re.name,isHoliday:!0,type:"custom"}:pe&&(se[he.toISOString().split("T")[0]]=pe)}),k(se)})()},[E]);const ee=p.useMemo(()=>X({searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,includeCompleted:!0}),[r,s,n,i,o,l,c,d,X]),Q=O=>{const se=ee.filter(pe=>{if(pe.completed&&pe.completedAt)return Ut(pe.completedAt,O);if(!pe.completed){const re=pe.startDate?new Date(pe.startDate):null,Ae=pe.dueDate?new Date(pe.dueDate):null;if(re&&Ae){const K=new Date(O);return re.setHours(0,0,0,0),Ae.setHours(0,0,0,0),K.setHours(0,0,0,0),K.getTime()>=re.getTime()&&K.getTime()<=Ae.getTime()}if(re&&!Ae){const K=new Date(O);re.setHours(0,0,0,0),K.setHours(0,0,0,0);const xe=new Date;return xe.setHours(0,0,0,0),K.getTime()===re.getTime()?!0:K.getTime()>re.getTime()&&K.getTime()<=xe.getTime()?!pe.completed:!1}return!re&&Ae?Ut(Ae,O):!1}return!1}),he={urgent:0,high:1,medium:2,low:3};return se.sort((pe,re)=>{const Ae=he[pe.priority]-he[re.priority];if(Ae!==0)return Ae;const K=pe.order||0,xe=re.order||0;return K!==xe?K-xe:new Date(pe.createdAt).getTime()-new Date(re.createdAt).getTime()})},H=()=>{e(si(t))},I=()=>{e(xm(t,1))},J=()=>{e(new Date)},le=Zi({onSwipeLeft:I,onSwipeRight:H},{minSwipeDistance:60}),L=y?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",G=y?{backgroundColor:`rgba(${f?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{};return a.jsxs("div",{className:"space-y-4",...h?{onTouchStart:le.onTouchStart,onTouchMove:le.onTouchMove,onTouchEnd:le.onTouchEnd}:{},children:[a.jsx("div",{className:`flex items-center ${h?"flex-col gap-2":"justify-between"}`,children:a.jsxs("div",{className:`flex items-center ${h?"w-full justify-between":"gap-4"}`,children:[a.jsx("h2",{className:`${h?"text-base":"text-xl"} font-semibold text-gray-900 dark:text-white ${h?"flex-1 text-center min-w-0":""}`,children:qe(t,m.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:w})}),a.jsxs("div",{className:`flex items-center ${h?"gap-1":"gap-2"}`,children:[a.jsx("button",{onClick:H,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:"ì´ì „ ë‹¬",children:a.jsx(ec,{className:`${h?"w-3 h-3":"w-4 h-4"}`})}),a.jsx("button",{onClick:J,className:`${h?"px-2 py-1 text-xs":"px-3 py-1 text-sm"} bg-primary-100 text-primary-700 dark:bg-primary-900/20 dark:text-primary-300 rounded-lg hover:bg-primary-200 dark:hover:bg-primary-900/40`,children:g("calendar.thisMonth",{defaultValue:"This Month"})}),a.jsx("button",{onClick:I,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:"ë‹¤ìŒ ë‹¬",children:a.jsx(gs,{className:`${h?"w-3 h-3":"w-4 h-4"}`})})]})]})}),a.jsxs("div",{className:`${L} rounded-lg border overflow-hidden`,style:G,children:[a.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700",children:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].map((O,se)=>a.jsx("div",{className:`text-center py-2 text-sm font-medium ${se===0?"text-red-600 dark:text-red-400":se===6?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"}`,children:g(`days.${O}`)},O))}),a.jsx("div",{className:"grid grid-cols-7",children:E.map((O,se)=>{const he=Q(O),pe=O.toISOString().split("T")[0],re=v[pe],Ae=Br(O),K=sl(O),xe=Hx(O,t),q=Hr(ke?.email)&&Se?me(O):[];return a.jsxs("div",{className:`min-h-[100px] border-b border-r border-gray-200 dark:border-gray-700 relative ${xe?"":"bg-gray-50/50 dark:bg-gray-900/20"} ${se%7===6?"border-r-0":""} hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors cursor-pointer`,onClick:()=>{C(he),W(q),B(O),_(!0)},children:[a.jsxs("div",{className:`p-1 text-right ${xe?"":"opacity-30"}`,children:[a.jsx("span",{className:`inline-block w-6 h-6 text-center leading-6 rounded-full text-sm ${K?"bg-blue-600 text-white":re||Ae&&ri(O)===0?"text-red-600 dark:text-red-400 font-medium":Ae&&ri(O)===6?"text-blue-600 dark:text-blue-400 font-medium":"text-gray-700 dark:text-gray-300"}`,children:qe(O,"d")}),re&&a.jsx("div",{className:"text-[10px] text-red-600 dark:text-red-400 font-medium truncate px-1",children:re.name})]}),a.jsxs("div",{className:"px-1 pb-1 space-y-0.5",children:[q.slice(0,3).map(we=>{const Be=ue.find(S=>S.id===we.employeeId);return a.jsxs("div",{className:`px-1.5 py-1 text-[10px] rounded-md truncate border shadow-sm transition-all hover:scale-[1.02] ${we.type==="ì—°ì°¨"?"bg-green-50/90 text-green-700 border-green-200/60 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800/40":we.type==="ì˜¤ì „"||we.type==="ì˜¤í›„"?"bg-blue-50/90 text-blue-700 border-blue-200/60 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800/40":we.type==="íŠ¹ë³„"?"bg-purple-50/90 text-purple-700 border-purple-200/60 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-800/40":we.type==="ë³‘ê°€"?"bg-red-50/90 text-red-700 border-red-200/60 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800/40":"bg-yellow-50/90 text-yellow-700 border-yellow-200/60 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800/40"}`,title:Be?`${Be.name} - ${we.type}`:`ì§ì› ${we.employeeId} - ${we.type}`,children:[Be?Be.name:`ì§ì›${we.employeeId}`," ",we.type]},`vacation-${we.id}`)}),he.slice(0,Math.max(0,3-q.length)).map(we=>a.jsx("div",{className:`px-1.5 py-1 text-[10px] rounded-md truncate cursor-pointer border shadow-sm transition-all hover:scale-[1.02] ${we.completed?"bg-gray-100/80 text-gray-400 border-gray-200/60 line-through dark:bg-gray-700/50 dark:text-gray-500 dark:border-gray-600/30":we.priority==="urgent"?"bg-red-50/90 text-red-700 border-red-200/60 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800/40":we.priority==="high"?"bg-orange-50/90 text-orange-700 border-orange-200/60 dark:bg-orange-900/30 dark:text-orange-300 dark:border-orange-800/40":"bg-primary-50/90 text-primary-700 border-primary-200/60 dark:bg-primary-900/30 dark:text-primary-300 dark:border-primary-800/40"}`,onClick:Be=>{Be.stopPropagation(),j(we),N(!0)},children:we.title},we.id)),he.length+q.length>3&&a.jsxs("div",{className:"text-[10px] text-gray-500 dark:text-gray-400 text-center",children:["+",he.length+q.length-3,"ê°œ"]})]})]},O.toISOString())})})]}),b&&a.jsx(Kc,{isOpen:D,onClose:()=>{N(!1),j(null)},todo:b,isMobile:h}),T&&A&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>_(!1),children:a.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-xl ${h?"w-[90vw] max-h-[80vh]":"w-[500px] max-h-[600px]"} overflow-hidden`,onClick:O=>O.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[qe(A,m.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:w}),a.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",P.length+z.length,"ê°œ)"]})]}),a.jsx("button",{onClick:()=>_(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"p-4 overflow-y-auto max-h-[500px]",children:P.length>0||z.length>0?a.jsxs("div",{className:"space-y-3",children:[z.map(O=>{const se=ue.find(he=>he.id===O.employeeId);return a.jsx("div",{className:`p-2 rounded border ${O.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":O.type==="ì˜¤ì „"||O.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":O.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":O.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[se&&a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:se.color},children:se.name.charAt(0)}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:se?se.name:`ì§ì› ${O.employeeId}`})}),a.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${O.type==="ì—°ì°¨"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":O.type==="ì˜¤ì „"||O.type==="ì˜¤í›„"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":O.type==="íŠ¹ë³„"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":O.type==="ë³‘ê°€"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:O.type})]})},`vacation-${O.id}`)}),P.map(O=>a.jsx("div",{className:`p-2 rounded border cursor-pointer hover:shadow-md transition-all ${O.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":O.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":O.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,onClick:()=>{j(O),N(!0),_(!1)},children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:`font-medium truncate ${O.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:O.title}),(O.showStartTime&&O.startTime||O.showDueTime&&O.dueDate)&&a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[O.showStartTime&&O.startTime&&a.jsxs("span",{children:[g("calendar.start"),": ",O.startTime]}),O.showStartTime&&O.startTime&&O.showDueTime&&O.dueDate&&(()=>{const se=new Date(O.dueDate);return se.getHours()===23&&se.getMinutes()===59?null:a.jsx("span",{children:" | "})})(),O.showDueTime&&O.dueDate&&(()=>{const se=new Date(O.dueDate);return se.getHours()===23&&se.getMinutes()===59?null:a.jsxs("span",{children:[g("calendar.due"),": ",se.toTimeString().slice(0,5)]})})()]})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[O.type==="project"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${O.project==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400"}`,children:O.project==="longterm"?g("projectTemplate.longterm")||"Long-term":g("projectTemplate.shortterm")||"Short-term"}),O.priority&&O.priority!=="medium"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${O.priority==="urgent"?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":O.priority==="high"?"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400":"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}`,children:O.priority==="urgent"?g("modal.addTodo.urgent"):O.priority==="high"?g("modal.addTodo.high"):g("modal.addTodo.low")}),a.jsx("button",{onClick:se=>{se.stopPropagation(),V(O.id)},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-600 border border-gray-200 dark:border-gray-600",title:O.completed?g("calendar.completedCancel"):g("calendar.complete"),children:a.jsx("div",{className:`w-3 h-3 rounded-full ${O.completed?"bg-green-600":"border border-gray-400"}`})}),a.jsx("button",{onClick:se=>{se.stopPropagation(),confirm(g("calendar.deleteConfirm"))&&(ce(O.id),P.filter(he=>he.id!==O.id))},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-800 border border-gray-200 dark:border-gray-600",title:g("common.delete"),children:a.jsx($t,{className:"w-3 h-3 text-red-600"})})]})]})},O.id))]}):a.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:g("calendar.noTasks")})}),a.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[a.jsxs("button",{onClick:()=>{A&&(u(A),_(!1))},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",title:g("modal.addTodo.title"),children:[a.jsx(ct,{className:"w-4 h-4"}),g("common.addTodo")]}),a.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:g("calendar.close")})]})]})})]})};function o_(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return p.useMemo(()=>s=>{e.forEach(n=>n(s))},e)}const eo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function un(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function Yc(t){return"nodeType"in t}function At(t){var e,r;return t?un(t)?t:Yc(t)&&(e=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?e:window:window}function qc(t){const{Document:e}=At(t);return t instanceof e}function ja(t){return un(t)?!1:t instanceof At(t).HTMLElement}function Ap(t){return t instanceof At(t).SVGElement}function hn(t){return t?un(t)?t.document:Yc(t)?qc(t)?t:ja(t)||Ap(t)?t.ownerDocument:document:document:document}const ir=eo?p.useLayoutEffect:p.useEffect;function to(t){const e=p.useRef(t);return ir(()=>{e.current=t}),p.useCallback(function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return e.current==null?void 0:e.current(...s)},[])}function l_(){const t=p.useRef(null),e=p.useCallback((s,n)=>{t.current=setInterval(s,n)},[]),r=p.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,r]}function la(t,e){e===void 0&&(e=[t]);const r=p.useRef(t);return ir(()=>{r.current!==t&&(r.current=t)},e),r}function _a(t,e){const r=p.useRef();return p.useMemo(()=>{const s=t(r.current);return r.current=s,s},[...e])}function Si(t){const e=to(t),r=p.useRef(null),s=p.useCallback(n=>{n!==r.current&&e?.(n,r.current),r.current=n},[]);return[r,s]}function ji(t){const e=p.useRef();return p.useEffect(()=>{e.current=t},[t]),e.current}let Ao={};function Da(t,e){return p.useMemo(()=>{if(e)return e;const r=Ao[t]==null?0:Ao[t]+1;return Ao[t]=r,t+"-"+r},[t,e])}function Rp(t){return function(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];return s.reduce((i,o)=>{const l=Object.entries(o);for(const[c,d]of l){const u=i[c];u!=null&&(i[c]=u+t*d)}return i},{...e})}}const Ks=Rp(1),_i=Rp(-1);function c_(t){return"clientX"in t&&"clientY"in t}function ro(t){if(!t)return!1;const{KeyboardEvent:e}=At(t.target);return e&&t instanceof e}function d_(t){if(!t)return!1;const{TouchEvent:e}=At(t.target);return e&&t instanceof e}function Di(t){if(d_(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:r}=t.touches[0];return{x:e,y:r}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:r}=t.changedTouches[0];return{x:e,y:r}}}return c_(t)?{x:t.clientX,y:t.clientY}:null}const Qr=Object.freeze({Translate:{toString(t){if(!t)return;const{x:e,y:r}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:e,scaleY:r}=t;return"scaleX("+e+") scaleY("+r+")"}},Transform:{toString(t){if(t)return[Qr.Translate.toString(t),Qr.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:r,easing:s}=t;return e+" "+r+"ms "+s}}}),hh="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function u_(t){return t.matches(hh)?t:t.querySelector(hh)}const h_={display:"none"};function g_(t){let{id:e,value:r}=t;return Ze.createElement("div",{id:e,style:h_},r)}function m_(t){let{id:e,announcement:r,ariaLiveType:s="assertive"}=t;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ze.createElement("div",{id:e,style:n,role:"status","aria-live":s,"aria-atomic":!0},r)}function f_(){const[t,e]=p.useState("");return{announce:p.useCallback(s=>{s!=null&&e(s)},[]),announcement:t}}const Pp=p.createContext(null);function p_(t){const e=p.useContext(Pp);p.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function y_(){const[t]=p.useState(()=>new Set),e=p.useCallback(s=>(t.add(s),()=>t.delete(s)),[t]);return[p.useCallback(s=>{let{type:n,event:i}=s;t.forEach(o=>{var l;return(l=o[n])==null?void 0:l.call(o,i)})},[t]),e]}const x_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},b_={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was moved over droppable area "+r.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was dropped over droppable area "+r.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function v_(t){let{announcements:e=b_,container:r,hiddenTextDescribedById:s,screenReaderInstructions:n=x_}=t;const{announce:i,announcement:o}=f_(),l=Da("DndLiveRegion"),[c,d]=p.useState(!1);if(p.useEffect(()=>{d(!0)},[]),p_(p.useMemo(()=>({onDragStart(h){let{active:g}=h;i(e.onDragStart({active:g}))},onDragMove(h){let{active:g,over:m}=h;e.onDragMove&&i(e.onDragMove({active:g,over:m}))},onDragOver(h){let{active:g,over:m}=h;i(e.onDragOver({active:g,over:m}))},onDragEnd(h){let{active:g,over:m}=h;i(e.onDragEnd({active:g,over:m}))},onDragCancel(h){let{active:g,over:m}=h;i(e.onDragCancel({active:g,over:m}))}}),[i,e])),!c)return null;const u=Ze.createElement(Ze.Fragment,null,Ze.createElement(g_,{id:s,value:n.draggable}),Ze.createElement(m_,{id:l,announcement:o}));return r?Ur.createPortal(u,r):u}var ut;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(ut||(ut={}));function Ci(){}function gh(t,e){return p.useMemo(()=>({sensor:t,options:e??{}}),[t,e])}function w_(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return p.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const or=Object.freeze({x:0,y:0});function k_(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function T_(t,e){const r=Di(t);if(!r)return"0 0";const s={x:(r.x-e.left)/e.width*100,y:(r.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function N_(t,e){let{data:{value:r}}=t,{data:{value:s}}=e;return r-s}function S_(t,e){let{data:{value:r}}=t,{data:{value:s}}=e;return s-r}function mh(t){let{left:e,top:r,height:s,width:n}=t;return[{x:e,y:r},{x:e+n,y:r},{x:e,y:r+s},{x:e+n,y:r+s}]}function j_(t,e){if(!t||t.length===0)return null;const[r]=t;return r[e]}const __=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:s}=t;const n=mh(e),i=[];for(const o of s){const{id:l}=o,c=r.get(l);if(c){const d=mh(c),u=n.reduce((g,m,x)=>g+k_(d[x],m),0),h=Number((u/4).toFixed(4));i.push({id:l,data:{droppableContainer:o,value:h}})}}return i.sort(N_)};function D_(t,e){const r=Math.max(e.top,t.top),s=Math.max(e.left,t.left),n=Math.min(e.left+e.width,t.left+t.width),i=Math.min(e.top+e.height,t.top+t.height),o=n-s,l=i-r;if(s<n&&r<i){const c=e.width*e.height,d=t.width*t.height,u=o*l,h=u/(c+d-u);return Number(h.toFixed(4))}return 0}const C_=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:s}=t;const n=[];for(const i of s){const{id:o}=i,l=r.get(o);if(l){const c=D_(l,e);c>0&&n.push({id:o,data:{droppableContainer:i,value:c}})}}return n.sort(S_)};function E_(t,e,r){return{...t,scaleX:e&&r?e.width/r.width:1,scaleY:e&&r?e.height/r.height:1}}function Mp(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:or}function I_(t){return function(r){for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];return n.reduce((o,l)=>({...o,top:o.top+t*l.y,bottom:o.bottom+t*l.y,left:o.left+t*l.x,right:o.right+t*l.x}),{...r})}}const A_=I_(1);function Op(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function R_(t,e,r){const s=Op(e);if(!s)return t;const{scaleX:n,scaleY:i,x:o,y:l}=s,c=t.left-o-(1-n)*parseFloat(r),d=t.top-l-(1-i)*parseFloat(r.slice(r.indexOf(" ")+1)),u=n?t.width/n:t.width,h=i?t.height/i:t.height;return{width:u,height:h,top:d,right:c+u,bottom:d+h,left:c}}const P_={ignoreTransform:!1};function gn(t,e){e===void 0&&(e=P_);let r=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:d,transformOrigin:u}=At(t).getComputedStyle(t);d&&(r=R_(r,d,u))}const{top:s,left:n,width:i,height:o,bottom:l,right:c}=r;return{top:s,left:n,width:i,height:o,bottom:l,right:c}}function fh(t){return gn(t,{ignoreTransform:!0})}function M_(t){const e=t.innerWidth,r=t.innerHeight;return{top:0,left:0,right:e,bottom:r,width:e,height:r}}function O_(t,e){return e===void 0&&(e=At(t).getComputedStyle(t)),e.position==="fixed"}function L_(t,e){e===void 0&&(e=At(t).getComputedStyle(t));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const i=e[n];return typeof i=="string"?r.test(i):!1})}function Xc(t,e){const r=[];function s(n){if(e!=null&&r.length>=e||!n)return r;if(qc(n)&&n.scrollingElement!=null&&!r.includes(n.scrollingElement))return r.push(n.scrollingElement),r;if(!ja(n)||Ap(n)||r.includes(n))return r;const i=At(t).getComputedStyle(n);return n!==t&&L_(n,i)&&r.push(n),O_(n,i)?r:s(n.parentNode)}return t?s(t):r}function Lp(t){const[e]=Xc(t,1);return e??null}function Ro(t){return!eo||!t?null:un(t)?t:Yc(t)?qc(t)||t===hn(t).scrollingElement?window:ja(t)?t:null:null}function $p(t){return un(t)?t.scrollX:t.scrollLeft}function Fp(t){return un(t)?t.scrollY:t.scrollTop}function jl(t){return{x:$p(t),y:Fp(t)}}var yt;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(yt||(yt={}));function Wp(t){return!eo||!t?!1:t===document.scrollingElement}function Vp(t){const e={x:0,y:0},r=Wp(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},s={x:t.scrollWidth-r.width,y:t.scrollHeight-r.height},n=t.scrollTop<=e.y,i=t.scrollLeft<=e.x,o=t.scrollTop>=s.y,l=t.scrollLeft>=s.x;return{isTop:n,isLeft:i,isBottom:o,isRight:l,maxScroll:s,minScroll:e}}const $_={x:.2,y:.2};function F_(t,e,r,s,n){let{top:i,left:o,right:l,bottom:c}=r;s===void 0&&(s=10),n===void 0&&(n=$_);const{isTop:d,isBottom:u,isLeft:h,isRight:g}=Vp(t),m={x:0,y:0},x={x:0,y:0},f={height:e.height*n.y,width:e.width*n.x};return!d&&i<=e.top+f.height?(m.y=yt.Backward,x.y=s*Math.abs((e.top+f.height-i)/f.height)):!u&&c>=e.bottom-f.height&&(m.y=yt.Forward,x.y=s*Math.abs((e.bottom-f.height-c)/f.height)),!g&&l>=e.right-f.width?(m.x=yt.Forward,x.x=s*Math.abs((e.right-f.width-l)/f.width)):!h&&o<=e.left+f.width&&(m.x=yt.Backward,x.x=s*Math.abs((e.left+f.width-o)/f.width)),{direction:m,speed:x}}function W_(t){if(t===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:r,right:s,bottom:n}=t.getBoundingClientRect();return{top:e,left:r,right:s,bottom:n,width:t.clientWidth,height:t.clientHeight}}function Up(t){return t.reduce((e,r)=>Ks(e,jl(r)),or)}function V_(t){return t.reduce((e,r)=>e+$p(r),0)}function U_(t){return t.reduce((e,r)=>e+Fp(r),0)}function Bp(t,e){if(e===void 0&&(e=gn),!t)return;const{top:r,left:s,bottom:n,right:i}=e(t);Lp(t)&&(n<=0||i<=0||r>=window.innerHeight||s>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const B_=[["x",["left","right"],V_],["y",["top","bottom"],U_]];class Qc{constructor(e,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Xc(r),n=Up(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,l]of B_)for(const c of o)Object.defineProperty(this,c,{get:()=>{const d=l(s),u=n[i]-d;return this.rect[c]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Vn{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...r)})},this.target=e}add(e,r,s){var n;(n=this.target)==null||n.addEventListener(e,r,s),this.listeners.push([e,r,s])}}function H_(t){const{EventTarget:e}=At(t);return t instanceof e?t:hn(t)}function Po(t,e){const r=Math.abs(t.x),s=Math.abs(t.y);return typeof e=="number"?Math.sqrt(r**2+s**2)>e:"x"in e&&"y"in e?r>e.x&&s>e.y:"x"in e?r>e.x:"y"in e?s>e.y:!1}var Kt;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Kt||(Kt={}));function ph(t){t.preventDefault()}function G_(t){t.stopPropagation()}var Ue;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(Ue||(Ue={}));const Hp={start:[Ue.Space,Ue.Enter],cancel:[Ue.Esc],end:[Ue.Space,Ue.Enter,Ue.Tab]},z_=(t,e)=>{let{currentCoordinates:r}=e;switch(t.code){case Ue.Right:return{...r,x:r.x+25};case Ue.Left:return{...r,x:r.x-25};case Ue.Down:return{...r,y:r.y+25};case Ue.Up:return{...r,y:r.y-25}}};class Gp{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:r}}=e;this.props=e,this.listeners=new Vn(hn(r)),this.windowListeners=new Vn(At(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Kt.Resize,this.handleCancel),this.windowListeners.add(Kt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Kt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:r}=this.props,s=e.node.current;s&&Bp(s),r(or)}handleKeyDown(e){if(ro(e)){const{active:r,context:s,options:n}=this.props,{keyboardCodes:i=Hp,coordinateGetter:o=z_,scrollBehavior:l="smooth"}=n,{code:c}=e;if(i.end.includes(c)){this.handleEnd(e);return}if(i.cancel.includes(c)){this.handleCancel(e);return}const{collisionRect:d}=s.current,u=d?{x:d.left,y:d.top}:or;this.referenceCoordinates||(this.referenceCoordinates=u);const h=o(e,{active:r,context:s.current,currentCoordinates:u});if(h){const g=_i(h,u),m={x:0,y:0},{scrollableAncestors:x}=s.current;for(const f of x){const y=e.code,{isTop:w,isRight:v,isLeft:k,isBottom:b,maxScroll:j,minScroll:D}=Vp(f),N=W_(f),T={x:Math.min(y===Ue.Right?N.right-N.width/2:N.right,Math.max(y===Ue.Right?N.left:N.left+N.width/2,h.x)),y:Math.min(y===Ue.Down?N.bottom-N.height/2:N.bottom,Math.max(y===Ue.Down?N.top:N.top+N.height/2,h.y))},_=y===Ue.Right&&!v||y===Ue.Left&&!k,P=y===Ue.Down&&!b||y===Ue.Up&&!w;if(_&&T.x!==h.x){const C=f.scrollLeft+g.x,A=y===Ue.Right&&C<=j.x||y===Ue.Left&&C>=D.x;if(A&&!g.y){f.scrollTo({left:C,behavior:l});return}A?m.x=f.scrollLeft-C:m.x=y===Ue.Right?f.scrollLeft-j.x:f.scrollLeft-D.x,m.x&&f.scrollBy({left:-m.x,behavior:l});break}else if(P&&T.y!==h.y){const C=f.scrollTop+g.y,A=y===Ue.Down&&C<=j.y||y===Ue.Up&&C>=D.y;if(A&&!g.x){f.scrollTo({top:C,behavior:l});return}A?m.y=f.scrollTop-C:m.y=y===Ue.Down?f.scrollTop-j.y:f.scrollTop-D.y,m.y&&f.scrollBy({top:-m.y,behavior:l});break}}this.handleMove(e,Ks(_i(h,this.referenceCoordinates),m))}}}handleMove(e,r){const{onMove:s}=this.props;e.preventDefault(),s(r)}handleEnd(e){const{onEnd:r}=this.props;e.preventDefault(),this.detach(),r()}handleCancel(e){const{onCancel:r}=this.props;e.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Gp.activators=[{eventName:"onKeyDown",handler:(t,e,r)=>{let{keyboardCodes:s=Hp,onActivation:n}=e,{active:i}=r;const{code:o}=t.nativeEvent;if(s.start.includes(o)){const l=i.activatorNode.current;return l&&t.target!==l?!1:(t.preventDefault(),n?.({event:t.nativeEvent}),!0)}return!1}}];function yh(t){return!!(t&&"distance"in t)}function xh(t){return!!(t&&"delay"in t)}class Jc{constructor(e,r,s){var n;s===void 0&&(s=H_(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=r;const{event:i}=e,{target:o}=i;this.props=e,this.events=r,this.document=hn(o),this.documentListeners=new Vn(this.document),this.listeners=new Vn(s),this.windowListeners=new Vn(At(o)),this.initialCoordinates=(n=Di(i))!=null?n:or,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:r,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Kt.Resize,this.handleCancel),this.windowListeners.add(Kt.DragStart,ph),this.windowListeners.add(Kt.VisibilityChange,this.handleCancel),this.windowListeners.add(Kt.ContextMenu,ph),this.documentListeners.add(Kt.Keydown,this.handleKeydown),r){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(xh(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(yh(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,r){const{active:s,onPending:n}=this.props;n(s,e,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:e}=this,{onStart:r}=this.props;e&&(this.activated=!0,this.documentListeners.add(Kt.Click,G_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Kt.SelectionChange,this.removeTextSelection),r(e))}handleMove(e){var r;const{activated:s,initialCoordinates:n,props:i}=this,{onMove:o,options:{activationConstraint:l}}=i;if(!n)return;const c=(r=Di(e))!=null?r:or,d=_i(n,c);if(!s&&l){if(yh(l)){if(l.tolerance!=null&&Po(d,l.tolerance))return this.handleCancel();if(Po(d,l.distance))return this.handleStart()}if(xh(l)&&Po(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}e.cancelable&&e.preventDefault(),o(c)}handleEnd(){const{onAbort:e,onEnd:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleCancel(){const{onAbort:e,onCancel:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleKeydown(e){e.code===Ue.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const K_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class zp extends Jc{constructor(e){const{event:r}=e,s=hn(r.target);super(e,K_,s)}}zp.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;return!r.isPrimary||r.button!==0?!1:(s?.({event:r}),!0)}}];const Y_={move:{name:"mousemove"},end:{name:"mouseup"}};var _l;(function(t){t[t.RightClick=2]="RightClick"})(_l||(_l={}));class Kp extends Jc{constructor(e){super(e,Y_,hn(e.event.target))}}Kp.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;return r.button===_l.RightClick?!1:(s?.({event:r}),!0)}}];const Mo={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Yp extends Jc{constructor(e){super(e,Mo)}static setup(){return window.addEventListener(Mo.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Mo.move.name,e)};function e(){}}}Yp.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;const{touches:n}=r;return n.length>1?!1:(s?.({event:r}),!0)}}];var Un;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Un||(Un={}));var Ei;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ei||(Ei={}));function q_(t){let{acceleration:e,activator:r=Un.Pointer,canScroll:s,draggingRect:n,enabled:i,interval:o=5,order:l=Ei.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:h,threshold:g}=t;const m=Q_({delta:h,disabled:!i}),[x,f]=l_(),y=p.useRef({x:0,y:0}),w=p.useRef({x:0,y:0}),v=p.useMemo(()=>{switch(r){case Un.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Un.DraggableRect:return n}},[r,n,c]),k=p.useRef(null),b=p.useCallback(()=>{const D=k.current;if(!D)return;const N=y.current.x*w.current.x,T=y.current.y*w.current.y;D.scrollBy(N,T)},[]),j=p.useMemo(()=>l===Ei.TreeOrder?[...d].reverse():d,[l,d]);p.useEffect(()=>{if(!i||!d.length||!v){f();return}for(const D of j){if(s?.(D)===!1)continue;const N=d.indexOf(D),T=u[N];if(!T)continue;const{direction:_,speed:P}=F_(D,T,v,e,g);for(const C of["x","y"])m[C][_[C]]||(P[C]=0,_[C]=0);if(P.x>0||P.y>0){f(),k.current=D,x(b,o),y.current=P,w.current=_;return}}y.current={x:0,y:0},w.current={x:0,y:0},f()},[e,b,s,f,i,o,JSON.stringify(v),JSON.stringify(m),x,d,j,u,JSON.stringify(g)])}const X_={x:{[yt.Backward]:!1,[yt.Forward]:!1},y:{[yt.Backward]:!1,[yt.Forward]:!1}};function Q_(t){let{delta:e,disabled:r}=t;const s=ji(e);return _a(n=>{if(r||!s||!n)return X_;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[yt.Backward]:n.x[yt.Backward]||i.x===-1,[yt.Forward]:n.x[yt.Forward]||i.x===1},y:{[yt.Backward]:n.y[yt.Backward]||i.y===-1,[yt.Forward]:n.y[yt.Forward]||i.y===1}}},[r,e,s])}function J_(t,e){const r=e!=null?t.get(e):void 0,s=r?r.node.current:null;return _a(n=>{var i;return e==null?null:(i=s??n)!=null?i:null},[s,e])}function Z_(t,e){return p.useMemo(()=>t.reduce((r,s)=>{const{sensor:n}=s,i=n.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,s)}));return[...r,...i]},[]),[t,e])}var ca;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(ca||(ca={}));var Dl;(function(t){t.Optimized="optimized"})(Dl||(Dl={}));const bh=new Map;function eD(t,e){let{dragging:r,dependencies:s,config:n}=e;const[i,o]=p.useState(null),{frequency:l,measure:c,strategy:d}=n,u=p.useRef(t),h=y(),g=la(h),m=p.useCallback(function(w){w===void 0&&(w=[]),!g.current&&o(v=>v===null?w:v.concat(w.filter(k=>!v.includes(k))))},[g]),x=p.useRef(null),f=_a(w=>{if(h&&!r)return bh;if(!w||w===bh||u.current!==t||i!=null){const v=new Map;for(let k of t){if(!k)continue;if(i&&i.length>0&&!i.includes(k.id)&&k.rect.current){v.set(k.id,k.rect.current);continue}const b=k.node.current,j=b?new Qc(c(b),b):null;k.rect.current=j,j&&v.set(k.id,j)}return v}return w},[t,i,r,h,c]);return p.useEffect(()=>{u.current=t},[t]),p.useEffect(()=>{h||m()},[r,h]),p.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),p.useEffect(()=>{h||typeof l!="number"||x.current!==null||(x.current=setTimeout(()=>{m(),x.current=null},l))},[l,h,m,...s]),{droppableRects:f,measureDroppableContainers:m,measuringScheduled:i!=null};function y(){switch(d){case ca.Always:return!1;case ca.BeforeDragging:return r;default:return!r}}}function Zc(t,e){return _a(r=>t?r||(typeof e=="function"?e(t):t):null,[e,t])}function tD(t,e){return Zc(t,e)}function rD(t){let{callback:e,disabled:r}=t;const s=to(e),n=p.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,r]);return p.useEffect(()=>()=>n?.disconnect(),[n]),n}function so(t){let{callback:e,disabled:r}=t;const s=to(e),n=p.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[r]);return p.useEffect(()=>()=>n?.disconnect(),[n]),n}function sD(t){return new Qc(gn(t),t)}function vh(t,e,r){e===void 0&&(e=sD);const[s,n]=p.useState(null);function i(){n(c=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=c??r)!=null?d:null}const u=e(t);return JSON.stringify(c)===JSON.stringify(u)?c:u})}const o=rD({callback(c){if(t)for(const d of c){const{type:u,target:h}=d;if(u==="childList"&&h instanceof HTMLElement&&h.contains(t)){i();break}}}}),l=so({callback:i});return ir(()=>{i(),t?(l?.observe(t),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[t]),s}function nD(t){const e=Zc(t);return Mp(t,e)}const wh=[];function aD(t){const e=p.useRef(t),r=_a(s=>t?s&&s!==wh&&t&&e.current&&t.parentNode===e.current.parentNode?s:Xc(t):wh,[t]);return p.useEffect(()=>{e.current=t},[t]),r}function iD(t){const[e,r]=p.useState(null),s=p.useRef(t),n=p.useCallback(i=>{const o=Ro(i.target);o&&r(l=>l?(l.set(o,jl(o)),new Map(l)):null)},[]);return p.useEffect(()=>{const i=s.current;if(t!==i){o(i);const l=t.map(c=>{const d=Ro(c);return d?(d.addEventListener("scroll",n,{passive:!0}),[d,jl(d)]):null}).filter(c=>c!=null);r(l.length?new Map(l):null),s.current=t}return()=>{o(t),o(i)};function o(l){l.forEach(c=>{const d=Ro(c);d?.removeEventListener("scroll",n)})}},[n,t]),p.useMemo(()=>t.length?e?Array.from(e.values()).reduce((i,o)=>Ks(i,o),or):Up(t):or,[t,e])}function kh(t,e){e===void 0&&(e=[]);const r=p.useRef(null);return p.useEffect(()=>{r.current=null},e),p.useEffect(()=>{const s=t!==or;s&&!r.current&&(r.current=t),!s&&r.current&&(r.current=null)},[t]),r.current?_i(t,r.current):or}function oD(t){p.useEffect(()=>{if(!eo)return;const e=t.map(r=>{let{sensor:s}=r;return s.setup==null?void 0:s.setup()});return()=>{for(const r of e)r?.()}},t.map(e=>{let{sensor:r}=e;return r}))}function lD(t,e){return p.useMemo(()=>t.reduce((r,s)=>{let{eventName:n,handler:i}=s;return r[n]=o=>{i(o,e)},r},{}),[t,e])}function qp(t){return p.useMemo(()=>t?M_(t):null,[t])}const Th=[];function cD(t,e){e===void 0&&(e=gn);const[r]=t,s=qp(r?At(r):null),[n,i]=p.useState(Th);function o(){i(()=>t.length?t.map(c=>Wp(c)?s:new Qc(e(c),c)):Th)}const l=so({callback:o});return ir(()=>{l?.disconnect(),o(),t.forEach(c=>l?.observe(c))},[t]),n}function Xp(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return ja(e)?e:t}function dD(t){let{measure:e}=t;const[r,s]=p.useState(null),n=p.useCallback(d=>{for(const{target:u}of d)if(ja(u)){s(h=>{const g=e(u);return h?{...h,width:g.width,height:g.height}:g});break}},[e]),i=so({callback:n}),o=p.useCallback(d=>{const u=Xp(d);i?.disconnect(),u&&i?.observe(u),s(u?e(u):null)},[e,i]),[l,c]=Si(o);return p.useMemo(()=>({nodeRef:l,rect:r,setRef:c}),[r,l,c])}const uD=[{sensor:zp,options:{}},{sensor:Gp,options:{}}],hD={current:{}},Ya={draggable:{measure:fh},droppable:{measure:fh,strategy:ca.WhileDragging,frequency:Dl.Optimized},dragOverlay:{measure:gn}};class Bn extends Map{get(e){var r;return e!=null&&(r=super.get(e))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:r}=e;return!r})}getNodeFor(e){var r,s;return(r=(s=this.get(e))==null?void 0:s.node.current)!=null?r:void 0}}const gD={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Bn,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ci},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ya,measureDroppableContainers:Ci,windowRect:null,measuringScheduled:!1},Qp={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ci,draggableNodes:new Map,over:null,measureDroppableContainers:Ci},Ca=p.createContext(Qp),Jp=p.createContext(gD);function mD(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Bn}}}function fD(t,e){switch(e.type){case ut.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case ut.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case ut.DragEnd:case ut.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ut.RegisterDroppable:{const{element:r}=e,{id:s}=r,n=new Bn(t.droppable.containers);return n.set(s,r),{...t,droppable:{...t.droppable,containers:n}}}case ut.SetDroppableDisabled:{const{id:r,key:s,disabled:n}=e,i=t.droppable.containers.get(r);if(!i||s!==i.key)return t;const o=new Bn(t.droppable.containers);return o.set(r,{...i,disabled:n}),{...t,droppable:{...t.droppable,containers:o}}}case ut.UnregisterDroppable:{const{id:r,key:s}=e,n=t.droppable.containers.get(r);if(!n||s!==n.key)return t;const i=new Bn(t.droppable.containers);return i.delete(r),{...t,droppable:{...t.droppable,containers:i}}}default:return t}}function pD(t){let{disabled:e}=t;const{active:r,activatorEvent:s,draggableNodes:n}=p.useContext(Ca),i=ji(s),o=ji(r?.id);return p.useEffect(()=>{if(!e&&!s&&i&&o!=null){if(!ro(i)||document.activeElement===i.target)return;const l=n.get(o);if(!l)return;const{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[c.current,d.current]){if(!u)continue;const h=u_(u);if(h){h.focus();break}}})}},[s,e,n,o,i]),null}function Zp(t,e){let{transform:r,...s}=e;return t!=null&&t.length?t.reduce((n,i)=>i({transform:n,...s}),r):r}function yD(t){return p.useMemo(()=>({draggable:{...Ya.draggable,...t?.draggable},droppable:{...Ya.droppable,...t?.droppable},dragOverlay:{...Ya.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function xD(t){let{activeNode:e,measure:r,initialRect:s,config:n=!0}=t;const i=p.useRef(!1),{x:o,y:l}=typeof n=="boolean"?{x:n,y:n}:n;ir(()=>{if(!o&&!l||!e){i.current=!1;return}if(i.current||!s)return;const d=e?.node.current;if(!d||d.isConnected===!1)return;const u=r(d),h=Mp(u,s);if(o||(h.x=0),l||(h.y=0),i.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const g=Lp(d);g&&g.scrollBy({top:h.y,left:h.x})}},[e,o,l,s,r])}const no=p.createContext({...or,scaleX:1,scaleY:1});var Vr;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Vr||(Vr={}));const bD=p.memo(function(e){var r,s,n,i;let{id:o,accessibility:l,autoScroll:c=!0,children:d,sensors:u=uD,collisionDetection:h=C_,measuring:g,modifiers:m,...x}=e;const f=p.useReducer(fD,void 0,mD),[y,w]=f,[v,k]=y_(),[b,j]=p.useState(Vr.Uninitialized),D=b===Vr.Initialized,{draggable:{active:N,nodes:T,translate:_},droppable:{containers:P}}=y,C=N!=null?T.get(N):null,A=p.useRef({initial:null,translated:null}),B=p.useMemo(()=>{var Me;return N!=null?{id:N,data:(Me=C?.data)!=null?Me:hD,rect:A}:null},[N,C]),z=p.useRef(null),[W,X]=p.useState(null),[V,ce]=p.useState(null),ke=la(x,Object.values(x)),Se=Da("DndDescribedBy",o),me=p.useMemo(()=>P.getEnabled(),[P]),ue=yD(g),{droppableRects:Y,measureDroppableContainers:ie,measuringScheduled:de}=eD(me,{dragging:D,dependencies:[_.x,_.y],config:ue.droppable}),be=J_(T,N),fe=p.useMemo(()=>V?Di(V):null,[V]),E=De(),ee=tD(be,ue.draggable.measure);xD({activeNode:N!=null?T.get(N):null,config:E.layoutShiftCompensation,initialRect:ee,measure:ue.draggable.measure});const Q=vh(be,ue.draggable.measure,ee),H=vh(be?be.parentElement:null),I=p.useRef({activatorEvent:null,active:null,activeNode:be,collisionRect:null,collisions:null,droppableRects:Y,draggableNodes:T,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=P.getNodeFor((r=I.current.over)==null?void 0:r.id),le=dD({measure:ue.dragOverlay.measure}),L=(s=le.nodeRef.current)!=null?s:be,G=D?(n=le.rect)!=null?n:Q:null,O=!!(le.nodeRef.current&&le.rect),se=nD(O?null:Q),he=qp(L?At(L):null),pe=aD(D?J??be:null),re=cD(pe),Ae=Zp(m,{transform:{x:_.x-se.x,y:_.y-se.y,scaleX:1,scaleY:1},activatorEvent:V,active:B,activeNodeRect:Q,containerNodeRect:H,draggingNodeRect:G,over:I.current.over,overlayNodeRect:le.rect,scrollableAncestors:pe,scrollableAncestorRects:re,windowRect:he}),K=fe?Ks(fe,_):null,xe=iD(pe),Fe=kh(xe),q=kh(xe,[Q]),we=Ks(Ae,Fe),Be=G?A_(G,Ae):null,S=B&&Be?h({active:B,collisionRect:Be,droppableRects:Y,droppableContainers:me,pointerCoordinates:K}):null,$=j_(S,"id"),[R,M]=p.useState(null),F=O?Ae:Ks(Ae,q),U=E_(F,(i=R?.rect)!=null?i:null,Q),ae=p.useRef(null),Te=p.useCallback((Me,st)=>{let{sensor:mt,options:Pr}=st;if(z.current==null)return;const Bt=T.get(z.current);if(!Bt)return;const Wt=Me.nativeEvent,lr=new mt({active:z.current,activeNode:Bt,event:Wt,options:Pr,context:I,onAbort(vt){if(!T.get(vt))return;const{onDragAbort:cr}=ke.current,wr={id:vt};cr?.(wr),v({type:"onDragAbort",event:wr})},onPending(vt,Mr,cr,wr){if(!T.get(vt))return;const{onDragPending:xn}=ke.current,Or={id:vt,constraint:Mr,initialCoordinates:cr,offset:wr};xn?.(Or),v({type:"onDragPending",event:Or})},onStart(vt){const Mr=z.current;if(Mr==null)return;const cr=T.get(Mr);if(!cr)return;const{onDragStart:wr}=ke.current,yn={activatorEvent:Wt,active:{id:Mr,data:cr.data,rect:A}};Ur.unstable_batchedUpdates(()=>{wr?.(yn),j(Vr.Initializing),w({type:ut.DragStart,initialCoordinates:vt,active:Mr}),v({type:"onDragStart",event:yn}),X(ae.current),ce(Wt)})},onMove(vt){w({type:ut.DragMove,coordinates:vt})},onEnd:js(ut.DragEnd),onCancel:js(ut.DragCancel)});ae.current=lr;function js(vt){return async function(){const{active:cr,collisions:wr,over:yn,scrollAdjustedTranslate:xn}=I.current;let Or=null;if(cr&&xn){const{cancelDrop:bn}=ke.current;Or={activatorEvent:Wt,active:cr,collisions:wr,delta:xn,over:yn},vt===ut.DragEnd&&typeof bn=="function"&&await Promise.resolve(bn(Or))&&(vt=ut.DragCancel)}z.current=null,Ur.unstable_batchedUpdates(()=>{w({type:vt}),j(Vr.Uninitialized),M(null),X(null),ce(null),ae.current=null;const bn=vt===ut.DragEnd?"onDragEnd":"onDragCancel";if(Or){const lo=ke.current[bn];lo?.(Or),v({type:bn,event:Or})}})}}},[T]),Ne=p.useCallback((Me,st)=>(mt,Pr)=>{const Bt=mt.nativeEvent,Wt=T.get(Pr);if(z.current!==null||!Wt||Bt.dndKit||Bt.defaultPrevented)return;const lr={active:Wt};Me(mt,st.options,lr)===!0&&(Bt.dndKit={capturedBy:st.sensor},z.current=Pr,Te(mt,st))},[T,Te]),ge=Z_(u,Ne);oD(u),ir(()=>{Q&&b===Vr.Initializing&&j(Vr.Initialized)},[Q,b]),p.useEffect(()=>{const{onDragMove:Me}=ke.current,{active:st,activatorEvent:mt,collisions:Pr,over:Bt}=I.current;if(!st||!mt)return;const Wt={active:st,activatorEvent:mt,collisions:Pr,delta:{x:we.x,y:we.y},over:Bt};Ur.unstable_batchedUpdates(()=>{Me?.(Wt),v({type:"onDragMove",event:Wt})})},[we.x,we.y]),p.useEffect(()=>{const{active:Me,activatorEvent:st,collisions:mt,droppableContainers:Pr,scrollAdjustedTranslate:Bt}=I.current;if(!Me||z.current==null||!st||!Bt)return;const{onDragOver:Wt}=ke.current,lr=Pr.get($),js=lr&&lr.rect.current?{id:lr.id,rect:lr.rect.current,data:lr.data,disabled:lr.disabled}:null,vt={active:Me,activatorEvent:st,collisions:mt,delta:{x:Bt.x,y:Bt.y},over:js};Ur.unstable_batchedUpdates(()=>{M(js),Wt?.(vt),v({type:"onDragOver",event:vt})})},[$]),ir(()=>{I.current={activatorEvent:V,active:B,activeNode:be,collisionRect:Be,collisions:S,droppableRects:Y,draggableNodes:T,draggingNode:L,draggingNodeRect:G,droppableContainers:P,over:R,scrollableAncestors:pe,scrollAdjustedTranslate:we},A.current={initial:G,translated:Be}},[B,be,S,Be,T,L,G,Y,P,R,pe,we]),q_({...E,delta:_,draggingRect:Be,pointerCoordinates:K,scrollableAncestors:pe,scrollableAncestorRects:re});const _e=p.useMemo(()=>({active:B,activeNode:be,activeNodeRect:Q,activatorEvent:V,collisions:S,containerNodeRect:H,dragOverlay:le,draggableNodes:T,droppableContainers:P,droppableRects:Y,over:R,measureDroppableContainers:ie,scrollableAncestors:pe,scrollableAncestorRects:re,measuringConfiguration:ue,measuringScheduled:de,windowRect:he}),[B,be,Q,V,S,H,le,T,P,Y,R,ie,pe,re,ue,de,he]),ye=p.useMemo(()=>({activatorEvent:V,activators:ge,active:B,activeNodeRect:Q,ariaDescribedById:{draggable:Se},dispatch:w,draggableNodes:T,over:R,measureDroppableContainers:ie}),[V,ge,B,Q,w,Se,T,R,ie]);return Ze.createElement(Pp.Provider,{value:k},Ze.createElement(Ca.Provider,{value:ye},Ze.createElement(Jp.Provider,{value:_e},Ze.createElement(no.Provider,{value:U},d)),Ze.createElement(pD,{disabled:l?.restoreFocus===!1})),Ze.createElement(v_,{...l,hiddenTextDescribedById:Se}));function De(){const Me=W?.autoScrollEnabled===!1,st=typeof c=="object"?c.enabled===!1:c===!1,mt=D&&!Me&&!st;return typeof c=="object"?{...c,enabled:mt}:{enabled:mt}}}),vD=p.createContext(null),Nh="button",wD="Draggable";function kD(t){let{id:e,data:r,disabled:s=!1,attributes:n}=t;const i=Da(wD),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:h,over:g}=p.useContext(Ca),{role:m=Nh,roleDescription:x="draggable",tabIndex:f=0}=n??{},y=c?.id===e,w=p.useContext(y?no:vD),[v,k]=Si(),[b,j]=Si(),D=lD(o,e),N=la(r);ir(()=>(h.set(e,{id:e,key:i,node:v,activatorNode:b,data:N}),()=>{const _=h.get(e);_&&_.key===i&&h.delete(e)}),[h,e]);const T=p.useMemo(()=>({role:m,tabIndex:f,"aria-disabled":s,"aria-pressed":y&&m===Nh?!0:void 0,"aria-roledescription":x,"aria-describedby":u.draggable}),[s,m,f,y,x,u.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:T,isDragging:y,listeners:s?void 0:D,node:v,over:g,setNodeRef:k,setActivatorNodeRef:j,transform:w}}function e0(){return p.useContext(Jp)}const TD="Droppable",ND={timeout:25};function t0(t){let{data:e,disabled:r=!1,id:s,resizeObserverConfig:n}=t;const i=Da(TD),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=p.useContext(Ca),u=p.useRef({disabled:r}),h=p.useRef(!1),g=p.useRef(null),m=p.useRef(null),{disabled:x,updateMeasurementsFor:f,timeout:y}={...ND,...n},w=la(f??s),v=p.useCallback(()=>{if(!h.current){h.current=!0;return}m.current!=null&&clearTimeout(m.current),m.current=setTimeout(()=>{d(Array.isArray(w.current)?w.current:[w.current]),m.current=null},y)},[y]),k=so({callback:v,disabled:x||!o}),b=p.useCallback((T,_)=>{k&&(_&&(k.unobserve(_),h.current=!1),T&&k.observe(T))},[k]),[j,D]=Si(b),N=la(e);return p.useEffect(()=>{!k||!j.current||(k.disconnect(),h.current=!1,k.observe(j.current))},[j,k]),p.useEffect(()=>(l({type:ut.RegisterDroppable,element:{id:s,key:i,disabled:r,node:j,rect:g,data:N}}),()=>l({type:ut.UnregisterDroppable,key:i,id:s})),[s]),p.useEffect(()=>{r!==u.current.disabled&&(l({type:ut.SetDroppableDisabled,id:s,key:i,disabled:r}),u.current.disabled=r)},[s,i,r,l]),{active:o,rect:g,isOver:c?.id===s,node:j,over:c,setNodeRef:D}}function SD(t){let{animation:e,children:r}=t;const[s,n]=p.useState(null),[i,o]=p.useState(null),l=ji(r);return!r&&!s&&l&&n(l),ir(()=>{if(!i)return;const c=s?.key,d=s?.props.id;if(c==null||d==null){n(null);return}Promise.resolve(e(d,i)).then(()=>{n(null)})},[e,s,i]),Ze.createElement(Ze.Fragment,null,r,s?p.cloneElement(s,{ref:o}):null)}const jD={x:0,y:0,scaleX:1,scaleY:1};function _D(t){let{children:e}=t;return Ze.createElement(Ca.Provider,{value:Qp},Ze.createElement(no.Provider,{value:jD},e))}const DD={position:"fixed",touchAction:"none"},CD=t=>ro(t)?"transform 250ms ease":void 0,ED=p.forwardRef((t,e)=>{let{as:r,activatorEvent:s,adjustScale:n,children:i,className:o,rect:l,style:c,transform:d,transition:u=CD}=t;if(!l)return null;const h=n?d:{...d,scaleX:1,scaleY:1},g={...DD,width:l.width,height:l.height,top:l.top,left:l.left,transform:Qr.Transform.toString(h),transformOrigin:n&&s?T_(s,l):void 0,transition:typeof u=="function"?u(s):u,...c};return Ze.createElement(r,{className:o,style:g,ref:e},i)}),ID=t=>e=>{let{active:r,dragOverlay:s}=e;const n={},{styles:i,className:o}=t;if(i!=null&&i.active)for(const[l,c]of Object.entries(i.active))c!==void 0&&(n[l]=r.node.style.getPropertyValue(l),r.node.style.setProperty(l,c));if(i!=null&&i.dragOverlay)for(const[l,c]of Object.entries(i.dragOverlay))c!==void 0&&s.node.style.setProperty(l,c);return o!=null&&o.active&&r.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[c,d]of Object.entries(n))r.node.style.setProperty(c,d);o!=null&&o.active&&r.node.classList.remove(o.active)}},AD=t=>{let{transform:{initial:e,final:r}}=t;return[{transform:Qr.Transform.toString(e)},{transform:Qr.Transform.toString(r)}]},RD={duration:250,easing:"ease",keyframes:AD,sideEffects:ID({styles:{active:{opacity:"0"}}})};function PD(t){let{config:e,draggableNodes:r,droppableContainers:s,measuringConfiguration:n}=t;return to((i,o)=>{if(e===null)return;const l=r.get(i);if(!l)return;const c=l.node.current;if(!c)return;const d=Xp(o);if(!d)return;const{transform:u}=At(o).getComputedStyle(o),h=Op(u);if(!h)return;const g=typeof e=="function"?e:MD(e);return Bp(c,n.draggable.measure),g({active:{id:i,data:l.data,node:c,rect:n.draggable.measure(c)},draggableNodes:r,dragOverlay:{node:o,rect:n.dragOverlay.measure(d)},droppableContainers:s,measuringConfiguration:n,transform:h})})}function MD(t){const{duration:e,easing:r,sideEffects:s,keyframes:n}={...RD,...t};return i=>{let{active:o,dragOverlay:l,transform:c,...d}=i;if(!e)return;const u={x:l.rect.left-o.rect.left,y:l.rect.top-o.rect.top},h={scaleX:c.scaleX!==1?o.rect.width*c.scaleX/l.rect.width:1,scaleY:c.scaleY!==1?o.rect.height*c.scaleY/l.rect.height:1},g={x:c.x-u.x,y:c.y-u.y,...h},m=n({...d,active:o,dragOverlay:l,transform:{initial:c,final:g}}),[x]=m,f=m[m.length-1];if(JSON.stringify(x)===JSON.stringify(f))return;const y=s?.({active:o,dragOverlay:l,...d}),w=l.node.animate(m,{duration:e,easing:r,fill:"forwards"});return new Promise(v=>{w.onfinish=()=>{y?.(),v()}})}}let Sh=0;function OD(t){return p.useMemo(()=>{if(t!=null)return Sh++,Sh},[t])}const LD=Ze.memo(t=>{let{adjustScale:e=!1,children:r,dropAnimation:s,style:n,transition:i,modifiers:o,wrapperElement:l="div",className:c,zIndex:d=999}=t;const{activatorEvent:u,active:h,activeNodeRect:g,containerNodeRect:m,draggableNodes:x,droppableContainers:f,dragOverlay:y,over:w,measuringConfiguration:v,scrollableAncestors:k,scrollableAncestorRects:b,windowRect:j}=e0(),D=p.useContext(no),N=OD(h?.id),T=Zp(o,{activatorEvent:u,active:h,activeNodeRect:g,containerNodeRect:m,draggingNodeRect:y.rect,over:w,overlayNodeRect:y.rect,scrollableAncestors:k,scrollableAncestorRects:b,transform:D,windowRect:j}),_=Zc(g),P=PD({config:s,draggableNodes:x,droppableContainers:f,measuringConfiguration:v}),C=_?y.setRef:void 0;return Ze.createElement(_D,null,Ze.createElement(SD,{animation:P},h&&N?Ze.createElement(ED,{key:N,id:h.id,ref:C,as:l,activatorEvent:u,adjustScale:e,className:c,transition:i,rect:_,style:{zIndex:d,...n},transform:T},r):null))});function r0(t,e,r){const s=t.slice();return s.splice(r<0?s.length+r:r,0,s.splice(e,1)[0]),s}function $D(t,e){return t.reduce((r,s,n)=>{const i=e.get(s);return i&&(r[n]=i),r},Array(t.length))}function Fa(t){return t!==null&&t>=0}function FD(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function WD(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const s0=t=>{let{rects:e,activeIndex:r,overIndex:s,index:n}=t;const i=r0(e,s,r),o=e[n],l=i[n];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},Wa={scaleX:1,scaleY:1},VD=t=>{var e;let{activeIndex:r,activeNodeRect:s,index:n,rects:i,overIndex:o}=t;const l=(e=i[r])!=null?e:s;if(!l)return null;if(n===r){const d=i[o];return d?{x:0,y:r<o?d.top+d.height-(l.top+l.height):d.top-l.top,...Wa}:null}const c=UD(i,n,r);return n>r&&n<=o?{x:0,y:-l.height-c,...Wa}:n<r&&n>=o?{x:0,y:l.height+c,...Wa}:{x:0,y:0,...Wa}};function UD(t,e,r){const s=t[e],n=t[e-1],i=t[e+1];return s?r<e?n?s.top-(n.top+n.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):n?s.top-(n.top+n.height):0:0}const n0="Sortable",a0=Ze.createContext({activeIndex:-1,containerId:n0,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:s0,disabled:{draggable:!1,droppable:!1}});function BD(t){let{children:e,id:r,items:s,strategy:n=s0,disabled:i=!1}=t;const{active:o,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:u}=e0(),h=Da(n0,r),g=l.rect!==null,m=p.useMemo(()=>s.map(D=>typeof D=="object"&&"id"in D?D.id:D),[s]),x=o!=null,f=o?m.indexOf(o.id):-1,y=d?m.indexOf(d.id):-1,w=p.useRef(m),v=!FD(m,w.current),k=y!==-1&&f===-1||v,b=WD(i);ir(()=>{v&&x&&u(m)},[v,m,x,u]),p.useEffect(()=>{w.current=m},[m]);const j=p.useMemo(()=>({activeIndex:f,containerId:h,disabled:b,disableTransforms:k,items:m,overIndex:y,useDragOverlay:g,sortedRects:$D(m,c),strategy:n}),[f,h,b.draggable,b.droppable,k,m,y,c,g,n]);return Ze.createElement(a0.Provider,{value:j},e)}const HD=t=>{let{id:e,items:r,activeIndex:s,overIndex:n}=t;return r0(r,s,n).indexOf(e)},GD=t=>{let{containerId:e,isSorting:r,wasDragging:s,index:n,items:i,newIndex:o,previousItems:l,previousContainerId:c,transition:d}=t;return!d||!s||l!==i&&n===o?!1:r?!0:o!==n&&e===c},zD={duration:200,easing:"ease"},i0="transform",KD=Qr.Transition.toString({property:i0,duration:0,easing:"linear"}),YD={roleDescription:"sortable"};function qD(t){let{disabled:e,index:r,node:s,rect:n}=t;const[i,o]=p.useState(null),l=p.useRef(r);return ir(()=>{if(!e&&r!==l.current&&s.current){const c=n.current;if(c){const d=gn(s.current,{ignoreTransform:!0}),u={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(u.x||u.y)&&o(u)}}r!==l.current&&(l.current=r)},[e,r,s,n]),p.useEffect(()=>{i&&o(null)},[i]),i}function XD(t){let{animateLayoutChanges:e=GD,attributes:r,disabled:s,data:n,getNewIndex:i=HD,id:o,strategy:l,resizeObserverConfig:c,transition:d=zD}=t;const{items:u,containerId:h,activeIndex:g,disabled:m,disableTransforms:x,sortedRects:f,overIndex:y,useDragOverlay:w,strategy:v}=p.useContext(a0),k=QD(s,m),b=u.indexOf(o),j=p.useMemo(()=>({sortable:{containerId:h,index:b,items:u},...n}),[h,n,b,u]),D=p.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:N,node:T,isOver:_,setNodeRef:P}=t0({id:o,data:j,disabled:k.droppable,resizeObserverConfig:{updateMeasurementsFor:D,...c}}),{active:C,activatorEvent:A,activeNodeRect:B,attributes:z,setNodeRef:W,listeners:X,isDragging:V,over:ce,setActivatorNodeRef:ke,transform:Se}=kD({id:o,data:j,attributes:{...YD,...r},disabled:k.draggable}),me=o_(P,W),ue=!!C,Y=ue&&!x&&Fa(g)&&Fa(y),ie=!w&&V,de=ie&&Y?Se:null,fe=Y?de??(l??v)({rects:f,activeNodeRect:B,activeIndex:g,overIndex:y,index:b}):null,E=Fa(g)&&Fa(y)?i({id:o,items:u,activeIndex:g,overIndex:y}):b,ee=C?.id,Q=p.useRef({activeId:ee,items:u,newIndex:E,containerId:h}),H=u!==Q.current.items,I=e({active:C,containerId:h,isDragging:V,isSorting:ue,id:o,index:b,items:u,newIndex:Q.current.newIndex,previousItems:Q.current.items,previousContainerId:Q.current.containerId,transition:d,wasDragging:Q.current.activeId!=null}),J=qD({disabled:!I,index:b,node:T,rect:N});return p.useEffect(()=>{ue&&Q.current.newIndex!==E&&(Q.current.newIndex=E),h!==Q.current.containerId&&(Q.current.containerId=h),u!==Q.current.items&&(Q.current.items=u)},[ue,E,h,u]),p.useEffect(()=>{if(ee===Q.current.activeId)return;if(ee!=null&&Q.current.activeId==null){Q.current.activeId=ee;return}const L=setTimeout(()=>{Q.current.activeId=ee},50);return()=>clearTimeout(L)},[ee]),{active:C,activeIndex:g,attributes:z,data:j,rect:N,index:b,newIndex:E,items:u,isOver:_,isSorting:ue,isDragging:V,listeners:X,node:T,overIndex:y,over:ce,setNodeRef:me,setActivatorNodeRef:ke,setDroppableNodeRef:P,setDraggableNodeRef:W,transform:J??fe,transition:le()};function le(){if(J||H&&Q.current.newIndex===b)return KD;if(!(ie&&!ro(A)||!d)&&(ue||I))return Qr.Transition.toString({...d,property:i0})}}function QD(t,e){var r,s;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(r=t?.draggable)!=null?r:e.draggable,droppable:(s=t?.droppable)!=null?s:e.droppable}}Ue.Down,Ue.Right,Ue.Up,Ue.Left;const JD=p.memo(({id:t,title:e,count:r,priority:s,children:n,onAdd:i})=>{const{setNodeRef:o}=t0({id:t}),{currentTheme:l,isDark:c}=Et(),d=!!l.bg;let u="border-gray-200 dark:border-gray-700",h="bg-gray-100 dark:bg-gray-800",g="text-gray-700 dark:text-gray-300";return s==="urgent"?(u="border-red-200 dark:border-red-900/30",h="bg-red-50 dark:bg-red-900/10",g="text-red-700 dark:text-red-400"):s==="high"?(u="border-orange-200 dark:border-orange-900/30",h="bg-orange-50 dark:bg-orange-900/10",g="text-orange-700 dark:text-orange-400"):s==="medium"&&(u="border-blue-200 dark:border-blue-900/30",h="bg-blue-50 dark:bg-blue-900/10",g="text-blue-700 dark:text-blue-400"),a.jsxs("div",{ref:o,className:`
        flex-shrink-0 lg:flex-shrink lg:flex-1 w-80 max-w-[85vw] lg:max-w-none flex flex-col h-full 
        ${d?"backdrop-blur-none transition-[background-color] duration-200":"bg-gray-50/50 dark:bg-gray-900/20"} rounded-xl border ${u}
        transition-colors snap-center
      `,style:d?{backgroundColor:`rgba(${c?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:`p-4 flex items-center justify-between sticky top-0 backdrop-blur-sm rounded-t-xl z-10 ${h}`,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:`font-semibold ${g}`,children:e}),a.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-white/50 dark:bg-black/20",children:r})]}),a.jsx("button",{onClick:i,className:`
            p-1.5 rounded-lg hover:bg-white/50 dark:hover:bg-black/20 
            transition-colors ${g}
          `,children:a.jsx(ct,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3 min-h-0",children:n})]})}),jh=p.memo(({todo:t,onEdit:e,isOverlay:r})=>{const{currentTheme:s,isDark:n}=Et(),i=!!s.bg,{attributes:o,listeners:l,setNodeRef:c,transform:d,transition:u,isDragging:h}=XD({id:t.id,data:{type:"Todo",todo:t}}),g={transform:Qr.Transform.toString(d),transition:u,opacity:h?.3:1},m=i?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700",x=i?{backgroundColor:`rgba(${n?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{};return a.jsx("div",{ref:c,style:g,...o,...l,className:`touch-none ${r?"shadow-2xl scale-105":""}`,children:a.jsx("div",{className:`${m} rounded-xl shadow-sm border`,style:x,children:a.jsx(Wr,{todo:t,onEdit:e,compact:!0})})})}),Oo=["urgent","high","medium","low"],ZD=({searchTerm:t,priorityFilter:e,typeFilter:r,projectFilter:s,tagFilter:n,completionDateFilter:i,onAddTodo:o,onEdit:l,isMobile:c=!1})=>{const{t:d,i18n:u}=Xe(),{currentTheme:h,isDark:g}=Et();h.bg,u.language==="ko"||sn;const{getFilteredTodos:m,updateTodo:x}=ot(),[f,y]=p.useState(null),w=w_(gh(Kp,{activationConstraint:{distance:10}}),gh(Yp,{activationConstraint:{delay:250,tolerance:5}})),v=p.useMemo(()=>{const T=m({searchTerm:t,priorityFilter:e,typeFilter:r,projectFilter:s,tagFilter:n,completionDateFilter:"all",includeCompleted:!0});if(i==="today"){const _=new Date;return _.setHours(0,0,0,0),T.filter(P=>{if(P.completed)return P.completedAt&&Ut(new Date(P.completedAt),_);const C=P.startDate?new Date(P.startDate):null,A=P.dueDate?new Date(P.dueDate):null;return C&&C.setHours(0,0,0,0),A&&A.setHours(0,0,0,0),C&&A?_>=C&&_<=A:C&&!A?_>=C:!C&&A?Ut(A,_)||A<_:!C&&!A})}return T},[t,e,r,s,n,i,m]),k=p.useMemo(()=>{const T={urgent:[],high:[],medium:[],low:[]};return v.forEach(_=>{T[_.priority]&&T[_.priority].push(_)}),Object.keys(T).forEach(_=>{T[_].sort((P,C)=>(P.order||0)-(C.order||0))}),T},[v]),b=p.useMemo(()=>f?v.find(T=>T.id===f):null,[f,v]),j=T=>{y(T.active.id)},D=T=>{const{active:_,over:P}=T;if(!P)return;const C=_.id,A=P.id;if(Oo.includes(A)){const B=v.find(z=>z.id===C);B&&B.priority}},N=T=>{const{active:_,over:P}=T;if(!P){y(null);return}const C=_.id,A=P.id,B=v.find(W=>W.id===C);if(!B){y(null);return}let z=B.priority;if(Oo.includes(A))z=A;else{const W=v.find(X=>X.id===A);W&&(z=W.priority)}B.priority!==z&&x(C,{priority:z}),y(null)};return a.jsxs(bD,{sensors:w,collisionDetection:__,onDragStart:j,onDragOver:D,onDragEnd:N,children:[a.jsx("div",{className:"flex h-full gap-4 overflow-x-auto pb-4 items-start snap-x snap-mandatory px-4",children:Oo.map(T=>a.jsx(JD,{id:T,title:d(`modal.addTodo.${T}`)||T.toUpperCase(),count:k[T].length,priority:T,onAdd:()=>o(T),children:a.jsx(BD,{items:k[T].map(_=>_.id),strategy:VD,children:a.jsx("div",{className:"space-y-3 min-h-[100px]",children:k[T].map(_=>a.jsx(jh,{todo:_,onEdit:l},_.id))})})},T))}),a.jsx(LD,{children:b?a.jsx("div",{className:"transform rotate-3 opacity-90 cursor-grabbing",children:a.jsx(jh,{todo:b,onEdit:()=>{},isOverlay:!0})}):null})]})},eC=({layout:t="sidebar"})=>{const{t:e}=Xe(),{currentTheme:r,isDark:s}=Et(),n=!!r.bg,{todos:i,getTodayTodos:o,getWeekTodos:l,getOverdueTodos:c}=ot(),d=i.length,u=i.filter(D=>D.completed).length,h=d>0?Math.round(u/d*100):0,g=o(),m=g.filter(D=>D.completed).length,x=g.length,f=l(),y=f.filter(D=>D.completed).length,w=f.length,v=w>0?Math.round(y/w*100):0,k=c().length,b=({value:D,color:N,size:T=60})=>{const _=T/2-4,P=2*Math.PI*_,C=P-D/100*P;return a.jsxs("div",{className:"relative flex items-center justify-center",style:{width:T,height:T},children:[a.jsxs("svg",{className:"transform -rotate-90 w-full h-full",children:[a.jsx("circle",{className:"text-gray-200 dark:text-gray-700",strokeWidth:"4",stroke:"currentColor",fill:"transparent",r:_,cx:T/2,cy:T/2}),a.jsx("circle",{className:N,strokeWidth:"4",strokeDasharray:P,strokeDashoffset:C,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:_,cx:T/2,cy:T/2})]}),a.jsxs("span",{className:"absolute text-xs font-bold text-gray-700 dark:text-gray-200",children:[D,"%"]})]})},j=[{title:e("detailedStats.totalCompletion"),value:`${h}%`,icon:a.jsx(Yy,{className:"w-5 h-5"}),textColor:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-100 dark:border-green-800",chart:a.jsx(b,{value:h,color:"text-green-500"})},{title:e("detailedStats.todayProgress"),value:`${m}/${x}`,icon:a.jsx(qy,{className:"w-5 h-5"}),textColor:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-100 dark:border-blue-800",chart:a.jsx("div",{className:"w-full h-2 bg-blue-100 dark:bg-blue-900/30 rounded-full overflow-hidden mt-2",children:a.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-500",style:{width:`${x>0?m/x*100:0}%`}})})},{title:e("detailedStats.weeklyProgress"),value:`${v}%`,icon:a.jsx(Xy,{className:"w-5 h-5"}),textColor:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-100 dark:border-purple-800",chart:a.jsx(b,{value:v,color:"text-purple-500"})},{title:e("detailedStats.overdue"),value:k.toString(),icon:a.jsx(Qy,{className:"w-5 h-5"}),textColor:"text-red-600",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-100 dark:border-red-800",chart:a.jsx("div",{className:"flex items-center justify-center h-[60px]",children:a.jsx("span",{className:"text-3xl font-bold text-red-500",children:k})})}];return t==="compact"?a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsxs("p",{className:"text-green-600 text-xs font-bold leading-none",children:[h,"%"]}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.completionRate")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsxs("p",{className:"text-blue-600 text-xs font-bold leading-none",children:[m,"/",x]}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.daily")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsxs("p",{className:"text-purple-600 text-xs font-bold leading-none",children:[v,"%"]}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.weekly")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-red-600 text-xs font-bold leading-none",children:k}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.overdueLabel")})]})]}):a.jsx("div",{className:`grid ${t==="full"?"grid-cols-2 lg:grid-cols-4":"grid-cols-2"} gap-4 lg:gap-6`,children:j.map((D,N)=>a.jsxs("div",{className:`${n?"glass-card backdrop-blur-none transition-[background-color] duration-200":`${D.bgColor} ${D.borderColor}`} rounded-xl p-4 lg:p-6 border transition-all duration-300 hover:shadow-md hover:-translate-y-1 flex flex-col justify-between min-h-[140px]`,style:n?{backgroundColor:`rgba(${s?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("div",{className:`p-2.5 rounded-xl bg-white dark:bg-gray-800 ${D.textColor} shadow-sm`,children:D.icon}),a.jsx("p",{className:"text-sm lg:text-base font-semibold text-gray-600 dark:text-gray-400",children:D.title})]}),a.jsxs("div",{className:"flex items-end justify-between mt-2",children:[a.jsx("div",{className:"flex flex-col",children:a.jsx("span",{className:`text-2xl lg:text-3xl font-bold ${D.textColor} dark:text-gray-200 tracking-tight`,children:D.value})}),a.jsx("div",{className:"flex items-center justify-center scale-110 lg:scale-125 origin-bottom-right",children:D.chart})]})]},N))})},_h=({layout:t="full"})=>{const{todos:e}=ot(),{t:r}=Xe(),{currentTheme:s,isDark:n}=Et(),i=!!s.bg,o=i?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700",l=i?{backgroundColor:`rgba(${n?"0, 0, 0":"255, 255, 255"}, var(--glass - opacity, 0.1))`}:{},c=e.filter(f=>f.type==="project"),d=c.filter(f=>f.project==="longterm").length,u=c.filter(f=>f.project==="shortterm").length,h=e.length-c.length,g=e.length,m=({size:f=100})=>{if(g===0)return null;const y=f/2-10,w=2*Math.PI*y,v=d/g*100,k=u/g*100,b=h/g*100;return a.jsxs("div",{className:"relative flex items-center justify-center",style:{width:f,height:f},children:[a.jsxs("svg",{className:"transform -rotate-90 w-full h-full",children:[a.jsx("circle",{className:"text-gray-100 dark:text-gray-700",strokeWidth:"8",stroke:"currentColor",fill:"transparent",r:y,cx:f/2,cy:f/2}),d>0&&a.jsx("circle",{className:"text-purple-500 transition-all duration-1000 ease-out",strokeWidth:"8",strokeDasharray:w,strokeDashoffset:w-v/100*w,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:y,cx:f/2,cy:f/2}),u>0&&a.jsx("circle",{className:"text-green-500 transition-all duration-1000 ease-out",strokeWidth:"8",strokeDasharray:w,strokeDashoffset:w-k/100*w,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:y,cx:f/2,cy:f/2,style:{transform:`rotate(${v/100*360}deg)`,transformOrigin:"center"}}),h>0&&a.jsx("circle",{className:"text-orange-500 transition-all duration-1000 ease-out",strokeWidth:"8",strokeDasharray:w,strokeDashoffset:w-b/100*w,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:y,cx:f/2,cy:f/2,style:{transform:`rotate(${(v+k)/100*360}deg)`,transformOrigin:"center"}})]}),a.jsxs("div",{className:"absolute flex flex-col items-center",children:[a.jsx("span",{className:"text-xl lg:text-3xl font-bold text-gray-800 dark:text-white",children:g}),a.jsx("span",{className:"text-[10px] lg:text-xs text-gray-500",children:r("analysis.total")})]})]})},x=[{label:r("analysis.totalProjects"),value:c.length,icon:a.jsx(Jy,{className:"w-5 h-5"}),color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-100 dark:border-blue-800"},{label:r("analysis.longTermLabel"),value:d,icon:a.jsx(Zy,{className:"w-5 h-5"}),color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-100 dark:border-purple-800"},{label:r("analysis.shortTermLabel"),value:u,icon:a.jsx(Xg,{className:"w-5 h-5"}),color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-100 dark:border-green-800"},{label:r("analysis.singleTasks"),value:h,icon:a.jsx(Qg,{className:"w-5 h-5"}),color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-50 dark:bg-orange-900/20",borderColor:"border-orange-100 dark:border-orange-800"}];return t==="compact"?a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-blue-600 text-xs font-bold leading-none",children:c.length}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.project")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-orange-600 text-xs font-bold leading-none",children:h}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.single")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-purple-600 text-xs font-bold leading-none",children:d}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.longTermLabel")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-green-600 text-xs font-bold leading-none",children:u}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.shortTermLabel")})]})]}):a.jsxs("div",{className:`${o} rounded - 2xl p - 6 lg: p - 8 shadow - sm border border - gray - 100 dark: border - gray - 700`,style:l,children:[a.jsx("div",{className:"flex items-center justify-between mb-8",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:a.jsx(Jg,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),a.jsx("h3",{className:"text-lg lg:text-xl font-bold text-gray-900 dark:text-white",children:r("analysis.title")})]})}),a.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-10 lg:gap-16",children:[a.jsxs("div",{className:"flex-shrink-0 relative",children:[a.jsx(m,{size:180}),a.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-sm font-medium text-gray-500 whitespace-nowrap",children:r("analysis.distribution")})]}),a.jsx("div",{className:"flex-1 w-full grid grid-cols-2 gap-4 lg:gap-6",children:x.map((f,y)=>a.jsxs("div",{className:`${f.bgColor} ${f.borderColor} rounded - xl p - 4 lg: p - 5 border transition - all duration - 300 hover: shadow - md hover: -translate - y - 1`,children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("div",{className:`p - 2.5 rounded - xl bg - white dark: bg - gray - 800 ${f.color} shadow - sm`,children:f.icon})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:f.label}),a.jsx("p",{className:`text - 2xl lg: text - 3xl font - bold ${f.color} `,children:f.value})]})]},y))})]})]})},tC=({isOpen:t,onClose:e,todoId:r,todoTitle:s="Task",currentUserId:n,initialSharedWith:i,onUpdate:o,isOwner:l=!1})=>{const{t:c}=Xe();return t?Ur.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[10000] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-xl overflow-hidden animate-in fade-in zoom-in duration-200",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100 dark:border-gray-700",children:[a.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[a.jsx(tr,{className:"w-5 h-5 text-blue-500"}),c("sharing.settingsTitle")||"Sharing Settings"]}),a.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:a.jsx(rt,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("div",{className:"p-4",children:a.jsx(n_,{todoId:r,todoTitle:s,currentUserId:n,initialSharedWith:i,onUpdate:o,isOwner:l,onClose:e})})]})}),document.body):null},o0=({isOpen:t,onClose:e,onSelectTemplate:r,mode:s="modal"})=>{const{t:n}=Xe(),{currentUser:i}=bt(),[o,l]=p.useState([]),[c,d]=p.useState(!1),[u,h]=p.useState(null),[g,m]=p.useState(!1),[x,f]=p.useState({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}),[y,w]=p.useState(!1),[v,k]=p.useState(null);p.useEffect(()=>{if(!i?.uid)return;const A=te.subscribeProjectTemplates(i.uid,B=>{l(B)});return()=>A()},[i?.uid]),p.useEffect(()=>{!t&&s==="modal"&&(h(null),d(!1),f({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}))},[t,s]);const b=async()=>{if(!(!x.name.trim()||!i?.uid)){m(!0);try{ne.log("ìƒˆ í…œí”Œë¦¿ ìƒì„±",{template:x}),await te.addProjectTemplate(x,i.uid),f({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}),d(!1)}catch(A){ne.error("í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨:",A),alert(n("common.error"))}finally{m(!1)}}},j=async()=>{if(!(!u||!i?.uid)){m(!0);try{ne.log("í…œí”Œë¦¿ ì—…ë°ì´íŠ¸",{template:u});const A=u.subTasks.map(ce=>({...ce,completedAt:ce.completedAt?new Date(ce.completedAt):void 0})),{id:B,createdAt:z,updatedAt:W,...X}=u,V={...X,subTasks:A};await te.updateProjectTemplate(B,V,i.uid),h(null)}catch(A){ne.error("í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",A),alert(n("common.error"))}finally{m(!1)}}},D=async A=>{if(!(!confirm(n("projectTemplate.deleteConfirm"))||!i?.uid)){m(!0);try{ne.log("í…œí”Œë¦¿ ì‚­ì œ",{templateId:A}),await te.deleteProjectTemplate(A,i.uid)}catch(B){ne.error("í…œí”Œë¦¿ ì‚­ì œ ì‹¤íŒ¨:",B),alert(n("common.error"))}finally{m(!1)}}},N=async A=>{if(i?.uid){m(!0);try{const{id:B,createdAt:z,updatedAt:W,...X}=A,V={...X,name:`${A.name} ${n("projectTemplate.copySuffix")}`};ne.log("í…œí”Œë¦¿ ë³µì‚¬",{duplicated:V}),await te.addProjectTemplate(V,i.uid)}catch(B){ne.error("í…œí”Œë¦¿ ë³µì‚¬ ì‹¤íŒ¨:",B),alert(n("common.error"))}finally{m(!1)}}},T=(A,B)=>{const z={title:"",completed:!1,priority:"medium"};B({...A,subTasks:[...A.subTasks,z]})},_=(A,B,z,W)=>{const X=A.subTasks.map((V,ce)=>ce===B?{...V,...z}:V);W({...A,subTasks:X})},P=(A,B,z)=>{z({...A,subTasks:A.subTasks.filter((W,X)=>X!==B)})};if(!t&&s==="modal")return null;const C=a.jsxs("div",{className:`bg-white dark:bg-gray-800 ${s==="modal"?"rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden":"h-full flex flex-col"}`,children:[s==="modal"&&a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:n("projectTemplate.title")}),a.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:`p-6 overflow-y-auto ${s==="modal"?"max-h-[calc(90vh-120px)]":"flex-1 custom-scrollbar"}`,children:[a.jsx("div",{className:"mb-6",children:a.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",children:[a.jsx(ct,{className:"w-4 h-4"}),n("projectTemplate.create")]})}),c&&a.jsxs("div",{className:"mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:n("projectTemplate.newTemplate")}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.name")}),a.jsx("input",{type:"text",value:x.name,onChange:A=>f({...x,name:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:n("projectTemplate.namePlaceholder")})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.category")}),a.jsxs("select",{value:x.category,onChange:A=>f({...x,category:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"shortterm",children:n("projectTemplate.shortterm")||n("modal.addTodo.shortTerm")}),a.jsx("option",{value:"longterm",children:n("projectTemplate.longterm")||n("modal.addTodo.longTerm")})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.description")}),a.jsx("textarea",{value:x.description,onChange:A=>f({...x,description:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:3,placeholder:n("projectTemplate.descPlaceholder")})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:n("projectTemplate.subTasks")}),a.jsxs("button",{onClick:()=>T(x,f),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[a.jsx(ct,{className:"w-3 h-3"}),n("projectTemplate.addSubTask")]})]}),a.jsx("div",{className:"space-y-2",children:x.subTasks.map((A,B)=>a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("input",{type:"checkbox",checked:A.completed,onChange:z=>{const W=new Date;_(x,B,{completed:z.target.checked,completedAt:z.target.checked?W:null},f)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),a.jsx("input",{type:"text",value:A.title,onChange:z=>_(x,B,{title:z.target.value},f),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-1 focus:ring-blue-500 dark:bg-gray-600 dark:text-white",placeholder:n("projectTemplate.subTaskName")}),a.jsxs("select",{value:A.priority,onChange:z=>_(x,B,{priority:z.target.value},f),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",children:[a.jsx("option",{value:"low",children:n("modal.addTodo.low")}),a.jsx("option",{value:"medium",children:n("modal.addTodo.medium")}),a.jsx("option",{value:"high",children:n("modal.addTodo.high")}),a.jsx("option",{value:"urgent",children:n("modal.addTodo.urgent")})]}),A.completed&&A.completedAt&&a.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:["ì™„ë£Œ: ",new Date(A.completedAt).toLocaleString()]}),a.jsx("button",{onClick:()=>P(x,B,f),className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:a.jsx(rt,{className:"w-3 h-3"})})]},B))})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:n("common.cancel")}),a.jsxs("button",{onClick:b,disabled:g,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[g?a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):a.jsx(ei,{className:"w-4 h-4"}),n(g?"projectTemplate.saving":"projectTemplate.save")]})]})]}),u&&a.jsxs("div",{className:"mb-6 p-4 border border-blue-200 dark:border-blue-700 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[a.jsx("h3",{className:"text-lg font-medium mb-4 text-blue-800 dark:text-blue-200",children:n("projectTemplate.editTemplate")}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.name")}),a.jsx("input",{type:"text",value:u.name,onChange:A=>h({...u,name:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:n("projectTemplate.namePlaceholder")})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.category")}),a.jsxs("select",{value:u.category,onChange:A=>h({...u,category:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"shortterm",children:n("projectTemplate.shortterm")||n("modal.addTodo.shortTerm")}),a.jsx("option",{value:"longterm",children:n("projectTemplate.longterm")||n("modal.addTodo.longTerm")})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.description")}),a.jsx("textarea",{value:u.description,onChange:A=>h({...u,description:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:3,placeholder:n("projectTemplate.descPlaceholder")})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:n("projectTemplate.subTasks")}),a.jsxs("button",{onClick:()=>T(u,h),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[a.jsx(ct,{className:"w-3 h-3"}),n("projectTemplate.addSubTask")]})]}),a.jsx("div",{className:"space-y-2",children:u.subTasks.map((A,B)=>a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("input",{type:"checkbox",checked:A.completed,onChange:z=>{const W=new Date;_(u,B,{completed:z.target.checked,completedAt:z.target.checked?W:void 0},h)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),a.jsx("input",{type:"text",value:A.title,onChange:z=>_(u,B,{title:z.target.value},h),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-1 focus:ring-blue-500 dark:bg-gray-600 dark:text-white",placeholder:n("projectTemplate.subTaskName")}),a.jsxs("select",{value:A.priority,onChange:z=>_(u,B,{priority:z.target.value},h),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",children:[a.jsx("option",{value:"low",children:n("modal.addTodo.low")}),a.jsx("option",{value:"medium",children:n("modal.addTodo.medium")}),a.jsx("option",{value:"high",children:n("modal.addTodo.high")}),a.jsx("option",{value:"urgent",children:n("modal.addTodo.urgent")})]}),A.completed&&A.completedAt&&a.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[n("modal.addTodo.completed")||"ì™„ë£Œ",": ",new Date(A.completedAt).toLocaleString()]}),a.jsx("button",{onClick:()=>P(u,B,h),className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:a.jsx(rt,{className:"w-3 h-3"})})]},B))})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>h(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:n("common.cancel")}),a.jsxs("button",{onClick:j,disabled:g,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[g?a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):a.jsx(ei,{className:"w-4 h-4"}),n(g?"projectTemplate.updating":"projectTemplate.update")]})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(A=>a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:A.name}),a.jsx("span",{className:`text-xs px-2 py-1 rounded ${A.category==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-300":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:A.category==="longterm"?n("projectTemplate.longterm")||"Long-term":n("projectTemplate.shortterm")||"Short-term"})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("button",{onClick:()=>{h(A)},disabled:g,className:"p-1 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:n("common.edit")||"Edit",children:a.jsx(zg,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>N(A),disabled:g,className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:n("common.copy")||"Copy",children:a.jsx(ex,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>D(A.id),disabled:g,className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:n("common.delete")||"Delete",children:a.jsx($t,{className:"w-3 h-3"})})]})]}),A.description&&a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:A.description}),a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:[n("projectTemplate.subTasks"),": ",A.subTasks.length]}),r&&a.jsx("button",{onClick:()=>{r(A),e()},className:"w-full btn-secondary text-sm",children:n("projectTemplate.use")})]},A.id))}),o.length===0&&!c&&a.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[a.jsx("p",{children:n("projectTemplate.empty")}),a.jsx("p",{className:"text-sm",children:n("projectTemplate.emptyHint")})]})]})]});return s==="embedded"?C:a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:C})},rC=({onCancel:t,onSuccess:e,initialDate:r,preselectedTemplate:s})=>{const{t:n}=Xe(),{addTodo:i,allTags:o}=ot(),{currentUser:l}=bt(),[c,d]=p.useState(""),[u,h]=p.useState(!1),[g,m]=p.useState(""),[x,f]=p.useState(!0),[y,w]=p.useState([]),[v,k]=p.useState(""),[b,j]=p.useState(!1),D={startDate:qe(r||new Date,"yyyy-MM-dd"),startTime:"",dueDate:"",dueTime:"",priority:"medium",tags:[],showStartTime:!1,showDueDate:!1,type:"simple",projectCategory:"shortterm",subTasks:[],description:""},[N,T]=p.useState(D),[_,P]=p.useState({}),[C,A]=p.useState(""),[B,z]=p.useState(!0),[W,X]=p.useState(!1),[V,ce]=p.useState(""),[ke,Se]=p.useState(null),[me,ue]=p.useState([]),[Y,ie]=p.useState(!1),[de,be]=p.useState(""),[fe,E]=p.useState(!1),[ee,Q]=p.useState(null),[H,I]=p.useState(null),[J,le]=p.useState([]);p.useEffect(()=>{if(!l?.uid)return;const K=te.subscribeSharingGroups(l.uid,xe=>le(xe));return()=>K()},[l?.uid]),p.useEffect(()=>{T(K=>({...K,startDate:qe(r||new Date,"yyyy-MM-dd")}))},[r]),p.useEffect(()=>{if(!l?.uid)return;const K=te.subscribeProjectTemplates(l.uid,xe=>{w(xe)});return()=>K()},[l?.uid]),p.useEffect(()=>{s&&L(s)},[s]);const L=K=>{let xe;if(typeof K=="string"){if(!K){k("");return}xe=y.find(Fe=>Fe.id===K)}else xe=K;xe&&(k(xe.id),d(xe.name),T(Fe=>({...Fe,type:"project",projectCategory:xe.category,priority:xe.defaultPriority,tags:[...Fe.tags,...xe.tags||[]],subTasks:xe.subTasks.map(q=>({id:crypto.randomUUID(),title:q.title})),description:xe.description||""})))},G=(K,xe)=>{T(Fe=>({...Fe,[K]:xe})),_[K]&&P(Fe=>{const q={...Fe};return delete q[K],q})},O=()=>{g.trim()&&!N.tags.includes(g.trim())&&(G("tags",[...N.tags,g.trim()]),m(""),h(!1))},se=K=>{N.tags.includes(K)?G("tags",N.tags.filter(xe=>xe!==K)):G("tags",[...N.tags,K])},he=()=>{if(!C.trim())return;const K={id:crypto.randomUUID(),title:C.trim()};G("subTasks",[...N.subTasks,K]),A("")},pe=K=>{G("subTasks",N.subTasks.filter(xe=>xe.id!==K))},re=K=>{const xe=new Date;let Fe=null,q=null,we=[];K.includes("ì˜¤ëŠ˜")?Fe=xe:K.includes("ë‚´ì¼")?Fe=xs(xe,1):K.includes("ëª¨ë ˆ")&&(Fe=xs(xe,2)),K.includes("!ê¸´ê¸‰")?q="urgent":K.includes("!ë†’ìŒ")?q="high":K.includes("!ë‚®ìŒ")&&(q="low");const Be=K.match(/#(\S+)/g);Be&&(we=Be.map($=>$.slice(1)));const S={};return Fe&&(S.startDate=qe(Fe,"yyyy-MM-dd")),q&&(S.priority=q),we.length>0&&(S.tags=we),S},Ae=K=>{if(K.preventDefault(),!c.trim()){P(Fe=>({...Fe,text:"í• ì¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"}));return}if(!B&&!W){alert(n("sharing.selectOne")||"Please select at least one task type.");return}const xe={title:c,completed:!1,recurrence:"none",...N,startDate:new Date(`${N.startDate}T${N.startTime||"00:00"}`),dueDate:N.showDueDate&&N.dueDate?new Date(`${N.dueDate}T${N.dueTime||"23:59"}`):void 0,project:N.type==="project"?N.projectCategory:void 0,subTasks:N.type==="project"?N.subTasks.map(Fe=>({...Fe,completed:!1,priority:"medium",createdAt:new Date,updatedAt:new Date})):void 0,ownerId:l?.uid,visibility:{isPersonal:B,isShared:W},sharedWith:W?me:[],sharedGroupId:W?ee:void 0,sharedGroupOwnerId:W?H:void 0};i(xe),e(),d(""),T(D),z(!0),X(!1),ue([]),ce(""),Q(null),I(null)};return a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:Ae,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(qg,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.taskTitle")," *"]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{autoFocus:!1,autoComplete:"off",type:"text",value:c,onChange:K=>{if(d(K.target.value),x&&N.type==="simple"){const xe=re(K.target.value);T(Fe=>({...Fe,...xe}))}},placeholder:x&&N.type==="simple"?n("modal.addTodo.naturalLanguageHint"):n("modal.addTodo.placeholder"),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${_.text?"border-red-500":"border-gray-300 dark:border-gray-600"}`}),N.type==="simple"&&a.jsx("button",{type:"button",onClick:()=>f(!x),className:`absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-1 rounded-md transition-colors ${x?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-500 dark:bg-gray-600 dark:text-gray-400"}`,children:x?"âœ¨ ON":"OFF"})]}),_.text&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:_.text})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("modal.addTodo.description")}),a.jsx("textarea",{value:N.description,onChange:K=>G("description",K.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white resize-none",placeholder:n("modal.addTodo.descPlaceholder")})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(Jl,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.type")]}),a.jsxs("select",{value:N.type,onChange:K=>G("type",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"simple",children:n("modal.addTodo.simpleTask")}),a.jsx("option",{value:"project",children:n("modal.addTodo.project")})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(pa,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.priority")]}),a.jsxs("select",{value:N.priority,onChange:K=>G("priority",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"low",children:n("modal.addTodo.low")}),a.jsx("option",{value:"medium",children:n("modal.addTodo.medium")}),a.jsx("option",{value:"high",children:n("modal.addTodo.high")}),a.jsx("option",{value:"urgent",children:n("modal.addTodo.urgent")})]})]})]}),N.type==="project"&&a.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl border border-gray-200 dark:border-gray-700 animate-fadeIn",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:n("modal.addTodo.projectCategory")}),a.jsxs("button",{type:"button",onClick:()=>j(!0),className:"text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 font-medium flex items-center gap-1",children:[a.jsx(tx,{className:"w-3 h-3"}),n("modal.addTodo.manageTemplates")]})]}),y.length>0&&a.jsxs("select",{value:v,onChange:K=>L(K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"",children:n("modal.addTodo.noTemplate")}),y.map(K=>a.jsxs("option",{value:K.id,children:[K.name," (",K.subTasks.length,"ê°œ í•˜ìœ„ì‘ì—…)"]},K.id))]}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"shortterm",checked:N.projectCategory==="shortterm",onChange:K=>G("projectCategory",K.target.value),className:"mr-2"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("modal.addTodo.shortTerm")})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"longterm",checked:N.projectCategory==="longterm",onChange:K=>G("projectCategory",K.target.value),className:"mr-2"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("modal.addTodo.longTerm")})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(Jg,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.subtasks")," (",N.subTasks.length,")"]}),a.jsx("div",{className:"space-y-2 mb-2",children:N.subTasks.map((K,xe)=>a.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded-lg border border-gray-200 dark:border-gray-700",children:[a.jsx("span",{className:"text-xs text-gray-500 font-mono",children:xe+1}),a.jsx("span",{className:"flex-1 text-sm text-gray-700 dark:text-gray-300",children:K.title}),a.jsx("button",{type:"button",onClick:()=>pe(K.id),className:"text-red-400 hover:text-red-600",children:a.jsx($t,{className:"w-4 h-4"})})]},K.id))}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:C,onChange:K=>A(K.target.value),onKeyPress:K=>K.key==="Enter"&&(K.preventDefault(),he()),placeholder:n("modal.addTodo.addSubtaskPlaceholder"),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:he,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:n("common.add")})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(at,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.startDate")]}),a.jsx("input",{type:"date",value:N.startDate,onChange:K=>G("startDate",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(gr,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.startTime")]}),a.jsx("input",{type:"time",value:N.startTime,onChange:K=>G("startTime",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),a.jsxs("div",{className:"border-t border-gray-100 dark:border-gray-700 pt-4",children:[a.jsxs("button",{type:"button",onClick:()=>G("showDueDate",!N.showDueDate),className:"flex items-center text-sm text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors mb-2",children:[N.showDueDate?a.jsx(Yg,{className:"w-4 h-4 mr-1"}):a.jsx(fa,{className:"w-4 h-4 mr-1"}),N.showDueDate?n("modal.addTodo.hideDueDate"):n("modal.addTodo.showDueDate")]}),N.showDueDate&&a.jsxs("div",{className:"grid grid-cols-2 gap-4 animate-fadeIn",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("modal.addTodo.dueDate")}),a.jsx("input",{type:"date",value:N.dueDate,onChange:K=>G("dueDate",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("modal.addTodo.dueTime")}),a.jsx("input",{type:"time",value:N.dueTime,onChange:K=>G("dueTime",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]})]}),a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("sharing.settingsTitle")||"Sharing"}),a.jsxs("div",{className:"flex space-x-4 mb-3",children:[a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:B,onChange:K=>z(K.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("sharing.myTask")||"My Task"})]}),a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:W,onChange:K=>X(K.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("sharing.sharedTask")||"Shared Task"})]})]}),W&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"ê³µìœ  ëŒ€ìƒ ì„ íƒ"}),a.jsxs("select",{value:me.length>0?me.map(K=>K.uid).sort().join(","):"",onChange:K=>{const xe=K.target.value;if(xe){const Fe=J.find(q=>q.id===xe);Fe&&(ue(Fe.members||[]),Fe.isReference?(Q(Fe.originalGroupId||null),I(Fe.originalOwnerId||null)):(Q(xe),I(l?.uid||null)))}else ue([]),Q(null),I(null)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm",children:[a.jsx("option",{value:"",children:"-- ê³µìœ  ëŒ€ìƒ ì„ íƒ ë˜ëŠ” ì§ì ‘ ì¶”ê°€ --"}),J.map(K=>a.jsxs("option",{value:K.id,children:["ğŸ‘¥ ",K.name," (",K.members.length,"ëª…)"]},K.id))]}),J.length===0&&a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:'ğŸ’¡ ê³µìœ  ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì´ë“œë°” "ê³µìœ  ì„¤ì •"ì—ì„œ ë¨¼ì € ê·¸ë£¹ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.'})]}),me.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:me.map(K=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full text-xs text-gray-600 dark:text-gray-300",children:[a.jsx("span",{className:"w-4 h-4 rounded-full bg-gray-100 dark:bg-gray-600 flex items-center justify-center text-[10px] font-bold",children:K.displayName?.[0]||K.email[0].toUpperCase()}),K.displayName||K.email.split("@")[0]]},K.uid))})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(rl,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.tags")]}),a.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[o.map(K=>a.jsxs("button",{type:"button",onClick:()=>se(K),className:`px-3 py-1 rounded-full text-sm transition-colors ${N.tags.includes(K)?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["#",K]},K)),a.jsx("button",{type:"button",onClick:()=>h(!0),className:"px-3 py-1 rounded-full text-sm border border-dashed border-gray-300 text-gray-500 hover:border-gray-400 hover:text-gray-600 transition-colors",children:n("modal.addTodo.addTag")})]}),u&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:g,onChange:K=>m(K.target.value),placeholder:n("modal.addTodo.newTagPlaceholder"),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",onKeyPress:K=>K.key==="Enter"&&(K.preventDefault(),O())}),a.jsx("button",{type:"button",onClick:O,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:n("common.add")})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:n("common.cancel")}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(ct,{className:"w-4 h-4"}),n("modal.addTodo.submit")]})]})]}),a.jsx(o0,{isOpen:b,onClose:()=>j(!1),onSelectTemplate:L}),a.jsx(tC,{isOpen:fe,onClose:()=>E(!1),initialSharedWith:me,onUpdate:K=>{ue(K),K.length>0&&X(!0)},currentUserId:l?.uid})]})},sC=({onCancel:t,onSuccess:e})=>{const{addRecurringTemplate:r,recurringTemplates:s}=ot(),{t:n}=Xe(),[i,o]=p.useState({title:"",description:"",priority:"medium",type:"simple",recurrenceType:"daily",weekday:1,monthlyDate:1,monthlyPattern:"date",monthlyWeek:"first",monthlyWeekday:3,tags:[],exceptions:[],holidayHandling:"show"}),[l,c]=p.useState(!1),d=()=>{o(v=>({...v,exceptions:[...v.exceptions,{type:"date",values:[]}]}))},u=v=>{o(k=>({...k,exceptions:k.exceptions.filter((b,j)=>j!==v)}))},h=(v,k,b)=>{o(j=>({...j,exceptions:j.exceptions.map((D,N)=>N===v?{...D,[k]:b}:D)}))},g=(v,k)=>{o(b=>({...b,exceptions:b.exceptions.map((j,D)=>D===v?{...j,values:k}:j)}))},m=v=>{const b=i.exceptions[v].values||[],j={targetTemplateTitle:"",scope:"same_week"};g(v,[...b,j])},x=(v,k)=>{const j=i.exceptions[v].values||[];g(v,j.filter((D,N)=>N!==k))},f=(v,k,b,j)=>{const T=(i.exceptions[v].values||[]).map((_,P)=>P===k?{..._,[b]:j}:_);g(v,T)},y=[{value:0,label:n("days.sunday")},{value:1,label:n("days.monday")},{value:2,label:n("days.tuesday")},{value:3,label:n("days.wednesday")},{value:4,label:n("days.thursday")},{value:5,label:n("days.friday")},{value:6,label:n("days.saturday")}],w=async v=>{if(v.preventDefault(),!!i.title.trim()){c(!0);try{const k={title:i.title.trim(),description:i.description.trim()||void 0,priority:i.priority,type:i.type,recurrenceType:i.recurrenceType,isActive:!0,tags:i.tags,exceptions:i.exceptions,holidayHandling:i.holidayHandling};i.recurrenceType==="weekly"?k.weekday=i.weekday:i.recurrenceType==="monthly"&&(i.monthlyPattern==="weekday"?(k.monthlyPattern="weekday",k.monthlyWeek=i.monthlyWeek,k.monthlyWeekday=i.monthlyWeekday):(k.monthlyPattern="date",k.monthlyDate=i.monthlyDate)),await r(k),e(),o({title:"",description:"",priority:"medium",type:"simple",recurrenceType:"daily",weekday:1,monthlyDate:1,monthlyPattern:"date",monthlyWeek:"first",monthlyWeekday:3,tags:[],exceptions:[],holidayHandling:"show"})}catch(k){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì‹¤íŒ¨:",k),alert(n("common.error"))}finally{c(!1)}}};return a.jsxs("form",{onSubmit:w,className:"space-y-6",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.title")}),a.jsx("input",{type:"text",value:i.title,onChange:v=>o({...i,title:v.target.value}),placeholder:n("modal.addTodo.placeholder"),className:"w-full text-lg px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.description")}),a.jsx("textarea",{value:i.description,onChange:v=>o({...i,description:v.target.value}),placeholder:n("modal.addTodo.descPlaceholder"),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white resize-none",rows:2})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(pa,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.priority")]}),a.jsx("div",{className:"flex gap-2",children:[{value:"urgent",label:n("modal.addTodo.urgent"),color:"text-red-700 bg-red-100 dark:bg-red-900/40 border-red-200 dark:border-red-800"},{value:"high",label:n("modal.addTodo.high"),color:"text-orange-700 bg-orange-100 dark:bg-orange-900/40 border-orange-200 dark:border-orange-800"},{value:"medium",label:n("modal.addTodo.medium"),color:"text-yellow-700 bg-yellow-100 dark:bg-yellow-900/40 border-yellow-200 dark:border-yellow-800"},{value:"low",label:n("modal.addTodo.low"),color:"text-green-700 bg-green-100 dark:bg-green-900/40 border-green-200 dark:border-green-800"}].map(v=>a.jsxs("label",{className:`flex-1 flex items-center justify-center p-2 rounded-lg cursor-pointer transition-all border ${i.priority===v.value?`ring-2 ring-offset-1 ring-blue-500 ${v.color} font-bold`:"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[a.jsx("input",{type:"radio",name:"priority",value:v.value,checked:i.priority===v.value,onChange:k=>o({...i,priority:k.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:v.label})]},v.value))})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(Zg,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.recurrenceType")]}),a.jsxs("select",{value:i.recurrenceType,onChange:v=>o({...i,recurrenceType:v.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"daily",children:n("recurring.form.daily")}),a.jsx("option",{value:"weekly",children:n("recurring.form.weekly")}),a.jsx("option",{value:"monthly",children:n("recurring.form.monthly")})]})]}),i.recurrenceType==="weekly"&&a.jsxs("div",{className:"animate-fadeIn",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectWeekday")}),a.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:y.map(v=>a.jsx("button",{type:"button",onClick:()=>o({...i,weekday:v.value}),className:`flex-1 min-w-[60px] py-2 rounded-lg text-sm font-medium transition-colors ${i.weekday===v.value?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 ring-2 ring-blue-500":"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:v.label},v.value))})]}),i.recurrenceType==="monthly"&&a.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.monthlyPattern")}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:i.monthlyPattern==="date",onChange:()=>o({...i,monthlyPattern:"date"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byDate")})]}),a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:i.monthlyPattern==="weekday",onChange:()=>o({...i,monthlyPattern:"weekday"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byWeekday")})]})]})]}),i.monthlyPattern==="date"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectDate")}),a.jsxs("select",{value:i.monthlyDate,onChange:v=>o({...i,monthlyDate:parseInt(v.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[Array.from({length:31},(v,k)=>k+1).map(v=>a.jsxs("option",{value:v,children:[v,n("calendar.daySuffix",{defaultValue:""})]},v)),a.jsx("option",{value:-1,children:n("recurring.form.lastDay")}),a.jsx("option",{value:-2,children:n("recurring.form.firstWorkDay")}),a.jsx("option",{value:-3,children:n("recurring.form.lastWorkDay")})]})]}),i.monthlyPattern==="weekday"&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.week")}),a.jsxs("select",{value:i.monthlyWeek,onChange:v=>o({...i,monthlyWeek:v.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"first",children:n("recurring.firstWeek")}),a.jsx("option",{value:"second",children:n("recurring.secondWeek")}),a.jsx("option",{value:"third",children:n("recurring.thirdWeek")}),a.jsx("option",{value:"fourth",children:n("recurring.fourthWeek")}),a.jsx("option",{value:"last",children:n("recurring.lastWeek")})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.weekday")}),a.jsx("select",{value:i.monthlyWeekday,onChange:v=>o({...i,monthlyWeekday:parseInt(v.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:y.map(v=>a.jsx("option",{value:v.value,children:v.label},v.value))})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.holidayHandling")}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"before",label:n("recurring.form.moveBefore")},{value:"after",label:n("recurring.form.moveAfter")},{value:"show",label:n("recurring.form.show")}].map(v=>a.jsxs("label",{className:`flex items-center justify-center p-2 rounded-lg cursor-pointer border transition-all ${i.holidayHandling===v.value?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/30 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-200 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:[a.jsx("input",{type:"radio",name:"holidayHandling",value:v.value,checked:i.holidayHandling===v.value,onChange:k=>o({...i,holidayHandling:k.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:v.label})]},v.value))})]}),a.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a.jsx(Zl,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.exceptionSettings")]}),a.jsxs("button",{type:"button",onClick:d,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[a.jsx(ct,{className:"w-3 h-3"}),n("recurring.form.addException")]})]}),i.exceptions.map((v,k)=>a.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl space-y-3 border border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("select",{value:v.type,onChange:b=>h(k,"type",b.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white mr-2",children:[a.jsx("option",{value:"date",children:n("recurring.form.byDateOption")}),a.jsx("option",{value:"weekday",children:n("recurring.form.byWeekdayOption")}),a.jsx("option",{value:"week",children:n("recurring.form.byWeekOption")}),a.jsx("option",{value:"month",children:n("recurring.form.byMonthOption")}),a.jsx("option",{value:"conflict",children:n("recurring.form.conflictOption")})]}),a.jsx("button",{type:"button",onClick:()=>u(k),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:a.jsx($t,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[v.type==="date"&&Array.from({length:31},(b,j)=>j+1).map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b),onChange:j=>{const D=v.values,N=j.target.checked?[...D,b]:D.filter(T=>T!==b);g(k,N)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[b,n("calendar.daySuffix",{defaultValue:""})]})]},b)),v.type==="weekday"&&y.map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b.value),onChange:j=>{const D=v.values,N=j.target.checked?[...D,b.value]:D.filter(T=>T!==b.value);g(k,N)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:b.label})]},b.value)),v.type==="week"&&[1,2,3,4,-1].map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b),onChange:j=>{const D=v.values,N=j.target.checked?[...D,b]:D.filter(T=>T!==b);g(k,N)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:Fi(b)})]},b)),v.type==="month"&&Array.from({length:12},(b,j)=>j+1).map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b),onChange:j=>{const D=v.values,N=j.target.checked?[...D,b]:D.filter(T=>T!==b);g(k,N)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[b,n("common.monthSuffix",{defaultValue:"ì›”"})]})]},b))]}),v.type==="conflict"&&a.jsxs("div",{className:"space-y-3",children:[(v.values||[]).map((b,j)=>a.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:[n("recurring.form.conflictRule")," ",j+1]}),a.jsx("button",{type:"button",onClick:()=>x(k,j),className:"text-red-500 hover:text-red-700 p-1",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.targetTemplate")}),a.jsxs("select",{value:b.targetTemplateTitle,onChange:D=>f(k,j,"targetTemplateTitle",D.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"",children:n("recurring.form.selectTemplate")}),s.map(D=>a.jsx("option",{value:D.title,children:D.title},D.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.conflictCondition")}),a.jsxs("select",{value:b.scope,onChange:D=>f(k,j,"scope",D.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"same_date",children:n("recurring.form.sameDate")}),a.jsx("option",{value:"same_week",children:n("recurring.form.sameWeek")}),a.jsx("option",{value:"same_month",children:n("recurring.form.sameMonth")})]})]})]})]},j)),a.jsxs("button",{type:"button",onClick:()=>m(k),className:"w-full py-2 px-3 text-sm border-2 border-dashed border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center gap-2",children:[a.jsx(ct,{className:"w-4 h-4"}),n("recurring.form.addConflictRule")]})]})]},k))]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:t,className:"px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",disabled:l,children:n("common.cancel")}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-0.5 font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:l||!i.title.trim(),children:[a.jsx(ct,{className:"w-4 h-4"}),n(l?"recurring.form.saving":"recurring.addTemplate")]})]})]})},l0=({isOpen:t,onClose:e,initialDate:r,initialTab:s="todo"})=>{const{t:n}=Xe(),[i,o]=p.useState(s),[l,c]=p.useState(null);p.useEffect(()=>{t&&(o(s),c(null))},[t,s]);const d=u=>{c(u),o("todo")};return t?a.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:e}),a.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:a.jsxs("div",{className:"relative w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[a.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 shrink-0",children:[a.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[i==="todo"&&n("modal.addTodo.title"),i==="recurring"&&(n("recurring.title")||"Add Recurring Task"),i==="template"&&(n("projectTemplate.title")||"Manage Templates")]}),a.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 shrink-0",children:[a.jsxs("button",{onClick:()=>o("todo"),className:`flex-1 py-3 text-sm font-medium transition-colors border-b-2 ${i==="todo"?"border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[n("modal.addTodo.simpleTask")," / ",n("modal.addTodo.project")]}),a.jsx("button",{onClick:()=>o("recurring"),className:`flex-1 py-3 text-sm font-medium transition-colors border-b-2 ${i==="recurring"?"border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:n("recurring.title")||"Repeating Task"}),a.jsx("button",{onClick:()=>o("template"),className:`flex-1 py-3 text-sm font-medium transition-colors border-b-2 ${i==="template"?"border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:n("projectTemplate.manage")||"Templates"})]}),a.jsxs("div",{className:"p-6 overflow-y-auto min-h-0 flex-1",children:[i==="todo"&&a.jsx(rC,{onCancel:e,onSuccess:e,initialDate:r,preselectedTemplate:l}),i==="recurring"&&a.jsx(sC,{onCancel:e,onSuccess:e}),i==="template"&&a.jsx(o0,{isOpen:!0,onClose:()=>o("todo"),onSelectTemplate:d,mode:"embedded"})]})]})})]}):null},nC=()=>{const{recurringTemplates:t,recurringInstances:e,updateRecurringTemplate:r,deleteRecurringTemplate:s,cleanupDuplicateTemplates:n}=ot(),{t:i}=Xe(),{currentTheme:o,isDark:l}=Et(),c=!!o.bg,[d,u]=p.useState("templates"),[h,g]=p.useState(!1),[m,x]=p.useState(!1),[f,y]=p.useState(null),[w,v]=p.useState({excludeWeeks:[],excludeDates:[]});p.useEffect(()=>{try{const C=localStorage.getItem("globalRecurringExceptions");C&&v(JSON.parse(C))}catch(C){console.error("ì˜ˆì™¸ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:",C)}},[]);const k=C=>{try{localStorage.setItem("globalRecurringExceptions",JSON.stringify(C)),v(C)}catch(A){console.error("ì˜ˆì™¸ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:",A)}},b=C=>{const A={...w},B=A.excludeWeeks.indexOf(C);B===-1?A.excludeWeeks.push(C):A.excludeWeeks.splice(B,1),k(A)},j=t.filter(C=>C.isActive),D=t.filter(C=>!C.isActive),N=async C=>{const A=t.find(B=>B.id===C);A&&await r(C,{isActive:!A.isActive})},T=async C=>{confirm("ì´ ë°˜ë³µ í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await s(C)},_=C=>{y(C),x(!0)},P=C=>{if(C.recurrenceType==="weekly")return`ë§¤ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][C.weekday||0]}ìš”ì¼`;if(C.recurrenceType==="monthly")if(C.monthlyPattern==="weekday"&&C.monthlyWeek&&C.monthlyWeekday!==void 0){const A=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];return`ë§¤ì›” ${{first:"ì²« ë²ˆì§¸",second:"ë‘ ë²ˆì§¸",third:"ì„¸ ë²ˆì§¸",fourth:"ë„¤ ë²ˆì§¸",last:"ë§ˆì§€ë§‰"}[C.monthlyWeek]} ì£¼ ${A[C.monthlyWeekday]}ìš”ì¼`}else return C.monthlyDate===-1?"ë§¤ì›” ë§ì¼":C.monthlyDate===-2?"ë§¤ì›” ì²« ë²ˆì§¸ ê·¼ë¬´ì¼":C.monthlyDate===-3?"ë§¤ì›” ë§ˆì§€ë§‰ ê·¼ë¬´ì¼":`ë§¤ì›” ${C.monthlyDate}ì¼`;return"ë§¤ì¼"};return a.jsxs("div",{className:`space-y-6 transition-all duration-300 ${c?"rounded-2xl border border-white/20 shadow-lg backdrop-blur-md":"glass-card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:i("recurring.title")}),a.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-0.5 font-medium",children:[a.jsx(ct,{className:"w-4 h-4"}),i("recurring.addTemplate")]})]}),a.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:a.jsxs("nav",{className:"flex justify-between",children:[a.jsx("button",{onClick:()=>u("templates"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="templates"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:i("recurring.templates")}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx("button",{onClick:()=>u("exceptions"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="exceptions"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:i("recurring.exceptions")}),a.jsx("button",{onClick:()=>u("holidays"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="holidays"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:i("recurring.holidays")})]})]})}),d==="templates"&&a.jsxs("div",{className:"space-y-6",children:[j.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[a.jsx(el,{className:"w-5 h-5 text-green-600"}),i("recurring.activeTemplates")," (",j.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(C=>a.jsx("div",{className:`p-3 border-green-200 dark:border-green-800 transition-all ${c?"rounded-xl backdrop-blur-sm hover:bg-green-50/30":"card bg-green-50 dark:bg-green-900/10"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1 truncate",children:C.title}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 whitespace-nowrap overflow-hidden text-ellipsis",children:P(C)})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx("span",{className:`px-2 py-1 rounded text-xs ${C.priority==="urgent"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300":C.priority==="high"?"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300":C.priority==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"}`,children:C.priority==="urgent"?i("modal.addTodo.urgent"):C.priority==="high"?i("modal.addTodo.high"):C.priority==="medium"?i("modal.addTodo.medium"):i("modal.addTodo.low")}),a.jsx("button",{onClick:()=>_(C),className:"p-1 hover:bg-blue-100 dark:hover:bg-blue-800 rounded",title:i("recurring.edit")||"Edit",children:a.jsx(Kg,{className:"w-4 h-4 text-blue-600"})}),a.jsx("button",{onClick:()=>N(C.id),className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded",title:i("recurring.pause")||"Pause",children:a.jsx(Ad,{className:"w-4 h-4 text-green-600"})}),a.jsx("button",{onClick:()=>T(C.id),className:"p-1 hover:bg-red-100 dark:hover:bg-red-800 rounded",title:i("recurring.delete")||"Delete",children:a.jsx($t,{className:"w-4 h-4 text-red-600"})})]})]})},C.id))})]}),D.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[a.jsx(Ad,{className:"w-5 h-5 text-gray-500"}),i("recurring.inactiveTemplates")," (",D.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.map(C=>a.jsx("div",{className:`p-3 opacity-75 border-gray-200 dark:border-gray-700 transition-all ${c?"rounded-xl backdrop-blur-sm hover:bg-white/20":"card bg-gray-50 dark:bg-gray-800"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.1)`}:{},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-600 dark:text-gray-300 mb-1 truncate",children:C.title}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap overflow-hidden text-ellipsis",children:P(C)})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx("button",{onClick:()=>N(C.id),className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded",title:i("recurring.resume")||"Resume",children:a.jsx(el,{className:"w-4 h-4 text-green-600"})}),a.jsx("button",{onClick:()=>T(C.id),className:"p-1 hover:bg-red-100 dark:hover:bg-red-800 rounded",title:i("recurring.delete")||"Delete",children:a.jsx($t,{className:"w-4 h-4 text-red-600"})})]})]})},C.id))})]}),t.length===0&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(at,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:i("recurring.empty")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:i("recurring.emptyHint")}),a.jsx("button",{onClick:()=>g(!0),className:"btn-primary",children:i("recurring.addFirst")})]})]}),d==="exceptions"&&a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:`p-4 transition-all ${c?"rounded-xl backdrop-blur-sm border border-white/20":"card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:i("recurring.exceptionTitle")}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200 mb-3",children:i("recurring.monthlySettings")}),a.jsxs("div",{className:"flex gap-1 justify-between overflow-hidden",children:[a.jsx("div",{className:"text-center px-1 py-1 bg-blue-50 dark:bg-blue-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-blue-700 dark:text-blue-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.firstWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-green-50 dark:bg-green-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-green-700 dark:text-green-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.secondWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-yellow-50 dark:bg-yellow-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-yellow-700 dark:text-yellow-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.thirdWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-purple-50 dark:bg-purple-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-purple-700 dark:text-purple-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.fourthWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-red-50 dark:bg-red-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-red-700 dark:text-red-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.lastWeek")})})]}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-3",children:i("recurring.weekHint")})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[a.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200 mb-3",children:i("recurring.excludeSettings")}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex gap-1 justify-between overflow-hidden",children:[a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-blue-50 dark:bg-blue-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-blue-700 dark:text-blue-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.firstWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(1),onChange:()=>b(1)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-green-50 dark:bg-green-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-green-700 dark:text-green-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.secondWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(2),onChange:()=>b(2)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-yellow-50 dark:bg-yellow-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-yellow-700 dark:text-yellow-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.thirdWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(3),onChange:()=>b(3)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-purple-50 dark:bg-purple-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-purple-700 dark:text-purple-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.fourthWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(4),onChange:()=>b(4)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-red-50 dark:bg-red-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-red-700 dark:text-red-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.lastWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(5),onChange:()=>b(5)})]})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("recurring.excludeHint")}),w.excludeWeeks.length>0&&a.jsxs("div",{className:"mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[a.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 font-medium",children:[i("recurring.currentExcluded"),": ",w.excludeWeeks.map(C=>Fi(C)).join(", ")]}),a.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:i("recurring.excludedHint")})]})]}),a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200",children:i("recurring.exceptionDateTitle")}),a.jsx("button",{className:"btn-secondary px-2 py-1 whitespace-nowrap",style:{fontSize:"clamp(10px, 2vw, 14px)"},children:i("recurring.addExceptionDate")})]}),a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded-lg",children:a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:i("recurring.exceptionDateHint")})})]})]})]})]})}),d==="holidays"&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(em,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:i("recurring.holidayTitle")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:i("recurring.holidayDesc")}),a.jsxs("div",{className:`p-6 max-w-md mx-auto transition-all ${c?"rounded-xl backdrop-blur-sm border border-white/20":"card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:[a.jsx("h4",{className:"font-medium mb-3",children:i("recurring.plannedFeatures")}),a.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 text-left space-y-2",children:[a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.vacation",{defaultValue:"Vacation Scheduling"})]}),a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.autoAdjust",{defaultValue:"Auto-adjust Recurring Tasks"})]}),a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.notification",{defaultValue:"Vacation Alerts"})]}),a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.holidaySync",{defaultValue:"Holiday Sync"})]})]})]})]}),a.jsx("div",{className:`p-4 transition-all ${c?"rounded-xl backdrop-blur-sm border border-white/20":"card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i("recurring.totalTemplates")}),a.jsx("p",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:t.length})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i("recurring.active")}),a.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:j.length})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i("recurring.todayInstances")}),a.jsx("p",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:e.filter(C=>{const A=new Date().toDateString();return new Date(C.date).toDateString()===A}).length})]})]})}),a.jsx(l0,{isOpen:h,onClose:()=>g(!1),initialTab:"recurring"}),m&&f&&a.jsx(aC,{template:f,onClose:()=>{x(!1),y(null)},onSave:async C=>{await r(f.id,C),x(!1),y(null)}})]})},aC=({template:t,onClose:e,onSave:r})=>{const{recurringTemplates:s}=ot(),{t:n}=Xe(),{currentTheme:i}=Et(),o=!!i.bg,[l,c]=p.useState({title:t.title,description:t.description||"",priority:t.priority,type:t.type,recurrenceType:t.recurrenceType,weekday:t.weekday||0,monthlyDate:t.monthlyDate||1,monthlyPattern:t.monthlyPattern||"date",monthlyWeek:t.monthlyWeek||"first",monthlyWeekday:t.monthlyWeekday||3,tags:t.tags||[],exceptions:t.exceptions||[],holidayHandling:t.holidayHandling||"show"}),[d,u]=p.useState(!1);p.useEffect(()=>{c({title:t.title,description:t.description||"",priority:t.priority,type:t.type,recurrenceType:t.recurrenceType,weekday:t.weekday||0,monthlyDate:t.monthlyDate||1,monthlyPattern:t.monthlyPattern||"date",monthlyWeek:t.monthlyWeek||"first",monthlyWeekday:t.monthlyWeekday||3,tags:t.tags||[],exceptions:t.exceptions||[],holidayHandling:t.holidayHandling||"show"})},[t]);const h=()=>{c(b=>({...b,exceptions:[...b.exceptions,{type:"date",values:[]}]}))},g=b=>{c(j=>({...j,exceptions:j.exceptions.filter((D,N)=>N!==b)}))},m=(b,j,D)=>{c(N=>({...N,exceptions:N.exceptions.map((T,_)=>_===b?{...T,[j]:D}:T)}))},x=(b,j)=>{c(D=>({...D,exceptions:D.exceptions.map((N,T)=>T===b?{...N,values:j}:N)}))},f=b=>{const D=l.exceptions[b].values||[],N={targetTemplateTitle:"",scope:"same_week"};x(b,[...D,N])},y=(b,j)=>{const N=l.exceptions[b].values||[];x(b,N.filter((T,_)=>_!==j))},w=(b,j,D,N)=>{const P=(l.exceptions[b].values||[]).map((C,A)=>A===j?{...C,[D]:N}:C);x(b,P)},v=[{value:0,label:n("days.sunday")},{value:1,label:n("days.monday")},{value:2,label:n("days.tuesday")},{value:3,label:n("days.wednesday")},{value:4,label:n("days.thursday")},{value:5,label:n("days.friday")},{value:6,label:n("days.saturday")}],k=async b=>{b.preventDefault(),u(!0);try{const j={title:l.title.trim(),description:l.description.trim()||void 0,priority:l.priority,type:l.type,recurrenceType:l.recurrenceType,tags:l.tags,exceptions:l.exceptions,holidayHandling:l.holidayHandling,updatedAt:new Date};l.recurrenceType==="weekly"?j.weekday=l.weekday:l.recurrenceType==="monthly"&&(l.monthlyPattern==="weekday"?(j.monthlyPattern="weekday",j.monthlyWeek=l.monthlyWeek,j.monthlyWeekday=l.monthlyWeekday):(j.monthlyPattern="date",j.monthlyDate=l.monthlyDate)),await r(j),e()}catch(j){console.error("í…œí”Œë¦¿ ìˆ˜ì • ì‹¤íŒ¨:",j),alert(n("recurring.updateError"))}finally{u(!1)}};return a.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm transition-opacity",onClick:e}),a.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:a.jsxs("form",{onSubmit:k,className:`relative w-full max-w-2xl rounded-2xl shadow-2xl p-6 transform transition-all ${o?"glass-card backdrop-blur-xl border border-white/20":"bg-white dark:bg-gray-800"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:n("recurring.editModalTitle")}),a.jsx("button",{type:"button",onClick:e,className:"p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.title")}),a.jsx("input",{type:"text",value:l.title,onChange:b=>c({...l,title:b.target.value}),className:"w-full text-lg px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.description")}),a.jsx("textarea",{value:l.description,onChange:b=>c({...l,description:b.target.value}),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white resize-none",rows:2})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(pa,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.priority")]}),a.jsx("div",{className:"flex gap-2",children:[{value:"urgent",label:n("modal.addTodo.urgent"),color:"text-red-700 bg-red-100 dark:bg-red-900/40 border-red-200 dark:border-red-800"},{value:"high",label:n("modal.addTodo.high"),color:"text-orange-700 bg-orange-100 dark:bg-orange-900/40 border-orange-200 dark:border-orange-800"},{value:"medium",label:n("modal.addTodo.medium"),color:"text-yellow-700 bg-yellow-100 dark:bg-yellow-900/40 border-yellow-200 dark:border-yellow-800"},{value:"low",label:n("modal.addTodo.low"),color:"text-green-700 bg-green-100 dark:bg-green-900/40 border-green-200 dark:border-green-800"}].map(b=>a.jsxs("label",{className:`flex-1 flex items-center justify-center p-2 rounded-lg cursor-pointer transition-all border ${l.priority===b.value?`ring-2 ring-offset-1 ring-blue-500 ${b.color} font-bold`:"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[a.jsx("input",{type:"radio",name:"priority",value:b.value,checked:l.priority===b.value,onChange:j=>c({...l,priority:j.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:b.label})]},b.value))})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(Zg,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.recurrenceType")]}),a.jsxs("select",{value:l.recurrenceType,onChange:b=>c({...l,recurrenceType:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"daily",children:n("recurring.form.daily")}),a.jsx("option",{value:"weekly",children:n("recurring.form.weekly")}),a.jsx("option",{value:"monthly",children:n("recurring.form.monthly")})]})]}),l.recurrenceType==="weekly"&&a.jsxs("div",{className:"animate-fadeIn",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectWeekday")}),a.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:v.map(b=>a.jsx("button",{type:"button",onClick:()=>c({...l,weekday:b.value}),className:`flex-1 min-w-[60px] py-2 rounded-lg text-sm font-medium transition-colors ${l.weekday===b.value?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 ring-2 ring-blue-500":"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:b.label},b.value))})]}),l.recurrenceType==="monthly"&&a.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.monthlyPattern")}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:l.monthlyPattern==="date",onChange:()=>c({...l,monthlyPattern:"date"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byDate")})]}),a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:l.monthlyPattern==="weekday",onChange:()=>c({...l,monthlyPattern:"weekday"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byWeekday")})]})]})]}),l.monthlyPattern==="date"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectDate")}),a.jsxs("select",{value:l.monthlyDate,onChange:b=>c({...l,monthlyDate:parseInt(b.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[Array.from({length:31},(b,j)=>j+1).map(b=>a.jsxs("option",{value:b,children:[b,n("calendar.daySuffix",{defaultValue:""})]},b)),a.jsx("option",{value:-1,children:n("recurring.form.lastDay")}),a.jsx("option",{value:-2,children:n("recurring.form.firstWorkDay")}),a.jsx("option",{value:-3,children:n("recurring.form.lastWorkDay")})]})]}),l.monthlyPattern==="weekday"&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.week")}),a.jsxs("select",{value:l.monthlyWeek,onChange:b=>c({...l,monthlyWeek:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"first",children:n("recurring.firstWeek")}),a.jsx("option",{value:"second",children:n("recurring.secondWeek")}),a.jsx("option",{value:"third",children:n("recurring.thirdWeek")}),a.jsx("option",{value:"fourth",children:n("recurring.fourthWeek")}),a.jsx("option",{value:"last",children:n("recurring.lastWeek")})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.weekday")}),a.jsx("select",{value:l.monthlyWeekday,onChange:b=>c({...l,monthlyWeekday:parseInt(b.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:v.map(b=>a.jsx("option",{value:b.value,children:b.label},b.value))})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.holidayHandling")}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"before",label:n("recurring.form.moveBefore")},{value:"after",label:n("recurring.form.moveAfter")},{value:"show",label:n("recurring.form.show")}].map(b=>a.jsxs("label",{className:`flex items-center justify-center p-2 rounded-lg cursor-pointer border transition-all ${l.holidayHandling===b.value?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/30 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-200 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:[a.jsx("input",{type:"radio",name:"holidayHandling",value:b.value,checked:l.holidayHandling===b.value,onChange:j=>c({...l,holidayHandling:j.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:b.label})]},b.value))})]}),a.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a.jsx(Zl,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.exceptionSettings")]}),a.jsxs("button",{type:"button",onClick:h,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[a.jsx(ct,{className:"w-3 h-3"}),n("recurring.form.addException")]})]}),l.exceptions.map((b,j)=>a.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl space-y-3 border border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("select",{value:b.type,onChange:D=>m(j,"type",D.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white mr-2",children:[a.jsx("option",{value:"date",children:n("recurring.form.byDateOption")}),a.jsx("option",{value:"weekday",children:n("recurring.form.byWeekdayOption")}),a.jsx("option",{value:"week",children:n("recurring.form.byWeekOption")}),a.jsx("option",{value:"month",children:n("recurring.form.byMonthOption")}),a.jsx("option",{value:"conflict",children:n("recurring.form.conflictOption")})]}),a.jsx("button",{type:"button",onClick:()=>g(j),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:a.jsx($t,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[b.type==="date"&&Array.from({length:31},(D,N)=>N+1).map(D=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(D),onChange:N=>{const T=b.values,_=N.target.checked?[...T,D]:T.filter(P=>P!==D);x(j,_)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[D,n("calendar.daySuffix",{defaultValue:""})]})]},D)),b.type==="weekday"&&v.map(D=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(D.value),onChange:N=>{const T=b.values,_=N.target.checked?[...T,D.value]:T.filter(P=>P!==D.value);x(j,_)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:D.label})]},D.value)),b.type==="week"&&[1,2,3,4,-1].map(D=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(D),onChange:N=>{const T=b.values,_=N.target.checked?[...T,D]:T.filter(P=>P!==D);x(j,_)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:Fi(D)})]},D)),b.type==="month"&&Array.from({length:12},(D,N)=>N+1).map(D=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(D),onChange:N=>{const T=b.values,_=N.target.checked?[...T,D]:T.filter(P=>P!==D);x(j,_)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[D,n("common.monthSuffix",{defaultValue:"ì›”"})]})]},D))]}),b.type==="conflict"&&a.jsxs("div",{className:"space-y-3",children:[(b.values||[]).map((D,N)=>a.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:[n("recurring.form.conflictRule")," ",N+1]}),a.jsx("button",{type:"button",onClick:()=>y(j,N),className:"text-red-500 hover:text-red-700 p-1",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.targetTemplate")}),a.jsxs("select",{value:D.targetTemplateTitle,onChange:T=>w(j,N,"targetTemplateTitle",T.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"",children:n("recurring.form.selectTemplate")}),s.map(T=>a.jsx("option",{value:T.title,children:T.title},T.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.conflictCondition")}),a.jsxs("select",{value:D.scope,onChange:T=>w(j,N,"scope",T.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"same_date",children:n("recurring.form.sameDate")}),a.jsx("option",{value:"same_week",children:n("recurring.form.sameWeek")}),a.jsx("option",{value:"same_month",children:n("recurring.form.sameMonth")})]})]})]})]},N)),a.jsxs("button",{type:"button",onClick:()=>f(j),className:"w-full py-2 px-3 text-sm border-2 border-dashed border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center gap-2",children:[a.jsx(ct,{className:"w-4 h-4"}),n("recurring.form.addConflictRule")]})]})]},j))]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:e,className:"px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",disabled:d,children:n("common.cancel")}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-0.5 font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:d,children:[a.jsx(Yt,{className:"w-4 h-4"}),n(d?"recurring.form.saving":"recurring.form.save")]})]})]})})]})},iC=({searchTerm:t="",priorityFilter:e="all",typeFilter:r="all",projectFilter:s="all",tagFilter:n=[]})=>{const{todos:i,toggleTodo:o,getRecurringTodos:l}=ot(),{t:c,i18n:d}=Xe(),{currentTheme:u,isDark:h}=Et(),g=!!u.bg,m=d.language==="ko"?dn:sn,[x,f]=p.useState(new Set(["today"])),[y,w]=p.useState("period"),[v,k]=p.useState("yesterday"),b=new Date,j=g?"glass-card p-3 transition-[background-color] duration-200":"bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border",D=g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},N=l(),T=new Set,_=[...i,...N].filter(E=>T.has(E.id)?!1:(T.add(E.id),!0)),P=_.filter(E=>E.completed&&E.completedAt&&(t===""||E.title.toLowerCase().includes(t.toLowerCase())||E.description&&E.description.toLowerCase().includes(t.toLowerCase()))&&(e==="all"||E.priority===e)&&(r==="all"||E.type===r)&&(s==="all"||s==="longterm"&&E.project==="longterm"||s==="shortterm"&&E.project==="shortterm")&&(n.length===0||E.tags&&n.every(ee=>E.tags?.includes(ee)))),C=[];_.forEach(E=>{E.subTasks&&E.subTasks.length>0&&E.subTasks.filter(ee=>ee.completed&&ee.completedAt&&ee.completedAt!==null).forEach(ee=>{const Q=t===""||ee.title.toLowerCase().includes(t.toLowerCase())||ee.description&&ee.description.toLowerCase().includes(t.toLowerCase()),H=e==="all"||ee.priority===e;Q&&H&&C.push({...ee,type:"simple",recurrence:"none",isSubTask:!0,parentTitle:E.title,parentDescription:E.description,createdAt:ee.createdAt,updatedAt:ee.updatedAt})})});const A=[...P,...C].sort((E,ee)=>{const Q=J=>{if(!J)return 0;try{const le=new Date(J).getTime();return isNaN(le)?0:le}catch{return 0}},H=Q(E.completedAt);return Q(ee.completedAt)-H});console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì™„ë£Œëœ í• ì¼:",A.length),console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì™„ë£Œëœ ë°˜ë³µ í• ì¼:",A.filter(E=>E._isRecurringInstance).length);const B=A.find(E=>E.title==="ì£¼ê°„ì—…ë¬´ë³´ê³ ");B?console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì£¼ê°„ì—…ë¬´ë³´ê³  ë°œê²¬:",{title:B.title,completed:B.completed,completedAt:B.completedAt,_isRecurringInstance:B._isRecurringInstance}):(console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì£¼ê°„ì—…ë¬´ë³´ê³ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"),console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì™„ë£Œëœ í• ì¼ ì œëª©ë“¤:",A.map(E=>E.title)));const z={today:A.filter(E=>E.completedAt&&Ut(new Date(E.completedAt),b)),yesterday:A.filter(E=>E.completedAt&&Ut(new Date(E.completedAt),In(b))),thisWeek:A.filter(E=>{if(!E.completedAt)return!1;const ee=new Date(E.completedAt);return Ds(ee,{start:as(b,{locale:m}),end:is(b,{locale:m})})&&!Ut(ee,b)&&!Ut(ee,In(b))}),lastWeek:A.filter(E=>{if(!E.completedAt)return!1;const ee=as(An(b),{locale:m}),Q=is(An(b),{locale:m});return Ds(new Date(E.completedAt),{start:ee,end:Q})}),thisMonth:A.filter(E=>{if(!E.completedAt)return!1;const ee=new Date(E.completedAt),Q=as(An(b),{locale:m});return Ds(ee,{start:Ha(b),end:nl(b)})&&!Ut(ee,b)&&!Ut(ee,In(b))&&!Ds(ee,{start:as(b,{locale:m}),end:is(b,{locale:m})})&&!Ds(ee,{start:Q,end:is(Q,{locale:m})})}),lastMonth:A.filter(E=>{if(!E.completedAt)return!1;const ee=new Date(E.completedAt);return Ds(ee,{start:Ha(si(b)),end:nl(si(b))})}),older:A.filter(E=>E.completedAt?new Date(E.completedAt)<Ha(b):!1)},W=()=>{const E={};A.forEach(Q=>{if(!Q.completedAt)return;const H=new Date(Q.completedAt),I=qe(H,d.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:m});E[I]||(E[I]=[]),E[I].push(Q)}),Object.values(E).forEach(Q=>{Q.sort((H,I)=>!H.completedAt||!I.completedAt?0:new Date(I.completedAt).getTime()-new Date(H.completedAt).getTime())});const ee=Object.keys(E).sort((Q,H)=>{const I=new Date(E[Q][0].completedAt);return new Date(E[H][0].completedAt).getTime()-I.getTime()});return{groupedByDay:E,sortedKeys:ee}},X=()=>{const E={};A.forEach(Q=>{if(!Q.completedAt)return;const H=new Date(Q.completedAt),I=new Date(H);I.setDate(H.getDate()-H.getDay()),I.setHours(0,0,0,0);const J=new Date(I);J.setDate(I.getDate()+6);const le=`${qe(I,d.language==="ko"?"Mì›” dì¼":"MMM d",{locale:m})} ~ ${qe(J,d.language==="ko"?"Mì›” dì¼":"MMM d",{locale:m})}`;E[le]||(E[le]=[]),E[le].push(Q)}),Object.values(E).forEach(Q=>{Q.sort((H,I)=>!H.completedAt||!I.completedAt?0:new Date(I.completedAt).getTime()-new Date(H.completedAt).getTime())});const ee=Object.keys(E).sort((Q,H)=>{const I=new Date(E[Q][0].completedAt);return new Date(E[H][0].completedAt).getTime()-I.getTime()});return{groupedByWeek:E,sortedKeys:ee}},V=()=>{const E={};A.forEach(Q=>{if(!Q.completedAt)return;const H=new Date(Q.completedAt),I=qe(H,d.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:m});E[I]||(E[I]=[]),E[I].push(Q)}),Object.values(E).forEach(Q=>{Q.sort((H,I)=>!H.completedAt||!I.completedAt?0:new Date(I.completedAt).getTime()-new Date(H.completedAt).getTime())});const ee=Object.keys(E).sort((Q,H)=>{const I=new Date(E[Q][0].completedAt);return new Date(E[H][0].completedAt).getTime()-I.getTime()});return{groupedByMonth:E,sortedKeys:ee}},ce=E=>{const ee=new Set(x);ee.has(E)?ee.delete(E):ee.add(E),f(ee)},ke=()=>{k(E=>{switch(E){case"yesterday":return"lastWeek";case"lastWeek":return"lastMonth";case"lastMonth":return"yesterday";default:return"yesterday"}})},Se=E=>{const ee={low:"text-gray-500 bg-gray-100 dark:bg-gray-800",medium:"text-blue-700 bg-blue-100 dark:bg-blue-900/30",high:"text-orange-700 bg-orange-100 dark:bg-orange-900/30",urgent:"text-red-700 bg-red-100 dark:bg-red-900/30"},Q=()=>{o(E.id)};return a.jsx("div",{className:`border-l-2 border-green-500 p-2 sm:p-3 rounded-r-lg ${g?"bg-green-50/20 backdrop-blur-none":"bg-green-50 dark:bg-green-900/10"}`,style:g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.05))`}:{},children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[a.jsx(co,{className:"w-3 h-3 text-green-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-green-800 dark:text-green-300 line-through truncate",children:E.isSubTask?`â†³ ${E.title} (${E.parentTitle})`:E.title})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-1 mb-1",children:[E.isSubTask?E.parentDescription&&a.jsx("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 py-0.5 rounded text-xs",children:E.parentDescription}):E.description&&a.jsx("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 py-0.5 rounded text-xs",children:E.description}),a.jsxs("span",{className:`px-1 py-0.5 rounded text-xs ${ee[E.priority]}`,children:[E.priority==="low"&&c("modal.addTodo.low"),E.priority==="medium"&&c("modal.addTodo.medium"),E.priority==="high"&&c("modal.addTodo.high"),E.priority==="urgent"&&c("modal.addTodo.urgent")]}),E.isSubTask&&a.jsx("span",{className:"bg-indigo-200 dark:bg-indigo-800 text-indigo-700 dark:text-indigo-300 px-1 py-0.5 rounded text-xs",children:"í•˜ìœ„ì‘ì—…"}),E._isRecurringInstance&&a.jsx("span",{className:"bg-purple-200 dark:bg-purple-800 text-purple-700 dark:text-purple-300 px-1 py-0.5 rounded text-xs",children:"ë°˜ë³µí• ì¼"}),E.type==="project"&&a.jsx("span",{className:"bg-green-200 dark:bg-green-800 text-green-700 dark:text-green-300 px-1 py-0.5 rounded text-xs",children:E.project==="longterm"?"ë¡±í…€":"ìˆí…€"})]}),E.completedAt&&a.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(gr,{className:"w-3 h-3"}),Qx(E.completedAt)," ì™„ë£Œ"]})})]}),a.jsx("div",{className:"flex items-start",children:a.jsx("button",{onClick:Q,className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded transition-colors",title:"ì™„ë£Œ ì·¨ì†Œ",children:a.jsx(Ql,{className:"w-3 h-3 text-green-600 dark:text-green-400"})})})]})},E.id)},me=(E,ee,Q,H)=>{if(ee.length===0)return null;const I=x.has(Q);return a.jsxs("div",{className:"mb-4",children:[a.jsxs("button",{onClick:()=>ce(Q),className:`w-full flex items-center justify-between p-2 sm:p-3 rounded-lg transition-colors ${g?"backdrop-blur-none hover:bg-white/10":"bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700"}`,style:g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("div",{className:"w-4 h-4 flex-shrink-0",children:H}),a.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-white flex-1 leading-tight",children:[E," (",ee.length,"ê°œ)"]})]}),I?a.jsx(fa,{className:"w-4 h-4 flex-shrink-0"}):a.jsx(gs,{className:"w-4 h-4 flex-shrink-0"})]}),I&&a.jsx("div",{className:"mt-2 space-y-2",children:ee.map(Se)})]},Q)},ue=W(),Y=X(),ie=V(),de=A.length,be=()=>{switch(v){case"yesterday":return{count:z.yesterday.length,label:"ì–´ì œ",color:"text-orange-600 dark:text-orange-400"};case"lastWeek":return{count:z.lastWeek.length,label:"ì €ë²ˆì£¼",color:"text-indigo-600 dark:text-indigo-400"};case"lastMonth":return{count:z.lastMonth.length,label:"ì €ë²ˆë‹¬",color:"text-pink-600 dark:text-pink-400"};default:return{count:z.yesterday.length,label:"ì–´ì œ",color:"text-orange-600 dark:text-orange-400"}}},fe=()=>{if(y==="daily"){const{groupedByDay:E,sortedKeys:ee}=ue;return a.jsx("div",{className:"space-y-4",children:ee.map(Q=>me(Q,E[Q],`day-${Q}`,a.jsx(at,{className:"w-5 h-5 text-blue-600"})))})}else if(y==="weekly"){const{groupedByWeek:E,sortedKeys:ee}=Y;return a.jsx("div",{className:"space-y-4",children:ee.map(Q=>me(Q,E[Q],`week-${Q}`,a.jsx(at,{className:"w-5 h-5 text-purple-600"})))})}else if(y==="monthly"){const{groupedByMonth:E,sortedKeys:ee}=ie;return a.jsx("div",{className:"space-y-4",children:ee.map(Q=>me(Q,E[Q],`month-${Q}`,a.jsx(at,{className:"w-5 h-5 text-indigo-600"})))})}return a.jsxs("div",{className:"space-y-4",children:[me(c("history.today"),z.today,"today",a.jsx(co,{className:"w-5 h-5 text-green-600"})),me(c("history.yesterday"),z.yesterday,"yesterday",a.jsx(at,{className:"w-5 h-5 text-blue-600"})),me(c("history.thisWeek"),z.thisWeek,"thisWeek",a.jsx(at,{className:"w-5 h-5 text-purple-600"})),me(c("history.lastWeek"),z.lastWeek,"lastWeek",a.jsx(at,{className:"w-5 h-5 text-orange-600"})),me(c("history.thisMonth"),z.thisMonth,"thisMonth",a.jsx(at,{className:"w-5 h-5 text-indigo-600"})),me(c("history.lastMonth"),z.lastMonth,"lastMonth",a.jsx(at,{className:"w-5 h-5 text-pink-600"})),me(c("history.older"),z.older,"older",a.jsx(gr,{className:"w-5 h-5 text-gray-600"}))]})};return a.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-1",children:c("history.title")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:c("history.totalCount",{count:de})})]}),a.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[{key:"period",label:"ê¸°ê°„ë³„"},{key:"daily",label:"ì¼ë³„"},{key:"weekly",label:"ì£¼ë³„"},{key:"monthly",label:"ì›”ë³„"}].map(({key:E,label:ee})=>a.jsx("button",{onClick:()=>w(E),className:`flex-1 px-2 py-1.5 text-xs sm:text-sm font-medium rounded-md transition-colors ${y===E?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:c(`history.${E}`)},E))}),y==="period"&&a.jsx("div",{className:j,style:D,children:a.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[a.jsxs("div",{className:"text-center px-2 py-2",children:[a.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600 dark:text-green-400",children:z.today.length}),a.jsx("div",{className:"text-xs text-green-700 dark:text-green-300 leading-tight",children:c("history.today")})]}),a.jsxs("div",{className:"text-center px-2 py-2",children:[a.jsx("div",{className:"text-lg sm:text-xl font-bold text-blue-600 dark:text-blue-400",children:z.today.length+z.yesterday.length+z.thisWeek.length}),a.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300 leading-tight",children:c("history.thisWeek")})]}),a.jsxs("div",{className:"text-center px-2 py-2",children:[a.jsx("div",{className:"text-lg sm:text-xl font-bold text-purple-600 dark:text-purple-400",children:de-z.lastMonth.length-z.older.length}),a.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300 leading-tight",children:c("history.thisMonth")})]}),a.jsxs("button",{onClick:ke,className:"text-center px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors cursor-pointer",title:"í´ë¦­í•˜ì—¬ ì–´ì œ â†’ ì €ë²ˆì£¼ â†’ ì €ë²ˆë‹¬ ìˆœí™˜",children:[a.jsx("div",{className:`text-lg sm:text-xl font-bold ${be().color}`,children:be().count}),a.jsx("div",{className:`text-xs leading-tight ${be().color.replace("text-","text-").replace("600","700").replace("400","300")}`,children:be().label})]})]})}),y==="daily"&&a.jsxs("div",{className:`${j} text-center`,style:D,children:[a.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:ue.sortedKeys.length}),a.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:c("history.completedDay")})]}),y==="weekly"&&a.jsxs("div",{className:`${j} text-center`,style:D,children:[a.jsx("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:Y.sortedKeys.length}),a.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300",children:c("history.completedWeek")})]}),y==="monthly"&&a.jsxs("div",{className:`${j} text-center`,style:D,children:[a.jsx("div",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:ie.sortedKeys.length}),a.jsx("div",{className:"text-xs text-indigo-700 dark:text-indigo-300",children:c("history.completedMonth")})]}),a.jsx("div",{className:"space-y-4",children:fe()}),de===0&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(co,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:c("history.empty")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:c("history.emptyHint")})]})]})},oC=({onClose:t})=>{const{todos:e}=ot(),{customHolidays:r}=nn(),[s,n]=p.useState("default"),[i,o]=p.useState(!1),l={dueReminders:!0,dueReminderTiming:60,time:"09:00",advanceDays:0,startReminder:!1,startReminderTime:"09:00",weeklyReport:!1,weeklyReportTime:"09:00",dailyReminder:!0,dailyReminderTime:"09:00",dailyRecurrence:[1,2,3,4,5],dailyExcludeHolidays:!1},[c,d]=p.useState(l);p.useEffect(()=>{(async()=>{try{const{Capacitor:v}=await Je(async()=>{const{Capacitor:k}=await Promise.resolve().then(()=>ms);return{Capacitor:k}},void 0,import.meta.url);if(v.isNativePlatform())try{const k=await Nr.checkPermissions(),b=k.display==="prompt"?"default":k.display;n(b),console.log("Native permission status:",b)}catch(k){console.error("Failed to check native permissions:",k),n("denied")}else n(typeof Notification<"u"?Notification.permission:"default")}catch(v){console.error("Permission check failed",v),n(typeof Notification<"u"?Notification.permission:"default")}})(),o(Nr.isSupported());const w=localStorage.getItem("notification-settings");if(w){const v=JSON.parse(w);v.reminderTime&&!v.dailyReminderTime&&(v.dailyReminderTime=v.reminderTime),d({...l,...v,dueReminderTiming:v.dueReminderTiming??(v.advanceDays?v.advanceDays*24*60:60)})}},[]);const u=async()=>{const y=await Nr.requestPermission();n(y?"granted":"denied")},h=async()=>{try{if(typeof Nr.checkPermissions=="function"){const y=await Nr.checkPermissions(),w=y.display==="prompt"?"default":y.display;console.log("Manual check result:",w),n(w),alert(w==="denied"?`âš ï¸ ì—¬ì „íˆ ê¶Œí•œì´ "ì°¨ë‹¨" ìƒíƒœì…ë‹ˆë‹¤.

ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ ê¶Œí•œì„ í—ˆìš©í–ˆëŠ”ë°ë„ ì´ ë©”ì‹œì§€ê°€ ëœ¬ë‹¤ë©´, ì•±ì„ ì™„ì „íˆ ì¢…ë£Œí–ˆë‹¤ê°€ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.`:w==="granted"?"âœ… ê¶Œí•œì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.":`í˜„ì¬ ê¶Œí•œ ìƒíƒœ: ${w}
ì•Œë¦¼ì„ í—ˆìš©í•˜ë ¤ë©´ "í—ˆìš©í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`)}else await u()}catch(y){console.error("Failed to check permission manually:",y),alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${y.message||JSON.stringify(y)}`)}},g=async(y,w)=>{const v={...c,[y]:w};d(v),localStorage.setItem("notification-settings",JSON.stringify(v)),s==="granted"&&await Nr.scheduleAllNotifications(v,e,r)},m=y=>{const w=c.dailyRecurrence||[];let v;w.includes(y)?v=w.filter(k=>k!==y):v=[...w,y].sort(),g("dailyRecurrence",v)},x=async()=>{try{await Nr.showNotification({title:"í…ŒìŠ¤íŠ¸ ì•Œë¦¼",body:"ì•Œë¦¼ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤! ğŸ‰",tag:"test"}),alert(`í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.
(ì ì‹œ í›„ ë„ì°©í•©ë‹ˆë‹¤)`)}catch(y){alert("í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì‹¤íŒ¨: "+y.message)}},f=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];return i?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ì•Œë¦¼ ì„¤ì •"}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"âœ•"})]}),a.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto flex-1",children:[a.jsxs("div",{className:"space-y-3",children:[s==="default"&&a.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg",children:[a.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 mb-2",children:"ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."}),a.jsx("button",{onClick:u,className:"w-full px-3 py-2 bg-yellow-600 text-white text-sm rounded-lg",children:"í—ˆìš©í•˜ê¸°"})]}),s==="denied"&&a.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg",children:[a.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[a.jsx("span",{className:"text-xl",children:"âš ï¸"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-bold text-red-800 dark:text-red-200",children:"ì•Œë¦¼ ê¶Œí•œì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤."}),a.jsx("p",{className:"text-xs text-red-600 dark:text-red-300 mt-1",children:"ì„¤ì • ì•±ì—ì„œ ì•Œë¦¼ì„ ì¼œì£¼ì„¸ìš”."})]})]}),a.jsx("button",{onClick:h,className:"w-full px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:"ê¶Œí•œ ë‹¤ì‹œ í™•ì¸í•˜ê¸° â†»"})]}),s==="granted"&&a.jsx("button",{onClick:x,className:"w-full px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700",children:"í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë³´ë‚´ê¸°"})]}),s==="granted"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-3 border-b border-gray-200 dark:border-gray-700 pb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ì¼ê°„ ë¸Œë¦¬í•‘"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ë§¤ì¼ ì•„ì¹¨ ì˜¤ëŠ˜ì˜ í• ì¼ ë¸Œë¦¬í•‘"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.dailyReminder,onChange:y=>g("dailyReminder",y.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.dailyReminder&&a.jsxs("div",{className:"space-y-4 pl-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ì‹œê°„"}),a.jsx("input",{type:"time",value:c.dailyReminderTime,onChange:y=>g("dailyReminderTime",y.target.value),className:"px-2 py-1 border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 block mb-2",children:"ë°˜ë³µ ìš”ì¼"}),a.jsx("div",{className:"flex justify-between gap-1",children:f.map((y,w)=>a.jsx("button",{onClick:()=>m(w),className:`w-8 h-8 rounded-full text-xs font-medium transition-colors ${c.dailyRecurrence?.includes(w)?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:y},w))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ê³µíœ´ì¼ ì œì™¸"}),a.jsx("input",{type:"checkbox",checked:c.dailyExcludeHolidays,onChange:y=>g("dailyExcludeHolidays",y.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})]})]})]}),a.jsxs("div",{className:"space-y-3 border-b border-gray-200 dark:border-gray-700 pb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ì‹œì‘ì¼ ì•Œë¦¼"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"í• ì¼ ì‹œì‘ ì‹œê°„ì— ì•Œë¦¼"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.startReminder,onChange:y=>g("startReminder",y.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.startReminder&&a.jsxs("div",{className:"flex items-center justify-between pl-2",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ì‹œê°„"}),a.jsx("input",{type:"time",value:c.startReminderTime||"09:00",onChange:y=>g("startReminderTime",y.target.value),className:"px-2 py-1 border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),a.jsxs("div",{className:"space-y-3 border-b border-gray-200 dark:border-gray-700 pb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ì£¼ê°„ ë¦¬í¬íŠ¸"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ë§¤ì£¼ ì›”ìš”ì¼ ì§€ë‚œì£¼ ì„±ê³¼ ìš”ì•½"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.weeklyReport,onChange:y=>g("weeklyReport",y.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.weeklyReport&&a.jsxs("div",{className:"flex items-center justify-between pl-2",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ì‹œê°„"}),a.jsx("input",{type:"time",value:c.weeklyReportTime||"09:00",onChange:y=>g("weeklyReportTime",y.target.value),className:"px-2 py-1 border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ë§ˆê° ì„ë°• ì•Œë¦¼"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"í• ì¼ ë§ˆê° ì „ ë¯¸ë¦¬ ì•Œë¦¼"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.dueReminders,onChange:y=>g("dueReminders",y.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.dueReminders&&a.jsx("div",{className:"pl-2",children:a.jsxs("select",{value:c.dueReminderTiming,onChange:y=>g("dueReminderTiming",Number(y.target.value)),className:"w-full px-3 py-2 border rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[a.jsx("option",{value:10,children:"10ë¶„ ì „"}),a.jsx("option",{value:30,children:"30ë¶„ ì „"}),a.jsx("option",{value:60,children:"1ì‹œê°„ ì „"}),a.jsx("option",{value:180,children:"3ì‹œê°„ ì „"}),a.jsx("option",{value:1440,children:"1ì¼ ì „"}),a.jsx("option",{value:2880,children:"2ì¼ ì „"})]})})]})]})]}),a.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:a.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"ì™„ë£Œ"})})]})}):a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl mb-4",children:"âŒ"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"ì•Œë¦¼ ì§€ì› ì•ˆë¨"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"í˜„ì¬ í™˜ê²½ì—ì„œëŠ” ì•Œë¦¼ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."}),a.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg",children:"í™•ì¸"})]})})})},lC=Ar("TodoListWidget"),cC=Object.freeze(Object.defineProperty({__proto__:null,default:lC},Symbol.toStringTag,{value:"Module"})),c0=async t=>{try{const{Capacitor:e}=await Je(async()=>{const{Capacitor:f}=await Promise.resolve().then(()=>ms);return{Capacitor:f}},void 0,import.meta.url);if(!e.isNativePlatform()||e.getPlatform()!=="android")return;let r;try{r=(await Je(()=>Promise.resolve().then(()=>cC),void 0,import.meta.url)).default}catch(f){console.warn("Widget plugin not found",f);return}if(!r)return;let s,n=[];Array.isArray(t)?s=t:(s=t.todos,n=t.vacations||[]);const i=new Date;i.setHours(0,0,0,0),console.log("ğŸ“± syncWidget: Starting with",s.length,"todos,",n.length,"vacations");const o=s.filter(f=>{if(f.completed&&f.completedAt){const y=new Date(f.completedAt);return y.setHours(0,0,0,0),y.getTime()===i.getTime()}if(!f.completed){if(f.startDate){const y=new Date(f.startDate);return y.setHours(0,0,0,0),i>=y}if(f.dueDate){const y=new Date(f.dueDate);return y.setHours(0,0,0,0),i>=y}return!0}return!1});console.log("ğŸ“± syncWidget: Filtered to",o.length,"today todos");const c=[...o].sort((f,y)=>{const w={urgent:0,high:1,medium:2,low:3},v=w[f.priority]??2,k=w[y.priority]??2;return v!==k?v-k:f.dueDate&&y.dueDate?new Date(f.dueDate).getTime()-new Date(y.dueDate).getTime():f.dueDate?-1:y.dueDate?1:(f.order??0)-(y.order??0)}).slice(0,30).map(f=>{let y="",w="",v="";if(f.dueDate)try{y=f.dueDate instanceof Date?f.dueDate.toISOString():new Date(f.dueDate).toISOString()}catch{y=String(f.dueDate)}if(f.startDate)try{w=f.startDate instanceof Date?f.startDate.toISOString():new Date(f.startDate).toISOString()}catch{w=String(f.startDate)}if(f.completedAt)try{v=f.completedAt instanceof Date?f.completedAt.toISOString():new Date(f.completedAt).toISOString()}catch{v=String(f.completedAt)}const k=f.subTasks||[],b=k.filter(D=>D.completed).length,j=k.length>0?Math.round(b/k.length*100):-1;return{id:f.id||"",title:f.title||"",completed:f.completed||!1,priority:f.priority||"medium",description:f.description||"",dueDate:y,startDate:w,completedAt:v,progress:j}});console.log("ğŸ“± syncWidget: Today widget data:",c.length,"items");const h=[...s.filter(f=>{if(f.completed&&f.completedAt){const y=new Date;y.setHours(0,0,0,0);const w=new Date(f.completedAt);if(w.setHours(0,0,0,0),w.getTime()===y.getTime())return!0}return f.completed?!1:(f.startDate||f.dueDate||f.recurrence&&f.recurrence!=="none",!0)})].sort((f,y)=>{const w={urgent:0,high:1,medium:2,low:3},v=w[f.priority]??2,k=w[y.priority]??2;return v-k}).map(f=>{let y="",w="",v="";if(f.dueDate)try{y=f.dueDate instanceof Date?f.dueDate.toISOString():new Date(f.dueDate).toISOString()}catch{y=String(f.dueDate)}if(f.startDate)try{w=f.startDate instanceof Date?f.startDate.toISOString():new Date(f.startDate).toISOString()}catch{w=String(f.startDate)}if(f.completedAt)try{v=f.completedAt instanceof Date?f.completedAt.toISOString():new Date(f.completedAt).toISOString()}catch{v=String(f.completedAt)}return{id:f.id||"",title:f.title||"",completed:f.completed||!1,priority:f.priority||"medium",dueDate:y,startDate:w,completedAt:v}});console.log("ğŸ“± syncWidget: Calendar widget data:",h.length,"items");const g=n.map(f=>({id:f.id,date:f.date,type:f.type,employeeName:f.employeeName||""}));console.log("ğŸ“± syncWidget: Vacation data:",g.length,"items");const m=parseInt(localStorage.getItem("widgetTransparency")||"80"),x={today:c,calendar:h,vacations:g};console.log("ğŸ“± syncWidget: Sending combined data to native..."),await r.updateWidget({data:JSON.stringify(x),date:new Date().toLocaleDateString(),transparency:m}),console.log("ğŸ“± syncWidget: SUCCESS!")}catch(e){console.error("Widget sync failed",e)}},dC=({isOpen:t,onClose:e})=>t?Ur.createPortal(a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-lg max-h-[85vh] flex flex-col animate-scale-in",onClick:r=>r.stopPropagation(),children:[a.jsxs("div",{className:"shrink-0 flex items-center justify-between p-4 border-b border-gray-100 dark:border-gray-700 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-t-2xl",children:[a.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx("span",{className:"text-xl",children:"ğŸ“š"})," Google Tasks ì—°ë™ ê°€ì´ë“œ"]}),a.jsx("button",{onClick:e,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6 space-y-8 overflow-y-auto",children:[a.jsxs("section",{className:"space-y-3",children:[a.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-primary-100 text-primary-600 text-sm font-bold",children:"1"}),"ì—°ë™ ì‹œì‘í•˜ê¸°"]}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 pl-8",children:["ì‚¬ì´ë“œë°” í•˜ë‹¨ì˜ ",a.jsx("span",{className:"font-semibold text-primary-600 dark:text-primary-400",children:"Google Tasks"})," ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¡œê·¸ì¸ì„ ì§„í–‰í•´ì£¼ì„¸ìš”."]})]}),a.jsxs("section",{className:"space-y-3",children:[a.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-orange-100 text-orange-600 text-sm font-bold",children:"2"}),"'í™•ì¸ë˜ì§€ ì•Šì€ ì•±' ê²½ê³  í•´ê²°"]}),a.jsxs("div",{className:"pl-8 space-y-3",children:[a.jsx("div",{className:"p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-100 dark:border-orange-900/30 rounded-xl text-sm text-orange-800 dark:text-orange-200",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(rx,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("p",{children:"ì•±ì´ Googleì˜ ì •ì‹ ìŠ¹ì¸ì„ ë°›ê¸° ì „ê¹Œì§€ëŠ” ë³´ì•ˆ ê²½ê³  í™”ë©´ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì •ìƒì ì¸ ê³¼ì •ì…ë‹ˆë‹¤."})]})}),a.jsxs("ol",{className:"list-decimal pl-4 space-y-2 text-sm text-gray-600 dark:text-gray-400 marker:text-gray-400",children:[a.jsxs("li",{children:["ê²½ê³  í™”ë©´ ì¢Œì¸¡ í•˜ë‹¨ì˜ ",a.jsx("span",{className:"font-bold text-gray-800 dark:text-gray-200",children:"ê³ ê¸‰(Advanced)"})," ê¸€ìë¥¼ í´ë¦­í•©ë‹ˆë‹¤."]}),a.jsxs("li",{children:["í¼ì³ì§„ ë‚´ìš© í•˜ë‹¨ì˜",a.jsx("span",{className:"block mt-1 p-2 bg-gray-100 dark:bg-gray-700/50 rounded text-xs break-all font-mono",children:"todolist-116f3.firebaseapp.com(ìœ¼)ë¡œ ì´ë™(ì•ˆì „í•˜ì§€ ì•ŠìŒ)"}),"ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤."]}),a.jsxs("li",{children:["ê¶Œí•œ ìš”ì²­ í™”ë©´ì—ì„œ ",a.jsx("span",{className:"font-bold text-blue-600",children:"ê³„ì†/í—ˆìš©"}),"ì„ ì„ íƒí•©ë‹ˆë‹¤."]})]})]})]}),a.jsxs("section",{className:"space-y-3",children:[a.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-600 text-sm font-bold",children:"3"}),"(ê°œë°œììš©) API í™œì„±í™” í•„ìš” ì‹œ"]}),a.jsxs("div",{className:"pl-8 space-y-3",children:[a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ë§Œì•½ ",a.jsx("b",{children:'"API has not been used in project"'})," ë˜ëŠ” ",a.jsx("b",{children:"403 Forbidden"})," ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´, Google Cloud Consoleì—ì„œ APIë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤."]}),a.jsxs("a",{href:"https://console.developers.google.com/apis/api/tasks.googleapis.com/overview?project=470825187407",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-xl transition-colors text-sm font-medium group",children:[a.jsx(sx,{className:"w-4 h-4"}),"Google Tasks API í™œì„±í™” í˜ì´ì§€ ë°”ë¡œê°€ê¸°"]}),a.jsxs("div",{className:"flex gap-2 items-start text-xs text-gray-500 dark:text-gray-400",children:[a.jsx(Cn,{className:"w-4 h-4 text-green-500 mt-0.5"}),a.jsxs("span",{children:["ìœ„ ë§í¬ ì ‘ì† í›„ ìƒë‹¨ì˜ ",a.jsx("b",{children:"ì‚¬ìš©(ENABLE)"})," ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í•´ê²°ë©ë‹ˆë‹¤."]})]})]})]}),a.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl text-xs text-gray-500 dark:text-gray-400 text-center leading-relaxed",children:["ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ë©´, ",a.jsx("b",{children:"ì„¤ì • > Google Tasks Auto-Sync"})," í† ê¸€ì„ ì¼œì„œ ì•± ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ í•  ì¼ì„ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."]})]}),a.jsx("div",{className:"shrink-0 p-4 border-t border-gray-100 dark:border-gray-700 flex justify-end",children:a.jsx("button",{onClick:e,className:"px-6 py-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-medium rounded-xl hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors",children:"í™•ì¸"})})]})}),document.body):null,Lo="lkd0115lkd@gmail.com";function uC(){const{currentUser:t}=bt(),{isDark:e}=Et(),[r,s]=p.useState([]),[n,i]=p.useState(""),[o,l]=p.useState(!1),[c,d]=p.useState(null);p.useEffect(()=>{const g=te.subscribeToVacationAccessList(m=>{s(m)});return()=>g()},[]);const u=async g=>{if(g.preventDefault(),!!n.trim()){l(!0),d(null);try{await te.addVacationAccessEmail(n.trim()),i("")}catch(m){console.error(m),d("ì´ë©”ì¼ ì¶”ê°€ ì‹¤íŒ¨: ê¶Œí•œì´ ì—†ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì…ë‹ˆë‹¤.")}finally{l(!1)}}},h=async g=>{if(window.confirm(`${g} ê³„ì •ì˜ ê¶Œí•œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){l(!0),d(null);try{await te.removeVacationAccessEmail(g)}catch(m){console.error(m),d("ì‚­ì œ ì‹¤íŒ¨")}finally{l(!1)}}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:a.jsx(Li,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"íœ´ê°€ ê´€ë¦¬ ì ‘ê·¼ ê¶Œí•œ"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"íœ´ê°€ ê´€ë¦¬ ë©”ë‰´ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ì‚¬ìš©ìë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤."})]})]}),c&&a.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg flex items-center gap-2 text-sm",children:[a.jsx(tc,{className:"w-4 h-4"}),c]}),a.jsxs("form",{onSubmit:u,className:"flex gap-2",children:[a.jsx("input",{type:"email",value:n,onChange:g=>i(g.target.value),placeholder:"í—ˆìš©í•  êµ¬ê¸€ ì´ë©”ì¼ ì…ë ¥",className:"flex-1 px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-purple-500 outline-none transition-all",disabled:o}),a.jsxs("button",{type:"submit",disabled:o||!n.trim(),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[a.jsx(ct,{className:"w-4 h-4"}),"ì¶”ê°€"]})]}),a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-200/50 dark:border-gray-700/50 overflow-hidden",children:a.jsxs("ul",{className:"divide-y divide-gray-200/50 dark:divide-gray-700/50",children:[a.jsx("li",{className:"flex items-center justify-between p-4 bg-purple-50/50 dark:bg-purple-900/10 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-gradient-to-br from-yellow-300 to-yellow-500 rounded-full text-white shadow-sm ring-2 ring-white dark:ring-gray-800",children:a.jsx(nx,{className:"w-4 h-4 fill-current"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-gray-900 dark:text-white font-bold",children:Lo}),a.jsx("span",{className:"px-2 py-0.5 text-[10px] bg-purple-100 text-purple-700 rounded-full dark:bg-purple-900 dark:text-purple-300 font-bold border border-purple-200 dark:border-purple-800",children:"Super Admin"})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"ìµœê³  ê´€ë¦¬ì (í•­ìƒ ì ‘ê·¼ ê°€ëŠ¥)"})]})]})}),r.filter(g=>g!==Lo).map(g=>a.jsxs("li",{className:"flex items-center justify-between p-4 hover:bg-white dark:hover:bg-gray-800 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3 pl-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400 text-xs font-medium",children:g[0].toUpperCase()}),a.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:g})]}),a.jsx("button",{onClick:()=>h(g),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all",title:"ê¶Œí•œ ì‚­ì œ",children:a.jsx($t,{className:"w-4 h-4"})})]},g)),r.filter(g=>g!==Lo).length===0&&a.jsx("li",{className:"p-8 text-center text-gray-400 dark:text-gray-500 text-sm",children:"ì¶”ê°€ëœ ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤."})]})})]})}const hC=()=>{const{t,i18n:e}=Xe(),{currentUser:r,logout:s}=bt(),{todos:n,exportData:i,importData:o,clearCompleted:l,stats:c,syncing:d,syncWithCloud:u,getRecurringTodos:h}=ot(),{theme:g,setTheme:m,currentThemeId:x,setCurrentThemeId:f,currentTheme:y,isDark:w,transparency:v,setTransparency:k}=Et(),b=!!y.bg,{fontSizeLevel:j,setFontSizeLevel:D}=LN(),{customHolidays:N,addCustomHoliday:T,deleteCustomHoliday:_}=nn(),{vacations:P,employees:C}=cn(),[A,B]=p.useState(null),[z,W]=p.useState(!1),[X,V]=p.useState("colors"),[ce,ke]=p.useState(!1),[Se,me]=p.useState(""),[ue,Y]=p.useState(""),[ie,de]=p.useState(!1),[be,fe]=p.useState("last"),[E,ee]=p.useState(()=>parseInt(localStorage.getItem("widgetTransparency")||"80")),[Q,H]=p.useState(!1),[I,J]=p.useState(!1),[le,L]=p.useState(!1);Ze.useEffect(()=>{r&&te.getUserSettings(r.uid).then(q=>{q?.startScreen&&fe(q.startScreen),q?.googleTasksLinked&&J(!0),q?.autoSyncGoogleTasks&&H(!0)})},[r]);const G=async q=>{if(fe(q),r)try{await te.updateUserStartScreen(r.uid,q)}catch(we){console.error("Failed to update start screen:",we)}},O=async q=>{const we=q.target.checked;if(H(we),r)try{await te.updateGoogleTasksSettings(r.uid,{autoSync:we})}catch(Be){console.error("Failed to update auto-sync setting:",Be),H(!we)}},se=q=>{const we=q.target.files?.[0];if(!we)return;const Be=new FileReader;Be.onload=async S=>{try{const $=S.target?.result;await o($)?(B(null),W(!0),setTimeout(()=>W(!1),3e3)):B(t("settings.data.invalidFormat"))}catch{B(t("settings.data.importError"))}},Be.readAsText(we),q.target.value=""},he=()=>{const q=i(),we=new Blob([q],{type:"application/json"}),Be=URL.createObjectURL(we),S=document.createElement("a");S.href=Be,S.download=`todos-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(Be)},pe=async q=>{if(q.preventDefault(),!(!Se||!ue))try{await T(Se,ue,ie),me(""),Y(""),de(!1)}catch(we){console.error("Failed to add holiday:",we),alert(t("common.error"))}},re=async q=>{if(confirm(t("settings.holiday.confirmDelete")))try{await _(q)}catch(we){console.error("Failed to delete holiday:",we),alert(t("common.error"))}},Ae=()=>{const q=c?.completed||0;if(q===0){alert(t("settings.data.noCompleted"));return}confirm(t("settings.data.confirmClear",{count:q}))&&l()},K=async()=>{if(confirm(t("settings.account.confirmLogout")))try{await s()}catch(q){console.error("Logout failed:",q)}},xe=async()=>{try{await u()}catch(q){console.error("Sync failed:",q)}},Fe=()=>{try{const q=localStorage.getItem("todolist-app-todos");if(q)return`${(new Blob([q]).size/1024).toFixed(2)} KB`}catch(q){console.error("Storage size calculation failed:",q)}return"0 KB"};return a.jsx("div",{className:"pb-safe min-h-safe bg-transparent",children:a.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-8 animate-fade-in-up",children:[a.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700",children:a.jsx(em,{className:"w-8 h-8 text-primary-600 dark:text-primary-400"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("settings.title")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("settings.subtitle")})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.1s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-primary-50 dark:bg-primary-900/30 flex items-center justify-center text-primary-600 dark:text-primary-400",children:a.jsx(Yn,{className:"w-5 h-5",strokeWidth:2})}),t("settings.account.title")]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 backdrop-blur-sm",children:[r?.photoURL?a.jsx("img",{src:r.photoURL,alt:r.email||"User",className:"w-12 h-12 rounded-full object-cover shadow-sm border border-gray-200 dark:border-gray-700"}):a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-100 to-primary-200 dark:from-primary-900 dark:to-primary-800 rounded-full flex items-center justify-center text-primary-600 dark:text-primary-300 font-bold text-xl shadow-inner",children:r?.email?.[0].toUpperCase()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:r?.email}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),t("settings.account.loggedIn")]})]}),a.jsx("button",{onClick:xe,disabled:d,className:`p-2.5 rounded-xl border transition-all duration-200 ${d?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white dark:bg-gray-700 text-primary-600 dark:text-primary-400 border-gray-200 dark:border-gray-600 hover:border-primary-300 hover:shadow-md active:scale-95"}`,title:t("settings.account.sync"),children:a.jsx(Za,{className:`w-5 h-5 ${d?"animate-spin":""}`})})]}),a.jsxs("button",{onClick:K,className:"w-full flex items-center justify-center gap-2 p-4 rounded-xl border border-red-100 dark:border-red-900/30 text-red-600 dark:text-red-400 font-medium hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200 group relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-red-100/50 dark:bg-red-900/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"}),a.jsx(tm,{className:"w-5 h-5 relative z-10"}),a.jsx("span",{className:"relative z-10",children:t("settings.account.logout")})]})]})]}),r?.email==="lkd0115lkd@gmail.com"&&a.jsx("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.12s"},children:a.jsx(uC,{})}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.15s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-cyan-50 dark:bg-cyan-900/30 flex items-center justify-center text-cyan-600 dark:text-cyan-400",children:a.jsx(Rd,{className:"w-5 h-5",strokeWidth:2})}),t("settings.general.startScreen")]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[{key:"last",label:t("settings.general.lastView")},{key:"today",label:t("settings.general.today")},{key:"week",label:t("settings.general.week")},{key:"month",label:t("settings.general.month")}].map(q=>a.jsx("button",{onClick:()=>G(q.key),className:`p-4 rounded-xl border-2 transition-all duration-200 text-sm font-medium ${be===q.key?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-transparent bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400"}`,children:q.label},q.key))}),a.jsxs("div",{className:"pt-6 border-t border-gray-100 dark:border-gray-800",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsxs("span",{children:["Google Tasks ",t("settings.sync","Auto-Sync")]}),I&&a.jsx("span",{className:"px-2 py-0.5 text-[10px] bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-full font-bold",children:"LINKED"}),a.jsx("button",{onClick:()=>L(!0),className:"p-1 text-gray-400 hover:text-primary-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",title:"ì—°ë™ ê°€ì´ë“œ ë³´ê¸°",children:a.jsx(ax,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ì•± ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ Google Tasksë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤."})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:Q,onChange:O,disabled:!I,className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]}),!I&&a.jsxs("p",{className:"text-xs text-orange-500 mt-2 bg-orange-50 dark:bg-orange-900/10 p-2 rounded-lg",children:["âš ï¸ ë¨¼ì € ì‚¬ì´ë“œë°”ì˜ ",a.jsx("b",{children:"Google Tasks"})," ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—°ë™í•´ì£¼ì„¸ìš”."]}),a.jsx(dC,{isOpen:le,onClose:()=>L(!1)})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.2s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-purple-50 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400",children:a.jsx(ix,{className:"w-5 h-5",strokeWidth:2})}),t("settings.appearance.title")]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex p-1 bg-gray-100 dark:bg-gray-800 rounded-xl",children:["mode","background","display"].map(q=>a.jsx("button",{onClick:()=>V(q),className:`flex-1 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${X===q||q==="background"&&(X==="city"||X==="seasonal")||q==="display"&&X==="colors"?"bg-white dark:bg-gray-700 text-primary-600 dark:text-primary-400 shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:t(`settings.tabs.${q}`)||q.charAt(0).toUpperCase()+q.slice(1)},q))}),a.jsxs("div",{className:"min-h-[300px]",children:[X==="mode"&&a.jsx("div",{className:"space-y-6 animate-fade-in",children:a.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{key:"light",icon:ox,label:t("settings.appearance.light")},{key:"dark",icon:lx,label:t("settings.appearance.dark")},{key:"system",icon:Rd,label:t("settings.appearance.system")}].map(q=>a.jsxs("button",{onClick:()=>m(q.key),className:`flex flex-col items-center justify-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 ${g===q.key?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-transparent bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[a.jsx(q.icon,{className:`w-6 h-6 ${g===q.key?"text-primary-500":"text-gray-400"}`}),a.jsx("span",{className:"text-sm font-medium",children:q.label})]},q.key))})}),(X==="background"||X==="seasonal"||X==="city")&&a.jsxs("div",{className:"space-y-6 animate-fade-in",children:[a.jsxs("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:[a.jsx("button",{onClick:()=>V("seasonal"),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${X==="seasonal"?"bg-primary-100 dark:bg-primary-900/40 text-primary-700 dark:text-primary-300":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:t("settings.tabs.seasonal")||"Seasonal"}),a.jsx("button",{onClick:()=>V("city"),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${X==="city"?"bg-primary-100 dark:bg-primary-900/40 text-primary-700 dark:text-primary-300":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:t("settings.tabs.city")||"City"})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(X==="seasonal"||X==="background")&&ls.seasonal.map(q=>a.jsxs("button",{onClick:()=>f(q.id),className:`relative group overflow-hidden rounded-xl aspect-video border-2 transition-all duration-200 ${x===q.id?"border-primary-500 ring-2 ring-primary-500/30":"border-transparent hover:border-gray-200 dark:hover:border-gray-700"}`,children:[a.jsx("img",{src:q.bg,alt:t(q.nameKey),className:"absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),a.jsxs("div",{className:`absolute inset-0 flex items-center justify-center ${x===q.id?"bg-black/40":"bg-black/20 group-hover:bg-black/30"}`,children:[a.jsx("span",{className:"text-white font-medium text-sm drop-shadow-md",children:t(q.nameKey)}),x===q.id&&a.jsx("div",{className:"absolute top-2 right-2 bg-primary-500 rounded-full p-0.5",children:a.jsx(Yt,{className:"w-3 h-3 text-white"})})]})]},q.id)),(X==="city"||X==="background")&&ls.city.map(q=>a.jsxs("button",{onClick:()=>f(q.id),className:`relative group overflow-hidden rounded-xl aspect-video border-2 transition-all duration-200 ${x===q.id?"border-primary-500 ring-2 ring-primary-500/30":"border-transparent hover:border-gray-200 dark:hover:border-gray-700"}`,children:[a.jsx("img",{src:q.bg,alt:t(q.nameKey),className:"absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),a.jsxs("div",{className:`absolute inset-0 flex items-center justify-center ${x===q.id?"bg-black/40":"bg-black/20 group-hover:bg-black/30"}`,children:[a.jsx("span",{className:"text-white font-medium text-sm drop-shadow-md",children:t(q.nameKey)}),x===q.id&&a.jsx("div",{className:"absolute top-2 right-2 bg-primary-500 rounded-full p-0.5",children:a.jsx(Yt,{className:"w-3 h-3 text-white"})})]})]},q.id))]}),y.bg&&a.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.appearance.transparency")}),a.jsxs("span",{className:"text-sm text-gray-500",children:[(v*100).toFixed(0),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:v,onChange:q=>k(parseFloat(q.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-primary-500"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("settings.appearance.transparencyDesc")})]})]}),(X==="display"||X==="colors")&&a.jsx("div",{className:"space-y-8 animate-fade-in",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:t("settings.tabs.colors")}),a.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-3",children:ls.colors.map(q=>a.jsx("button",{onClick:()=>f(q.id),className:`group relative flex flex-col items-center gap-2 p-2 rounded-xl border transition-all duration-200 ${x===q.id?"border-primary-500 bg-primary-50/50 dark:bg-primary-900/20":"border-transparent hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:a.jsx("div",{className:`w-10 h-10 rounded-full shadow-sm flex items-center justify-center ${q.colorClass} text-white`,children:x===q.id&&a.jsx(Yt,{className:"w-5 h-5"})})},q.id))})]})})]})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.25s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400",children:a.jsx(cx,{className:"w-5 h-5",strokeWidth:2})}),t("settings.language.title")]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{type:"button",onClick:()=>{e.changeLanguage("ko"),r&&te.updateUserLanguage(r.uid,"ko")},className:`p-4 rounded-xl border transition-all duration-200 flex flex-col items-center gap-2 ${e.language.startsWith("ko")?b?"bg-primary-500/30 border-primary-400 text-primary-100 font-bold":"bg-primary-50 dark:bg-primary-900/20 border-primary-500 text-primary-700 dark:text-primary-300":b?"glass-card backdrop-blur-none border-white/20 hover:bg-white/10":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-700"}`,style:b&&!e.language.startsWith("ko")?{backgroundColor:`rgba(${w?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsx("span",{className:"text-2xl",children:"ğŸ‡°ğŸ‡·"}),a.jsx("span",{className:"font-medium text-sm",children:t("settings.language.korean")})]}),a.jsxs("button",{type:"button",onClick:()=>{e.changeLanguage("en"),r&&te.updateUserLanguage(r.uid,"en")},className:`p-4 rounded-xl border transition-all duration-200 flex flex-col items-center gap-2 ${e.language.startsWith("en")?b?"bg-primary-500/30 border-primary-400 text-primary-100 font-bold":"bg-primary-50 dark:bg-primary-900/20 border-primary-500 text-primary-700 dark:text-primary-300":b?"glass-card backdrop-blur-none border-white/20 hover:bg-white/10":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-700"}`,style:b&&!e.language.startsWith("en")?{backgroundColor:`rgba(${w?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsx("span",{className:"text-2xl",children:"ğŸ‡ºğŸ‡¸"}),a.jsx("span",{className:"font-medium text-sm",children:t("settings.language.english")})]})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.3s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-orange-50 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400",children:a.jsx(dx,{className:"w-5 h-5",strokeWidth:2})}),t("settings.font.title")]}),a.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-2xl border text-center ${b?"glass-card backdrop-blur-none border-white/20":"bg-gray-50 dark:bg-gray-800 border-gray-100 dark:border-gray-700"}`,style:b?{backgroundColor:`rgba(${w?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsx("button",{onClick:()=>D(Math.max(1,j-1)),disabled:j<=1,className:"p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-30 transition-colors",children:a.jsx("span",{className:"text-xs font-bold text-gray-600 dark:text-gray-300",children:"A"})}),a.jsx("div",{className:"flex-1 px-4",children:a.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-primary-500 transition-all duration-300",style:{width:`${(j-1)/6*100}%`}})})}),a.jsx("button",{onClick:()=>D(Math.min(7,j+1)),disabled:j>=7,className:"p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-30 transition-colors",children:a.jsx("span",{className:"text-xl font-bold text-gray-600 dark:text-gray-300",children:"A"})})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.4s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-red-50 dark:bg-red-900/30 flex items-center justify-center text-red-600 dark:text-red-400",children:a.jsx(at,{className:"w-5 h-5",strokeWidth:2})}),t("settings.holiday.title")]}),a.jsxs("form",{onSubmit:pe,className:"space-y-4 mb-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.holiday.name")}),a.jsx("input",{type:"text",value:ue,onChange:q=>Y(q.target.value),placeholder:t("settings.holiday.namePlaceholder"),className:"glass-input w-full focus:ring-primary-500 focus:border-primary-500"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.holiday.date")}),a.jsx("input",{type:"date",value:Se,onChange:q=>me(q.target.value),className:"glass-input w-full focus:ring-primary-500 focus:border-primary-500"})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[a.jsx("input",{type:"checkbox",checked:ie,onChange:q=>de(q.target.checked),className:" rounded border-gray-300 text-primary-600 focus:ring-primary-500 transition-colors"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors",children:t("settings.holiday.recurring")}),a.jsxs("div",{className:"group relative",children:[a.jsx(Pd,{className:"w-4 h-4 text-gray-400 hover:text-primary-500 cursor-help transition-colors"}),a.jsx("div",{className:"absolute left-1/2 -top-10 -translate-x-1/2 w-48 p-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10 text-center",children:t("settings.holiday.recurringTooltip")})]})]}),a.jsxs("button",{type:"submit",disabled:!Se||!ue,className:"btn-primary flex items-center gap-2 px-6 py-2.5 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed transform active:scale-95 transition-all",children:[a.jsx(ct,{className:"w-4 h-4"}),t("common.add")]})]})]}),N.length>0?a.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto custom-scrollbar pr-2",children:N.map(q=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 hover:border-red-200 dark:hover:border-red-800/50 transition-all group",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${q.isRecurring?"bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400":"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"}`,children:q.isRecurring?a.jsx(Za,{className:"w-4 h-4"}):a.jsx(at,{className:"w-4 h-4"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:q.name}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[q.date," ",q.isRecurring&&`â€¢ ${t("settings.holiday.everyYear")}`]})]})]}),a.jsx("button",{onClick:()=>re(q.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:t("common.delete"),children:a.jsx($t,{className:"w-4 h-4"})})]},q.id))}):a.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 bg-gray-50/50 dark:bg-gray-800/50 rounded-2xl border border-dashed border-gray-200 dark:border-gray-700",children:[a.jsx(at,{className:"w-8 h-8 mx-auto mb-2 opacity-20"}),a.jsx("p",{children:t("settings.holiday.noHolidays")})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.45s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-yellow-50 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-600 dark:text-yellow-400",children:a.jsx(qn,{className:"w-5 h-5",strokeWidth:2})}),t("settings.notification.title")]}),a.jsx("div",{className:"bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 overflow-hidden",children:a.jsxs("button",{onClick:()=>ke(!0),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[a.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:t("settings.notification.configure")}),a.jsx(gs,{className:"w-5 h-5 text-gray-400 group-hover:translate-x-1 transition-transform"})]})})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.5s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:a.jsx(ux,{className:"w-5 h-5",strokeWidth:2})}),t("settings.stats.title")]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:c?.total||0}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:t("settings.stats.total")})]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1",children:c?.completed||0}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:t("settings.stats.completed")})]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400 mb-1",children:c?.pending||0}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:t("settings.stats.pending")})]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center flex flex-col justify-center items-center",children:[a.jsx("div",{className:"text-lg font-bold text-gray-700 dark:text-gray-300 mb-1",children:Fe()}),a.jsxs("div",{className:"text-[10px] text-gray-400 dark:text-gray-500 font-medium uppercase tracking-wider flex items-center gap-1 justify-center",children:[a.jsx(Md,{className:"w-3 h-3"}),t("settings.data.storage")]})]})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.5s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-purple-50 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400",children:a.jsx(hx,{className:"w-5 h-5",strokeWidth:2})}),t("settings.widget.title","Widget Settings")]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.widget.transparency","Background Transparency")}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[E,"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"100",value:E,onChange:q=>{const we=parseInt(q.target.value);ee(we),localStorage.setItem("widgetTransparency",we.toString())},className:"w-32 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-purple-600"})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:t("settings.widget.transparencyDesc","Adjust the transparency of the widget background on your home screen.")}),a.jsx("button",{onClick:async()=>{try{if(Ke.getPlatform()!=="android"){alert("ìœ„ì ¯ì€ Androidì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");return}const we=[...n,...h()],Be=P.map(S=>{const $=C.find(R=>R.id===S.employeeId);return{...S,employeeName:$?.name||""}});await c0({todos:we,vacations:Be}),alert("ìœ„ì ¯ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!")}catch(q){console.error("ğŸ“± Widget Sync ERROR:",q),alert("ìœ„ì ¯ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: "+q?.message)}},className:"mt-4 w-full py-2 bg-purple-600 text-white rounded-xl active:scale-95 transition-transform",children:t("settings.widget.refresh","Sync Widget Now")}),a.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:t("settings.widget.refreshDesc","If tasks are not showing, try syncing manually.")})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.6s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-green-50 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400",children:a.jsx(Md,{className:"w-5 h-5",strokeWidth:2})}),t("settings.data.title")]}),a.jsx("div",{className:"grid grid-cols-1 gap-4",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{onClick:he,className:"w-full flex items-center justify-between p-4 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 hover:bg-white dark:hover:bg-gray-700 hover:shadow-md transition-all group",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform",children:a.jsx(gx,{className:"w-4 h-4"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:t("settings.data.backup")}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("settings.data.backupDesc")})]})]}),a.jsx(gs,{className:"w-4 h-4 text-gray-400 group-hover:translate-x-1 transition-transform"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"file",accept:".json",onChange:se,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),a.jsxs("div",{className:"w-full flex items-center justify-between p-4 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 hover:bg-white dark:hover:bg-gray-700 hover:shadow-md transition-all group",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/30 rounded-lg text-green-600 dark:text-green-400 group-hover:scale-110 transition-transform",children:a.jsx(mx,{className:"w-4 h-4"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:t("settings.data.restore")}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("settings.data.restoreDesc")})]})]}),a.jsx(gs,{className:"w-4 h-4 text-gray-400 group-hover:translate-x-1 transition-transform"})]})]})]})}),A&&a.jsxs("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 rounded-xl flex items-center gap-2 text-sm text-red-600 dark:text-red-400 animate-shake",children:[a.jsx(tc,{className:"w-4 h-4 flex-shrink-0"}),A]}),z&&a.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-900/30 rounded-xl flex items-center gap-2 text-sm text-green-600 dark:text-green-400 animate-slide-in",children:[a.jsx(Yt,{className:"w-4 h-4 flex-shrink-0"}),t("settings.data.restoreSuccess")]}),a.jsxs("button",{onClick:Ae,className:"mt-6 w-full flex items-center justify-center gap-2 p-3 text-red-600 dark:text-red-400 bg-red-50 hover:bg-red-100 dark:bg-red-900/10 dark:hover:bg-red-900/20 rounded-xl transition-colors text-sm font-medium",children:[a.jsx($t,{className:"w-4 h-4"}),t("settings.data.clearCompleted")]})]}),a.jsx("div",{className:"text-center pb-8 pt-4",children:a.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full",children:[a.jsx(Pd,{className:"w-3 h-3 text-gray-400"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"TodoList App v1.0.0 â€¢ Â© 2024"})]})}),ce&&a.jsx(oC,{onClose:()=>ke(!1)})]})})},d0=({onClick:t})=>{const{theme:e}=Et();return a.jsxs("button",{onClick:t,className:"fixed bottom-24 right-4 z-50 group md:bottom-8","aria-label":"í• ì¼ ì¶”ê°€",children:[a.jsx("div",{className:"absolute inset-0 rounded-full bg-primary-500 blur-lg opacity-40 group-hover:opacity-60 transition-opacity duration-300 animate-pulse"}),a.jsx("div",{className:`
        relative flex items-center justify-center 
        w-14 h-14 rounded-full
        bg-gradient-to-r from-primary-600 to-primary-500
        text-white shadow-lg shadow-primary-500/40
        transform transition-all duration-300
        group-hover:scale-110 group-active:scale-95
        group-hover:shadow-primary-500/60
      `,children:a.jsx(ct,{className:"w-7 h-7 transition-transform duration-300 group-hover:rotate-90",strokeWidth:2.5})})]})},gC=Object.freeze(Object.defineProperty({__proto__:null,default:d0},Symbol.toStringTag,{value:"Module"})),u0=p.createContext({});function mC(t){const e=p.useRef(null);return e.current===null&&(e.current=t()),e.current}const ed=typeof window<"u",fC=ed?p.useLayoutEffect:p.useEffect,td=p.createContext(null);function rd(t,e){t.indexOf(e)===-1&&t.push(e)}function sd(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}const Cr=(t,e,r)=>r>e?e:r<t?t:r;let nd=()=>{};const Er={},h0=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function g0(t){return typeof t=="object"&&t!==null}const m0=t=>/^0[^.\s]+$/u.test(t);function ad(t){let e;return()=>(e===void 0&&(e=t()),e)}const Xt=t=>t,pC=(t,e)=>r=>e(t(r)),Ea=(...t)=>t.reduce(pC),da=(t,e,r)=>{const s=e-t;return s===0?1:(r-t)/s};class id{constructor(){this.subscriptions=[]}add(e){return rd(this.subscriptions,e),()=>sd(this.subscriptions,e)}notify(e,r,s){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](e,r,s);else for(let i=0;i<n;i++){const o=this.subscriptions[i];o&&o(e,r,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const fr=t=>t*1e3,qt=t=>t/1e3;function f0(t,e){return e?t*(1e3/e):0}const p0=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,yC=1e-7,xC=12;function bC(t,e,r,s,n){let i,o,l=0;do o=e+(r-e)/2,i=p0(o,s,n)-t,i>0?r=o:e=o;while(Math.abs(i)>yC&&++l<xC);return o}function Ia(t,e,r,s){if(t===e&&r===s)return Xt;const n=i=>bC(i,0,1,t,r);return i=>i===0||i===1?i:p0(n(i),e,s)}const y0=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,x0=t=>e=>1-t(1-e),b0=Ia(.33,1.53,.69,.99),od=x0(b0),v0=y0(od),w0=t=>(t*=2)<1?.5*od(t):.5*(2-Math.pow(2,-10*(t-1))),ld=t=>1-Math.sin(Math.acos(t)),k0=x0(ld),T0=y0(ld),vC=Ia(.42,0,1,1),wC=Ia(0,0,.58,1),N0=Ia(.42,0,.58,1),kC=t=>Array.isArray(t)&&typeof t[0]!="number",S0=t=>Array.isArray(t)&&typeof t[0]=="number",TC={linear:Xt,easeIn:vC,easeInOut:N0,easeOut:wC,circIn:ld,circInOut:T0,circOut:k0,backIn:od,backInOut:v0,backOut:b0,anticipate:w0},NC=t=>typeof t=="string",Dh=t=>{if(S0(t)){nd(t.length===4);const[e,r,s,n]=t;return Ia(e,r,s,n)}else if(NC(t))return TC[t];return t},Va=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function SC(t,e){let r=new Set,s=new Set,n=!1,i=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,h=!1,g=!1)=>{const x=g&&n?r:s;return h&&o.add(u),x.has(u)||x.add(u),u},cancel:u=>{s.delete(u),o.delete(u)},process:u=>{if(l=u,n){i=!0;return}n=!0,[r,s]=[s,r],r.forEach(c),r.clear(),n=!1,i&&(i=!1,d.process(u))}};return d}const jC=40;function j0(t,e){let r=!1,s=!0;const n={delta:0,timestamp:0,isProcessing:!1},i=()=>r=!0,o=Va.reduce((k,b)=>(k[b]=SC(i),k),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:h,preRender:g,render:m,postRender:x}=o,f=()=>{const k=Er.useManualTiming?n.timestamp:performance.now();r=!1,Er.useManualTiming||(n.delta=s?1e3/60:Math.max(Math.min(k-n.timestamp,jC),1)),n.timestamp=k,n.isProcessing=!0,l.process(n),c.process(n),d.process(n),u.process(n),h.process(n),g.process(n),m.process(n),x.process(n),n.isProcessing=!1,r&&e&&(s=!1,t(f))},y=()=>{r=!0,s=!0,n.isProcessing||t(f)};return{schedule:Va.reduce((k,b)=>{const j=o[b];return k[b]=(D,N=!1,T=!1)=>(r||y(),j.schedule(D,N,T)),k},{}),cancel:k=>{for(let b=0;b<Va.length;b++)o[Va[b]].cancel(k)},state:n,steps:o}}const{schedule:et,cancel:Jr,state:kt,steps:$o}=j0(typeof requestAnimationFrame<"u"?requestAnimationFrame:Xt,!0);let qa;function _C(){qa=void 0}const Mt={now:()=>(qa===void 0&&Mt.set(kt.isProcessing||Er.useManualTiming?kt.timestamp:performance.now()),qa),set:t=>{qa=t,queueMicrotask(_C)}},_0=t=>e=>typeof e=="string"&&e.startsWith(t),D0=_0("--"),DC=_0("var(--"),cd=t=>DC(t)?CC.test(t.split("/*")[0].trim()):!1,CC=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,mn={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ua={...mn,transform:t=>Cr(0,1,t)},Ua={...mn,default:1},Hn=t=>Math.round(t*1e5)/1e5,dd=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function EC(t){return t==null}const IC=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,ud=(t,e)=>r=>!!(typeof r=="string"&&IC.test(r)&&r.startsWith(t)||e&&!EC(r)&&Object.prototype.hasOwnProperty.call(r,e)),C0=(t,e,r)=>s=>{if(typeof s!="string")return s;const[n,i,o,l]=s.match(dd);return{[t]:parseFloat(n),[e]:parseFloat(i),[r]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},AC=t=>Cr(0,255,t),Fo={...mn,transform:t=>Math.round(AC(t))},us={test:ud("rgb","red"),parse:C0("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:s=1})=>"rgba("+Fo.transform(t)+", "+Fo.transform(e)+", "+Fo.transform(r)+", "+Hn(ua.transform(s))+")"};function RC(t){let e="",r="",s="",n="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),s=t.substring(5,7),n=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),s=t.substring(3,4),n=t.substring(4,5),e+=e,r+=r,s+=s,n+=n),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(s,16),alpha:n?parseInt(n,16)/255:1}}const Cl={test:ud("#"),parse:RC,transform:us.transform},Aa=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Fr=Aa("deg"),pr=Aa("%"),Ce=Aa("px"),PC=Aa("vh"),MC=Aa("vw"),Ch={...pr,parse:t=>pr.parse(t)/100,transform:t=>pr.transform(t*100)},Fs={test:ud("hsl","hue"),parse:C0("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:s=1})=>"hsla("+Math.round(t)+", "+pr.transform(Hn(e))+", "+pr.transform(Hn(r))+", "+Hn(ua.transform(s))+")"},lt={test:t=>us.test(t)||Cl.test(t)||Fs.test(t),parse:t=>us.test(t)?us.parse(t):Fs.test(t)?Fs.parse(t):Cl.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?us.transform(t):Fs.transform(t),getAnimatableNone:t=>{const e=lt.parse(t);return e.alpha=0,lt.transform(e)}},OC=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function LC(t){return isNaN(t)&&typeof t=="string"&&(t.match(dd)?.length||0)+(t.match(OC)?.length||0)>0}const E0="number",I0="color",$C="var",FC="var(",Eh="${}",WC=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ha(t){const e=t.toString(),r=[],s={color:[],number:[],var:[]},n=[];let i=0;const l=e.replace(WC,c=>(lt.test(c)?(s.color.push(i),n.push(I0),r.push(lt.parse(c))):c.startsWith(FC)?(s.var.push(i),n.push($C),r.push(c)):(s.number.push(i),n.push(E0),r.push(parseFloat(c))),++i,Eh)).split(Eh);return{values:r,split:l,indexes:s,types:n}}function A0(t){return ha(t).values}function R0(t){const{split:e,types:r}=ha(t),s=e.length;return n=>{let i="";for(let o=0;o<s;o++)if(i+=e[o],n[o]!==void 0){const l=r[o];l===E0?i+=Hn(n[o]):l===I0?i+=lt.transform(n[o]):i+=n[o]}return i}}const VC=t=>typeof t=="number"?0:lt.test(t)?lt.getAnimatableNone(t):t;function UC(t){const e=A0(t);return R0(t)(e.map(VC))}const Zr={test:LC,parse:A0,createTransformer:R0,getAnimatableNone:UC};function Wo(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function BC({hue:t,saturation:e,lightness:r,alpha:s}){t/=360,e/=100,r/=100;let n=0,i=0,o=0;if(!e)n=i=o=r;else{const l=r<.5?r*(1+e):r+e-r*e,c=2*r-l;n=Wo(c,l,t+1/3),i=Wo(c,l,t),o=Wo(c,l,t-1/3)}return{red:Math.round(n*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:s}}function Ii(t,e){return r=>r>0?e:t}const tt=(t,e,r)=>t+(e-t)*r,Vo=(t,e,r)=>{const s=t*t,n=r*(e*e-s)+s;return n<0?0:Math.sqrt(n)},HC=[Cl,us,Fs],GC=t=>HC.find(e=>e.test(t));function Ih(t){const e=GC(t);if(!e)return!1;let r=e.parse(t);return e===Fs&&(r=BC(r)),r}const Ah=(t,e)=>{const r=Ih(t),s=Ih(e);if(!r||!s)return Ii(t,e);const n={...r};return i=>(n.red=Vo(r.red,s.red,i),n.green=Vo(r.green,s.green,i),n.blue=Vo(r.blue,s.blue,i),n.alpha=tt(r.alpha,s.alpha,i),us.transform(n))},El=new Set(["none","hidden"]);function zC(t,e){return El.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function KC(t,e){return r=>tt(t,e,r)}function hd(t){return typeof t=="number"?KC:typeof t=="string"?cd(t)?Ii:lt.test(t)?Ah:XC:Array.isArray(t)?P0:typeof t=="object"?lt.test(t)?Ah:YC:Ii}function P0(t,e){const r=[...t],s=r.length,n=t.map((i,o)=>hd(i)(i,e[o]));return i=>{for(let o=0;o<s;o++)r[o]=n[o](i);return r}}function YC(t,e){const r={...t,...e},s={};for(const n in r)t[n]!==void 0&&e[n]!==void 0&&(s[n]=hd(t[n])(t[n],e[n]));return n=>{for(const i in s)r[i]=s[i](n);return r}}function qC(t,e){const r=[],s={color:0,var:0,number:0};for(let n=0;n<e.values.length;n++){const i=e.types[n],o=t.indexes[i][s[i]],l=t.values[o]??0;r[n]=l,s[i]++}return r}const XC=(t,e)=>{const r=Zr.createTransformer(e),s=ha(t),n=ha(e);return s.indexes.var.length===n.indexes.var.length&&s.indexes.color.length===n.indexes.color.length&&s.indexes.number.length>=n.indexes.number.length?El.has(t)&&!n.values.length||El.has(e)&&!s.values.length?zC(t,e):Ea(P0(qC(s,n),n.values),r):Ii(t,e)};function M0(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?tt(t,e,r):hd(t)(t,e)}const QC=t=>{const e=({timestamp:r})=>t(r);return{start:(r=!0)=>et.update(e,r),stop:()=>Jr(e),now:()=>kt.isProcessing?kt.timestamp:Mt.now()}},O0=(t,e,r=10)=>{let s="";const n=Math.max(Math.round(e/r),2);for(let i=0;i<n;i++)s+=Math.round(t(i/(n-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},Ai=2e4;function gd(t){let e=0;const r=50;let s=t.next(e);for(;!s.done&&e<Ai;)e+=r,s=t.next(e);return e>=Ai?1/0:e}function JC(t,e=100,r){const s=r({...t,keyframes:[0,e]}),n=Math.min(gd(s),Ai);return{type:"keyframes",ease:i=>s.next(n*i).value/e,duration:qt(n)}}const ZC=5;function L0(t,e,r){const s=Math.max(e-ZC,0);return f0(r-t(s),e-s)}const nt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Uo=.001;function eE({duration:t=nt.duration,bounce:e=nt.bounce,velocity:r=nt.velocity,mass:s=nt.mass}){let n,i,o=1-e;o=Cr(nt.minDamping,nt.maxDamping,o),t=Cr(nt.minDuration,nt.maxDuration,qt(t)),o<1?(n=d=>{const u=d*o,h=u*t,g=u-r,m=Il(d,o),x=Math.exp(-h);return Uo-g/m*x},i=d=>{const h=d*o*t,g=h*r+r,m=Math.pow(o,2)*Math.pow(d,2)*t,x=Math.exp(-h),f=Il(Math.pow(d,2),o);return(-n(d)+Uo>0?-1:1)*((g-m)*x)/f}):(n=d=>{const u=Math.exp(-d*t),h=(d-r)*t+1;return-Uo+u*h},i=d=>{const u=Math.exp(-d*t),h=(r-d)*(t*t);return u*h});const l=5/t,c=rE(n,i,l);if(t=fr(t),isNaN(c))return{stiffness:nt.stiffness,damping:nt.damping,duration:t};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:o*2*Math.sqrt(s*d),duration:t}}}const tE=12;function rE(t,e,r){let s=r;for(let n=1;n<tE;n++)s=s-t(s)/e(s);return s}function Il(t,e){return t*Math.sqrt(1-e*e)}const sE=["duration","bounce"],nE=["stiffness","damping","mass"];function Rh(t,e){return e.some(r=>t[r]!==void 0)}function aE(t){let e={velocity:nt.velocity,stiffness:nt.stiffness,damping:nt.damping,mass:nt.mass,isResolvedFromDuration:!1,...t};if(!Rh(t,nE)&&Rh(t,sE))if(t.visualDuration){const r=t.visualDuration,s=2*Math.PI/(r*1.2),n=s*s,i=2*Cr(.05,1,1-(t.bounce||0))*Math.sqrt(n);e={...e,mass:nt.mass,stiffness:n,damping:i}}else{const r=eE(t);e={...e,...r,mass:nt.mass},e.isResolvedFromDuration=!0}return e}function Ri(t=nt.visualDuration,e=nt.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:s,restDelta:n}=r;const i=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],l={done:!1,value:i},{stiffness:c,damping:d,mass:u,duration:h,velocity:g,isResolvedFromDuration:m}=aE({...r,velocity:-qt(r.velocity||0)}),x=g||0,f=d/(2*Math.sqrt(c*u)),y=o-i,w=qt(Math.sqrt(c/u)),v=Math.abs(y)<5;s||(s=v?nt.restSpeed.granular:nt.restSpeed.default),n||(n=v?nt.restDelta.granular:nt.restDelta.default);let k;if(f<1){const j=Il(w,f);k=D=>{const N=Math.exp(-f*w*D);return o-N*((x+f*w*y)/j*Math.sin(j*D)+y*Math.cos(j*D))}}else if(f===1)k=j=>o-Math.exp(-w*j)*(y+(x+w*y)*j);else{const j=w*Math.sqrt(f*f-1);k=D=>{const N=Math.exp(-f*w*D),T=Math.min(j*D,300);return o-N*((x+f*w*y)*Math.sinh(T)+j*y*Math.cosh(T))/j}}const b={calculatedDuration:m&&h||null,next:j=>{const D=k(j);if(m)l.done=j>=h;else{let N=j===0?x:0;f<1&&(N=j===0?fr(x):L0(k,j,D));const T=Math.abs(N)<=s,_=Math.abs(o-D)<=n;l.done=T&&_}return l.value=l.done?o:D,l},toString:()=>{const j=Math.min(gd(b),Ai),D=O0(N=>b.next(j*N).value,j,30);return j+"ms "+D},toTransition:()=>{}};return b}Ri.applyToOptions=t=>{const e=JC(t,100,Ri);return t.ease=e.ease,t.duration=fr(e.duration),t.type="keyframes",t};function Al({keyframes:t,velocity:e=0,power:r=.8,timeConstant:s=325,bounceDamping:n=10,bounceStiffness:i=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:u}){const h=t[0],g={done:!1,value:h},m=T=>l!==void 0&&T<l||c!==void 0&&T>c,x=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let f=r*e;const y=h+f,w=o===void 0?y:o(y);w!==y&&(f=w-h);const v=T=>-f*Math.exp(-T/s),k=T=>w+v(T),b=T=>{const _=v(T),P=k(T);g.done=Math.abs(_)<=d,g.value=g.done?w:P};let j,D;const N=T=>{m(g.value)&&(j=T,D=Ri({keyframes:[g.value,x(g.value)],velocity:L0(k,T,g.value),damping:n,stiffness:i,restDelta:d,restSpeed:u}))};return N(0),{calculatedDuration:null,next:T=>{let _=!1;return!D&&j===void 0&&(_=!0,b(T),N(T)),j!==void 0&&T>=j?D.next(T-j):(!_&&b(T),g)}}}function iE(t,e,r){const s=[],n=r||Er.mix||M0,i=t.length-1;for(let o=0;o<i;o++){let l=n(t[o],t[o+1]);if(e){const c=Array.isArray(e)?e[o]||Xt:e;l=Ea(c,l)}s.push(l)}return s}function oE(t,e,{clamp:r=!0,ease:s,mixer:n}={}){const i=t.length;if(nd(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=iE(e,s,n),c=l.length,d=u=>{if(o&&u<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(u<t[h+1]);h++);const g=da(t[h],t[h+1],u);return l[h](g)};return r?u=>d(Cr(t[0],t[i-1],u)):d}function lE(t,e){const r=t[t.length-1];for(let s=1;s<=e;s++){const n=da(0,e,s);t.push(tt(r,1,n))}}function cE(t){const e=[0];return lE(e,t.length-1),e}function dE(t,e){return t.map(r=>r*e)}function uE(t,e){return t.map(()=>e||N0).splice(0,t.length-1)}function Gn({duration:t=300,keyframes:e,times:r,ease:s="easeInOut"}){const n=kC(s)?s.map(Dh):Dh(s),i={done:!1,value:e[0]},o=dE(r&&r.length===e.length?r:cE(e),t),l=oE(o,e,{ease:Array.isArray(n)?n:uE(e,n)});return{calculatedDuration:t,next:c=>(i.value=l(c),i.done=c>=t,i)}}const hE=t=>t!==null;function md(t,{repeat:e,repeatType:r="loop"},s,n=1){const i=t.filter(hE),l=n<0||e&&r!=="loop"&&e%2===1?0:i.length-1;return!l||s===void 0?i[l]:s}const gE={decay:Al,inertia:Al,tween:Gn,keyframes:Gn,spring:Ri};function $0(t){typeof t.type=="string"&&(t.type=gE[t.type])}class fd{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,r){return this.finished.then(e,r)}}const mE=t=>t/100;class pd extends fd{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==Mt.now()&&this.tick(Mt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;$0(e);const{type:r=Gn,repeat:s=0,repeatDelay:n=0,repeatType:i,velocity:o=0}=e;let{keyframes:l}=e;const c=r||Gn;c!==Gn&&typeof l[0]!="number"&&(this.mixKeyframes=Ea(mE,M0(l[0],l[1])),l=[0,100]);const d=c({...e,keyframes:l});i==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=gd(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+n,this.totalDuration=this.resolvedDuration*(s+1)-n,this.generator=d}updateTime(e){const r=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(e,r=!1){const{generator:s,totalDuration:n,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:g,repeatDelay:m,type:x,onUpdate:f,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-n/this.speed,this.startTime)),r?this.currentTime=e:this.updateTime(e);const w=this.currentTime-d*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?w<0:w>n;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=n);let k=this.currentTime,b=s;if(h){const T=Math.min(this.currentTime,n)/l;let _=Math.floor(T),P=T%1;!P&&T>=1&&(P=1),P===1&&_--,_=Math.min(_,h+1),!!(_%2)&&(g==="reverse"?(P=1-P,m&&(P-=m/l)):g==="mirror"&&(b=o)),k=Cr(0,1,P)*l}const j=v?{done:!1,value:u[0]}:b.next(k);i&&(j.value=i(j.value));let{done:D}=j;!v&&c!==null&&(D=this.playbackSpeed>=0?this.currentTime>=n:this.currentTime<=0);const N=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&D);return N&&x!==Al&&(j.value=md(u,this.options,y,this.speed)),f&&f(j.value),N&&this.finish(),j}then(e,r){return this.finished.then(e,r)}get duration(){return qt(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+qt(e)}get time(){return qt(this.currentTime)}set time(e){e=fr(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Mt.now());const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=qt(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=QC,startTime:r}=this.options;this.driver||(this.driver=e(n=>this.tick(n))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=r??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Mt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function fE(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const hs=t=>t*180/Math.PI,Rl=t=>{const e=hs(Math.atan2(t[1],t[0]));return Pl(e)},pE={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Rl,rotateZ:Rl,skewX:t=>hs(Math.atan(t[1])),skewY:t=>hs(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Pl=t=>(t=t%360,t<0&&(t+=360),t),Ph=Rl,Mh=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),Oh=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),yE={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Mh,scaleY:Oh,scale:t=>(Mh(t)+Oh(t))/2,rotateX:t=>Pl(hs(Math.atan2(t[6],t[5]))),rotateY:t=>Pl(hs(Math.atan2(-t[2],t[0]))),rotateZ:Ph,rotate:Ph,skewX:t=>hs(Math.atan(t[4])),skewY:t=>hs(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Ml(t){return t.includes("scale")?1:0}function Ol(t,e){if(!t||t==="none")return Ml(e);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,n;if(r)s=yE,n=r;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=pE,n=l}if(!n)return Ml(e);const i=s[e],o=n[1].split(",").map(bE);return typeof i=="function"?i(o):o[i]}const xE=(t,e)=>{const{transform:r="none"}=getComputedStyle(t);return Ol(r,e)};function bE(t){return parseFloat(t.trim())}const fn=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],pn=new Set(fn),Lh=t=>t===mn||t===Ce,vE=new Set(["x","y","z"]),wE=fn.filter(t=>!vE.has(t));function kE(t){const e=[];return wE.forEach(r=>{const s=t.getValue(r);s!==void 0&&(e.push([r,s.get()]),s.set(r.startsWith("scale")?1:0))}),e}const ps={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Ol(e,"x"),y:(t,{transform:e})=>Ol(e,"y")};ps.translateX=ps.x;ps.translateY=ps.y;const ys=new Set;let Ll=!1,$l=!1,Fl=!1;function F0(){if($l){const t=Array.from(ys).filter(s=>s.needsMeasurement),e=new Set(t.map(s=>s.element)),r=new Map;e.forEach(s=>{const n=kE(s);n.length&&(r.set(s,n),s.render())}),t.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const n=r.get(s);n&&n.forEach(([i,o])=>{s.getValue(i)?.set(o)})}),t.forEach(s=>s.measureEndState()),t.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}$l=!1,Ll=!1,ys.forEach(t=>t.complete(Fl)),ys.clear()}function W0(){ys.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&($l=!0)})}function TE(){Fl=!0,W0(),F0(),Fl=!1}class yd{constructor(e,r,s,n,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=s,this.motionValue=n,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(ys.add(this),Ll||(Ll=!0,et.read(W0),et.resolveKeyframes(F0))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:s,motionValue:n}=this;if(e[0]===null){const i=n?.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(s&&r){const l=s.readValue(r,o);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=o),n&&i===void 0&&n.set(e[0])}fE(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),ys.delete(this)}cancel(){this.state==="scheduled"&&(ys.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const NE=t=>t.startsWith("--");function SE(t,e,r){NE(e)?t.style.setProperty(e,r):t.style[e]=r}const jE=ad(()=>window.ScrollTimeline!==void 0),_E={};function DE(t,e){const r=ad(t);return()=>_E[e]??r()}const V0=DE(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),En=([t,e,r,s])=>`cubic-bezier(${t}, ${e}, ${r}, ${s})`,$h={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:En([0,.65,.55,1]),circOut:En([.55,0,1,.45]),backIn:En([.31,.01,.66,-.59]),backOut:En([.33,1.53,.69,.99])};function U0(t,e){if(t)return typeof t=="function"?V0()?O0(t,e):"ease-out":S0(t)?En(t):Array.isArray(t)?t.map(r=>U0(r,e)||$h.easeOut):$h[t]}function CE(t,e,r,{delay:s=0,duration:n=300,repeat:i=0,repeatType:o="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[e]:r};c&&(u.offset=c);const h=U0(l,n);Array.isArray(h)&&(u.easing=h);const g={delay:s,duration:n,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return d&&(g.pseudoElement=d),t.animate(u,g)}function B0(t){return typeof t=="function"&&"applyToOptions"in t}function EE({type:t,...e}){return B0(t)&&V0()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class IE extends fd{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:r,name:s,keyframes:n,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,nd(typeof e.type!="string");const d=EE(e);this.animation=CE(r,s,n,d,i),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const u=md(n,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):SE(r,s,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return qt(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+qt(e)}get time(){return qt(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=fr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&jE()?(this.animation.timeline=e,Xt):r(this)}}const H0={anticipate:w0,backInOut:v0,circInOut:T0};function AE(t){return t in H0}function RE(t){typeof t.ease=="string"&&AE(t.ease)&&(t.ease=H0[t.ease])}const Fh=10;class PE extends IE{constructor(e){RE(e),$0(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:r,onUpdate:s,onComplete:n,element:i,...o}=this.options;if(!r)return;if(e!==void 0){r.set(e);return}const l=new pd({...o,autoplay:!1}),c=fr(this.finishedTime??this.time);r.setWithVelocity(l.sample(c-Fh).value,l.sample(c).value,Fh),l.stop()}}const Wh=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Zr.test(t)||t==="0")&&!t.startsWith("url("));function ME(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function OE(t,e,r,s){const n=t[0];if(n===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=Wh(n,e),l=Wh(i,e);return!o||!l?!1:ME(t)||(r==="spring"||B0(r))&&s}function Wl(t){t.duration=0,t.type="keyframes"}const LE=new Set(["opacity","clipPath","filter","transform"]),$E=ad(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function FE(t){const{motionValue:e,name:r,repeatDelay:s,repeatType:n,damping:i,type:o}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=e.owner.getProps();return $E()&&r&&LE.has(r)&&(r!=="transform"||!d)&&!c&&!s&&n!=="mirror"&&i!==0&&o!=="inertia"}const WE=40;class VE extends fd{constructor({autoplay:e=!0,delay:r=0,type:s="keyframes",repeat:n=0,repeatDelay:i=0,repeatType:o="loop",keyframes:l,name:c,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Mt.now();const g={autoplay:e,delay:r,type:s,repeat:n,repeatDelay:i,repeatType:o,name:c,motionValue:d,element:u,...h},m=u?.KeyframeResolver||yd;this.keyframeResolver=new m(l,(x,f,y)=>this.onKeyframesResolved(x,f,g,!y),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,r,s,n){this.keyframeResolver=void 0;const{name:i,type:o,velocity:l,delay:c,isHandoff:d,onUpdate:u}=s;this.resolvedAt=Mt.now(),OE(e,i,o,l)||((Er.instantAnimations||!c)&&u?.(md(e,s,r)),e[0]=e[e.length-1],Wl(s),s.repeat=0);const g={startTime:n?this.resolvedAt?this.resolvedAt-this.createdAt>WE?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...s,keyframes:e},m=!d&&FE(g)?new PE({...g,element:g.motionValue.owner.current}):new pd(g);m.finished.then(()=>this.notifyFinished()).catch(Xt),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,r){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),TE()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const UE=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function BE(t){const e=UE.exec(t);if(!e)return[,];const[,r,s,n]=e;return[`--${r??s}`,n]}function G0(t,e,r=1){const[s,n]=BE(t);if(!s)return;const i=window.getComputedStyle(e).getPropertyValue(s);if(i){const o=i.trim();return h0(o)?parseFloat(o):o}return cd(n)?G0(n,e,r+1):n}function xd(t,e){return t?.[e]??t?.default??t}const z0=new Set(["width","height","top","left","right","bottom",...fn]),HE={test:t=>t==="auto",parse:t=>t},K0=t=>e=>e.test(t),Y0=[mn,Ce,pr,Fr,MC,PC,HE],Vh=t=>Y0.find(K0(t));function GE(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||m0(t):!0}const zE=new Set(["brightness","contrast","saturate","opacity"]);function KE(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=r.match(dd)||[];if(!s)return t;const n=r.replace(s,"");let i=zE.has(e)?1:0;return s!==r&&(i*=100),e+"("+i+n+")"}const YE=/\b([a-z-]*)\(.*?\)/gu,Vl={...Zr,getAnimatableNone:t=>{const e=t.match(YE);return e?e.map(KE).join(" "):t}},Uh={...mn,transform:Math.round},qE={rotate:Fr,rotateX:Fr,rotateY:Fr,rotateZ:Fr,scale:Ua,scaleX:Ua,scaleY:Ua,scaleZ:Ua,skew:Fr,skewX:Fr,skewY:Fr,distance:Ce,translateX:Ce,translateY:Ce,translateZ:Ce,x:Ce,y:Ce,z:Ce,perspective:Ce,transformPerspective:Ce,opacity:ua,originX:Ch,originY:Ch,originZ:Ce},bd={borderWidth:Ce,borderTopWidth:Ce,borderRightWidth:Ce,borderBottomWidth:Ce,borderLeftWidth:Ce,borderRadius:Ce,radius:Ce,borderTopLeftRadius:Ce,borderTopRightRadius:Ce,borderBottomRightRadius:Ce,borderBottomLeftRadius:Ce,width:Ce,maxWidth:Ce,height:Ce,maxHeight:Ce,top:Ce,right:Ce,bottom:Ce,left:Ce,padding:Ce,paddingTop:Ce,paddingRight:Ce,paddingBottom:Ce,paddingLeft:Ce,margin:Ce,marginTop:Ce,marginRight:Ce,marginBottom:Ce,marginLeft:Ce,backgroundPositionX:Ce,backgroundPositionY:Ce,...qE,zIndex:Uh,fillOpacity:ua,strokeOpacity:ua,numOctaves:Uh},XE={...bd,color:lt,backgroundColor:lt,outlineColor:lt,fill:lt,stroke:lt,borderColor:lt,borderTopColor:lt,borderRightColor:lt,borderBottomColor:lt,borderLeftColor:lt,filter:Vl,WebkitFilter:Vl},q0=t=>XE[t];function X0(t,e){let r=q0(t);return r!==Vl&&(r=Zr),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const QE=new Set(["auto","none","0"]);function JE(t,e,r){let s=0,n;for(;s<t.length&&!n;){const i=t[s];typeof i=="string"&&!QE.has(i)&&ha(i).values.length&&(n=t[s]),s++}if(n&&r)for(const i of e)t[i]=X0(r,n)}class ZE extends yd{constructor(e,r,s,n,i){super(e,r,s,n,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:s}=this;if(!r||!r.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let d=e[c];if(typeof d=="string"&&(d=d.trim(),cd(d))){const u=G0(d,r.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!z0.has(s)||e.length!==2)return;const[n,i]=e,o=Vh(n),l=Vh(i);if(o!==l)if(Lh(o)&&Lh(l))for(let c=0;c<e.length;c++){const d=e[c];typeof d=="string"&&(e[c]=parseFloat(d))}else ps[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,s=[];for(let n=0;n<e.length;n++)(e[n]===null||GE(e[n]))&&s.push(n);s.length&&JE(e,s,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ps[s](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const n=r[r.length-1];n!==void 0&&e.getValue(s,n).jump(n,!1)}measureEndState(){const{element:e,name:r,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const n=e.getValue(r);n&&n.jump(this.measuredOrigin,!1);const i=s.length-1,o=s[i];s[i]=ps[r](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{e.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function e1(t,e,r){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let s=document;const n=r?.[t]??s.querySelectorAll(t);return n?Array.from(n):[]}return Array.from(t)}const Q0=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function t1(t){return g0(t)&&"offsetHeight"in t}const Bh=30,r1=t=>!isNaN(parseFloat(t));class s1{constructor(e,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const n=Mt.now();if(this.updatedAt!==n&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=Mt.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=r1(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new id);const s=this.events[e].add(r);return e==="change"?()=>{s(),et.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,r,s){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Mt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Bh)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,Bh);return f0(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function tn(t,e){return new s1(t,e)}const{schedule:vd}=j0(queueMicrotask,!1),Zt={x:!1,y:!1};function J0(){return Zt.x||Zt.y}function n1(t){return t==="x"||t==="y"?Zt[t]?null:(Zt[t]=!0,()=>{Zt[t]=!1}):Zt.x||Zt.y?null:(Zt.x=Zt.y=!0,()=>{Zt.x=Zt.y=!1})}function Z0(t,e){const r=e1(t),s=new AbortController,n={passive:!0,...e,signal:s.signal};return[r,n,()=>s.abort()]}function Hh(t){return!(t.pointerType==="touch"||J0())}function a1(t,e,r={}){const[s,n,i]=Z0(t,r),o=l=>{if(!Hh(l))return;const{target:c}=l,d=e(c,l);if(typeof d!="function"||!c)return;const u=h=>{Hh(h)&&(d(h),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,n)};return s.forEach(l=>{l.addEventListener("pointerenter",o,n)}),i}const ey=(t,e)=>e?t===e?!0:ey(t,e.parentElement):!1,wd=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,i1=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function o1(t){return i1.has(t.tagName)||t.tabIndex!==-1}const Xa=new WeakSet;function Gh(t){return e=>{e.key==="Enter"&&t(e)}}function Bo(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const l1=(t,e)=>{const r=t.currentTarget;if(!r)return;const s=Gh(()=>{if(Xa.has(r))return;Bo(r,"down");const n=Gh(()=>{Bo(r,"up")}),i=()=>Bo(r,"cancel");r.addEventListener("keyup",n,e),r.addEventListener("blur",i,e)});r.addEventListener("keydown",s,e),r.addEventListener("blur",()=>r.removeEventListener("keydown",s),e)};function zh(t){return wd(t)&&!J0()}function c1(t,e,r={}){const[s,n,i]=Z0(t,r),o=l=>{const c=l.currentTarget;if(!zh(l))return;Xa.add(c);const d=e(c,l),u=(m,x)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",g),Xa.has(c)&&Xa.delete(c),zh(m)&&typeof d=="function"&&d(m,{success:x})},h=m=>{u(m,c===window||c===document||r.useGlobalTarget||ey(c,m.target))},g=m=>{u(m,!1)};window.addEventListener("pointerup",h,n),window.addEventListener("pointercancel",g,n)};return s.forEach(l=>{(r.useGlobalTarget?window:l).addEventListener("pointerdown",o,n),t1(l)&&(l.addEventListener("focus",d=>l1(d,n)),!o1(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),i}function ty(t){return g0(t)&&"ownerSVGElement"in t}function d1(t){return ty(t)&&t.tagName==="svg"}const St=t=>!!(t&&t.getVelocity),u1=[...Y0,lt,Zr],h1=t=>u1.find(K0(t)),ry=p.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function g1(t=!0){const e=p.useContext(td);if(e===null)return[!0,null];const{isPresent:r,onExitComplete:s,register:n}=e,i=p.useId();p.useEffect(()=>{if(t)return n(i)},[t]);const o=p.useCallback(()=>t&&s&&s(i),[i,s,t]);return!r&&s?[!1,o]:[!0]}const sy=p.createContext({strict:!1}),Kh={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},rn={};for(const t in Kh)rn[t]={isEnabled:e=>Kh[t].some(r=>!!e[r])};function m1(t){for(const e in t)rn[e]={...rn[e],...t[e]}}const f1=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Pi(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||f1.has(t)}let ny=t=>!Pi(t);function p1(t){typeof t=="function"&&(ny=e=>e.startsWith("on")?!Pi(e):t(e))}try{p1(require("@emotion/is-prop-valid").default)}catch{}function y1(t,e,r){const s={};for(const n in t)n==="values"&&typeof t.values=="object"||(ny(n)||r===!0&&Pi(n)||!e&&!Pi(n)||t.draggable&&n.startsWith("onDrag"))&&(s[n]=t[n]);return s}const ao=p.createContext({});function io(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function ga(t){return typeof t=="string"||Array.isArray(t)}const kd=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Td=["initial",...kd];function oo(t){return io(t.animate)||Td.some(e=>ga(t[e]))}function ay(t){return!!(oo(t)||t.variants)}function x1(t,e){if(oo(t)){const{initial:r,animate:s}=t;return{initial:r===!1||ga(r)?r:void 0,animate:ga(s)?s:void 0}}return t.inherit!==!1?e:{}}function b1(t){const{initial:e,animate:r}=x1(t,p.useContext(ao));return p.useMemo(()=>({initial:e,animate:r}),[Yh(e),Yh(r)])}function Yh(t){return Array.isArray(t)?t.join(" "):t}function qh(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Dn={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Ce.test(t))t=parseFloat(t);else return t;const r=qh(t,e.target.x),s=qh(t,e.target.y);return`${r}% ${s}%`}},v1={correct:(t,{treeScale:e,projectionDelta:r})=>{const s=t,n=Zr.parse(t);if(n.length>5)return s;const i=Zr.createTransformer(t),o=typeof n[0]!="number"?1:0,l=r.x.scale*e.x,c=r.y.scale*e.y;n[0+o]/=l,n[1+o]/=c;const d=tt(l,c,.5);return typeof n[2+o]=="number"&&(n[2+o]/=d),typeof n[3+o]=="number"&&(n[3+o]/=d),i(n)}},Ul={borderRadius:{...Dn,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Dn,borderTopRightRadius:Dn,borderBottomLeftRadius:Dn,borderBottomRightRadius:Dn,boxShadow:v1};function iy(t,{layout:e,layoutId:r}){return pn.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!Ul[t]||t==="opacity")}const w1={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},k1=fn.length;function T1(t,e,r){let s="",n=!0;for(let i=0;i<k1;i++){const o=fn[i],l=t[o];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(o.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||r){const d=Q0(l,bd[o]);if(!c){n=!1;const u=w1[o]||o;s+=`${u}(${d}) `}r&&(e[o]=d)}}return s=s.trim(),r?s=r(e,n?"":s):n&&(s="none"),s}function Nd(t,e,r){const{style:s,vars:n,transformOrigin:i}=t;let o=!1,l=!1;for(const c in e){const d=e[c];if(pn.has(c)){o=!0;continue}else if(D0(c)){n[c]=d;continue}else{const u=Q0(d,bd[c]);c.startsWith("origin")?(l=!0,i[c]=u):s[c]=u}}if(e.transform||(o||r?s.transform=T1(e,t.transform,r):s.transform&&(s.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=i;s.transformOrigin=`${c} ${d} ${u}`}}const Sd=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function oy(t,e,r){for(const s in e)!St(e[s])&&!iy(s,r)&&(t[s]=e[s])}function N1({transformTemplate:t},e){return p.useMemo(()=>{const r=Sd();return Nd(r,e,t),Object.assign({},r.vars,r.style)},[e])}function S1(t,e){const r=t.style||{},s={};return oy(s,r,t),Object.assign(s,N1(t,e)),s}function j1(t,e){const r={},s=S1(t,e);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=s,r}const _1={offset:"stroke-dashoffset",array:"stroke-dasharray"},D1={offset:"strokeDashoffset",array:"strokeDasharray"};function C1(t,e,r=1,s=0,n=!0){t.pathLength=1;const i=n?_1:D1;t[i.offset]=Ce.transform(-s);const o=Ce.transform(e),l=Ce.transform(r);t[i.array]=`${o} ${l}`}function ly(t,{attrX:e,attrY:r,attrScale:s,pathLength:n,pathSpacing:i=1,pathOffset:o=0,...l},c,d,u){if(Nd(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:g}=t;h.transform&&(g.transform=h.transform,delete h.transform),(g.transform||h.transformOrigin)&&(g.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),g.transform&&(g.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),r!==void 0&&(h.y=r),s!==void 0&&(h.scale=s),n!==void 0&&C1(h,n,i,o,!1)}const cy=()=>({...Sd(),attrs:{}}),dy=t=>typeof t=="string"&&t.toLowerCase()==="svg";function E1(t,e,r,s){const n=p.useMemo(()=>{const i=cy();return ly(i,e,dy(s),t.transformTemplate,t.style),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};oy(i,t.style,t),n.style={...i,...n.style}}return n}const I1=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jd(t){return typeof t!="string"||t.includes("-")?!1:!!(I1.indexOf(t)>-1||/[A-Z]/u.test(t))}function A1(t,e,r,{latestValues:s},n,i=!1){const l=(jd(t)?E1:j1)(e,s,n,t),c=y1(e,typeof t=="string",i),d=t!==p.Fragment?{...c,...l,ref:r}:{},{children:u}=e,h=p.useMemo(()=>St(u)?u.get():u,[u]);return p.createElement(t,{...d,children:h})}function Xh(t){const e=[{},{}];return t?.values.forEach((r,s)=>{e[0][s]=r.get(),e[1][s]=r.getVelocity()}),e}function _d(t,e,r,s){if(typeof e=="function"){const[n,i]=Xh(s);e=e(r!==void 0?r:t.custom,n,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[n,i]=Xh(s);e=e(r!==void 0?r:t.custom,n,i)}return e}function Qa(t){return St(t)?t.get():t}function R1({scrapeMotionValuesFromProps:t,createRenderState:e},r,s,n){return{latestValues:P1(r,s,n,t),renderState:e()}}function P1(t,e,r,s){const n={},i=s(t,{});for(const g in i)n[g]=Qa(i[g]);let{initial:o,animate:l}=t;const c=oo(t),d=ay(t);e&&d&&!c&&t.inherit!==!1&&(o===void 0&&(o=e.initial),l===void 0&&(l=e.animate));let u=r?r.initial===!1:!1;u=u||o===!1;const h=u?l:o;if(h&&typeof h!="boolean"&&!io(h)){const g=Array.isArray(h)?h:[h];for(let m=0;m<g.length;m++){const x=_d(t,g[m]);if(x){const{transitionEnd:f,transition:y,...w}=x;for(const v in w){let k=w[v];if(Array.isArray(k)){const b=u?k.length-1:0;k=k[b]}k!==null&&(n[v]=k)}for(const v in f)n[v]=f[v]}}}return n}const uy=t=>(e,r)=>{const s=p.useContext(ao),n=p.useContext(td),i=()=>R1(t,e,s,n);return r?i():mC(i)};function Dd(t,e,r){const{style:s}=t,n={};for(const i in s)(St(s[i])||e.style&&St(e.style[i])||iy(i,t)||r?.getValue(i)?.liveStyle!==void 0)&&(n[i]=s[i]);return n}const M1=uy({scrapeMotionValuesFromProps:Dd,createRenderState:Sd});function hy(t,e,r){const s=Dd(t,e,r);for(const n in t)if(St(t[n])||St(e[n])){const i=fn.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;s[i]=t[n]}return s}const O1=uy({scrapeMotionValuesFromProps:hy,createRenderState:cy}),L1=Symbol.for("motionComponentSymbol");function Ws(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function $1(t,e,r){return p.useCallback(s=>{s&&t.onMount&&t.onMount(s),e&&(s?e.mount(s):e.unmount()),r&&(typeof r=="function"?r(s):Ws(r)&&(r.current=s))},[e])}const Cd=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),F1="framerAppearId",gy="data-"+Cd(F1),my=p.createContext({});function W1(t,e,r,s,n){const{visualElement:i}=p.useContext(ao),o=p.useContext(sy),l=p.useContext(td),c=p.useContext(ry).reducedMotion,d=p.useRef(null);s=s||o.renderer,!d.current&&s&&(d.current=s(t,{visualState:e,parent:i,props:r,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,h=p.useContext(my);u&&!u.projection&&n&&(u.type==="html"||u.type==="svg")&&V1(d.current,r,n,h);const g=p.useRef(!1);p.useInsertionEffect(()=>{u&&g.current&&u.update(r,l)});const m=r[gy],x=p.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return fC(()=>{u&&(g.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),x.current&&u.animationState&&u.animationState.animateChanges())}),p.useEffect(()=>{u&&(!x.current&&u.animationState&&u.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),x.current=!1),u.enteringChildren=void 0)}),u}function V1(t,e,r,s){const{layoutId:n,layout:i,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=e;t.projection=new r(t.latestValues,e["data-framer-portal-id"]?void 0:fy(t.parent)),t.projection.setOptions({layoutId:n,layout:i,alwaysMeasureLayout:!!o||l&&Ws(l),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:c,layoutRoot:d})}function fy(t){if(t)return t.options.allowProjection!==!1?t.projection:fy(t.parent)}function Ho(t,{forwardMotionProps:e=!1}={},r,s){r&&m1(r);const n=jd(t)?O1:M1;function i(l,c){let d;const u={...p.useContext(ry),...l,layoutId:U1(l)},{isStatic:h}=u,g=b1(l),m=n(l,h);if(!h&&ed){B1();const x=H1(u);d=x.MeasureLayout,g.visualElement=W1(t,m,u,s,x.ProjectionNode)}return a.jsxs(ao.Provider,{value:g,children:[d&&g.visualElement?a.jsx(d,{visualElement:g.visualElement,...u}):null,A1(t,l,$1(m,g.visualElement,c),m,h,e)]})}i.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=p.forwardRef(i);return o[L1]=t,o}function U1({layoutId:t}){const e=p.useContext(u0).id;return e&&t!==void 0?e+"-"+t:t}function B1(t,e){p.useContext(sy).strict}function H1(t){const{drag:e,layout:r}=rn;if(!e&&!r)return{};const s={...e,...r};return{MeasureLayout:e?.isEnabled(t)||r?.isEnabled(t)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function G1(t,e){if(typeof Proxy>"u")return Ho;const r=new Map,s=(i,o)=>Ho(i,o,t,e),n=(i,o)=>s(i,o);return new Proxy(n,{get:(i,o)=>o==="create"?s:(r.has(o)||r.set(o,Ho(o,void 0,t,e)),r.get(o))})}function py({top:t,left:e,right:r,bottom:s}){return{x:{min:e,max:r},y:{min:t,max:s}}}function z1({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function K1(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:s.y,right:s.x}}function Go(t){return t===void 0||t===1}function Bl({scale:t,scaleX:e,scaleY:r}){return!Go(t)||!Go(e)||!Go(r)}function ns(t){return Bl(t)||yy(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function yy(t){return Qh(t.x)||Qh(t.y)}function Qh(t){return t&&t!=="0%"}function Mi(t,e,r){const s=t-r,n=e*s;return r+n}function Jh(t,e,r,s,n){return n!==void 0&&(t=Mi(t,n,s)),Mi(t,r,s)+e}function Hl(t,e=0,r=1,s,n){t.min=Jh(t.min,e,r,s,n),t.max=Jh(t.max,e,r,s,n)}function xy(t,{x:e,y:r}){Hl(t.x,e.translate,e.scale,e.originPoint),Hl(t.y,r.translate,r.scale,r.originPoint)}const Zh=.999999999999,eg=1.0000000000001;function Y1(t,e,r,s=!1){const n=r.length;if(!n)return;e.x=e.y=1;let i,o;for(let l=0;l<n;l++){i=r[l],o=i.projectionDelta;const{visualElement:c}=i.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Us(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,xy(t,o)),s&&ns(i.latestValues)&&Us(t,i.latestValues))}e.x<eg&&e.x>Zh&&(e.x=1),e.y<eg&&e.y>Zh&&(e.y=1)}function Vs(t,e){t.min=t.min+e,t.max=t.max+e}function tg(t,e,r,s,n=.5){const i=tt(t.min,t.max,n);Hl(t,e,r,i,s)}function Us(t,e){tg(t.x,e.x,e.scaleX,e.scale,e.originX),tg(t.y,e.y,e.scaleY,e.scale,e.originY)}function by(t,e){return py(K1(t.getBoundingClientRect(),e))}function q1(t,e,r){const s=by(t,r),{scroll:n}=e;return n&&(Vs(s.x,n.offset.x),Vs(s.y,n.offset.y)),s}const rg=()=>({translate:0,scale:1,origin:0,originPoint:0}),Bs=()=>({x:rg(),y:rg()}),sg=()=>({min:0,max:0}),dt=()=>({x:sg(),y:sg()}),Gl={current:null},vy={current:!1};function X1(){if(vy.current=!0,!!ed)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Gl.current=t.matches;t.addEventListener("change",e),e()}else Gl.current=!1}const Q1=new WeakMap;function J1(t,e,r){for(const s in e){const n=e[s],i=r[s];if(St(n))t.addValue(s,n);else if(St(i))t.addValue(s,tn(n,{owner:t}));else if(i!==n)if(t.hasValue(s)){const o=t.getValue(s);o.liveStyle===!0?o.jump(n):o.hasAnimated||o.set(n)}else{const o=t.getStaticValue(s);t.addValue(s,tn(o!==void 0?o:n,{owner:t}))}}for(const s in r)e[s]===void 0&&t.removeValue(s);return e}const ng=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Z1{scrapeMotionValuesFromProps(e,r,s){return{}}constructor({parent:e,props:r,presenceContext:s,reducedMotionConfig:n,blockInitialAnimation:i,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=yd,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=Mt.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,et.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=r.initial?{...c}:{},this.renderState=d,this.parent=e,this.props=r,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=n,this.options=l,this.blockInitialAnimation=!!i,this.isControllingVariants=oo(r),this.isVariantNode=ay(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(r,{},this);for(const g in h){const m=h[g];c[g]!==void 0&&St(m)&&m.set(c[g])}}mount(e){this.current=e,Q1.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),vy.current||X1(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Gl.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Jr(this.notifyUpdate),Jr(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const r=this.features[e];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,r){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=pn.has(e);s&&this.onBindTransform&&this.onBindTransform();const n=r.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&et.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,r)),this.valueSubscriptions.set(e,()=>{n(),i&&i(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in rn){const r=rn[e];if(!r)continue;const{isEnabled:s,Feature:n}=r;if(!this.features[e]&&n&&s(this.props)&&(this.features[e]=new n(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):dt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let s=0;s<ng.length;s++){const n=ng[s];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const i="on"+n,o=e[i];o&&(this.propEventSubscriptions[n]=this.on(n,o))}this.prevMotionValues=J1(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const s=this.values.get(e);r!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&r!==void 0&&(s=tn(r===null?void 0:r,{owner:this}),this.addValue(e,s)),s}readValue(e,r){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(h0(s)||m0(s))?s=parseFloat(s):!h1(s)&&Zr.test(r)&&(s=X0(e,r)),this.setBaseTarget(e,St(s)?s.get():s)),St(s)?s.get():s}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){const{initial:r}=this.props;let s;if(typeof r=="string"||typeof r=="object"){const i=_d(this.props,r,this.presenceContext?.custom);i&&(s=i[e])}if(r&&s!==void 0)return s;const n=this.getBaseTargetFromProps(this.props,e);return n!==void 0&&!St(n)?n:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new id),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}scheduleRenderMicrotask(){vd.render(this.render)}}class wy extends Z1{constructor(){super(...arguments),this.KeyframeResolver=ZE}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){return e.style?e.style[r]:void 0}removeValueFromRenderState(e,{vars:r,style:s}){delete r[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;St(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function ky(t,{style:e,vars:r},s,n){const i=t.style;let o;for(o in e)i[o]=e[o];n?.applyProjectionStyles(i,s);for(o in r)i.setProperty(o,r[o])}function eI(t){return window.getComputedStyle(t)}class tI extends wy{constructor(){super(...arguments),this.type="html",this.renderInstance=ky}readValueFromInstance(e,r){if(pn.has(r))return this.projection?.isProjecting?Ml(r):xE(e,r);{const s=eI(e),n=(D0(r)?s.getPropertyValue(r):s[r])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(e,{transformPagePoint:r}){return by(e,r)}build(e,r,s){Nd(e,r,s.transformTemplate)}scrapeMotionValuesFromProps(e,r,s){return Dd(e,r,s)}}const Ty=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function rI(t,e,r,s){ky(t,e,void 0,s);for(const n in e.attrs)t.setAttribute(Ty.has(n)?n:Cd(n),e.attrs[n])}class sI extends wy{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=dt}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(pn.has(r)){const s=q0(r);return s&&s.default||0}return r=Ty.has(r)?r:Cd(r),e.getAttribute(r)}scrapeMotionValuesFromProps(e,r,s){return hy(e,r,s)}build(e,r,s){ly(e,r,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,r,s,n){rI(e,r,s,n)}mount(e){this.isSVGTag=dy(e.tagName),super.mount(e)}}const nI=(t,e)=>jd(t)?new sI(e):new tI(e,{allowProjection:t!==p.Fragment});function Ys(t,e,r){const s=t.getProps();return _d(s,e,r!==void 0?r:s.custom,t)}const zl=t=>Array.isArray(t);function aI(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,tn(r))}function iI(t){return zl(t)?t[t.length-1]||0:t}function oI(t,e){const r=Ys(t,e);let{transitionEnd:s={},transition:n={},...i}=r||{};i={...i,...s};for(const o in i){const l=iI(i[o]);aI(t,o,l)}}function lI(t){return!!(St(t)&&t.add)}function Kl(t,e){const r=t.getValue("willChange");if(lI(r))return r.add(e);if(!r&&Er.WillChange){const s=new Er.WillChange("auto");t.addValue("willChange",s),s.add(e)}}function Ny(t){return t.props[gy]}const cI=t=>t!==null;function dI(t,{repeat:e,repeatType:r="loop"},s){const n=t.filter(cI),i=e&&r!=="loop"&&e%2===1?0:n.length-1;return n[i]}const uI={type:"spring",stiffness:500,damping:25,restSpeed:10},hI=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),gI={type:"keyframes",duration:.8},mI={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},fI=(t,{keyframes:e})=>e.length>2?gI:pn.has(t)?t.startsWith("scale")?hI(e[1]):uI:mI;function pI({when:t,delay:e,delayChildren:r,staggerChildren:s,staggerDirection:n,repeat:i,repeatType:o,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Ed=(t,e,r,s={},n,i)=>o=>{const l=xd(s,t)||{},c=l.delay||s.delay||0;let{elapsed:d=0}=s;d=d-fr(c);const u={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-d,onUpdate:g=>{e.set(g),l.onUpdate&&l.onUpdate(g)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:i?void 0:n};pI(l)||Object.assign(u,fI(t,u)),u.duration&&(u.duration=fr(u.duration)),u.repeatDelay&&(u.repeatDelay=fr(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(Wl(u),u.delay===0&&(h=!0)),(Er.instantAnimations||Er.skipAnimations)&&(h=!0,Wl(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,h&&!i&&e.get()!==void 0){const g=dI(u.keyframes,l);if(g!==void 0){et.update(()=>{u.onUpdate(g),u.onComplete()});return}}return l.isSync?new pd(u):new VE(u)};function yI({protectedKeys:t,needsAnimating:e},r){const s=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,s}function Sy(t,e,{delay:r=0,transitionOverride:s,type:n}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...l}=e;s&&(i=s);const c=[],d=n&&t.animationState&&t.animationState.getState()[n];for(const u in l){const h=t.getValue(u,t.latestValues[u]??null),g=l[u];if(g===void 0||d&&yI(d,u))continue;const m={delay:r,...xd(i||{},u)},x=h.get();if(x!==void 0&&!h.isAnimating&&!Array.isArray(g)&&g===x&&!m.velocity)continue;let f=!1;if(window.MotionHandoffAnimation){const w=Ny(t);if(w){const v=window.MotionHandoffAnimation(w,u,et);v!==null&&(m.startTime=v,f=!0)}}Kl(t,u),h.start(Ed(u,h,g,t.shouldReduceMotion&&z0.has(u)?{type:!1}:m,t,f));const y=h.animation;y&&c.push(y)}return o&&Promise.all(c).then(()=>{et.update(()=>{o&&oI(t,o)})}),c}function jy(t,e,r,s=0,n=1){const i=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),o=t.size,l=(o-1)*s;return typeof r=="function"?r(i,o):n===1?i*s:l-i*s}function Yl(t,e,r={}){const s=Ys(t,e,r.type==="exit"?t.presenceContext?.custom:void 0);let{transition:n=t.getDefaultTransition()||{}}=s||{};r.transitionOverride&&(n=r.transitionOverride);const i=s?()=>Promise.all(Sy(t,s,r)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=n;return xI(t,e,c,d,u,h,r)}:()=>Promise.resolve(),{when:l}=n;if(l){const[c,d]=l==="beforeChildren"?[i,o]:[o,i];return c().then(()=>d())}else return Promise.all([i(),o(r.delay)])}function xI(t,e,r=0,s=0,n=0,i=1,o){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(Yl(c,e,{...o,delay:r+(typeof s=="function"?0:s)+jy(t.variantChildren,c,s,n,i)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function bI(t,e,r={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const n=e.map(i=>Yl(t,i,r));s=Promise.all(n)}else if(typeof e=="string")s=Yl(t,e,r);else{const n=typeof e=="function"?Ys(t,e,r.custom):e;s=Promise.all(Sy(t,n,r))}return s.then(()=>{t.notify("AnimationComplete",e)})}function _y(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let s=0;s<r;s++)if(e[s]!==t[s])return!1;return!0}const vI=Td.length;function Dy(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?Dy(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const e={};for(let r=0;r<vI;r++){const s=Td[r],n=t.props[s];(ga(n)||n===!1)&&(e[s]=n)}return e}const wI=[...kd].reverse(),kI=kd.length;function TI(t){return e=>Promise.all(e.map(({animation:r,options:s})=>bI(t,r,s)))}function NI(t){let e=TI(t),r=ag(),s=!0;const n=c=>(d,u)=>{const h=Ys(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:g,transitionEnd:m,...x}=h;d={...d,...x,...m}}return d};function i(c){e=c(t)}function o(c){const{props:d}=t,u=Dy(t.parent)||{},h=[],g=new Set;let m={},x=1/0;for(let y=0;y<kI;y++){const w=wI[y],v=r[w],k=d[w]!==void 0?d[w]:u[w],b=ga(k),j=w===c?v.isActive:null;j===!1&&(x=y);let D=k===u[w]&&k!==d[w]&&b;if(D&&s&&t.manuallyAnimateOnMount&&(D=!1),v.protectedKeys={...m},!v.isActive&&j===null||!k&&!v.prevProp||io(k)||typeof k=="boolean")continue;const N=SI(v.prevProp,k);let T=N||w===c&&v.isActive&&!D&&b||y>x&&b,_=!1;const P=Array.isArray(k)?k:[k];let C=P.reduce(n(w),{});j===!1&&(C={});const{prevResolvedValues:A={}}=v,B={...A,...C},z=V=>{T=!0,g.has(V)&&(_=!0,g.delete(V)),v.needsAnimating[V]=!0;const ce=t.getValue(V);ce&&(ce.liveStyle=!1)};for(const V in B){const ce=C[V],ke=A[V];if(m.hasOwnProperty(V))continue;let Se=!1;zl(ce)&&zl(ke)?Se=!_y(ce,ke):Se=ce!==ke,Se?ce!=null?z(V):g.add(V):ce!==void 0&&g.has(V)?z(V):v.protectedKeys[V]=!0}v.prevProp=k,v.prevResolvedValues=C,v.isActive&&(m={...m,...C}),s&&t.blockInitialAnimation&&(T=!1);const W=D&&N;T&&(!W||_)&&h.push(...P.map(V=>{const ce={type:w};if(typeof V=="string"&&s&&!W&&t.manuallyAnimateOnMount&&t.parent){const{parent:ke}=t,Se=Ys(ke,V);if(ke.enteringChildren&&Se){const{delayChildren:me}=Se.transition||{};ce.delay=jy(ke.enteringChildren,t,me)}}return{animation:V,options:ce}}))}if(g.size){const y={};if(typeof d.initial!="boolean"){const w=Ys(t,Array.isArray(d.initial)?d.initial[0]:d.initial);w&&w.transition&&(y.transition=w.transition)}g.forEach(w=>{const v=t.getBaseTarget(w),k=t.getValue(w);k&&(k.liveStyle=!0),y[w]=v??null}),h.push({animation:y})}let f=!!h.length;return s&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(f=!1),s=!1,f?e(h):Promise.resolve()}function l(c,d){if(r[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(c,d)),r[c].isActive=d;const u=o(c);for(const h in r)r[h].protectedKeys={};return u}return{animateChanges:o,setActive:l,setAnimateFunction:i,getState:()=>r,reset:()=>{r=ag()}}}function SI(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!_y(e,t):!1}function rs(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ag(){return{animate:rs(!0),whileInView:rs(),whileHover:rs(),whileTap:rs(),whileDrag:rs(),whileFocus:rs(),exit:rs()}}class es{constructor(e){this.isMounted=!1,this.node=e}update(){}}class jI extends es{constructor(e){super(e),e.animationState||(e.animationState=NI(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();io(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let _I=0;class DI extends es{constructor(){super(...arguments),this.id=_I++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const n=this.node.animationState.setActive("exit",!e);r&&!e&&n.then(()=>{r(this.id)})}mount(){const{register:e,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const CI={animation:{Feature:jI},exit:{Feature:DI}};function ma(t,e,r,s={passive:!0}){return t.addEventListener(e,r,s),()=>t.removeEventListener(e,r)}function Ra(t){return{point:{x:t.pageX,y:t.pageY}}}const EI=t=>e=>wd(e)&&t(e,Ra(e));function zn(t,e,r,s){return ma(t,e,EI(r),s)}const Cy=1e-4,II=1-Cy,AI=1+Cy,Ey=.01,RI=0-Ey,PI=0+Ey;function Ct(t){return t.max-t.min}function MI(t,e,r){return Math.abs(t-e)<=r}function ig(t,e,r,s=.5){t.origin=s,t.originPoint=tt(e.min,e.max,t.origin),t.scale=Ct(r)/Ct(e),t.translate=tt(r.min,r.max,t.origin)-t.originPoint,(t.scale>=II&&t.scale<=AI||isNaN(t.scale))&&(t.scale=1),(t.translate>=RI&&t.translate<=PI||isNaN(t.translate))&&(t.translate=0)}function Kn(t,e,r,s){ig(t.x,e.x,r.x,s?s.originX:void 0),ig(t.y,e.y,r.y,s?s.originY:void 0)}function og(t,e,r){t.min=r.min+e.min,t.max=t.min+Ct(e)}function OI(t,e,r){og(t.x,e.x,r.x),og(t.y,e.y,r.y)}function lg(t,e,r){t.min=e.min-r.min,t.max=t.min+Ct(e)}function Oi(t,e,r){lg(t.x,e.x,r.x),lg(t.y,e.y,r.y)}function zt(t){return[t("x"),t("y")]}const Iy=({current:t})=>t?t.ownerDocument.defaultView:null,cg=(t,e)=>Math.abs(t-e);function LI(t,e){const r=cg(t.x,e.x),s=cg(t.y,e.y);return Math.sqrt(r**2+s**2)}class Ay{constructor(e,r,{transformPagePoint:s,contextWindow:n=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=Ko(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,x=LI(g.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!x)return;const{point:f}=g,{timestamp:y}=kt;this.history.push({...f,timestamp:y});const{onStart:w,onMove:v}=this.handlers;m||(w&&w(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,g)},this.handlePointerMove=(g,m)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=zo(m,this.transformPagePoint),et.update(this.updatePoint,!0)},this.handlePointerUp=(g,m)=>{this.end();const{onEnd:x,onSessionEnd:f,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const w=Ko(g.type==="pointercancel"?this.lastMoveEventInfo:zo(m,this.transformPagePoint),this.history);this.startEvent&&x&&x(g,w),f&&f(g,w)},!wd(e))return;this.dragSnapToOrigin=i,this.handlers=r,this.transformPagePoint=s,this.distanceThreshold=o,this.contextWindow=n||window;const l=Ra(e),c=zo(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=kt;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=r;h&&h(e,Ko(c,this.history)),this.removeListeners=Ea(zn(this.contextWindow,"pointermove",this.handlePointerMove),zn(this.contextWindow,"pointerup",this.handlePointerUp),zn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Jr(this.updatePoint)}}function zo(t,e){return e?{point:e(t.point)}:t}function dg(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Ko({point:t},e){return{point:t,delta:dg(t,Ry(e)),offset:dg(t,$I(e)),velocity:FI(e,.1)}}function $I(t){return t[0]}function Ry(t){return t[t.length-1]}function FI(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,s=null;const n=Ry(t);for(;r>=0&&(s=t[r],!(n.timestamp-s.timestamp>fr(e)));)r--;if(!s)return{x:0,y:0};const i=qt(n.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const o={x:(n.x-s.x)/i,y:(n.y-s.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function WI(t,{min:e,max:r},s){return e!==void 0&&t<e?t=s?tt(e,t,s.min):Math.max(t,e):r!==void 0&&t>r&&(t=s?tt(r,t,s.max):Math.min(t,r)),t}function ug(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function VI(t,{top:e,left:r,bottom:s,right:n}){return{x:ug(t.x,r,n),y:ug(t.y,e,s)}}function hg(t,e){let r=e.min-t.min,s=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,s]=[s,r]),{min:r,max:s}}function UI(t,e){return{x:hg(t.x,e.x),y:hg(t.y,e.y)}}function BI(t,e){let r=.5;const s=Ct(t),n=Ct(e);return n>s?r=da(e.min,e.max-s,t.min):s>n&&(r=da(t.min,t.max-n,e.min)),Cr(0,1,r)}function HI(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const ql=.35;function GI(t=ql){return t===!1?t=0:t===!0&&(t=ql),{x:gg(t,"left","right"),y:gg(t,"top","bottom")}}function gg(t,e,r){return{min:mg(t,e),max:mg(t,r)}}function mg(t,e){return typeof t=="number"?t:t[e]||0}const zI=new WeakMap;class KI{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=dt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:r=!1,distanceThreshold:s}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const i=h=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Ra(h).point)},o=(h,g)=>{const{drag:m,dragPropagation:x,onDragStart:f}=this.getProps();if(m&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=n1(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),zt(w=>{let v=this.getAxisMotionValue(w).get()||0;if(pr.test(v)){const{projection:k}=this.visualElement;if(k&&k.layout){const b=k.layout.layoutBox[w];b&&(v=Ct(b)*(parseFloat(v)/100))}}this.originPoint[w]=v}),f&&et.postRender(()=>f(h,g)),Kl(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},l=(h,g)=>{this.latestPointerEvent=h,this.latestPanInfo=g;const{dragPropagation:m,dragDirectionLock:x,onDirectionLock:f,onDrag:y}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:w}=g;if(x&&this.currentDirection===null){this.currentDirection=YI(w),this.currentDirection!==null&&f&&f(this.currentDirection);return}this.updateAxis("x",g.point,w),this.updateAxis("y",g.point,w),this.visualElement.render(),y&&y(h,g)},c=(h,g)=>{this.latestPointerEvent=h,this.latestPanInfo=g,this.stop(h,g),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>zt(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Ay(e,{onSessionStart:i,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:Iy(this.visualElement)})}stop(e,r){const s=e||this.latestPointerEvent,n=r||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!n||!s)return;const{velocity:o}=n;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&et.postRender(()=>l(s,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(e,r,s){const{drag:n}=this.getProps();if(!s||!Ba(e,n,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(o=WI(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:r}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,n=this.constraints;e&&Ws(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=VI(s.layoutBox,e):this.constraints=!1,this.elastic=GI(r),n!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&zt(i=>{this.constraints!==!1&&this.getAxisMotionValue(i)&&(this.constraints[i]=HI(s.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!Ws(e))return!1;const s=e.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const i=q1(s,n.root,this.visualElement.getTransformPagePoint());let o=UI(n.layout.layoutBox,i);if(r){const l=r(z1(o));this.hasMutatedConstraints=!!l,l&&(o=py(l))}return o}startAnimation(e){const{drag:r,dragMomentum:s,dragElastic:n,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=zt(u=>{if(!Ba(u,r,this.currentDirection))return;let h=c&&c[u]||{};o&&(h={min:0,max:0});const g=n?200:1e6,m=n?40:1e7,x={type:"inertia",velocity:s?e[u]:0,bounceStiffness:g,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(e,r){const s=this.getAxisMotionValue(e);return Kl(this.visualElement,e),s.start(Ed(e,s,0,r,this.visualElement,!1))}stopAnimation(){zt(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){zt(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),n=s[r];return n||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){zt(r=>{const{drag:s}=this.getProps();if(!Ba(r,s,this.currentDirection))return;const{projection:n}=this.visualElement,i=this.getAxisMotionValue(r);if(n&&n.layout){const{min:o,max:l}=n.layout.layoutBox[r];i.set(e[r]-tt(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:s}=this.visualElement;if(!Ws(r)||!s||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};zt(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();n[o]=BI({min:c,max:c},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),zt(o=>{if(!Ba(o,e,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(tt(c,d,n[o]))})}addListeners(){if(!this.visualElement.current)return;zI.set(this.visualElement,this);const e=this.visualElement.current,r=zn(e,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();Ws(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",s);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),et.read(s);const o=ma(window,"resize",()=>this.scalePositionWithinConstraints()),l=n.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(zt(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())});return()=>{o(),r(),i(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:s=!1,dragPropagation:n=!1,dragConstraints:i=!1,dragElastic:o=ql,dragMomentum:l=!0}=e;return{...e,drag:r,dragDirectionLock:s,dragPropagation:n,dragConstraints:i,dragElastic:o,dragMomentum:l}}}function Ba(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function YI(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class qI extends es{constructor(e){super(e),this.removeGroupControls=Xt,this.removeListeners=Xt,this.controls=new KI(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xt}unmount(){this.removeGroupControls(),this.removeListeners()}}const fg=t=>(e,r)=>{t&&et.postRender(()=>t(e,r))};class XI extends es{constructor(){super(...arguments),this.removePointerDownListener=Xt}onPointerDown(e){this.session=new Ay(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Iy(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:s,onPanEnd:n}=this.node.getProps();return{onSessionStart:fg(e),onStart:fg(r),onMove:s,onEnd:(i,o)=>{delete this.session,n&&et.postRender(()=>n(i,o))}}}mount(){this.removePointerDownListener=zn(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Ja={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let Yo=!1;class QI extends p.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:s,layoutId:n}=this.props,{projection:i}=e;i&&(r.group&&r.group.add(i),s&&s.register&&n&&s.register(i),Yo&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Ja.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:s,drag:n,isPresent:i}=this.props,{projection:o}=s;return o&&(o.isPresent=i,Yo=!0,n||e.layoutDependency!==r||r===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||et.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),vd.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:s}=this.props,{projection:n}=e;Yo=!0,n&&(n.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(n),s&&s.deregister&&s.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Py(t){const[e,r]=g1(),s=p.useContext(u0);return a.jsx(QI,{...t,layoutGroup:s,switchLayoutGroup:p.useContext(my),isPresent:e,safeToRemove:r})}function JI(t,e,r){const s=St(t)?t:tn(t);return s.start(Ed("",s,e,r)),s.animation}const ZI=(t,e)=>t.depth-e.depth;class eA{constructor(){this.children=[],this.isDirty=!1}add(e){rd(this.children,e),this.isDirty=!0}remove(e){sd(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(ZI),this.isDirty=!1,this.children.forEach(e)}}function tA(t,e){const r=Mt.now(),s=({timestamp:n})=>{const i=n-r;i>=e&&(Jr(s),t(i-e))};return et.setup(s,!0),()=>Jr(s)}const My=["TopLeft","TopRight","BottomLeft","BottomRight"],rA=My.length,pg=t=>typeof t=="string"?parseFloat(t):t,yg=t=>typeof t=="number"||Ce.test(t);function sA(t,e,r,s,n,i){n?(t.opacity=tt(0,r.opacity??1,nA(s)),t.opacityExit=tt(e.opacity??1,0,aA(s))):i&&(t.opacity=tt(e.opacity??1,r.opacity??1,s));for(let o=0;o<rA;o++){const l=`border${My[o]}Radius`;let c=xg(e,l),d=xg(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||yg(c)===yg(d)?(t[l]=Math.max(tt(pg(c),pg(d),s),0),(pr.test(d)||pr.test(c))&&(t[l]+="%")):t[l]=d}(e.rotate||r.rotate)&&(t.rotate=tt(e.rotate||0,r.rotate||0,s))}function xg(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const nA=Oy(0,.5,k0),aA=Oy(.5,.95,Xt);function Oy(t,e,r){return s=>s<t?0:s>e?1:r(da(t,e,s))}function bg(t,e){t.min=e.min,t.max=e.max}function Qt(t,e){bg(t.x,e.x),bg(t.y,e.y)}function vg(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function wg(t,e,r,s,n){return t-=e,t=Mi(t,1/r,s),n!==void 0&&(t=Mi(t,1/n,s)),t}function iA(t,e=0,r=1,s=.5,n,i=t,o=t){if(pr.test(e)&&(e=parseFloat(e),e=tt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let l=tt(i.min,i.max,s);t===i&&(l-=e),t.min=wg(t.min,e,r,l,n),t.max=wg(t.max,e,r,l,n)}function kg(t,e,[r,s,n],i,o){iA(t,e[r],e[s],e[n],e.scale,i,o)}const oA=["x","scaleX","originX"],lA=["y","scaleY","originY"];function Tg(t,e,r,s){kg(t.x,e,oA,r?r.x:void 0,s?s.x:void 0),kg(t.y,e,lA,r?r.y:void 0,s?s.y:void 0)}function Ng(t){return t.translate===0&&t.scale===1}function Ly(t){return Ng(t.x)&&Ng(t.y)}function Sg(t,e){return t.min===e.min&&t.max===e.max}function cA(t,e){return Sg(t.x,e.x)&&Sg(t.y,e.y)}function jg(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function $y(t,e){return jg(t.x,e.x)&&jg(t.y,e.y)}function _g(t){return Ct(t.x)/Ct(t.y)}function Dg(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class dA{constructor(){this.members=[]}add(e){rd(this.members,e),e.scheduleRender()}remove(e){if(sd(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(n=>e===n);if(r===0)return!1;let s;for(let n=r;n>=0;n--){const i=this.members[n];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(e,r){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,r&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;n===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:s}=e;r.onExitComplete&&r.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function uA(t,e,r){let s="";const n=t.x.translate/e.x,i=t.y.translate/e.y,o=r?.z||0;if((n||i||o)&&(s=`translate3d(${n}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:g,skewX:m,skewY:x}=r;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),g&&(s+=`rotateY(${g}deg) `),m&&(s+=`skewX(${m}deg) `),x&&(s+=`skewY(${x}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(s+=`scale(${l}, ${c})`),s||"none"}const qo=["","X","Y","Z"],hA=1e3;let gA=0;function Xo(t,e,r,s){const{latestValues:n}=e;n[t]&&(r[t]=n[t],e.setStaticValue(t,0),s&&(s[t]=0))}function Fy(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const r=Ny(e);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:n,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",et,!(n||i))}const{parent:s}=t;s&&!s.hasCheckedOptimisedAppear&&Fy(s)}function Wy({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:s,resetTransform:n}){return class{constructor(o={},l=e?.()){this.id=gA++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(pA),this.nodes.forEach(vA),this.nodes.forEach(wA),this.nodes.forEach(yA)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new eA)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new id),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=ty(o)&&!d1(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,h=0;const g=()=>this.root.updateBlockedByResize=!1;et.read(()=>{h=window.innerWidth}),t(o,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=tA(g,250),Ja.hasAnimatedSinceResize&&(Ja.hasAnimatedSinceResize=!1,this.nodes.forEach(Ig)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:g,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||d.getDefaultTransition()||jA,{onLayoutAnimationStart:f,onLayoutAnimationComplete:y}=d.getProps(),w=!this.targetLayout||!$y(this.targetLayout,m),v=!h&&g;if(this.options.layoutRoot||this.resumeFrom||v||h&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...xd(x,"layout"),onPlay:f,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(u,v)}else h||Ig(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Jr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(kA),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Fy(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Cg);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Eg);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(bA),this.nodes.forEach(mA),this.nodes.forEach(fA)):this.nodes.forEach(Eg),this.clearAllSnapshots();const l=Mt.now();kt.delta=Cr(0,1e3/60,l-kt.timestamp),kt.timestamp=l,kt.isProcessing=!0,$o.update.process(kt),$o.preRender.process(kt),$o.render.process(kt),kt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,vd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(xA),this.sharedNodes.forEach(TA)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,et.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){et.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ct(this.snapshot.measuredBox.x)&&!Ct(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=dt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!n)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Ly(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;o&&this.instance&&(l||ns(this.latestValues)||u)&&(n(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),_A(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return dt();const l=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(DA))){const{scroll:d}=this.root;d&&(Vs(l.x,d.offset.x),Vs(l.y,d.offset.y))}return l}removeElementScroll(o){const l=dt();if(Qt(l,o),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&Qt(l,o),Vs(l.x,u.offset.x),Vs(l.y,u.offset.y))}return l}applyTransform(o,l=!1){const c=dt();Qt(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Us(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),ns(u.latestValues)&&Us(c,u.latestValues)}return ns(this.latestValues)&&Us(c,this.latestValues),c}removeTransform(o){const l=dt();Qt(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!ns(d.latestValues))continue;Bl(d.latestValues)&&d.updateSnapshot();const u=dt(),h=d.measurePageBox();Qt(u,h),Tg(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return ns(this.latestValues)&&Tg(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==kt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=kt.timestamp;const g=this.getClosestProjectingParent();g&&this.linkedParentVersion!==g.layoutVersion&&!g.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(g&&g.layout?this.createRelativeTarget(g,this.layout.layoutBox,g.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=dt(),this.targetWithTransforms=dt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),OI(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Qt(this.target,this.layout.layoutBox),xy(this.target,this.targetDelta)):Qt(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?this.createRelativeTarget(g,this.target,g.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Bl(this.parent.latestValues)||yy(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,l,c){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=dt(),this.relativeTargetOrigin=dt(),Oi(this.relativeTargetOrigin,l,c),Qt(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===kt.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Qt(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,g=this.treeScale.y;Y1(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=dt());const{target:m}=o;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(vg(this.prevProjectionDelta.x,this.projectionDelta.x),vg(this.prevProjectionDelta.y,this.projectionDelta.y)),Kn(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==g||!Dg(this.projectionDelta.x,this.prevProjectionDelta.x)||!Dg(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Bs(),this.projectionDelta=Bs(),this.projectionDeltaWithTransform=Bs()}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},h=Bs();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const g=dt(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,f=m!==x,y=this.getStack(),w=!y||y.members.length<=1,v=!!(f&&!w&&this.options.crossfade===!0&&!this.path.some(SA));this.animationProgress=0;let k;this.mixTargetDelta=b=>{const j=b/1e3;Ag(h.x,o.x,j),Ag(h.y,o.y,j),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Oi(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),NA(this.relativeTarget,this.relativeTargetOrigin,g,j),k&&cA(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=dt()),Qt(k,this.relativeTarget)),f&&(this.animationValues=u,sA(u,d,this.latestValues,j,v,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=j},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Jr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=et.update(()=>{Ja.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=tn(0)),this.currentAnimation=JI(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(hA),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&Vy(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||dt();const h=Ct(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+h;const g=Ct(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+g}Qt(l,c),Us(l,u),Kn(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new dA),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Xo("z",o,d,this.animationValues);for(let u=0;u<qo.length;u++)Xo(`rotate${qo[u]}`,o,d,this.animationValues),Xo(`skew${qo[u]}`,o,d,this.animationValues);o.render();for(const u in d)o.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Qa(l?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Qa(l?.pointerEvents)||""),this.hasProjected&&!ns(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=uA(this.projectionDeltaWithTransform,this.treeScale,u);c&&(h=c(u,h)),o.transform=h;const{x:g,y:m}=this.projectionDelta;o.transformOrigin=`${g.origin*100}% ${m.origin*100}% 0`,d.animationValues?o.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const x in Ul){if(u[x]===void 0)continue;const{correct:f,applyTo:y,isCSSVariable:w}=Ul[x],v=h==="none"?u[x]:f(u[x],d);if(y){const k=y.length;for(let b=0;b<k;b++)o[y[b]]=v}else w?this.options.visualElement.renderState.vars[x]=v:o[x]=v}this.options.layoutId&&(o.pointerEvents=d===this?Qa(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(Cg),this.root.sharedNodes.clear()}}}function mA(t){t.updateLayout()}function fA(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:n}=t.options,i=e.source!==t.layout.source;n==="size"?zt(u=>{const h=i?e.measuredBox[u]:e.layoutBox[u],g=Ct(h);h.min=r[u].min,h.max=h.min+g}):Vy(n,e.layoutBox,r)&&zt(u=>{const h=i?e.measuredBox[u]:e.layoutBox[u],g=Ct(r[u]);h.max=h.min+g,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+g)});const o=Bs();Kn(o,r,e.layoutBox);const l=Bs();i?Kn(l,t.applyTransform(s,!0),e.measuredBox):Kn(l,r,e.layoutBox);const c=!Ly(o);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:g}=u;if(h&&g){const m=dt();Oi(m,e.layoutBox,h.layoutBox);const x=dt();Oi(x,r,g.layoutBox),$y(m,x)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=m,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function pA(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function yA(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function xA(t){t.clearSnapshot()}function Cg(t){t.clearMeasurements()}function Eg(t){t.isLayoutDirty=!1}function bA(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Ig(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function vA(t){t.resolveTargetDelta()}function wA(t){t.calcProjection()}function kA(t){t.resetSkewAndRotation()}function TA(t){t.removeLeadSnapshot()}function Ag(t,e,r){t.translate=tt(e.translate,0,r),t.scale=tt(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function Rg(t,e,r,s){t.min=tt(e.min,r.min,s),t.max=tt(e.max,r.max,s)}function NA(t,e,r,s){Rg(t.x,e.x,r.x,s),Rg(t.y,e.y,r.y,s)}function SA(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const jA={duration:.45,ease:[.4,0,.1,1]},Pg=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Mg=Pg("applewebkit/")&&!Pg("chrome/")?Math.round:Xt;function Og(t){t.min=Mg(t.min),t.max=Mg(t.max)}function _A(t){Og(t.x),Og(t.y)}function Vy(t,e,r){return t==="position"||t==="preserve-aspect"&&!MI(_g(e),_g(r),.2)}function DA(t){return t!==t.root&&t.scroll?.wasRoot}const CA=Wy({attachResizeListener:(t,e)=>ma(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Qo={current:void 0},Uy=Wy({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Qo.current){const t=new CA({});t.mount(window),t.setOptions({layoutScroll:!0}),Qo.current=t}return Qo.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),EA={pan:{Feature:XI},drag:{Feature:qI,ProjectionNode:Uy,MeasureLayout:Py}};function Lg(t,e,r){const{props:s}=t;t.animationState&&s.whileHover&&t.animationState.setActive("whileHover",r==="Start");const n="onHover"+r,i=s[n];i&&et.postRender(()=>i(e,Ra(e)))}class IA extends es{mount(){const{current:e}=this.node;e&&(this.unmount=a1(e,(r,s)=>(Lg(this.node,s,"Start"),n=>Lg(this.node,n,"End"))))}unmount(){}}class AA extends es{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ea(ma(this.node.current,"focus",()=>this.onFocus()),ma(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function $g(t,e,r){const{props:s}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&s.whileTap&&t.animationState.setActive("whileTap",r==="Start");const n="onTap"+(r==="End"?"":r),i=s[n];i&&et.postRender(()=>i(e,Ra(e)))}class RA extends es{mount(){const{current:e}=this.node;e&&(this.unmount=c1(e,(r,s)=>($g(this.node,s,"Start"),(n,{success:i})=>$g(this.node,n,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Xl=new WeakMap,Jo=new WeakMap,PA=t=>{const e=Xl.get(t.target);e&&e(t)},MA=t=>{t.forEach(PA)};function OA({root:t,...e}){const r=t||document;Jo.has(r)||Jo.set(r,{});const s=Jo.get(r),n=JSON.stringify(e);return s[n]||(s[n]=new IntersectionObserver(MA,{root:t,...e})),s[n]}function LA(t,e,r){const s=OA(e);return Xl.set(t,r),s.observe(t),()=>{Xl.delete(t),s.unobserve(t)}}const $A={some:0,all:1};class FA extends es{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:s,amount:n="some",once:i}=e,o={root:r?r.current:void 0,rootMargin:s,threshold:typeof n=="number"?n:$A[n]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),g=d?u:h;g&&g(c)};return LA(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(WA(e,r))&&this.startObserver()}unmount(){}}function WA({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const VA={inView:{Feature:FA},tap:{Feature:RA},focus:{Feature:AA},hover:{Feature:IA}},UA={layout:{ProjectionNode:Uy,MeasureLayout:Py}},BA={...CI,...VA,...EA,...UA},HA=G1(BA,nI),GA=()=>{const{t}=Xe(),{currentTheme:e,isDark:r}=Et(),s=!!e.bg,n=[{id:"basics",title:t("guide.basics.title"),icon:Qg,items:[{title:t("guide.basics.add"),desc:t("guide.basics.addDesc")},{title:t("guide.basics.complete"),desc:t("guide.basics.completeDesc")},{title:t("guide.basics.edit"),desc:t("guide.basics.editDesc")}]},{id:"calendar",title:t("guide.calendar.title"),icon:at,items:[{title:t("guide.calendar.views"),desc:t("guide.calendar.viewsDesc")},{title:t("guide.calendar.nav"),desc:t("guide.calendar.navDesc")}]},{id:"advanced",title:t("guide.advanced.title"),icon:Xg,items:[{title:t("guide.advanced.recurring"),desc:t("guide.advanced.recurringDesc")},{title:t("guide.advanced.subtasks"),desc:t("guide.advanced.subtasksDesc")},{title:t("guide.advanced.tags"),desc:t("guide.advanced.tagsDesc")}]},{id:"sharing",title:t("guide.sharing.title"),icon:tr,items:[{title:t("guide.sharing.createDetail"),desc:t("guide.sharing.createDetailDesc")},{title:t("guide.sharing.permissionDetail"),desc:t("guide.sharing.permissionDetailDesc")},{title:t("guide.sharing.filterDetail"),desc:t("guide.sharing.filterDetailDesc")}]},{id:"notifications",title:t("guide.notifications.title"),icon:qn,items:[{title:t("guide.notifications.centerDetail"),desc:t("guide.notifications.centerDetailDesc")}]},{id:"account",title:t("guide.account.title"),icon:Li,items:[{title:t("guide.account.login"),desc:t("guide.account.loginDesc")},{title:t("guide.account.backup"),desc:t("guide.account.backupDesc")}]}];return a.jsxs("div",{className:"max-w-4xl mx-auto pb-20",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[a.jsx(fx,{className:"w-8 h-8 text-indigo-600"}),t("guide.title")]}),a.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:t("guide.subtitle")})]}),a.jsx("div",{className:"grid gap-6",children:n.map((i,o)=>a.jsxs(HA.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:o*.1},className:`${s?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700"} rounded-2xl p-6 shadow-sm border`,style:s?{backgroundColor:`rgba(${r?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-gray-100 dark:border-gray-700",children:[a.jsx("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:a.jsx(i.icon,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:i.title})]}),a.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:i.items.map((l,c)=>a.jsxs("div",{className:"space-y-2",children:[a.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500"}),l.title]}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed pl-3.5 border-l-2 border-gray-100 dark:border-gray-700",children:l.desc})]},c))})]},i.id))}),a.jsxs("div",{className:"mt-12 p-6 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl text-white shadow-xl",children:[a.jsx("h3",{className:"text-xl font-bold mb-2",children:t("guide.more.title")}),a.jsx("p",{className:"text-indigo-100 mb-6",children:t("guide.more.contact")}),a.jsx("button",{className:"px-6 py-2 bg-white text-indigo-600 font-bold rounded-lg hover:bg-indigo-50 transition-colors",children:t("guide.more.button")})]})]})},zA=()=>{const{t}=Xe(),{currentUser:e}=bt(),[r,s]=p.useState([]),[n,i]=p.useState([]),[o,l]=p.useState([]),[c,d]=p.useState(!1),[u,h]=p.useState(""),[g,m]=p.useState([]),[x,f]=p.useState(null),[y,w]=p.useState("edit"),[v,k]=p.useState(""),[b,j]=p.useState(null),[D,N]=p.useState(!1),[T,_]=p.useState(""),[P,C]=p.useState(!0),[A,B]=p.useState(""),[z,W]=p.useState(!1),[X,V]=p.useState([]),ce=L=>{switch(L){case"admin":return t("sharing.roleAdmin");case"edit":return t("sharing.roleEditor");case"view":return t("sharing.roleViewer");default:return L}};p.useEffect(()=>{if(!e?.uid)return;const L=te.subscribeSharingGroups(e.uid,G=>{s(G),C(!1)});return()=>L()},[e?.uid]),p.useEffect(()=>{if(!e?.email)return;const L=e.email.toLowerCase().trim(),G=te.subscribeToIncomingInvitations(L,O=>{i(O)});return()=>G()},[e?.email]),p.useEffect(()=>{if(!e?.uid)return;const L=te.subscribeToSentInvitations(e.uid,G=>{l(G.filter(O=>O.status==="pending"))});return()=>L()},[e?.uid]);const[ke,Se]=p.useState([]);p.useEffect(()=>{if(!e?.uid)return;const L=te.subscribeToSharingNotifications(e.uid,G=>{const O=G.filter(se=>!se.read&&!se.isRead);Se(O)});return()=>L()},[e?.uid]);const me=async L=>{try{await te.markNotificationAsRead(L)}catch(G){console.error("ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:",G)}},ue=async()=>{if(v.trim()){if(v===e?.email){_(t("sharing.cannotShareSelf"));return}N(!0),_(""),j(null);try{const L=await te.findUserByEmail(v);L?j(L):_(t("sharing.userNotFound"))}catch{_("Error searching user")}finally{N(!1)}}},Y=()=>{if(b){if(g.some(L=>L.uid===b.uid)){_(t("sharing.alreadyAdded"));return}m(L=>[...L,{...b,permission:y}]),j(null),k(""),w("edit")}},ie=async()=>{if(!u.trim()||g.length===0){_("Group name and at least 1 member required");return}W(!0);try{const L=await te.createSharingGroup(e.uid,{name:u,members:[{uid:e.uid,email:e.email.toLowerCase(),displayName:e.displayName||"",permission:"admin"}]});for(const G of g)await te.sendSharingInvitation({uid:e.uid,email:e.email,displayName:e.displayName||"",permission:"admin"},G.email.toLowerCase(),L,u,G.permission,G.displayName);B(`Group '${u}' created`),d(!1),h(""),m([])}catch{_("Failed to create group")}finally{W(!1)}},de=async L=>{if(b){W(!0);try{await te.sendSharingInvitation({uid:e.uid,email:e.email,displayName:e.displayName||"",permission:"admin"},b.email,L.id,L.name,y,b.displayName),B(t("sharing.inviteSent")),j(null),k(""),f(null),w("edit")}catch{_("Failed to invite")}finally{W(!1)}}},be=(L,G,O)=>{const se=r.find(pe=>pe.id===L);if(!se)return;const he=se.members.find(pe=>pe.uid===G);!he||he.permission===O||V(pe=>[...pe.filter(Ae=>!(Ae.groupId===L&&Ae.memberUid===G)),{groupId:L,memberUid:G,memberEmail:he.email,previousPermission:he.permission,newPermission:O}])},fe=async L=>{if(!e)return;const G=X.filter(O=>O.groupId===L);if(G.length!==0){W(!0);try{const O=r.find(he=>he.id===L);if(!O)return;const se=O.members.map(he=>{const pe=G.find(re=>re.memberUid===he.uid);return pe?{...he,permission:pe.newPermission}:he});await te.updateSharingGroup(e.uid,L,{members:se});for(const he of G)await te.sendPermissionChangeNotification({uid:e.uid,email:e.email},he.memberUid,L,O.name,he.previousPermission,he.newPermission);V(he=>he.filter(pe=>pe.groupId!==L)),B(`${G.length} permission(s) changed.`),setTimeout(()=>B(""),5e3)}catch(O){console.error("ê¶Œí•œ ë³€ê²½ ì €ì¥ ì‹¤íŒ¨:",O),_("Failed to save permission changes.")}finally{W(!1)}}},E=L=>X.some(G=>G.groupId===L),ee=(L,G)=>X.find(se=>se.groupId===L&&se.memberUid===G)?.newPermission,Q=async(L,G)=>{if(!window.confirm(t("sharing.confirmRemoveMember")||"Remove this member?"))return;const O=r.find(he=>he.id===L);if(!O)return;const se=O.members.filter(he=>he.uid!==G);await te.updateSharingGroup(e.uid,L,{members:se})},H=async L=>{window.confirm(t("sharing.confirmLeaveGroup")||"Leave this group?")&&await te.leaveSharingGroup(e.uid,L)},I=async L=>{window.confirm(t("sharing.confirmDeleteGroup"))&&await te.deleteSharingGroup(e.uid,L)},J=async(L,G)=>{await te.respondToInvitation(L.id,G,{uid:e.uid,email:e.email,displayName:e.displayName||"",permission:L.permission})},le=L=>o.filter(G=>G.groupId===L);return P?a.jsx("div",{className:"p-8 text-center",children:a.jsx(qs,{className:"w-8 h-8 animate-spin mx-auto"})}):a.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx(tr,{className:"w-6 h-6 text-primary-600"}),t("sharing.settingsTitle")]}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t("sharing.subtitle")})]}),a.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition",children:[a.jsx(Jl,{className:"w-4 h-4"}),t("sharing.createNewGroup")]})]}),A&&a.jsxs("div",{className:"p-4 bg-green-50 text-green-700 rounded-xl flex items-center gap-2 animate-fade-in",children:[a.jsx(Yt,{className:"w-4 h-4"})," ",A]}),T&&a.jsxs("div",{className:"p-4 bg-red-50 text-red-700 rounded-xl flex items-center gap-2 animate-fade-in",children:[a.jsx(tc,{className:"w-4 h-4"})," ",T]}),n.length>0&&a.jsxs("section",{className:"bg-orange-50 dark:bg-orange-900/10 border border-orange-200 dark:border-orange-800 rounded-2xl p-6",children:[a.jsxs("h3",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2 mb-4",children:[a.jsx(qn,{className:"w-5 h-5"})," ",t("sharing.incomingInvites")," (",n.length,")"]}),a.jsx("div",{className:"space-y-3",children:n.map(L=>a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border border-orange-100 dark:border-orange-900/50 flex items-center justify-between shadow-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t("sharing.inviteMessage",{email:L.fromEmail,group:L.groupName})}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[t("sharing.columnPermission"),": ",ce(L.permission)]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>J(L,"accepted"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium",children:t("sharing.accept")}),a.jsx("button",{onClick:()=>J(L,"rejected"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium",children:t("sharing.reject")})]})]},L.id))})]}),ke.length>0&&a.jsxs("section",{className:"bg-blue-50 dark:bg-blue-900/10 border border-blue-200 dark:border-blue-800 rounded-2xl p-6",children:[a.jsxs("h3",{className:"font-bold text-blue-800 dark:text-blue-200 flex items-center gap-2 mb-4",children:[a.jsx(Li,{className:"w-5 h-5"})," ",t("sharing.permissionChange")," (",ke.length,")"]}),a.jsx("div",{className:"space-y-3",children:ke.map(L=>a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border border-blue-100 dark:border-blue-900/50 flex items-center justify-between shadow-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t("sharing.permissionChangeMessage",{email:L.fromEmail,group:L.groupName})}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[ce(L.previousPermission)," â†’ ",a.jsx("span",{className:"font-semibold text-blue-600",children:ce(L.newPermission)})]})]}),a.jsx("button",{onClick:()=>me(L.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:t("sharing.check")})]},L.id))})]}),c&&a.jsxs("section",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg",children:[a.jsx("h3",{className:"font-bold text-lg mb-4",children:t("sharing.createNewGroup")}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("input",{type:"text",placeholder:t("sharing.groupNamePlaceholder"),value:u,onChange:L=>h(L.target.value),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary-500"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("sharing.inviteMember")}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"email",placeholder:t("sharing.searchEmailPlaceholder"),value:v,onChange:L=>k(L.target.value),onKeyDown:L=>L.key==="Enter"&&ue(),className:"flex-1 px-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg"}),a.jsx("button",{onClick:ue,disabled:D,className:"px-4 py-2 bg-gray-600 text-white rounded-lg",children:t("sharing.search")})]}),b&&a.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[a.jsx("span",{className:"font-medium",children:b.displayName||b.email}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{value:y,onChange:L=>w(L.target.value),className:"px-2 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:[a.jsx("option",{value:"view",children:t("sharing.roleView")}),a.jsx("option",{value:"edit",children:t("sharing.roleEdit")}),a.jsx("option",{value:"admin",children:t("sharing.roleAdmin")})]}),a.jsx("button",{onClick:Y,className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded-lg",children:t("sharing.add")})]})]}),g.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map((L,G)=>a.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm",children:[L.email," (",ce(L.permission),")",a.jsx("button",{onClick:()=>m(O=>O.filter(se=>se.uid!==L.uid)),children:a.jsx(rt,{className:"w-3 h-3"})})]},G))})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{onClick:ie,disabled:z,className:"flex-1 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-medium",children:t("sharing.createGroupSendInvite")}),a.jsx("button",{onClick:()=>d(!1),className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200",children:t("sharing.cancel")})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[r.map(L=>{const G=le(L.id);return a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-sm overflow-hidden",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between bg-gray-50/50 dark:bg-gray-800/50",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[L.name,L.isReference&&a.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:t("sharing.referenceGroup")})]}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t("sharing.owner"),": ",L.originalOwnerEmail||e?.email]})]}),a.jsx("div",{className:"flex gap-2",children:L.isReference?a.jsxs("button",{onClick:()=>H(L.id),className:"flex items-center gap-1 px-3 py-1.5 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg text-sm transition",children:[a.jsx(tm,{className:"w-4 h-4"})," ",t("sharing.leave")]}):a.jsxs("button",{onClick:()=>I(L.id),className:"flex items-center gap-1 px-3 py-1.5 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg text-sm transition",children:[a.jsx($t,{className:"w-4 h-4"})," ",t("sharing.deleteGroup")]})})]}),a.jsx("div",{className:"p-4",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left text-gray-500 border-b border-gray-100 dark:border-gray-700",children:[a.jsx("th",{className:"pb-3 pl-2 font-medium",children:t("sharing.columnMember")}),a.jsx("th",{className:"pb-3 font-medium",children:t("sharing.columnPermission")}),a.jsx("th",{className:"pb-3 text-right pr-2",children:t("sharing.columnManage")})]})}),a.jsxs("tbody",{className:"divide-y divide-gray-50 dark:divide-gray-700/50",children:[L.members.map(O=>a.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[a.jsx("td",{className:"py-3 pl-2",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-100 to-purple-100 dark:from-primary-900 dark:to-purple-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold",children:O.email[0].toUpperCase()}),a.jsxs("div",{children:[a.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[O.displayName||O.email.split("@")[0],O.uid===e?.uid&&a.jsx("span",{className:"ml-2 text-xs text-primary-600",children:t("sharing.me")})]}),a.jsx("div",{className:"text-gray-400 text-xs",children:O.email})]})]})}),a.jsx("td",{className:"py-3",children:!L.isReference&&O.uid!==e?.uid?a.jsxs("div",{className:"relative inline-block",children:[a.jsxs("select",{value:ee(L.id,O.uid)||O.permission,onChange:se=>be(L.id,O.uid,se.target.value),className:`appearance-none pl-3 pr-8 py-1 border-none rounded-lg text-xs font-medium cursor-pointer focus:ring-2 focus:ring-primary-500 ${ee(L.id,O.uid)?"bg-yellow-100 dark:bg-yellow-900/50 ring-2 ring-yellow-400":"bg-gray-100 dark:bg-gray-700"}`,children:[a.jsx("option",{value:"view",children:t("sharing.roleView")}),a.jsx("option",{value:"edit",children:t("sharing.roleEdit")}),a.jsx("option",{value:"admin",children:t("sharing.roleAdmin")})]}),a.jsx(fa,{className:"w-3 h-3 absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"})]}):a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${O.permission==="admin"?"bg-purple-100 text-purple-700":O.permission==="edit"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:ce(O.permission)})}),a.jsx("td",{className:"py-3 text-right pr-2",children:!L.isReference&&O.uid!==e?.uid&&a.jsx("button",{onClick:()=>Q(L.id,O.uid),className:"text-gray-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded-lg transition",title:t("sharing.removeMember"),children:a.jsx(px,{className:"w-4 h-4"})})})]},O.uid)),G.map(O=>a.jsxs("tr",{className:"bg-yellow-50/50 dark:bg-yellow-900/10",children:[a.jsx("td",{className:"py-3 pl-2",children:a.jsxs("div",{className:"flex items-center gap-3 opacity-70",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/50 flex items-center justify-center text-yellow-700",children:a.jsx(gr,{className:"w-4 h-4"})}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-300",children:O.toEmail}),a.jsx("div",{className:"text-yellow-600 text-xs",children:t("sharing.waitingAccept")})]})]})}),a.jsx("td",{className:"py-3",children:a.jsxs("span",{className:"text-xs text-gray-400",children:[t("sharing.invited")," (",ce(O.permission),")"]})}),a.jsx("td",{className:"py-3 text-right pr-2",children:a.jsx("span",{className:"text-xs text-gray-400",children:"-"})})]},O.id))]})]})}),!L.isReference&&a.jsx("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/30",children:x===L.id?a.jsxs("div",{className:"flex gap-2 animate-fade-in items-center",children:[a.jsx("input",{type:"email",placeholder:t("sharing.inviteMemberPlaceholder"),value:v,onChange:O=>k(O.target.value),onKeyDown:O=>O.key==="Enter"&&ue(),className:"flex-1 px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg"}),a.jsx("button",{onClick:ue,className:"px-3 py-2 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700",children:t("sharing.search")}),b&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{value:y,onChange:O=>w(O.target.value),className:"px-2 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:[a.jsx("option",{value:"view",children:t("sharing.roleView")}),a.jsx("option",{value:"edit",children:t("sharing.roleEdit")}),a.jsx("option",{value:"admin",children:t("sharing.roleAdmin")})]}),a.jsx("button",{onClick:()=>de(L),className:"px-3 py-2 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700 animate-pulse",children:t("sharing.sendInvite")})]}),a.jsx("button",{onClick:()=>{f(null),k(""),j(null)},className:"p-2 text-gray-500 hover:text-gray-700",children:a.jsx(rt,{className:"w-5 h-5"})})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("button",{onClick:()=>f(L.id),className:"flex items-center gap-2 text-sm text-gray-500 hover:text-primary-600 font-medium transition px-2 py-1 rounded-lg hover:bg-primary-50",children:[a.jsx(rm,{className:"w-4 h-4"})," ",t("sharing.inviteMember")]}),E(L.id)&&a.jsxs("button",{onClick:()=>fe(L.id),disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition font-medium disabled:opacity-50",children:[z?a.jsx(qs,{className:"w-4 h-4 animate-spin"}):a.jsx(ei,{className:"w-4 h-4"}),t("sharing.savePermissionChanges")]})]})})]},L.id)}),r.length===0&&!c&&a.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700",children:[a.jsx(tr,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 font-medium",children:t("sharing.noGroups")}),a.jsx("p",{className:"text-gray-400 text-sm mt-1",children:t("sharing.noGroupsDesc")})]})]})]})},KA=({searchTerm:t,onSearchChange:e,priorityFilter:r,onPriorityFilterChange:s,typeFilter:n,onTypeFilterChange:i,projectFilter:o,onProjectFilterChange:l,tagFilter:c,onTagFilterChange:d,completionDateFilter:u,onCompletionDateFilterChange:h,onClearFilters:g,searchInputRef:m,availableTags:x})=>{const{t:f}=Xe(),[y,w]=p.useState(!1),v=r!=="all"||n!=="all"||o!=="all"||t.length>0||c.length>0||u!=="all",k=b=>{c.includes(b)?d(c.filter(j=>j!==b)):d([...c,b])};return a.jsxs("div",{className:"mb-6 relative z-30",children:[a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("div",{className:"relative flex-1 group",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(tl,{className:"h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"})}),a.jsx("input",{ref:m,type:"text",value:t,onChange:b=>e(b.target.value),className:"block w-full pl-10 pr-3 py-2.5 bg-white/50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 backdrop-blur-sm transition-all duration-200 text-sm placeholder-gray-400 dark:text-white shadow-sm hover:bg-white/80 dark:hover:bg-gray-800/80",placeholder:f("search.placeholder")})]}),a.jsxs("button",{onClick:()=>w(!y),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border transition-all duration-200 ${v||y?"bg-blue-500 text-white border-blue-600 shadow-md shadow-blue-500/20":"bg-white/50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 backdrop-blur-sm shadow-sm"}`,children:[a.jsx(sm,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:f("search.filter")}),v&&a.jsx("span",{className:"bg-white/20 text-white text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:f("search.on")})]}),v&&a.jsx("button",{onClick:g,className:"flex items-center justify-center w-10 h-10 rounded-xl bg-gray-100 text-gray-500 hover:bg-red-50 hover:text-red-500 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-red-900/30 dark:hover:text-red-400 transition-colors border border-transparent hover:border-red-200 dark:hover:border-red-800",title:f("search.clear"),children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:`
        absolute top-full left-0 right-0 mt-2 p-5 
        glass-panel shadow-xl transform origin-top transition-all duration-300 ease-out
        ${y?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 -translate-y-2 pointer-events-none"}
      `,children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:f("search.priority")}),a.jsxs("select",{value:r,onChange:b=>s(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsxs("option",{value:"urgent",children:["ğŸš¨ ",f("modal.addTodo.urgent")]}),a.jsxs("option",{value:"high",children:["ğŸ”´ ",f("modal.addTodo.high")]}),a.jsxs("option",{value:"medium",children:["ğŸŸ¡ ",f("modal.addTodo.medium")]}),a.jsxs("option",{value:"low",children:["ğŸŸ¢ ",f("modal.addTodo.low")]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:f("search.type")}),a.jsxs("select",{value:n,onChange:b=>i(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsxs("option",{value:"simple",children:["ğŸ“ ",f("modal.addTodo.simpleTask")]}),a.jsxs("option",{value:"project",children:["ğŸš€ ",f("modal.addTodo.project")]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:f("search.projectCategory")}),a.jsxs("select",{value:o,onChange:b=>l(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:n!=="project"&&n!=="all",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsxs("option",{value:"longterm",children:["ğŸ“… ",f("modal.addTodo.longTermProject")||f("projectTemplate.longterm")," ",f("modal.addTodo.project")]}),a.jsxs("option",{value:"shortterm",children:["âš¡ ",f("modal.addTodo.shortTermProject")||f("projectTemplate.shortterm")," ",f("modal.addTodo.project")]})]})]}),a.jsxs("div",{className:"space-y-2 sm:col-span-2 lg:col-span-1",children:[a.jsxs("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[a.jsx(rl,{className:"w-3 h-3"}),f("search.tags")]}),a.jsx("div",{className:"p-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg max-h-32 overflow-y-auto custom-scrollbar",children:x.length>0?a.jsx("div",{className:"space-y-1",children:x.map(b=>a.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer transition-colors",children:[a.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center transition-colors ${c.includes(b)?"bg-blue-500 border-blue-500 text-white":"border-gray-300 dark:border-gray-600"}`,children:c.includes(b)&&a.jsx(Yt,{className:"w-3 h-3"})}),a.jsx("input",{type:"checkbox",checked:c.includes(b),onChange:()=>k(b),className:"hidden"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:b})]},b))}):a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center py-2",children:f("search.noTags")})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[a.jsx(at,{className:"w-3 h-3"}),f("search.completionDate")]}),a.jsxs("select",{value:u,onChange:b=>h(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsx("option",{value:"today",children:f("search.todayCompleted")}),a.jsx("option",{value:"yesterday",children:f("search.yesterdayCompleted")}),a.jsx("option",{value:"thisWeek",children:f("search.thisWeekCompleted")}),a.jsx("option",{value:"lastWeek",children:f("search.lastWeekCompleted")}),a.jsx("option",{value:"thisMonth",children:f("search.thisMonthCompleted")})]})]})]}),v&&a.jsx("div",{className:"mt-5 pt-4 border-t border-gray-200/50 dark:border-gray-700/50",children:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.length>0&&a.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs font-medium border border-blue-200 dark:border-blue-800",children:[a.jsx(rl,{className:"w-3 h-3"}),c.length,f("search.countTags")]}),u!=="all"&&a.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full text-xs font-medium border border-green-200 dark:border-green-800",children:[a.jsx(at,{className:"w-3 h-3"}),u==="today"&&f("search.todayCompleted"),u==="yesterday"&&f("search.yesterdayCompleted"),u==="thisWeek"&&f("search.thisWeekCompleted"),u==="lastWeek"&&f("search.lastWeekCompleted"),u==="thisMonth"&&f("search.thisMonthCompleted")]})]})})]})]})},Fg=({filterState:t,onChange:e,className:r="",isMobile:s=!1})=>{const{t:n}=Xe(),{currentUser:i}=bt(),{todos:o}=ot(),[l,c]=p.useState([]),[d,u]=p.useState(!1);p.useEffect(()=>{if(!i?.uid)return;const y=te.subscribeSharingGroups(i.uid,w=>c(w));return()=>y()},[i?.uid]);const h=p.useMemo(()=>{if(!i)return{personal:0,myShared:0,groupShared:0};let y=0,w=0,v=0;return o.forEach(k=>{if(t.selectedGroupId&&k.sharedGroupId!==t.selectedGroupId&&k.sharedGroupOwnerId!==t.selectedGroupId&&k.sharedGroupId!==t.selectedGroupId)return;const b=k.visibility?.isPersonal!==!1,j=k.visibility?.isShared===!0,D=j&&k.ownerId===i.uid,N=j&&k.ownerId!==i.uid;b&&!j&&y++,D&&w++,N&&v++}),{personal:y,myShared:w,groupShared:v}},[o,i,t.selectedGroupId]),g=y=>{e({...t,[y]:!t[y]})},m=y=>{e({...t,selectedGroupId:y}),u(!1)},x=()=>t.selectedGroupId?l.find(w=>w.id===t.selectedGroupId||w.originalGroupId===t.selectedGroupId)?.name||n("sharing.allGroups")||"ì „ì²´":n("sharing.allGroups")||"ì „ì²´",f=y=>y?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-700 ring-1 ring-blue-500/20":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700";return s?a.jsxs("div",{className:`flex flex-col gap-5 ${r}`,children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 px-1",children:[a.jsx(uo,{className:"w-3.5 h-3.5 text-blue-500"}),a.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:n("sharing.filter")||"í•„í„°"})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsxs("button",{onClick:()=>g("showPersonal"),className:`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${f(t.showPersonal)}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${t.showPersonal?"bg-blue-100 dark:bg-blue-900/50 text-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:a.jsx(Yn,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium",children:n("sharing.personal")||"ë‚´ í• ì¼"})]}),a.jsx("span",{className:`px-2.5 py-0.5 rounded-md text-xs font-bold ${t.showPersonal?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.personal})]}),a.jsxs("button",{onClick:()=>g("showMyShared"),className:`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${f(t.showMyShared)}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${t.showMyShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:a.jsx(uo,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium",children:n("sharing.myShared")||"ë‚´ê°€ ê³µìœ "})]}),a.jsx("span",{className:`px-2.5 py-0.5 rounded-md text-xs font-bold ${t.showMyShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.myShared})]}),a.jsxs("button",{onClick:()=>g("showGroupShared"),className:`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${f(t.showGroupShared)}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${t.showGroupShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:a.jsx(tr,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium",children:n("sharing.groupShared")||"ê·¸ë£¹ ê³µìœ "})]}),a.jsx("span",{className:`px-2.5 py-0.5 rounded-md text-xs font-bold ${t.showGroupShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.groupShared})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 px-1",children:[a.jsx(tr,{className:"w-3.5 h-3.5 text-blue-500"}),a.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:n("sharing.group")||"ê·¸ë£¹ ì„ íƒ"})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-2 border border-gray-200 dark:border-gray-700 max-h-56 overflow-y-auto",children:[a.jsxs("button",{onClick:()=>m(null),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all mb-1 ${t.selectedGroupId?"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50":"bg-white dark:bg-gray-700 shadow-sm ring-1 ring-blue-500/20 text-blue-600 dark:text-blue-300 font-medium"}`,children:[a.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${t.selectedGroupId?"bg-gray-300 dark:bg-gray-600":"bg-blue-500"}`}),n("sharing.allGroups")||"ì „ì²´"]}),l.map(y=>{const w=y.isReference?y.originalGroupId:y.id,v=t.selectedGroupId===w;return a.jsxs("button",{onClick:()=>m(w||null),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all mb-1 ${v?"bg-white dark:bg-gray-700 shadow-sm ring-1 ring-blue-500/20 text-blue-600 dark:text-blue-300 font-medium":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50"}`,children:[a.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${v?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`}),a.jsx("span",{className:"flex-1 text-left truncate",children:y.name}),a.jsxs("span",{className:"text-xs px-2 py-0.5 bg-gray-100 dark:bg-gray-600 rounded-full text-gray-500 dark:text-gray-300",children:[y.members?.length||0,"ëª…"]})]},y.id)}),l.length===0&&a.jsx("div",{className:"p-4 text-center text-xs text-gray-400 italic",children:n("sharing.noGroupsShort")||"ê·¸ë£¹ ì—†ìŒ"})]})]})]}):a.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${r}`,children:[a.jsxs("button",{type:"button",onClick:()=>g("showPersonal"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${f(t.showPersonal)}`,title:n("sharing.filterPersonal")||"ê°œì¸ í• ì¼",children:[a.jsx(Yn,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:n("sharing.personal")||"ë‚´ í• ì¼"}),a.jsx("span",{className:`ml-0.5 px-1.5 py-0.5 rounded-full text-[10px] ${t.showPersonal?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.personal})]}),a.jsxs("button",{type:"button",onClick:()=>g("showMyShared"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${f(t.showMyShared)}`,title:n("sharing.filterMyShared")||"ë‚´ê°€ ê³µìœ í•œ í• ì¼",children:[a.jsx(uo,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:n("sharing.myShared")||"ë‚´ê°€ ê³µìœ "}),a.jsx("span",{className:`ml-0.5 px-1.5 py-0.5 rounded-full text-[10px] ${t.showMyShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.myShared})]}),a.jsxs("button",{type:"button",onClick:()=>g("showGroupShared"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${f(t.showGroupShared)}`,title:n("sharing.filterGroupShared")||"ê·¸ë£¹ì´ ê³µìœ í•œ í• ì¼",children:[a.jsx(tr,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:n("sharing.groupShared")||"ê·¸ë£¹ ê³µìœ "}),a.jsx("span",{className:`ml-0.5 px-1.5 py-0.5 rounded-full text-[10px] ${t.showGroupShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.groupShared})]}),a.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-gray-700 mx-1"}),a.jsxs("div",{className:"relative",children:[a.jsxs("button",{type:"button",onClick:()=>u(!d),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[a.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[n("sharing.group")||"ê·¸ë£¹",":"]}),a.jsx("span",{className:"text-gray-900 dark:text-white max-w-[100px] truncate",children:x()}),a.jsx(fa,{className:`w-3.5 h-3.5 text-gray-400 transition-transform ${d?"rotate-180":""}`})]}),d&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),a.jsxs("div",{className:"absolute top-full right-0 mt-1 min-w-[200px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50 py-1 max-h-60 overflow-y-auto",children:[a.jsx("button",{type:"button",onClick:()=>m(null),className:`w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${t.selectedGroupId?"text-gray-700 dark:text-gray-300":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300"}`,children:n("sharing.allGroups")||"ì „ì²´"}),l.length>0&&a.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700 my-1"}),l.map(y=>{const w=y.isReference?y.originalGroupId:y.id,v=t.selectedGroupId===w;return a.jsxs("button",{type:"button",onClick:()=>m(w||null),className:`w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center gap-2 ${v?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300":"text-gray-700 dark:text-gray-300"}`,children:[a.jsx(tr,{className:"w-3.5 h-3.5 flex-shrink-0 text-gray-400"}),a.jsx("span",{className:"truncate flex-1",children:y.name}),a.jsxs("span",{className:"text-xs text-gray-400",children:["(",y.members?.length||0,")"]})]},y.id)}),l.length===0&&a.jsx("div",{className:"px-4 py-3 text-xs text-gray-500 dark:text-gray-400 text-center",children:n("sharing.noGroupsShort")||"ê³µìœ  ê·¸ë£¹ ì—†ìŒ"})]})]})]})]})},YA=()=>{const{t}=Xe(),{currentUser:e}=bt(),[r,s]=p.useState([]),[n,i]=p.useState([]),[o,l]=p.useState(!1),[c,d]=p.useState(!1),[u,h]=p.useState(null),g=p.useRef(null);p.useEffect(()=>{const x=f=>{g.current&&!g.current.contains(f.target)&&l(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]),p.useEffect(()=>{if(!e?.email)return;const x=te.subscribeToIncomingInvitations(e.email,f=>{s(f)});return()=>x()},[e?.email]),p.useEffect(()=>{if(!e?.uid)return;const x=te.subscribeToSharingNotifications(e.uid,f=>{i(f)});return()=>x()},[e?.uid]),p.useEffect(()=>{const x=r.length>0,f=n.some(y=>!y.read);d(x||f)},[r,n]);const m=async(x,f)=>{if(e){h(x.id);try{const y={uid:e.uid,email:e.email,displayName:e.displayName||void 0,photoURL:e.photoURL,permission:x.permission||"read"};await te.respondToInvitation(x.id,f,y),s(w=>w.filter(v=>v.id!==x.id))}catch(y){console.error("Action failed:",y),alert(t("common.error")||"Action failed")}finally{h(null)}}};return a.jsxs("div",{className:"relative z-50",children:[a.jsxs("button",{onClick:()=>l(!o),className:"relative p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:t("nav.notifications")||"Notifications",children:[a.jsx(qn,{className:`w-6 h-6 ${c?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"}`}),c&&a.jsx("span",{className:"absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-900"})]}),o&&a.jsxs("div",{ref:g,className:"absolute right-0 top-full mt-2 w-80 sm:w-96 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[a.jsxs("div",{className:"p-3 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[a.jsx("h3",{className:"font-semibold text-sm text-gray-900 dark:text-white",children:t("nav.notifications")||"Notifications"}),r.length>0&&a.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full dark:bg-blue-900/30 dark:text-blue-300",children:r.length})]}),a.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:r.length===0&&n.length===0?a.jsxs("div",{className:"p-8 text-center text-gray-400 text-sm",children:[a.jsx(qn,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:t("notifications.empty")||"No new notifications"})]}):a.jsxs("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[n.map(x=>a.jsx("div",{className:`p-4 transition-colors cursor-pointer ${x.read?"bg-white dark:bg-gray-800 opacity-70":"bg-orange-50 dark:bg-orange-900/20"}`,onClick:async()=>{x.read||await te.markNotificationAsRead(x.id)},children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${x.read?"bg-gray-100 dark:bg-gray-700 text-gray-500":"bg-orange-100 dark:bg-orange-900/50 text-orange-600 dark:text-orange-300"}`,children:a.jsx(Li,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ê¶Œí•œ ë³€ê²½"}),!x.read&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-1.5 py-0.5 rounded-full font-bold",children:"!"})]}),a.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-0.5",children:[a.jsxs("span",{className:"font-medium text-primary-600",children:["'",x.groupName,"'"]})," ê·¸ë£¹ì—ì„œ"]}),a.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-200 mt-1 font-medium",children:[x.previousPermission==="admin"?"ê´€ë¦¬ì":x.previousPermission==="edit"?"í¸ì§‘ì":"ë·°ì–´",a.jsx("span",{className:"mx-1.5",children:"â†’"}),a.jsx("span",{className:`${x.newPermission==="admin"?"text-purple-600":x.newPermission==="edit"?"text-blue-600":"text-gray-600"}`,children:x.newPermission==="admin"?"ê´€ë¦¬ì":x.newPermission==="edit"?"í¸ì§‘ì":"ë·°ì–´"}),a.jsx("span",{className:"text-gray-400 ml-1",children:"ë¡œ ë³€ê²½ë¨"})]}),a.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[x.fromEmail,"ë‹˜ì´ ë³€ê²½ â€¢ ",x.createdAt instanceof Date?x.createdAt.toLocaleString("ko-KR"):"ë°©ê¸ˆ"]})]})]})},x.id)),r.map(x=>a.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-blue-600 dark:text-blue-300 shrink-0",children:a.jsx(rm,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t("notifications.inviteTitle")||"Invitation to share"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 break-all",children:[a.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:x.fromEmail})," invited you to ",a.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:['"',x.shareName||x.todoTitle,'"']})]}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:x.createdAt instanceof Date?x.createdAt.toLocaleDateString():"Just now"}),a.jsxs("div",{className:"flex gap-2 mt-3",children:[a.jsxs("button",{onClick:()=>m(x,"accepted"),disabled:!!u,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white rounded-lg text-xs font-semibold hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[u===x.id?a.jsx(qs,{className:"w-3 h-3 animate-spin"}):a.jsx(Yt,{className:"w-3.5 h-3.5"}),t("common.accept")||"Accept"]}),a.jsxs("button",{onClick:()=>m(x,"rejected"),disabled:!!u,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-white border border-gray-200 text-gray-700 rounded-lg text-xs font-semibold hover:bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 transition-colors",children:[a.jsx(rt,{className:"w-3.5 h-3.5"}),t("common.decline")||"Decline"]})]})]})]})},x.id))]})})]})]})},Hs=Ar("App",{web:()=>Je(()=>import("./web-Boy594eP.js"),__vite__mapDeps([6,2,3,1,4]),import.meta.url).then(t=>new t.AppWeb)}),qA=Object.freeze(Object.defineProperty({__proto__:null,App:Hs},Symbol.toStringTag,{value:"Module"})),XA=({children:t})=>{const[e,r]=p.useState(0),[s,n]=p.useState(0),[i,o]=p.useState(!1),l=p.useRef(null),{forceRefresh:c}=ot(),{loading:d}=cn(),u=80,h=x=>{const f=x.target.closest(".overflow-y-auto"),y=f?f.scrollTop===0:window.scrollY===0;r(y?x.touches[0].clientY:0)},g=x=>{if(e===0||i)return;const y=x.touches[0].clientY-e;y>0&&n(Math.min(y*.5,u+20))},m=async()=>{if(!(e===0||i)){if(s>=u){o(!0),n(u);try{console.log("ğŸ”„ Pull-to-Refresh triggered"),await c(),await new Promise(x=>setTimeout(x,500))}catch(x){console.error("Refresh failed:",x)}finally{o(!1),n(0)}}else n(0);r(0)}};return a.jsxs("div",{className:"relative min-h-screen",onTouchStart:h,onTouchMove:g,onTouchEnd:m,ref:l,children:[a.jsx("div",{className:"absolute top-0 left-0 w-full flex justify-center pointer-events-none transition-transform duration-200 ease-out z-50",style:{transform:`translateY(${s>0?s-40:-40}px)`,opacity:s>0?Math.min(s/u,1):0},children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md border border-gray-200 dark:border-gray-700",children:a.jsx(qs,{className:`w-6 h-6 text-blue-500 ${i?"animate-spin":""}`})})}),a.jsx("div",{style:{transform:`translateY(${s}px)`,transition:"transform 0.2s ease-out"},children:t})]})},QA=({currentView:t,isSidebarOpen:e,onToggleSidebar:r,searchInputRef:s,isMobile:n})=>{const{t:i,i18n:o}=Xe(),l=o.language==="ko"?dn:sn,{currentUser:c}=bt(),{allTags:d}=ot(),{currentTheme:u,isDark:h}=Et(),g=!!u.bg,[m,x]=p.useState(!1),[f,y]=p.useState(null),[w,v]=p.useState(new Date),[k,b]=p.useState(void 0),[j,D]=p.useState(""),[N,T]=p.useState("all"),[_,P]=p.useState("all"),[C,A]=p.useState("all"),[B,z]=p.useState([]),[W,X]=p.useState("all"),[V,ce]=p.useState(()=>{const E=localStorage.getItem("sharingFilterState");if(E)try{return JSON.parse(E)}catch(ee){console.error("Failed to parse sharingFilterState",ee)}return{showPersonal:!0,showMyShared:!0,showGroupShared:!0,selectedGroupId:null}});p.useEffect(()=>{localStorage.setItem("sharingFilterState",JSON.stringify(V))},[V]);const[ke,Se]=p.useState(!1),me=V.showPersonal&&V.showMyShared&&V.showGroupShared?V.selectedGroupId||"all":V.showPersonal&&!V.showMyShared&&!V.showGroupShared?"private":!V.showPersonal&&V.showMyShared&&!V.showGroupShared?"my_shared":!V.showPersonal&&!V.showMyShared&&V.showGroupShared?"shared":"all";p.useEffect(()=>{t==="board"&&X("today")},[t]),p.useEffect(()=>{const E=()=>{console.log("Received openAddTodoModal event"),b(void 0),x(!0)};return window.addEventListener("openAddTodoModal",E),()=>{window.removeEventListener("openAddTodoModal",E)}},[]),p.useEffect(()=>{if(!c?.uid)return;const E=te.subscribeToSentInvitations(c.uid,async ee=>{const Q=ee.filter(H=>H.status==="accepted");for(const H of Q){console.log("ğŸ”” ìˆ˜ë½ëœ ì´ˆëŒ€ ê°ì§€:",H.toEmail);try{await te.processAcceptedInvitation(H)}catch(I){console.error("ì´ˆëŒ€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",I)}}});return()=>E()},[c?.uid]);const ue=E=>{v(E)},Y=()=>{v(t==="week"?E=>An(E):t==="month"?E=>si(E):E=>In(E))},ie=()=>{v(t==="week"?E=>ym(E,1):t==="month"?E=>xm(E,1):E=>xs(E,1))},de=()=>{v(new Date)},be=()=>{D(""),T("all"),P("all"),A("all"),z([]),X("all"),ce({showPersonal:!0,showMyShared:!0,showGroupShared:!0,selectedGroupId:null})},fe=E=>{y(E)};return p.useEffect(()=>{let E=0;const ee=async()=>{const H=Date.now();if(m){x(!1),b(void 0);return}if(f){y(null);return}if(n&&e){r();return}H-E<2e3?Hs.exitApp():(E=H,window.confirm(i("common.confirmExit")||"ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&Hs.exitApp())};return(async()=>{try{await Hs.addListener("backButton",ee)}catch(H){console.warn("Back button listener setup failed:",H)}})(),()=>{Hs.removeAllListeners()}},[m,f,e,n,r,i]),a.jsxs("main",{className:`flex-1 min-w-0 transition-all duration-300 ease-in-out ${e?"lg:ml-64":"lg:ml-20"}`,children:[a.jsx("header",{className:`border-b border-white/20 dark:border-white/10 sticky top-0 z-20 pt-[env(safe-area-inset-top)] 
          ${g?"shadow-none border-white/30 dark:border-white/20 backdrop-blur-none transition-[background-color] duration-200":"bg-white/70 dark:bg-gray-900/70 backdrop-blur-md"}`,style:g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:a.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg lg:hidden",children:a.jsx(yx,{className:"w-6 h-6 text-gray-600"})}),a.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[t==="today"&&i("nav.today"),t==="week"&&i("nav.week"),t==="month"&&i("nav.month"),t==="board"&&(i("nav.board")||"Kanban Board"),t==="settings"&&i("nav.settings"),t==="analytics"&&i("nav.analytics"),t==="recurring"&&i("nav.recurring"),t==="history"&&i("nav.history"),t==="vacation"&&i("nav.vacation"),t==="guide"&&i("guide.title")]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"hidden lg:block",children:a.jsx(Fg,{filterState:V,onChange:ce})}),a.jsxs("button",{onClick:()=>Se(!0),className:"lg:hidden p-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded-lg relative",children:[a.jsx(tr,{className:"w-6 h-6"}),(!V.showPersonal||!V.showMyShared||!V.showGroupShared||V.selectedGroupId)&&a.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-blue-500 rounded-full"})]}),a.jsx(YA,{}),a.jsxs("button",{onClick:()=>{b(void 0),x(!0)},className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors shadow-sm hover:shadow-md",children:[a.jsx(ct,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:i("common.addTodo")})]}),a.jsx("div",{className:"h-8 w-px bg-gray-200 hidden sm:block"}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"text-right hidden sm:block",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:c?.displayName||"User"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c?.email||"user@example.com"})]}),a.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden border border-primary-200",children:c?.photoURL?a.jsx("img",{src:c.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):a.jsx(Yn,{className:"w-6 h-6 text-primary-600"})})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"w-full",children:a.jsx(KA,{searchTerm:j,onSearchChange:D,priorityFilter:N,onPriorityFilterChange:T,typeFilter:_,onTypeFilterChange:P,projectFilter:C,onProjectFilterChange:A,tagFilter:B,onTagFilterChange:z,completionDateFilter:W,onCompletionDateFilterChange:X,onClearFilters:be,availableTags:d,searchInputRef:s})}),(t==="today"||t==="week"||t==="month"||t==="board")&&a.jsxs("div",{className:"flex items-center justify-center gap-4 glass-panel p-2",children:[a.jsx("button",{onClick:Y,className:"p-1 hover:bg-gray-200 rounded-full",children:a.jsx(ec,{className:"w-5 h-5 text-gray-600"})}),a.jsxs("div",{onClick:()=>{const E=document.getElementById("date-picker-input");if(E&&"showPicker"in HTMLInputElement.prototype)try{E.showPicker()}catch{E.focus()}else E&&(E.focus(),E.click())},className:"relative flex items-center gap-2 px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors cursor-pointer group",children:[a.jsx("input",{id:"date-picker-input",type:"date",value:qe(w,"yyyy-MM-dd"),onChange:E=>{E.target.value&&ue(new Date(E.target.value))},className:"sr-only","aria-label":"Select date"}),a.jsx(at,{className:"w-5 h-5 text-primary-600 group-hover:text-primary-700 dark:text-primary-400 dark:group-hover:text-primary-300 transition-colors"}),a.jsx("span",{className:"text-lg font-medium text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors",children:t==="week"?`${qe(as(w,{weekStartsOn:0}),o.language==="ko"?"Mì›” dì¼":"MMM d",{locale:l})} - ${qe(is(w,{weekStartsOn:0}),o.language==="ko"?"Mì›” dì¼":"MMM d",{locale:l})}`:t==="month"?qe(w,o.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:l}):qe(w,o.language==="ko"?"yyyyë…„ Mì›” dì¼ (EEE)":"MMM d yyyy (EEE)",{locale:l})})]}),a.jsx("button",{onClick:ie,className:"p-1 hover:bg-gray-200 rounded-full",children:a.jsx(gs,{className:"w-5 h-5 text-gray-600"})}),a.jsx("button",{onClick:de,className:"px-3 py-1 text-sm font-medium text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-md border border-primary-200 dark:border-primary-500/30 ml-2",children:i("common.today")})]})]})]})}),a.jsx(XA,{children:a.jsx("div",{className:"p-4 sm:p-6 lg:p-8 max-w-[1920px] mx-auto min-h-[calc(100vh-80px)]",children:t==="today"?a.jsx(Sl,{currentView:"today",searchTerm:j,priorityFilter:N,typeFilter:_,projectFilter:C,tagFilter:B,completionDateFilter:W,sharingFilter:me,sharingFilterState:V,selectedDate:w,onDateChange:ue,onEdit:fe}):t==="week"?a.jsx(a_,{currentDate:w,onDateChange:ue,searchTerm:j,priorityFilter:N,typeFilter:_,projectFilter:C,tagFilter:B,completionDateFilter:W,sharingFilter:me,sharingFilterState:V,onAddTodo:E=>{b(E),x(!0)},isMobile:n}):t==="month"?a.jsxs("div",{className:"space-y-8",children:[a.jsx(i_,{currentDate:w,onDateChange:ue,searchTerm:j,priorityFilter:N,typeFilter:_,projectFilter:C,tagFilter:B,completionDateFilter:W,sharingFilter:me,sharingFilterState:V,onAddTodo:E=>{b(E),x(!0)},isMobile:n}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[a.jsx(Sl,{currentView:"month",onEdit:fe,sharingFilter:me,sharingFilterState:V}),a.jsx("div",{className:"hidden lg:block",children:a.jsx(_h,{})})]})]}):t==="board"?a.jsx(ZD,{searchTerm:j,priorityFilter:N,typeFilter:_,projectFilter:C,tagFilter:B,completionDateFilter:W,onAddTodo:E=>{b(void 0),x(!0)},onEdit:fe,isMobile:n}):t==="analytics"?a.jsxs("div",{className:"w-full space-y-8",children:[a.jsx(eC,{}),a.jsx(_h,{})]}):t==="recurring"?a.jsx(nC,{}):t==="history"?a.jsx(iC,{searchTerm:j,priorityFilter:N,typeFilter:_,projectFilter:C,tagFilter:B}):t==="vacation"?a.jsx("div",{className:"w-full h-[calc(100vh-100px)] rounded-xl overflow-hidden bg-white dark:bg-gray-900 shadow-sm border border-gray-200 dark:border-gray-800",children:a.jsx("iframe",{src:"https://anzpek.github.io/vacation-manager-react/",className:"w-full h-full border-0",title:"Vacation Management System",allow:"clipboard-write"})}):t==="settings"?a.jsx(hC,{}):t==="guide"?a.jsx(GA,{}):t==="sharing"?a.jsx(zA,{}):null})}),a.jsx("div",{className:"md:hidden",children:a.jsx(d0,{onClick:()=>{b(void 0),x(!0)}})}),a.jsx(l0,{isOpen:m,onClose:()=>{x(!1),b(void 0)},initialDate:k}),f&&a.jsx(Kc,{isOpen:!!f,onClose:()=>y(null),todo:f}),ke&&a.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-24 px-4 sm:pt-32",onClick:()=>Se(!1),children:[a.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-opacity"}),a.jsxs("div",{className:"relative w-full max-w-sm bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl rounded-2xl p-5 shadow-2xl border border-white/20 dark:border-white/10 ring-1 ring-black/5 animate-in slide-in-from-top-4 duration-200",onClick:E=>E.stopPropagation(),style:{maxHeight:"calc(100vh - 140px)",overflowY:"auto"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-5 pb-4 border-b border-gray-200/50 dark:border-gray-700/50",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:a.jsx(sm,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),i("sharing.settingsTitle")]}),a.jsx("button",{onClick:()=>Se(!1),className:"p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsx(Fg,{filterState:V,onChange:ce,isMobile:!0}),a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200/50 dark:border-gray-700/50",children:a.jsx("button",{onClick:()=>Se(!1),className:"w-full py-3.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-blue-500/25 transition-all active:scale-[0.98] flex items-center justify-center gap-2",children:a.jsx("span",{children:i("common.confirm")})})})]})]})]})},JA="https://anzpek.github.io/todolist/version.json",ZA=()=>{const[t,e]=p.useState(!1),[r,s]=p.useState("");return p.useEffect(()=>{(async()=>{try{const o=await(await fetch("/version.json")).json();if(s(o.version),!Ke.isNativePlatform()&&window.location.hostname!=="localhost")return;const l=await fetch(JA,{cache:"no-store"});if(!l.ok)return;(await l.json()).build>o.build&&e(!0)}catch(i){console.error("Failed to check for updates:",i)}})()},[]),{isUpdateAvailable:t,currentVersion:r}},Wg="hideUpdateModal_v1.3.1",eR=()=>{const{t}=Xe(),[e,r]=p.useState(!1),[s,n]=p.useState(!1),{isUpdateAvailable:i}=ZA();p.useEffect(()=>{if(i){r(!0);return}localStorage.getItem(Wg)||r(!0)},[i]);const o=()=>{s&&localStorage.setItem(Wg,"true"),r(!1)};return e?a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden border border-gray-100 dark:border-gray-700 animate-in fade-in zoom-in duration-300",children:[a.jsxs("div",{className:"relative p-6 bg-gradient-to-br from-indigo-500 to-purple-600",children:[a.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-1 bg-white/20 hover:bg-white/30 rounded-full text-white transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex items-center gap-3 text-white mb-2",children:[a.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:a.jsx(Zo,{className:"w-6 h-6"})}),a.jsx("h2",{className:"text-xl font-bold",children:t("updateNotification.title")})]}),a.jsx("p",{className:"text-indigo-100 text-sm",children:t("updateNotification.newFeatures")})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"space-y-4 mb-6",children:(()=>{const l=t("updateNotification.changes",{returnObjects:!0});return(Array.isArray(l)?l:[]).map((d,u)=>a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"mt-0.5 p-1 bg-green-100 dark:bg-green-900/30 rounded-full",children:a.jsx(Yt,{className:"w-3 h-3 text-green-600 dark:text-green-400"})}),a.jsx("span",{className:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed",children:d})]},u))})()}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[a.jsx("div",{className:"relative flex items-center",children:a.jsx("input",{type:"checkbox",checked:s,onChange:l=>n(l.target.checked),className:"w-4 h-4 border-2 border-gray-300 dark:border-gray-600 rounded text-indigo-600 focus:ring-indigo-500 dark:bg-gray-700 transition-colors"})}),a.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors",children:t("updateNotification.dontShowAgain")})]}),a.jsx("button",{onClick:o,className:"w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-xl shadow-lg shadow-indigo-200 dark:shadow-none transition-all hover:scale-[1.02] active:scale-[0.98]",children:t("updateNotification.close")})]})]})]})}):null};var Vg;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UPDATE_NOT_AVAILABLE=1]="UPDATE_NOT_AVAILABLE",t[t.UPDATE_AVAILABLE=2]="UPDATE_AVAILABLE",t[t.UPDATE_IN_PROGRESS=3]="UPDATE_IN_PROGRESS"})(Vg||(Vg={}));var Ug;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.PENDING=1]="PENDING",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.INSTALLING=3]="INSTALLING",t[t.INSTALLED=4]="INSTALLED",t[t.FAILED=5]="FAILED",t[t.CANCELED=6]="CANCELED",t[t.DOWNLOADED=11]="DOWNLOADED"})(Ug||(Ug={}));var Bg;(function(t){t[t.OK=0]="OK",t[t.CANCELED=1]="CANCELED",t[t.FAILED=2]="FAILED",t[t.NOT_AVAILABLE=3]="NOT_AVAILABLE",t[t.NOT_ALLOWED=4]="NOT_ALLOWED",t[t.INFO_MISSING=5]="INFO_MISSING"})(Bg||(Bg={}));const Hg=Ar("AppUpdate",{web:()=>Je(()=>import("./web-BXJVtYCe.js"),__vite__mapDeps([7,2,3,1,4]),import.meta.url).then(t=>new t.AppUpdateWeb)});Ar("Browser",{web:()=>Je(()=>import("./web-CGVgj_e2.js"),__vite__mapDeps([8,2,3,1,4]),import.meta.url).then(t=>new t.BrowserWeb)});const tR=p.createContext(null),rR=({children:t})=>{const e=p.useCallback(async()=>{if(Ke.isNativePlatform()){if(Ke.getPlatform()==="android")try{const r=await Hg.getAppUpdateInfo();r.updateAvailability===2?(console.log("ğŸš€ Android In-App Update available. Starting immediate update flow."),await Hg.performImmediateUpdate()):console.log("âœ… Android App is up to date (or update not allowed). Availability:",r.updateAvailability)}catch(r){console.error("âŒ Android In-App Update check failed:",r)}else if(Ke.getPlatform()==="ios")try{console.log("iOS update check is handled by OS automatic updates or manual App Store visit")}catch(r){console.error("âŒ iOS Update check failed:",r)}}},[]);return p.useEffect(()=>{e();const r=Hs.addListener("appStateChange",({isActive:s})=>{s&&e()});return()=>{r.then(s=>s.remove())}},[e]),a.jsx(tR.Provider,{value:{checkForUpdate:e},children:t})},sR=p.lazy(()=>Je(()=>import("./LoginScreen-Bd5aZq7E.js"),__vite__mapDeps([9,3,2,1,4]),import.meta.url)),nR=p.lazy(()=>Je(()=>import("./Sidebar-GsqfFPw_.js"),__vite__mapDeps([10,3,2,1,4]),import.meta.url)),aR=p.lazy(()=>Je(()=>import("./PWAInstallPrompt-Ih9FCJxq.js"),__vite__mapDeps([11,3,2,1,4]),import.meta.url));p.lazy(()=>Je(()=>Promise.resolve().then(()=>gC),void 0,import.meta.url));const iR=p.lazy(()=>Je(()=>import("./ErrorBoundary-CAKimGbI.js"),__vite__mapDeps([12,3,2,1,4]),import.meta.url)),oR=p.lazy(()=>Je(()=>import("./OfflineNotification-Z3BrWp9M.js"),__vite__mapDeps([13,3,2,1,4]),import.meta.url)),lR=p.lazy(()=>Je(()=>import("./BottomNavigation-DR16nMUA.js"),__vite__mapDeps([14,3,2,1,4]),import.meta.url)),Id=()=>a.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50 dark:bg-gray-900",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});function cR({currentView:t,setCurrentView:e,isSidebarOpen:r,setIsSidebarOpen:s,searchInputRef:n,addTodoModalRef:i,isMobile:o,forceMobile:l,setForceMobile:c}){const d=UN("AppInner");return FN(),p.useEffect(()=>d,[o]),a.jsx(p.Suspense,{fallback:a.jsx(Id,{}),children:a.jsxs("div",{className:`h-screen flex bg-transparent ${o?"flex-col":""}`,children:[o&&r&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-40",onClick:()=>s(!1)}),a.jsx(nR,{currentView:t,onViewChange:e,isOpen:r,onToggle:()=>s(!r),isMobile:o,forceMobile:l,onToggleForceMobile:c}),a.jsx("div",{className:`flex-1 flex flex-col min-w-0 overflow-y-auto overflow-x-hidden ${o?"pb-20":""}`,children:a.jsx(QA,{currentView:t,isSidebarOpen:r,onToggleSidebar:()=>s(!r),searchInputRef:n,addTodoModalRef:i,isMobile:o})}),o&&a.jsx(lR,{currentView:t,onViewChange:e,onToggleSidebar:()=>s(!0)}),a.jsx(oR,{}),a.jsx(aR,{}),a.jsx(eR,{})]})})}function dR(){const{currentUser:t,loading:e}=bt(),[r,s]=p.useState("today"),[n,i]=p.useState(!0),[o,l]=p.useState(!1),[c,d]=p.useState(null),u=p.useRef(null),h=p.useRef(null),{i18n:g}=Xe(),{todos:m,getRecurringTodos:x,toggleTodo:f,loadHistoricalTodos:y}=ot(),{vacations:w,employees:v,loadMonthVacations:k}=cn();p.useEffect(()=>{(async()=>{const C=new Date;await k(C.getFullYear(),C.getMonth()+1),await k(C.getFullYear(),C.getMonth()+2),r==="month"?(await y(C.getFullYear(),C.getMonth()+1),await y(C.getFullYear(),C.getMonth())):r==="week"&&await y(C.getFullYear(),C.getMonth()+1)})()},[r,k,y]),p.useEffect(()=>{const P=setTimeout(()=>{const C=[...m,...x()],A=w.map(B=>{const z=v.find(W=>W.id===B.employeeId);return{...B,employeeName:z?.name||""}});c0({todos:C,vacations:A})},1e3);return()=>clearTimeout(P)},[m,x,w,v]),p.useEffect(()=>{t&&!t.isAnonymous&&te.getUserSettings(t.uid).then(P=>{if(P?.language&&g.changeLanguage(P.language),P?.startScreen)if(P.startScreen==="last"){const C=localStorage.getItem("lastView");C&&s(C)}else s(P.startScreen)}).catch(P=>console.error("Failed to load user settings:",P))},[t,g]),p.useEffect(()=>{r&&localStorage.setItem("lastView",r)},[r]),p.useEffect(()=>{KN(),Hu();const P=setInterval(()=>{VN.measureMemoryUsage()},5e3),C=setInterval(()=>{wp.getErrorStats().total>0},1e4),A=setInterval(()=>{const z=Hu().checks.filter(W=>W.status==="fail");z.length>0&&ne.error("Critical security issues detected:",z)},3e4);return()=>{clearInterval(P),clearInterval(C),clearInterval(A)}},[]),p.useEffect(()=>{let P=0;(async()=>{try{const{Capacitor:A}=await Je(async()=>{const{Capacitor:V}=await Promise.resolve().then(()=>ms);return{Capacitor:V}},void 0,import.meta.url);if(!A.isNativePlatform())return;const{App:B}=await Je(async()=>{const{App:V}=await Promise.resolve().then(()=>qA);return{App:V}},void 0,import.meta.url),z=V=>{const ce=Date.now();if(console.log("Processing deep link:",V),V.includes("todolist://add")){if(ce-P<500){console.log("Add modal debounce - skipping");return}P=ce,console.log("Dispatching openAddTodoModal event"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("openAddTodoModal"))},300)}else if(V.includes("todolist://toggle")){const Se=new URL(V).searchParams.get("taskId");Se&&(console.log("Toggling task from widget:",Se),setTimeout(()=>{f(Se)},300))}},W=await B.getLaunchUrl();W?.url&&z(W.url);const X=await B.addListener("appUrlOpen",V=>{console.log("Deep link opened:",V.url),z(V.url)});return()=>{X.remove()}}catch(A){console.warn("Deep link handling not available:",A)}})()},[f]),p.useEffect(()=>{(async()=>{try{const{Capacitor:C}=await Je(async()=>{const{Capacitor:W}=await Promise.resolve().then(()=>ms);return{Capacitor:W}},void 0,import.meta.url);if(!C.isNativePlatform())return;const{registerPlugin:A}=await Je(async()=>{const{registerPlugin:W}=await Promise.resolve().then(()=>ms);return{registerPlugin:W}},void 0,import.meta.url),z=await A("TodoListWidget").addListener("toggleTodo",W=>{console.log("Widget toggleTodo event received:",W.taskId),W.taskId&&f(W.taskId)});return()=>{z.remove()}}catch(C){console.warn("Widget listener not available:",C)}})()},[f]),p.useEffect(()=>{const P=()=>{const z=window.innerWidth;if(c!==null){l(c),i(!c);return}const W=z<=768,X="ontouchstart"in window||navigator.maxTouchPoints>0,V=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ce=z>768&&z<=1024&&X,ke=window.matchMedia("(max-width: 768px)").matches,Se=window.matchMedia("(pointer: coarse)").matches,me=z<=500&&X&&V||X&&V&&window.devicePixelRatio>=2||navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("Android")||ke&&X||Se&&V;let ue=!1;me||ke||W||ce?ue=!0:ue=!1,l(ue),i(!ue)};P();let C;const A=()=>{clearTimeout(C),C=setTimeout(P,100)};window.addEventListener("resize",A),window.addEventListener("orientationchange",()=>{setTimeout(P,200)});const B=setTimeout(P,300);return()=>{window.removeEventListener("resize",A),window.removeEventListener("orientationchange",P),clearTimeout(C),clearTimeout(B)}},[c]);const b=()=>{h.current?.open()},j=()=>{u.current?.focus()},D=()=>{i(!n)},N=()=>{s("today")},T=()=>{s("week")},_=()=>{s("month")};return e?a.jsx(Id,{}):t?a.jsx("div",{children:a.jsxs(MN,{onOpenAddTodo:b,onFocusSearch:j,onToggleSidebar:D,onSwitchToTodayView:N,onSwitchToWeekView:T,onSwitchToMonthView:_,children:[a.jsx(cR,{currentView:r,setCurrentView:s,isSidebarOpen:n,setIsSidebarOpen:i,searchInputRef:u,addTodoModalRef:h,isMobile:o,forceMobile:c,setForceMobile:d}),a.jsx(s_,{})]})}):a.jsx(sR,{})}function uR(){return a.jsx(p.Suspense,{fallback:a.jsx(Id,{}),children:a.jsx(iR,{children:a.jsx(vw,{children:a.jsx(Qv,{children:a.jsx($N,{children:a.jsx(PN,{children:a.jsx(Jv,{children:a.jsx(tw,{children:a.jsx(rR,{children:a.jsx(dR,{})})})})})})})})})})}Yx.createRoot(document.getElementById("root")).render(a.jsx(p.StrictMode,{children:a.jsx(uR,{})}));export{Xd as P,dc as W,bt as a,Et as b,ot as c,fo as d,cn as e,te as f,ts as g,ne as h,Hr as i,a as j,xR as k,wp as l,HA as m,qd as n,Rn as s,Xe as u};
