import{b as Z,j as t,a as J,c as _,g as re,s as X,d as Y,f as H,u as oe,e as ne,i as ie,h as le}from"./index-BxVUMFpi.js";import{r as m,L as de,C as ce,y as ge,h as B,ah as ue,a6 as me,H as pe,ai as xe,U as Q,ab as he,J as fe,X as ye,w as be,j as ke,aj as ve,ak as Te}from"./icons-DlXupddv.js";import"./react-DavUf6mE.js";import"./firebase-BOX_ydUi.js";import"./date-BnkIBH9d.js";const we=()=>{const{theme:x,setTheme:y}=Z(),b=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"system",label:"System"}];return t.jsx("div",{className:"grid grid-cols-3 gap-1",children:b.map(({value:n,label:c})=>t.jsx("button",{onClick:()=>y(n),className:`px-2 py-2 text-xs rounded-lg transition-colors ${x===n?"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"}`,title:`${c} ëª¨ë“œ`,children:c},n))})},ee=()=>{const{getGoogleAccessToken:x,currentUser:y,loading:b}=J(),{addTodo:n,updateTodo:c,deleteTodo:k,todos:S,loading:o}=_(),[W,D]=m.useState(!1),[R,u]=m.useState(null),I=m.useRef(!1),C=m.useRef(S);C.current=S;const i=m.useRef(y);return i.current=y,{syncGoogleTasks:m.useCallback(async T=>{if(o)return console.log("â³ Firestore ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ë™ê¸°í™”ë¥¼ ëŒ€ê¸°í•©ë‹ˆë‹¤..."),!1;if(I.current)return!1;if(I.current=!0,!x)return T?.silent||u("ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤."),I.current=!1,!1;D(!0),T?.silent||u(null);try{const w=await x({silent:T?.silent});if(!w){if(!T?.silent)throw new Error("êµ¬ê¸€ ì¸ì¦ í† í°ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");return I.current=!1,D(!1),!1}const j=await re.getAllTasks(w);let v=0,N=0,h=0;const U=new Map,$=new Set;C.current.forEach(e=>{e.googleTaskId&&U.set(e.googleTaskId,e),e.subTasks&&Array.isArray(e.subTasks)&&e.subTasks.forEach(s=>{s.googleTaskId&&$.add(s.googleTaskId)})});const f=new Set,P=new Map,A=new Map,z=[];for(const e of j)for(const s of e.tasks){if(!s.id)continue;const g={...s,listId:e.listId,listName:e.listName};if(P.set(s.id,g),s.parent){const a=A.get(s.parent)||[];a.push(g),A.set(s.parent,a)}else z.push(g)}for(const e of z){const s=U.get(e.id),g=e.status==="completed",a=A.get(e.id)||[];if(s){if(s.googleTaskListId||(console.log(`ğŸ”§ Google Task List ID ë³µêµ¬: [${s.title}] -> ${e.listId}`),await c(s.id,{googleTaskListId:e.listId}),s.googleTaskListId=e.listId),e.deleted){const r=s.updatedAt?new Date(s.updatedAt).getTime():0;if(Date.now()-r<6e4){console.log(`ğŸ›¡ï¸ ìµœê·¼ ìˆ˜ì •ëœ í•­ëª© ì‚­ì œ ë°©ì§€ (Safety Guard): [${s.title}]`);continue}console.log(`ğŸ—‘ï¸ êµ¬ê¸€ì—ì„œ ì‚­ì œëœ í•  ì¼ ê°ì§€: [${s.title}]`),await k(s.id),h++;continue}if(s.googleTaskId&&X.has(s.googleTaskId))continue;const p=e.title&&e.title!==s.title,V=e.notes!==void 0&&e.notes!==s.description,K=s.completed!==g,se=e.due?new Date(e.due).toDateString():null,ae=s.dueDate?new Date(s.dueDate).toDateString():null,M=se!==ae;let F=!1;const O=s.subTasks||[];let q=[...O];for(const r of a){if(r.deleted)continue;const L=O.find(E=>E.googleTaskId===r.id);L?(L.title!==r.title||L.completed!==(r.status==="completed"))&&(q=q.map(E=>E.id===L.id?{...E,title:r.title,completed:r.status==="completed",updatedAt:new Date}:E),F=!0):f.has(r.id)||(q.push({id:Y(),title:r.title,completed:r.status==="completed",priority:"medium",createdAt:new Date,updatedAt:new Date,googleTaskId:r.id}),F=!0,f.add(r.id))}if(p||V||K||M||F){console.log(`ğŸ”„ êµ¬ê¸€ íƒœìŠ¤í¬ ë³€ê²½ ê°ì§€: [${e.title}]`);const r={};p&&(r.title=e.title),V&&(r.description=e.notes||""),K&&(r.completed=g,r.completedAt=g?e.completed?new Date(e.completed):new Date:null),M&&(r.dueDate=e.due?new Date(e.due):void 0),F&&(r.subTasks=q),s.googleTaskListId||(r.googleTaskListId=e.listId),await c(s.id,r),N++}continue}if(e.deleted||f.has(e.id))continue;if(e.parent){console.log(`ğŸ›¡ï¸ Parentê°€ ìˆëŠ” íƒœìŠ¤í¬ëŠ” Root Todoë¡œ ìƒì„±í•˜ì§€ ì•ŠìŒ: [${e.title}]`);continue}if(X.has(e.id)){console.log(`ğŸ›¡ï¸ ë°©ê¸ˆ ìƒì„±ëœ íƒœìŠ¤í¬ Import ê±´ë„ˆëœ€ (Registry): [${e.title}]`),f.add(e.id);continue}if($.has(e.id)){console.log(`ğŸ›¡ï¸ ì´ë¯¸ SubTaskë¡œ ì¡´ì¬í•˜ëŠ” í•­ëª©ì˜ ì¤‘ë³µ ìƒì„± ë°©ì§€: [${e.title}]`),f.add(e.id);continue}const l=a.filter(d=>!d.deleted).map(d=>(f.add(d.id),{id:Y(),title:d.title,completed:d.status==="completed",priority:"medium",createdAt:new Date,updatedAt:new Date,googleTaskId:d.id}));f.add(e.id),await n({title:e.title||"(No Title)",description:e.notes||"",completed:g,priority:"medium",type:l.length>0?"project":"simple",recurrence:"none",tags:["Google Tasks"],googleTaskId:e.id,googleTaskListId:e.listId,completedAt:e.completed?new Date(e.completed):void 0,dueDate:e.due?new Date(e.due):void 0,subTasks:l}),v++}const G=[];for(const e of C.current){if(!e.googleTaskId)continue;const s=P.get(e.googleTaskId);if(s&&s.parent){const g=e.updatedAt?new Date(e.updatedAt).getTime():0;if(Date.now()-g<6e4){console.log(`ğŸ›¡ï¸ Cleanup ì‚­ì œ ë°©ì§€ (Safety Guard): [${e.title}]`);continue}console.log(`ğŸ§¹ ì¤‘ë³µ ì œê±°: í•˜ìœ„ ì‘ì—…ìœ¼ë¡œ ì „í™˜ëœ Todo ì‚­ì œ [${e.title}] (${e.id})`),G.push(e.id)}}if(G.length>0)for(const e of G)await k(e),h++;if(T?.silent?(v>0||N>0||h>0)&&console.log(`âœ… Google Tasks ë™ê¸°í™”: ê°€ì ¸ì˜¤ê¸° ${v}, ì—…ë°ì´íŠ¸ ${N}, ì‚­ì œ ${h}`):(v>0||N>0||h>0?u(`ê°€ì ¸ì˜¤ê¸° ${v}ê°œ, ì—…ë°ì´íŠ¸ ${N}ê°œ, ì‚­ì œ ${h}ê°œ ì™„ë£Œ!`):u("ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."),setTimeout(()=>u(null),3e3)),i.current)try{await H.updateGoogleTasksSettings(i.current.uid,{linked:!0})}catch(e){console.error("Failed to update linked status",e)}return!0}catch(w){if(console.error("Google Tasks Sync failed",w),!T?.silent){const j=w.message||"Unknown error";j.includes("popup")?u("Popup blocked?"):j.includes("network")?u("Network Error"):u(`Error: ${j.substring(0,15)}...`),setTimeout(()=>u(null),5e3)}return!1}finally{D(!1),I.current=!1}},[x,n,c,k,o]),loading:W,message:R,msg:R}};function je(){const{currentUser:x}=J(),{syncGoogleTasks:y,loading:b,message:n}=ee(),c=()=>{y()};return x?t.jsx("div",{className:"px-4",children:t.jsxs("button",{onClick:c,disabled:b,className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl \r
                   text-gray-600 dark:text-gray-400 \r
                   hover:bg-white/50 dark:hover:bg-gray-800/50 \r
                   hover:text-gray-900 dark:hover:text-gray-200 \r
                   transition-all duration-200 group border border-transparent hover:shadow-sm`,children:[t.jsx("div",{className:"p-2 rounded-lg bg-gray-100/50 dark:bg-gray-800/50 group-hover:bg-white dark:group-hover:bg-gray-700 transition-colors",children:b?t.jsx(de,{className:"w-5 h-5 animate-spin text-blue-500"}):n?t.jsx(ce,{className:"w-5 h-5 text-green-500"}):t.jsx(ge,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 group-hover:text-blue-500 transition-colors"})}),t.jsxs("div",{className:"flex flex-col items-start",children:[t.jsx("span",{className:"font-medium text-sm",children:n||"Google Tasks"}),!n&&t.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Click to import"})]})]})}):null}const $e=({currentView:x,onViewChange:y,isOpen:b,onToggle:n,isMobile:c=!1,forceMobile:k=null,onToggleForceMobile:S})=>{const{t:o}=oe(),{getOverdueTodos:W,getTomorrowTodos:D,getYesterdayIncompleteTodos:R,recurringTemplates:u,getRecurringTodos:I,getTodayTodos:C}=_(),{currentUser:i}=J(),{showVacationsInTodos:te,toggleVacationDisplay:T}=ne(),{currentTheme:w,isDark:j}=Z(),v=W(),N=D(),h=R(),U=C(),$=!!w.bg,f=u.filter(a=>a.isActive),[P,A]=m.useState(0),[z,G]=m.useState(0),{syncGoogleTasks:e}=ee();m.useEffect(()=>{let a;const l=async()=>{if(i?.uid){const p=await H.getUserSettings(i.uid);return p?.autoSyncGoogleTasks&&await e({silent:!0}).catch(V=>le.warn("Auto-sync blocked/failed",V)),p?.autoSyncGoogleTasks}return!1},d=()=>{l()};return l().then(p=>{p&&(a=setInterval(async()=>{await e({silent:!0}).catch(()=>{})},30*1e3),window.addEventListener("focus",d))}),()=>{a&&clearInterval(a),window.removeEventListener("focus",d)}},[i?.uid,e]),m.useEffect(()=>{if(!i?.email)return;const a=H.subscribeToIncomingInvitations(i.email,l=>A(l.length));return()=>a()},[i?.email]),m.useEffect(()=>{if(!i?.uid)return;const a=H.subscribeToSharingNotifications(i.uid,l=>{const d=l.filter(p=>!p.read&&!p.isRead).length;G(d)});return()=>a()},[i?.uid]);const s=P+z,g=[{id:"today",label:o("nav.today"),icon:B,count:U.filter(a=>!a.completed).length},{id:"week",label:o("nav.week"),icon:ue},{id:"month",label:o("nav.month"),icon:B},{id:"board",label:o("nav.board")||"Kanban",icon:me},{id:"recurring",label:o("nav.recurring"),icon:pe,count:f.length},{id:"history",label:o("nav.history"),icon:xe},{id:"sharing",label:o("nav.sharing")||"ê³µìœ  ì„¤ì •",icon:Q,count:s,highlight:s>0},{id:"analytics",label:o("nav.analytics"),icon:Q},{id:"vacation",label:o("nav.vacation"),icon:B},{id:"guide",label:o("guide.title"),icon:he},{id:"settings",label:o("nav.settings"),icon:fe}];return t.jsxs(t.Fragment,{children:[c&&b&&t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 transition-opacity duration-300",onClick:n}),t.jsxs("aside",{className:`fixed top-0 left-0 z-50 h-full transition-all duration-300 ease-in-out 
          ${b?"translate-x-0":"-translate-x-full"} 
          ${c?"w-[280px]":"w-64"}
          glass-card
          ${$?"shadow-none border-r border-white/30 dark:border-white/20 transition-[background-color] duration-200 backdrop-blur-none":"border-r border-white/40 dark:border-gray-700/40 shadow-2xl transition-[background-color] duration-200"}
          flex flex-col pt-[env(safe-area-inset-top)] rounded-none`,style:$?{backgroundColor:`rgba(${j?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[t.jsxs("div",{className:"p-6 flex items-center justify-between relative overflow-hidden shrink-0",children:[t.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-primary-500/10 to-purple-500/10 dark:from-primary-500/5 dark:to-purple-500/5 pointer-events-none"}),t.jsx("h1",{className:"text-2xl font-bold text-gradient-primary relative z-10 tracking-tight",children:"Todo List"}),c&&t.jsx("button",{onClick:n,className:"p-2 rounded-xl hover:bg-white/50 dark:hover:bg-gray-700/50 text-gray-500 dark:text-gray-400 transition-colors relative z-10",children:t.jsx(ye,{className:"w-5 h-5"})})]}),t.jsxs("nav",{className:"flex-1 overflow-y-auto px-4 py-2 space-y-1 custom-scrollbar",children:[g.map(a=>{if(a.id==="analytics"&&!ie(i?.email))return null;const l=x===a.id,d=a.icon;return t.jsxs("button",{onClick:()=>{y(a.id),c&&n()},className:`w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all duration-200 group
                  ${l?"bg-primary-500/10 dark:bg-primary-500/20 text-primary-600 dark:text-primary-400 shadow-sm border border-primary-100/50 dark:border-primary-500/30 backdrop-blur-sm":"text-gray-600 dark:text-gray-400 hover:bg-white/50 dark:hover:bg-gray-800/50 hover:text-gray-900 dark:hover:text-gray-200 hover:shadow-sm border border-transparent"}`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`p-2 rounded-lg transition-colors ${l?"bg-primary-100 dark:bg-primary-900/40":"bg-gray-100/50 dark:bg-gray-800/50 group-hover:bg-white dark:group-hover:bg-gray-700"}`,children:t.jsx(d,{className:`w-5 h-5 ${l?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-200"}`})}),t.jsx("span",{className:"font-medium",children:a.label})]}),a.count!==void 0&&a.count>0&&t.jsx("span",{className:`px-2 py-0.5 text-xs font-bold rounded-full ${a.highlight?"bg-red-500 text-white animate-pulse":l?"bg-primary-100 dark:bg-primary-900/40 text-primary-600 dark:text-primary-400":"bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400"}`,children:a.count})]},a.id)}),t.jsx("div",{className:"my-4 border-t border-gray-200/50 dark:border-gray-700/50"}),t.jsxs("div",{className:"space-y-3 px-1",children:[h.length>0&&t.jsxs("div",{className:"glass-panel p-4 rounded-xl border-l-4 border-l-orange-400 group hover:scale-[1.02] transition-transform duration-200 bg-orange-50/30 dark:bg-orange-900/10",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-orange-600 dark:text-orange-400",children:[t.jsx(be,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-bold",children:o("nav.summary.yesterday")})]}),t.jsxs("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:[h.length,t.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:o("nav.summary.count")})]})]}),v.length>0&&t.jsxs("div",{className:"glass-panel p-4 rounded-xl border-l-4 border-l-red-500 group hover:scale-[1.02] transition-transform duration-200 bg-red-50/30 dark:bg-red-900/10",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-red-600 dark:text-red-400",children:[t.jsx(ke,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-bold",children:o("nav.summary.overdue")})]}),t.jsxs("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:[v.length,t.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:o("nav.summary.count")})]})]}),t.jsxs("div",{className:"glass-panel p-4 rounded-xl border-l-4 border-l-primary-400 group hover:scale-[1.02] transition-transform duration-200 bg-primary-50/30 dark:bg-primary-900/10",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-primary-600 dark:text-primary-400",children:[t.jsx(B,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-bold",children:o("nav.summary.tomorrow")})]}),t.jsxs("div",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:[N.length,t.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:o("nav.summary.count")})]})]})]})]}),t.jsx(je,{}),t.jsxs("div",{className:"p-4 border-t border-gray-200/50 dark:border-gray-700/50 bg-white/30 dark:bg-gray-900/30 backdrop-blur-sm shrink-0 space-y-4",children:[t.jsx(we,{}),t.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-200/30 dark:border-gray-700/30",children:[t.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 font-medium",children:"v1.2.0 â€¢ Premium"}),S&&t.jsx("button",{onClick:()=>S(!k),className:`p-1.5 rounded-lg transition-all ${k?"bg-primary-100 text-primary-600 dark:bg-primary-900/30 dark:text-primary-400":"hover:bg-white/50 dark:hover:bg-gray-700/50 text-gray-500 dark:text-gray-400"}`,title:k?"ë°ìŠ¤í¬í†± ë·°ë¡œ ì „í™˜":"ëª¨ë°”ì¼ ë·° í…ŒìŠ¤íŠ¸",children:k?t.jsx(ve,{className:"w-4 h-4"}):t.jsx(Te,{className:"w-4 h-4"})})]})]})]})]})};export{$e as default};
