const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./web-trjde_0x.js","./firebase-BOX_ydUi.js","./react-DavUf6mE.js","./icons-DlXupddv.js","./date-BnkIBH9d.js","./web-6H05fciy.js","./web-D53_8Scr.js","./web-CFFLU050.js","./web-PiDjsOMT.js","./LoginScreen-CUdxjRbV.js","./Sidebar-Df2gzWeA.js","./PWAInstallPrompt-PQqWkx6C.js","./ErrorBoundary-BgcXXvX2.js","./OfflineNotification-2VWx8yvV.js","./BottomNavigation-DRGGLu4w.js"])))=>i.map(i=>d[i]);
var Vy=Object.defineProperty;var Uy=(t,e,r)=>e in t?Vy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Ht=(t,e,r)=>Uy(t,typeof e!="symbol"?e+"":e,r);import{r as By,a as Ug}from"./react-DavUf6mE.js";import{r as y,P as gt,C as Yt,X as rt,a as Bg,U as tr,S as Qo,R as Za,A as Hy,b as ql,c as Hg,T as Ut,d as Gg,e as pa,f as Jo,F as ya,g as qn,h as at,i as Cn,j as gr,k as Zo,L as Ys,l as Gy,m as zg,n as Xl,M as Ql,o as ei,p as Jl,q as gs,s as Ze,t as zy,u as Ky,v as Yy,w as qy,x as Xy,y as Qy,Z as Kg,z as Yg,B as qg,D as Jy,E as Zy,G as el,H as Xg,I as Ed,J as Qg,K as lo,N as ex,O as tx,Q as Jg,V as Id,W as rx,Y as sx,_ as nx,$ as ax,a0 as ix,a1 as ox,a2 as Ad,a3 as Xn,a4 as lx,a5 as Rd,a6 as cx,a7 as dx,a8 as ux,a9 as Zg,aa as Zl,ab as hx,ac as gx,ad as em,ae as tm,af as co,ag as mx}from"./icons-DlXupddv.js";import{_ as Qn,C as Jn,r as Kr,S as ec,a as rm,F as tc,g as rc,b as br,c as xa,d as sm,i as sc,p as nm,u as am,e as im,E as om,o as fx,f as px,L as lm,h as cm,j as yx,k as dm,l as um,m as hm,n as xx,q as bx,G as En,s as Me,t as Jt,v as kt,w as Re,x as He,y as Pd,z as Gt,A as We,B as Ft,D as Ae,H as Lr,I as Ge,J as Wt,K as St,M as Md,N as bn,O as vx,P as wx,Q as kx,R as Od,T as Tx,U as Nx,V as Sx,W as jx,X as _x,Y as oe,Z as ut,$ as nc,a0 as Ir,a1 as qs,a2 as ti,a3 as Dx,a4 as Cx,a5 as Ex,a6 as ba,a7 as ac,a8 as ic,a9 as Ix,aa as Ax,ab as Rx,ac as Ld,ad as gm,ae as Px,af as Mx,ag as Li,ah as Ox,ai as Lx}from"./firebase-BOX_ydUi.js";import{b as uo,a as vn,c as wn,d as $x,e as xs,g as ri,i as Vt,f as qe,h as rn,j as $d,k as Fd,s as ho,l as Fx,m as An,n as as,o as is,p as mm,q as Wx,r as tl,t as Rn,u as fm,v as Ha,w as rl,x as Vx,y as si,z as pm,A as Ds}from"./date-BnkIBH9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var go={exports:{}},kn={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wd;function Ux(){if(Wd)return kn;Wd=1;var t=By(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,d){var u,h={},g=null,m=null;d!==void 0&&(g=""+d),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(u in c)s.call(c,u)&&!i.hasOwnProperty(u)&&(h[u]=c[u]);if(l&&l.defaultProps)for(u in c=l.defaultProps,c)h[u]===void 0&&(h[u]=c[u]);return{$$typeof:e,type:l,key:g,ref:m,props:h,_owner:n.current}}return kn.Fragment=r,kn.jsx=o,kn.jsxs=o,kn}var Vd;function Bx(){return Vd||(Vd=1,go.exports=Ux()),go.exports}var a=Bx(),Pa={},Ud;function Hx(){if(Ud)return Pa;Ud=1;var t=Ug();return Pa.createRoot=t.createRoot,Pa.hydrateRoot=t.hydrateRoot,Pa}var Gx=Hx();const zx="modulepreload",Kx=function(t,e){return new URL(t,e).href},Bd={},Je=function(e,r,s){let n=Promise.resolve();if(r&&r.length>0){let d=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");n=d(r.map(u=>{if(u=Kx(u,s),u in Bd)return;Bd[u]=!0;const h=u.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(!!s)for(let f=o.length-1;f>=0;f--){const p=o[f];if(p.href===u&&(!h||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${g}`))return;const x=document.createElement("link");if(x.rel=h?"stylesheet":zx,h||(x.as="script"),x.crossOrigin="",x.href=u,c&&x.setAttribute("nonce",c),document.head.appendChild(x),h)return new Promise((f,p)=>{x.addEventListener("load",f),x.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function mo(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}function Yx(t){return t.toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function $i(t){switch(t){case 1:return"ì²«ì§¸ì£¼";case 2:return"ë‘˜ì§¸ì£¼";case 3:return"ì…‹ì§¸ì£¼";case 4:return"ë„·ì§¸ì£¼";case 5:return"ë§ˆì§€ë§‰ì£¼";case-1:return"ë§ˆì§€ë§‰ì£¼";default:return`${t}ì£¼ì°¨`}}function qx(t){return{2024:["2024-01-01","2024-02-09","2024-02-10","2024-02-11","2024-02-12","2024-03-01","2024-04-10","2024-05-05","2024-05-06","2024-05-15","2024-06-06","2024-08-15","2024-09-16","2024-09-17","2024-09-18","2024-10-03","2024-10-09","2024-12-25"],2025:["2025-01-01","2025-01-28","2025-01-29","2025-01-30","2025-03-01","2025-05-05","2025-05-13","2025-06-06","2025-08-15","2025-10-05","2025-10-06","2025-10-07","2025-10-08","2025-10-03","2025-10-09","2025-12-25"],2026:["2026-01-01","2026-02-16","2026-02-17","2026-02-18","2026-03-01","2026-05-05","2026-05-02","2026-06-06","2026-08-15","2026-09-24","2026-09-25","2026-09-26","2026-10-03","2026-10-09","2026-12-25"]}[t.toString()]||[]}function Xx(t){return{2024:[{date:"2024-01-01",name:"ì‹ ì •",isHoliday:!0},{date:"2024-02-09",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2024-02-10",name:"ì„¤ë‚ ",isHoliday:!0},{date:"2024-02-11",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2024-02-12",name:"ëŒ€ì²´ê³µíœ´ì¼",isHoliday:!0},{date:"2024-03-01",name:"ì‚¼ì¼ì ˆ",isHoliday:!0},{date:"2024-04-10",name:"êµ­íšŒì˜ì›ì„ ê±°",isHoliday:!0},{date:"2024-05-05",name:"ì–´ë¦°ì´ë‚ ",isHoliday:!0},{date:"2024-05-06",name:"ëŒ€ì²´ê³µíœ´ì¼",isHoliday:!0},{date:"2024-05-15",name:"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",isHoliday:!0},{date:"2024-06-06",name:"í˜„ì¶©ì¼",isHoliday:!0},{date:"2024-08-15",name:"ê´‘ë³µì ˆ",isHoliday:!0},{date:"2024-09-16",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2024-09-17",name:"ì¶”ì„",isHoliday:!0},{date:"2024-09-18",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2024-10-03",name:"ê°œì²œì ˆ",isHoliday:!0},{date:"2024-10-09",name:"í•œê¸€ë‚ ",isHoliday:!0},{date:"2024-12-25",name:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",isHoliday:!0}],2025:[{date:"2025-01-01",name:"ì‹ ì •",isHoliday:!0},{date:"2025-01-28",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2025-01-29",name:"ì„¤ë‚ ",isHoliday:!0},{date:"2025-01-30",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2025-03-01",name:"ì‚¼ì¼ì ˆ",isHoliday:!0},{date:"2025-05-05",name:"ì–´ë¦°ì´ë‚ ",isHoliday:!0},{date:"2025-05-13",name:"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",isHoliday:!0},{date:"2025-06-06",name:"í˜„ì¶©ì¼",isHoliday:!0},{date:"2025-08-15",name:"ê´‘ë³µì ˆ",isHoliday:!0},{date:"2025-10-05",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2025-10-06",name:"ì¶”ì„",isHoliday:!0},{date:"2025-10-07",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2025-10-08",name:"ëŒ€ì²´ê³µíœ´ì¼",isHoliday:!0},{date:"2025-10-03",name:"ê°œì²œì ˆ",isHoliday:!0},{date:"2025-10-09",name:"í•œê¸€ë‚ ",isHoliday:!0},{date:"2025-12-25",name:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",isHoliday:!0}],2026:[{date:"2026-01-01",name:"ì‹ ì •",isHoliday:!0},{date:"2026-02-16",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2026-02-17",name:"ì„¤ë‚ ",isHoliday:!0},{date:"2026-02-18",name:"ì„¤ë‚ ì—°íœ´",isHoliday:!0},{date:"2026-03-01",name:"ì‚¼ì¼ì ˆ",isHoliday:!0},{date:"2026-05-05",name:"ì–´ë¦°ì´ë‚ ",isHoliday:!0},{date:"2026-05-02",name:"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",isHoliday:!0},{date:"2026-06-06",name:"í˜„ì¶©ì¼",isHoliday:!0},{date:"2026-08-15",name:"ê´‘ë³µì ˆ",isHoliday:!0},{date:"2026-09-24",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2026-09-25",name:"ì¶”ì„",isHoliday:!0},{date:"2026-09-26",name:"ì¶”ì„ì—°íœ´",isHoliday:!0},{date:"2026-10-03",name:"ê°œì²œì ˆ",isHoliday:!0},{date:"2026-10-09",name:"í•œê¸€ë‚ ",isHoliday:!0},{date:"2026-12-25",name:"í¬ë¦¬ìŠ¤ë§ˆìŠ¤",isHoliday:!0}]}[t.toString()]||[]}function ym(t){const e=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n=`${e}-${r}-${s}`;return qx(e).includes(n)}function Br(t){const e=t.getDay();return e===0||e===6}function xm(t){return Br(t)||ym(t)}function oc(t){const e=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n=`${e}-${r}-${s}`;return Xx(e).find(o=>o.date===n)||null}function bm(t,e){const r=new Date(t,e-1,1);let s=new Date(r);for(;xm(s);)s.setDate(s.getDate()+1);return s}function vm(t,e){const r=new Date(t,e,0);let s=new Date(r);for(;xm(s);)s.setDate(s.getDate()-1);return s}function ni(t,e){if(ym(t))return!0;const r=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),i=`${r}-${s}-${n}`,o=`${s}-${n}`;return e.some(l=>{if(!!l.isRecurring){const d=l.date.split("-");if(d.length===3){const u=d[1].padStart(2,"0"),h=d[2].padStart(2,"0");return`${u}-${h}`===o}return l.date.endsWith(o)}return l.date===i})}class Qx{constructor(){Ht(this,"templates",[])}setTemplates(e){this.templates=e}hasConflictingInstance(e,r,s){const n=this.templates.find(o=>o.title===s.targetTemplateTitle&&o.id!==r);if(!n)return!1;const i=this.generateInstancesForTemplate(n);for(const o of i)if(this.checkDateConflict(e,o.date,s.scope))return console.log(`[Conflict] ${e.toDateString()}ì— ${n.title}ì™€(ê³¼) ì¶©ëŒ ë°œìƒ`),!0;return!1}checkDateConflict(e,r,s){switch(s){case"same_date":return e.toDateString()===r.toDateString();case"same_week":const n=new Date(e);n.setDate(e.getDate()-e.getDay());const i=new Date(r);return i.setDate(r.getDate()-r.getDay()),n.toDateString()===i.toDateString();case"same_month":return e.getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth();default:return!1}}generateInstancesForTemplate(e,r=[]){if(!e.isActive)return[];switch(e.recurrenceType){case"daily":return this.generateDailyInstancesRaw(e,r);case"weekly":return this.generateWeeklyInstancesRaw(e,r);case"monthly":return this.generateMonthlyInstancesRaw(e,r);default:return[]}}calculateWeekOfMonth(e){const r=e.getFullYear(),s=e.getMonth(),n=e.getDate(),i=new Date(r,s,1),o=new Date(r,s+1,0),l=i.getDay(),c=Math.ceil((n+l)/7),d=o.getDate(),u=Math.ceil((d+l)/7);return console.log(`  firstWeekday=${l}, weekOfMonth=${c}, totalWeeks=${u}`),c===u?(console.log("  ë§ˆì§€ë§‰ì£¼ë¡œ íŒì •: -1 ë°˜í™˜"),-1):(console.log(`  ì¼ë°˜ ì£¼ì°¨: ${c} ë°˜í™˜`),c)}isLastOccurrenceOfWeekdayInMonth(e){const r=e.getFullYear(),s=e.getMonth(),n=e.getDay(),i=new Date(r,s+1,0);for(let o=i.getDate();o>=1;o--){const l=new Date(r,s,o);if(l.getDay()===n){const c=e.getDate()===o;return console.log(`  ${e.toDateString()}: ê°™ì€ ìš”ì¼(${n})ì˜ ë§ˆì§€ë§‰ ë‚ ì€ ${l.toDateString()}, ì¼ì¹˜: ${c}`),c}}return!1}adjustForHolidays(e,r="show",s=[]){let n=new Date(e);if(r==="show")return n;const i=ni(n,s),o=Br(n);if(!i&&!o)return console.log("   âœ… ì´ë¯¸ í‰ì¼ì´ë¯€ë¡œ ì¡°ì • ë¶ˆí•„ìš”"),n;n.getMonth();let l=0;const c=15;for(;l<c;){r==="before"?(n.setDate(n.getDate()-1),console.log(`   â† í•˜ë£¨ ì´ì „ìœ¼ë¡œ: ${n.toDateString()}`)):(n.setDate(n.getDate()+1),console.log(`   â†’ í•˜ë£¨ ì´í›„ë¡œ: ${n.toDateString()}`));const d=ni(n,s),u=Br(n);if(console.log(`   ì²´í¬: ê³µíœ´ì¼=${d}, ì£¼ë§=${u}`),!d&&!u){console.log(`   âœ… í‰ì¼ ë°œê²¬: ${n.toDateString()}`);break}l++}return l>=c?(console.warn(`âš ï¸ ê³µíœ´ì¼ ì¡°ì • ìµœëŒ€ ì‹œë„ ì´ˆê³¼ (${c}íšŒ), ì›ë˜ ë‚ ì§œ ë°˜í™˜`),console.log(`   ì›ë˜ ë‚ ì§œ ë°˜í™˜: ${e.toDateString()}`),e):n}hasDuplicateOnDate(e,r,s){return!1}isExceptionDate(e,r,s){if(!r||r.length===0)return!1;for(const n of r)switch(n.type){case"date":const i=e.getDate();if(n.values.includes(i))return!0;break;case"weekday":const o=e.getDay();if(n.values.includes(o))return!0;break;case"week":const l=this.calculateWeekOfMonth(e);if(console.log("ì˜ˆì™¸ ì²´í¬:",e.toDateString(),"ì£¼ì°¨:",l,"ì˜ˆì™¸ ê°’ë“¤:",n.values),n.values.includes(-1)){const d=this.isLastOccurrenceOfWeekdayInMonth(e);if(console.log("ë§ˆì§€ë§‰ì£¼ ì²´í¬:",e.toDateString(),"í•´ë‹¹ ìš”ì¼ì˜ ë§ˆì§€ë§‰ ë°œìƒì¼:",d),d)return console.log("ì˜ˆì™¸ ë‚ ì§œ ì œì™¸ (ë§ˆì§€ë§‰ì£¼):",e.toDateString()),!0}if(n.values.includes(l))return console.log("ì˜ˆì™¸ ë‚ ì§œ ì œì™¸:",e.toDateString(),"ì£¼ì°¨:",l),!0;break;case"month":const c=e.getMonth()+1;if(n.values.includes(c))return!0;break;case"conflict":if(s){const d=n.values;for(const u of d)if(console.log("ì¤‘ë³µ ì˜ˆì™¸ ê²€ì‚¬:",e.toDateString(),u),this.hasConflictingInstance(e,s,u))return console.log("ì¤‘ë³µìœ¼ë¡œ ì¸í•œ ì˜ˆì™¸ ì²˜ë¦¬:",e.toDateString()),!0}break}return!1}generateDailyInstancesRaw(e,r=[]){if(e.recurrenceType!=="daily")return[];const s=[],n=new Date,i=new Date(e.createdAt),o=new Date(n);o.setFullYear(n.getFullYear()+1);let l=new Date(i);for(;l<=o;){const c=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(new Date(l.getFullYear(),l.getMonth(),l.getDate())>=c&&!this.isExceptionDate(l,e.exceptions,e.id)){const u=e.holidayHandling||"show",h=this.adjustForHolidays(l,u,r);if(!this.hasDuplicateOnDate(h,e.id,e.title)){const g=`${h.getFullYear()}-${(h.getMonth()+1).toString().padStart(2,"0")}-${h.getDate().toString().padStart(2,"0")}`,m=`${e.id}_${g}`;s.push({id:m,templateId:e.id,date:h,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3})}}l.setDate(l.getDate()+1)}return s}generateWeeklyInstancesRaw(e,r=[]){if(e.recurrenceType!=="weekly"||e.weekday===void 0)return[];const s=[],n=new Date,i=new Date(e.createdAt),o=new Date(n);o.setFullYear(n.getFullYear()+1);const l=e.weekday;let c=new Date(i);const d=(l-i.getDay()+7)%7;d>0&&c.setDate(i.getDate()+d);let u=new Date(c);for(;u<=o;){const h=new Date(n.getFullYear(),n.getMonth(),n.getDate());if(new Date(u.getFullYear(),u.getMonth(),u.getDate())>=h&&!this.isExceptionDate(u,e.exceptions,e.id)){const m=e.holidayHandling||"show";console.log(`[${e.title}] ì›ë³¸ ë‚ ì§œ: ${u.toDateString()}, ê³µíœ´ì¼ ì²˜ë¦¬: ${m}`),console.log(`[${e.title}] í…œí”Œë¦¿ ì „ì²´ ë°ì´í„°:`,e);const x=oc(u)!==null,f=Br(u);console.log(`[${e.title}] ê³µíœ´ì¼ ì—¬ë¶€: ${x}, ì£¼ë§ ì—¬ë¶€: ${f}`);const p=this.adjustForHolidays(u,m,r);if(p.getTime()!==u.getTime()&&console.log(`[${e.title}] ê³µíœ´ì¼ ì¡°ì •: ${u.toDateString()} â†’ ${p.toDateString()}`),this.hasDuplicateOnDate(p,e.id,e.title))console.log(`ğŸš« ì¤‘ë³µ í• ì¼ ë°œê²¬ìœ¼ë¡œ ìƒì„± ì œì™¸: "${e.title}" - ${p.toDateString()}`);else{const w=`${p.getFullYear()}-${(p.getMonth()+1).toString().padStart(2,"0")}-${p.getDate().toString().padStart(2,"0")}`,v=`${e.id}_${w}`;e.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")&&(console.log("ğŸ“‹ ì›”ê°„ì—…ë¬´ë³´ê³  ì¸ìŠ¤í„´ìŠ¤ ìƒì„±:"),console.log(`   ìµœì¢… ë‚ ì§œ: ${p.toDateString()} (${p.getDate()}ì¼)`),console.log(`   ìƒì„±ëœ ID: ${v}`)),s.push({id:v,templateId:e.id,date:p,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3})}}u.setDate(u.getDate()+7)}return s}findNthWeekdayOfMonth(e,r,s,n){const i=new Date(e,r-1,1),o=i.getDay();if(console.log(`   findNthWeekdayOfMonth: ${e}ë…„ ${r}ì›”, ${s} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼`),console.log(`   ì²«ì§¸ ë‚ : ${i.toDateString()}, ì²«ì§¸ ë‚  ìš”ì¼: ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][o]}`),s==="last"){const l=new Date(e,r,0);console.log(`   ë§ˆì§€ë§‰ ë‚ : ${l.toDateString()}`);for(let c=l.getDate();c>=1;c--){const d=new Date(e,r-1,c);if(d.getDay()===n)return console.log(`   ë§ˆì§€ë§‰ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼: ${d.toDateString()}`),d}}else{const c={first:1,second:2,third:3,fourth:4}[s];let d=(n-o+7)%7,u=new Date(e,r-1,1+d);console.log(`   ì²« ë²ˆì§¸ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼: ${u.toDateString()}`);let h=new Date(u);return h.setDate(h.getDate()+(c-1)*7),console.log(`   ${c}ë²ˆì§¸ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼: ${h.toDateString()}`),h.getMonth()===r-1?h:(console.log(`   âŒ ${c}ë²ˆì§¸ ì£¼ê°€ í•´ë‹¹ ì›”ì„ ë²—ì–´ë‚¨`),null)}return null}generateMonthlyInstancesRaw(e,r=[]){if(e.recurrenceType!=="monthly")return[];console.log(`
ğŸ”¥ [${e.title}] ìƒˆë¡œìš´ ì›”ê°„ ë°˜ë³µ ë¡œì§ ì‹œì‘`),console.log("   ì „ì²´ í…œí”Œë¦¿ ë°ì´í„°:",JSON.stringify(e,null,2)),console.log(`   monthlyDate: ${e.monthlyDate}`),console.log(`   monthlyPattern: ${e.monthlyPattern}`),console.log(`   monthlyWeek: ${e.monthlyWeek}`),console.log(`   monthlyWeekday: ${e.monthlyWeekday}`);const s=[],n=new Set,i=new Date,o=i.getFullYear(),l=i.getMonth()+1,c=i.getDate();console.log(`   í˜„ì¬: ${o}ë…„ ${l}ì›” ${c}ì¼`);for(let d=0;d<12;d++){let u=o,h=l+d;h>12&&(u+=Math.floor((h-1)/12),h=(h-1)%12+1),console.log(`
ğŸ“… ì²˜ë¦¬ ì¤‘: ${u}ë…„ ${h}ì›”`);let g=null;if(e.monthlyPattern==="weekday"&&e.monthlyWeek&&e.monthlyWeekday!==void 0)console.log(`   íŒ¨í„´: ë§¤ì›” ${e.monthlyWeek} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][e.monthlyWeekday]}ìš”ì¼`),g=this.findNthWeekdayOfMonth(u,h,e.monthlyWeek,e.monthlyWeekday),console.log(g?`   ${e.monthlyWeek} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][e.monthlyWeekday]}ìš”ì¼: ${g.toDateString()}`:`   âŒ ${u}ë…„ ${h}ì›”ì— ${e.monthlyWeek} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][e.monthlyWeekday]}ìš”ì¼ì´ ì—†ìŒ`);else if(e.monthlyDate===-1)g=new Date(u,h,0),console.log(`   ë§ì¼: ${g.toDateString()}`);else if(e.monthlyDate===-2)g=bm(u,h),console.log(`   ì²« ë²ˆì§¸ ê·¼ë¬´ì¼: ${g.toDateString()}`);else if(e.monthlyDate===-3)g=vm(u,h),console.log(`   ë§ˆì§€ë§‰ ê·¼ë¬´ì¼: ${g.toDateString()}`);else if(e.monthlyDate&&e.monthlyDate>0){if(g=new Date(u,h-1,e.monthlyDate),g.getMonth()!==h-1){console.log(`   âš ï¸ ${u}ë…„ ${h}ì›”ì—ëŠ” ${e.monthlyDate}ì¼ì´ ì—†ìŒ`);continue}console.log(`   íŠ¹ì • ë‚ ì§œ ${e.monthlyDate}ì¼: ${g.toDateString()}`)}else g=new Date(u,h-1,1),console.log(`   ê¸°ë³¸ê°’ (ë§¤ì›” 1ì¼): ${g.toDateString()}`);if(!g){console.log("   âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ");continue}const m=new Date(o,l-1,c);if(g<m){console.log(`   â° ê³¼ê±° ë‚ ì§œ ì œì™¸: ${g.toDateString()}`);continue}let x=g;if(e.monthlyDate&&e.monthlyDate>0){const w=e.holidayHandling||"show";x=this.adjustForHolidays(g,w,r),x.getTime()!==g.getTime()&&console.log(`   ğŸ”„ ê³µíœ´ì¼ ì¡°ì •: ${g.toDateString()} â†’ ${x.toDateString()}`)}if(this.isExceptionDate(x,e.exceptions,e.id)){console.log(`   ğŸš« ì˜ˆì™¸ ë‚ ì§œ ì œì™¸: ${x.toDateString()}`);continue}const f=`${x.getFullYear()}-${(x.getMonth()+1).toString().padStart(2,"0")}-${x.getDate().toString().padStart(2,"0")}`;if(n.has(f)){console.log(`   ğŸš« ì¤‘ë³µ ë°©ì§€: ${f} ì´ë¯¸ ìƒì„±ë¨`);continue}const p=`${e.id}_${f}`;n.add(f),s.push({id:p,templateId:e.id,date:x,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3}),console.log(`   âœ… ì¸ìŠ¤í„´ìŠ¤ ìƒì„±: ${x.toDateString()} (ID: ${p})`)}return console.log(`ğŸ¯ [${e.title}] ì´ ${s.length}ê°œ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ`),s}calculateMonthlyWeekday(e,r,s,n){const i=r-1,o=new Date(e,i+1,0);if(console.log(`ğŸ—“ï¸ calculateMonthlyWeekday: ${e}ë…„ ${r}ì›” ${s} ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼`),console.log(`ğŸ—“ï¸ í•´ë‹¹ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ : ${o.getDate()}ì¼`),s==="last"){console.log(`ğŸ” ë§ˆì§€ë§‰ ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼ì„ ì°¾ëŠ” ì¤‘...`);for(let l=o.getDate();l>=1;l--){const c=new Date(e,i,l);if(c.getDay()===n)return console.log(`âœ… ë§ˆì§€ë§‰ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][n]}ìš”ì¼ ë°œê²¬: ${c.getFullYear()}ë…„ ${c.getMonth()+1}ì›” ${c.getDate()}ì¼`),c}}else{const c={first:1,second:2,third:3,fourth:4}[s];let d=0;for(let u=1;u<=o.getDate();u++){const h=new Date(e,i,u);if(h.getDay()===n&&(d++,d===c))return h}}return null}generateDailyInstances(e,r=[]){return this.generateDailyInstancesRaw(e,r)}generateWeeklyInstances(e,r=[]){return this.generateWeeklyInstancesRaw(e,r)}generateMonthlyInstances(e,r=[]){return this.generateMonthlyInstancesRaw(e,r)}generateInstances(e,r=[]){if(!e.isActive)return[];let s=[];switch(e.recurrenceType){case"daily":s=this.generateDailyInstances(e,r);break;case"weekly":s=this.generateWeeklyInstances(e,r);break;case"monthly":s=this.generateMonthlyInstances(e,r);break;default:return[]}return this.removeDuplicateInstances(s)}removeDuplicateInstances(e){const r=new Map;for(const s of e){const n=`${s.templateId}_${s.date.toDateString()}`;(!r.has(n)||r.get(n).createdAt<s.createdAt)&&(r.has(n)&&console.log(`ğŸ”§ ì¤‘ë³µ ì¸ìŠ¤í„´ìŠ¤ ì œê±°: ${s.date.toDateString()}`),r.set(n,s))}return Array.from(r.values()).sort((s,n)=>s.date.getTime()-n.date.getTime())}convertToTodo(e,r){const s=`recurring_${e.id}`,i=r.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")||r.title.includes("ì›”ê°„ ì—…ë¬´ë³´ê³ ")||r.title.includes("ì—…ë¬´ë³´ê³ ")||r.title.includes("ì—…ë¬´ ë³´ê³ ")?"urgent":r.priority,o=new Date(e.date);o.setHours(12,0,0,0);const l={id:s,title:r.title,description:r.description,completed:e.completed,priority:i,type:r.type,dueDate:void 0,startDate:o,createdAt:e.createdAt,updatedAt:e.updatedAt,completedAt:e.completedAt,tags:[...r.tags||[]],order:e.order,_isRecurringInstance:!0,_instanceId:e.id,_templateId:r.id};return e.id==="PUH4xT3lVY5aK2vuQyUe_2025-08-21"&&(console.log("ğŸ“‹ğŸ“‹ğŸ“‹ convertToTodo ê²°ê³¼ - ì£¼ê°„ì—…ë¬´ë³´ê³ "),console.log("  ì¶œë ¥ todo.completed:",l.completed,typeof l.completed),console.log("  ì¶œë ¥ todo ì „ì²´:",JSON.stringify(l,null,2))),l}getTodayInstances(e){const s=new Date().toDateString();return e.filter(n=>n.date.toDateString()===s)}getWeekInstances(e){const r=new Date,s=new Date(r);s.setDate(r.getDate()-r.getDay());const n=new Date(s);return n.setDate(s.getDate()+6),e.filter(i=>i.date>=s&&i.date<=n)}getMonthInstances(e){const r=new Date,s=new Date(r.getFullYear(),r.getMonth(),1),n=new Date(r.getFullYear(),r.getMonth()+1,0);return e.filter(i=>i.date>=s&&i.date<=n)}removeDuplicateTodos(e){const r=new Map,s=[];for(const o of e){if(!o._isRecurringInstance){s.push(o);continue}const l=`${o.title}_${o.dueDate?.toDateString()||"no-date"}`;r.has(l)?console.log(`ğŸ—‘ï¸ ì¤‘ë³µ ë°˜ë³µ í• ì¼ ì œê±°: "${o.title}" - ${o.dueDate?.toDateString()}`):(r.set(l,o),console.log(`ğŸ“‹ ë°˜ë³µ í• ì¼ ìœ ì§€: "${o.title}" - ${o.dueDate?.toDateString()}`))}const n=Array.from(r.values()),i=[...s,...n];return console.log(`ğŸ“Š ì¤‘ë³µ ì œê±° ê²°ê³¼: ${e.length} â†’ ${i.length} (${e.length-i.length}ê°œ ì œê±°)`),i.sort((o,l)=>{const c=o.order||0,d=l.order||0;if(c!==d)return c-d;const u=o.dueDate||new Date(0),h=l.dueDate||new Date(0);return u.getTime()-h.getTime()})}}const Ps=new Qx;/*! Capacitor: https://capacitorjs.com/ - MIT License */var bs;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(bs||(bs={}));class Ga extends Error{constructor(e,r,s){super(e),this.message=e,this.code=r,this.data=s}}const Jx=t=>{var e,r;return t?.androidBridge?"android":!((r=(e=t?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},Zx=t=>{const e=t.CapacitorCustomPlatform||null,r=t.Capacitor||{},s=r.Plugins=r.Plugins||{},n=()=>e!==null?e.name:Jx(t),i=()=>n()!=="web",o=h=>{const g=d.get(h);return!!(g?.platforms.has(n())||l(h))},l=h=>{var g;return(g=r.PluginHeaders)===null||g===void 0?void 0:g.find(m=>m.name===h)},c=h=>t.console.error(h),d=new Map,u=(h,g={})=>{const m=d.get(h);if(m)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),m.proxy;const x=n(),f=l(h);let p;const w=async()=>(!p&&x in g?p=typeof g[x]=="function"?p=await g[x]():p=g[x]:e!==null&&!p&&"web"in g&&(p=typeof g.web=="function"?p=await g.web():p=g.web),p),v=(N,D)=>{var $,C;if(f){const R=f?.methods.find(B=>D===B.name);if(R)return R.rtype==="promise"?B=>r.nativePromise(h,D.toString(),B):(B,Y)=>r.nativeCallback(h,D.toString(),B,Y);if(N)return($=N[D])===null||$===void 0?void 0:$.bind(N)}else{if(N)return(C=N[D])===null||C===void 0?void 0:C.bind(N);throw new Ga(`"${h}" plugin is not implemented on ${x}`,bs.Unimplemented)}},k=N=>{let D;const $=(...C)=>{const R=w().then(B=>{const Y=v(B,N);if(Y){const V=Y(...C);return D=V?.remove,V}else throw new Ga(`"${h}.${N}()" is not implemented on ${x}`,bs.Unimplemented)});return N==="addListener"&&(R.remove=async()=>D()),R};return $.toString=()=>`${N.toString()}() { [capacitor code] }`,Object.defineProperty($,"name",{value:N,writable:!1,configurable:!1}),$},b=k("addListener"),T=k("removeListener"),_=(N,D)=>{const $=b({eventName:N},D),C=async()=>{const B=await $;T({eventName:N,callbackId:B},D)},R=new Promise(B=>$.then(()=>B({remove:C})));return R.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await C()},R},j=new Proxy({},{get(N,D){switch(D){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return f?_:b;case"removeListener":return T;default:return k(D)}}});return s[h]=j,d.set(h,{name:h,proxy:j,platforms:new Set([...Object.keys(g),...f?[x]:[]])}),j};return r.convertFileSrc||(r.convertFileSrc=h=>h),r.getPlatform=n,r.handleError=c,r.isNativePlatform=i,r.isPluginAvailable=o,r.registerPlugin=u,r.Exception=Ga,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},eb=t=>t.Capacitor=Zx(t),Ke=eb(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ar=Ke.registerPlugin;class lc{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,r){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(r);const i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i),s&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,r);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,r,s){const n=this.listeners[e];if(!n){if(s){let i=this.retainedEventArguments[e];i||(i=[]),i.push(r),this.retainedEventArguments[e]=i}return}n.forEach(i=>i(r))}hasListeners(e){var r;return!!(!((r=this.listeners[e])===null||r===void 0)&&r.length)}registerWindowListener(e,r){this.windowListeners[r]={registered:!1,windowEventName:e,pluginEventName:r,handler:s=>{this.notifyListeners(r,s)}}}unimplemented(e="not implemented"){return new Ke.Exception(e,bs.Unimplemented)}unavailable(e="not available"){return new Ke.Exception(e,bs.Unavailable)}async removeListener(e,r){const s=this.listeners[e];if(!s)return;const n=s.indexOf(r);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const r=this.retainedEventArguments[e];r&&(delete this.retainedEventArguments[e],r.forEach(s=>{this.notifyListeners(e,s)}))}}const Hd=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Gd=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class tb extends lc{async getCookies(){const e=document.cookie,r={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[n,i]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=Gd(n).trim(),i=Gd(i).trim(),r[n]=i}),r}async setCookie(e){try{const r=Hd(e.key),s=Hd(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${r}=${s||""}${n}; path=${i}; ${o};`}catch(r){return Promise.reject(r)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const r of e)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Ar("CapacitorCookies",{web:()=>new tb});const rb=async t=>new Promise((e,r)=>{const s=new FileReader;s.onload=()=>{const n=s.result;e(n.indexOf(",")>=0?n.split(",")[1]:n)},s.onerror=n=>r(n),s.readAsDataURL(t)}),sb=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(n=>n.toLocaleLowerCase()).reduce((n,i,o)=>(n[i]=t[e[o]],n),{})},nb=(t,e=!0)=>t?Object.entries(t).reduce((s,n)=>{const[i,o]=n;let l,c;return Array.isArray(o)?(c="",o.forEach(d=>{l=e?encodeURIComponent(d):d,c+=`${i}=${l}&`}),c.slice(0,-1)):(l=e?encodeURIComponent(o):o,c=`${i}=${l}`),`${s}&${c}`},"").substr(1):null,wm=(t,e={})=>{const r=Object.assign({method:t.method||"GET",headers:t.headers},e),n=sb(t.headers)["content-type"]||"";if(typeof t.data=="string")r.body=t.data;else if(n.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[o,l]of Object.entries(t.data||{}))i.set(o,l);r.body=i.toString()}else if(n.includes("multipart/form-data")||t.data instanceof FormData){const i=new FormData;if(t.data instanceof FormData)t.data.forEach((l,c)=>{i.append(c,l)});else for(const l of Object.keys(t.data))i.append(l,t.data[l]);r.body=i;const o=new Headers(r.headers);o.delete("content-type"),r.headers=o}else(n.includes("application/json")||typeof t.data=="object")&&(r.body=JSON.stringify(t.data));return r};class ab extends lc{async request(e){const r=wm(e,e.webFetchExtra),s=nb(e.params,e.shouldEncodeUrlParams),n=s?`${e.url}?${s}`:e.url,i=await fetch(n,r),o=i.headers.get("content-type")||"";let{responseType:l="text"}=i.ok?e:{};o.includes("application/json")&&(l="json");let c,d;switch(l){case"arraybuffer":case"blob":d=await i.blob(),c=await rb(d);break;case"json":c=await i.json();break;case"document":case"text":default:c=await i.text()}const u={};return i.headers.forEach((h,g)=>{u[g]=h}),{data:c,headers:u,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Ar("CapacitorHttp",{web:()=>new ab});const ms=Object.freeze(Object.defineProperty({__proto__:null,Capacitor:Ke,CapacitorException:Ga,get ExceptionCode(){return bs},WebPlugin:lc,buildRequestInit:wm,registerPlugin:Ar},Symbol.toStringTag,{value:"Module"}));var zd;(function(t){t.IndexedDbLocal="INDEXED_DB_LOCAL",t.InMemory="IN_MEMORY",t.BrowserLocal="BROWSER_LOCAL",t.BrowserSession="BROWSER_SESSION"})(zd||(zd={}));var Kd;(function(t){t.APPLE="apple.com",t.FACEBOOK="facebook.com",t.GAME_CENTER="gc.apple.com",t.GITHUB="github.com",t.GOOGLE="google.com",t.MICROSOFT="microsoft.com",t.PLAY_GAMES="playgames.google.com",t.TWITTER="twitter.com",t.YAHOO="yahoo.com",t.PASSWORD="password",t.PHONE="phone"})(Kd||(Kd={}));const fo=Ar("FirebaseAuthentication",{web:()=>Je(()=>import("./web-trjde_0x.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>new t.FirebaseAuthenticationWeb)});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const km="firebasestorage.googleapis.com",ib="storageBucket",ob=120*1e3,lb=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr extends tc{constructor(e,r,s=0){super(po(e),`Firebase Storage: ${r} (${po(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return po(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var yr;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(yr||(yr={}));function po(t){return"storage/"+t}function cb(){const t="An unknown error occurred, please check the error payload for server response.";return new vr(yr.UNKNOWN,t)}function db(){return new vr(yr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ub(){return new vr(yr.CANCELED,"User canceled the upload/download.")}function hb(t){return new vr(yr.INVALID_URL,"Invalid URL '"+t+"'.")}function gb(t){return new vr(yr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Yd(t){return new vr(yr.INVALID_ARGUMENT,t)}function Tm(){return new vr(yr.APP_DELETED,"The Firebase app was deleted.")}function mb(t){return new vr(yr.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let s;try{s=rr.makeFromUrl(e,r)}catch{return new rr(e,"")}if(s.path==="")return s;throw gb(e)}static makeFromUrl(e,r){let s=null;const n="([A-Za-z0-9.\\-_]+)";function i(b){b.path.charAt(b.path.length-1)==="/"&&(b.path_=b.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+n+o,"i"),c={bucket:1,path:3};function d(b){b.path_=decodeURIComponent(b.path)}const u="v[A-Za-z0-9_]+",h=r.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",m=new RegExp(`^https?://${h}/${u}/b/${n}/o${g}`,"i"),x={bucket:1,path:3},f=r===km?"(?:storage.googleapis.com|storage.cloud.google.com)":r,p="([^?#]*)",w=new RegExp(`^https?://${f}/${n}/${p}`,"i"),k=[{regex:l,indices:c,postModify:i},{regex:m,indices:x,postModify:d},{regex:w,indices:{bucket:1,path:2},postModify:d}];for(let b=0;b<k.length;b++){const T=k[b],_=T.regex.exec(e);if(_){const j=_[T.indices.bucket];let N=_[T.indices.path];N||(N=""),s=new rr(j,N),T.postModify(s);break}}if(s==null)throw hb(e);return s}}class fb{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pb(t,e,r){let s=1,n=null,i=null,o=!1,l=0;function c(){return l===2}let d=!1;function u(...p){d||(d=!0,e.apply(null,p))}function h(p){n=setTimeout(()=>{n=null,t(m,c())},p)}function g(){i&&clearTimeout(i)}function m(p,...w){if(d){g();return}if(p){g(),u.call(null,p,...w);return}if(c()||o){g(),u.call(null,p,...w);return}s<64&&(s*=2);let k;l===1?(l=2,k=0):k=(s+Math.random())*1e3,h(k)}let x=!1;function f(p){x||(x=!0,g(),!d&&(n!==null?(p||(l=2),clearTimeout(n),h(0)):p||(l=1)))}return h(0),i=setTimeout(()=>{o=!0,f(!0)},r),f}function yb(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xb(t){return t!==void 0}function qd(t,e,r,s){if(s<e)throw Yd(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>r)throw Yd(`Invalid value for '${t}'. Expected ${r} or less.`)}function bb(t){const e=encodeURIComponent;let r="?";for(const s in t)if(t.hasOwnProperty(s)){const n=e(s)+"="+e(t[s]);r=r+n+"&"}return r=r.slice(0,-1),r}var ai;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ai||(ai={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vb(t,e){const r=t>=500&&t<600,n=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return r||n||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wb{constructor(e,r,s,n,i,o,l,c,d,u,h,g=!0,m=!1){this.url_=e,this.method_=r,this.headers_=s,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=u,this.connectionFactory_=h,this.retry=g,this.isUsingEmulator=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((x,f)=>{this.resolve_=x,this.reject_=f,this.start_()})}start_(){const e=(s,n)=>{if(n){s(!1,new Ma(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const l=i.getErrorCode()===ai.NO_ERROR,c=i.getStatus();if(!l||vb(c,this.additionalRetryCodes_)&&this.retry){const u=i.getErrorCode()===ai.ABORT;s(!1,new Ma(!1,null,u));return}const d=this.successCodes_.indexOf(c)!==-1;s(!0,new Ma(d,i))})},r=(s,n)=>{const i=this.resolve_,o=this.reject_,l=n.connection;if(n.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());xb(c)?i(c):i()}catch(c){o(c)}else if(l!==null){const c=cb();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(n.canceled){const c=this.appDelete_?Tm():ub();o(c)}else{const c=db();o(c)}};this.canceled_?r(!1,new Ma(!1,null,!0)):this.backoffId_=pb(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&yb(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ma{constructor(e,r,s){this.wasSuccessCode=e,this.connection=r,this.canceled=!!s}}function kb(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function Tb(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Nb(t,e){e&&(t["X-Firebase-GMPID"]=e)}function Sb(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function jb(t,e,r,s,n,i,o=!0,l=!1){const c=bb(t.urlParams),d=t.url+c,u=Object.assign({},t.headers);return Nb(u,e),kb(u,r),Tb(u,i),Sb(u,s),new wb(d,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function Db(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,r){this._service=e,r instanceof rr?this._location=r:this._location=rr.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new ii(e,r)}get root(){const e=new rr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Db(this._location.path)}get storage(){return this._service}get parent(){const e=_b(this._location.path);if(e===null)return null;const r=new rr(this._location.bucket,e);return new ii(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw mb(e)}}function Xd(t,e){const r=e?.[ib];return r==null?null:rr.makeFromBucketSpec(r,t)}function Cb(t,e,r,s={}){t.host=`${e}:${r}`;const n=sc(e);n&&(nm(`https://${t.host}/b`),am("Storage",!0)),t._isUsingEmulator=!0,t._protocol=n?"https":"http";const{mockUserToken:i}=s;i&&(t._overrideAuthToken=typeof i=="string"?i:im(i,t.app.options.projectId))}class Eb{constructor(e,r,s,n,i,o=!1){this.app=e,this._authProvider=r,this._appCheckProvider=s,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=km,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=ob,this._maxUploadRetryTime=lb,this._requests=new Set,n!=null?this._bucket=rr.makeFromBucketSpec(n,this._host):this._bucket=Xd(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=rr.makeFromBucketSpec(this._url,e):this._bucket=Xd(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){qd("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){qd("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){if(rm(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ii(this,e)}_makeRequest(e,r,s,n,i=!0){if(this._deleted)return new fb(Tm());{const o=jb(e,this._appId,s,n,r,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,r){const[s,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,s,n).getPromise()}}const Qd="@firebase/storage",Jd="0.13.14";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nm="storage";function Ib(t=rc(),e){t=br(t);const s=xa(t,Nm).getImmediate({identifier:e}),n=sm("storage");return n&&Ab(s,...n),s}function Ab(t,e,r,s={}){Cb(t,e,r,s)}function Rb(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),n=t.getProvider("app-check-internal");return new Eb(r,s,n,e,ec)}function Pb(){Qn(new Jn(Nm,Rb,"PUBLIC").setMultipleInstances(!0)),Kr(Qd,Jd,""),Kr(Qd,Jd,"esm2017")}Pb();const Sm="@firebase/installations",cc="0.6.18";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm=1e4,_m=`w:${cc}`,Dm="FIS_v2",Mb="https://firebaseinstallations.googleapis.com/v1",Ob=3600*1e3,Lb="installations",$b="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fb={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},vs=new om(Lb,$b,Fb);function Cm(t){return t instanceof tc&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Em({projectId:t}){return`${Mb}/projects/${t}/installations`}function Im(t){return{token:t.token,requestStatus:2,expiresIn:Vb(t.expiresIn),creationTime:Date.now()}}async function Am(t,e){const s=(await e.json()).error;return vs.create("request-failed",{requestName:t,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function Rm({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function Wb(t,{refreshToken:e}){const r=Rm(t);return r.append("Authorization",Ub(e)),r}async function Pm(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Vb(t){return Number(t.replace("s","000"))}function Ub(t){return`${Dm} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bb({appConfig:t,heartbeatServiceProvider:e},{fid:r}){const s=Em(t),n=Rm(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const o={fid:r,authVersion:Dm,appId:t.appId,sdkVersion:_m},l={method:"POST",headers:n,body:JSON.stringify(o)},c=await Pm(()=>fetch(s,l));if(c.ok){const d=await c.json();return{fid:d.fid||r,registrationStatus:2,refreshToken:d.refreshToken,authToken:Im(d.authToken)}}else throw await Am("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mm(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hb(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb=/^[cdef][\w-]{21}$/,sl="";function zb(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const r=Kb(t);return Gb.test(r)?r:sl}catch{return sl}}function Kb(t){return Hb(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fi(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Om=new Map;function Lm(t,e){const r=Fi(t);$m(r,e),Yb(r,e)}function $m(t,e){const r=Om.get(t);if(r)for(const s of r)s(e)}function Yb(t,e){const r=qb();r&&r.postMessage({key:t,fid:e}),Xb()}let os=null;function qb(){return!os&&"BroadcastChannel"in self&&(os=new BroadcastChannel("[Firebase] FID Change"),os.onmessage=t=>{$m(t.data.key,t.data.fid)}),os}function Xb(){Om.size===0&&os&&(os.close(),os=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qb="firebase-installations-database",Jb=1,ws="firebase-installations-store";let yo=null;function dc(){return yo||(yo=fx(Qb,Jb,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(ws)}}})),yo}async function oi(t,e){const r=Fi(t),n=(await dc()).transaction(ws,"readwrite"),i=n.objectStore(ws),o=await i.get(r);return await i.put(e,r),await n.done,(!o||o.fid!==e.fid)&&Lm(t,e.fid),e}async function Fm(t){const e=Fi(t),s=(await dc()).transaction(ws,"readwrite");await s.objectStore(ws).delete(e),await s.done}async function Wi(t,e){const r=Fi(t),n=(await dc()).transaction(ws,"readwrite"),i=n.objectStore(ws),o=await i.get(r),l=e(o);return l===void 0?await i.delete(r):await i.put(l,r),await n.done,l&&(!o||o.fid!==l.fid)&&Lm(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uc(t){let e;const r=await Wi(t.appConfig,s=>{const n=Zb(s),i=ev(t,n);return e=i.registrationPromise,i.installationEntry});return r.fid===sl?{installationEntry:await e}:{installationEntry:r,registrationPromise:e}}function Zb(t){const e=t||{fid:zb(),registrationStatus:0};return Wm(e)}function ev(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const n=Promise.reject(vs.create("app-offline"));return{installationEntry:e,registrationPromise:n}}const r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=tv(t,r);return{installationEntry:r,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:rv(t)}:{installationEntry:e}}async function tv(t,e){try{const r=await Bb(t,e);return oi(t.appConfig,r)}catch(r){throw Cm(r)&&r.customData.serverCode===409?await Fm(t.appConfig):await oi(t.appConfig,{fid:e.fid,registrationStatus:0}),r}}async function rv(t){let e=await Zd(t.appConfig);for(;e.registrationStatus===1;)await Mm(100),e=await Zd(t.appConfig);if(e.registrationStatus===0){const{installationEntry:r,registrationPromise:s}=await uc(t);return s||r}return e}function Zd(t){return Wi(t,e=>{if(!e)throw vs.create("installation-not-found");return Wm(e)})}function Wm(t){return sv(t)?{fid:t.fid,registrationStatus:0}:t}function sv(t){return t.registrationStatus===1&&t.registrationTime+jm<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nv({appConfig:t,heartbeatServiceProvider:e},r){const s=av(t,r),n=Wb(t,r),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const o={installation:{sdkVersion:_m,appId:t.appId}},l={method:"POST",headers:n,body:JSON.stringify(o)},c=await Pm(()=>fetch(s,l));if(c.ok){const d=await c.json();return Im(d)}else throw await Am("Generate Auth Token",c)}function av(t,{fid:e}){return`${Em(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hc(t,e=!1){let r;const s=await Wi(t.appConfig,i=>{if(!Vm(i))throw vs.create("not-registered");const o=i.authToken;if(!e&&lv(o))return i;if(o.requestStatus===1)return r=iv(t,e),i;{if(!navigator.onLine)throw vs.create("app-offline");const l=dv(i);return r=ov(t,l),l}});return r?await r:s.authToken}async function iv(t,e){let r=await eu(t.appConfig);for(;r.authToken.requestStatus===1;)await Mm(100),r=await eu(t.appConfig);const s=r.authToken;return s.requestStatus===0?hc(t,e):s}function eu(t){return Wi(t,e=>{if(!Vm(e))throw vs.create("not-registered");const r=e.authToken;return uv(r)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function ov(t,e){try{const r=await nv(t,e),s=Object.assign(Object.assign({},e),{authToken:r});return await oi(t.appConfig,s),r}catch(r){if(Cm(r)&&(r.customData.serverCode===401||r.customData.serverCode===404))await Fm(t.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await oi(t.appConfig,s)}throw r}}function Vm(t){return t!==void 0&&t.registrationStatus===2}function lv(t){return t.requestStatus===2&&!cv(t)}function cv(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Ob}function dv(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function uv(t){return t.requestStatus===1&&t.requestTime+jm<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hv(t){const e=t,{installationEntry:r,registrationPromise:s}=await uc(e);return s?s.catch(console.error):hc(e).catch(console.error),r.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gv(t,e=!1){const r=t;return await mv(r),(await hc(r,e)).token}async function mv(t){const{registrationPromise:e}=await uc(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fv(t){if(!t||!t.options)throw xo("App Configuration");if(!t.name)throw xo("App Name");const e=["projectId","apiKey","appId"];for(const r of e)if(!t.options[r])throw xo(r);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function xo(t){return vs.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Um="installations",pv="installations-internal",yv=t=>{const e=t.getProvider("app").getImmediate(),r=fv(e),s=xa(e,"heartbeat");return{app:e,appConfig:r,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},xv=t=>{const e=t.getProvider("app").getImmediate(),r=xa(e,Um).getImmediate();return{getId:()=>hv(r),getToken:n=>gv(r,n)}};function bv(){Qn(new Jn(Um,yv,"PUBLIC")),Qn(new Jn(pv,xv,"PRIVATE"))}bv();Kr(Sm,cc);Kr(Sm,cc,"esm2017");const bo="@firebase/remote-config",tu="0.6.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bm="remote-config",ru=100;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv={"already-initialized":"Remote Config already initialized","registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser","custom-signal-max-allowed-signals":"Setting more than {$maxSignals} custom signals is not supported."},Pt=new om("remoteconfig","Remote Config",vv);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wv(t=rc(),e={}){var r,s;t=br(t);const n=xa(t,Bm);if(n.isInitialized()){const o=n.getOptions();if(dm(o,e))return n.getImmediate();throw Pt.create("already-initialized")}n.initialize({options:e});const i=n.getImmediate();return e.initialFetchResponse&&(i._initializePromise=Promise.all([i._storage.setLastSuccessfulFetchResponse(e.initialFetchResponse),i._storage.setActiveConfigEtag(((r=e.initialFetchResponse)===null||r===void 0?void 0:r.eTag)||""),i._storageCache.setLastSuccessfulFetchTimestampMillis(Date.now()),i._storageCache.setLastFetchStatus("success"),i._storageCache.setActiveConfig(((s=e.initialFetchResponse)===null||s===void 0?void 0:s.config)||{})]).then(),i._isInitializationComplete=!0),i}function kv(t){const e=br(t);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(e,r,s,n){this.client=e,this.storage=r,this.storageCache=s,this.logger=n}isCachedDataFresh(e,r){if(!r)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const s=Date.now()-r,n=s<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${s}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${n}.`),n}async fetch(e){const[r,s]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(s&&this.isCachedDataFresh(e.cacheMaxAgeMillis,r))return s;e.eTag=s&&s.eTag;const n=await this.client.fetch(e),i=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return n.status===200&&i.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(i),n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(t=navigator){return t.languages&&t.languages[0]||t.language}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,r,s,n,i,o){this.firebaseInstallations=e,this.sdkVersion=r,this.namespace=s,this.projectId=n,this.apiKey=i,this.appId=o}async fetch(e){const[r,s]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,o={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},l={sdk_version:this.sdkVersion,app_instance_id:r,app_instance_id_token:s,app_id:this.appId,language_code:Nv(),custom_signals:e.customSignals},c={method:"POST",headers:o,body:JSON.stringify(l)},d=fetch(i,c),u=new Promise((p,w)=>{e.signal.addEventListener(()=>{const v=new Error("The operation was aborted.");v.name="AbortError",w(v)})});let h;try{await Promise.race([d,u]),h=await d}catch(p){let w="fetch-client-network";throw p?.name==="AbortError"&&(w="fetch-timeout"),Pt.create(w,{originalErrorMessage:p?.message})}let g=h.status;const m=h.headers.get("ETag")||void 0;let x,f;if(h.status===200){let p;try{p=await h.json()}catch(w){throw Pt.create("fetch-client-parse",{originalErrorMessage:w?.message})}x=p.entries,f=p.state}if(f==="INSTANCE_STATE_UNSPECIFIED"?g=500:f==="NO_CHANGE"?g=304:(f==="NO_TEMPLATE"||f==="EMPTY_CONFIG")&&(x={}),g!==304&&g!==200)throw Pt.create("fetch-status",{httpStatus:g});return{status:g,eTag:m,config:x}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jv(t,e){return new Promise((r,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(r,n);t.addEventListener(()=>{clearTimeout(i),s(Pt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function _v(t){if(!(t instanceof tc)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class Dv{constructor(e,r){this.client=e,this.storage=r}async fetch(e){const r=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,r)}async attemptFetch(e,{throttleEndTimeMillis:r,backoffCount:s}){await jv(e.signal,r);try{const n=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),n}catch(n){if(!_v(n))throw n;const i={throttleEndTimeMillis:Date.now()+yx(s),backoffCount:s+1};return await this.storage.setThrottleMetadata(i),this.attemptFetch(e,i)}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cv=60*1e3,Ev=720*60*1e3;class Iv{get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}constructor(e,r,s,n,i){this.app=e,this._client=r,this._storageCache=s,this._storage=n,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:Cv,minimumFetchIntervalMillis:Ev},this.defaultConfig={}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function za(t,e){const r=t.target.error||void 0;return Pt.create(e,{originalErrorMessage:r&&r?.message})}const $r="app_namespace_store",Av="firebase_remote_config",Rv=1;function Pv(){return new Promise((t,e)=>{try{const r=indexedDB.open(Av,Rv);r.onerror=s=>{e(za(s,"storage-open"))},r.onsuccess=s=>{t(s.target.result)},r.onupgradeneeded=s=>{const n=s.target.result;switch(s.oldVersion){case 0:n.createObjectStore($r,{keyPath:"compositeKey"})}}}catch(r){e(Pt.create("storage-open",{originalErrorMessage:r?.message}))}})}class Hm{getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}getCustomSignals(){return this.get("custom_signals")}}class Mv extends Hm{constructor(e,r,s,n=Pv()){super(),this.appId=e,this.appName=r,this.namespace=s,this.openDbPromise=n}async setCustomSignals(e){const s=(await this.openDbPromise).transaction([$r],"readwrite"),n=await this.getWithTransaction("custom_signals",s),i=Gm(e,n||{});return await this.setWithTransaction("custom_signals",i,s),i}async getWithTransaction(e,r){return new Promise((s,n)=>{const i=r.objectStore($r),o=this.createCompositeKey(e);try{const l=i.get(o);l.onerror=c=>{n(za(c,"storage-get"))},l.onsuccess=c=>{const d=c.target.result;s(d?d.value:void 0)}}catch(l){n(Pt.create("storage-get",{originalErrorMessage:l?.message}))}})}async setWithTransaction(e,r,s){return new Promise((n,i)=>{const o=s.objectStore($r),l=this.createCompositeKey(e);try{const c=o.put({compositeKey:l,value:r});c.onerror=d=>{i(za(d,"storage-set"))},c.onsuccess=()=>{n()}}catch(c){i(Pt.create("storage-set",{originalErrorMessage:c?.message}))}})}async get(e){const s=(await this.openDbPromise).transaction([$r],"readonly");return this.getWithTransaction(e,s)}async set(e,r){const n=(await this.openDbPromise).transaction([$r],"readwrite");return this.setWithTransaction(e,r,n)}async delete(e){const r=await this.openDbPromise;return new Promise((s,n)=>{const o=r.transaction([$r],"readwrite").objectStore($r),l=this.createCompositeKey(e);try{const c=o.delete(l);c.onerror=d=>{n(za(d,"storage-delete"))},c.onsuccess=()=>{s()}}catch(c){n(Pt.create("storage-delete",{originalErrorMessage:c?.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class Ov extends Hm{constructor(){super(...arguments),this.storage={}}async get(e){return Promise.resolve(this.storage[e])}async set(e,r){return this.storage[e]=r,Promise.resolve(void 0)}async delete(e){return this.storage[e]=void 0,Promise.resolve()}async setCustomSignals(e){const r=this.storage.custom_signals||{};return this.storage.custom_signals=Gm(e,r),Promise.resolve(this.storage.custom_signals)}}function Gm(t,e){const r=Object.assign(Object.assign({},e),t),s=Object.fromEntries(Object.entries(r).filter(([n,i])=>i!==null).map(([n,i])=>typeof i=="number"?[n,i.toString()]:[n,i]));if(Object.keys(s).length>ru)throw Pt.create("custom-signal-max-allowed-signals",{maxSignals:ru});return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}getCustomSignals(){return this.customSignals}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),r=this.storage.getLastSuccessfulFetchTimestampMillis(),s=this.storage.getActiveConfig(),n=this.storage.getCustomSignals(),i=await e;i&&(this.lastFetchStatus=i);const o=await r;o&&(this.lastSuccessfulFetchTimestampMillis=o);const l=await s;l&&(this.activeConfig=l);const c=await n;c&&(this.customSignals=c)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}async setCustomSignals(e){this.customSignals=await this.storage.setCustomSignals(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(){Qn(new Jn(Bm,t,"PUBLIC").setMultipleInstances(!0)),Kr(bo,tu),Kr(bo,tu,"esm2017");function t(e,{options:r}){const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate(),{projectId:i,apiKey:o,appId:l}=s.options;if(!i)throw Pt.create("registration-project-id");if(!o)throw Pt.create("registration-api-key");if(!l)throw Pt.create("registration-app-id");const c=r?.templateId||"firebase",d=px()?new Mv(l,s.name,c):new Ov,u=new Lv(d),h=new lm(bo);h.logLevel=cm.ERROR;const g=new Sv(n,ec,c,i,o,l),m=new Dv(g,d),x=new Tv(m,d,u,h),f=new Iv(s,x,u,d,h);return kv(f),f}}$v();const ne={log:(t,e)=>{},warn:(t,e)=>{},error:(t,e)=>{console.error(t,e?.message||e)},info:(t,e)=>{},time:t=>{},timeEnd:t=>{}},nl={apiKey:"AIzaSyD8aBPw-o13mciSdV8gzRJN6TfaAy3OoWg",authDomain:"todolist-116f3.firebaseapp.com",databaseURL:"https://todolist-116f3-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"todolist-116f3",storageBucket:"todolist-116f3.firebasestorage.app",messagingSenderId:"470825187407",appId:"1:470825187407:web:4bd3f8c621c96890b2d23a",measurementId:"G-HS8CDYHDT1"},Fv=()=>{const t=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"];for(const e of t)if(!nl[e])throw new Error(`Firebase configuration missing: ${e}`);if(!nl.apiKey.startsWith("AIzaSy"))throw new Error("Invalid Firebase API key format")};let Xs;try{Fv();const t=um();t.length===0?(Xs=hm(nl),ne.log("Firebase app initialized")):(Xs=t[0],ne.log("Using existing Firebase app"))}catch(t){throw ne.error("Firebase initialization failed:",t),t}const jt=xx(Xs),Z=bx(Xs);Ib(Xs);const Wv=wv(Xs);Wv.settings.minimumFetchIntervalMillis=36e5;const ks=new En;ks.addScope("email");ks.addScope("profile");ks.addScope("https://www.googleapis.com/auth/userinfo.email");ks.addScope("https://www.googleapis.com/auth/userinfo.profile");ks.setCustomParameters({prompt:"select_account"});const Vv=()=>{};try{Vv(),ne.log("Firebase í”„ë¡œë•ì…˜ ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ")}catch(t){ne.error("Firebase security validation failed:",t)}class Tr extends Error{constructor(e,r="UNKNOWN_ERROR",s){super(e),this.code=r,this.originalError=s,this.name="TodoError"}}const Ms=(t,e)=>{if(t&&typeof t=="object"&&"code"in t){const r=t;switch(r.code){case"permission-denied":return new Tr("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.","PERMISSION_DENIED",t);case"not-found":return new Tr("ìš”ì²­í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","NOT_FOUND",t);case"unavailable":return new Tr("ì„œë²„ì— ì¼ì‹œì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.","UNAVAILABLE",t);case"failed-precondition":return new Tr("ë°ì´í„° ìƒíƒœê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.","FAILED_PRECONDITION",t);case"already-exists":return new Tr("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ì…ë‹ˆë‹¤.","ALREADY_EXISTS",t);default:return new Tr(`${e} ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${r.message}`,r.code||"FIRESTORE_ERROR",t)}}return t instanceof Error?new Tr(`${e} ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${t.message}`,"GENERAL_ERROR",t):new Tr(`${e} ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`,"UNKNOWN_ERROR",t)},Uv=t=>["unavailable","deadline-exceeded","internal","NETWORK_ERROR"].includes(t.code.toLowerCase()),kr=async(t,e=3,r=1e3)=>{let s;for(let n=1;n<=e;n++)try{return await t()}catch(i){const o=i instanceof Tr?i:Ms(i,"Operation");if(s=o,!Uv(o)||n===e)throw o;const l=r*Math.pow(2,n-1);await new Promise(c=>setTimeout(c,l))}throw s},xe=t=>{if(t){if(t instanceof Date)return t;if(typeof t?.toDate=="function")return t.toDate();if(typeof t=="string")return new Date(t)}},hr=t=>{if(t==null)return t;if(Array.isArray(t))return t.map(hr);if(t instanceof Date)return t;if(typeof t=="object"){const e={};return Object.keys(t).forEach(r=>{const s=t[r];s!==void 0&&(e[r]=hr(s))}),e}return t},Bv=(t,e,r)=>{switch(r){case"same_date":return t.toDateString()===e.toDateString();case"same_week":const s=new Date(t);s.setDate(t.getDate()-t.getDay());const n=new Date(e);return n.setDate(e.getDate()-e.getDay()),s.toDateString()===n.toDateString();case"same_month":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth();default:return!1}},Hv=t=>{const r=new Date(t.getFullYear(),t.getMonth(),1).getDay();return Math.ceil((t.getDate()+r)/7)},Gv=t=>{const e=t.getFullYear(),r=t.getMonth(),s=t.getDay(),n=new Date(e,r+1,0);for(let i=n.getDate();i>=1;i--)if(new Date(e,r,i).getDay()===s)return t.getDate()===i;return!1},zv=(t,e,r,s)=>{const n=e-1;if(r==="last"){const i=new Date(t,n+1,0);for(let o=i.getDate();o>=1;o--){const l=new Date(t,n,o);if(l.getDay()===s)return l}}else{const o={first:1,second:2,third:3,fourth:4}[r];let l=0;const c=new Date(t,n+1,0).getDate();for(let d=1;d<=c;d++){const u=new Date(t,n,d);if(u.getDay()===s&&(l++,l===o))return u}}return null},Kv=(t,e="show",r=[])=>{let s=new Date(t);if(e==="show")return s;const n=ni(s,r),i=Br(s);if(!n&&!i)return s;let o=0;for(;o<15;){e==="before"?s.setDate(s.getDate()-1):s.setDate(s.getDate()+1);const l=ni(s,r),c=Br(s);if(!l&&!c)break;o++}return s},ee={getTodos:async t=>kr(async()=>{try{if(!t)throw new Error("User ID is required");const e=Re(Z,`users/${t}/todos`),r=He(e,Gt("createdAt","desc")),n=(await Ge(r)).docs.map(f=>{const p=f.data();return{...p,id:f.id,createdAt:xe(p.createdAt)||new Date,updatedAt:xe(p.updatedAt)||new Date,dueDate:xe(p.dueDate),startDate:xe(p.startDate),completedAt:xe(p.completedAt),subTasks:p.subTasks?p.subTasks.map(w=>({...w,createdAt:xe(w.createdAt)||new Date,updatedAt:xe(w.updatedAt)||new Date,completedAt:w.completedAt?xe(w.completedAt):null})):[],myPermission:"admin"}}),i=Re(Z,"shared_todos"),o=He(i,We("ownerId","==",t)),l=He(i,We("sharedWithUids","array-contains",t)),[c,d]=await Promise.all([Ge(o),Ge(l)]),u=f=>{const p=f.data();let w="read";if(p.ownerId===t)w="admin";else if(p.sharedWith){const v=p.sharedWith.find(k=>k.uid===t);v&&(w=v.permission)}return{...p,id:f.id,createdAt:xe(p.createdAt)||new Date,updatedAt:xe(p.updatedAt)||new Date,dueDate:xe(p.dueDate),startDate:xe(p.startDate),completedAt:xe(p.completedAt),subTasks:p.subTasks?p.subTasks.map(v=>({...v,createdAt:xe(v.createdAt)||new Date,updatedAt:xe(v.updatedAt)||new Date,completedAt:v.completedAt?xe(v.completedAt):null})):[],myPermission:w}},h=[...c.docs,...d.docs],g=new Map;h.forEach(f=>{g.has(f.id)||g.set(f.id,u(f))});const m=Array.from(g.values());return ne.log("Firestore getTodos ì„±ê³µ:",{private:n.length,shared:m.length,uid:t}),[...n,...m].sort((f,p)=>{const w=f.createdAt instanceof Date?f.createdAt.getTime():0;return(p.createdAt instanceof Date?p.createdAt.getTime():0)-w})}catch(e){throw ne.error("Firestore getTodos ì‹¤íŒ¨:",e),Ms(e,"getTodos")}}),addTodo:async(t,e)=>kr(async()=>{try{if(!e||!t.title?.trim())throw new Error("User ID and todo title are required");const r=t.visibility?.isShared||!1,s=r?"shared_todos":`users/${e}/todos`,n=Re(Z,s);console.log("ğŸ“¤ addTodo called:",{isShared:r,collectionPath:s,sharedWith:t.sharedWith,sharedWithUids:t.sharedWith?.map(m=>m.uid)||[],sharedWithCount:t.sharedWith?.length||0,sharedGroupId:t.sharedGroupId,ownerId:e});const i=hr(t),o=t.sharedWith?t.sharedWith.map(m=>m.uid):[],l=t.sharedWith?t.sharedWith.filter(m=>m.permission==="edit"||m.permission==="admin").map(m=>m.uid):[];let c=t.sharedWith?t.sharedWith.filter(m=>m.permission==="admin").map(m=>m.uid):[];const d=t.sharedGroupId,u=t.sharedGroupOwnerId;if(r&&d&&u)try{const m=Me(Z,`users/${u}/sharing_groups`,d),x=await St(m);if(x.exists()){const p=(x.data().members||[]).filter(w=>w.permission==="admin").map(w=>w.uid);c=[...new Set([...c,...p])],console.log("ğŸ“‹ ê³µìœ  ê·¸ë£¹ admin í¬í•¨:",p)}}catch(m){console.warn("âš ï¸ ê³µìœ  ê·¸ë£¹ admin ì¡°íšŒ ì‹¤íŒ¨:",m)}c.includes(e)||c.push(e);const h={...i,ownerId:e,sharedWithUids:o,editorUids:l,adminUids:c,createdAt:Ae(),updatedAt:Ae()},g=await Lr(n,h);return ne.log(`Firestore addTodo ì„±ê³µ (${r?"Shared":"Private"}):`,g.id),g.id}catch(r){throw ne.error("Firestore addTodo ì‹¤íŒ¨:",r),Ms(r,"addTodo")}}),updateTodo:async(t,e,r)=>{let s=!1,n=!1;try{const i=Me(Z,`users/${r}/todos`,t),o=Me(Z,"shared_todos",t);ne.log(`Trying to read private todo: ${t} at ${i.path}`);const l=await St(i);let c;if(l.exists())s=!0;else try{ne.log(`Trying to read shared todo: ${t} at ${o.path}`),c=await St(o),n=c.exists()}catch(x){if(x.code==="permission-denied")ne.warn(`Shared todo permission denied (treated as not found): ${t}`),n=!1;else throw x}if(!s&&!n){ne.warn(`í• ì¼ ë¬¸ì„œ ${t}ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì—…ë°ì´íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.`);return}const d=s?i:o,u=s?l.data():c.data(),h=e.visibility,g=h?.isShared;if(s&&g===!0||n&&g===!1&&h!==void 0){const x=d,f=s?Me(Z,"shared_todos",t):Me(Z,`users/${r}/todos`,t),p=e.sharedWith?e.sharedWith.map(b=>b.uid):u.sharedWith?u.sharedWith.map(b=>b.uid):[],w=e.sharedWith?e.sharedWith.filter(b=>b.permission==="edit"||b.permission==="admin").map(b=>b.uid):u.sharedWith?u.sharedWith.filter(b=>b.permission==="edit"||b.permission==="admin").map(b=>b.uid):[],v={...u,...e,ownerId:u.ownerId||r,sharedWithUids:p,editorUids:w,adminUids:e.sharedWith?e.sharedWith.filter(b=>b.permission==="admin").map(b=>b.uid):u.sharedWith?u.sharedWith.filter(b=>b.permission==="admin").map(b=>b.uid):[],updatedAt:Ae()},k=Wt(Z);k.set(f,v),k.delete(x),await k.commit(),ne.log(`Todo migrated: ${s?"Private -> Shared":"Shared -> Private"}`)}else{const x={...e};e.sharedWith&&(x.sharedWithUids=e.sharedWith.map(w=>w.uid),x.editorUids=e.sharedWith.filter(w=>w.permission==="edit"||w.permission==="admin").map(w=>w.uid),x.adminUids=e.sharedWith.filter(w=>w.permission==="admin").map(w=>w.uid));const p={...hr(x),updatedAt:Ae()};n&&(p.lastModifiedBy=r),await kt(d,p),ne.log(`Firestore updateTodo ì„±ê³µ (${t})`)}}catch(i){throw ne.error("Firestore updateTodo ì‹¤íŒ¨:",{error:i,context:JSON.stringify({id:t,uid:r,targetPath:s?`users/${r}/todos/${t}`:`shared_todos/${t}`,isPrivate:s,isShared:n})}),i}},deleteTodo:async(t,e)=>{try{console.log("ğŸ—‘ï¸ deleteTodo ì‹œì‘:",{id:t,uid:e});const r=Me(Z,`users/${e}/todos`,t),s=Me(Z,"shared_todos",t);let n=0;(await St(r)).exists()&&(await Jt(r),console.log("âœ… ê°œì¸ í• ì¼ ì‚­ì œ ì™„ë£Œ:",t),n++);const o=await St(s);if(o.exists()){const l=o.data();let c=(l.adminUids||[]).includes(e);if(!c&&l.sharedGroupId&&l.sharedGroupOwnerId)try{const d=Me(Z,`users/${l.sharedGroupOwnerId}/sharing_groups`,l.sharedGroupId),u=await St(d);if(u.exists()&&(c=(u.data().members||[]).filter(m=>m.permission==="admin").some(m=>m.uid===e),c)){const m=[...new Set([...l.adminUids||[],e])];await kt(s,{adminUids:m}),console.log("ğŸ“‹ adminUids ì—…ë°ì´íŠ¸ë¨:",m)}}catch(d){console.warn("âš ï¸ ê·¸ë£¹ admin í™•ì¸ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰):",d)}if(l.ownerId===e||c){const d=l.visibility?.isPersonal===!0,u=l.ownerId!==e;d&&u?(await kt(s,{"visibility.isShared":!1,sharedWith:[],sharedWithUids:[],editorUids:[],adminUids:[l.ownerId],updatedAt:Ae()}),console.log("âœ… ê³µìœ  í•´ì œë¨ - ì†Œìœ ì ì „ìš©ìœ¼ë¡œ ë³€ê²½:",t)):(await Jt(s),console.log("âœ… ê³µìœ  í• ì¼ ì˜êµ¬ ì‚­ì œ ì™„ë£Œ (ì†Œìœ ì/ê´€ë¦¬ì):",t))}else{const d=(l.sharedWithUids||[]).filter(m=>m!==e),u=(l.sharedWith||[]).filter(m=>m.uid!==e),h=(l.editorUids||[]).filter(m=>m!==e),g=(l.adminUids||[]).filter(m=>m!==e);await kt(s,{sharedWithUids:d,sharedWith:u,editorUids:h,adminUids:g,updatedAt:Ae()}),console.log("âœ… ê³µìœ  í• ì¼ ë‚˜ê°€ê¸° ì™„ë£Œ (ë¹„ì†Œìœ ì):",t)}n++}n===0&&console.warn("âš ï¸ ì‚­ì œí•  í• ì¼ì„ Firestoreì—ì„œ ì°¾ì§€ ëª»í•¨ (ì´ë¯¸ ì‚­ì œë¨?):",t)}catch(r){throw console.error("âŒ Firestore deleteTodo ì‹¤íŒ¨:",r),r}},subscribeTodos:(t,e)=>{try{let r=[],s=[],n=()=>{};const i=()=>{const j=[...r,...s].sort((N,D)=>{const $=N.createdAt instanceof Date?N.createdAt.getTime():0;return(D.createdAt instanceof Date?D.createdAt.getTime():0)-$});e(j)},o=Re(Z,`users/${t}/todos`),l=new Date;l.setDate(l.getDate()-7);const c=He(o,We("completed","==",!1)),d=He(o,We("completed","==",!0),We("completedAt",">=",l));let u=[],h=[];const g=()=>{const j=[...u,...h],N=new Map;j.forEach(D=>N.set(D.id,D)),r=Array.from(N.values()),i()},m=j=>{const N=j.data();return{...N,id:j.id,createdAt:xe(N.createdAt)||new Date,updatedAt:xe(N.updatedAt)||new Date,dueDate:xe(N.dueDate),startDate:xe(N.startDate),completedAt:xe(N.completedAt),subTasks:N.subTasks?N.subTasks.map(D=>({...D,createdAt:xe(D.createdAt)||new Date,updatedAt:xe(D.updatedAt)||new Date,completedAt:D.completedAt?xe(D.completedAt):null})):[],myPermission:"admin"}},x=Ft(c,j=>{u=j.docs.map(m),g()},j=>console.error("âŒ Active Todos êµ¬ë… ì˜¤ë¥˜:",j)),f=Ft(d,j=>{h=j.docs.map(m),g()},j=>console.error("âŒ Recent Todos êµ¬ë… ì˜¤ë¥˜:",j)),p=()=>{x(),f()};let w=[],v=[],k=()=>{},b=()=>{};const T=()=>{const j=[...w,...v],N=new Map;j.forEach(D=>N.set(D.id,D)),s=Array.from(N.values()),i()},_=j=>{const N=j.data();let D="read";if(N.ownerId===t)D="admin";else if(N.sharedWith){const $=N.sharedWith.find(C=>C.uid===t);$&&(D=$.permission)}return{...N,id:j.id,createdAt:xe(N.createdAt)||new Date,updatedAt:xe(N.updatedAt)||new Date,dueDate:xe(N.dueDate),startDate:xe(N.startDate),completedAt:xe(N.completedAt),subTasks:N.subTasks?N.subTasks.map($=>({...$,createdAt:xe($.createdAt)||new Date,updatedAt:xe($.updatedAt)||new Date,completedAt:$.completedAt?xe($.completedAt):null})):[],myPermission:D}};try{const j=Re(Z,"shared_todos"),N=He(j,We("ownerId","==",t));k=Ft(N,$=>{w=$.docs.map(_),T()},$=>{console.error("âŒ ë‚´ ê³µìœ  í• ì¼ êµ¬ë… ì˜¤ë¥˜:",$)});const D=He(j,We("sharedWithUids","array-contains",t));b=Ft(D,$=>{v=$.docs.map(_),T()},$=>{console.error("âŒ ê³µìœ ë°›ì€ í• ì¼ êµ¬ë… ì˜¤ë¥˜:",$)}),n=()=>{k(),b()}}catch(j){console.error("âŒ ê³µìœ  í• ì¼ ì¿¼ë¦¬ ìƒì„± ì‹¤íŒ¨:",j)}return()=>{p(),n()}}catch(r){return console.error("âŒ Firestore subscribeTodos ì´ˆê¸°í™” ì‹¤íŒ¨:",r),e([]),()=>{}}},getCompletedTodos:async(t,e,r)=>{try{const s=Re(Z,`users/${t}/todos`),n=new Date(e);n.setHours(0,0,0,0);const i=new Date(r);i.setHours(23,59,59,999);const o=He(s,We("completed","==",!0),We("completedAt",">=",n),We("completedAt","<=",i));return(await Ge(o)).docs.map(c=>{const d=c.data();return{...d,id:c.id,createdAt:xe(d.createdAt)||new Date,updatedAt:xe(d.updatedAt)||new Date,dueDate:xe(d.dueDate),startDate:xe(d.startDate),completedAt:xe(d.completedAt),subTasks:d.subTasks?d.subTasks.map(u=>({...u,createdAt:xe(u.createdAt)||new Date,updatedAt:xe(u.updatedAt)||new Date,completedAt:u.completedAt?xe(u.completedAt):null})):[],myPermission:"admin"}})}catch(s){return console.error("âŒ getCompletedTodos ì‹¤íŒ¨:",s),[]}},addSubTask:async(t,e,r)=>{const s=Me(Z,`users/${e}/todos`,r);await kt(s,{subTasks:vx(t),updatedAt:Ae()})},updateSubTask:async(t,e,r,s)=>{const n=Me(Z,`users/${r}/todos`,s),i=await St(n);if(!i.exists())throw new Error("í• ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const c=(i.data().subTasks||[]).map(d=>d.id===t?{...d,...e,updatedAt:new Date}:d);await kt(n,{subTasks:c,updatedAt:Ae()})},deleteSubTask:async(t,e,r)=>{const s=Me(Z,`users/${e}/todos`,r),n=await St(s);if(!n.exists())throw new Error("í• ì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const l=(n.data().subTasks||[]).filter(c=>c.id!==t);await kt(s,{subTasks:l,updatedAt:Ae()})},getRecurringTemplates:async t=>{const e=Re(Z,`users/${t}/recurringTemplates`),r=He(e,Gt("createdAt","desc"));return(await Ge(r)).docs.map(n=>({id:n.id,...n.data(),createdAt:n.data().createdAt?.toDate()||new Date,updatedAt:n.data().updatedAt?.toDate()||new Date}))},addRecurringTemplate:async(t,e)=>{const r=Re(Z,`users/${e}/recurringTemplates`),n={...hr(t),createdAt:Ae(),updatedAt:Ae()};return(await Lr(r,n)).id},updateRecurringTemplate:async(t,e,r)=>{const s=Me(Z,`users/${r}/recurringTemplates`,t),n=hr(e);await kt(s,{...n,updatedAt:Ae()})},deleteRecurringTemplate:async(t,e)=>{const r=Wt(Z),s=Me(Z,`users/${e}/recurringTemplates`,t);r.delete(s);const n=Re(Z,`users/${e}/recurringInstances`),i=He(n,We("templateId","==",t));(await Ge(i)).forEach(l=>r.delete(l.ref)),await r.commit()},subscribeProjectTemplates:(t,e)=>{try{const r=Re(Z,`users/${t}/projectTemplates`),s=He(r,Gt("createdAt","desc"));return Ft(s,i=>{const o=i.docs.map(l=>{const c=l.data();return{id:l.id,...c,createdAt:xe(c.createdAt)||new Date,updatedAt:xe(c.updatedAt)||new Date}});e(o)},i=>{console.error("í”„ë¡œì íŠ¸ í…œí”Œë¦¿ êµ¬ë… ì˜¤ë¥˜:",i),e([])})}catch(r){return console.error("í”„ë¡œì íŠ¸ í…œí”Œë¦¿ êµ¬ë… ì´ˆê¸°í™” ì‹¤íŒ¨:",r),e([]),()=>{}}},addProjectTemplate:async(t,e)=>{const r=Re(Z,`users/${e}/projectTemplates`),n={...hr(t),createdAt:Ae(),updatedAt:Ae()};return(await Lr(r,n)).id},updateProjectTemplate:async(t,e,r)=>{const s=Me(Z,`users/${r}/projectTemplates`,t),n=hr(e);await kt(s,{...n,updatedAt:Ae()})},deleteProjectTemplate:async(t,e)=>{const r=Me(Z,`users/${e}/projectTemplates`,t);await Jt(r)},subscribeRecurringTemplates:(t,e)=>{const r=Re(Z,`users/${t}/recurringTemplates`),s=He(r,Gt("createdAt","desc"));return Ft(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:xe(o.data().createdAt)||new Date,updatedAt:xe(o.data().updatedAt)||new Date}));e(i)})},getRecurringInstances:async t=>{const e=Re(Z,`users/${t}/recurringInstances`),r=He(e,Gt("date","asc"));return(await Ge(r)).docs.map(n=>({id:n.id,...n.data(),date:xe(n.data().date)||new Date,createdAt:xe(n.data().createdAt)||new Date,updatedAt:xe(n.data().updatedAt)||new Date,completedAt:xe(n.data().completedAt)}))},addRecurringInstance:async(t,e)=>{const r=Re(Z,`users/${e}/recurringInstances`),s=hr(t);return(await Lr(r,{...s,createdAt:Ae(),updatedAt:Ae()})).id},updateRecurringInstance:async(t,e,r)=>{const s=Me(Z,`users/${r}/recurringInstances`,t),n=hr(e);await kt(s,{...n,updatedAt:Ae()})},deleteRecurringInstance:async(t,e)=>{const r=Me(Z,`users/${e}/recurringInstances`,t);await Jt(r)},subscribeRecurringInstances:(t,e)=>{const r=Re(Z,`users/${t}/recurringInstances`),s=new Date;s.setDate(s.getDate()-30);const n=He(r,We("completed","==",!1),Gt("date","asc")),i=He(r,We("completed","==",!0),We("date",">=",s),Gt("date","asc"));let o=[],l=[];const c=()=>{const g=[...o,...l];g.sort((m,x)=>{const f=m.date instanceof Date?m.date.getTime():0,p=x.date instanceof Date?x.date.getTime():0;return f-p}),e(g)},d=g=>({id:g.id,...g.data(),date:xe(g.data().date)||new Date,createdAt:xe(g.data().createdAt)||new Date,updatedAt:xe(g.data().updatedAt)||new Date,completedAt:xe(g.data().completedAt)}),u=Ft(n,g=>{o=g.docs.map(d),c()},g=>console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤(Active) êµ¬ë… ì˜¤ë¥˜:",g)),h=Ft(i,g=>{l=g.docs.map(d),c()},g=>console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤(Recent) êµ¬ë… ì˜¤ë¥˜:",g));return()=>{u(),h()}},async _isExceptionDate(t,e,r,s){if(s||!e.exceptions)return!1;for(const n of e.exceptions)switch(n.type){case"date":if(n.values.includes(t.getDate()))return!0;break;case"weekday":if(n.values.includes(t.getDay()))return!0;break;case"week":const i=Hv(t);if(n.values.includes(i)||n.values.includes(-1)&&Gv(t))return!0;break;case"month":if(n.values.includes(t.getMonth()+1))return!0;break;case"conflict":const o=n.values;for(const l of o)if(await this._hasConflictingInstance(t,e.id,l,r))return!0;break}return!1},async _hasConflictingInstance(t,e,r,s){const n=Re(Z,`users/${s}/recurringTemplates`),i=He(n,We("title","==",r.targetTemplateTitle)),l=(await Ge(i)).docs.find(u=>u.id!==e);if(!l)return!1;const c={id:l.id,...l.data()},d=await this.generateInstancesForTemplate(c,s,!0,[]);for(const u of d)if(Bv(t,u.date,r.scope))return ne.log(`[Conflict] ${t.toDateString()} on ${e} conflicts with ${c.title}`),!0;return!1},async generateInstancesForTemplate(t,e,r=!1,s=[]){if(!t.isActive)return[];const n=[],i=new Set,o=new Date,l=new Date(o);l.setFullYear(o.getFullYear()+1);let c=new Date(o.getFullYear(),o.getMonth(),1);for(;c<=l;){let d=null;if(t.recurrenceType==="daily")d=new Date(c);else if(t.recurrenceType==="weekly")c.getDay()===t.weekday&&(d=new Date(c));else if(t.recurrenceType==="monthly"){let u=null;if(t.monthlyPattern==="weekday"&&t.monthlyWeek&&t.monthlyWeekday!==void 0)u=zv(c.getFullYear(),c.getMonth()+1,t.monthlyWeek,t.monthlyWeekday);else{const h=t.monthlyDate;if(h===-1)u=new Date(c.getFullYear(),c.getMonth()+1,0);else if(h===-2)u=bm(c.getFullYear(),c.getMonth()+1);else if(h===-3)u=vm(c.getFullYear(),c.getMonth()+1);else if(h&&h>0){const g=new Date(c.getFullYear(),c.getMonth(),h);g.getMonth()===c.getMonth()&&(u=g)}}u&&u.getFullYear()===c.getFullYear()&&u.getMonth()===c.getMonth()&&(d=u)}if(d&&d>=new Date(new Date().setHours(0,0,0,0))){let u=Kv(d,t.holidayHandling,s);if(!await this._isExceptionDate(u,t,e,r)){const g=`${u.getFullYear()}-${(u.getMonth()+1).toString().padStart(2,"0")}-${u.getDate().toString().padStart(2,"0")}`;i.has(g)||(n.push({id:`${t.id}_${g}`,templateId:t.id,date:u,completed:!1,createdAt:new Date,updatedAt:new Date}),i.add(g))}}t.recurrenceType==="monthly"?(c.setMonth(c.getMonth()+1),c.setDate(1)):c.setDate(c.getDate()+1)}return n},async _copyCollection(t,e,r){const s=Re(Z,`users/${t}/${r}`),n=Re(Z,`users/${e}/${r}`),i=await Ge(s),o=Wt(Z);i.forEach(l=>{const c=l.data();o.set(Me(n,l.id),{...c,createdAt:c.createdAt||Ae(),updatedAt:Ae()})}),await o.commit()},async _deleteCollection(t,e){const r=Re(Z,`users/${t}/${e}`),s=await Ge(r),n=Wt(Z);s.forEach(i=>{n.delete(i.ref)}),await n.commit()},migrateUserData:async(t,e)=>kr(async()=>{try{if(!t||!e)throw new Error("Old UID and New UID are required for migration.");if(t===e)throw new Error("Cannot migrate data to the same UID.");ne.log(`Starting data migration from old UID: ${t} to new UID: ${e}`),await ee._copyCollection(t,e,"todos"),await ee._copyCollection(t,e,"recurringTemplates"),await ee._copyCollection(t,e,"recurringInstances"),await ee._copyCollection(t,e,"projectTemplates"),ne.log(`Deleting old data for UID: ${t}`),await ee._deleteCollection(t,"todos"),await ee._deleteCollection(t,"recurringTemplates"),await ee._deleteCollection(t,"recurringInstances"),await ee._deleteCollection(t,"projectTemplates"),ne.log(`User data migrated from ${t} to ${e}`)}catch(r){throw ne.error("Migration failed:",r),Ms(r,"migrateUserData")}}),sendSharingInvitation:async(t,e,r,s,n,i)=>kr(async()=>{try{ne.log("sendSharingInvitation: Sending invitation",{fromUser:t.email,toEmail:e,groupId:r,groupName:s});const o=Re(Z,"sharing_requests"),l=He(o,We("fromUid","==",t.uid),We("toEmail","==",e),We("groupId","==",r),We("status","==","pending"));if(!(await Ge(l)).empty)throw ne.log("sendSharingInvitation: Already invited"),new Error("Already invited this user to this group.");const d={fromUid:t.uid,fromEmail:t.email,toEmail:e,groupId:r,groupName:s,todoId:r,todoTitle:s,shareName:i||"",permission:n,status:"pending",createdAt:Ae()};ne.log("sendSharingInvitation: Creating request with data",d);const u=await Lr(o,d);return ne.log("sendSharingInvitation: Invitation sent successfully:",u.id),u.id}catch(o){throw ne.error("sendSharingInvitation: Failed to send invitation:",o),Ms(o,"sendSharingInvitation")}}),subscribeToIncomingInvitations:(t,e)=>{try{ne.log("subscribeToIncomingInvitations: Subscribing for email:",t);const r=Re(Z,"sharing_requests"),s=He(r,We("toEmail","==",t),We("status","==","pending"),Gt("createdAt","desc"));return Ft(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:xe(o.data().createdAt)||new Date}));ne.log("subscribeToIncomingInvitations: Received requests: "+i.length),e(i)},n=>{ne.error("subscribeToIncomingInvitations: Subscription error:",n),e([])})}catch(r){return ne.error("subscribeToIncomingInvitations: Failed to subscribe:",r),e([]),()=>{}}},subscribeToSentInvitations:(t,e)=>{try{const r=Re(Z,"sharing_requests"),s=He(r,We("fromUid","==",t),Gt("createdAt","desc"));return Ft(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:xe(o.data().createdAt)||new Date}));e(i)},n=>{ne.error("Sent invitation subscription error:",n),e([])})}catch(r){return ne.error("Failed to subscribe sent invitations:",r),e([]),()=>{}}},respondToInvitation:async(t,e,r)=>{try{console.log("ğŸ“© respondToInvitation called:",{requestId:t,response:e,currentUser:r.email});const s=Me(Z,"sharing_requests",t),n=await St(s);if(!n.exists())throw console.error("âŒ Invitation not found:",t),new Error("Invitation not found");const i=n.data();if(console.log("ğŸ“„ Request data:",i),i.toEmail.toLowerCase()!==r.email.toLowerCase())throw console.error("âŒ Not authorized:",i.toEmail,"!==",r.email),new Error("Not authorized to respond to this invitation");if(await kt(s,{status:e,respondedAt:Ae()}),console.log("âœ… Request status updated to:",e),e==="accepted"){const o=i.groupId||i.todoId,l=i.fromUid;console.log("ğŸ‘¥ Adding user to group:",{groupId:o,groupOwnerId:l});const c=Me(Z,`users/${l}/sharing_groups`,o),d=await St(c);if(d.exists()){const u=d.data(),h=u.members||[];if(h.some(m=>m.uid===r.uid))console.log("â„¹ï¸ User already in group");else{const m={uid:r.uid,email:r.email,displayName:r.displayName||"",permission:i.permission||"edit"};await kt(c,{members:[...h,m],updatedAt:Ae()}),console.log("âœ… Member added to owner group:",r.email)}const g=Me(Z,`users/${r.uid}/sharing_groups`,`ref_${o}`);await bn(g,{name:u.name,isReference:!0,originalGroupId:o,originalOwnerId:l,originalOwnerEmail:i.fromEmail,members:[...h,{uid:r.uid,email:r.email,displayName:r.displayName||"",permission:i.permission||"edit"}],createdAt:Ae(),updatedAt:Ae()}),console.log("âœ… Reference group created in my account")}else console.error("âŒ Group not found:",o)}}catch(s){throw console.error("âŒ Failed to respond invitation:",s),s}},regenerateRecurringInstances:async(t,e)=>kr(async()=>{try{if(!e||!t)throw new Error("User ID and template ID are required");ne.log("ì§€ëŠ¥í˜• ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹œì‘",{templateId:t,uid:e});const r=Re(Z,`users/${e}/recurringInstances`),s=Me(Z,`users/${e}/recurringTemplates`,t),n=He(r,We("templateId","==",t)),i=await Ge(n),o=new Map;i.forEach(f=>{o.set(f.id,f.data())}),ne.log("ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ ë³´ì¡´ ì™„ë£Œ",{count:o.size});const l=await St(s);if(!l.exists())throw new Error(`Template ${t} not found`);const c={id:l.id,...l.data()},d=Re(Z,`users/${e}/custom_holidays`),h=(await Ge(d)).docs.map(f=>{const p=f.data();return{id:f.id,date:p.date,name:p.name,isRecurring:p.isRecurring,createdAt:p.createdAt}}),g=await ee.generateInstancesForTemplate(c,e,!1,h);ne.log("ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ",{count:g.length});const m=Wt(Z),x=new Set;g.forEach(f=>{const p=Me(r,f.id),w=o.get(f.id);w?(x.add(f.id),m.update(p,{...f,completed:w.completed||!1,completedAt:w.completedAt||null,skipped:w.skipped||!1,skippedReason:w.skippedReason||null,updatedAt:Ae()})):(x.add(f.id),m.set(p,{...f,createdAt:Ae(),updatedAt:Ae()}))}),o.forEach((f,p)=>{if(!x.has(p)){const w=xe(f.date),v=new Date;v.setHours(0,0,0,0),f.completed||w&&w>=v?(m.delete(Me(r,p)),ne.log("ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ (ì™„ë£Œë¨ ë˜ëŠ” ë¯¸ë˜)",{id:p})):ne.log("ìœ íš¨í•˜ì§€ ì•Šì§€ë§Œ ê³¼ê±°ì˜ ë¯¸ì™„ë£Œëœ ì¸ìŠ¤í„´ìŠ¤ ë³´ì¡´",{id:p})}}),await m.commit(),ne.log("ì§€ëŠ¥í˜• ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì„±ê³µ",{templateId:t})}catch(r){throw ne.error("ì§€ëŠ¥í˜• ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",r),Ms(r,"regenerateRecurringInstances")}}),getUserSettings:async t=>kr(async()=>{try{const e=Me(Z,"users",t),r=await St(e);return r.exists()?r.data():null}catch(e){throw ne.error("Firestore getUserSettings ì‹¤íŒ¨:",e),e}}),updateUserLanguage:async(t,e)=>kr(async()=>{try{const r=Me(Z,"users",t);await bn(r,{language:e,updatedAt:Ae()},{merge:!0}),ne.log(`User ${t} language updated to ${e}`)}catch(r){throw ne.error("Firestore updateUserLanguage ì‹¤íŒ¨:",r),r}}),updateGoogleTasksSettings:async(t,e)=>kr(async()=>{try{const r=Me(Z,"users",t),s={updatedAt:Ae()};e.linked!==void 0&&(s.googleTasksLinked=e.linked),e.autoSync!==void 0&&(s.autoSyncGoogleTasks=e.autoSync),await bn(r,s,{merge:!0}),ne.log(`User ${t} Google Tasks settings updated:`,e)}catch(r){throw ne.error("Firestore updateGoogleTasksSettings ì‹¤íŒ¨:",r),r}}),checkAndCreateUser:async t=>{if(!t.uid)return;const e=Me(Z,"users",t.uid);try{await bn(e,{email:t.email,displayName:t.displayName,lastLoginAt:Ae(),updatedAt:Ae()},{merge:!0})}catch(r){ne.error("Failed to update user profile",r)}},findUserByEmail:async t=>{try{if(!t)return null;ne.log("findUserByEmail: Searching for email:",t);const e=Re(Z,"users"),r=He(e,We("email","==",t),Pd(1)),s=await Ge(r);if(ne.log("findUserByEmail: Found docs:",s.size),s.empty)return ne.log("findUserByEmail: No user found with email:",t),null;const n=s.docs[0].data();return ne.log("findUserByEmail: User found:",n),{uid:s.docs[0].id,email:n.email,displayName:n.displayName||"",permission:"read"}}catch(e){return ne.error("Failed to find user by email",e),null}},updateUserStartScreen:async(t,e)=>kr(async()=>{try{const r=Me(Z,"users",t);await bn(r,{startScreen:e,updatedAt:Ae()},{merge:!0}),ne.log(`User ${t} startScreen updated to ${e}`)}catch(r){throw ne.error("Firestore updateUserStartScreen ì‹¤íŒ¨:",r),r}}),subscribeSharingGroups:(t,e)=>{try{const r=Re(Z,`users/${t}/sharing_groups`),s=He(r,Gt("createdAt","desc"));return Ft(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:xe(o.data().createdAt)||new Date}));e(i)},n=>{ne.error("Sharing groups subscription error:",n),e([])})}catch(r){return ne.error("Failed to subscribe sharing groups:",r),e([]),()=>{}}},createSharingGroup:async(t,e)=>{try{const r=Re(Z,`users/${t}/sharing_groups`),s=await Lr(r,{name:e.name,members:e.members,createdAt:Ae(),updatedAt:Ae()});return ne.log("Sharing group created:",s.id),s.id}catch(r){throw ne.error("Failed to create sharing group:",r),r}},updateSharingGroup:async(t,e,r)=>{try{console.log("ğŸ”„ updateSharingGroup ì‹œì‘:",{uid:t,groupId:e,updates:r});const s=Me(Z,`users/${t}/sharing_groups`,e),n=await St(s),i=n.exists()?n.data().members||[]:[];if(console.log("ğŸ“‹ ê¸°ì¡´ ë©¤ë²„:",i.map(o=>({uid:o.uid,permission:o.permission}))),await kt(s,{...r,updatedAt:Ae()}),console.log("âœ… ì†Œìœ ì ê·¸ë£¹ ì—…ë°ì´íŠ¸ ì™„ë£Œ:",e),r.members){console.log("ğŸ“ ì—…ë°ì´íŠ¸í•  ë©¤ë²„:",r.members.map(h=>({uid:h.uid,permission:h.permission})));const o=Re(Z,"shared_todos"),l=He(o,We("sharedGroupId","==",e),We("ownerId","==",t)),c=await Ge(l);if(c.docs.length>0){const h=r.members.filter(p=>p.permission==="edit"||p.permission==="admin").map(p=>p.uid),g=r.members.filter(p=>p.permission==="admin").map(p=>p.uid),m=r.members.map(p=>p.uid),x=r.members.map(p=>({uid:p.uid,email:p.email,displayName:p.displayName,permission:p.permission})),f=Wt(Z);c.docs.forEach(p=>{f.update(p.ref,{sharedWith:x,sharedWithUids:m,editorUids:h,adminUids:g,updatedAt:Ae()})}),await f.commit(),console.log(`âœ… ${c.docs.length}ê°œì˜ ê³µìœ  í• ì¼ ê¶Œí•œ ë™ê¸°í™”ë¨`)}const u=[...new Set([...i.map(h=>h.uid),...r.members.map(h=>h.uid)])].filter(h=>h!==t).map(async h=>{try{const g=Me(Z,`users/${h}/sharing_groups`,`ref_${e}`);await kt(g,{...r,updatedAt:Ae()}),console.log(`âœ… ë©¤ë²„ ${h}ì˜ ê·¸ë£¹ ì°¸ì¡° ì—…ë°ì´íŠ¸ë¨ (ref_${e})`)}catch(g){g.code==="not-found"?console.log(`â„¹ï¸ ë©¤ë²„ ${h}ì˜ ê·¸ë£¹ ì°¸ì¡°ê°€ ì—†ìŒ (ì´ˆëŒ€ ìˆ˜ë½ ì „)`):console.warn(`âš ï¸ ë©¤ë²„ ${h}ì˜ ê·¸ë£¹ ì°¸ì¡° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`,g.message)}});await Promise.allSettled(u)}}catch(s){throw ne.error("Failed to update sharing group:",s),s}},deleteSharingGroup:async(t,e)=>{try{console.log("ğŸ—‘ï¸ Deleting sharing group:",e);const r=Me(Z,`users/${t}/sharing_groups`,e),s=await St(r);if(!s.exists()){console.warn("âŒ Group not found for deletion:",e);return}const o=(s.data().members||[]).filter(l=>l.uid!==t).map(async l=>{try{const c=`users/${l.uid}/sharing_groups/ref_${e}`;await Jt(Me(Z,c)),console.log("âœ… Deleted reference for member:",l.email)}catch(c){console.warn(`âš ï¸ Failed to delete reference for ${l.email} (likely permission issue):`,c)}});await Promise.allSettled(o);try{const l=Re(Z,"shared_todos"),c=He(l,We("sharedGroupId","==",e),We("ownerId","==",t)),d=await Ge(c);if(d.docs.length>0){const u=Wt(Z);d.docs.forEach(h=>{u.update(h.ref,{sharedGroupId:Md(),sharedGroupName:Md(),sharedWith:[],sharedWithUids:[],editorUids:[],adminUids:[],"visibility.isShared":!1,updatedAt:Ae()})}),await u.commit(),console.log(`âœ… Unshared ${d.docs.length} todos associated with group.`)}}catch(l){console.warn("âš ï¸ Failed to unshare some todos (continuing with group deletion):",l)}try{await Jt(r),console.log("âœ… Sharing group deleted:",e)}catch(l){throw ne.error("Failed to delete group document:",l),l}}catch(r){throw ne.error("Failed to delete sharing group:",r),r}},processAcceptedInvitation:async t=>{const{id:e,groupId:r,fromUid:s,toEmail:n,permission:i}=t;console.log("ğŸ”„ Processing accepted invitation:",e);try{const o=await ee.findUserByEmail(n);if(!o){console.warn("âŒ ì´ˆëŒ€ë¥¼ ìˆ˜ë½í•œ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:",n);return}const l={...o,permission:i},c=Me(Z,`users/${s}/sharing_groups`,r),d=await St(c);if(d.exists()){const p=d.data().members||[];if(!p.some(w=>w.uid===o.uid)){const w=[...p,l];await kt(c,{members:w,updatedAt:Ae()}),console.log("âœ… ê·¸ë£¹ ë©¤ë²„ ì¶”ê°€ ì™„ë£Œ:",r,o.uid)}}else{console.warn("âš ï¸ ê·¸ë£¹ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ (ì‚­ì œë˜ì—ˆì„ ìˆ˜ ìˆìŒ):",r),await Jt(Me(Z,"sharing_requests",e));return}const u=Re(Z,"shared_todos"),h=He(u,We("sharedGroupId","==",r)),g=await Ge(h),m=Wt(Z);let x=0;g.docs.forEach(f=>{const p=f.data(),w=p.sharedWith||[];if(!w.some(v=>v.uid===o.uid)){const v=[...w,l],k=[...p.sharedWithUids||[],o.uid],b={sharedWith:v,sharedWithUids:k,updatedAt:Ae()};(i==="edit"||i==="admin")&&(b.editorUids=[...p.editorUids||[],o.uid]),i==="admin"&&(b.adminUids=[...p.adminUids||[],o.uid]),m.update(f.ref,b),x++}}),x>0&&(await m.commit(),console.log(`âœ… ${x}ê°œì˜ ê³µìœ  í• ì¼ì— ìƒˆ ë©¤ë²„ ì¶”ê°€ ì™„ë£Œ`)),await Jt(Me(Z,"sharing_requests",e)),console.log("âœ… ì´ˆëŒ€ ìš”ì²­ ì²˜ë¦¬ ì™„ë£Œ ë° ì‚­ì œ:",e)}catch(o){throw console.error("âŒ processAcceptedInvitation ì‹¤íŒ¨:",o),o}},leaveSharingGroup:async(t,e)=>{try{console.log("ğŸšª leaveSharingGroup ì‹œì‘:",{uid:t,groupId:e});const r=Re(Z,"shared_todos"),s=He(r,We("sharedGroupId","==",e),We("sharedWithUids","array-contains",t)),n=await Ge(s),i=Wt(Z);let o=0;n.docs.forEach(c=>{const d=c.data(),u=(d.sharedWith||[]).filter(x=>x.uid!==t),h=(d.sharedWithUids||[]).filter(x=>x!==t),g=(d.editorUids||[]).filter(x=>x!==t),m=(d.adminUids||[]).filter(x=>x!==t);i.update(c.ref,{sharedWith:u,sharedWithUids:h,editorUids:g,adminUids:m,updatedAt:Ae()}),o++}),o>0&&(await i.commit(),console.log(`âœ… ${o}ê°œì˜ ê³µìœ  í• ì¼ì—ì„œ ë‚˜ê°€ê¸° ì²˜ë¦¬ë¨.`));const l=Me(Z,`users/${t}/sharing_groups`,e);await Jt(l),console.log("âœ… ê³µìœ  ê·¸ë£¹ ëª©ë¡ì—ì„œ ì‚­ì œ ì™„ë£Œ:",e)}catch(r){throw console.error("âŒ leaveSharingGroup ì‹¤íŒ¨:",r),r}},sendPermissionChangeNotification:async(t,e,r,s,n,i)=>{try{const o=Re(Z,"sharing_notifications"),l={type:"permission_change",targetUid:e,fromUid:t.uid,fromEmail:t.email,groupId:r,groupName:s,previousPermission:n,newPermission:i,createdAt:Ae(),read:!1},c=await Lr(o,l);return console.log("âœ… ê¶Œí•œ ë³€ê²½ ì•Œë¦¼ ë°œì†¡:",c.id),c.id}catch(o){throw console.error("âŒ ê¶Œí•œ ë³€ê²½ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨:",o),o}},subscribeToSharingNotifications:(t,e)=>{const r=Re(Z,"sharing_notifications"),s=He(r,We("targetUid","==",t),Gt("createdAt","desc"),Pd(50));return Ft(s,n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),createdAt:xe(o.data().createdAt)||new Date}));e(i)})},markNotificationAsRead:async t=>{try{const e=Me(Z,"sharing_notifications",t);await kt(e,{read:!0}),console.log("âœ… ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬:",t)}catch(e){throw console.error("âŒ ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:",e),e}},deleteNotification:async t=>{try{const e=Me(Z,"sharing_notifications",t);await Jt(e),console.log("âœ… ì•Œë¦¼ ì‚­ì œ:",t)}catch(e){throw console.error("âŒ ì•Œë¦¼ ì‚­ì œ ì‹¤íŒ¨:",e),e}}},zm=y.createContext(void 0),Yv=({children:t})=>{const[e,r]=y.useState(null),[s,n]=y.useState(null),[i,o]=y.useState(null),[l,c]=y.useState(!0),[d,u]=y.useState(!1);y.useEffect(()=>{if(!jt){console.log("Auth: Firebase disabled, using localStorage only"),c(!1);return}const b=wx(jt,T=>{T?(r({uid:T.uid,email:T.email,displayName:T.displayName,photoURL:T.photoURL,isAnonymous:T.isAnonymous}),!T.isAnonymous&&T.email&&ee.checkAndCreateUser({uid:T.uid,email:T.email,displayName:T.displayName}).catch(_=>console.error("User profile sync failed:",_)),u(T.isAnonymous)):(r(null),u(!1),n(null),o(null),sessionStorage.removeItem("google_access_token"),sessionStorage.removeItem("google_token_expiration")),c(!1)});return()=>b()},[]),y.useEffect(()=>{typeof window<"u"&&(window.authContext={signInWithGoogle:p})},[]);const h=async()=>{console.log("Auth: Use signInWithGoogle or signIn instead")},g=async()=>{if(jt){if(await _x(jt),Ke.isNativePlatform())try{await fo.signOut()}catch(b){console.log("GoogleAuth signOut failed (maybe not signed in)",b)}n(null),o(null),sessionStorage.removeItem("google_access_token"),sessionStorage.removeItem("google_token_expiration")}else r(null)},m=async()=>{jt?await jx(jt):(r({uid:"local-user",email:null,displayName:"Local User",photoURL:null,isAnonymous:!0}),u(!0))},x=async(b,T)=>{jt?await Sx(jt,b,T):console.log("Auth: SignIn not available in localStorage mode",{email:b,password:T})},f=async(b,T,_)=>{if(jt){const j=await Tx(jt,b,T);_&&j.user&&await Nx(j.user,{displayName:_})}else console.log("Auth: SignUp not available in localStorage mode",{email:b,password:T,displayName:_})},p=async()=>{if(!jt)throw new Error("Firebase ì¸ì¦ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");try{if(Ke.isNativePlatform()){console.log("Starting Native Google Sign-In (Capacitor Firebase)...");const b=await fo.signInWithGoogle({scopes:["https://www.googleapis.com/auth/tasks"]});console.log("FirebaseAuthentication Result:",JSON.stringify(b));const T=b.credential?.accessToken;if(alert(`Native Login Token Check:
AccessToken: ${T?T.substring(0,10)+"...":"undefined"}
IdToken: ${b.credential?.idToken?"Yes":"No"}`),T){n(T);const N=3500*1e3;o(Date.now()+N)}const _=En.credential(b.credential?.idToken),j=await kx(jt,_);return console.log("Mobile Google Sign-In Success:",j.user),j.user}else{if(!ks)throw new Error("Google Provider missing");const b=await Od(jt,ks);console.log("êµ¬ê¸€ ë¡œê·¸ì¸ ì„±ê³µ:",b.user);const _=En.credentialFromResult(b)?.accessToken;if(_){n(_);const j=3500*1e3,N=Date.now()+j;o(N),sessionStorage.setItem("google_access_token",_),sessionStorage.setItem("google_token_expiration",N.toString())}return b.user}}catch(b){throw console.error("êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨:",b),b.code==="auth/popup-closed-by-user"||b.code==="auth/cancelled-popup-request"?new Error("ë¡œê·¸ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."):b.code==="auth/network-request-failed"?new Error("ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”."):new Error("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: "+(b.message||JSON.stringify(b)))}},k={currentUser:e,loading:l,isAnonymous:d,login:h,logout:g,loginAnonymously:m,signIn:x,signUp:f,signInWithGoogle:p,signInAsGuest:async()=>{await m()},getGoogleAccessToken:async b=>{if(!jt)throw new Error("Firebase Auth not initialized");const T=Date.now();if(s&&i&&T<i)return s;const _=sessionStorage.getItem("google_access_token"),j=sessionStorage.getItem("google_token_expiration");if(_&&j){const N=parseInt(j,10);if(T<N)return n(_),o(N),_;console.log("âš ï¸ Cached token expired. Clearing..."),sessionStorage.removeItem("google_access_token"),sessionStorage.removeItem("google_token_expiration")}if(b?.silent)return null;try{if(Ke.isNativePlatform()){if(s&&i&&Date.now()<i)return s;console.log("Native Token Expired or Missing. Attempting silent re-auth...");try{const N=await fo.signInWithGoogle({scopes:["https://www.googleapis.com/auth/tasks"]});if(N.credential?.accessToken)return n(N.credential.accessToken),o(Date.now()+3500*1e3),N.credential.accessToken}catch(N){console.error("Failed to refresh native token",N)}return null}else{const N=new En;N.addScope("https://www.googleapis.com/auth/tasks"),N.setCustomParameters({prompt:"consent"});const D=await Od(jt,N),$=En.credentialFromResult(D),C=$?.accessToken||null;if(C){const B=Date.now()+35e5;n(C),o(B),sessionStorage.setItem("google_access_token",C),sessionStorage.setItem("google_token_expiration",B.toString())}return console.log("ğŸ”‘ Google Auth Result:",{user:D.user.email,providerId:D.providerId,credentialScopes:$?.scope,accessToken:C?"Present (Hidden)":"Missing"}),C}}catch(N){throw console.error("Error getting Google Access Token:",N),N}}};return a.jsx(zm.Provider,{value:k,children:t})},wt=()=>{const t=y.useContext(zm);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},vo={cleanupOrphanedInstances:async t=>{try{console.log("ğŸ§¹ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹œì‘");const e=Re(Z,`users/${t}/recurringTemplates`),r=await Ge(e),s=new Set;r.forEach(u=>{s.add(u.id)}),console.log(`í™œì„± í…œí”Œë¦¿: ${s.size}ê°œ`);const n=Re(Z,`users/${t}/recurringInstances`),i=await Ge(n),o=[];i.forEach(u=>{const h=u.data();s.has(h.templateId)||(o.push(u.id),console.log(`ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ ë°œê²¬: ${u.id} (í…œí”Œë¦¿: ${h.templateId})`))});const l=Re(Z,`users/${t}/todos`),c=await Ge(l),d=[];if(c.forEach(u=>{const h=u.data();h._templateId&&!s.has(h._templateId)&&(d.push(u.id),console.log(`ê³ ì•„ í• ì¼ ë°œê²¬: ${h.title} (í…œí”Œë¦¿: ${h._templateId})`))}),o.length>0||d.length>0){const u=Wt(Z);o.forEach(h=>{const g=Me(Z,`users/${t}/recurringInstances`,h);u.delete(g)}),d.forEach(h=>{const g=Me(Z,`users/${t}/todos`,h);u.delete(g)}),await u.commit(),console.log(`âœ… ì •ë¦¬ ì™„ë£Œ: ì¸ìŠ¤í„´ìŠ¤ ${o.length}ê°œ, í• ì¼ ${d.length}ê°œ`)}else console.log("âœ… ì •ë¦¬í•  ê³ ì•„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");return{orphanedInstances:o.length,orphanedTodos:d.length,totalCleaned:o.length+d.length}}catch(e){throw console.error("âŒ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹¤íŒ¨:",e),e}},validateTemplateConsistency:async t=>{try{console.log("ğŸ” í…œí”Œë¦¿ ë°ì´í„° ì •í•©ì„± í™•ì¸ ì‹œì‘");const e=Re(Z,`users/${t}/recurringTemplates`),r=await Ge(e),s=Re(Z,`users/${t}/recurringInstances`),n=await Ge(s),i=Re(Z,`users/${t}/todos`),o=await Ge(i),l=new Map;return r.forEach(c=>{const d=c.data();l.set(c.id,{templateTitle:d.title,instances:0,todos:0,isActive:d.isActive!==!1})}),n.forEach(c=>{const u=c.data().templateId;l.has(u)&&l.get(u).instances++}),o.forEach(c=>{const u=c.data()._templateId;u&&l.has(u)&&l.get(u).todos++}),console.log(`
ğŸ“Š í…œí”Œë¦¿ë³„ ë°ì´í„° í˜„í™©:`),console.log("=".repeat(60)),l.forEach((c,d)=>{console.log(`${c.templateTitle} (${d}):`),console.log(`  í™œì„±: ${c.isActive}`),console.log(`  ì¸ìŠ¤í„´ìŠ¤: ${c.instances}ê°œ`),console.log(`  í• ì¼: ${c.todos}ê°œ`),c.instances>0&&c.todos===0&&console.log("  âš ï¸ ë¬¸ì œ: ì¸ìŠ¤í„´ìŠ¤ë§Œ ìˆê³  ì‹¤ì œ í• ì¼ ì—†ìŒ"),console.log("")}),l}catch(e){throw console.error("âŒ ë°ì´í„° ì •í•©ì„± í™•ì¸ ì‹¤íŒ¨:",e),e}},regenerateAllInstances:async t=>{try{console.log("ğŸ”„ ì „ì²´ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹œì‘");const e=Re(Z,`users/${t}/recurringInstances`),r=await Ge(e),s=Wt(Z);r.forEach(n=>{s.delete(n.ref)}),await s.commit(),console.log(`âœ… ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ ${r.size}ê°œ ì‚­ì œ ì™„ë£Œ`),console.log("ğŸ’¡ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ í™œì„± í…œí”Œë¦¿ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìë™ ì¬ìƒì„±ë©ë‹ˆë‹¤")}catch(e){throw console.error("âŒ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",e),e}},smartCleanupInstances:async t=>{try{console.log("ğŸ§¹ ìŠ¤ë§ˆíŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹œì‘"),console.log("ì™„ë£Œëœ ì¸ìŠ¤í„´ìŠ¤ì™€ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì •ë¦¬í•©ë‹ˆë‹¤...");const e=Re(Z,`users/${t}/recurringTemplates`),r=await Ge(e),s=new Set;r.forEach(c=>{const d=c.data();d.isActive!==!1&&(s.add(c.id),console.log(`í™œì„± í…œí”Œë¦¿: ${d.title} (${c.id})`))}),console.log(`í™œì„± í…œí”Œë¦¿: ${s.size}ê°œ`),console.log("2ï¸âƒ£ ì •ë¦¬ ëŒ€ìƒ ì¸ìŠ¤í„´ìŠ¤ ê²€ìƒ‰ ì¤‘...");const n=Re(Z,`users/${t}/recurringInstances`),i=await Ge(n),o=[],l=[];if(i.forEach(c=>{const d=c.data(),u=d.templateId,h=d.completed===!0;!s.has(u)?o.push(c.id):l.push(c.id)}),console.log(`ğŸ“Š ì •ë¦¬ ê²°ê³¼: ì‚­ì œ ${o.length}ê°œ, ìœ ì§€ ${l.length}ê°œ`),o.length>0){console.log("3ï¸âƒ£ ì„ ë³„ëœ ì¸ìŠ¤í„´ìŠ¤ë“¤ ì‚­ì œ ì¤‘...");const c=[];let d=Wt(Z),u=0;o.forEach(h=>{const g=Me(Z,`users/${t}/recurringInstances`,h);d.delete(g),u++,u>=500&&(c.push(d),d=Wt(Z),u=0)}),u>0&&c.push(d);for(let h=0;h<c.length;h++)await c[h].commit(),console.log(`ë°°ì¹˜ ${h+1}/${c.length} ì‚­ì œ ì™„ë£Œ`);console.log(`âœ… ì´ ${o.length}ê°œ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ ì™„ë£Œ`)}else console.log("ì‚­ì œí•  ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤");return console.log("âœ… ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì™„ë£Œ!"),console.log(`- í™œì„± í…œí”Œë¦¿: ${s.size}ê°œ`),console.log(`- ì‚­ì œëœ ì¸ìŠ¤í„´ìŠ¤: ${o.length}ê°œ`),console.log(`- ìœ ì§€ëœ ì¸ìŠ¤í„´ìŠ¤: ${l.length}ê°œ`),console.log(`- ì´ ì¸ìŠ¤í„´ìŠ¤: ${i.size}ê°œ`),{activeTemplates:s.size,deletedInstances:o.length,keptInstances:l.length,totalInstances:i.size}}catch(e){throw console.error("âŒ ëŒ€ëŸ‰ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ ì‹¤íŒ¨:",e),e}}},Km=y.createContext(void 0),qv=({children:t})=>{const[e,r]=y.useState([]),[s,n]=y.useState(!0),{currentUser:i}=wt();y.useEffect(()=>{if(!i){r([]),n(!1);return}const d=He(Re(Z,`users/${i.uid}/custom_holidays`),Gt("date","asc")),u=Ft(d,h=>{const g=h.docs.map(m=>({id:m.id,...m.data()}));r(g),n(!1)},h=>{console.error("Error fetching custom holidays:",h),n(!1)});return()=>u()},[i]);const o=async(d,u,h=!1)=>{if(i)try{await Lr(Re(Z,`users/${i.uid}/custom_holidays`),{date:d,name:u,isRecurring:h,createdAt:Ae()})}catch(g){throw console.error("Error adding custom holiday:",g),g}},l=async d=>{if(i)try{await Jt(Me(Z,`users/${i.uid}/custom_holidays`,d))}catch(u){throw console.error("Error deleting custom holiday:",u),u}},c=d=>e.find(u=>{const h=new Date(u.date);h.setHours(0,0,0,0);const g=new Date(d);return g.setHours(0,0,0,0),h.getTime()===g.getTime()});return a.jsx(Km.Provider,{value:{customHolidays:e,addCustomHoliday:o,deleteCustomHoliday:l,getCustomHoliday:c,loading:s},children:t})},sn=()=>{const t=y.useContext(Km);if(t===void 0)throw new Error("useCustomHolidays must be used within a CustomHolidayProvider");return t},Cs="https://www.googleapis.com/tasks/v1",ts={async getTaskLists(t){try{const e=await fetch(`${Cs}/users/@me/lists`,{method:"GET",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!e.ok){let s="";try{const n=await e.json();s=JSON.stringify(n),console.error("Google Tasks API Error Details:",n)}catch{s="Could not parse error response"}throw new Error(`Failed to fetch task lists: ${e.status} ${e.statusText} - ${s}`)}return(await e.json()).items||[]}catch(e){throw ne.error("Error fetching Google Task lists:",e),e}},async getTasksFromList(t,e){try{const r=new Date;r.setDate(r.getDate()-30);const s=r.toISOString(),n=await fetch(`${Cs}/lists/${e}/tasks?showHidden=true&showDeleted=true&updatedMin=${s}`,{method:"GET",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Failed to fetch tasks from list ${e}: ${n.statusText}`);return(await n.json()).items||[]}catch(r){throw ne.error("Error fetching Google Tasks:",r),r}},async getAllTasks(t){const e=await this.getTaskLists(t),r=[];for(const s of e){const n=await this.getTasksFromList(t,s.id);n.length>0&&r.push({listName:s.title,listId:s.id,tasks:n})}return r},async updateTask(t,e,r,s){try{const n={...s};n.due&&n.due.includes(".")&&(n.due=n.due.split(".")[0]+"Z");const i=await fetch(`${Cs}/lists/${e}/tasks/${r}`,{method:"PATCH",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const o=await i.json().catch(()=>({}));return console.error("Failed to update Google Task:",i.status,o),null}return await i.json()}catch(n){return ne.error("Error updating Google Task:",n),window.location.protocol.includes("http")===!1||window.location.hostname,null}},async updateTaskStatus(t,e,r,s){return this.updateTask(t,e,r,{status:s?"completed":"needsAction",completed:s?new Date().toISOString():null})},async deleteTask(t,e,r){try{const s=await fetch(`${Cs}/lists/${e}/tasks/${r}`,{method:"DELETE",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return s.ok?!0:(console.error("Failed to delete Google Task:",s.status),!1)}catch(s){return ne.error("Error deleting Google Task:",s),!1}},async insertTask(t,e,r){try{const s={...r};s.due&&s.due.includes(".")&&(s.due=s.due.split(".")[0]+"Z");const n=await fetch(`${Cs}/lists/${e}/tasks`,{method:"POST",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok){const i=await n.json().catch(()=>({}));return console.error("Failed to insert Google Task:",n.status,i),null}return await n.json()}catch(s){return ne.error("Error inserting Google Task:",s),null}},async moveTask(t,e,r,s,n){try{const i=new URLSearchParams;s&&i.append("parent",s),n&&i.append("previous",n);const o=await fetch(`${Cs}/lists/${e}/tasks/${r}/move?${i.toString()}`,{method:"POST",referrerPolicy:"no-referrer",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!o.ok){const l=await o.json().catch(()=>({}));return console.error("Failed to move Google Task:",o.status,l),null}return await o.json()}catch(i){return ne.error("Error moving Google Task:",i),null}}},Pn={_recentIds:new Set,register:t=>{Pn._recentIds.add(t),setTimeout(()=>{Pn._recentIds.delete(t)},6e4)},has:t=>Pn._recentIds.has(t)},Ym=y.createContext(void 0),Xv={todos:[],recurringTemplates:[],recurringInstances:[],sharingGroups:[],loading:!1,error:null,syncing:!1,fetchedMonths:new Set};function Qv(t,e){switch(e.type){case"SET_LOADING":return{...t,loading:e.payload};case"SET_SYNCING":return{...t,syncing:e.payload};case"SET_ERROR":return{...t,error:e.payload};case"SET_TODOS":const r=e.payload,s=new Set(r.map(h=>h.id)),o=[...t.todos.filter(h=>s.has(h.id)?!1:h.completed),...r].filter((h,g,m)=>m.findIndex(x=>x.id===h.id)===g);return{...t,todos:o};case"MERGE_TODOS":const l=e.payload,c=new Map(t.todos.map(h=>[h.id,h]));return l.forEach(h=>c.set(h.id,h)),{...t,todos:Array.from(c.values()).sort((h,g)=>{const m=h.createdAt instanceof Date?h.createdAt.getTime():0;return(g.createdAt instanceof Date?g.createdAt.getTime():0)-m})};case"MARK_MONTH_FETCHED":return{...t,fetchedMonths:new Set(t.fetchedMonths).add(e.payload)};case"ADD_TODO":return t.todos.some(h=>h.id===e.payload.id)?t:{...t,todos:[e.payload,...t.todos]};case"UPDATE_TODO":return{...t,todos:t.todos.map(h=>h.id===e.payload.id?{...h,...e.payload.updates,updatedAt:new Date}:h)};case"DELETE_TODO":return{...t,todos:t.todos.filter(h=>h.id!==e.payload)};case"TOGGLE_TODO":{const h=new Date;return{...t,todos:t.todos.map(g=>{if(g.id===e.payload){const m=!g.completed;return m&&setTimeout(()=>{Je(async()=>{const{notificationManager:x}=await Promise.resolve().then(()=>kl);return{notificationManager:x}},void 0,import.meta.url).then(({notificationManager:x})=>{x.showCompletionCelebration(g)})},0),{...g,completed:m,completedAt:m?h:void 0,updatedAt:h}}return g})}}case"ADD_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:[...h.subTasks||[],e.payload.subTask],updatedAt:new Date}:h)};case"UPDATE_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:h.subTasks?.map(g=>g.id===e.payload.subTaskId?{...g,...e.payload.updates,updatedAt:new Date}:g)||[],updatedAt:new Date}:h)};case"DELETE_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:h.subTasks?.filter(g=>g.id!==e.payload.subTaskId)||[],updatedAt:new Date}:h)};case"TOGGLE_SUBTASK":return{...t,todos:t.todos.map(h=>h.id===e.payload.todoId?{...h,subTasks:h.subTasks?.map(g=>g.id===e.payload.subTaskId?{...g,completed:!g.completed,updatedAt:new Date}:g)||[],updatedAt:new Date}:h)};case"SET_RECURRING_TEMPLATES":return{...t,recurringTemplates:e.payload};case"SET_SHARING_GROUPS":return{...t,sharingGroups:e.payload};case"ADD_RECURRING_TEMPLATE":return{...t,recurringTemplates:[e.payload,...t.recurringTemplates]};case"UPDATE_RECURRING_TEMPLATE":return{...t,recurringTemplates:t.recurringTemplates.map(h=>h.id===e.payload.id?{...h,...e.payload.updates,updatedAt:new Date}:h)};case"DELETE_RECURRING_TEMPLATE":return{...t,recurringTemplates:t.recurringTemplates.filter(h=>h.id!==e.payload),recurringInstances:t.recurringInstances.filter(h=>h.templateId!==e.payload)};case"SET_RECURRING_INSTANCES":const u=e.payload.find(h=>h.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");return u&&console.log(`   ğŸ”§ Firebase ì›”ê°„ì—…ë¬´ë³´ê³  ìƒíƒœ: completed=${u.completed}`),{...t,recurringInstances:e.payload};case"UPDATE_RECURRING_INSTANCE":return{...t,recurringInstances:t.recurringInstances.map(h=>h.id===e.payload.id?{...h,...e.payload.updates,updatedAt:new Date}:h)};case"GENERATE_RECURRING_INSTANCES":{let h=[],g=[];try{const m=localStorage.getItem("recurringInstances");m&&(g=JSON.parse(m).map(f=>({...f,date:new Date(f.date),createdAt:new Date(f.createdAt),updatedAt:new Date(f.updatedAt),completedAt:f.completedAt?new Date(f.completedAt):void 0})),console.log("ğŸ“‚ localStorageì—ì„œ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ë³µì›:",g.length,"ê°œ"))}catch(m){console.error("âŒ localStorage ì¸ìŠ¤í„´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:",m)}return console.log("ğŸ‘¤ ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì - ë¡œì»¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œì‘"),t.recurringTemplates.filter(m=>m.isActive).forEach(m=>{try{const f=Ps.generateInstances(m).map(p=>{const w=g.find(v=>v.id===p.id);return w?(console.log(`ğŸ”„ localStorage ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ ë³µì›: ${p.id} (ì™„ë£Œ: ${w.completed})`),{...p,completed:w.completed,completedAt:w.completedAt,updatedAt:w.updatedAt}):p});h=[...h,...f]}catch(x){console.error(`í…œí”Œë¦¿ ${m.id} ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:`,x)}}),{...t,recurringInstances:h}}default:return t}}const Jv=({children:t})=>{const[e,r]=y.useReducer(Qv,Xv),{currentUser:s,loading:n,getGoogleAccessToken:i}=wt(),{customHolidays:o}=sn(),[l,c]=y.useState(""),[d,u]=y.useState("all"),[h,g]=y.useState("all"),[m,x]=y.useState([]),f=y.useRef(null),p=y.useRef(null),w=y.useRef(null),v=y.useRef(null),k=y.useCallback(()=>{if(e.recurringTemplates.length===0||e.recurringInstances.length===0)return[];const L=e.recurringInstances.filter(P=>!P.skipped).map(P=>{const F=e.recurringTemplates.find(U=>U.id===P.templateId);return F?Ps.convertToTodo(P,F):null}).filter(P=>P!==null),A=new Set;return L.filter(P=>A.has(P.id)?!1:(A.add(P.id),!0))},[e.recurringTemplates,e.recurringInstances]),b=y.useCallback(async(S,L)=>{if(s){if(console.log(`ğŸ”„ Syncing changes to Google Task [${S.title}]`,{updates:L,gId:S.googleTaskId}),!S.googleTaskId||!S.googleTaskListId){L&&S.googleTaskId&&console.warn("âš ï¸ Google Sync Skip - Missing IDs:",{id:S.id,gId:S.googleTaskId,listId:S.googleTaskListId});return}Pn.register(S.googleTaskId);try{const A=await i({silent:!0});if(!A)return;const P={...S,...L},F={title:P.title,notes:P.description||""};if(P.completed!==void 0&&(F.status=P.completed?"completed":"needsAction",F.completed=P.completed?(P.completedAt||new Date).toISOString():null),P.dueDate){const U=new Date(P.dueDate);F.due=new Date(Date.UTC(U.getFullYear(),U.getMonth(),U.getDate())).toISOString()}else F.due=null;console.log(`ğŸ”„ Google Tasks ì „ë°©í–¥ ë™ê¸°í™”: [${P.title}]`),await ts.updateTask(A,S.googleTaskListId,S.googleTaskId,F)}catch(A){console.error("âŒ Google Tasks ë™ê¸°í™” ì¤‘ ì—ëŸ¬ ë°œìƒ:",A)}}},[s,i]),T=y.useCallback(async S=>{if(!(!S.googleTaskId||!S.googleTaskListId||!s))try{const L=await i({silent:!0});if(!L)return;await ts.deleteTask(L,S.googleTaskListId,S.googleTaskId),console.log(`ğŸ—‘ï¸ Google Tasksì—ì„œ ì‚­ì œ ì™„ë£Œ: [${S.title}]`)}catch(L){console.error("âŒ Google Tasks ì‚­ì œ ì¤‘ ì—ëŸ¬ ë°œìƒ:",L)}},[s,i]),_=y.useCallback(async S=>{const L=P=>{const F=e.todos.filter(ae=>ae.priority===P&&!ae.completed);if(F.length===0)return{urgent:0,high:1e3,medium:2e3,low:3e3}[P]||2e3;const U=Math.min(...F.map(ae=>ae.order||999));return Math.max(0,U-1)},A={...S,id:mo(),createdAt:new Date,updatedAt:new Date,order:L(S.priority)};try{if(s){if(A.googleTaskId)console.log(`ğŸ“¥ Google Tasks Import ê°ì§€: Push ê±´ë„ˆëœ€ [${A.title}]`);else try{const F=await ee.getUserSettings(s.uid);if(F?.autoSyncGoogleTasks){const U=await i({silent:!0});if(U){const ae=await ts.insertTask(U,F.defaultGoogleTaskListId||"@default",{title:A.title,notes:A.description,due:A.dueDate?new Date(Date.UTC(A.dueDate.getFullYear(),A.dueDate.getMonth(),A.dueDate.getDate())).toISOString():void 0});ae&&(console.log(`âœ… Google Tasksì— ì¶”ê°€ë¨: [${A.title}]`),A.googleTaskId=ae.id,A.googleTaskListId=F.defaultGoogleTaskListId||"@default",Pn.register(ae.id))}}}catch(F){console.error("âš ï¸ Google Tasks ì¶”ê°€ ì‹¤íŒ¨ (ë¡œì»¬ ì €ì¥ì€ ì§„í–‰):",F)}const P=await ee.addTodo(A,s.uid);r({type:"ADD_TODO",payload:{...A,id:P}})}else r({type:"ADD_TODO",payload:A})}catch(P){console.error("í• ì¼ ì¶”ê°€ ì‹¤íŒ¨:",P)}},[s,e.todos,i]),j=y.useCallback(async(S,L)=>{try{const A=e.todos.find(P=>P.id===S);s?(await ee.updateTodo(S,L,s.uid),A&&b(A,L)):r({type:"UPDATE_TODO",payload:{id:S,updates:L}})}catch(A){console.error("í• ì¼ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",A)}},[s,e.todos,b]),N=y.useCallback(async S=>{try{const A=[...e.todos,...k()].find(F=>F.id===S);if(S.startsWith("recurring_")||A?._isRecurringInstance){let F=A?._instanceId||(S.startsWith("recurring_")?S.replace("recurring_",""):null);if(!F)return;const U={skipped:!0,skippedReason:"manual_deletion"};r({type:"SET_RECURRING_INSTANCES",payload:e.recurringInstances.map(ae=>ae.id===F?{...ae,...U}:ae)}),s&&await ee.updateRecurringInstance(F,U,s.uid);return}s&&(A&&T(A),await ee.deleteTodo(S,s.uid).catch(()=>{})),r({type:"DELETE_TODO",payload:S})}catch(L){console.error("í• ì¼ ì‚­ì œ ì‹¤íŒ¨:",L)}},[s,e.todos,e.recurringInstances,k,r]),D=y.useCallback(async S=>{const A=[...e.todos,...k()].find(U=>U.id===S),P=e.todos.find(U=>U.id===S);if(P&&P.startDate&&P.dueDate&&!P._isRecurringInstance){const U={completed:!P.completed,completedAt:P.completed?null:new Date};try{r({type:"TOGGLE_TODO",payload:S}),s&&(await ee.updateTodo(S,U,s.uid),b(P,U));return}catch(ae){console.error("âŒ ê¸°ê°„ í• ì¼ í† ê¸€ ì‹¤íŒ¨:",ae),r({type:"TOGGLE_TODO",payload:S});return}}if(A&&A._isRecurringInstance){let U=A._instanceId||(S.startsWith("recurring_")?S.replace("recurring_",""):null);if(!U)return;const ae=e.recurringInstances.find(Ne=>Ne.id===U);if(ae){const Ne={...ae,completed:!ae.completed,completedAt:ae.completed?null:new Date,updatedAt:new Date};try{r({type:"SET_RECURRING_INSTANCES",payload:e.recurringInstances.map(Se=>Se.id===U?Ne:Se)}),s&&await ee.updateRecurringInstance(U,{completed:Ne.completed,completedAt:Ne.completedAt},s.uid);return}catch(Se){console.error("âŒ ë°˜ë³µ í• ì¼ í† ê¸€ ì‹¤íŒ¨:",Se),r({type:"SET_RECURRING_INSTANCES",payload:e.recurringInstances});return}}}const F=e.todos.find(U=>U.id===S);if(F)try{if(r({type:"TOGGLE_TODO",payload:S}),s){const U={completed:!F.completed,completedAt:F.completed?null:new Date};await ee.updateTodo(S,U,s.uid),b(F,U)}}catch(U){console.error("âŒ ì¼ë°˜ í• ì¼ í† ê¸€ ì‹¤íŒ¨:",U),r({type:"TOGGLE_TODO",payload:S})}},[s,e.todos,e.recurringInstances,k,b,r]),$=y.useCallback(()=>{const S=e.todos.filter(F=>!F.completed&&(F.order===void 0||F.order===null)),L=k().filter(F=>!F.completed&&(F.order===void 0||F.order===null)),A=[...S,...L];if(A.length===0)return;const P={urgent:A.filter(F=>F.priority==="urgent"),high:A.filter(F=>F.priority==="high"),medium:A.filter(F=>F.priority==="medium"),low:A.filter(F=>F.priority==="low")};Object.entries(P).forEach(([F,U],ae)=>{if(U.length===0)return;const Ne=U.sort((he,_e)=>new Date(he.createdAt).getTime()-new Date(_e.createdAt).getTime()),Se=ae*1e3;Ne.forEach((he,_e)=>{const me=Se+_e*10;if(he._isRecurringInstance){const De=he._instanceId;r({type:"UPDATE_RECURRING_INSTANCE",payload:{id:De,updates:{order:me}}})}else s&&ee.updateTodo(he.id,{order:me},s.uid).catch(()=>{}),r({type:"UPDATE_TODO",payload:{id:he.id,updates:{order:me}}})})})},[e.todos,k,s]);y.useEffect(()=>{if(n)return;if(!s){console.log("âŒ ë¹„ë¡œê·¸ì¸ ìƒíƒœ"),R();return}return console.log("âœ… ë¡œê·¸ì¸ ìƒíƒœ - ì‚¬ìš©ì:",s.uid),r({type:"SET_LOADING",payload:!0}),f.current&&(f.current(),f.current=null),p.current&&(p.current(),p.current=null),w.current&&(w.current(),w.current=null),v.current&&(v.current(),v.current=null),(async()=>{try{if(await Y(),!s)return;console.log("ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ êµ¬ë… ì‹œì‘ - ì‚¬ìš©ì:",s.uid),console.log("ğŸ”— Firestore í• ì¼ êµ¬ë… ì‹œì‘ - ì‚¬ìš©ì ID:",s.uid),f.current=ee.subscribeTodos(s.uid,F=>{r({type:"SET_TODOS",payload:F}),r({type:"SET_LOADING",payload:!1}),r({type:"SET_ERROR",payload:null})}),p.current=ee.subscribeRecurringTemplates(s.uid,F=>{r({type:"SET_RECURRING_TEMPLATES",payload:F}),console.log("ë°˜ë³µ í…œí”Œë¦¿ Firestoreì—ì„œ ë¡œë“œë¨:",F.length,"ê°œ")}),v.current=ee.subscribeSharingGroups(s.uid,F=>{r({type:"SET_SHARING_GROUPS",payload:F}),console.log("ê³µìœ  ê·¸ë£¹ Firestoreì—ì„œ ë¡œë“œë¨:",F.length,"ê°œ")}),console.log("ğŸš€ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì‹œì‘..."),console.log("ğŸ” ì‹¤ì‹œê°„ êµ¬ë… ì „ì— ì§ì ‘ ë°ì´í„° ì¡°íšŒë¡œ í™•ì¸..."),console.log("ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ì •ë³´:"),console.log("  UID:",s.uid),console.log("  Email:",s.email),console.log("  DisplayName:",s.displayName),console.log("ğŸ“ Firestore ê²½ë¡œ: users/"+s.uid+"/recurringInstances");const A=(await ee.getRecurringInstances(s.uid)).find(F=>F.id==="PUH4xT3lVY5aK2vuQyUe_2025-08-21");A&&(console.log("ğŸ¯ğŸ¯ğŸ¯ ì§ì ‘ ì¡°íšŒí•œ ì£¼ê°„ì—…ë¬´ë³´ê³  ë°ì´í„°:"),console.log("  completed:",A.completed,typeof A.completed),console.log("  completedAt:",A.completedAt),console.log("  ì „ì²´ ê°ì²´:",JSON.stringify(A,null,2)),console.log("ğŸ“ í•´ë‹¹ ë¬¸ì„œì˜ ì „ì²´ ê²½ë¡œ: users/"+s.uid+"/recurringInstances/PUH4xT3lVY5aK2vuQyUe_2025-08-21"));const P=ee.subscribeRecurringInstances(s.uid,F=>{r({type:"SET_RECURRING_INSTANCES",payload:F})});P?(w.current=P,setTimeout(async()=>{try{const F=await ee.getRecurringInstances(s.uid);r({type:"SET_RECURRING_INSTANCES",payload:F})}catch(F){console.error("âŒ Firebase ê°•ì œ ë™ê¸°í™” ì‹¤íŒ¨:",F)}},3e3)):console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì‹¤ì‹œê°„ êµ¬ë… ì„¤ì • ì‹¤íŒ¨")}catch(L){console.error("Firestore ì´ˆê¸°í™” ì‹¤íŒ¨:",L),r({type:"SET_LOADING",payload:!1}),r({type:"SET_ERROR",payload:"Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})}})(),()=>{f.current&&f.current(),p.current&&p.current(),w.current&&w.current(),v.current&&v.current()}},[s,n]),y.useEffect(()=>{if(e.recurringTemplates.length===0)return;(async()=>{try{if(!s){const L=[];for(const A of e.recurringTemplates)try{const P=Ps.generateInstances(A,o);L.push(...P)}catch(P){console.error(`âŒ í…œí”Œë¦¿ ${A.title} ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:`,P)}r({type:"SET_RECURRING_INSTANCES",payload:L});return}for(const L of e.recurringTemplates)try{await ee.regenerateRecurringInstances(L.id,s.uid)}catch(A){console.error(`âŒ Firebase í…œí”Œë¦¿ ${L.title} ì¬ìƒì„± ì‹¤íŒ¨:`,A)}}catch(L){console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",L)}})()},[e.recurringTemplates,s,o]),y.useEffect(()=>{if(!s||e.recurringInstances.length===0)return;(async()=>{try{const L=await ee.getRecurringInstances(s.uid),A=new Set(L.map(F=>F.id)),P=e.recurringInstances.filter(F=>{const U=!A.has(F.id);return U});if(P.length>0)for(const F of P)try{const U=await ee.addRecurringInstance({...F,id:F.id},s.uid)}catch(U){console.error(`âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ Firebase ì¶”ê°€ ì‹¤íŒ¨: ${F.id}`,U)}}catch(L){console.error("âŒ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ Firebase ë™ê¸°í™” ì‹¤íŒ¨:",L)}})()},[s,e.recurringInstances.length,e.recurringInstances]);const C=y.useCallback(async(S,L)=>{if(!s)return;const A=`${S}-${L}`;if(e.fetchedMonths.has(A)){console.log(`ğŸ§  Cache Hit: Historical todos for ${A} already loaded.`);return}console.log(`ğŸŒ Fetching Historical todos for ${A}...`),r({type:"SET_LOADING",payload:!0});try{const P=new Date(S,L-1,1),F=new Date(S,L,0),U=await ee.getCompletedTodos(s.uid,P,F);U.length>0?(console.log(`ğŸ“¥ Loaded ${U.length} historical todos.`),r({type:"MERGE_TODOS",payload:U})):console.log(`ğŸ¤·â€â™‚ï¸ No historical todos found for ${A}.`),r({type:"MARK_MONTH_FETCHED",payload:A})}catch(P){console.error("Failed to load historical todos:",P)}finally{r({type:"SET_LOADING",payload:!1})}},[s,e.fetchedMonths]);y.useEffect(()=>{const S=async()=>{try{const{Capacitor:A}=await Je(async()=>{const{Capacitor:U}=await Promise.resolve().then(()=>ms);return{Capacitor:U}},void 0,import.meta.url);if(A.getPlatform()!=="android")return;const{LocalNotifications:P}=await Je(async()=>{const{LocalNotifications:U}=await Promise.resolve().then(()=>Zj);return{LocalNotifications:U}},void 0,import.meta.url),F=await P.addListener("localNotificationActionPerformed",async U=>{console.log("ğŸ”” Notification Action Performed:",U.actionId);const ae=U.actionId,Ne=U.notification.extra?.todoId;if(ae==="COMPLETE"&&Ne)console.log("âœ… Completing task via notification:",Ne),r({type:"TOGGLE_TODO",payload:Ne}),s&&e.todos.find(he=>he.id===Ne)&&await ee.updateTodo(Ne,{completed:!0,completedAt:new Date,updatedAt:new Date},s.uid),await P.removeAllDeliveredNotifications();else if(ae==="SNOOZE"&&Ne){console.log("zzz Snoozing task:",Ne);const Se=new Date(Date.now()+900*1e3),{notificationManager:he}=await Je(async()=>{const{notificationManager:me}=await Promise.resolve().then(()=>kl);return{notificationManager:me}},void 0,import.meta.url);e.todos.find(me=>me.id===Ne)&&await P.schedule({notifications:[{title:U.notification.title||"Snoozed Task",body:U.notification.body||"Reminder",id:U.notification.id+1,schedule:{at:Se},actionTypeId:"REMINDER_ACTIONS",extra:{todoId:Ne}}]})}else ae==="OPEN_APP"?console.log("ğŸ“± Daily briefing: ì–´í”Œë¡œ í™•ì¸ í´ë¦­ - ì•± ì—´ê¸°"):ae==="DISMISS"&&console.log("âŒ Daily briefing: ë‹«ê¸° í´ë¦­")});return()=>{F.remove()}}catch(A){console.warn("Failed to setup notification listeners",A)}};let L;return S().then(A=>L=A),()=>{L&&L()}},[e.todos,s]),y.useEffect(()=>{const S=async()=>{try{const{Capacitor:L}=await Je(async()=>{const{Capacitor:F}=await Promise.resolve().then(()=>ms);return{Capacitor:F}},void 0,import.meta.url);if(L.getPlatform()!=="android")return;const{notificationManager:A}=await Je(async()=>{const{notificationManager:F}=await Promise.resolve().then(()=>kl);return{notificationManager:F}},void 0,import.meta.url);let P=null;if(s&&(P=await ee.getUserSettings(s.uid)),!P){const F=localStorage.getItem("notification-settings");F&&(P=JSON.parse(F))}P||(P={dailyReminder:!0,dailyReminderTime:"09:00",dailyRecurrence:[1,2,3,4,5]}),await A.scheduleDailyBriefing(P,e.todos,[]),console.log("ğŸ“… Daily briefing scheduled on app startup")}catch(L){console.warn("Failed to initialize daily briefing",L)}};(e.todos.length>0||!e.loading)&&S()},[e.todos,e.loading]);const R=()=>{try{if(console.log("=== localStorageì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œì‘ ==="),s){console.log("ğŸ‘¤ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - ê°œì¸ Firebase ë°ì´í„°ë§Œ ì‚¬ìš©"),r({type:"SET_TODOS",payload:[]}),r({type:"SET_RECURRING_TEMPLATES",payload:[]}),r({type:"SET_LOADING",payload:!1});return}if(s)console.log("ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - localStorage í• ì¼ ë¡œë“œ ê±´ë„ˆëœ€ (Firestore ì‚¬ìš©)");else{const S=localStorage.getItem("todos");if(S){const A=JSON.parse(S).map(P=>({...P,createdAt:new Date(P.createdAt),updatedAt:new Date(P.updatedAt),dueDate:P.dueDate?new Date(P.dueDate):void 0,startDate:P.startDate?new Date(P.startDate):void 0,completedAt:P.completedAt?new Date(P.completedAt):void 0}));console.log("localStorageì—ì„œ í• ì¼ ë¡œë“œ (ë¹„ë¡œê·¸ì¸):",A.length,"ê°œ"),r({type:"SET_TODOS",payload:A})}}if(s)console.log("ğŸš« ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - localStorage í…œí”Œë¦¿ ë¡œë“œ ì™„ì „ ë¹„í™œì„±í™” (Firestore ì „ìš©)");else{const S=localStorage.getItem("recurringTemplates");if(S){const A=JSON.parse(S).map(P=>({...P,createdAt:new Date(P.createdAt),updatedAt:new Date(P.updatedAt)}));console.log("localStorageì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ë¡œë“œ:",A.length,"ê°œ"),r({type:"SET_RECURRING_TEMPLATES",payload:A})}}r({type:"SET_LOADING",payload:!1}),console.log("=== localStorage ë°ì´í„° ë¡œë“œ ì™„ë£Œ ===")}catch(S){console.error("localStorage ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"localStorage ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}),r({type:"SET_LOADING",payload:!1})}},B=()=>{if(s){console.log("ë¡œê·¸ì¸ëœ ì‚¬ìš©ì - localStorage ì €ì¥ ê±´ë„ˆëœ€");return}try{localStorage.setItem("todos",JSON.stringify(e.todos)),localStorage.setItem("recurringTemplates",JSON.stringify(e.recurringTemplates)),console.log("localStorageì— ë°ì´í„° ì €ì¥ ì™„ë£Œ (ë¹„ë¡œê·¸ì¸)")}catch(S){console.error("localStorage ì €ì¥ ì‹¤íŒ¨:",S)}},Y=async()=>{if(s)try{if(console.log("=== localStorage â†’ Firestore ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸ ==="),!s)return;if(console.log("ğŸ”„ ë¡œê·¸ì¸ ì‚¬ìš©ì - localStorage ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œë„"),localStorage.getItem(`migrated_${s.uid}`)){console.log("ì´ë¯¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œëœ ì‚¬ìš©ì:",s.uid);return}console.log("ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘ - ì‚¬ìš©ì:",s.uid);const L=localStorage.getItem("todos"),A=localStorage.getItem("recurringTemplates");if(L||A){if(console.log("ë§ˆì´ê·¸ë ˆì´ì…˜í•  localStorage ë°ì´í„° ë°œê²¬"),L){const F=JSON.parse(L);if(F.length>0){console.log(`${F.length}ê°œì˜ í• ì¼ì„ Firestoreë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜`);for(const U of F)try{await ee.addTodo({...U,createdAt:new Date(U.createdAt),updatedAt:new Date(U.updatedAt),dueDate:U.dueDate?new Date(U.dueDate):void 0,startDate:U.startDate?new Date(U.startDate):void 0,completedAt:U.completedAt?new Date(U.completedAt):void 0},s.uid),console.log(`í• ì¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ: ${U.title}`)}catch(ae){console.error(`í• ì¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${U.title}`,ae)}}}if(A){const F=JSON.parse(A);if(F.length>0){console.log(`${F.length}ê°œì˜ ë°˜ë³µ í…œí”Œë¦¿ì„ Firestoreë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜`);for(const U of F)try{await ee.addRecurringTemplate({...U,createdAt:new Date(U.createdAt),updatedAt:new Date(U.updatedAt)},s.uid),console.log(`ë°˜ë³µ í…œí”Œë¦¿ ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ: ${U.title}`)}catch(ae){console.error(`ë°˜ë³µ í…œí”Œë¦¿ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${U.title}`,ae)}}}const P={todos:L?JSON.parse(L):[],recurringTemplates:A?JSON.parse(A):[],migratedAt:new Date().toISOString(),userId:s.uid};localStorage.setItem(`migrated_backup_${s.uid}`,JSON.stringify(P)),localStorage.setItem(`migrated_${s.uid}`,new Date().toISOString()),localStorage.removeItem("todos"),localStorage.removeItem("recurringTemplates"),console.log("=== ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ: localStorage ë°ì´í„° ì •ë¦¬ë¨ ===")}else console.log("ë§ˆì´ê·¸ë ˆì´ì…˜í•  localStorage ë°ì´í„°ê°€ ì—†ìŒ"),localStorage.setItem(`migrated_${s.uid}`,new Date().toISOString())}catch(S){console.error("ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}};y.useEffect(()=>{if(s){console.log("ğŸš« ë¡œê·¸ì¸ ì‚¬ìš©ì - simpleRecurringSystem ë™ê¸°í™” ì°¨ë‹¨!");return}Ps.setTemplates(e.recurringTemplates)},[e.recurringTemplates,s]),y.useEffect(()=>{!s&&!n&&(console.log("ğŸ“¦ localStorage ì €ì¥ ì¤‘ - todos ë³€ê²½:",e.todos.length),B())},[e.todos,s,n]),y.useEffect(()=>{!s&&!n&&(console.log("ğŸ“¦ localStorage ì €ì¥ ì¤‘ - í…œí”Œë¦¿ ë³€ê²½:",e.recurringTemplates.length),B())},[e.recurringTemplates,s,n]);const V=async()=>{if(s){r({type:"SET_SYNCING",payload:!0});try{const S=await ee.getTodos(s.uid);r({type:"SET_TODOS",payload:S}),r({type:"SET_ERROR",payload:null}),setTimeout(()=>{$()},500),typeof window<"u"&&(window.initializeOrderValues=$,window.forceFirebaseSync=async()=>{if(!s){console.log("âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");return}try{console.log("ğŸ”§ ìˆ˜ë™ Firebase ê°•ì œ ë™ê¸°í™” ì‹œì‘...");const L=await ee.getRecurringInstances(s.uid),A=L.find(P=>P.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");A&&console.log("ğŸ”§ ìˆ˜ë™ ë™ê¸°í™” - Firebase ì›”ê°„ì—…ë¬´ë³´ê³  ìƒíƒœ:",A.completed),r({type:"SET_RECURRING_INSTANCES",payload:L}),console.log("âœ… ìˆ˜ë™ Firebase ë™ê¸°í™” ì™„ë£Œ!"),setTimeout(()=>{const P=L.find(F=>F.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");P&&console.log("ğŸ” ìˆ˜ë™ ë™ê¸°í™” í›„ í™•ì¸:",P.completed)},1e3)}catch(L){console.error("âŒ ìˆ˜ë™ Firebase ë™ê¸°í™” ì‹¤íŒ¨:",L)}},console.log("ğŸ”§ ë””ë²„ê·¸ í•¨ìˆ˜ ë“±ë¡ë¨: window.forceFirebaseSync()"))}catch(S){console.error("Firestore ë™ê¸°í™” ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}finally{r({type:"SET_SYNCING",payload:!1})}}},q=async(S,L)=>{const A=e.todos.find(U=>U.id===S);let P;if(A?.googleTaskId&&A?.googleTaskListId&&s)try{const U=await i({silent:!0});if(U){const ae=await ts.insertTask(U,A.googleTaskListId,{title:L});ae&&(await ts.moveTask(U,A.googleTaskListId,ae.id,A.googleTaskId),P=ae.id,console.log(`âœ… Google Tasksì— í•˜ìœ„ í• ì¼ ìƒì„± ë° ì´ë™ ì™„ë£Œ: [${L}]`))}}catch(U){console.error("âŒ Google Tasks í•˜ìœ„ í• ì¼ ìƒì„± ì‹¤íŒ¨:",U)}const F={id:mo(),title:L,completed:!1,priority:"medium",createdAt:new Date,updatedAt:new Date,googleTaskId:P||null};try{s?await ee.addSubTask(F,s.uid,S):r({type:"ADD_SUBTASK",payload:{todoId:S,subTask:F}})}catch(U){console.error("ì„œë¸ŒíƒœìŠ¤í¬ ì¶”ê°€ ì‹¤íŒ¨:",U),r({type:"SET_ERROR",payload:"í•˜ìœ„ ì‘ì—… ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},z=async(S,L,A)=>{try{const P=e.todos.find(U=>U.id===S),F=P?.subTasks?.find(U=>U.id===L);if(s){if(await ee.updateSubTask(L,A,s.uid,S),P?.googleTaskListId&&F?.googleTaskId)try{const U=await i({silent:!0});if(U){const ae={};A.title!==void 0&&(ae.title=A.title),A.completed!==void 0&&(ae.status=A.completed?"completed":"needsAction",ae.completed=A.completed?new Date().toISOString():null),A.dueDate!==void 0&&(ae.due=A.dueDate?A.dueDate.toISOString():null),await ts.updateTask(U,P.googleTaskListId,F.googleTaskId,ae),console.log(`âœ… Google Tasks í•˜ìœ„ í• ì¼ ì—…ë°ì´íŠ¸ ì™„ë£Œ: [${A.title||F.title}]`)}}catch(U){console.error("âŒ Google Tasks í•˜ìœ„ í• ì¼ ë™ê¸°í™” ì‹¤íŒ¨:",U)}}else r({type:"UPDATE_SUBTASK",payload:{todoId:S,subTaskId:L,updates:A}})}catch(P){console.error("ì„œë¸ŒíƒœìŠ¤í¬ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",P),r({type:"SET_ERROR",payload:"í•˜ìœ„ ì‘ì—… ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},de=async(S,L)=>{try{const A=e.todos.find(F=>F.id===S),P=A?.subTasks?.find(F=>F.id===L);if(s){if(await ee.deleteSubTask(L,s.uid,S),A?.googleTaskListId&&P?.googleTaskId)try{const F=await i({silent:!0});F&&(await ts.deleteTask(F,A.googleTaskListId,P.googleTaskId),console.log(`ğŸ—‘ï¸ Google Tasks í•˜ìœ„ í• ì¼ ì‚­ì œ ì™„ë£Œ: [${P.title}]`))}catch(F){console.error("âŒ Google Tasks í•˜ìœ„ í• ì¼ ì‚­ì œ ì‹¤íŒ¨:",F)}}else r({type:"DELETE_SUBTASK",payload:{todoId:S,subTaskId:L}})}catch(A){console.error("ì„œë¸ŒíƒœìŠ¤í¬ ì‚­ì œ ì‹¤íŒ¨:",A),r({type:"SET_ERROR",payload:"í•˜ìœ„ ì‘ì—… ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},Te=async(S,L)=>{console.log("ğŸ”„ ì„œë¸ŒíƒœìŠ¤í¬ í† ê¸€ ì‹œì‘:",{todoId:S,subTaskId:L});const P=e.todos.find(ae=>ae.id===S)?.subTasks?.find(ae=>ae.id===L);if(!P){console.error("âŒ ì„œë¸ŒíƒœìŠ¤í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:",{todoId:S,subTaskId:L});return}const F=!P.completed;console.log("ğŸ“Š ì„œë¸ŒíƒœìŠ¤í¬ ìƒíƒœ:",{í˜„ì¬ì™„ë£Œìƒíƒœ:P.completed,ë³€ê²½í›„ìƒíƒœ:F,ê¸°ì¡´ì™„ë£Œì‹œê°„:P.completedAt});const U={completed:F,completedAt:F?new Date:null};console.log("ğŸ“ ì—…ë°ì´íŠ¸ ë°ì´í„°:",U),await z(S,L,U)},we=S=>{const L=new Map,A=[];S.forEach(F=>{const U=F._isRecurringInstance||F.id.startsWith("recurring_"),ae=F._templateId;U&&ae?(L.has(ae)||L.set(ae,[]),L.get(ae).push(F)):A.push(F)});const P=[];return L.forEach(F=>{const U=F.filter(Ne=>Ne.completed);P.push(...U);const ae=F.filter(Ne=>!Ne.completed);ae.length>0&&(ae.sort((Ne,Se)=>{const he=Ne.startDate?new Date(Ne.startDate).getTime():0,_e=Se.startDate?new Date(Se.startDate).getTime():0;return he-_e}),P.push(ae[0]),ae.length>1&&console.log(`ğŸ”’ ìˆœì°¨ì  í•„í„°ë§: ${ae[0].title} (í‘œì‹œ), ${ae.length-1}ê°œ ìˆ¨ê¹€`))}),[...A,...P]},fe=S=>{const L=S?new Date(S):new Date;L.setHours(0,0,0,0);const A=e.todos.filter(Se=>{if(Se.completed){if(Se.completedAt){const me=new Date(Se.completedAt);if(me.setHours(0,0,0,0),me.getTime()===L.getTime())return!0}return Se.subTasks&&Se.subTasks.length>0&&Se.subTasks.some(De=>{if(De.completed&&De.completedAt&&De.completedAt!==null)try{const Pe=new Date(De.completedAt);return Pe.setHours(0,0,0,0),Pe.getTime()===L.getTime()}catch{return!1}return!1})?(console.log(`ğŸ“‹ "${Se.title}" - ì˜¤ëŠ˜ ì™„ë£Œëœ ì„œë¸ŒíƒœìŠ¤í¬ ìˆìŒ`),!0):!1}const he=Se.startDate?new Date(Se.startDate):null,_e=Se.dueDate?new Date(Se.dueDate):null;return he&&he.setHours(0,0,0,0),_e&&_e.setHours(0,0,0,0),he&&_e?L.getTime()>=he.getTime()&&L.getTime()<=_e.getTime():he&&!_e?L.getTime()>=he.getTime():!he&&_e?_e.getTime()>=L.getTime():!Se.dueDate&&!Se.startDate}),F=k().filter(Se=>{if(Se.startDate){const he=new Date(Se.startDate);if(he.setHours(0,0,0,0),he.getTime()===L.getTime()||he.getTime()<L.getTime()&&!Se.completed)return!0}if(Se.completed&&Se.completedAt){const he=new Date(Se.completedAt);if(he.setHours(0,0,0,0),he.getTime()===L.getTime())return!0}return!1}),U=new Set,Ne=[...A,...F].filter(Se=>U.has(Se.id)?!1:(U.add(Se.id),!0));return we(Ne)},W=()=>{const S=new Date;S.setHours(0,0,0,0),k().filter(me=>me.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")).length>0;const P=new Date(S);P.setDate(S.getDate()-S.getDay()),P.setHours(0,0,0,0);const F=new Date(P);F.setDate(P.getDate()+6),F.setHours(0,0,0,0);const U=e.todos.filter(me=>{if(me.completed&&me.completedAt){const De=new Date(me.completedAt);return De.setHours(0,0,0,0),De>=P&&De<=F}if(!me.completed){const De=me.startDate?new Date(me.startDate):null,Pe=me.dueDate?new Date(me.dueDate):null;if(De&&De.setHours(0,0,0,0),Pe&&Pe.setHours(0,0,0,0),De&&Pe)return Pe.getTime()>=P.getTime()&&De.getTime()<=F.getTime();if(De&&!Pe)return De<=F;if(!De&&Pe)return Pe>=S;if(!De&&!Pe)return!0}return!1}),Ne=k().filter(me=>{if(me.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ "),me.completed){if(me.completedAt){const st=new Date(me.completedAt);st.setHours(0,0,0,0);const mt=st>=P&&st<=F;return me.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ "),mt}return me.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ "),!1}const De=me.startDate?new Date(me.startDate):null,Pe=me.dueDate?new Date(me.dueDate):null;return De&&De.setHours(0,0,0,0),Pe&&Pe.setHours(0,0,0,0),De&&Pe?Pe.getTime()>=P.getTime()&&De.getTime()<=F.getTime():De&&!Pe?De<=F:!De&&Pe?Pe>=P:!De&&!Pe}),Se=[...U,...Ne],he={urgent:0,high:1,medium:2,low:3},_e=Se.sort((me,De)=>{const Pe=he[me.priority]-he[De.priority];if(Pe!==0)return Pe;const st=me.order||0,mt=De.order||0;return st!==mt?st-mt:new Date(me.createdAt).getTime()-new Date(De.createdAt).getTime()});return we(_e)},le=()=>{const S=new Date;S.setHours(0,0,0,0);const L=new Date(S.getFullYear(),S.getMonth(),1);L.setHours(0,0,0,0);const A=new Date(S.getFullYear(),S.getMonth()+1,0);A.setHours(0,0,0,0);const P=e.todos.filter(he=>{if(he.completed&&he.completedAt){const _e=new Date(he.completedAt);return _e.setHours(0,0,0,0),_e>=L&&_e<=A}if(!he.completed){const _e=he.startDate?new Date(he.startDate):null,me=he.dueDate?new Date(he.dueDate):null;if(_e&&_e.setHours(0,0,0,0),me&&me.setHours(0,0,0,0),_e&&me)return me.getTime()>=L.getTime()&&_e.getTime()<=A.getTime();if(_e&&!me)return _e<=A;if(!_e&&me)return me>=S;if(!_e&&!me)return!0}return!1}),U=k().filter(he=>{if(he.completed){if(he.completedAt){const De=new Date(he.completedAt);return De.setHours(0,0,0,0),De>=L&&De<=A}return!1}const _e=he.startDate?new Date(he.startDate):null,me=he.dueDate?new Date(he.dueDate):null;return _e&&_e.setHours(0,0,0,0),me&&me.setHours(0,0,0,0),_e&&me?me.getTime()>=L.getTime()&&_e.getTime()<=A.getTime():_e&&!me?_e<=A:!_e&&me?me>=L:!_e&&!me}),ae=[...P,...U];console.log("ğŸ“Š getMonthTodos ì •ë ¬ ì „ ì›”ê°„ì—…ë¬´ë³´ê³  ê°œìˆ˜:",ae.filter(he=>he.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")).length);const Ne={urgent:0,high:1,medium:2,low:3},Se=ae.sort((he,_e)=>{const me=Ne[he.priority]-Ne[_e.priority];if(me!==0)return me;const De=he.order||0,Pe=_e.order||0;return De!==Pe?De-Pe:new Date(he.createdAt).getTime()-new Date(_e.createdAt).getTime()});return console.log("ğŸ“Š getMonthTodos ì •ë ¬ í›„ ì›”ê°„ì—…ë¬´ë³´ê³ :",Se.filter(he=>he.title.includes("ì›”ê°„ì—…ë¬´ë³´ê³ ")).map(he=>`${he.title}: ${he.priority}`)),we(Se)},ie=()=>{const S=new Date;return S.setHours(0,0,0,0),e.todos.filter(L=>{if(!L.dueDate||L.completed)return!1;const A=new Date(L.dueDate);return A.setHours(0,0,0,0),A<S})},be=S=>{const L=S||new Date,A=new Date(L);return A.setDate(A.getDate()+1),e.todos.filter(P=>P.dueDate?new Date(P.dueDate).toDateString()===A.toDateString():!1)},ye=S=>{const L=S||new Date,A=new Date(L);return A.setHours(0,0,0,0),e.todos.filter(P=>{if(P.completed||!P.dueDate)return!1;const F=new Date(P.dueDate);return F.setHours(0,0,0,0),F.getTime()<A.getTime()})},ke=S=>{if(S.completed||!S.dueDate)return!1;const L=new Date;L.setHours(0,0,0,0);const A=new Date(S.dueDate);return A.setHours(0,0,0,0),A.getTime()<L.getTime()},E=async(S,L)=>{if(S.startsWith("recurring_")){const P=S.replace("recurring_","");r({type:"UPDATE_RECURRING_INSTANCE",payload:{id:P,updates:{order:L}}}),console.log("ë°˜ë³µ í• ì¼ ìˆœì„œ ì—…ë°ì´íŠ¸ ì„±ê³µ",{todoId:S,instanceId:P,newOrder:L})}else if(r({type:"UPDATE_TODO",payload:{id:S,updates:{order:L,updatedAt:new Date}}}),s?.uid)try{await ee.updateTodo(S,{order:L},s.uid),console.log("í• ì¼ ìˆœì„œ Firestore ì €ì¥ ì„±ê³µ",{todoId:S,newOrder:L})}catch(P){console.error("í• ì¼ ìˆœì„œ Firestore ì €ì¥ ì‹¤íŒ¨:",P)}},te=async(S,L,A)=>{const P=Array.from(A),[F]=P.splice(S,1);P.splice(L,0,F);const U=P.map((ae,Ne)=>E(ae.id,Ne));try{await Promise.all(U),console.log("ëª¨ë“  í• ì¼ ìˆœì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ",{count:U.length})}catch(ae){console.error("í• ì¼ ìˆœì„œ ì—…ë°ì´íŠ¸ ì¤‘ ì¼ë¶€ ì‹¤íŒ¨:",ae)}},Q=S=>{const L=[...e.todos,...k()],A=new Date;return A.setHours(0,0,0,0),L.filter(P=>{if(P.startDate&&!S.completionDateFilter){const F=new Date(P.startDate);if(F.setHours(0,0,0,0),F>A)return!1}if(S.searchTerm){const F=S.searchTerm.toLowerCase(),U=P.title.toLowerCase().includes(F),ae=P.description?.toLowerCase().includes(F)||!1,Ne=P.tags?.some(Se=>Se.toLowerCase().includes(F))||!1;if(!U&&!ae&&!Ne)return!1}if(S.priorityFilter&&S.priorityFilter!=="all"&&P.priority!==S.priorityFilter||S.typeFilter&&S.typeFilter!=="all"&&P.type!==S.typeFilter||S.projectFilter&&S.projectFilter!=="all"&&P.project!==S.projectFilter)return!1;if(S.tagFilter&&S.tagFilter.length>0){const F=P.tags||[];if(!S.tagFilter.some(ae=>F.includes(ae)))return!1}if(S.sharingFilterState){const{showPersonal:F,showMyShared:U,showGroupShared:ae,selectedGroupId:Ne}=S.sharingFilterState;if(Ne&&P.sharedGroupId!==Ne&&P.sharedGroupOwnerId!==Ne&&P.sharedGroupId!==Ne)return!1;const Se=P.visibility?.isPersonal!==!1,he=P.visibility?.isShared===!0,_e=he&&P.ownerId===s?.uid,me=he&&P.ownerId!==s?.uid;let De=!1;if(F&&Se&&!he&&(De=!0),U&&_e&&(De=!0),ae&&me&&(De=!0),!De)return!1}else if(S.sharingFilter&&S.sharingFilter!=="all"){const F=P.visibility?.isPersonal!==!1,U=P.visibility?.isShared===!0,ae=U&&P.ownerId===s?.uid,Ne=U&&P.ownerId!==s?.uid;if(S.sharingFilter==="private"){if(U||!F)return!1}else if(S.sharingFilter==="shared"){if(!Ne)return!1}else if(S.sharingFilter==="my_shared"){if(!ae)return!1}else if(P.sharedGroupId!==S.sharingFilter)return!1}if(S.completionDateFilter&&S.completionDateFilter!=="all"&&P.completedAt){const F=new Date(P.completedAt),U=new Date;switch(S.completionDateFilter){case"today":if(F.toDateString()!==U.toDateString())return!1;break;case"yesterday":const ae=new Date;if(ae.setDate(U.getDate()-1),F.toDateString()!==ae.toDateString())return!1;break;case"thisWeek":const Ne=new Date(U);if(Ne.setDate(U.getDate()-U.getDay()),Ne.setHours(0,0,0,0),F<Ne)return!1;break;case"lastWeek":const Se=new Date(U);Se.setDate(U.getDate()-U.getDay()-7),Se.setHours(0,0,0,0);const he=new Date(U);if(he.setDate(U.getDate()-U.getDay()-1),he.setHours(23,59,59,999),F<Se||F>he)return!1;break;case"thisMonth":const _e=new Date(U.getFullYear(),U.getMonth(),1);if(F<_e)return!1;break}}return!(S.includeCompleted===!1&&P.completed)})},H=async S=>{console.log("=== ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì‹œì‘ ==="),console.log("currentUser:",s),console.log("templateData:",S);try{if(s){console.log("Firestore ëª¨ë“œë¡œ ì €ì¥ ì‹œë„");const L=await ee.addRecurringTemplate(S,s.uid);console.log("ë°˜ë³µ í…œí”Œë¦¿ Firestore ì €ì¥ ì„±ê³µ:",L),console.log("âœ… í…œí”Œë¦¿ ì €ì¥ ì™„ë£Œ - ì¸ìŠ¤í„´ìŠ¤ëŠ” useEffectì—ì„œ ìë™ ìƒì„±ë¨")}else{console.log("ë¹„ë¡œê·¸ì¸ ëª¨ë“œ: ë©”ëª¨ë¦¬ì— ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€");const L={...S,id:mo(),createdAt:new Date,updatedAt:new Date};r({type:"ADD_RECURRING_TEMPLATE",payload:L})}console.log("=== ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì™„ë£Œ ===")}catch(L){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì‹¤íŒ¨:",L),r({type:"SET_ERROR",payload:"ë°˜ë³µ í• ì¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},I=async(S,L)=>{console.log("ğŸ”§ ë°˜ë³µ í…œí”Œë¦¿ ìˆ˜ì • ì‹œì‘"),console.log("í…œí”Œë¦¿ ID:",S),console.log("ìˆ˜ì • ë°ì´í„°:",L);try{if(s)console.log("ğŸ”¥ Firebase ì‚¬ìš©ì - í…œí”Œë¦¿ë§Œ ì—…ë°ì´íŠ¸ (ì¸ìŠ¤í„´ìŠ¤ëŠ” useEffectì—ì„œ ìë™ ì²˜ë¦¬)"),console.log("1ï¸âƒ£ Firestore í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ë§Œ ìˆ˜í–‰"),await ee.updateRecurringTemplate(S,L,s.uid),console.log("âœ… ë°˜ë³µ í…œí”Œë¦¿ Firestore ì—…ë°ì´íŠ¸ ì™„ë£Œ:",S),console.log("2ï¸âƒ£ ë¡œì»¬ ìƒíƒœ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸"),r({type:"UPDATE_RECURRING_TEMPLATE",payload:{id:S,updates:L}}),console.log("âœ… ë¡œì»¬ ìƒíƒœ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì™„ë£Œ"),console.log("ğŸ’¡ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„±ì€ useEffectì—ì„œ ìë™ ì²˜ë¦¬ë©ë‹ˆë‹¤.");else{console.log("ë¹„ë¡œê·¸ì¸ ëª¨ë“œ: ë©”ëª¨ë¦¬ì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸");const A=e.todos.filter(P=>P._templateId===S);console.log(`í…œí”Œë¦¿ ${S}ì—ì„œ ìƒì„±ëœ í• ì¼ ${A.length}ê°œ ë°œê²¬`);for(const P of A)console.log(`í• ì¼ ì‚­ì œ: ${P.title} (${P.id})`),r({type:"DELETE_TODO",payload:P.id});r({type:"UPDATE_RECURRING_TEMPLATE",payload:{id:S,updates:L}}),setTimeout(()=>{console.log("ì—…ë°ì´íŠ¸ëœ í…œí”Œë¦¿ìœ¼ë¡œ ìƒˆë¡œìš´ í• ì¼ ìƒì„± ì‹œì‘"),O()},100)}console.log("=== ë°˜ë³µ í…œí”Œë¦¿ ìˆ˜ì • ì™„ë£Œ ===")}catch(A){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",A),r({type:"SET_ERROR",payload:"ë°˜ë³µ í• ì¼ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},J=async S=>{try{s?(r({type:"DELETE_RECURRING_TEMPLATE",payload:S}),console.log("âœ… ì¦‰ì‹œ UIì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ì œê±°:",S),await ee.deleteRecurringTemplate(S,s.uid),console.log("âœ… ë°˜ë³µ í…œí”Œë¦¿ Firestore ì‚­ì œ ì„±ê³µ:",S)):(console.log("ë¹„ë¡œê·¸ì¸ ëª¨ë“œ: ë©”ëª¨ë¦¬ì—ì„œ ë°˜ë³µ í…œí”Œë¦¿ ì‚­ì œ"),r({type:"DELETE_RECURRING_TEMPLATE",payload:S}),console.log("ğŸš« ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì - localStorage ì‚¬ìš© ë¹„í™œì„±í™”, ë©”ëª¨ë¦¬ë§Œ ì—…ë°ì´íŠ¸"))}catch(L){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì‚­ì œ ì‹¤íŒ¨:",L),r({type:"SET_ERROR",payload:"ë°˜ë³µ í• ì¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},ce=async()=>{if(!s)return;const S={};e.recurringTemplates.forEach(A=>{const F=[A.title,A.recurrenceType,A.recurrenceType==="weekly"?A.weekday:"",A.recurrenceType==="monthly"?`${A.monthlyDate}-${A.monthlyPattern}-${A.monthlyWeek}-${A.monthlyWeekday}`:""].join("|");S[F]||(S[F]=[]),S[F].push(A)});const L=Object.values(S).filter(A=>A.length>1);if(L.length>0){console.log(`âŒ ${L.length}ê°œ ê·¸ë£¹ì˜ ì¤‘ë³µ í…œí”Œë¦¿ ë°œê²¬`);for(const A of L){const P=A.sort((ae,Ne)=>new Date(Ne.createdAt).getTime()-new Date(ae.createdAt).getTime()),F=P[0],U=P.slice(1);console.log(`ğŸ—‘ï¸ '${F.title}' ì¤‘ë³µ ${U.length}ê°œ ì‚­ì œ ì˜ˆì •`);for(const ae of U)await J(ae.id)}console.log("âœ… ì¤‘ë³µ ì •ë¦¬ ì™„ë£Œ")}};y.useEffect(()=>{if(e.recurringTemplates.length>0&&s){const S=setTimeout(()=>{ce()},2e3);return()=>clearTimeout(S)}},[e.recurringTemplates,s]);const O=()=>{if(s){console.log("ğŸš«ğŸš«ğŸš« ë¡œê·¸ì¸ ì‚¬ìš©ì - ë¡œì»¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ì „ ì°¨ë‹¨!");return}if(n){console.log("â³ ì¸ì¦ ë¡œë”© ì¤‘ - ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ëŒ€ê¸°");return}let S=[];e.recurringTemplates.filter(L=>L.isActive).forEach(L=>{try{const A=Ps.generateInstances(L);S=[...S,...A]}catch(A){console.error(`í…œí”Œë¦¿ ${L.id} ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹¤íŒ¨:`,A)}}),r({type:"SET_RECURRING_INSTANCES",payload:S})},G=async()=>{if(!s){console.log("âŒ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ");return}console.log("ğŸ”„ Firestore ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹œì‘..."),r({type:"SET_LOADING",payload:!0});try{const S=await ee.getTodos(s.uid);console.log("âœ… ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì„±ê³µ:",S.length,"ê°œ í• ì¼"),r({type:"SET_TODOS",payload:S}),r({type:"SET_ERROR",payload:null})}catch(S){console.error("âŒ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:",S),r({type:"SET_ERROR",payload:"ë°ì´í„° ìƒˆë¡œê³ ì¹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})}finally{r({type:"SET_LOADING",payload:!1})}},M=async()=>{if(!s){console.log("âŒ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì");return}console.log("ğŸš¨ ê¸´ê¸‰ ìˆ˜ì •: Firebase ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì™„ì „ ì¬ìƒì„± ì‹œì‘");try{console.log("1ï¸âƒ£ ëª¨ë“  ê¸°ì¡´ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ ì¤‘...");const S=await ee.getRecurringInstances(s.uid);console.log(`ì‚­ì œí•  ì¸ìŠ¤í„´ìŠ¤ ê°œìˆ˜: ${S.length}`);for(const A of S)await ee.deleteRecurringInstance(A.id,s.uid),console.log(`âœ… ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ: ${A.id}`);console.log("2ï¸âƒ£ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì¤‘...");const L=e.recurringTemplates.filter(A=>A.isActive);console.log(`í™œì„± í…œí”Œë¦¿ ê°œìˆ˜: ${L.length}`);for(const A of L){console.log(`ğŸ”„ í…œí”Œë¦¿ ì²˜ë¦¬: ${A.title} (monthlyDate: ${A.monthlyDate})`);const P=Ps.generateInstances(A);console.log(`ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤: ${P.length}ê°œ`);for(const F of P){const U={templateId:F.templateId,date:F.date,completed:!1,createdAt:F.createdAt,updatedAt:F.updatedAt},ae=await ee.addRecurringInstance(U,s.uid);console.log(`âœ… ì¸ìŠ¤í„´ìŠ¤ ì €ì¥: ${ae} - ${F.date.toDateString()}`)}}console.log("3ï¸âƒ£ ë¡œì»¬ ìƒíƒœ ìƒˆë¡œê³ ì¹¨ ì¤‘..."),await G(),console.log("âœ… ê¸´ê¸‰ ìˆ˜ì • ì™„ë£Œ!"),alert(`âœ… ë°˜ë³µ í• ì¼ ë¬¸ì œê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!
í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`)}catch(S){console.error("âŒ ê¸´ê¸‰ ìˆ˜ì • ì‹¤íŒ¨:",S),alert("âŒ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},se=async()=>{if(!s){console.log("âŒ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì");return}console.log("ğŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘ (ì‚­ì œ í›„ í˜¸ì¶œ)");try{const S=await ee.getTodos(s.uid);console.log("âœ… ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì„±ê³µ:",S.length,"ê°œ í• ì¼"),r({type:"SET_TODOS",payload:S})}catch(S){console.error("âŒ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:",S)}},ue=y.useCallback(async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ í™•ì¸ ì¤‘...");return}try{console.log("ğŸ§¹ ê³ ì•„ ë°ì´í„° ì •ë¦¬ ì‹œì‘");const S=await vo.cleanupOrphanedInstances(s.uid);console.log("âœ… ê³ ì•„ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ:",S),alert(`âœ… ì •ë¦¬ ì™„ë£Œ!
- ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤: ${S.orphanedInstances}ê°œ
- ê³ ì•„ í• ì¼: ${S.orphanedTodos}ê°œ
- ì´ ì •ë¦¬: ${S.totalCleaned}ê°œ`),await G()}catch(S){console.error("âŒ ê³ ì•„ ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨:",S),alert("âŒ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[s]),ge=y.useCallback(async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ í™•ì¸ ì¤‘...");return}try{console.log("ğŸ” ë°ì´í„° ì •í•©ì„± ê²€ì¦ ì‹œì‘");const S=await vo.validateTemplateConsistency(s.uid);console.log("âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦ ì™„ë£Œ - ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”"),alert(`âœ… ê²€ì¦ ì™„ë£Œ!
ì´ ${S.size}ê°œ í…œí”Œë¦¿ì˜ ë°ì´í„° í˜„í™©ì„ ì½˜ì†”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.`)}catch(S){console.error("âŒ ë°ì´í„° ì •í•©ì„± ê²€ì¦ ì‹¤íŒ¨:",S),alert("âŒ ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[s]),re=y.useCallback(async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ í™•ì¸ ì¤‘...");return}if(!window.confirm(`ğŸ§¹ ì•ˆì „í•œ ì •ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

ğŸ—‘ï¸ ì‚­ì œ: ì‚­ì œëœ í…œí”Œë¦¿ì˜ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤ë§Œ
âœ… ìœ ì§€: ëª¨ë“  í™œì„± í…œí”Œë¦¿ì˜ ì¸ìŠ¤í„´ìŠ¤

ë°˜ë³µ í• ì¼ë“¤ì€ ê·¸ëŒ€ë¡œ ë³´ì…ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)){console.log("âŒ ì‚¬ìš©ìê°€ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤");return}try{console.log("ğŸ§¹ ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì‹œì‘");const L=await vo.smartCleanupInstances(s.uid);console.log("âœ… ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì™„ë£Œ:",L),alert(`âœ… ì•ˆì „ ì •ë¦¬ ì™„ë£Œ!

ì‚­ì œ: ${L.deletedInstances}ê°œ ê³ ì•„ ì¸ìŠ¤í„´ìŠ¤
ìœ ì§€: ${L.keptInstances}ê°œ í™œì„± ì¸ìŠ¤í„´ìŠ¤

ë°˜ë³µ í• ì¼ë“¤ ê·¸ëŒ€ë¡œ ë³´ì…ë‹ˆë‹¤! ğŸ‰`),setTimeout(()=>{window.location.reload()},1e3)}catch(L){console.error("âŒ ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì‹¤íŒ¨:",L),alert("âŒ ìŠ¤ë§ˆíŠ¸ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[s]);y.useEffect(()=>{typeof window<"u"&&(window.fixRecurringInstances=M,window.cleanupOrphanedData=ue,window.validateDataConsistency=ge,window.smartCleanupInstances=re,window.checkLoginStatus=()=>{console.log("ë¡œê·¸ì¸ ìƒíƒœ:",s?"âœ… ë¡œê·¸ì¸ë¨":"âŒ ë¡œê·¸ì¸ ì•ˆë¨"),s&&console.log("ì‚¬ìš©ì:",s.email)},window.forceRegenerateInstances=async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í•„ìš”");return}console.log("ğŸ”„ ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ê°•ì œ ì¬ìƒì„± ì‹œì‘...");try{await Promise.all(e.recurringTemplates.filter(S=>S.isActive!==!1).map(S=>ee.regenerateRecurringInstances(S.id,s.uid))),console.log("âœ… ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”."),setTimeout(()=>window.location.reload(),1e3)}catch(S){console.error("âŒ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì‹¤íŒ¨:",S)}},window.fixBusinessTripTemplate=async()=>{if(!s?.uid){console.log("ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í•„ìš”");return}try{console.log("ğŸ”§ ì¶œì¥ë¹„ ì§€ê¸‰ ì‹ ì²­ í…œí”Œë¦¿ ìˆ˜ì • ì‹œì‘...");const S=e.recurringTemplates.find(A=>A.title.includes("ì¶œì¥ë¹„")&&A.title.includes("ì§€ê¸‰")&&A.title.includes("ì‹ ì²­"));if(!S){console.log("âŒ ì¶œì¥ë¹„ ì§€ê¸‰ ì‹ ì²­ í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),console.log("ğŸ“‹ í˜„ì¬ í…œí”Œë¦¿ë“¤:",e.recurringTemplates.map(A=>A.title));return}console.log("ğŸ“‹ ê¸°ì¡´ í…œí”Œë¦¿ ë°ì´í„°:",S);const L={monthlyPattern:"weekday",monthlyWeek:"fourth",monthlyWeekday:2,monthlyDate:void 0};console.log("ğŸ” ìš”ì¼ í™•ì¸:"),console.log("  0=ì¼, 1=ì›”, 2=í™”, 3=ìˆ˜, 4=ëª©, 5=ê¸ˆ, 6=í† "),console.log(`  ì„¤ì •ê°’ 2 = ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][2]}ìš”ì¼`),console.log("ğŸ”§ ì ìš©í•  ì—…ë°ì´íŠ¸:",L),await ee.updateRecurringTemplate(S.id,L,s.uid),console.log("âœ… ì¶œì¥ë¹„ ì§€ê¸‰ ì‹ ì²­ í…œí”Œë¦¿ ìˆ˜ì • ì™„ë£Œ!"),console.log("ğŸ”„ ì¸ìŠ¤í„´ìŠ¤ ì¬ìƒì„± ì¤‘..."),await ee.regenerateRecurringInstances(S.id,s.uid),console.log("ğŸ¯ ëª¨ë“  ì‘ì—… ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”."),setTimeout(()=>window.location.reload(),1e3)}catch(S){console.error("âŒ í…œí”Œë¦¿ ìˆ˜ì • ì‹¤íŒ¨:",S)}},console.log("  - cleanupOrphanedData(): ê³ ì•„ ë°ì´í„° ì •ë¦¬"))},[]);const Ie=y.useCallback(()=>{const S={todos:e.todos,recurringTemplates:e.recurringTemplates,recurringInstances:e.recurringInstances,exportedAt:new Date().toISOString(),version:"1.0.0"};return JSON.stringify(S,null,2)},[e]),K=y.useCallback(async S=>{try{const L=JSON.parse(S);if(!L.todos)throw new Error("Invalid data format");const A=L.todos.map(P=>({...P,createdAt:new Date(P.createdAt),updatedAt:new Date(P.updatedAt),dueDate:P.dueDate?new Date(P.dueDate):void 0,startDate:P.startDate?new Date(P.startDate):void 0,completedAt:P.completedAt?new Date(P.completedAt):void 0}));return r(s?{type:"SET_TODOS",payload:A}:{type:"SET_TODOS",payload:A}),!0}catch(L){return console.error("Import failed:",L),!1}},[s]),pe=y.useCallback(async()=>{const S=e.todos.filter(L=>L.completed);for(const L of S)await N(L.id)},[e.todos,N]),Fe=y.useCallback(async()=>{await V()},[V]),X=y.useMemo(()=>({total:e.todos.length,completed:e.todos.filter(S=>S.completed).length,pending:e.todos.filter(S=>!S.completed).length}),[e.todos]),ve=y.useMemo(()=>{const S=new Set;return e.todos.forEach(L=>{L.tags?.forEach(A=>S.add(A))}),Array.from(S).sort()},[e.todos]),Be=y.useMemo(()=>({...e,addTodo:_,updateTodo:j,deleteTodo:N,toggleTodo:D,addSubTask:q,updateSubTask:z,deleteSubTask:de,toggleSubTask:Te,syncWithFirestore:V,getTodayTodos:fe,getWeekTodos:W,getMonthTodos:le,getOverdueTodos:ie,getTomorrowTodos:be,getYesterdayIncompleteTodos:ye,isYesterdayIncompleteTodo:ke,updateTodoOrder:E,reorderTodos:te,getFilteredTodos:Q,addRecurringTemplate:H,updateRecurringTemplate:I,deleteRecurringTemplate:J,generateRecurringInstances:O,getRecurringTodos:k,cleanupDuplicateTemplates:ce,forceRefresh:G,manualRefresh:se,initializeOrderValues:$,fixRecurringInstances:M,cleanupOrphanedData:ue,validateDataConsistency:ge,smartCleanupInstances:re,exportData:Ie,importData:K,clearCompleted:pe,syncWithCloud:Fe,stats:X,searchQuery:l,setSearchQuery:c,filterStatus:d,setFilterStatus:u,filterPriority:h,setFilterPriority:g,filterTags:m,setFilterTags:x,allTags:ve,loadHistoricalTodos:C}),[e,_,j,N,D,q,z,de,Te,V,fe,W,le,ie,be,ye,ke,E,te,Q,H,I,J,O,k,ce,G,se,$,M,ue,ge,re,Ie,K,pe,Fe,X,l,d,h,m,ve,C]);return a.jsx(Ym.Provider,{value:Be,children:t})},ot=()=>{const t=y.useContext(Ym);if(t===void 0)throw new Error("useTodos must be used within a TodoProvider");return t},Zv=""+new URL("spring-BGWA7yXD.png",import.meta.url).href,ew=""+new URL("summer-CjIC62DS.png",import.meta.url).href,tw=""+new URL("autumn-BG-LnTZL.png",import.meta.url).href,rw=""+new URL("winter-DAuiEEo5.png",import.meta.url).href,sw=""+new URL("cairo-I1imc-3j.png",import.meta.url).href,nw=""+new URL("london-BoQJuASl.png",import.meta.url).href,aw=""+new URL("la-B40MlFfI.png",import.meta.url).href,iw=""+new URL("moscow-D9umQ37v.png",import.meta.url).href,ow=""+new URL("seoul-B24cE2-E.png",import.meta.url).href,lw=""+new URL("busan-Bf0kI0T7.png",import.meta.url).href,cw=""+new URL("jeju-B6AoNdX5.png",import.meta.url).href,dw=""+new URL("gyeongju-BrzVrSPq.png",import.meta.url).href,uw=""+new URL("gwangju-BRYg9XQh.png",import.meta.url).href,hw=""+new URL("tokyo-BBaYvFGH.png",import.meta.url).href,gw=""+new URL("beijing-ZpOGQqN0.png",import.meta.url).href,mw=""+new URL("hongkong-BNpYcxIk.png",import.meta.url).href,fw=""+new URL("bangkok-DXzlawOf.png",import.meta.url).href,pw=""+new URL("hanoi-Bs9-it64.png",import.meta.url).href,ls={colors:[{id:"blue",nameKey:"settings.colorTheme.blue",color:"blue",colorClass:"bg-blue-500"},{id:"sky",nameKey:"settings.colorTheme.sky",color:"sky",colorClass:"bg-sky-500"},{id:"teal",nameKey:"settings.colorTheme.teal",color:"teal",colorClass:"bg-teal-500"},{id:"green",nameKey:"settings.colorTheme.forest",color:"green",colorClass:"bg-green-500"},{id:"lime",nameKey:"settings.colorTheme.lime",color:"lime",colorClass:"bg-lime-500"},{id:"orange",nameKey:"settings.colorTheme.sunset",color:"orange",colorClass:"bg-orange-500"},{id:"red",nameKey:"settings.colorTheme.red",color:"red",colorClass:"bg-red-500"},{id:"pink",nameKey:"settings.colorTheme.berry",color:"pink",colorClass:"bg-pink-500"},{id:"purple",nameKey:"settings.colorTheme.purple",color:"purple",colorClass:"bg-purple-500"},{id:"indigo",nameKey:"settings.colorTheme.indigo",color:"indigo",colorClass:"bg-indigo-500"},{id:"gray",nameKey:"settings.colorTheme.gray",color:"gray",colorClass:"bg-gray-500"}],seasonal:[{id:"spring",nameKey:"settings.seasonal.spring",color:"pink",colorClass:"bg-pink-500",bg:Zv,overlay:"bg-white/60 dark:bg-black/40"},{id:"summer",nameKey:"settings.seasonal.summer",color:"blue",colorClass:"bg-blue-500",bg:ew,overlay:"bg-white/60 dark:bg-black/40"},{id:"autumn",nameKey:"settings.seasonal.autumn",color:"orange",colorClass:"bg-orange-500",bg:tw,overlay:"bg-white/60 dark:bg-black/40"},{id:"winter",nameKey:"settings.seasonal.winter",color:"sky",colorClass:"bg-sky-500",bg:rw,overlay:"bg-white/60 dark:bg-black/40"}],city:[{id:"cairo",nameKey:"settings.city.cairo",color:"orange",colorClass:"bg-orange-500",bg:sw,overlay:"bg-white/70 dark:bg-black/50"},{id:"london",nameKey:"settings.city.london",color:"sky",colorClass:"bg-sky-500",bg:nw,overlay:"bg-white/70 dark:bg-black/50"},{id:"la",nameKey:"settings.city.la",color:"purple",colorClass:"bg-purple-500",bg:aw,overlay:"bg-white/60 dark:bg-black/40"},{id:"moscow",nameKey:"settings.city.moscow",color:"indigo",colorClass:"bg-indigo-500",bg:iw,overlay:"bg-white/60 dark:bg-black/50"},{id:"seoul",nameKey:"settings.city.seoul",color:"blue",colorClass:"bg-blue-600",bg:ow,overlay:"bg-white/60 dark:bg-black/40"},{id:"busan",nameKey:"settings.city.busan",color:"sky",colorClass:"bg-sky-500",bg:lw,overlay:"bg-white/60 dark:bg-black/40"},{id:"jeju",nameKey:"settings.city.jeju",color:"green",colorClass:"bg-green-500",bg:cw,overlay:"bg-white/60 dark:bg-black/30"},{id:"gyeongju",nameKey:"settings.city.gyeongju",color:"orange",colorClass:"bg-orange-600",bg:dw,overlay:"bg-white/60 dark:bg-black/50"},{id:"gwangju",nameKey:"settings.city.gwangju",color:"teal",colorClass:"bg-teal-600",bg:uw,overlay:"bg-white/60 dark:bg-black/40"},{id:"tokyo",nameKey:"settings.city.tokyo",color:"pink",colorClass:"bg-pink-500",bg:hw,overlay:"bg-white/60 dark:bg-black/40"},{id:"beijing",nameKey:"settings.city.beijing",color:"red",colorClass:"bg-red-600",bg:gw,overlay:"bg-white/60 dark:bg-black/40"},{id:"hongkong",nameKey:"settings.city.hongkong",color:"purple",colorClass:"bg-purple-600",bg:mw,overlay:"bg-white/60 dark:bg-black/40"},{id:"bangkok",nameKey:"settings.city.bangkok",color:"orange",colorClass:"bg-orange-500",bg:fw,overlay:"bg-white/60 dark:bg-black/40"},{id:"hanoi",nameKey:"settings.city.hanoi",color:"green",colorClass:"bg-green-600",bg:pw,overlay:"bg-white/60 dark:bg-black/40"}]},qm=y.createContext(void 0),Lt=()=>{const t=y.useContext(qm);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t},yw=({children:t})=>{const[e,r]=y.useState(()=>localStorage.getItem("theme")||"system"),[s,n]=y.useState(!1),[i,o]=y.useState(()=>{const h=localStorage.getItem("themeTransparency");return h?parseFloat(h):.1}),[l,c]=y.useState(()=>{const h=localStorage.getItem("visualThemeId");if(!h){const g=localStorage.getItem("colorTheme");return g==="sunset"?"orange":g==="forest"?"green":g==="berry"?"pink":"blue"}return h}),u=(h=>[...ls.colors,...ls.seasonal,...ls.city].find(m=>m.id===h)||ls.colors[0])(l);return y.useEffect(()=>{const h=window.document.documentElement,g=()=>{h.classList.remove("dark");let m;e==="system"?m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":m=e,m==="dark"&&h.classList.add("dark"),n(m==="dark")};if(g(),localStorage.setItem("theme",e),e==="system"){const m=window.matchMedia("(prefers-color-scheme: dark)"),x=()=>g();return m.addEventListener("change",x),()=>m.removeEventListener("change",x)}},[e]),y.useEffect(()=>{const h=window.document.documentElement,g=document.body,m=["blue","orange","green","pink","purple","red","teal","sky","lime","indigo","gray"];h.classList.remove(...m.map(x=>`theme-${x}`)),h.classList.remove("theme-sunset","theme-forest","theme-berry"),u.color!=="blue"&&h.classList.add(`theme-${u.color}`),u.bg?(g.style.backgroundImage=`url('${u.bg}')`,g.style.backgroundSize="cover",g.style.backgroundPosition="center",g.style.backgroundAttachment="fixed",h.classList.add("has-visual-theme"),h.style.setProperty("--glass-opacity",i.toString())):(g.style.backgroundImage="",g.style.backgroundSize="",g.style.backgroundPosition="",g.style.backgroundAttachment="",h.classList.remove("has-visual-theme"),h.style.removeProperty("--glass-opacity")),localStorage.setItem("visualThemeId",l),localStorage.setItem("themeTransparency",i.toString())},[l,u,i]),a.jsx(qm.Provider,{value:{theme:e,setTheme:r,isDark:s,currentThemeId:l,setCurrentThemeId:c,currentTheme:u,transparency:i,setTransparency:o},children:t})},xw=["lkd0115lkd@gmail.com"],Hr=t=>t?xw.includes(t):!1;var su={};const nu="@firebase/database",au="1.0.20";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xm="";function bw(t){Xm=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,r){r==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ut(r))}get(e){const r=this.domStorage_.getItem(this.prefixedName_(e));return r==null?null:nc(r)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,r){r==null?delete this.cache_[e]:this.cache_[e]=r}get(e){return Ir(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qm=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new vw(e)}}catch{}return new ww},cs=Qm("localStorage"),kw=Qm("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hs=new lm("@firebase/database"),Tw=function(){let t=1;return function(){return t++}}(),Jm=function(t){const e=Dx(t),r=new Cx;r.update(e);const s=r.digest();return Ex.encodeByteArray(s)},va=function(...t){let e="";for(let r=0;r<t.length;r++){const s=t[r];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=va.apply(null,s):typeof s=="object"?e+=ut(s):e+=s,e+=" "}return e};let Mn=null,iu=!0;const Nw=function(t,e){oe(!0,"Can't turn on custom loggers persistently."),Hs.logLevel=cm.VERBOSE,Mn=Hs.log.bind(Hs)},Tt=function(...t){if(iu===!0&&(iu=!1,Mn===null&&kw.get("logging_enabled")===!0&&Nw()),Mn){const e=va.apply(null,t);Mn(e)}},wa=function(t){return function(...e){Tt(t,...e)}},al=function(...t){const e="FIREBASE INTERNAL ERROR: "+va(...t);Hs.error(e)},Dr=function(...t){const e=`FIREBASE FATAL ERROR: ${va(...t)}`;throw Hs.error(e),new Error(e)},Mt=function(...t){const e="FIREBASE WARNING: "+va(...t);Hs.warn(e)},Sw=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Mt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Zm=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},jw=function(t){if(document.readyState==="complete")t();else{let e=!1;const r=function(){if(!document.body){setTimeout(r,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&r()}),window.attachEvent("onload",r))}},Qs="[MIN_NAME]",Ts="[MAX_NAME]",nn=function(t,e){if(t===e)return 0;if(t===Qs||e===Ts)return-1;if(e===Qs||t===Ts)return 1;{const r=ou(t),s=ou(e);return r!==null?s!==null?r-s===0?t.length-e.length:r-s:-1:s!==null?1:t<e?-1:1}},_w=function(t,e){return t===e?0:t<e?-1:1},Tn=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+ut(e))},gc=function(t){if(typeof t!="object"||t===null)return ut(t);const e=[];for(const s in t)e.push(s);e.sort();let r="{";for(let s=0;s<e.length;s++)s!==0&&(r+=","),r+=ut(e[s]),r+=":",r+=gc(t[e[s]]);return r+="}",r},ef=function(t,e){const r=t.length;if(r<=e)return[t];const s=[];for(let n=0;n<r;n+=e)n+e>r?s.push(t.substring(n,r)):s.push(t.substring(n,n+e));return s};function Ot(t,e){for(const r in t)t.hasOwnProperty(r)&&e(r,t[r])}const tf=function(t){oe(!Zm(t),"Invalid JSON number");const e=11,r=52,s=(1<<e-1)-1;let n,i,o,l,c;t===0?(i=0,o=0,n=1/t===-1/0?1:0):(n=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),s),i=l+s,o=Math.round(t*Math.pow(2,r-l)-Math.pow(2,r))):(i=0,o=Math.round(t/Math.pow(2,1-s-r))));const d=[];for(c=r;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(n?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let g=parseInt(u.substr(c,8),2).toString(16);g.length===1&&(g="0"+g),h=h+g}return h.toLowerCase()},Dw=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Cw=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Ew(t,e){let r="Unknown Error";t==="too_big"?r="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?r="Client doesn't have permission to access the desired data.":t==="unavailable"&&(r="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+r);return s.code=t.toUpperCase(),s}const Iw=new RegExp("^-?(0*)\\d{1,10}$"),Aw=-2147483648,Rw=2147483647,ou=function(t){if(Iw.test(t)){const e=Number(t);if(e>=Aw&&e<=Rw)return e}return null},an=function(t){try{t()}catch(e){setTimeout(()=>{const r=e.stack||"";throw Mt("Exception was thrown by user callback.",r),e},Math.floor(0))}},Pw=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},On=function(t,e){const r=setTimeout(t,e);return typeof r=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(r):typeof r=="object"&&r.unref&&r.unref(),r};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{constructor(e,r){this.appCheckProvider=r,this.appName=e.name,rm(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=r?.getImmediate({optional:!0}),this.appCheck||r?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((r,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(r,s):r(null)},0)})}addTokenChangeListener(e){var r;(r=this.appCheckProvider)===null||r===void 0||r.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){Mt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ow{constructor(e,r,s){this.appName_=e,this.firebaseOptions_=r,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(n=>this.auth_=n)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(r=>r&&r.code==="auth/token-not-initialized"?(Tt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(r)):new Promise((r,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(r,s):r(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(r=>r.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(r=>r.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Mt(e)}}class Ka{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ka.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc="5",rf="v",sf="s",nf="r",af="f",of=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,lf="ls",cf="p",il="ac",df="websocket",uf="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e,r,s,n,i=!1,o="",l=!1,c=!1,d=null){this.secure=r,this.namespace=s,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=cs.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&cs.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",r=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${r}`}}function Lw(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function gf(t,e,r){oe(typeof e=="string","typeof type must == string"),oe(typeof r=="object","typeof params must == object");let s;if(e===df)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===uf)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Lw(t)&&(r.ns=t.namespace);const n=[];return Ot(r,(i,o)=>{n.push(i+"="+o)}),s+n.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(){this.counters_={}}incrementCounter(e,r=1){Ir(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=r}get(){return Mx(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo={},ko={};function fc(t){const e=t.toString();return wo[e]||(wo[e]=new $w),wo[e]}function Fw(t,e){const r=t.toString();return ko[r]||(ko[r]=e()),ko[r]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ww{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,r){this.closeAfterResponse=e,this.onClose=r,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,r){for(this.pendingResponses[e]=r;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let n=0;n<s.length;++n)s[n]&&an(()=>{this.onMessage_(s[n])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lu="start",Vw="close",Uw="pLPCommand",Bw="pRTLPCB",mf="id",ff="pw",pf="ser",Hw="cb",Gw="seg",zw="ts",Kw="d",Yw="dframe",yf=1870,xf=30,qw=yf-xf,Xw=25e3,Qw=3e4;class Ls{constructor(e,r,s,n,i,o,l){this.connId=e,this.repoInfo=r,this.applicationId=s,this.appCheckToken=n,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wa(e),this.stats_=fc(r),this.urlFn=c=>(this.appCheckToken&&(c[il]=this.appCheckToken),gf(r,uf,c))}open(e,r){this.curSegmentNum=0,this.onDisconnect_=r,this.myPacketOrderer=new Ww(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Qw)),jw(()=>{if(this.isClosed_)return;this.scriptTagHolder=new pc((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===lu)this.id=l,this.password=c;else if(o===Vw)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[lu]="t",s[pf]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[Hw]=this.scriptTagHolder.uniqueCallbackIdentifier),s[rf]=mc,this.transportSessionId&&(s[sf]=this.transportSessionId),this.lastSessionId&&(s[lf]=this.lastSessionId),this.applicationId&&(s[cf]=this.applicationId),this.appCheckToken&&(s[il]=this.appCheckToken),typeof location<"u"&&location.hostname&&of.test(location.hostname)&&(s[nf]=af);const n=this.urlFn(s);this.log_("Connecting via long-poll to "+n),this.scriptTagHolder.addTag(n,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ls.forceAllow_=!0}static forceDisallow(){Ls.forceDisallow_=!0}static isAvailable(){return Ls.forceAllow_?!0:!Ls.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Dw()&&!Cw()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const r=ut(e);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const s=Ox(r),n=ef(s,qw);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(e,r){this.myDisconnFrame=document.createElement("iframe");const s={};s[Yw]="t",s[mf]=e,s[ff]=r,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const r=ut(e).length;this.bytesReceived+=r,this.stats_.incrementCounter("bytes_received",r)}}class pc{constructor(e,r,s,n){this.onDisconnect=s,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Tw(),window[Uw+this.uniqueCallbackIdentifier]=e,window[Bw+this.uniqueCallbackIdentifier]=r,this.myIFrame=pc.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){Tt("frame writing exception"),l.stack&&Tt(l.stack),Tt(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Tt("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,r){for(this.myID=e,this.myPW=r,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[mf]=this.myID,e[ff]=this.myPW,e[pf]=this.currentSerial;let r=this.urlFn(e),s="",n=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+xf+s.length<=yf;){const o=this.pendingSegs.shift();s=s+"&"+Gw+n+"="+o.seg+"&"+zw+n+"="+o.ts+"&"+Kw+n+"="+o.d,n++}return r=r+s,this.addLongPollTag_(r,this.currentSerial),!0}else return!1}enqueueSegment(e,r,s){this.pendingSegs.push({seg:e,ts:r,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,r){this.outstandingRequests.add(r);const s=()=>{this.outstandingRequests.delete(r),this.newRequest_()},n=setTimeout(s,Math.floor(Xw)),i=()=>{clearTimeout(n),s()};this.addTag(e,i)}addTag(e,r){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const n=s.readyState;(!n||n==="loaded"||n==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),r())},s.onerror=()=>{Tt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jw=16384,Zw=45e3;let li=null;typeof MozWebSocket<"u"?li=MozWebSocket:typeof WebSocket<"u"&&(li=WebSocket);class er{constructor(e,r,s,n,i,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wa(this.connId),this.stats_=fc(r),this.connURL=er.connectionURL_(r,o,l,n,s),this.nodeAdmin=r.nodeAdmin}static connectionURL_(e,r,s,n,i){const o={};return o[rf]=mc,typeof location<"u"&&location.hostname&&of.test(location.hostname)&&(o[nf]=af),r&&(o[sf]=r),s&&(o[lf]=s),n&&(o[il]=n),i&&(o[cf]=i),gf(e,df,o)}open(e,r){this.onDisconnect=r,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,cs.set("previous_websocket_failure",!0);try{let s;Lx(),this.mySock=new li(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const n=s.message||s.data;n&&this.log_(n),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const n=s.message||s.data;n&&this.log_(n),this.onClosed_()}}start(){}static forceDisallow(){er.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const r=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(r);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&li!==null&&!er.forceDisallow_}static previouslyFailed(){return cs.isInMemoryStorage||cs.get("previous_websocket_failure")===!0}markConnectionHealthy(){cs.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const r=this.frames.join("");this.frames=null;const s=nc(r);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(oe(this.frames===null,"We already have a frame buffer"),e.length<=6){const r=Number(e);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const r=e.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{const s=this.extractFrameCount_(r);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const r=ut(e);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const s=ef(r,Jw);s.length>1&&this.sendString_(String(s.length));for(let n=0;n<s.length;n++)this.sendString_(s[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Zw))}sendString_(e){try{this.mySock.send(e)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}er.responsesRequiredToBeHealthy=2;er.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{static get ALL_TRANSPORTS(){return[Ls,er]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const r=er&&er.isAvailable();let s=r&&!er.previouslyFailed();if(e.webSocketOnly&&(r||Mt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[er];else{const n=this.transports_=[];for(const i of Zn.ALL_TRANSPORTS)i&&i.isAvailable()&&n.push(i);Zn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Zn.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek=6e4,tk=5e3,rk=10*1024,sk=100*1024,To="t",cu="d",nk="s",du="r",ak="e",uu="o",hu="a",gu="n",mu="p",ik="h";class ok{constructor(e,r,s,n,i,o,l,c,d,u){this.id=e,this.repoInfo_=r,this.applicationId_=s,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wa("c:"+this.id+":"),this.transportManager_=new Zn(r),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const r=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(r,s)},Math.floor(0));const n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=On(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>sk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>rk?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return r=>{e===this.conn_?this.onConnectionLost_(r):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return r=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(r):e===this.secondaryConn_?this.onSecondaryMessageReceived_(r):this.log_("message on old connection"))}}sendRequest(e){const r={t:"d",d:e};this.sendData_(r)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(To in e){const r=e[To];r===hu?this.upgradeIfSecondaryHealthy_():r===du?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):r===uu&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const r=Tn("t",e),s=Tn("d",e);if(r==="c")this.onSecondaryControl_(s);else if(r==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+r)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:mu,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:hu,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:gu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const r=Tn("t",e),s=Tn("d",e);r==="c"?this.onControl_(s):r==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const r=Tn(To,e);if(cu in e){const s=e[cu];if(r===ik){const n=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(n.h=this.repoInfo_.host),this.onHandshake_(n)}else if(r===gu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let n=0;n<this.pendingDataMessages.length;++n)this.onDataMessage_(this.pendingDataMessages[n]);this.pendingDataMessages=[],this.tryCleanupConnection()}else r===nk?this.onConnectionShutdown_(s):r===du?this.onReset_(s):r===ak?al("Server Error: "+s):r===uu?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):al("Unknown control packet command: "+r)}}onHandshake_(e){const r=e.ts,s=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,r),mc!==s&&Mt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const r=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(r,s),On(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(ek))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,r){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(r,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):On(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(tk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:mu,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(cs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{put(e,r,s,n){}merge(e,r,s,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,r,s){}onDisconnectMerge(e,r,s){}onDisconnectCancel(e,r){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vf=class{constructor(e){this.allowedEvents_=e,this.listeners_={},oe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...r){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let n=0;n<s.length;n++)s[n].callback.apply(s[n].context,r)}}on(e,r,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:r,context:s});const n=this.getInitialEvent(e);n&&r.apply(s,n)}off(e,r,s){this.validateEventType_(e);const n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===r&&(!s||s===n[i].context)){n.splice(i,1);return}}validateEventType_(e){oe(this.allowedEvents_.find(r=>r===e),"Unknown event: "+e)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci extends vf{static getInstance(){return new ci}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!gm()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return oe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=32,pu=768;class ze{constructor(e,r){if(r===void 0){this.pieces_=e.split("/");let s=0;for(let n=0;n<this.pieces_.length;n++)this.pieces_[n].length>0&&(this.pieces_[s]=this.pieces_[n],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=r}toString(){let e="";for(let r=this.pieceNum_;r<this.pieces_.length;r++)this.pieces_[r]!==""&&(e+="/"+this.pieces_[r]);return e||"/"}}function Ve(){return new ze("")}function Oe(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Yr(t){return t.pieces_.length-t.pieceNum_}function Ye(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new ze(t.pieces_,e)}function wf(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function lk(t){let e="";for(let r=t.pieceNum_;r<t.pieces_.length;r++)t.pieces_[r]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[r])));return e||"/"}function kf(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Tf(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let r=t.pieceNum_;r<t.pieces_.length-1;r++)e.push(t.pieces_[r]);return new ze(e,0)}function ht(t,e){const r=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)r.push(t.pieces_[s]);if(e instanceof ze)for(let s=e.pieceNum_;s<e.pieces_.length;s++)r.push(e.pieces_[s]);else{const s=e.split("/");for(let n=0;n<s.length;n++)s[n].length>0&&r.push(s[n])}return new ze(r,0)}function $e(t){return t.pieceNum_>=t.pieces_.length}function Dt(t,e){const r=Oe(t),s=Oe(e);if(r===null)return e;if(r===s)return Dt(Ye(t),Ye(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function yc(t,e){if(Yr(t)!==Yr(e))return!1;for(let r=t.pieceNum_,s=e.pieceNum_;r<=t.pieces_.length;r++,s++)if(t.pieces_[r]!==e.pieces_[s])return!1;return!0}function sr(t,e){let r=t.pieceNum_,s=e.pieceNum_;if(Yr(t)>Yr(e))return!1;for(;r<t.pieces_.length;){if(t.pieces_[r]!==e.pieces_[s])return!1;++r,++s}return!0}class ck{constructor(e,r){this.errorPrefix_=r,this.parts_=kf(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Li(this.parts_[s]);Nf(this)}}function dk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Li(e),Nf(t)}function uk(t){const e=t.parts_.pop();t.byteLength_-=Li(e),t.parts_.length>0&&(t.byteLength_-=1)}function Nf(t){if(t.byteLength_>pu)throw new Error(t.errorPrefix_+"has a key path longer than "+pu+" bytes ("+t.byteLength_+").");if(t.parts_.length>fu)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+fu+") or object contains a cycle "+ss(t))}function ss(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends vf{static getInstance(){return new xc}constructor(){super(["visible"]);let e,r;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(r="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(r="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(r="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(r="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,r&&document.addEventListener(r,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return oe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nn=1e3,hk=300*1e3,yu=30*1e3,gk=1.3,mk=3e4,fk="server_kill",xu=3;class _r extends bf{constructor(e,r,s,n,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=r,this.onDataUpdate_=s,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=_r.nextPersistentConnectionId_++,this.log_=wa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Nn,this.maxReconnectDelay_=hk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");xc.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ci.getInstance().on("online",this.onOnline_,this)}sendRequest(e,r,s){const n=++this.requestNumber_,i={r:n,a:e,b:r};this.log_(ut(i)),oe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[n]=s)}get(e){this.initConnection_();const r=new ic,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),r.promise}listen(e,r,s,n){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),oe(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:n,hashFn:r,query:e,tag:s};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const r=this.outstandingGets_[e];this.sendRequest("g",r.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(s)})}sendListen_(e){const r=e.query,s=r._path.toString(),n=r._queryIdentifier;this.log_("Listen on "+s+" for "+n);const i={p:s},o="q";e.tag&&(i.q=r._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;_r.warnOnListenWarnings_(c,r),(this.listens.get(s)&&this.listens.get(s).get(n))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(s,n),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,r){if(e&&typeof e=="object"&&Ir(e,"w")){const s=qs(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const n='".indexOn": "'+r._queryParams.getIndex().toString()+'"',i=r._path.toString();Mt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${n} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Ax(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=yu)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,r=Rx(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(r,s,n=>{const i=n.s,o=n.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const r=e.s,s=e.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,s)})}unlisten(e,r){const s=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+n),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,n)&&this.connected_&&this.sendUnlisten_(s,n,e._queryObject,r)}sendUnlisten_(e,r,s,n){this.log_("Unlisten on "+e+" for "+r);const i={p:e},o="n";n&&(i.q=s,i.t=n),this.sendRequest(o,i)}onDisconnectPut(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:r,onComplete:s})}onDisconnectMerge(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:r,onComplete:s})}onDisconnectCancel(e,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(e,r,s,n){const i={p:r,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{n&&setTimeout(()=>{n(o.s,o.d)},Math.floor(0))})}put(e,r,s,n){this.putInternal("p",e,r,s,n)}merge(e,r,s,n){this.putInternal("m",e,r,s,n)}putInternal(e,r,s,n,i){this.initConnection_();const o={p:r,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(e){const r=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,s,i=>{this.log_(r+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),n&&n(i.s,i.d)})}reportStats(e){if(this.connected_){const r={c:e};this.log_("reportStats",r),this.sendRequest("s",r,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ut(e));const r=e.r,s=this.requestCBHash_[r];s&&(delete this.requestCBHash_[r],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,r){this.log_("handleServerMessage",e,r),e==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):e==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):e==="c"?this.onListenRevoked_(r.p,r.q):e==="ac"?this.onAuthRevoked_(r.s,r.d):e==="apc"?this.onAppCheckRevoked_(r.s,r.d):e==="sd"?this.onSecurityDebugPacket_(r):al("Unrecognized action received from server: "+ut(e)+`
Are you using the latest client?`)}onReady_(e,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){oe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Nn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Nn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>mk&&(this.reconnectDelay_=Nn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let r=Math.max(0,this.reconnectDelay_-e);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*gk)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),n=this.id+":"+_r.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},d=function(h){oe(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,g]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?Tt("getToken() completed but was canceled"):(Tt("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=g&&g.token,l=new ok(n,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,s,m=>{Mt(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(fk)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Mt(h),c())}}}interrupt(e){Tt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Tt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ld(this.interruptReasons_)&&(this.reconnectDelay_=Nn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const r=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const r=this.outstandingPuts_[e];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,r){let s;r?s=r.map(i=>gc(i)).join("$"):s="default";const n=this.removeListen_(e,s);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,r){const s=new ze(e).toString();let n;if(this.listens.has(s)){const i=this.listens.get(s);n=i.get(r),i.delete(r),i.size===0&&this.listens.delete(s)}else n=void 0;return n}onAuthRevoked_(e,r){Tt("Auth token revoked: "+e+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=xu&&(this.reconnectDelay_=yu,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,r){Tt("App check token revoked: "+e+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=xu&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const r of e.values())this.sendListen_(r);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let r="js";e["sdk."+r+"."+Xm.replace(/\./g,"-")]=1,gm()?e["framework.cordova"]=1:Px()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ci.getInstance().currentlyOnline();return Ld(this.interruptReasons_)&&e}}_r.nextPersistentConnectionId_=0;_r.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,r){this.name=e,this.node=r}static Wrap(e,r){return new Le(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,r){const s=new Le(Qs,e),n=new Le(Qs,r);return this.compare(s,n)!==0}minPost(){return Le.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oa;class Sf extends Vi{static get __EMPTY_NODE(){return Oa}static set __EMPTY_NODE(e){Oa=e}compare(e,r){return nn(e.name,r.name)}isDefinedOn(e){throw ba("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,r){return!1}minPost(){return Le.MIN}maxPost(){return new Le(Ts,Oa)}makePost(e,r){return oe(typeof e=="string","KeyIndex indexValue must always be a string."),new Le(e,Oa)}toString(){return".key"}}const Gs=new Sf;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,r,s,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=r?s(e.key,r):1,n&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),r;if(this.resultGenerator_?r=this.resultGenerator_(e.key,e.value):r={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return r}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class pt{constructor(e,r,s,n,i){this.key=e,this.value=r,this.color=s??pt.RED,this.left=n??At.EMPTY_NODE,this.right=i??At.EMPTY_NODE}copy(e,r,s,n,i){return new pt(e??this.key,r??this.value,s??this.color,n??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,s){let n=this;const i=s(e,n.key);return i<0?n=n.copy(null,null,null,n.left.insert(e,r,s),null):i===0?n=n.copy(null,r,null,null,null):n=n.copy(null,null,null,null,n.right.insert(e,r,s)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return At.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,r){let s,n;if(s=this,r(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,r),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),r(e,s.key)===0){if(s.right.isEmpty())return At.EMPTY_NODE;n=s.right.min_(),s=s.copy(n.key,n.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,r))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,pt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,pt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}pt.RED=!0;pt.BLACK=!1;class pk{copy(e,r,s,n,i){return this}insert(e,r,s){return new pt(e,r,null)}remove(e,r){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class At{constructor(e,r=At.EMPTY_NODE){this.comparator_=e,this.root_=r}insert(e,r){return new At(this.comparator_,this.root_.insert(e,r,this.comparator_).copy(null,null,pt.BLACK,null,null))}remove(e){return new At(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,pt.BLACK,null,null))}get(e){let r,s=this.root_;for(;!s.isEmpty();){if(r=this.comparator_(e,s.key),r===0)return s.value;r<0?s=s.left:r>0&&(s=s.right)}return null}getPredecessorKey(e){let r,s=this.root_,n=null;for(;!s.isEmpty();)if(r=this.comparator_(e,s.key),r===0){if(s.left.isEmpty())return n?n.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else r<0?s=s.left:r>0&&(n=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new La(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,r){return new La(this.root_,e,this.comparator_,!1,r)}getReverseIteratorFrom(e,r){return new La(this.root_,e,this.comparator_,!0,r)}getReverseIterator(e){return new La(this.root_,null,this.comparator_,!0,e)}}At.EMPTY_NODE=new pk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(t,e){return nn(t.name,e.name)}function bc(t,e){return nn(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ol;function xk(t){ol=t}const jf=function(t){return typeof t=="number"?"number:"+tf(t):"string:"+t},_f=function(t){if(t.isLeafNode()){const e=t.val();oe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ir(e,".sv"),"Priority must be a string or number.")}else oe(t===ol||t.isEmpty(),"priority of unexpected type.");oe(t===ol||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bu;class ft{static set __childrenNodeConstructor(e){bu=e}static get __childrenNodeConstructor(){return bu}constructor(e,r=ft.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=r,this.lazyHash_=null,oe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),_f(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ft(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ft.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return $e(e)?this:Oe(e)===".priority"?this.priorityNode_:ft.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,r){return null}updateImmediateChild(e,r){return e===".priority"?this.updatePriority(r):r.isEmpty()&&e!==".priority"?this:ft.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,r).updatePriority(this.priorityNode_)}updateChild(e,r){const s=Oe(e);return s===null?r:r.isEmpty()&&s!==".priority"?this:(oe(s!==".priority"||Yr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,ft.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ye(e),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,r){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+jf(this.priorityNode_.val())+":");const r=typeof this.value_;e+=r+":",r==="number"?e+=tf(this.value_):e+=this.value_,this.lazyHash_=Jm(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ft.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ft.__childrenNodeConstructor?-1:(oe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const r=typeof e.value_,s=typeof this.value_,n=ft.VALUE_TYPE_ORDER.indexOf(r),i=ft.VALUE_TYPE_ORDER.indexOf(s);return oe(n>=0,"Unknown leaf type: "+r),oe(i>=0,"Unknown leaf type: "+s),n===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const r=e;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}ft.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Df,Cf;function bk(t){Df=t}function vk(t){Cf=t}class wk extends Vi{compare(e,r){const s=e.node.getPriority(),n=r.node.getPriority(),i=s.compareTo(n);return i===0?nn(e.name,r.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,r){return!e.getPriority().equals(r.getPriority())}minPost(){return Le.MIN}maxPost(){return new Le(Ts,new ft("[PRIORITY-POST]",Cf))}makePost(e,r){const s=Df(e);return new Le(r,new ft("[PRIORITY-POST]",s))}toString(){return".priority"}}const it=new wk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kk=Math.log(2);class Tk{constructor(e){const r=i=>parseInt(Math.log(i)/kk,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=r(e+1),this.current_=this.count-1;const n=s(this.count);this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const di=function(t,e,r,s){t.sort(e);const n=function(c,d){const u=d-c;let h,g;if(u===0)return null;if(u===1)return h=t[c],g=r?r(h):h,new pt(g,h.node,pt.BLACK,null,null);{const m=parseInt(u/2,10)+c,x=n(c,m),f=n(m+1,d);return h=t[m],g=r?r(h):h,new pt(g,h.node,pt.BLACK,x,f)}},i=function(c){let d=null,u=null,h=t.length;const g=function(x,f){const p=h-x,w=h;h-=x;const v=n(p+1,w),k=t[p],b=r?r(k):k;m(new pt(b,k.node,f,null,v))},m=function(x){d?(d.left=x,d=x):(u=x,d=x)};for(let x=0;x<c.count;++x){const f=c.nextBitIsOne(),p=Math.pow(2,c.count-(x+1));f?g(p,pt.BLACK):(g(p,pt.BLACK),g(p,pt.RED))}return u},o=new Tk(t.length),l=i(o);return new At(s||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let No;const Es={};class jr{static get Default(){return oe(Es&&it,"ChildrenNode.ts has not been loaded"),No=No||new jr({".priority":Es},{".priority":it}),No}constructor(e,r){this.indexes_=e,this.indexSet_=r}get(e){const r=qs(this.indexes_,e);if(!r)throw new Error("No index defined for "+e);return r instanceof At?r:null}hasIndex(e){return Ir(this.indexSet_,e.toString())}addIndex(e,r){oe(e!==Gs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let n=!1;const i=r.getIterator(Le.Wrap);let o=i.getNext();for(;o;)n=n||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let l;n?l=di(s,e.getCompare()):l=Es;const c=e.toString(),d=Object.assign({},this.indexSet_);d[c]=e;const u=Object.assign({},this.indexes_);return u[c]=l,new jr(u,d)}addToIndexes(e,r){const s=ti(this.indexes_,(n,i)=>{const o=qs(this.indexSet_,i);if(oe(o,"Missing index implementation for "+i),n===Es)if(o.isDefinedOn(e.node)){const l=[],c=r.getIterator(Le.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),di(l,o.getCompare())}else return Es;else{const l=r.get(e.name);let c=n;return l&&(c=c.remove(new Le(e.name,l))),c.insert(e,e.node)}});return new jr(s,this.indexSet_)}removeFromIndexes(e,r){const s=ti(this.indexes_,n=>{if(n===Es)return n;{const i=r.get(e.name);return i?n.remove(new Le(e.name,i)):n}});return new jr(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sn;class je{static get EMPTY_NODE(){return Sn||(Sn=new je(new At(bc),null,jr.Default))}constructor(e,r,s){this.children_=e,this.priorityNode_=r,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&_f(this.priorityNode_),this.children_.isEmpty()&&oe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Sn}updatePriority(e){return this.children_.isEmpty()?this:new je(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const r=this.children_.get(e);return r===null?Sn:r}}getChild(e){const r=Oe(e);return r===null?this:this.getImmediateChild(r).getChild(Ye(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,r){if(oe(r,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(r);{const s=new Le(e,r);let n,i;r.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(n=this.children_.insert(e,r),i=this.indexMap_.addToIndexes(s,this.children_));const o=n.isEmpty()?Sn:this.priorityNode_;return new je(n,o,i)}}updateChild(e,r){const s=Oe(e);if(s===null)return r;{oe(Oe(e)!==".priority"||Yr(e)===1,".priority must be the last token in a path");const n=this.getImmediateChild(s).updateChild(Ye(e),r);return this.updateImmediateChild(s,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const r={};let s=0,n=0,i=!0;if(this.forEachChild(it,(o,l)=>{r[o]=l.val(e),s++,i&&je.INTEGER_REGEXP_.test(o)?n=Math.max(n,Number(o)):i=!1}),!e&&i&&n<2*s){const o=[];for(const l in r)o[l]=r[l];return o}else return e&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+jf(this.getPriority().val())+":"),this.forEachChild(it,(r,s)=>{const n=s.hash();n!==""&&(e+=":"+r+":"+n)}),this.lazyHash_=e===""?"":Jm(e)}return this.lazyHash_}getPredecessorChildName(e,r,s){const n=this.resolveIndex_(s);if(n){const i=n.getPredecessorKey(new Le(e,r));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const r=this.resolveIndex_(e);if(r){const s=r.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const r=this.getFirstChildName(e);return r?new Le(r,this.children_.get(r)):null}getLastChildName(e){const r=this.resolveIndex_(e);if(r){const s=r.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const r=this.getLastChildName(e);return r?new Le(r,this.children_.get(r)):null}forEachChild(e,r){const s=this.resolveIndex_(e);return s?s.inorderTraversal(n=>r(n.name,n.node)):this.children_.inorderTraversal(r)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,r){const s=this.resolveIndex_(r);if(s)return s.getIteratorFrom(e,n=>n);{const n=this.children_.getIteratorFrom(e.name,Le.Wrap);let i=n.peek();for(;i!=null&&r.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,r){const s=this.resolveIndex_(r);if(s)return s.getReverseIteratorFrom(e,n=>n);{const n=this.children_.getReverseIteratorFrom(e.name,Le.Wrap);let i=n.peek();for(;i!=null&&r.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ka?-1:0}withIndex(e){if(e===Gs||this.indexMap_.hasIndex(e))return this;{const r=this.indexMap_.addIndex(e,this.children_);return new je(this.children_,this.priorityNode_,r)}}isIndexed(e){return e===Gs||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const r=e;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){const s=this.getIterator(it),n=r.getIterator(it);let i=s.getNext(),o=n.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=n.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Gs?null:this.indexMap_.get(e.toString())}}je.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Nk extends je{constructor(){super(new At(bc),je.EMPTY_NODE,jr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return je.EMPTY_NODE}isEmpty(){return!1}}const ka=new Nk;Object.defineProperties(Le,{MIN:{value:new Le(Qs,je.EMPTY_NODE)},MAX:{value:new Le(Ts,ka)}});Sf.__EMPTY_NODE=je.EMPTY_NODE;ft.__childrenNodeConstructor=je;xk(ka);vk(ka);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=!0;function xt(t,e=null){if(t===null)return je.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),oe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const r=t;return new ft(r,xt(e))}if(!(t instanceof Array)&&Sk){const r=[];let s=!1;if(Ot(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=xt(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),r.push(new Le(o,c)))}}),r.length===0)return je.EMPTY_NODE;const i=di(r,yk,o=>o.name,bc);if(s){const o=di(r,it.getCompare());return new je(i,xt(e),new jr({".priority":o},{".priority":it}))}else return new je(i,xt(e),jr.Default)}else{let r=je.EMPTY_NODE;return Ot(t,(s,n)=>{if(Ir(t,s)&&s.substring(0,1)!=="."){const i=xt(n);(i.isLeafNode()||!i.isEmpty())&&(r=r.updateImmediateChild(s,i))}}),r.updatePriority(xt(e))}}bk(xt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk extends Vi{constructor(e){super(),this.indexPath_=e,oe(!$e(e)&&Oe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,r){const s=this.extractChild(e.node),n=this.extractChild(r.node),i=s.compareTo(n);return i===0?nn(e.name,r.name):i}makePost(e,r){const s=xt(e),n=je.EMPTY_NODE.updateChild(this.indexPath_,s);return new Le(r,n)}maxPost(){const e=je.EMPTY_NODE.updateChild(this.indexPath_,ka);return new Le(Ts,e)}toString(){return kf(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k extends Vi{compare(e,r){const s=e.node.compareTo(r.node);return s===0?nn(e.name,r.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,r){return!e.equals(r)}minPost(){return Le.MIN}maxPost(){return Le.MAX}makePost(e,r){const s=xt(e);return new Le(r,s)}toString(){return".value"}}const Dk=new _k;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(t){return{type:"value",snapshotNode:t}}function Js(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ea(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function ta(t,e,r){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:r}}function Ck(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e){this.index_=e}updateChild(e,r,s,n,i,o){oe(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(r);return l.getChild(n).equals(s.getChild(n))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(r)?o.trackChildChange(ea(r,l)):oe(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Js(r,s)):o.trackChildChange(ta(r,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(r,s).withIndex(this.index_)}updateFullNode(e,r,s){return s!=null&&(e.isLeafNode()||e.forEachChild(it,(n,i)=>{r.hasChild(n)||s.trackChildChange(ea(n,i))}),r.isLeafNode()||r.forEachChild(it,(n,i)=>{if(e.hasChild(n)){const o=e.getImmediateChild(n);o.equals(i)||s.trackChildChange(ta(n,i,o))}else s.trackChildChange(Js(n,i))})),r.withIndex(this.index_)}updatePriority(e,r){return e.isEmpty()?je.EMPTY_NODE:e.updatePriority(r)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e){this.indexedFilter_=new vc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ra.getStartPost_(e),this.endPost_=ra.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const r=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return r&&s}updateChild(e,r,s,n,i,o){return this.matches(new Le(r,s))||(s=je.EMPTY_NODE),this.indexedFilter_.updateChild(e,r,s,n,i,o)}updateFullNode(e,r,s){r.isLeafNode()&&(r=je.EMPTY_NODE);let n=r.withIndex(this.index_);n=n.updatePriority(je.EMPTY_NODE);const i=this;return r.forEachChild(it,(o,l)=>{i.matches(new Le(o,l))||(n=n.updateImmediateChild(o,je.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,s)}updatePriority(e,r){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const r=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),r)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const r=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),r)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this.withinDirectionalStart=r=>this.reverse_?this.withinEndPost(r):this.withinStartPost(r),this.withinDirectionalEnd=r=>this.reverse_?this.withinStartPost(r):this.withinEndPost(r),this.withinStartPost=r=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),r);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=r=>{const s=this.index_.compare(r,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new ra(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,r,s,n,i,o){return this.rangedFilter_.matches(new Le(r,s))||(s=je.EMPTY_NODE),e.getImmediateChild(r).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,r,s,n,i,o):this.fullLimitUpdateChild_(e,r,s,i,o)}updateFullNode(e,r,s){let n;if(r.isLeafNode()||r.isEmpty())n=je.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<r.numChildren()&&r.isIndexed(this.index_)){n=je.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=r.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=r.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))n=n.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{n=r.withIndex(this.index_),n=n.updatePriority(je.EMPTY_NODE);let i;this.reverse_?i=n.getReverseIterator(this.index_):i=n.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:n=n.updateImmediateChild(l.name,je.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,s)}updatePriority(e,r){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,r,s,n,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(g,m)=>h(m,g)}else o=this.index_.getCompare();const l=e;oe(l.numChildren()===this.limit_,"");const c=new Le(r,s),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(r)){const h=l.getImmediateChild(r);let g=n.getChildAfterChild(this.index_,d,this.reverse_);for(;g!=null&&(g.name===r||l.hasChild(g.name));)g=n.getChildAfterChild(this.index_,g,this.reverse_);const m=g==null?1:o(g,c);if(u&&!s.isEmpty()&&m>=0)return i?.trackChildChange(ta(r,s,h)),l.updateImmediateChild(r,s);{i?.trackChildChange(ea(r,h));const f=l.updateImmediateChild(r,je.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(i?.trackChildChange(Js(g.name,g.node)),f.updateImmediateChild(g.name,g.node)):f}}else return s.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(ea(d.name,d.node)),i.trackChildChange(Js(r,s))),l.updateImmediateChild(r,s).updateImmediateChild(d.name,je.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=it}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return oe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return oe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Qs}hasEnd(){return this.endSet_}getIndexEndValue(){return oe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return oe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ts}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return oe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===it}copy(){const e=new wc;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Ik(t){return t.loadsAllData()?new vc(t.getIndex()):t.hasLimit()?new Ek(t):new ra(t)}function vu(t){const e={};if(t.isDefault())return e;let r;if(t.index_===it?r="$priority":t.index_===Dk?r="$value":t.index_===Gs?r="$key":(oe(t.index_ instanceof jk,"Unrecognized index type!"),r=t.index_.toString()),e.orderBy=ut(r),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=ut(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+ut(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=ut(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+ut(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function wu(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let r=t.viewFrom_;r===""&&(t.isViewFromLeft()?r="l":r="r"),e.vf=r}return t.index_!==it&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui extends bf{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,r){return r!==void 0?"tag$"+r:(oe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,r,s,n){super(),this.repoInfo_=e,this.onDataUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=n,this.log_=wa("p:rest:"),this.listens_={}}listen(e,r,s,n){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=ui.getListenId_(e,s),l={};this.listens_[o]=l;const c=vu(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(i,h,!1,s),qs(this.listens_,o)===l){let g;d?d===401?g="permission_denied":g="rest_error:"+d:g="ok",n(g,null)}})}unlisten(e,r){const s=ui.getListenId_(e,r);delete this.listens_[s]}get(e){const r=vu(e._queryParams),s=e._path.toString(),n=new ic;return this.restRequest_(s+".json",r,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(s,l,!1,null),n.resolve(l)):n.reject(new Error(l))}),n.promise}refreshAuthToken(e){}restRequest_(e,r={},s){return r.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,i])=>{n&&n.accessToken&&(r.auth=n.accessToken),i&&i.token&&(r.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Ix(r);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=nc(l.responseText)}catch{Mt("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&Mt("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(){this.rootNode_=je.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,r){this.rootNode_=this.rootNode_.updateChild(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hi(){return{value:null,children:new Map}}function If(t,e,r){if($e(e))t.value=r,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,r);else{const s=Oe(e);t.children.has(s)||t.children.set(s,hi());const n=t.children.get(s);e=Ye(e),If(n,e,r)}}function ll(t,e,r){t.value!==null?r(e,t.value):Rk(t,(s,n)=>{const i=new ze(e.toString()+"/"+s);ll(n,i,r)})}function Rk(t,e){t.children.forEach((r,s)=>{e(s,r)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),r=Object.assign({},e);return this.last_&&Ot(this.last_,(s,n)=>{r[s]=r[s]-n}),this.last_=e,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ku=10*1e3,Mk=30*1e3,Ok=300*1e3;class Lk{constructor(e,r){this.server_=r,this.statsToReport_={},this.statsListener_=new Pk(e);const s=ku+(Mk-ku)*Math.random();On(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),r={};let s=!1;Ot(e,(n,i)=>{i>0&&Ir(this.statsToReport_,n)&&(r[n]=i,s=!0)}),s&&this.server_.reportStats(r),On(this.reportStats_.bind(this),Math.floor(Math.random()*2*Ok))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(nr||(nr={}));function Af(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function kc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Tc(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,r,s){this.path=e,this.affectedTree=r,this.revert=s,this.type=nr.ACK_USER_WRITE,this.source=Af()}operationForChild(e){if($e(this.path)){if(this.affectedTree.value!=null)return oe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const r=this.affectedTree.subtree(new ze(e));return new gi(Ve(),r,this.revert)}}else return oe(Oe(this.path)===e,"operationForChild called for unrelated child."),new gi(Ye(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e,r){this.source=e,this.path=r,this.type=nr.LISTEN_COMPLETE}operationForChild(e){return $e(this.path)?new sa(this.source,Ve()):new sa(this.source,Ye(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,r,s){this.source=e,this.path=r,this.snap=s,this.type=nr.OVERWRITE}operationForChild(e){return $e(this.path)?new Ns(this.source,Ve(),this.snap.getImmediateChild(e)):new Ns(this.source,Ye(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,r,s){this.source=e,this.path=r,this.children=s,this.type=nr.MERGE}operationForChild(e){if($e(this.path)){const r=this.children.subtree(new ze(e));return r.isEmpty()?null:r.value?new Ns(this.source,Ve(),r.value):new na(this.source,Ve(),r)}else return oe(Oe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new na(this.source,Ye(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qr{constructor(e,r,s){this.node_=e,this.fullyInitialized_=r,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if($e(e))return this.isFullyInitialized()&&!this.filtered_;const r=Oe(e);return this.isCompleteForChild(r)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Fk(t,e,r,s){const n=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Ck(o.childName,o.snapshotNode))}),jn(t,n,"child_removed",e,s,r),jn(t,n,"child_added",e,s,r),jn(t,n,"child_moved",i,s,r),jn(t,n,"child_changed",e,s,r),jn(t,n,"value",e,s,r),n}function jn(t,e,r,s,n,i){const o=s.filter(l=>l.type===r);o.sort((l,c)=>Vk(t,l,c)),o.forEach(l=>{const c=Wk(t,l,i);n.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function Wk(t,e,r){return e.type==="value"||e.type==="child_removed"||(e.prevName=r.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Vk(t,e,r){if(e.childName==null||r.childName==null)throw ba("Should only compare child_ events.");const s=new Le(e.childName,e.snapshotNode),n=new Le(r.childName,r.snapshotNode);return t.index_.compare(s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(t,e){return{eventCache:t,serverCache:e}}function Ln(t,e,r,s){return Ui(new qr(e,r,s),t.serverCache)}function Rf(t,e,r,s){return Ui(t.eventCache,new qr(e,r,s))}function mi(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ss(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let So;const Uk=()=>(So||(So=new At(_w)),So);class Qe{static fromObject(e){let r=new Qe(null);return Ot(e,(s,n)=>{r=r.set(new ze(s),n)}),r}constructor(e,r=Uk()){this.value=e,this.children=r}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,r){if(this.value!=null&&r(this.value))return{path:Ve(),value:this.value};if($e(e))return null;{const s=Oe(e),n=this.children.get(s);if(n!==null){const i=n.findRootMostMatchingPathAndValue(Ye(e),r);return i!=null?{path:ht(new ze(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if($e(e))return this;{const r=Oe(e),s=this.children.get(r);return s!==null?s.subtree(Ye(e)):new Qe(null)}}set(e,r){if($e(e))return new Qe(r,this.children);{const s=Oe(e),i=(this.children.get(s)||new Qe(null)).set(Ye(e),r),o=this.children.insert(s,i);return new Qe(this.value,o)}}remove(e){if($e(e))return this.children.isEmpty()?new Qe(null):new Qe(null,this.children);{const r=Oe(e),s=this.children.get(r);if(s){const n=s.remove(Ye(e));let i;return n.isEmpty()?i=this.children.remove(r):i=this.children.insert(r,n),this.value===null&&i.isEmpty()?new Qe(null):new Qe(this.value,i)}else return this}}get(e){if($e(e))return this.value;{const r=Oe(e),s=this.children.get(r);return s?s.get(Ye(e)):null}}setTree(e,r){if($e(e))return r;{const s=Oe(e),i=(this.children.get(s)||new Qe(null)).setTree(Ye(e),r);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new Qe(this.value,o)}}fold(e){return this.fold_(Ve(),e)}fold_(e,r){const s={};return this.children.inorderTraversal((n,i)=>{s[n]=i.fold_(ht(e,n),r)}),r(e,this.value,s)}findOnPath(e,r){return this.findOnPath_(e,Ve(),r)}findOnPath_(e,r,s){const n=this.value?s(r,this.value):!1;if(n)return n;if($e(e))return null;{const i=Oe(e),o=this.children.get(i);return o?o.findOnPath_(Ye(e),ht(r,i),s):null}}foreachOnPath(e,r){return this.foreachOnPath_(e,Ve(),r)}foreachOnPath_(e,r,s){if($e(e))return this;{this.value&&s(r,this.value);const n=Oe(e),i=this.children.get(n);return i?i.foreachOnPath_(Ye(e),ht(r,n),s):new Qe(null)}}foreach(e){this.foreach_(Ve(),e)}foreach_(e,r){this.children.inorderTraversal((s,n)=>{n.foreach_(ht(e,s),r)}),this.value&&r(e,this.value)}foreachChild(e){this.children.inorderTraversal((r,s)=>{s.value&&e(r,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(e){this.writeTree_=e}static empty(){return new ar(new Qe(null))}}function $n(t,e,r){if($e(e))return new ar(new Qe(r));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const n=s.path;let i=s.value;const o=Dt(n,e);return i=i.updateChild(o,r),new ar(t.writeTree_.set(n,i))}else{const n=new Qe(r),i=t.writeTree_.setTree(e,n);return new ar(i)}}}function Tu(t,e,r){let s=t;return Ot(r,(n,i)=>{s=$n(s,ht(e,n),i)}),s}function Nu(t,e){if($e(e))return ar.empty();{const r=t.writeTree_.setTree(e,new Qe(null));return new ar(r)}}function cl(t,e){return js(t,e)!=null}function js(t,e){const r=t.writeTree_.findRootMostValueAndPath(e);return r!=null?t.writeTree_.get(r.path).getChild(Dt(r.path,e)):null}function Su(t){const e=[],r=t.writeTree_.value;return r!=null?r.isLeafNode()||r.forEachChild(it,(s,n)=>{e.push(new Le(s,n))}):t.writeTree_.children.inorderTraversal((s,n)=>{n.value!=null&&e.push(new Le(s,n.value))}),e}function Gr(t,e){if($e(e))return t;{const r=js(t,e);return r!=null?new ar(new Qe(r)):new ar(t.writeTree_.subtree(e))}}function dl(t){return t.writeTree_.isEmpty()}function Zs(t,e){return Pf(Ve(),t.writeTree_,e)}function Pf(t,e,r){if(e.value!=null)return r.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((n,i)=>{n===".priority"?(oe(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):r=Pf(ht(t,n),i,r)}),!r.getChild(t).isEmpty()&&s!==null&&(r=r.updateChild(ht(t,".priority"),s)),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bi(t,e){return $f(e,t)}function Bk(t,e,r,s,n){oe(s>t.lastWriteId,"Stacking an older write on top of newer ones"),n===void 0&&(n=!0),t.allWrites.push({path:e,snap:r,writeId:s,visible:n}),n&&(t.visibleWrites=$n(t.visibleWrites,e,r)),t.lastWriteId=s}function Hk(t,e){for(let r=0;r<t.allWrites.length;r++){const s=t.allWrites[r];if(s.writeId===e)return s}return null}function Gk(t,e){const r=t.allWrites.findIndex(l=>l.writeId===e);oe(r>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[r];t.allWrites.splice(r,1);let n=s.visible,i=!1,o=t.allWrites.length-1;for(;n&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=r&&zk(l,s.path)?n=!1:sr(s.path,l.path)&&(i=!0)),o--}if(n){if(i)return Kk(t),!0;if(s.snap)t.visibleWrites=Nu(t.visibleWrites,s.path);else{const l=s.children;Ot(l,c=>{t.visibleWrites=Nu(t.visibleWrites,ht(s.path,c))})}return!0}else return!1}function zk(t,e){if(t.snap)return sr(t.path,e);for(const r in t.children)if(t.children.hasOwnProperty(r)&&sr(ht(t.path,r),e))return!0;return!1}function Kk(t){t.visibleWrites=Mf(t.allWrites,Yk,Ve()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Yk(t){return t.visible}function Mf(t,e,r){let s=ar.empty();for(let n=0;n<t.length;++n){const i=t[n];if(e(i)){const o=i.path;let l;if(i.snap)sr(r,o)?(l=Dt(r,o),s=$n(s,l,i.snap)):sr(o,r)&&(l=Dt(o,r),s=$n(s,Ve(),i.snap.getChild(l)));else if(i.children){if(sr(r,o))l=Dt(r,o),s=Tu(s,l,i.children);else if(sr(o,r))if(l=Dt(o,r),$e(l))s=Tu(s,Ve(),i.children);else{const c=qs(i.children,Oe(l));if(c){const d=c.getChild(Ye(l));s=$n(s,Ve(),d)}}}else throw ba("WriteRecord should have .snap or .children")}}return s}function Of(t,e,r,s,n){if(!s&&!n){const i=js(t.visibleWrites,e);if(i!=null)return i;{const o=Gr(t.visibleWrites,e);if(dl(o))return r;if(r==null&&!cl(o,Ve()))return null;{const l=r||je.EMPTY_NODE;return Zs(o,l)}}}else{const i=Gr(t.visibleWrites,e);if(!n&&dl(i))return r;if(!n&&r==null&&!cl(i,Ve()))return null;{const o=function(d){return(d.visible||n)&&(!s||!~s.indexOf(d.writeId))&&(sr(d.path,e)||sr(e,d.path))},l=Mf(t.allWrites,o,e),c=r||je.EMPTY_NODE;return Zs(l,c)}}}function qk(t,e,r){let s=je.EMPTY_NODE;const n=js(t.visibleWrites,e);if(n)return n.isLeafNode()||n.forEachChild(it,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(r){const i=Gr(t.visibleWrites,e);return r.forEachChild(it,(o,l)=>{const c=Zs(Gr(i,new ze(o)),l);s=s.updateImmediateChild(o,c)}),Su(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=Gr(t.visibleWrites,e);return Su(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function Xk(t,e,r,s,n){oe(s||n,"Either existingEventSnap or existingServerSnap must exist");const i=ht(e,r);if(cl(t.visibleWrites,i))return null;{const o=Gr(t.visibleWrites,i);return dl(o)?n.getChild(r):Zs(o,n.getChild(r))}}function Qk(t,e,r,s){const n=ht(e,r),i=js(t.visibleWrites,n);if(i!=null)return i;if(s.isCompleteForChild(r)){const o=Gr(t.visibleWrites,n);return Zs(o,s.getNode().getImmediateChild(r))}else return null}function Jk(t,e){return js(t.visibleWrites,e)}function Zk(t,e,r,s,n,i,o){let l;const c=Gr(t.visibleWrites,e),d=js(c,Ve());if(d!=null)l=d;else if(r!=null)l=Zs(c,r);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),g=i?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let m=g.getNext();for(;m&&u.length<n;)h(m,s)!==0&&u.push(m),m=g.getNext();return u}else return[]}function eT(){return{visibleWrites:ar.empty(),allWrites:[],lastWriteId:-1}}function fi(t,e,r,s){return Of(t.writeTree,t.treePath,e,r,s)}function Nc(t,e){return qk(t.writeTree,t.treePath,e)}function ju(t,e,r,s){return Xk(t.writeTree,t.treePath,e,r,s)}function pi(t,e){return Jk(t.writeTree,ht(t.treePath,e))}function tT(t,e,r,s,n,i){return Zk(t.writeTree,t.treePath,e,r,s,n,i)}function Sc(t,e,r){return Qk(t.writeTree,t.treePath,e,r)}function Lf(t,e){return $f(ht(t.treePath,e),t.writeTree)}function $f(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rT{constructor(){this.changeMap=new Map}trackChildChange(e){const r=e.type,s=e.childName;oe(r==="child_added"||r==="child_changed"||r==="child_removed","Only child changes supported for tracking"),oe(s!==".priority","Only non-priority child changes can be tracked.");const n=this.changeMap.get(s);if(n){const i=n.type;if(r==="child_added"&&i==="child_removed")this.changeMap.set(s,ta(s,e.snapshotNode,n.snapshotNode));else if(r==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(r==="child_removed"&&i==="child_changed")this.changeMap.set(s,ea(s,n.oldSnap));else if(r==="child_changed"&&i==="child_added")this.changeMap.set(s,Js(s,e.snapshotNode));else if(r==="child_changed"&&i==="child_changed")this.changeMap.set(s,ta(s,e.snapshotNode,n.oldSnap));else throw ba("Illegal combination of changes: "+e+" occurred after "+n)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{getCompleteChild(e){return null}getChildAfterChild(e,r,s){return null}}const Ff=new sT;class jc{constructor(e,r,s=null){this.writes_=e,this.viewCache_=r,this.optCompleteServerCache_=s}getCompleteChild(e){const r=this.viewCache_.eventCache;if(r.isCompleteForChild(e))return r.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new qr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Sc(this.writes_,e,s)}}getChildAfterChild(e,r,s){const n=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ss(this.viewCache_),i=tT(this.writes_,n,r,1,s,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nT(t){return{filter:t}}function aT(t,e){oe(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),oe(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function iT(t,e,r,s,n){const i=new rT;let o,l;if(r.type===nr.OVERWRITE){const d=r;d.source.fromUser?o=ul(t,e,d.path,d.snap,s,n,i):(oe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!$e(d.path),o=yi(t,e,d.path,d.snap,s,n,l,i))}else if(r.type===nr.MERGE){const d=r;d.source.fromUser?o=lT(t,e,d.path,d.children,s,n,i):(oe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=hl(t,e,d.path,d.children,s,n,l,i))}else if(r.type===nr.ACK_USER_WRITE){const d=r;d.revert?o=uT(t,e,d.path,s,n,i):o=cT(t,e,d.path,d.affectedTree,s,n,i)}else if(r.type===nr.LISTEN_COMPLETE)o=dT(t,e,r.path,s,i);else throw ba("Unknown operation type: "+r.type);const c=i.getChanges();return oT(e,o,c),{viewCache:o,changes:c}}function oT(t,e,r){const s=e.eventCache;if(s.isFullyInitialized()){const n=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=mi(t);(r.length>0||!t.eventCache.isFullyInitialized()||n&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&r.push(Ef(mi(e)))}}function Wf(t,e,r,s,n,i){const o=e.eventCache;if(pi(s,r)!=null)return e;{let l,c;if($e(r))if(oe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Ss(e),u=d instanceof je?d:je.EMPTY_NODE,h=Nc(s,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const d=fi(s,Ss(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=Oe(r);if(d===".priority"){oe(Yr(r)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=ju(s,r,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=Ye(r);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const g=ju(s,r,o.getNode(),c);g!=null?h=o.getNode().getImmediateChild(d).updateChild(u,g):h=o.getNode().getImmediateChild(d)}else h=Sc(s,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,n,i):l=o.getNode()}}return Ln(e,l,o.isFullyInitialized()||$e(r),t.filter.filtersNodes())}}function yi(t,e,r,s,n,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if($e(r))d=u.updateFullNode(c.getNode(),s,null);else if(u.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(r,s);d=u.updateFullNode(c.getNode(),m,null)}else{const m=Oe(r);if(!c.isCompleteForPath(r)&&Yr(r)>1)return e;const x=Ye(r),p=c.getNode().getImmediateChild(m).updateChild(x,s);m===".priority"?d=u.updatePriority(c.getNode(),p):d=u.updateChild(c.getNode(),m,p,x,Ff,null)}const h=Rf(e,d,c.isFullyInitialized()||$e(r),u.filtersNodes()),g=new jc(n,h,i);return Wf(t,h,r,n,g,l)}function ul(t,e,r,s,n,i,o){const l=e.eventCache;let c,d;const u=new jc(n,e,i);if($e(r))d=t.filter.updateFullNode(e.eventCache.getNode(),s,o),c=Ln(e,d,!0,t.filter.filtersNodes());else{const h=Oe(r);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),s),c=Ln(e,d,l.isFullyInitialized(),l.isFiltered());else{const g=Ye(r),m=l.getNode().getImmediateChild(h);let x;if($e(g))x=s;else{const f=u.getCompleteChild(h);f!=null?wf(g)===".priority"&&f.getChild(Tf(g)).isEmpty()?x=f:x=f.updateChild(g,s):x=je.EMPTY_NODE}if(m.equals(x))c=e;else{const f=t.filter.updateChild(l.getNode(),h,x,g,u,o);c=Ln(e,f,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function _u(t,e){return t.eventCache.isCompleteForChild(e)}function lT(t,e,r,s,n,i,o){let l=e;return s.foreach((c,d)=>{const u=ht(r,c);_u(e,Oe(u))&&(l=ul(t,l,u,d,n,i,o))}),s.foreach((c,d)=>{const u=ht(r,c);_u(e,Oe(u))||(l=ul(t,l,u,d,n,i,o))}),l}function Du(t,e,r){return r.foreach((s,n)=>{e=e.updateChild(s,n)}),e}function hl(t,e,r,s,n,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;$e(r)?d=s:d=new Qe(null).setTree(r,s);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,g)=>{if(u.hasChild(h)){const m=e.serverCache.getNode().getImmediateChild(h),x=Du(t,m,g);c=yi(t,c,new ze(h),x,n,i,o,l)}}),d.children.inorderTraversal((h,g)=>{const m=!e.serverCache.isCompleteForChild(h)&&g.value===null;if(!u.hasChild(h)&&!m){const x=e.serverCache.getNode().getImmediateChild(h),f=Du(t,x,g);c=yi(t,c,new ze(h),f,n,i,o,l)}}),c}function cT(t,e,r,s,n,i,o){if(pi(n,r)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if($e(r)&&c.isFullyInitialized()||c.isCompleteForPath(r))return yi(t,e,r,c.getNode().getChild(r),n,i,l,o);if($e(r)){let d=new Qe(null);return c.getNode().forEachChild(Gs,(u,h)=>{d=d.set(new ze(u),h)}),hl(t,e,r,d,n,i,l,o)}else return e}else{let d=new Qe(null);return s.foreach((u,h)=>{const g=ht(r,u);c.isCompleteForPath(g)&&(d=d.set(u,c.getNode().getChild(g)))}),hl(t,e,r,d,n,i,l,o)}}function dT(t,e,r,s,n){const i=e.serverCache,o=Rf(e,i.getNode(),i.isFullyInitialized()||$e(r),i.isFiltered());return Wf(t,o,r,s,Ff,n)}function uT(t,e,r,s,n,i){let o;if(pi(s,r)!=null)return e;{const l=new jc(s,e,n),c=e.eventCache.getNode();let d;if($e(r)||Oe(r)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=fi(s,Ss(e));else{const h=e.serverCache.getNode();oe(h instanceof je,"serverChildren would be complete if leaf node"),u=Nc(s,h)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=Oe(r);let h=Sc(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,Ye(r),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,je.EMPTY_NODE,Ye(r),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=fi(s,Ss(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||pi(s,Ve())!=null,Ln(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hT{constructor(e,r){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,n=new vc(s.getIndex()),i=Ik(s);this.processor_=nT(i);const o=r.serverCache,l=r.eventCache,c=n.updateFullNode(je.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(je.EMPTY_NODE,l.getNode(),null),u=new qr(c,o.isFullyInitialized(),n.filtersNodes()),h=new qr(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ui(h,u),this.eventGenerator_=new $k(this.query_)}get query(){return this.query_}}function gT(t){return t.viewCache_.serverCache.getNode()}function mT(t){return mi(t.viewCache_)}function fT(t,e){const r=Ss(t.viewCache_);return r&&(t.query._queryParams.loadsAllData()||!$e(e)&&!r.getImmediateChild(Oe(e)).isEmpty())?r.getChild(e):null}function Cu(t){return t.eventRegistrations_.length===0}function pT(t,e){t.eventRegistrations_.push(e)}function Eu(t,e,r){const s=[];if(r){oe(e==null,"A cancel should cancel all event registrations.");const n=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(r,n);o&&s.push(o)})}if(e){let n=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))n.push(o);else if(e.hasAnyCallback()){n=n.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=n}else t.eventRegistrations_=[];return s}function Iu(t,e,r,s){e.type===nr.MERGE&&e.source.queryId!==null&&(oe(Ss(t.viewCache_),"We should always have a full cache before handling merges"),oe(mi(t.viewCache_),"Missing event cache, even though we have a server cache"));const n=t.viewCache_,i=iT(t.processor_,n,e,r,s);return aT(t.processor_,i.viewCache),oe(i.viewCache.serverCache.isFullyInitialized()||!n.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,Vf(t,i.changes,i.viewCache.eventCache.getNode(),null)}function yT(t,e){const r=t.viewCache_.eventCache,s=[];return r.getNode().isLeafNode()||r.getNode().forEachChild(it,(i,o)=>{s.push(Js(i,o))}),r.isFullyInitialized()&&s.push(Ef(r.getNode())),Vf(t,s,r.getNode(),e)}function Vf(t,e,r,s){const n=s?[s]:t.eventRegistrations_;return Fk(t.eventGenerator_,e,r,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xi;class Uf{constructor(){this.views=new Map}}function xT(t){oe(!xi,"__referenceConstructor has already been defined"),xi=t}function bT(){return oe(xi,"Reference.ts has not been loaded"),xi}function vT(t){return t.views.size===0}function _c(t,e,r,s){const n=e.source.queryId;if(n!==null){const i=t.views.get(n);return oe(i!=null,"SyncTree gave us an op for an invalid query."),Iu(i,e,r,s)}else{let i=[];for(const o of t.views.values())i=i.concat(Iu(o,e,r,s));return i}}function Bf(t,e,r,s,n){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=fi(r,n?s:null),c=!1;l?c=!0:s instanceof je?(l=Nc(r,s),c=!1):(l=je.EMPTY_NODE,c=!1);const d=Ui(new qr(l,c,!1),new qr(s,n,!1));return new hT(e,d)}return o}function wT(t,e,r,s,n,i){const o=Bf(t,e,s,n,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),pT(o,r),yT(o,r)}function kT(t,e,r,s){const n=e._queryIdentifier,i=[];let o=[];const l=Xr(t);if(n==="default")for(const[c,d]of t.views.entries())o=o.concat(Eu(d,r,s)),Cu(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(n);c&&(o=o.concat(Eu(c,r,s)),Cu(c)&&(t.views.delete(n),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!Xr(t)&&i.push(new(bT())(e._repo,e._path)),{removed:i,events:o}}function Hf(t){const e=[];for(const r of t.views.values())r.query._queryParams.loadsAllData()||e.push(r);return e}function zr(t,e){let r=null;for(const s of t.views.values())r=r||fT(s,e);return r}function Gf(t,e){if(e._queryParams.loadsAllData())return Hi(t);{const s=e._queryIdentifier;return t.views.get(s)}}function zf(t,e){return Gf(t,e)!=null}function Xr(t){return Hi(t)!=null}function Hi(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bi;function TT(t){oe(!bi,"__referenceConstructor has already been defined"),bi=t}function NT(){return oe(bi,"Reference.ts has not been loaded"),bi}let ST=1;class Au{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Qe(null),this.pendingWriteTree_=eT(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Kf(t,e,r,s,n){return Bk(t.pendingWriteTree_,e,r,s,n),n?Na(t,new Ns(Af(),e,r)):[]}function ds(t,e,r=!1){const s=Hk(t.pendingWriteTree_,e);if(Gk(t.pendingWriteTree_,e)){let i=new Qe(null);return s.snap!=null?i=i.set(Ve(),!0):Ot(s.children,o=>{i=i.set(new ze(o),!0)}),Na(t,new gi(s.path,i,r))}else return[]}function Ta(t,e,r){return Na(t,new Ns(kc(),e,r))}function jT(t,e,r){const s=Qe.fromObject(r);return Na(t,new na(kc(),e,s))}function _T(t,e){return Na(t,new sa(kc(),e))}function DT(t,e,r){const s=Cc(t,r);if(s){const n=Ec(s),i=n.path,o=n.queryId,l=Dt(i,e),c=new sa(Tc(o),l);return Ic(t,i,c)}else return[]}function vi(t,e,r,s,n=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||zf(o,e))){const c=kT(o,e,r,s);vT(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!n){const u=d.findIndex(g=>g._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(g,m)=>Xr(m));if(u&&!h){const g=t.syncPointTree_.subtree(i);if(!g.isEmpty()){const m=IT(g);for(let x=0;x<m.length;++x){const f=m[x],p=f.query,w=Qf(t,f);t.listenProvider_.startListening(Fn(p),aa(t,p),w.hashFn,w.onComplete)}}}!h&&d.length>0&&!s&&(u?t.listenProvider_.stopListening(Fn(e),null):d.forEach(g=>{const m=t.queryToTagMap.get(Gi(g));t.listenProvider_.stopListening(Fn(g),m)}))}AT(t,d)}return l}function Yf(t,e,r,s){const n=Cc(t,s);if(n!=null){const i=Ec(n),o=i.path,l=i.queryId,c=Dt(o,e),d=new Ns(Tc(l),c,r);return Ic(t,o,d)}else return[]}function CT(t,e,r,s){const n=Cc(t,s);if(n){const i=Ec(n),o=i.path,l=i.queryId,c=Dt(o,e),d=Qe.fromObject(r),u=new na(Tc(l),c,d);return Ic(t,o,u)}else return[]}function gl(t,e,r,s=!1){const n=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(n,(g,m)=>{const x=Dt(g,n);i=i||zr(m,x),o=o||Xr(m)});let l=t.syncPointTree_.get(n);l?(o=o||Xr(l),i=i||zr(l,Ve())):(l=new Uf,t.syncPointTree_=t.syncPointTree_.set(n,l));let c;i!=null?c=!0:(c=!1,i=je.EMPTY_NODE,t.syncPointTree_.subtree(n).foreachChild((m,x)=>{const f=zr(x,Ve());f&&(i=i.updateImmediateChild(m,f))}));const d=zf(l,e);if(!d&&!e._queryParams.loadsAllData()){const g=Gi(e);oe(!t.queryToTagMap.has(g),"View does not exist, but we have a tag");const m=RT();t.queryToTagMap.set(g,m),t.tagToQueryMap.set(m,g)}const u=Bi(t.pendingWriteTree_,n);let h=wT(l,e,r,u,i,c);if(!d&&!o&&!s){const g=Gf(l,e);h=h.concat(PT(t,e,g))}return h}function Dc(t,e,r){const n=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Dt(o,e),d=zr(l,c);if(d)return d});return Of(n,e,i,r,!0)}function ET(t,e){const r=e._path;let s=null;t.syncPointTree_.foreachOnPath(r,(d,u)=>{const h=Dt(d,r);s=s||zr(u,h)});let n=t.syncPointTree_.get(r);n?s=s||zr(n,Ve()):(n=new Uf,t.syncPointTree_=t.syncPointTree_.set(r,n));const i=s!=null,o=i?new qr(s,!0,!1):null,l=Bi(t.pendingWriteTree_,e._path),c=Bf(n,e,l,i?o.getNode():je.EMPTY_NODE,i);return mT(c)}function Na(t,e){return qf(e,t.syncPointTree_,null,Bi(t.pendingWriteTree_,Ve()))}function qf(t,e,r,s){if($e(t.path))return Xf(t,e,r,s);{const n=e.get(Ve());r==null&&n!=null&&(r=zr(n,Ve()));let i=[];const o=Oe(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=r?r.getImmediateChild(o):null,u=Lf(s,o);i=i.concat(qf(l,c,d,u))}return n&&(i=i.concat(_c(n,t,s,r))),i}}function Xf(t,e,r,s){const n=e.get(Ve());r==null&&n!=null&&(r=zr(n,Ve()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=r?r.getImmediateChild(o):null,d=Lf(s,o),u=t.operationForChild(o);u&&(i=i.concat(Xf(u,l,c,d)))}),n&&(i=i.concat(_c(n,t,s,r))),i}function Qf(t,e){const r=e.query,s=aa(t,r);return{hashFn:()=>(gT(e)||je.EMPTY_NODE).hash(),onComplete:n=>{if(n==="ok")return s?DT(t,r._path,s):_T(t,r._path);{const i=Ew(n,r);return vi(t,r,null,i)}}}}function aa(t,e){const r=Gi(e);return t.queryToTagMap.get(r)}function Gi(t){return t._path.toString()+"$"+t._queryIdentifier}function Cc(t,e){return t.tagToQueryMap.get(e)}function Ec(t){const e=t.indexOf("$");return oe(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new ze(t.substr(0,e))}}function Ic(t,e,r){const s=t.syncPointTree_.get(e);oe(s,"Missing sync point for query tag that we're tracking");const n=Bi(t.pendingWriteTree_,e);return _c(s,r,n,null)}function IT(t){return t.fold((e,r,s)=>{if(r&&Xr(r))return[Hi(r)];{let n=[];return r&&(n=Hf(r)),Ot(s,(i,o)=>{n=n.concat(o)}),n}})}function Fn(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(NT())(t._repo,t._path):t}function AT(t,e){for(let r=0;r<e.length;++r){const s=e[r];if(!s._queryParams.loadsAllData()){const n=Gi(s),i=t.queryToTagMap.get(n);t.queryToTagMap.delete(n),t.tagToQueryMap.delete(i)}}}function RT(){return ST++}function PT(t,e,r){const s=e._path,n=aa(t,e),i=Qf(t,r),o=t.listenProvider_.startListening(Fn(e),n,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(s);if(n)oe(!Xr(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!$e(d)&&u&&Xr(u))return[Hi(u).query];{let g=[];return u&&(g=g.concat(Hf(u).map(m=>m.query))),Ot(h,(m,x)=>{g=g.concat(x)}),g}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(Fn(u),aa(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e){this.node_=e}getImmediateChild(e){const r=this.node_.getImmediateChild(e);return new Ac(r)}node(){return this.node_}}class Rc{constructor(e,r){this.syncTree_=e,this.path_=r}getImmediateChild(e){const r=ht(this.path_,e);return new Rc(this.syncTree_,r)}node(){return Dc(this.syncTree_,this.path_)}}const MT=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Ru=function(t,e,r){if(!t||typeof t!="object")return t;if(oe(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return OT(t[".sv"],e,r);if(typeof t[".sv"]=="object")return LT(t[".sv"],e);oe(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},OT=function(t,e,r){switch(t){case"timestamp":return r.timestamp;default:oe(!1,"Unexpected server value: "+t)}},LT=function(t,e,r){t.hasOwnProperty("increment")||oe(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&oe(!1,"Unexpected increment value: "+s);const n=e.node();if(oe(n!==null&&typeof n<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!n.isLeafNode())return s;const o=n.getValue();return typeof o!="number"?s:o+s},$T=function(t,e,r,s){return Pc(e,new Rc(r,t),s)},Jf=function(t,e,r){return Pc(t,new Ac(e),r)};function Pc(t,e,r){const s=t.getPriority().val(),n=Ru(s,e.getImmediateChild(".priority"),r);let i;if(t.isLeafNode()){const o=t,l=Ru(o.getValue(),e,r);return l!==o.getValue()||n!==o.getPriority().val()?new ft(l,xt(n)):t}else{const o=t;return i=o,n!==o.getPriority().val()&&(i=i.updatePriority(new ft(n))),o.forEachChild(it,(l,c)=>{const d=Pc(c,e.getImmediateChild(l),r);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e="",r=null,s={children:{},childCount:0}){this.name=e,this.parent=r,this.node=s}}function Oc(t,e){let r=e instanceof ze?e:new ze(e),s=t,n=Oe(r);for(;n!==null;){const i=qs(s.node.children,n)||{children:{},childCount:0};s=new Mc(n,s,i),r=Ye(r),n=Oe(r)}return s}function on(t){return t.node.value}function Zf(t,e){t.node.value=e,ml(t)}function ep(t){return t.node.childCount>0}function FT(t){return on(t)===void 0&&!ep(t)}function zi(t,e){Ot(t.node.children,(r,s)=>{e(new Mc(r,t,s))})}function tp(t,e,r,s){r&&e(t),zi(t,n=>{tp(n,e,!0)})}function WT(t,e,r){let s=t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function Sa(t){return new ze(t.parent===null?t.name:Sa(t.parent)+"/"+t.name)}function ml(t){t.parent!==null&&VT(t.parent,t.name,t)}function VT(t,e,r){const s=FT(r),n=Ir(t.node.children,e);s&&n?(delete t.node.children[e],t.node.childCount--,ml(t)):!s&&!n&&(t.node.children[e]=r.node,t.node.childCount++,ml(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UT=/[\[\].#$\/\u0000-\u001F\u007F]/,BT=/[\[\].#$\u0000-\u001F\u007F]/,jo=10*1024*1024,rp=function(t){return typeof t=="string"&&t.length!==0&&!UT.test(t)},sp=function(t){return typeof t=="string"&&t.length!==0&&!BT.test(t)},HT=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),sp(t)},np=function(t,e,r,s){s&&e===void 0||Lc(ac(t,"value"),e,r)},Lc=function(t,e,r){const s=r instanceof ze?new ck(r,t):r;if(e===void 0)throw new Error(t+"contains undefined "+ss(s));if(typeof e=="function")throw new Error(t+"contains a function "+ss(s)+" with contents = "+e.toString());if(Zm(e))throw new Error(t+"contains "+e.toString()+" "+ss(s));if(typeof e=="string"&&e.length>jo/3&&Li(e)>jo)throw new Error(t+"contains a string greater than "+jo+" utf8 bytes "+ss(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let n=!1,i=!1;if(Ot(e,(o,l)=>{if(o===".value")n=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!rp(o)))throw new Error(t+" contains an invalid key ("+o+") "+ss(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);dk(s,o),Lc(t,l,s),uk(s)}),n&&i)throw new Error(t+' contains ".value" child '+ss(s)+" in addition to actual children.")}},ap=function(t,e,r,s){if(!sp(r))throw new Error(ac(t,e)+'was an invalid path = "'+r+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},GT=function(t,e,r,s){r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),ap(t,e,r)},$c=function(t,e){if(Oe(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},zT=function(t,e){const r=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!rp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||r.length!==0&&!HT(r))throw new Error(ac(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Fc(t,e){let r=null;for(let s=0;s<e.length;s++){const n=e[s],i=n.getPath();r!==null&&!yc(i,r.path)&&(t.eventLists_.push(r),r=null),r===null&&(r={events:[],path:i}),r.events.push(n)}r&&t.eventLists_.push(r)}function ip(t,e,r){Fc(t,r),op(t,s=>yc(s,e))}function xr(t,e,r){Fc(t,r),op(t,s=>sr(s,e)||sr(e,s))}function op(t,e){t.recursionDepth_++;let r=!0;for(let s=0;s<t.eventLists_.length;s++){const n=t.eventLists_[s];if(n){const i=n.path;e(i)?(YT(t.eventLists_[s]),t.eventLists_[s]=null):r=!1}}r&&(t.eventLists_=[]),t.recursionDepth_--}function YT(t){for(let e=0;e<t.events.length;e++){const r=t.events[e];if(r!==null){t.events[e]=null;const s=r.getEventRunner();Mn&&Tt("event: "+r.toString()),an(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT="repo_interrupt",XT=25;class QT{constructor(e,r,s,n){this.repoInfo_=e,this.forceRestClient_=r,this.authTokenProvider_=s,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new KT,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=hi(),this.transactionQueueTree_=new Mc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function JT(t,e,r){if(t.stats_=fc(t.repoInfo_),t.forceRestClient_||Pw())t.server_=new ui(t.repoInfo_,(s,n,i,o)=>{Pu(t,s,n,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Mu(t,!0),0);else{if(typeof r<"u"&&r!==null){if(typeof r!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ut(r)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new _r(t.repoInfo_,e,(s,n,i,o)=>{Pu(t,s,n,i,o)},s=>{Mu(t,s)},s=>{ZT(t,s)},t.authTokenProvider_,t.appCheckProvider_,r),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=Fw(t.repoInfo_,()=>new Lk(t.stats_,t.server_)),t.infoData_=new Ak,t.infoSyncTree_=new Au({startListening:(s,n,i,o)=>{let l=[];const c=t.infoData_.getNode(s._path);return c.isEmpty()||(l=Ta(t.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),Vc(t,"connected",!1),t.serverSyncTree_=new Au({startListening:(s,n,i,o)=>(t.server_.listen(s,i,n,(l,c)=>{const d=o(l,c);xr(t.eventQueue_,s._path,d)}),[]),stopListening:(s,n)=>{t.server_.unlisten(s,n)}})}function lp(t){const r=t.infoData_.getNode(new ze(".info/serverTimeOffset")).val()||0;return new Date().getTime()+r}function Wc(t){return MT({timestamp:lp(t)})}function Pu(t,e,r,s,n){t.dataUpdateCount++;const i=new ze(e);r=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,r):r;let o=[];if(n)if(s){const c=ti(r,d=>xt(d));o=CT(t.serverSyncTree_,i,c,n)}else{const c=xt(r);o=Yf(t.serverSyncTree_,i,c,n)}else if(s){const c=ti(r,d=>xt(d));o=jT(t.serverSyncTree_,i,c)}else{const c=xt(r);o=Ta(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=Yi(t,i)),xr(t.eventQueue_,l,o)}function Mu(t,e){Vc(t,"connected",e),e===!1&&rN(t)}function ZT(t,e){Ot(e,(r,s)=>{Vc(t,r,s)})}function Vc(t,e,r){const s=new ze("/.info/"+e),n=xt(r);t.infoData_.updateSnapshot(s,n);const i=Ta(t.infoSyncTree_,s,n);xr(t.eventQueue_,s,i)}function cp(t){return t.nextWriteId_++}function eN(t,e,r){const s=ET(t.serverSyncTree_,e);return s!=null?Promise.resolve(s):t.server_.get(e).then(n=>{const i=xt(n).withIndex(e._queryParams.getIndex());gl(t.serverSyncTree_,e,r,!0);let o;if(e._queryParams.loadsAllData())o=Ta(t.serverSyncTree_,e._path,i);else{const l=aa(t.serverSyncTree_,e);o=Yf(t.serverSyncTree_,e._path,i,l)}return xr(t.eventQueue_,e._path,o),vi(t.serverSyncTree_,e,r,null,!0),i},n=>(Ki(t,"get for query "+ut(e)+" failed: "+n),Promise.reject(new Error(n))))}function tN(t,e,r,s,n){Ki(t,"set",{path:e.toString(),value:r,priority:s});const i=Wc(t),o=xt(r,s),l=Dc(t.serverSyncTree_,e),c=Jf(o,l,i),d=cp(t),u=Kf(t.serverSyncTree_,e,c,d,!0);Fc(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(g,m)=>{const x=g==="ok";x||Mt("set at "+e+" failed: "+g);const f=ds(t.serverSyncTree_,d,!x);xr(t.eventQueue_,e,f),iN(t,n,g,m)});const h=mp(t,e);Yi(t,h),xr(t.eventQueue_,h,[])}function rN(t){Ki(t,"onDisconnectEvents");const e=Wc(t),r=hi();ll(t.onDisconnect_,Ve(),(n,i)=>{const o=$T(n,i,t.serverSyncTree_,e);If(r,n,o)});let s=[];ll(r,Ve(),(n,i)=>{s=s.concat(Ta(t.serverSyncTree_,n,i));const o=mp(t,n);Yi(t,o)}),t.onDisconnect_=hi(),xr(t.eventQueue_,Ve(),s)}function sN(t,e,r){let s;Oe(e._path)===".info"?s=gl(t.infoSyncTree_,e,r):s=gl(t.serverSyncTree_,e,r),ip(t.eventQueue_,e._path,s)}function nN(t,e,r){let s;Oe(e._path)===".info"?s=vi(t.infoSyncTree_,e,r):s=vi(t.serverSyncTree_,e,r),ip(t.eventQueue_,e._path,s)}function aN(t){t.persistentConnection_&&t.persistentConnection_.interrupt(qT)}function Ki(t,...e){let r="";t.persistentConnection_&&(r=t.persistentConnection_.id+":"),Tt(r,...e)}function iN(t,e,r,s){e&&an(()=>{if(r==="ok")e(null);else{const n=(r||"error").toUpperCase();let i=n;s&&(i+=": "+s);const o=new Error(i);o.code=n,e(o)}})}function dp(t,e,r){return Dc(t.serverSyncTree_,e,r)||je.EMPTY_NODE}function Uc(t,e=t.transactionQueueTree_){if(e||qi(t,e),on(e)){const r=hp(t,e);oe(r.length>0,"Sending zero length transaction queue"),r.every(n=>n.status===0)&&oN(t,Sa(e),r)}else ep(e)&&zi(e,r=>{Uc(t,r)})}function oN(t,e,r){const s=r.map(d=>d.currentWriteId),n=dp(t,e,s);let i=n;const o=n.hash();for(let d=0;d<r.length;d++){const u=r[d];oe(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=Dt(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{Ki(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let g=0;g<r.length;g++)r[g].status=2,u=u.concat(ds(t.serverSyncTree_,r[g].currentWriteId)),r[g].onComplete&&h.push(()=>r[g].onComplete(null,!0,r[g].currentOutputSnapshotResolved)),r[g].unwatcher();qi(t,Oc(t.transactionQueueTree_,e)),Uc(t,t.transactionQueueTree_),xr(t.eventQueue_,e,u);for(let g=0;g<h.length;g++)an(h[g])}else{if(d==="datastale")for(let h=0;h<r.length;h++)r[h].status===3?r[h].status=4:r[h].status=0;else{Mt("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<r.length;h++)r[h].status=4,r[h].abortReason=d}Yi(t,e)}},o)}function Yi(t,e){const r=up(t,e),s=Sa(r),n=hp(t,r);return lN(t,n,s),s}function lN(t,e,r){if(e.length===0)return;const s=[];let n=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=Dt(r,c.path);let u=!1,h;if(oe(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,n=n.concat(ds(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=XT)u=!0,h="maxretry",n=n.concat(ds(t.serverSyncTree_,c.currentWriteId,!0));else{const g=dp(t,c.path,o);c.currentInputSnapshot=g;const m=e[l].update(g.val());if(m!==void 0){Lc("transaction failed: Data returned ",m,c.path);let x=xt(m);typeof m=="object"&&m!=null&&Ir(m,".priority")||(x=x.updatePriority(g.getPriority()));const p=c.currentWriteId,w=Wc(t),v=Jf(x,g,w);c.currentOutputSnapshotRaw=x,c.currentOutputSnapshotResolved=v,c.currentWriteId=cp(t),o.splice(o.indexOf(p),1),n=n.concat(Kf(t.serverSyncTree_,c.path,v,c.currentWriteId,c.applyLocally)),n=n.concat(ds(t.serverSyncTree_,p,!0))}else u=!0,h="nodata",n=n.concat(ds(t.serverSyncTree_,c.currentWriteId,!0))}xr(t.eventQueue_,r,n),n=[],u&&(e[l].status=2,function(g){setTimeout(g,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(h),!1,null))))}qi(t,t.transactionQueueTree_);for(let l=0;l<s.length;l++)an(s[l]);Uc(t,t.transactionQueueTree_)}function up(t,e){let r,s=t.transactionQueueTree_;for(r=Oe(e);r!==null&&on(s)===void 0;)s=Oc(s,r),e=Ye(e),r=Oe(e);return s}function hp(t,e){const r=[];return gp(t,e,r),r.sort((s,n)=>s.order-n.order),r}function gp(t,e,r){const s=on(e);if(s)for(let n=0;n<s.length;n++)r.push(s[n]);zi(e,n=>{gp(t,n,r)})}function qi(t,e){const r=on(e);if(r){let s=0;for(let n=0;n<r.length;n++)r[n].status!==2&&(r[s]=r[n],s++);r.length=s,Zf(e,r.length>0?r:void 0)}zi(e,s=>{qi(t,s)})}function mp(t,e){const r=Sa(up(t,e)),s=Oc(t.transactionQueueTree_,e);return WT(s,n=>{_o(t,n)}),_o(t,s),tp(s,n=>{_o(t,n)}),r}function _o(t,e){const r=on(e);if(r){const s=[];let n=[],i=-1;for(let o=0;o<r.length;o++)r[o].status===3||(r[o].status===1?(oe(i===o-1,"All SENT items should be at beginning of queue."),i=o,r[o].status=3,r[o].abortReason="set"):(oe(r[o].status===0,"Unexpected transaction status in abort"),r[o].unwatcher(),n=n.concat(ds(t.serverSyncTree_,r[o].currentWriteId,!0)),r[o].onComplete&&s.push(r[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Zf(e,void 0):r.length=i+1,xr(t.eventQueue_,Sa(e),n);for(let o=0;o<s.length;o++)an(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cN(t){let e="";const r=t.split("/");for(let s=0;s<r.length;s++)if(r[s].length>0){let n=r[s];try{n=decodeURIComponent(n.replace(/\+/g," "))}catch{}e+="/"+n}return e}function dN(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const r of t.split("&")){if(r.length===0)continue;const s=r.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Mt(`Invalid query segment '${r}' in query '${t}'`)}return e}const Ou=function(t,e){const r=uN(t),s=r.namespace;r.domain==="firebase.com"&&Dr(r.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&r.domain!=="localhost"&&Dr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),r.secure||Sw();const n=r.scheme==="ws"||r.scheme==="wss";return{repoInfo:new hf(r.host,r.secure,s,n,e,"",s!==r.subdomain),path:new ze(r.pathString)}},uN=function(t){let e="",r="",s="",n="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(n=cN(t.substring(u,h)));const g=dN(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const m=e.slice(0,d);if(m.toLowerCase()==="localhost")r="localhost";else if(m.split(".").length<=2)r=m;else{const x=e.indexOf(".");s=e.substring(0,x).toLowerCase(),r=e.substring(x+1),i=s}"ns"in g&&(i=g.ns)}return{host:e,port:c,domain:r,subdomain:s,secure:o,scheme:l,pathString:n,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",hN=function(){let t=0;const e=[];return function(r){const s=r===t;t=r;let n;const i=new Array(8);for(n=7;n>=0;n--)i[n]=Lu.charAt(r%64),r=Math.floor(r/64);oe(r===0,"Cannot push at time == 0");let o=i.join("");if(s){for(n=11;n>=0&&e[n]===63;n--)e[n]=0;e[n]++}else for(n=0;n<12;n++)e[n]=Math.floor(Math.random()*64);for(n=0;n<12;n++)o+=Lu.charAt(e[n]);return oe(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e,r,s,n){this.eventType=e,this.eventRegistration=r,this.snapshot=s,this.prevName=n}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ut(this.snapshot.exportVal())}}class mN{constructor(e,r,s){this.eventRegistration=e,this.error=r,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(e,r){this.snapshotCallback=e,this.cancelCallback=r}onValue(e,r){this.snapshotCallback.call(null,e,r)}onCancel(e){return oe(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,r,s,n){this._repo=e,this._path=r,this._queryParams=s,this._orderByCalled=n}get key(){return $e(this._path)?null:wf(this._path)}get ref(){return new Rr(this._repo,this._path)}get _queryIdentifier(){const e=wu(this._queryParams),r=gc(e);return r==="{}"?"default":r}get _queryObject(){return wu(this._queryParams)}isEqual(e){if(e=br(e),!(e instanceof Bc))return!1;const r=this._repo===e._repo,s=yc(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return r&&s&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+lk(this._path)}}class Rr extends Bc{constructor(e,r){super(e,r,new wc,!1)}get parent(){const e=Tf(this._path);return e===null?null:new Rr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ia{constructor(e,r,s){this._node=e,this.ref=r,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const r=new ze(e),s=oa(this.ref,e);return new ia(this._node.getChild(r),s,it)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,n)=>e(new ia(n,oa(this.ref,s),it)))}hasChild(e){const r=new ze(e);return!this._node.getChild(r).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function dr(t,e){return t=br(t),t._checkNotDeleted("ref"),e!==void 0?oa(t._root,e):t._root}function oa(t,e){return t=br(t),Oe(t._path)===null?GT("child","path",e):ap("child","path",e),new Rr(t._repo,ht(t._path,e))}function fN(t,e){t=br(t),$c("push",t._path),np("push",e,t._path,!0);const r=lp(t._repo),s=hN(r),n=oa(t,s),i=oa(t,s);let o;return o=Promise.resolve(i),n.then=o.then.bind(o),n.catch=o.then.bind(o,void 0),n}function $u(t){return $c("remove",t._path),Os(t,null)}function Os(t,e){t=br(t),$c("set",t._path),np("set",e,t._path,!1);const r=new ic;return tN(t._repo,t._path,e,null,r.wrapCallback(()=>{})),r.promise}function Do(t){t=br(t);const e=new fp(()=>{}),r=new Xi(e);return eN(t._repo,t,r).then(s=>new ia(s,new Rr(t._repo,t._path),t._queryParams.getIndex()))}class Xi{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,r){const s=r._queryParams.getIndex();return new gN("value",this,new ia(e.snapshotNode,new Rr(r._repo,r._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,r){return this.callbackContext.hasCancelCallback?new mN(this,e,r):null}matches(e){return e instanceof Xi?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function pN(t,e,r,s,n){const i=new fp(r,void 0),o=new Xi(i);return sN(t._repo,t,o),()=>nN(t._repo,t,o)}function Fu(t,e,r,s){return pN(t,"value",e)}xT(Rr);TT(Rr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yN="FIREBASE_DATABASE_EMULATOR_HOST",fl={};let xN=!1;function bN(t,e,r,s){const n=e.lastIndexOf(":"),i=e.substring(0,n),o=sc(i);t.repoInfo_=new hf(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,r),s&&(t.authTokenProvider_=s)}function vN(t,e,r,s,n){let i=s||t.options.databaseURL;i===void 0&&(t.options.projectId||Dr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Tt("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Ou(i,n),l=o.repoInfo,c;typeof process<"u"&&su&&(c=su[yN]),c?(i=`http://${c}?ns=${l.namespace}`,o=Ou(i,n),l=o.repoInfo):o.repoInfo.secure;const d=new Ow(t.name,t.options,e);zT("Invalid Firebase Database URL",o),$e(o.path)||Dr("Database URL must point to the root of a Firebase Database (not including a child path).");const u=kN(l,t,d,new Mw(t,r));return new TN(u,t)}function wN(t,e){const r=fl[e];(!r||r[t.key]!==t)&&Dr(`Database ${e}(${t.repoInfo_}) has already been deleted.`),aN(t),delete r[t.key]}function kN(t,e,r,s){let n=fl[e.name];n||(n={},fl[e.name]=n);let i=n[t.toURLString()];return i&&Dr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new QT(t,xN,r,s),n[t.toURLString()]=i,i}class TN{constructor(e,r){this._repoInternal=e,this.app=r,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(JT(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Rr(this._repo,Ve())),this._rootInternal}_delete(){return this._rootInternal!==null&&(wN(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Dr("Cannot call "+e+" on a deleted database.")}}function NN(t=rc(),e){const r=xa(t,"database").getImmediate({identifier:e});if(!r._instanceStarted){const s=sm("database");s&&SN(r,...s)}return r}function SN(t,e,r,s={}){t=br(t),t._checkNotDeleted("useEmulator");const n=`${e}:${r}`,i=t._repoInternal;if(t._instanceStarted){if(n===t._repoInternal.repoInfo_.host&&dm(s,i.repoInfo_.emulatorOptions))return;Dr("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Dr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ka(Ka.OWNER);else if(s.mockUserToken){const l=typeof s.mockUserToken=="string"?s.mockUserToken:im(s.mockUserToken,t.app.options.projectId);o=new Ka(l)}sc(e)&&(nm(e),am("Database",!0)),bN(i,n,s,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(t){bw(ec),Qn(new Jn("database",(e,{instanceIdentifier:r})=>{const s=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return vN(s,n,i,r)},"PUBLIC").setMultipleInstances(!0)),Kr(nu,au,t),Kr(nu,au,"esm2017")}_r.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};_r.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};jN();const _N={apiKey:"AIzaSyCaQ6ndqGrR_x6fvTrZxdf5cHTNnRIj2Gg",authDomain:"busvacation-e894a.firebaseapp.com",databaseURL:"https://busvacation-e894a-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"busvacation-e894a",storageBucket:"busvacation-e894a.appspot.com",messagingSenderId:"919121046118",appId:"1:919121046118:web:033047c3f1bba2164e5ba7"},DN=()=>{const t=um().find(e=>e.name==="vacation-management");return t||hm(_N,"vacation-management")},CN=DN(),ur=NN(CN);class EN{constructor(){Ht(this,"listeners");this.listeners=new Map}sanitizeDepartmentCode(e){try{return btoa(encodeURIComponent(e)).replace(/[/+=]/g,"_")}catch{return e.replace(/[^a-zA-Z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")}}getDepartmentPath(e,r){return`departments/${this.sanitizeDepartmentCode(e)}/${r}`}async getEmployees(e){const r=this.getDepartmentPath(e,"employees");try{const s=await Do(dr(ur,r));return s.exists()?s.val():[]}catch(s){return console.error(`âŒ [${e}] ì§ì› ë°ì´í„° ì½ê¸° ì‹¤íŒ¨:`,s),[]}}async saveEmployees(e,r){const s=this.getDepartmentPath(e,"employees");try{return await Os(dr(ur,s),r),console.log(`âœ… [${e}] ì§ì› ë°ì´í„° ì €ì¥ ì™„ë£Œ`),{success:!0}}catch(n){return console.error(`âŒ [${e}] ì§ì› ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}async getVacations(e){const r=this.getDepartmentPath(e,"vacations");try{const s=await Do(dr(ur,r));if(s.exists()){const n=s.val();return Array.isArray(n)?n:Object.keys(n||{}).map(i=>({...n[i],id:i}))}return[]}catch(s){return console.error(`âŒ [${e}] íœ´ê°€ ë°ì´í„° ì½ê¸° ì‹¤íŒ¨:`,s),[]}}async saveVacations(e,r){const s=this.getDepartmentPath(e,"vacations");try{return await Os(dr(ur,s),r),console.log(`âœ… [${e}] íœ´ê°€ ë°ì´í„° ì €ì¥ ì™„ë£Œ`),{success:!0}}catch(n){return console.error(`âŒ [${e}] íœ´ê°€ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}async addVacation(e,r){const s=this.getDepartmentPath(e,"vacations");try{const n=dr(ur,s),i=fN(n),o={...r,id:i.key,createdAt:Date.now(),updatedAt:Date.now()};return await Os(i,o),console.log(`âœ… [${e}] íœ´ê°€ ì¶”ê°€ ì™„ë£Œ:`,o.id),{success:!0,vacation:o}}catch(n){return console.error(`âŒ [${e}] íœ´ê°€ ì¶”ê°€ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}async updateVacation(e,r,s){const n=`${this.getDepartmentPath(e,"vacations")}/${r}`;try{const i={...s,updatedAt:Date.now()};return await Os(dr(ur,n),i),console.log(`âœ… [${e}] íœ´ê°€ ìˆ˜ì • ì™„ë£Œ:`,r),{success:!0}}catch(i){return console.error(`âŒ [${e}] íœ´ê°€ ìˆ˜ì • ì‹¤íŒ¨:`,i),{success:!1,error:i}}}async deleteVacation(e,r){const s=`${this.getDepartmentPath(e,"vacations")}/${r}`;try{return await $u(dr(ur,s)),console.log(`âœ… [${e}] íœ´ê°€ ì‚­ì œ ì™„ë£Œ:`,r),{success:!0}}catch(n){return console.error(`âŒ [${e}] íœ´ê°€ ì‚­ì œ ì‹¤íŒ¨:`,n),{success:!1,error:n}}}subscribeToVacations(e,r){const s=this.getDepartmentPath(e,"vacations"),n=dr(ur,s),i=Fu(n,l=>{const c=l.exists()?l.val():[],d=Array.isArray(c)?c:Object.keys(c||{}).map(u=>({...c[u],id:u}));r(d)}),o=`vacations_${e}`;return this.listeners.set(o,{ref:n,unsubscribe:i}),()=>{i(),this.listeners.delete(o)}}subscribeToEmployees(e,r){const s=this.getDepartmentPath(e,"employees"),n=dr(ur,s),i=Fu(n,l=>{const c=l.exists()?l.val():[];r(c)}),o=`employees_${e}`;return this.listeners.set(o,{ref:n,unsubscribe:i}),()=>{i(),this.listeners.delete(o)}}async testConnection(){try{const e=dr(ur,"connection_test");await Os(e,{timestamp:Date.now(),test:!0});const r=await Do(e),s=r.exists()&&r.val().test===!0;return s&&await $u(e),console.log(`ğŸ”¥ ë¶€ì„œíœ´ê°€ê´€ë¦¬ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ${s?"ì„±ê³µ":"ì‹¤íŒ¨"}`),s}catch(e){return console.error("ë¶€ì„œíœ´ê°€ê´€ë¦¬ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:",e),!1}}cleanup(){console.log("ğŸ§¹ ë¶€ì„œíœ´ê°€ê´€ë¦¬ Firebase ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ ì¤‘..."),this.listeners.forEach(({unsubscribe:e},r)=>{e(),console.log(`âœ… ë¦¬ìŠ¤ë„ˆ ì •ë¦¬ë¨: ${r}`)}),this.listeners.clear()}}const Wu=new EN,pp=y.createContext(void 0),IN=({children:t})=>{const{currentUser:e}=wt(),[r,s]=y.useState([]),[n,i]=y.useState([]),[o,l]=y.useState(!1),[c,d]=y.useState(()=>{const p=localStorage.getItem("showVacationsInTodos");return p?JSON.parse(p):!0}),u=y.useMemo(()=>{const p=new Map;return n.forEach(w=>{const v=p.get(w.date)||[];v.push(w),p.set(w.date,v)}),p},[n]),h=y.useCallback(()=>{d(p=>{const w=!p;return localStorage.setItem("showVacationsInTodos",JSON.stringify(w)),w})},[]),g=y.useCallback(async()=>{if(!(!e||!Hr(e.email))){l(!0);try{const[p,w]=await Promise.all([Wu.getEmployees("ë³´ìƒì§€ì›ë¶€"),Wu.getVacations("ë³´ìƒì§€ì›ë¶€")]);s(p),i(w)}catch(p){console.error("íœ´ê°€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",p)}finally{l(!1)}}},[e]),m=y.useCallback(p=>{if(!c)return[];const w=p.getFullYear(),v=String(p.getMonth()+1).padStart(2,"0"),k=String(p.getDate()).padStart(2,"0"),b=`${w}-${v}-${k}`;return u.get(b)||[]},[c,u]),x=y.useCallback(async(p,w)=>{n.length===0&&e&&Hr(e.email||"")&&await g()},[n.length,e,g]);y.useEffect(()=>{e&&Hr(e.email)&&g()},[e,g]);const f=y.useMemo(()=>({employees:r,vacations:n,loading:o,showVacationsInTodos:c,toggleVacationDisplay:h,refreshVacationData:g,getVacationsForDate:m,loadMonthVacations:x}),[r,n,o,c,h,g,m,x]);return a.jsx(pp.Provider,{value:f,children:t})},ln=()=>{const t=y.useContext(pp);if(t===void 0)throw new Error("useVacation must be used within a VacationProvider");return t},yp=y.createContext(void 0),AN=({children:t,onOpenAddTodo:e,onFocusSearch:r,onToggleSidebar:s,onSwitchToTodayView:n,onSwitchToWeekView:i,onSwitchToMonthView:o})=>{const l={openAddTodoModal:e,focusSearch:r,toggleSidebar:s,switchToTodayView:n,switchToWeekView:i,switchToMonthView:o};return a.jsx(yp.Provider,{value:l,children:t})},RN=()=>{const t=y.useContext(yp);if(t===void 0)throw new Error("useKeyboard must be used within a KeyboardProvider");return t},xp=y.createContext(void 0),PN=()=>{const t=y.useContext(xp);if(t===void 0)throw new Error("useFontSize must be used within a FontSizeProvider");return t},MN=({children:t})=>{const[e,r]=y.useState(()=>{const s=localStorage.getItem("fontSizeLevel");if(s){const n=parseInt(s,10);if(n>=1&&n<=7)return n}return 4});return y.useEffect(()=>{localStorage.setItem("fontSizeLevel",e.toString());const s=document.documentElement;s.classList.remove("font-size-1","font-size-2","font-size-3","font-size-4","font-size-5","font-size-6","font-size-7"),s.classList.add(`font-size-${e}`);const n={1:.55,2:.65,3:.75,4:.85,5:.95,6:1.05,7:1.15};s.style.setProperty("--font-scale",n[e].toString())},[e]),a.jsx(xp.Provider,{value:{fontSizeLevel:e,setFontSizeLevel:r},children:t})},ON=()=>{const{openAddTodoModal:t,focusSearch:e,toggleSidebar:r,switchToTodayView:s,switchToWeekView:n,switchToMonthView:i}=RN();y.useEffect(()=>{const o=c=>{if(c.ctrlKey||c.metaKey)switch(c.key.toLowerCase()){case"1":c.preventDefault(),s();break;case"2":c.preventDefault(),n();break;case"3":c.preventDefault(),i();break;case"b":c.preventDefault(),r();break;case"n":c.preventDefault(),t();break;case"f":c.preventDefault(),e();break;case"k":c.preventDefault(),l();break}if(c.key==="Escape"){const d=document.querySelectorAll('[role="dialog"]');if(d.length>0){c.preventDefault();const u=d[d.length-1].querySelector('[aria-label="ë‹«ê¸°"], [data-close]');u&&u.click()}}},l=()=>{alert(`ğŸ¯ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤:

`+["Ctrl+1: ì˜¤ëŠ˜ ë·°","Ctrl+2: ì£¼ê°„ ë·°","Ctrl+3: ì›”ê°„ ë·°","Ctrl+N: ìƒˆ í• ì¼ ì¶”ê°€","Ctrl+F: ê²€ìƒ‰","Ctrl+B: ì‚¬ì´ë“œë°” í† ê¸€","Ctrl+K: ë‹¨ì¶•í‚¤ ë„ì›€ë§","ESC: ëª¨ë‹¬ ë‹«ê¸°"].join(`
`))};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t,e,r,s,n,i])};class LN{constructor(){Ht(this,"metrics",[]);Ht(this,"observers",[]);this.setupObservers(),this.measureInitialLoad()}setupObservers(){try{if("PerformanceObserver"in window){const e=new PerformanceObserver(i=>{const o=i.getEntries(),l=o[o.length-1];this.recordMetric("LCP",l.startTime,this.getRating("LCP",l.startTime))});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e);const r=new PerformanceObserver(i=>{for(const o of i.getEntries()){const l=o.processingStart-o.startTime;this.recordMetric("FID",l,this.getRating("FID",l))}});r.observe({entryTypes:["first-input"]}),this.observers.push(r);let s=0;const n=new PerformanceObserver(i=>{for(const o of i.getEntries())o.hadRecentInput||(s+=o.value);this.recordMetric("CLS",s,this.getRating("CLS",s))});n.observe({entryTypes:["layout-shift"]}),this.observers.push(n)}}catch(e){ne.error("Performance observer setup failed:",e)}}measureInitialLoad(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.collectNavigationMetrics()):this.collectNavigationMetrics()}collectNavigationMetrics(){if(performance.getEntriesByType){const e=performance.getEntriesByType("navigation")[0];if(e){const r=e.responseStart-e.requestStart;this.recordMetric("TTFB",r,this.getRating("TTFB",r));const s=e.domContentLoadedEventEnd-e.domContentLoadedEventStart;this.recordMetric("DOM_LOADED",s,this.getRating("DOM_LOADED",s));const n=e.loadEventEnd-e.loadEventStart;this.recordMetric("LOAD_COMPLETE",n,this.getRating("LOAD_COMPLETE",n))}}}getRating(e,r){const n={LCP:{good:2500,poor:4e3},FID:{good:100,poor:300},CLS:{good:.1,poor:.25},TTFB:{good:800,poor:1800},DOM_LOADED:{good:1e3,poor:3e3},LOAD_COMPLETE:{good:2e3,poor:5e3}}[e];return!n||r<=n.good?"good":r<=n.poor?"needs-improvement":"poor"}recordMetric(e,r,s){const n={name:e,value:r,rating:s,timestamp:Date.now()};this.metrics.push(n),ne.log(`Performance metric: ${e} = ${r.toFixed(2)}ms (${s})`),s==="poor"&&ne.warn(`Poor performance detected: ${e} = ${r.toFixed(2)}ms`)}measureMemoryUsage(){if("memory"in performance){const e=performance.memory;ne.log("Memory usage:",{used:`${(e.usedJSHeapSize/1024/1024).toFixed(2)}MB`,total:`${(e.totalJSHeapSize/1024/1024).toFixed(2)}MB`,limit:`${(e.jsHeapSizeLimit/1024/1024).toFixed(2)}MB`})}}getMetrics(){return[...this.metrics]}getSummary(){const e={};return[...new Set(this.metrics.map(s=>s.name))].forEach(s=>{const n=this.metrics.filter(i=>i.name===s).sort((i,o)=>o.timestamp-i.timestamp)[0];n&&(e[s]={value:n.value,rating:n.rating})}),e}cleanup(){this.observers.forEach(e=>e.disconnect()),this.observers=[],this.metrics=[]}}const $N=new LN,FN=t=>{const e=performance.now();return()=>{const s=performance.now()-e;ne.log(`Render time for ${t}: ${s.toFixed(2)}ms`),s>16.67&&ne.warn(`Slow render detected: ${t} took ${s.toFixed(2)}ms`)}};class WN{constructor(){Ht(this,"errors",[]);Ht(this,"maxErrors",100);this.setupGlobalErrorHandling()}setupGlobalErrorHandling(){window.addEventListener("error",e=>{this.trackError({message:e.message,stack:e.error?.stack,severity:"high",context:{filename:e.filename,lineno:e.lineno,colno:e.colno}})}),window.addEventListener("unhandledrejection",e=>{const r=e.reason;this.trackError({message:r?.message||"Unhandled promise rejection",stack:r?.stack,severity:"high",context:{type:"unhandled_promise_rejection",reason:r}})}),window.addEventListener("error",e=>{e.target!==window&&this.trackError({message:"Resource loading failed",severity:"medium",context:{type:"resource_error",element:e.target?.tagName,source:e.target?.src||e.target?.href}})},!0)}trackError(e){const r={id:this.generateErrorId(),message:e.message,stack:e.stack,severity:e.severity,timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent,userId:e.userId,context:e.context,resolved:!1};return this.errors.push(r),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors)),r.severity==="critical"||r.severity==="high"?ne.error(`[ErrorTracker] ${r.severity.toUpperCase()}: ${r.message}`,{id:r.id,stack:r.stack,context:r.context}):ne.warn(`[ErrorTracker] ${r.severity.toUpperCase()}: ${r.message}`),r.id}trackReactError(e,r,s){return this.trackError({message:`React Error: ${e.message}`,stack:e.stack,severity:"high",context:{type:"react_error",componentStack:r.componentStack,errorBoundary:r.errorBoundary},userId:s})}trackFirebaseError(e,r,s){const n=this.getFirebaseErrorSeverity(e.code);return this.trackError({message:`Firebase Error in ${r}: ${e.message}`,stack:e.stack,severity:n,context:{type:"firebase_error",code:e.code,operation:r,customData:e.customData},userId:s})}trackUserActionError(e,r,s){return this.trackError({message:`User Action Error (${e}): ${r.message}`,stack:r.stack,severity:"medium",context:{type:"user_action_error",action:e,timestamp:Date.now()},userId:s})}getFirebaseErrorSeverity(e){const r=["internal","unavailable","data-loss"],s=["permission-denied","unauthenticated","failed-precondition"],n=["not-found","already-exists","invalid-argument"];return r.includes(e)?"critical":s.includes(e)?"high":n.includes(e)?"medium":"low"}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}resolveError(e){const r=this.errors.find(s=>s.id===e);return r?(r.resolved=!0,!0):!1}getErrorStats(){const e=this.errors.length,r=this.errors.filter(o=>o.resolved).length,s=e-r,n=this.errors.reduce((o,l)=>(o[l.severity]=(o[l.severity]||0)+1,o),{}),i=this.errors.slice(-10).sort((o,l)=>l.timestamp-o.timestamp);return{total:e,resolved:r,unresolved:s,bySeverity:n,recent:i}}getCriticalErrors(){return this.errors.filter(e=>(e.severity==="critical"||e.severity==="high")&&!e.resolved)}searchErrors(e){const r=e.toLowerCase();return this.errors.filter(s=>s.message.toLowerCase().includes(r)||s.stack?.toLowerCase().includes(r))}exportErrors(){return JSON.stringify(this.errors,null,2)}cleanup(){this.errors=[]}}const bp=new WN,mR=t=>(e,r)=>{bp.trackReactError(e,{componentStack:r.componentStack,errorBoundary:t})},VN=()=>{const t=document.querySelector('meta[http-equiv="Content-Security-Policy"]');t&&ne.log("CSP policy found:",t.getAttribute("content"))},UN=()=>{try{const t="_security_test",e="test";localStorage.setItem(t,e);const r=localStorage.getItem(t);localStorage.removeItem(t),r!==e?ne.error("localStorage security test failed"):ne.log("localStorage security validation passed")}catch(t){ne.error("localStorage access error:",t)}},BN=async()=>{try{return typeof window<"u"&&window.firebase?(ne.log("Firebase is properly initialized"),!0):(ne.warn("Firebase not found or not initialized"),!1)}catch(t){return ne.error("Firebase validation error:",t),!1}},vp=()=>({https:window.location.protocol==="https:",secureContext:window.isSecureContext,cookieSecure:document.cookie.includes("Secure"),localStorage:!!window.localStorage,sessionStorage:!!window.sessionStorage}),HN=()=>{VN(),UN(),vp(),BN(),window.addEventListener("error",t=>{t.error&&t.error.name==="SecurityError"&&ne.error("Security error detected:",t.error)})},Vu=()=>{const t=[],e=vp(),r=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",s=e.https||r?"pass":"fail";return t.push({name:"HTTPS",status:s,details:e.https?"Site served over HTTPS":r?"Localhost allowed without HTTPS":"Site not served over HTTPS"}),t.push({name:"Secure Context",status:e.secureContext?"pass":"fail",details:e.secureContext?"Running in secure context":"Not running in secure context"}),t.push({name:"Local Storage",status:e.localStorage?"pass":"fail",details:e.localStorage?"localStorage available":"localStorage not available"}),{timestamp:Date.now(),checks:t}},Ee=t=>typeof t=="string",_n=()=>{let t,e;const r=new Promise((s,n)=>{t=s,e=n});return r.resolve=t,r.reject=e,r},Uu=t=>t==null?"":""+t,GN=(t,e,r)=>{t.forEach(s=>{e[s]&&(r[s]=e[s])})},zN=/###/g,Bu=t=>t&&t.indexOf("###")>-1?t.replace(zN,"."):t,Hu=t=>!t||Ee(t),Wn=(t,e,r)=>{const s=Ee(e)?e.split("."):e;let n=0;for(;n<s.length-1;){if(Hu(t))return{};const i=Bu(s[n]);!t[i]&&r&&(t[i]=new r),Object.prototype.hasOwnProperty.call(t,i)?t=t[i]:t={},++n}return Hu(t)?{}:{obj:t,k:Bu(s[n])}},Gu=(t,e,r)=>{const{obj:s,k:n}=Wn(t,e,Object);if(s!==void 0||e.length===1){s[n]=r;return}let i=e[e.length-1],o=e.slice(0,e.length-1),l=Wn(t,o,Object);for(;l.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),l=Wn(t,o,Object),l?.obj&&typeof l.obj[`${l.k}.${i}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${i}`]=r},KN=(t,e,r,s)=>{const{obj:n,k:i}=Wn(t,e,Object);n[i]=n[i]||[],n[i].push(r)},wi=(t,e)=>{const{obj:r,k:s}=Wn(t,e);if(r&&Object.prototype.hasOwnProperty.call(r,s))return r[s]},YN=(t,e,r)=>{const s=wi(t,r);return s!==void 0?s:wi(e,r)},wp=(t,e,r)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in t?Ee(t[s])||t[s]instanceof String||Ee(e[s])||e[s]instanceof String?r&&(t[s]=e[s]):wp(t[s],e[s],r):t[s]=e[s]);return t},Is=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var qN={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const XN=t=>Ee(t)?t.replace(/[&<>"'\/]/g,e=>qN[e]):t;class QN{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const r=this.regExpMap.get(e);if(r!==void 0)return r;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const JN=[" ",",","?","!",";"],ZN=new QN(20),eS=(t,e,r)=>{e=e||"",r=r||"";const s=JN.filter(o=>e.indexOf(o)<0&&r.indexOf(o)<0);if(s.length===0)return!0;const n=ZN.getRegExp(`(${s.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!n.test(t);if(!i){const o=t.indexOf(r);o>0&&!n.test(t.substring(0,o))&&(i=!0)}return i},pl=(t,e,r=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const s=e.split(r);let n=t;for(let i=0;i<s.length;){if(!n||typeof n!="object")return;let o,l="";for(let c=i;c<s.length;++c)if(c!==i&&(l+=r),l+=s[c],o=n[l],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&c<s.length-1)continue;i+=c-i+1;break}n=o}return n},la=t=>t?.replace("_","-"),tS={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class ki{constructor(e,r={}){this.init(e,r)}init(e,r={}){this.prefix=r.prefix||"i18next:",this.logger=e||tS,this.options=r,this.debug=r.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,r,s,n){return n&&!this.debug?null:(Ee(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[r](e))}create(e){return new ki(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new ki(this.logger,e)}}var mr=new ki;class Qi{constructor(){this.observers={}}on(e,r){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const n=this.observers[s].get(r)||0;this.observers[s].set(r,n+1)}),this}off(e,r){if(this.observers[e]){if(!r){delete this.observers[e];return}this.observers[e].delete(r)}}emit(e,...r){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([n,i])=>{for(let o=0;o<i;o++)n(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([n,i])=>{for(let o=0;o<i;o++)n.apply(n,[e,...r])})}}class zu extends Qi{constructor(e,r={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const r=this.options.ns.indexOf(e);r>-1&&this.options.ns.splice(r,1)}getResource(e,r,s,n={}){const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,o=n.ignoreJSONStructure!==void 0?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,r],s&&(Array.isArray(s)?l.push(...s):Ee(s)&&i?l.push(...s.split(i)):l.push(s)));const c=wi(this.data,l);return!c&&!r&&!s&&e.indexOf(".")>-1&&(e=l[0],r=l[1],s=l.slice(2).join(".")),c||!o||!Ee(s)?c:pl(this.data?.[e]?.[r],s,i)}addResource(e,r,s,n,i={silent:!1}){const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let l=[e,r];s&&(l=l.concat(o?s.split(o):s)),e.indexOf(".")>-1&&(l=e.split("."),n=r,r=l[1]),this.addNamespaces(r),Gu(this.data,l,n),i.silent||this.emit("added",e,r,s,n)}addResources(e,r,s,n={silent:!1}){for(const i in s)(Ee(s[i])||Array.isArray(s[i]))&&this.addResource(e,r,i,s[i],{silent:!0});n.silent||this.emit("added",e,r,s)}addResourceBundle(e,r,s,n,i,o={silent:!1,skipCopy:!1}){let l=[e,r];e.indexOf(".")>-1&&(l=e.split("."),n=s,s=r,r=l[1]),this.addNamespaces(r);let c=wi(this.data,l)||{};o.skipCopy||(s=JSON.parse(JSON.stringify(s))),n?wp(c,s,i):c={...c,...s},Gu(this.data,l,c),o.silent||this.emit("added",e,r,s)}removeResourceBundle(e,r){this.hasResourceBundle(e,r)&&delete this.data[e][r],this.removeNamespaces(r),this.emit("removed",e,r)}hasResourceBundle(e,r){return this.getResource(e,r)!==void 0}getResourceBundle(e,r){return r||(r=this.options.defaultNS),this.getResource(e,r)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const r=this.getDataByLanguage(e);return!!(r&&Object.keys(r)||[]).find(n=>r[n]&&Object.keys(r[n]).length>0)}toJSON(){return this.data}}var kp={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,r,s,n){return t.forEach(i=>{e=this.processors[i]?.process(e,r,s,n)??e}),e}};const Tp=Symbol("i18next/PATH_KEY");function rS(){const t=[],e=Object.create(null);let r;return e.get=(s,n)=>(r?.revoke?.(),n===Tp?t:(t.push(n),r=Proxy.revocable(s,e),r.proxy)),Proxy.revocable(Object.create(null),e).proxy}function yl(t,e){const{[Tp]:r}=t(rS());return r.join(e?.keySeparator??".")}const Ku={},Co=t=>!Ee(t)&&typeof t!="boolean"&&typeof t!="number";class Ti extends Qi{constructor(e,r={}){super(),GN(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=mr.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,r={interpolation:{}}){const s={...r};if(e==null)return!1;const n=this.resolve(e,s);if(n?.res===void 0)return!1;const i=Co(n.res);return!(s.returnObjects===!1&&i)}extractFromKey(e,r){let s=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const n=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let i=r.ns||this.options.defaultNS||[];const o=s&&e.indexOf(s)>-1,l=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!eS(e,s,n);if(o&&!l){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:Ee(i)?[i]:i};const d=e.split(s);(s!==n||s===n&&this.options.ns.indexOf(d[0])>-1)&&(i=d.shift()),e=d.join(n)}return{key:e,namespaces:Ee(i)?[i]:i}}translate(e,r,s){let n=typeof r=="object"?{...r}:r;if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";typeof e=="function"&&(e=yl(e,{...this.options,...n})),Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,o=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:l,namespaces:c}=this.extractFromKey(e[e.length-1],n),d=c[c.length-1];let u=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;u===void 0&&(u=":");const h=n.lng||this.language,g=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h?.toLowerCase()==="cimode")return g?i?{res:`${d}${u}${l}`,usedKey:l,exactUsedKey:l,usedLng:h,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:`${d}${u}${l}`:i?{res:l,usedKey:l,exactUsedKey:l,usedLng:h,usedNS:d,usedParams:this.getUsedParamsDetails(n)}:l;const m=this.resolve(e,n);let x=m?.res;const f=m?.usedKey||l,p=m?.exactUsedKey||l,w=["[object Number]","[object Function]","[object RegExp]"],v=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,k=!this.i18nFormat||this.i18nFormat.handleAsObject,b=n.count!==void 0&&!Ee(n.count),T=Ti.hasDefaultValue(n),_=b?this.pluralResolver.getSuffix(h,n.count,n):"",j=n.ordinal&&b?this.pluralResolver.getSuffix(h,n.count,{ordinal:!1}):"",N=b&&!n.ordinal&&n.count===0,D=N&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${_}`]||n[`defaultValue${j}`]||n.defaultValue;let $=x;k&&!x&&T&&($=D);const C=Co($),R=Object.prototype.toString.apply($);if(k&&$&&C&&w.indexOf(R)<0&&!(Ee(v)&&Array.isArray($))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const B=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,$,{...n,ns:c}):`key '${l} (${this.language})' returned an object instead of string.`;return i?(m.res=B,m.usedParams=this.getUsedParamsDetails(n),m):B}if(o){const B=Array.isArray($),Y=B?[]:{},V=B?p:f;for(const q in $)if(Object.prototype.hasOwnProperty.call($,q)){const z=`${V}${o}${q}`;T&&!x?Y[q]=this.translate(z,{...n,defaultValue:Co(D)?D[q]:void 0,joinArrays:!1,ns:c}):Y[q]=this.translate(z,{...n,joinArrays:!1,ns:c}),Y[q]===z&&(Y[q]=$[q])}x=Y}}else if(k&&Ee(v)&&Array.isArray(x))x=x.join(v),x&&(x=this.extendTranslation(x,e,n,s));else{let B=!1,Y=!1;!this.isValidLookup(x)&&T&&(B=!0,x=D),this.isValidLookup(x)||(Y=!0,x=l);const q=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Y?void 0:x,z=T&&D!==x&&this.options.updateMissing;if(Y||B||z){if(this.logger.log(z?"updateKey":"missingKey",h,d,l,z?D:x),o){const fe=this.resolve(l,{...n,keySeparator:!1});fe&&fe.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let de=[];const Te=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Te&&Te[0])for(let fe=0;fe<Te.length;fe++)de.push(Te[fe]);else this.options.saveMissingTo==="all"?de=this.languageUtils.toResolveHierarchy(n.lng||this.language):de.push(n.lng||this.language);const we=(fe,W,le)=>{const ie=T&&le!==x?le:q;this.options.missingKeyHandler?this.options.missingKeyHandler(fe,d,W,ie,z,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(fe,d,W,ie,z,n),this.emit("missingKey",fe,d,W,x)};this.options.saveMissing&&(this.options.saveMissingPlurals&&b?de.forEach(fe=>{const W=this.pluralResolver.getSuffixes(fe,n);N&&n[`defaultValue${this.options.pluralSeparator}zero`]&&W.indexOf(`${this.options.pluralSeparator}zero`)<0&&W.push(`${this.options.pluralSeparator}zero`),W.forEach(le=>{we([fe],l+le,n[`defaultValue${le}`]||D)})}):we(de,l,D))}x=this.extendTranslation(x,e,n,m,s),Y&&x===l&&this.options.appendNamespaceToMissingKey&&(x=`${d}${u}${l}`),(Y||B)&&this.options.parseMissingKeyHandler&&(x=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${d}${u}${l}`:l,B?x:void 0,n))}return i?(m.res=x,m.usedParams=this.getUsedParamsDetails(n),m):x}extendTranslation(e,r,s,n,i){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const c=Ee(e)&&(s?.interpolation?.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(c){const h=e.match(this.interpolator.nestingRegexp);d=h&&h.length}let u=s.replace&&!Ee(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(u={...this.options.interpolation.defaultVariables,...u}),e=this.interpolator.interpolate(e,u,s.lng||this.language||n.usedLng,s),c){const h=e.match(this.interpolator.nestingRegexp),g=h&&h.length;d<g&&(s.nest=!1)}!s.lng&&n&&n.res&&(s.lng=this.language||n.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,(...h)=>i?.[0]===h[0]&&!s.context?(this.logger.warn(`It seems you are nesting recursively key: ${h[0]} in key: ${r[0]}`),null):this.translate(...h,r),s)),s.interpolation&&this.interpolator.reset()}const o=s.postProcess||this.options.postProcess,l=Ee(o)?[o]:o;return e!=null&&l?.length&&s.applyPostProcessor!==!1&&(e=kp.handle(l,e,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e,r={}){let s,n,i,o,l;return Ee(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(s))return;const d=this.extractFromKey(c,r),u=d.key;n=u;let h=d.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const g=r.count!==void 0&&!Ee(r.count),m=g&&!r.ordinal&&r.count===0,x=r.context!==void 0&&(Ee(r.context)||typeof r.context=="number")&&r.context!=="",f=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);h.forEach(p=>{this.isValidLookup(s)||(l=p,!Ku[`${f[0]}-${p}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(l)&&(Ku[`${f[0]}-${p}`]=!0,this.logger.warn(`key "${n}" for languages "${f.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach(w=>{if(this.isValidLookup(s))return;o=w;const v=[u];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(v,u,w,p,r);else{let b;g&&(b=this.pluralResolver.getSuffix(w,r.count,r));const T=`${this.options.pluralSeparator}zero`,_=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(g&&(r.ordinal&&b.indexOf(_)===0&&v.push(u+b.replace(_,this.options.pluralSeparator)),v.push(u+b),m&&v.push(u+T)),x){const j=`${u}${this.options.contextSeparator||"_"}${r.context}`;v.push(j),g&&(r.ordinal&&b.indexOf(_)===0&&v.push(j+b.replace(_,this.options.pluralSeparator)),v.push(j+b),m&&v.push(j+T))}}let k;for(;k=v.pop();)this.isValidLookup(s)||(i=k,s=this.getResource(w,p,k,r))}))})}),{res:s,usedKey:n,exactUsedKey:i,usedLng:o,usedNS:l}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,r,s,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,r,s,n):this.resourceStore.getResource(e,r,s,n)}getUsedParamsDetails(e={}){const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!Ee(e.replace);let n=s?e.replace:e;if(s&&typeof e.count<"u"&&(n.count=e.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!s){n={...n};for(const i of r)delete n[i]}return n}static hasDefaultValue(e){const r="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&r===s.substring(0,r.length)&&e[s]!==void 0)return!0;return!1}}class Yu{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=mr.create("languageUtils")}getScriptPartFromCode(e){if(e=la(e),!e||e.indexOf("-")<0)return null;const r=e.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(e){if(e=la(e),!e||e.indexOf("-")<0)return e;const r=e.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(e){if(Ee(e)&&e.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(e)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let r;return e.forEach(s=>{if(r)return;const n=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(n))&&(r=n)}),!r&&this.options.supportedLngs&&e.forEach(s=>{if(r)return;const n=this.getScriptPartFromCode(s);if(this.isSupportedCode(n))return r=n;const i=this.getLanguagePartFromCode(s);if(this.isSupportedCode(i))return r=i;r=this.options.supportedLngs.find(o=>{if(o===i)return o;if(!(o.indexOf("-")<0&&i.indexOf("-")<0)&&(o.indexOf("-")>0&&i.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===i||o.indexOf(i)===0&&i.length>1))return o})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(e,r){if(!e)return[];if(typeof e=="function"&&(e=e(r)),Ee(e)&&(e=[e]),Array.isArray(e))return e;if(!r)return e.default||[];let s=e[r];return s||(s=e[this.getScriptPartFromCode(r)]),s||(s=e[this.formatLanguageCode(r)]),s||(s=e[this.getLanguagePartFromCode(r)]),s||(s=e.default),s||[]}toResolveHierarchy(e,r){const s=this.getFallbackCodes((r===!1?[]:r)||this.options.fallbackLng||[],e),n=[],i=o=>{o&&(this.isSupportedCode(o)?n.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return Ee(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):Ee(e)&&i(this.formatLanguageCode(e)),s.forEach(o=>{n.indexOf(o)<0&&i(this.formatLanguageCode(o))}),n}}const qu={zero:0,one:1,two:2,few:3,many:4,other:5},Xu={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class sS{constructor(e,r={}){this.languageUtils=e,this.options=r,this.logger=mr.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,r){this.rules[e]=r}clearCache(){this.pluralRulesCache={}}getRule(e,r={}){const s=la(e==="dev"?"en":e),n=r.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:n});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(s,{type:n})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Xu;if(!e.match(/-|_/))return Xu;const c=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(c,r)}return this.pluralRulesCache[i]=o,o}needsPlural(e,r={}){let s=this.getRule(e,r);return s||(s=this.getRule("dev",r)),s?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,r,s={}){return this.getSuffixes(e,s).map(n=>`${r}${n}`)}getSuffixes(e,r={}){let s=this.getRule(e,r);return s||(s=this.getRule("dev",r)),s?s.resolvedOptions().pluralCategories.sort((n,i)=>qu[n]-qu[i]).map(n=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${n}`):[]}getSuffix(e,r,s={}){const n=this.getRule(e,s);return n?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${n.select(r)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",r,s))}}const Qu=(t,e,r,s=".",n=!0)=>{let i=YN(t,e,r);return!i&&n&&Ee(r)&&(i=pl(t,r,s),i===void 0&&(i=pl(e,r,s))),i},Eo=t=>t.replace(/\$/g,"$$$$");class Ju{constructor(e={}){this.logger=mr.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(r=>r),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:r,escapeValue:s,useRawValueToEscape:n,prefix:i,prefixEscaped:o,suffix:l,suffixEscaped:c,formatSeparator:d,unescapeSuffix:u,unescapePrefix:h,nestingPrefix:g,nestingPrefixEscaped:m,nestingSuffix:x,nestingSuffixEscaped:f,nestingOptionsSeparator:p,maxReplaces:w,alwaysFormat:v}=e.interpolation;this.escape=r!==void 0?r:XN,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=n!==void 0?n:!1,this.prefix=i?Is(i):o||"{{",this.suffix=l?Is(l):c||"}}",this.formatSeparator=d||",",this.unescapePrefix=u?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=g?Is(g):m||Is("$t("),this.nestingSuffix=x?Is(x):f||Is(")"),this.nestingOptionsSeparator=p||",",this.maxReplaces=w||1e3,this.alwaysFormat=v!==void 0?v:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(r,s)=>r?.source===s?(r.lastIndex=0,r):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,r,s,n){let i,o,l;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=m=>{if(m.indexOf(this.formatSeparator)<0){const w=Qu(r,c,m,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(w,void 0,s,{...n,...r,interpolationkey:m}):w}const x=m.split(this.formatSeparator),f=x.shift().trim(),p=x.join(this.formatSeparator).trim();return this.format(Qu(r,c,f,this.options.keySeparator,this.options.ignoreJSONStructure),p,s,{...n,...r,interpolationkey:f})};this.resetRegExp();const u=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:m=>Eo(m)},{regex:this.regexp,safeValue:m=>this.escapeValue?Eo(this.escape(m)):Eo(m)}].forEach(m=>{for(l=0;i=m.regex.exec(e);){const x=i[1].trim();if(o=d(x),o===void 0)if(typeof u=="function"){const p=u(e,i,n);o=Ee(p)?p:""}else if(n&&Object.prototype.hasOwnProperty.call(n,x))o="";else if(h){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${x} for interpolating ${e}`),o="";else!Ee(o)&&!this.useRawValueToEscape&&(o=Uu(o));const f=m.safeValue(o);if(e=e.replace(i[0],f),h?(m.regex.lastIndex+=o.length,m.regex.lastIndex-=i[0].length):m.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),e}nest(e,r,s={}){let n,i,o;const l=(c,d)=>{const u=this.nestingOptionsSeparator;if(c.indexOf(u)<0)return c;const h=c.split(new RegExp(`${u}[ ]*{`));let g=`{${h[1]}`;c=h[0],g=this.interpolate(g,o);const m=g.match(/'/g),x=g.match(/"/g);((m?.length??0)%2===0&&!x||x.length%2!==0)&&(g=g.replace(/'/g,'"'));try{o=JSON.parse(g),d&&(o={...d,...o})}catch(f){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,f),`${c}${u}${g}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,c};for(;n=this.nestingRegexp.exec(e);){let c=[];o={...s},o=o.replace&&!Ee(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;const d=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(d!==-1&&(c=n[1].slice(d).split(this.formatSeparator).map(u=>u.trim()).filter(Boolean),n[1]=n[1].slice(0,d)),i=r(l.call(this,n[1].trim(),o),o),i&&n[0]===e&&!Ee(i))return i;Ee(i)||(i=Uu(i)),i||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${e}`),i=""),c.length&&(i=c.reduce((u,h)=>this.format(u,h,s.lng,{...s,interpolationkey:n[1].trim()}),i.trim())),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e}}const nS=t=>{let e=t.toLowerCase().trim();const r={};if(t.indexOf("(")>-1){const s=t.split("(");e=s[0].toLowerCase().trim();const n=s[1].substring(0,s[1].length-1);e==="currency"&&n.indexOf(":")<0?r.currency||(r.currency=n.trim()):e==="relativetime"&&n.indexOf(":")<0?r.range||(r.range=n.trim()):n.split(";").forEach(o=>{if(o){const[l,...c]=o.split(":"),d=c.join(":").trim().replace(/^'+|'+$/g,""),u=l.trim();r[u]||(r[u]=d),d==="false"&&(r[u]=!1),d==="true"&&(r[u]=!0),isNaN(d)||(r[u]=parseInt(d,10))}})}return{formatName:e,formatOptions:r}},Zu=t=>{const e={};return(r,s,n)=>{let i=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(i={...i,[n.interpolationkey]:void 0});const o=s+JSON.stringify(i);let l=e[o];return l||(l=t(la(s),n),e[o]=l),l(r)}},aS=t=>(e,r,s)=>t(la(r),s)(e);class iS{constructor(e={}){this.logger=mr.create("formatter"),this.options=e,this.init(e)}init(e,r={interpolation:{}}){this.formatSeparator=r.interpolation.formatSeparator||",";const s=r.cacheInBuiltFormats?Zu:aS;this.formats={number:s((n,i)=>{const o=new Intl.NumberFormat(n,{...i});return l=>o.format(l)}),currency:s((n,i)=>{const o=new Intl.NumberFormat(n,{...i,style:"currency"});return l=>o.format(l)}),datetime:s((n,i)=>{const o=new Intl.DateTimeFormat(n,{...i});return l=>o.format(l)}),relativetime:s((n,i)=>{const o=new Intl.RelativeTimeFormat(n,{...i});return l=>o.format(l,i.range||"day")}),list:s((n,i)=>{const o=new Intl.ListFormat(n,{...i});return l=>o.format(l)})}}add(e,r){this.formats[e.toLowerCase().trim()]=r}addCached(e,r){this.formats[e.toLowerCase().trim()]=Zu(r)}format(e,r,s,n={}){const i=r.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(l=>l.indexOf(")")>-1)){const l=i.findIndex(c=>c.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,l)].join(this.formatSeparator)}return i.reduce((l,c)=>{const{formatName:d,formatOptions:u}=nS(c);if(this.formats[d]){let h=l;try{const g=n?.formatParams?.[n.interpolationkey]||{},m=g.locale||g.lng||n.locale||n.lng||s;h=this.formats[d](l,m,{...u,...n,...g})}catch(g){this.logger.warn(g)}return h}else this.logger.warn(`there was no format function for ${d}`);return l},e)}}const oS=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class lS extends Qi{constructor(e,r,s,n={}){super(),this.backend=e,this.store=r,this.services=s,this.languageUtils=s.languageUtils,this.options=n,this.logger=mr.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(s,n.backend,n)}queueLoad(e,r,s,n){const i={},o={},l={},c={};return e.forEach(d=>{let u=!0;r.forEach(h=>{const g=`${d}|${h}`;!s.reload&&this.store.hasResourceBundle(d,h)?this.state[g]=2:this.state[g]<0||(this.state[g]===1?o[g]===void 0&&(o[g]=!0):(this.state[g]=1,u=!1,o[g]===void 0&&(o[g]=!0),i[g]===void 0&&(i[g]=!0),c[h]===void 0&&(c[h]=!0)))}),u||(l[d]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(c)}}loaded(e,r,s){const n=e.split("|"),i=n[0],o=n[1];r&&this.emit("failedLoading",i,o,r),!r&&s&&this.store.addResourceBundle(i,o,s,void 0,void 0,{skipCopy:!0}),this.state[e]=r?-1:2,r&&s&&(this.state[e]=0);const l={};this.queue.forEach(c=>{KN(c.loaded,[i],o),oS(c,e),r&&c.errors.push(r),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(d=>{l[d]||(l[d]={});const u=c.loaded[d];u.length&&u.forEach(h=>{l[d][h]===void 0&&(l[d][h]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(c=>!c.done)}read(e,r,s,n=0,i=this.retryTimeout,o){if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:r,fcName:s,tried:n,wait:i,callback:o});return}this.readingCalls++;const l=(d,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(d&&u&&n<this.maxRetries){setTimeout(()=>{this.read.call(this,e,r,s,n+1,i*2,o)},i);return}o(d,u)},c=this.backend[s].bind(this.backend);if(c.length===2){try{const d=c(e,r);d&&typeof d.then=="function"?d.then(u=>l(null,u)).catch(l):l(null,d)}catch(d){l(d)}return}return c(e,r,l)}prepareLoading(e,r,s={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();Ee(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Ee(r)&&(r=[r]);const i=this.queueLoad(e,r,s,n);if(!i.toLoad.length)return i.pending.length||n(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,r,s){this.prepareLoading(e,r,{},s)}reload(e,r,s){this.prepareLoading(e,r,{reload:!0},s)}loadOne(e,r=""){const s=e.split("|"),n=s[0],i=s[1];this.read(n,i,"read",void 0,void 0,(o,l)=>{o&&this.logger.warn(`${r}loading namespace ${i} for language ${n} failed`,o),!o&&l&&this.logger.log(`${r}loaded namespace ${i} for language ${n}`,l),this.loaded(e,o,l)})}saveMissing(e,r,s,n,i,o={},l=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(r)){this.logger.warn(`did not save key "${s}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend?.create){const c={...o,isUpdate:i},d=this.backend.create.bind(this.backend);if(d.length<6)try{let u;d.length===5?u=d(e,r,s,n,c):u=d(e,r,s,n),u&&typeof u.then=="function"?u.then(h=>l(null,h)).catch(l):l(null,u)}catch(u){l(u)}else d(e,r,s,n,l,c)}!e||!e[0]||this.store.addResource(e[0],r,s,n)}}}const eh=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),Ee(t[1])&&(e.defaultValue=t[1]),Ee(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const r=t[3]||t[2];Object.keys(r).forEach(s=>{e[s]=r[s]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),th=t=>(Ee(t.ns)&&(t.ns=[t.ns]),Ee(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),Ee(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),$a=()=>{},cS=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(r=>{typeof t[r]=="function"&&(t[r]=t[r].bind(t))})};class Vn extends Qi{constructor(e={},r){if(super(),this.options=th(e),this.services={},this.logger=mr,this.modules={external:[]},cS(this),r&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,r),this;setTimeout(()=>{this.init(e,r)},0)}}init(e={},r){this.isInitializing=!0,typeof e=="function"&&(r=e,e={}),e.defaultNS==null&&e.ns&&(Ee(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const s=eh();this.options={...s,...this.options,...th(e)},this.options.interpolation={...s.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=s.overloadTranslationOptionHandler);const n=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?mr.init(n(this.modules.logger),this.options):mr.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=iS;const u=new Yu(this.options);this.store=new zu(this.options.resources,this.options);const h=this.services;h.logger=mr,h.resourceStore=this.store,h.languageUtils=u,h.pluralResolver=new sS(u,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),d&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(h.formatter=n(d),h.formatter.init&&h.formatter.init(h,this.options),this.options.interpolation.format=h.formatter.format.bind(h.formatter)),h.interpolator=new Ju(this.options),h.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},h.backendConnector=new lS(n(this.modules.backend),h.resourceStore,h,this.options),h.backendConnector.on("*",(m,...x)=>{this.emit(m,...x)}),this.modules.languageDetector&&(h.languageDetector=n(this.modules.languageDetector),h.languageDetector.init&&h.languageDetector.init(h,this.options.detection,this.options)),this.modules.i18nFormat&&(h.i18nFormat=n(this.modules.i18nFormat),h.i18nFormat.init&&h.i18nFormat.init(this)),this.translator=new Ti(this.services,this.options),this.translator.on("*",(m,...x)=>{this.emit(m,...x)}),this.modules.external.forEach(m=>{m.init&&m.init(this)})}if(this.format=this.options.interpolation.format,r||(r=$a),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=(...u)=>this.store[d](...u)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=(...u)=>(this.store[d](...u),this)});const l=_n(),c=()=>{const d=(u,h)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(h),r(u,h)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),l}loadResources(e,r=$a){let s=r;const n=Ee(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(n?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const i=[],o=l=>{if(!l||l==="cimode")return;this.services.languageUtils.toResolveHierarchy(l).forEach(d=>{d!=="cimode"&&i.indexOf(d)<0&&i.push(d)})};n?o(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>o(c)),this.options.preload?.forEach?.(l=>o(l)),this.services.backendConnector.load(i,this.options.ns,l=>{!l&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(l)})}else s(null)}reloadResources(e,r,s){const n=_n();return typeof e=="function"&&(s=e,e=void 0),typeof r=="function"&&(s=r,r=void 0),e||(e=this.languages),r||(r=this.options.ns),s||(s=$a),this.services.backendConnector.reload(e,r,i=>{n.resolve(),s(i)}),n}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&kp.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let r=0;r<this.languages.length;r++){const s=this.languages[r];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,r){this.isLanguageChangingTo=e;const s=_n();this.emit("languageChanging",e);const n=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},i=(l,c)=>{c?this.isLanguageChangingTo===e&&(n(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,s.resolve((...d)=>this.t(...d)),r&&r(l,(...d)=>this.t(...d))},o=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const c=Ee(l)?l:l&&l[0],d=this.store.hasLanguageSomeTranslations(c)?c:this.services.languageUtils.getBestMatchFromCodes(Ee(l)?[l]:l);d&&(this.language||n(d),this.translator.language||this.translator.changeLanguage(d),this.services.languageDetector?.cacheUserLanguage?.(d)),this.loadResources(d,u=>{i(u,d)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),s}getFixedT(e,r,s){const n=(i,o,...l)=>{let c;typeof o!="object"?c=this.options.overloadTranslationOptionHandler([i,o].concat(l)):c={...o},c.lng=c.lng||n.lng,c.lngs=c.lngs||n.lngs,c.ns=c.ns||n.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||s||n.keyPrefix);const d=this.options.keySeparator||".";let u;return c.keyPrefix&&Array.isArray(i)?u=i.map(h=>(typeof h=="function"&&(h=yl(h,{...this.options,...o})),`${c.keyPrefix}${d}${h}`)):(typeof i=="function"&&(i=yl(i,{...this.options,...o})),u=c.keyPrefix?`${c.keyPrefix}${d}${i}`:i),this.t(u,c)};return Ee(e)?n.lng=e:n.lngs=e,n.ns=r,n.keyPrefix=s,n}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,r={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=r.lng||this.resolvedLanguage||this.languages[0],n=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const o=(l,c)=>{const d=this.services.backendConnector.state[`${l}|${c}`];return d===-1||d===0||d===2};if(r.precheck){const l=r.precheck(this,o);if(l!==void 0)return l}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(s,e)&&(!n||o(i,e)))}loadNamespaces(e,r){const s=_n();return this.options.ns?(Ee(e)&&(e=[e]),e.forEach(n=>{this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}),this.loadResources(n=>{s.resolve(),r&&r(n)}),s):(r&&r(),Promise.resolve())}loadLanguages(e,r){const s=_n();Ee(e)&&(e=[e]);const n=this.options.preload||[],i=e.filter(o=>n.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=n.concat(i),this.loadResources(o=>{s.resolve(),r&&r(o)}),s):(r&&r(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const n=new Intl.Locale(e);if(n&&n.getTextInfo){const i=n.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services?.languageUtils||new Yu(eh());return e.toLowerCase().indexOf("-latn")>1?"ltr":r.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},r){const s=new Vn(e,r);return s.createInstance=Vn.createInstance,s}cloneInstance(e={},r=$a){const s=e.forkResourceStore;s&&delete e.forkResourceStore;const n={...this.options,...e,isClone:!0},i=new Vn(n);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(l=>{i[l]=this[l]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const l=Object.keys(this.store.data).reduce((c,d)=>(c[d]={...this.store.data[d]},c[d]=Object.keys(c[d]).reduce((u,h)=>(u[h]={...c[d][h]},u),c[d]),c),{});i.store=new zu(l,n),i.services.resourceStore=i.store}return e.interpolation&&(i.services.interpolator=new Ju(n)),i.translator=new Ti(i.services,n),i.translator.on("*",(l,...c)=>{i.emit(l,...c)}),i.init(n,r),i.translator.options=n,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Et=Vn.createInstance();Et.createInstance;Et.dir;Et.init;Et.loadResources;Et.reloadResources;Et.use;Et.changeLanguage;Et.getFixedT;Et.t;Et.exists;Et.setDefaultNamespace;Et.hasLoadedNamespace;Et.loadNamespaces;Et.loadLanguages;const dS=(t,e,r,s)=>{const n=[r,{code:e,...s||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(n,"warn","react-i18next::",!0);fs(n[0])&&(n[0]=`react-i18next:: ${n[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...n):console?.warn&&console.warn(...n)},rh={},xl=(t,e,r,s)=>{fs(r)&&rh[r]||(fs(r)&&(rh[r]=new Date),dS(t,e,r,s))},Np=(t,e)=>()=>{if(t.isInitialized)e();else{const r=()=>{setTimeout(()=>{t.off("initialized",r)},0),e()};t.on("initialized",r)}},bl=(t,e,r)=>{t.loadNamespaces(e,Np(t,r))},sh=(t,e,r,s)=>{if(fs(r)&&(r=[r]),t.options.preload&&t.options.preload.indexOf(e)>-1)return bl(t,r,s);r.forEach(n=>{t.options.ns.indexOf(n)<0&&t.options.ns.push(n)}),t.loadLanguages(e,Np(t,s))},uS=(t,e,r={})=>!e.languages||!e.languages.length?(xl(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:r.lng,precheck:(s,n)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!n(s.isLanguageChangingTo,t))return!1}}),fs=t=>typeof t=="string",hS=t=>typeof t=="object"&&t!==null,gS=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,mS={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"Â©","&#169;":"Â©","&reg;":"Â®","&#174;":"Â®","&hellip;":"â€¦","&#8230;":"â€¦","&#x2F;":"/","&#47;":"/"},fS=t=>mS[t],pS=t=>t.replace(gS,fS);let vl={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:pS};const yS=(t={})=>{vl={...vl,...t}},xS=()=>vl;let Sp;const bS=t=>{Sp=t},vS=()=>Sp,wS={type:"3rdParty",init(t){yS(t.options.react),bS(t)}},kS=y.createContext();class TS{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const NS=(t,e)=>{const r=y.useRef();return y.useEffect(()=>{r.current=t},[t,e]),r.current},jp=(t,e,r,s)=>t.getFixedT(e,r,s),SS=(t,e,r,s)=>y.useCallback(jp(t,e,r,s),[t,e,r,s]),Xe=(t,e={})=>{const{i18n:r}=e,{i18n:s,defaultNS:n}=y.useContext(kS)||{},i=r||s||vS();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new TS),!i){xl(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const b=(_,j)=>fs(j)?j:hS(j)&&fs(j.defaultValue)?j.defaultValue:Array.isArray(_)?_[_.length-1]:_,T=[b,{},!1];return T.t=b,T.i18n={},T.ready=!1,T}i.options.react?.wait&&xl(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...xS(),...i.options.react,...e},{useSuspense:l,keyPrefix:c}=o;let d=n||i.options?.defaultNS;d=fs(d)?[d]:d||["translation"],i.reportNamespaces.addUsedNamespaces?.(d);const u=(i.isInitialized||i.initializedStoreOnce)&&d.every(b=>uS(b,i,o)),h=SS(i,e.lng||null,o.nsMode==="fallback"?d:d[0],c),g=()=>h,m=()=>jp(i,e.lng||null,o.nsMode==="fallback"?d:d[0],c),[x,f]=y.useState(g);let p=d.join();e.lng&&(p=`${e.lng}${p}`);const w=NS(p),v=y.useRef(!0);y.useEffect(()=>{const{bindI18n:b,bindI18nStore:T}=o;v.current=!0,!u&&!l&&(e.lng?sh(i,e.lng,d,()=>{v.current&&f(m)}):bl(i,d,()=>{v.current&&f(m)})),u&&w&&w!==p&&v.current&&f(m);const _=()=>{v.current&&f(m)};return b&&i?.on(b,_),T&&i?.store.on(T,_),()=>{v.current=!1,i&&b&&b?.split(" ").forEach(j=>i.off(j,_)),T&&i&&T.split(" ").forEach(j=>i.store.off(j,_))}},[i,p]),y.useEffect(()=>{v.current&&u&&f(g)},[i,c,u]);const k=[x,i,u];if(k.t=x,k.i18n=i,k.ready=u,u||!u&&!l)return k;throw new Promise(b=>{e.lng?sh(i,e.lng,d,()=>b()):bl(i,d,()=>b())})},{slice:jS,forEach:_S}=[];function DS(t){return _S.call(jS.call(arguments,1),e=>{if(e)for(const r in e)t[r]===void 0&&(t[r]=e[r])}),t}function CS(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(t))}const nh=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,ES=function(t,e){const s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},n=encodeURIComponent(e);let i=`${t}=${n}`;if(s.maxAge>0){const o=s.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");i+=`; Max-Age=${Math.floor(o)}`}if(s.domain){if(!nh.test(s.domain))throw new TypeError("option domain is invalid");i+=`; Domain=${s.domain}`}if(s.path){if(!nh.test(s.path))throw new TypeError("option path is invalid");i+=`; Path=${s.path}`}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");i+=`; Expires=${s.expires.toUTCString()}`}if(s.httpOnly&&(i+="; HttpOnly"),s.secure&&(i+="; Secure"),s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s.partitioned&&(i+="; Partitioned"),i},ah={create(t,e,r,s){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(n.expires=new Date,n.expires.setTime(n.expires.getTime()+r*60*1e3)),s&&(n.domain=s),document.cookie=ES(t,e,n)},read(t){const e=`${t}=`,r=document.cookie.split(";");for(let s=0;s<r.length;s++){let n=r[s];for(;n.charAt(0)===" ";)n=n.substring(1,n.length);if(n.indexOf(e)===0)return n.substring(e.length,n.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var IS={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return ah.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:r,cookieMinutes:s,cookieDomain:n,cookieOptions:i}=e;r&&typeof document<"u"&&ah.create(r,t,s,n,i)}},AS={name:"querystring",lookup(t){let{lookupQuerystring:e}=t,r;if(typeof window<"u"){let{search:s}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));const i=s.substring(1).split("&");for(let o=0;o<i.length;o++){const l=i[o].indexOf("=");l>0&&i[o].substring(0,l)===e&&(r=i[o].substring(l+1))}}return r}},RS={name:"hash",lookup(t){let{lookupHash:e,lookupFromHashIndex:r}=t,s;if(typeof window<"u"){const{hash:n}=window.location;if(n&&n.length>2){const i=n.substring(1);if(e){const o=i.split("&");for(let l=0;l<o.length;l++){const c=o[l].indexOf("=");c>0&&o[l].substring(0,c)===e&&(s=o[l].substring(c+1))}}if(s)return s;if(!s&&r>-1){const o=n.match(/\/([a-zA-Z-]*)/g);return Array.isArray(o)?o[typeof r=="number"?r:0]?.replace("/",""):void 0}}}return s}};let As=null;const ih=()=>{if(As!==null)return As;try{if(As=typeof window<"u"&&window.localStorage!==null,!As)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{As=!1}return As};var PS={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&ih())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:r}=e;r&&ih()&&window.localStorage.setItem(r,t)}};let Rs=null;const oh=()=>{if(Rs!==null)return Rs;try{if(Rs=typeof window<"u"&&window.sessionStorage!==null,!Rs)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{Rs=!1}return Rs};var MS={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&oh())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:r}=e;r&&oh()&&window.sessionStorage.setItem(r,t)}},OS={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:r,userLanguage:s,language:n}=navigator;if(r)for(let i=0;i<r.length;i++)e.push(r[i]);s&&e.push(s),n&&e.push(n)}return e.length>0?e:void 0}},LS={name:"htmlTag",lookup(t){let{htmlTag:e}=t,r;const s=e||(typeof document<"u"?document.documentElement:null);return s&&typeof s.getAttribute=="function"&&(r=s.getAttribute("lang")),r}},$S={name:"path",lookup(t){let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?r[typeof e=="number"?e:0]?.replace("/",""):void 0}},FS={name:"subdomain",lookup(t){let{lookupFromSubdomainIndex:e}=t;const r=typeof e=="number"?e+1:1,s=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(s)return s[r]}};let _p=!1;try{document.cookie,_p=!0}catch{}const Dp=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];_p||Dp.splice(1,1);const WS=()=>({order:Dp,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class Cp{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,r)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=DS(r,this.options||{},WS()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=n=>n.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=s,this.addDetector(IS),this.addDetector(AS),this.addDetector(PS),this.addDetector(MS),this.addDetector(OS),this.addDetector(LS),this.addDetector($S),this.addDetector(FS),this.addDetector(RS)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return e.forEach(s=>{if(this.detectors[s]){let n=this.detectors[s].lookup(this.options);n&&typeof n=="string"&&(n=[n]),n&&(r=r.concat(n))}}),r=r.filter(s=>s!=null&&!CS(s)).map(s=>this.options.convertDetectedLanguage(s)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||r.forEach(s=>{this.detectors[s]&&this.detectors[s].cacheUserLanguage(e,this.options)}))}}Cp.type="languageDetector";const VS={loginTitle:"Login",loginSubtitle:"Select an account to continue",googleSignIn:"Continue with Google",guestSignIn:"Continue as Guest",or:"OR",terms:"By continuing, you agree to our Terms of Service and Privacy Policy.",brandTitle:"Manage your work",brandTitleHighlight:"efficiently.",brandSubtitle:`Manage complex schedules simply.
The best productivity tool for individuals, teams, and enterprises.`,features:{boardView:{title:"Intuitive Board View",desc:"Visualize your workflow at a glance"},sync:{title:"Real-time Sync",desc:"Seamless connection anywhere"},smartNotify:{title:"Smart Notifications",desc:"Never miss important events"}},footer:"Â© 2025 Todolist Corp. Trusted by leaders."},US={today:"Today",week:"Weekly Calendar",month:"Monthly Calendar",board:"Kanban Board",recurring:"Recurring",history:"History",analytics:"Analytics",vacation:"Vacation",sharing:"Sharing Settings",settings:"Settings",summary:{yesterday:"Yesterday",overdue:"Overdue",tomorrow:"Tomorrow",count:"items"},notifications:"Notifications"},BS={widget:{title:"Widget Settings",transparency:"Background Transparency",transparencyDesc:"Adjust the transparency of the widget background on your home screen.",refresh:"Sync Widget",refreshDesc:"Try syncing manually if tasks do not appear."},title:"Settings",subtitle:"App settings & data management",account:{title:"Account",guest:"Guest User",guestDesc:"Using local storage",sync:"Cloud Sync",syncing:"Syncing...",logout:"Logout",confirmLogout:"Are you sure you want to logout?",loggedIn:"Logged in"},appearance:{title:"Appearance",transparency:"Background Transparency",light:"Light",dark:"Dark",system:"System",calendarLayout:"Monthly Calendar Layout",calendarLayoutSplit:"Split View (Calendar + List)",calendarLayoutFull:"Full Calendar"},seasonal:{spring:"Spring",summer:"Summer",autumn:"Autumn",winter:"Winter"},city:{cairo:"Cairo",london:"London",la:"Los Angeles",moscow:"Moscow",seoul:"Seoul",busan:"Busan",jeju:"Jeju",gyeongju:"Gyeongju",gwangju:"Gwangju",tokyo:"Tokyo",beijing:"Beijing",hongkong:"Hong Kong",bangkok:"Bangkok",hanoi:"Hanoi"},colorTheme:{title:"Accent Color",blue:"Blue",sky:"Sky",teal:"Teal",forest:"Forest",lime:"Lime",sunset:"Sunset",red:"Red",berry:"Berry",purple:"Purple",indigo:"Indigo",gray:"Gray"},tabs:{mode:"Mode",background:"Background",display:"Display",seasonal:"Seasonal",city:"City",colors:"Colors"},language:{title:"Language",desc:"Select application language",korean:"Korean",english:"English"},font:{title:"Font Size",small:"Small",large:"Large",preview:"The quick brown fox jumps over the lazy dog."},holiday:{title:"Custom Holidays",name:"Holiday Name",date:"Date",namePlaceholder:"Enter holiday name",datePlaceholder:"Select Date",addPlaceholder:"Holiday Name",recurring:"Repeat Yearly",noHolidays:"No holidays registered.",confirmDelete:"Delete this holiday?",yearly:"Yearly",everyYear:"Every Year"},data:{title:"Data Management",storage:"Storage Usage",localOnly:"Local Storage Only",backup:"Export Data",backupDesc:"Save current data to file",restore:"Restore Data",restoreDesc:"Restore from backup file",restoreSuccess:"Data restored successfully!",invalidFormat:"Invalid file format.",importError:"Failed to restore data.",confirmClear:"Delete {{count}} completed todos?",clearCompleted:"Clear Completed"},general:{startScreen:"Start Screen",lastView:"Last Used",today:"Today",week:"Weekly",month:"Monthly"},stats:{title:"Statistics",total:"Total",completed:"Done",pending:"Pending",storage:"Storage"},notification:{title:"Notifications",configure:"Configure Notifications",setup:"Setup Notifications",desc:"Deadlines, celebrations, etc."},notifications:{empty:"No new notifications",inviteTitle:"Invitation to share"},appInfo:"Designed for simplicity & productivity"},HS={title:"System Update",newFeatures:"What's New (v1.3.1)",changes:["New Sharing/Collaboration features (Create groups, Invite, Manage permissions)","Weekly Calendar Widget (Check schedule on home screen)","Notification Center (Check invites and changes)","Overall UI/UX improvements and stability fixes"],dontShowAgain:"Don't show again",close:"Close"},GS={loading:"Loading...",monthSuffix:"",error:"Error",success:"Success",confirm:"Confirm",cancel:"Cancel",save:"Save",delete:"Delete",edit:"Edit",add:"Add",close:"Close",today:"Today",addTodo:"Add Task",confirmExit:"Are you sure you want to exit?",progress:"Progress",accept:"Accept",decline:"Decline"},zS={sunday:"Sunday",monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday"},KS={title:"Appearance",theme:"Theme",calendarLayout:"Monthly Calendar Layout",calendarLayoutSplit:"Split View (Calendar + List)",calendarLayoutFull:"Full Calendar",transparency:"Transparency",transparencyDesc:"Adjust UI opacity (lower = more transparent)"},YS={yesterday:{title:"Incomplete Yesterday",empty:"No incomplete tasks from yesterday"},vacation:{title:"Today's Vacation"},inprogress:{title:"In Progress",empty:"No tasks"},completed:{title:"Completed",subtask:"Subtask",parentProject:"Parent Project",time:"Completed At"},tomorrow:{title:"Tomorrow",empty:"No tasks scheduled for tomorrow"}},qS={addTodo:{title:"New Task",taskTitle:"Title",placeholder:"Enter task name",naturalLanguageHint:"Ex: Meeting tomorrow 2pm #work !urgent",description:"Description",descPlaceholder:"Enter detailed description",type:"Type",simpleTask:"Simple Task",project:"Project",priority:"Priority",low:"Low",medium:"Medium",high:"High",urgent:"Urgent",projectCategory:"Project Category",manageTemplates:"Manage Templates",noTemplate:"No Template Selected",shortTerm:"Short-term",longTerm:"Long-term",subtasks:"Subtasks",addSubtaskPlaceholder:"Add subtask...",startDate:"Start Date",startTime:"Start Time",dueDate:"Due Date",dueTime:"Due Time",showDueDate:"Add Due Date (Optional)",hideDueDate:"Hide Due Date",tags:"Tags",addTag:"Add Tag",newTagPlaceholder:"Enter new tag",recurrence:"Recurrence",recurrenceNone:"None",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",selectDay:"Select Day",selectDate:"Select Date",selectWeek:"Select Week",recurrenceType:"Recurrence Type",byDate:"By Date (e.g. 15th)",byWeekday:"By Weekday (e.g. 1st Mon)",holidayHandling:"Holiday Handling",holidayShow:"Show as is (Default)",holidaySkip:"Skip",holidayNext:"Move to Next Day",holidayPrev:"Move to Previous Day",holidayHint:"* Set how to handle holidays for recurring tasks.",submit:"Add Task"}},XS={manage:"Manage Templates",title:"Manage Templates",create:"Create New Template",newTemplate:"New Template",editTemplate:"Edit Template",name:"Template Name",namePlaceholder:"Ex: July Promotion Project",category:"Category",description:"Description",descPlaceholder:"Project Description",subTasks:"Subtasks",addSubTask:"Add Task",subTaskName:"Task Name",empty:"No saved templates.",emptyHint:"Save frequently used projects as templates.",use:"Use This Template",copySuffix:"(Copy)",save:"Save",saving:"Saving...",update:"Update",updating:"Updating...",deleteConfirm:"Are you sure you want to delete this template?",shortterm:"Short-term",longterm:"Long-term"},QS={week:"Week",daySuffix:"",thisMonth:"This Month",thisWeek:"This Week",prevWeek:"Previous Week",nextWeek:"Next Week",detailedInfo:"Weekly Details",today:"Today",tasksAndVacations:"Tasks & Vacations",more:" more",start:"Start",due:"Due",close:"Close",noTasks:"No tasks for this date.",completedCancel:"Undo Complete",complete:"Mark Complete",deleteConfirm:"Are you sure you want to delete this task?"},JS={placeholder:"Search tasks...",filter:"Filter",on:"ON",clear:"Clear Filters",priority:"Priority",type:"Type",projectCategory:"Project Category",tags:"Tags",completionDate:"Completion Date",noTags:"No tags available",countTags:" tags",all:"All",todayCompleted:"Completed Today",yesterdayCompleted:"Completed Yesterday",thisWeekCompleted:"Completed This Week",lastWeekCompleted:"Completed Last Week",thisMonthCompleted:"Completed This Month"},ZS={title:"Project Analysis",distribution:"Project Distribution",totalProjects:"Total Projects",longTerm:"Long-term Projects",shortTerm:"Short-term Projects",singleTasks:"Single Tasks",total:"Total",project:"Project",single:"Single",longTermLabel:"Long-term",shortTermLabel:"Short-term"},ej={title:"Recurring Management",addTemplate:"Add Template",templates:"Templates",exceptions:"Exceptions",holidays:"Holidays",activeTemplates:"Active Templates",inactiveTemplates:"Inactive Templates",resume:"Resume",pause:"Pause",delete:"Delete",edit:"Edit",empty:"No recurring templates",emptyHint:"Add a new recurring template to automate your schedule.",addFirst:"Add First Template",exceptionTitle:"Exception Settings",monthlySettings:"Monthly Week Settings",firstWeek:"1st Week",secondWeek:"2nd Week",thirdWeek:"3rd Week",fourthWeek:"4th Week",lastWeek:"Last Week",weekHint:"* Last week refers to the final week of the month.",excludeSettings:"Exclude Weeks",excludeHint:"No recurring tasks will be created in checked weeks.",currentExcluded:"Currently Excluded",excludedHint:"New recurring tasks won't be created in these weeks.",exceptionDateTitle:"Date Exceptions",addExceptionDate:"Add Exception Date",exceptionDateHint:"Skip or move recurring tasks on specific dates.",holidayTitle:"Holiday Management",holidayDesc:"Holiday management features coming soon.",plannedFeatureList:{vacation:"Vacation Scheduling",autoAdjust:"Auto-adjust Recurring Tasks",notification:"Vacation Alerts",holidaySync:"Holiday Sync"},plannedFeatures:"Planned Features",totalTemplates:"Total Templates",active:"Active",todayInstances:"Today's Instances",editModalTitle:"Edit Recurring Template",updateSuccess:"Template updated successfully.",updateError:"Failed to update template.",form:{title:"Title",description:"Description",priority:"Priority",recurrenceType:"Recurrence Cycle",daily:"Daily",weekly:"Weekly",monthly:"Monthly",selectWeekday:"Select Weekday",monthlyPattern:"Monthly Pattern",byDate:"By Date (e.g., 15th)",byWeekday:"By Weekday (e.g., 1st Monday)",selectDate:"Select Date",lastDay:"Last Day",firstWorkDay:"First Workday",lastWorkDay:"Last Workday",week:"Week",weekday:"Weekday",holidayHandling:"Holiday Handling",moveBefore:"Move Before",moveAfter:"Move After",show:"Keep Date",exceptionSettings:"Exception Settings",addException:"Add Exception",byDateOption:"Exclude Date",byWeekdayOption:"Exclude Weekday",byWeekOption:"Exclude Week",byMonthOption:"Exclude Month",conflictOption:"Conflict with Other",conflictRule:"Conflict Rule",targetTemplate:"Target Template",selectTemplate:"Select Template",conflictCondition:"Conflict Condition",sameDate:"Same Date",sameWeek:"Same Week",sameMonth:"Same Month",addConflictRule:"Add Conflict Rule",save:"Save Changes",saving:"Saving..."}},tj={title:"Today's Tasks",completionRate:"Completion Rate",totalCompletion:"Total Completion",todayProgress:"Today Progress",weeklyProgress:"Weekly Progress",daily:"Today",weekly:"Weekly",overdueLabel:"Overdue",inProgress:"In Progress",scheduled:"Scheduled",overdue:"Overdue",urgent:"Urgent",high:"High",filter:"Filter"},rj={title:"Completion History",totalCount:"Total {{count}} tasks completed",period:"By Period",daily:"Daily",weekly:"Weekly",monthly:"Monthly",today:"Today",yesterday:"Yesterday",thisWeek:"This Week",lastWeek:"Last Week",thisMonth:"This Month",lastMonth:"Last Month",older:"Older Tasks",completedDay:"Days Completed",completedWeek:"Weeks Completed",completedMonth:"Months Completed",empty:"No completed tasks yet",emptyHint:"History will appear here when you complete tasks."},sj={title:"User Manual",subtitle:"Learn how to use 100% of the features in detail.",basics:{title:"1. Basics",add:"Add Task",addDesc:"Click the round '+' button at the bottom right or press 'N' on your keyboard to quickly add a new task. You can set the title, description, due date, and priority to manage your work efficiently.",complete:"Complete & Todo",completeDesc:"Click the checkbox to the left of an item to mark it as complete. If you completed it by mistake, you can undo it immediately or restore it from the 'History' tab.",edit:"Edit & Delete",editDesc:"Click on a task to open the details popup. You can edit the content or click the trash icon at the top right to delete it."},calendar:{title:"2. Schedule & Calendar",views:"Calendar Views",viewsDesc:"Switch between 'Today', 'Weekly', and 'Monthly' views via the sidebar or bottom menu. 'Weekly' is great for workflow, and 'Monthly' for overview.",nav:"Navigation",navDesc:"Use the navigation arrows (<, >) at the top to move to past or future dates. Click 'Today' to return to the current date immediately."},advanced:{title:"3. Advanced Features",recurring:"Recurring Management (Important)",recurringDesc:"**Note:** You cannot set 'recurrence' in the quick add popup. Recurring tasks (daily, weekly) must be registered and managed separately in the **'Recurring'** tab on the sidebar. More precise settings like exceptions are available there.",subtasks:"Subtasks",subtasksDesc:"Break down large projects into smaller steps. Use 'Add Subtask' in the task details view to track progress more granularly.",tags:"Tags & Filters",tagsDesc:"Use hashtags like #work or #personal when adding tasks. You can filter by specific tags or priority levels in the main search bar."},account:{title:"4. Account & Data",login:"Login Methods",loginDesc:"Login with Google to sync cloud data across multiple devices (PC, Tablet, Mobile). Guest mode saves data locally only.",security:"Security & Backup",securityDesc:"All data is securely transmitted and stored. Guest data may be lost if the app is deleted, so Google Login is recommended for data protection."},sharing:{title:"5. Sharing & Collaboration",createDetail:"Create New Group",createDetailDesc:"Create a new group in the 'Sharing Settings' menu and invite team members via email.",permissionDetail:"Permission Management",permissionDetailDesc:"Assign 'Can View', 'Can Edit', or 'Admin' permissions to team members for secure collaboration.",filterDetail:"Sharing Filters",filterDetailDesc:"Distinguish between 'My Tasks' and 'Shared Tasks' using the filters at the top of the main screen."},notifications:{title:"6. Notification Center",centerDetail:"Check Notifications",centerDetailDesc:"Click the bell icon at the top right to see new invite requests or project changes at a glance."},more:{title:"Have Questions?",contact:"If you need further assistance or have suggestions, please use 'Contact Us' in the Settings menu.",button:"Contact Us"}},nj={settingsTitle:"Sharing Settings",private:"Private",shared:"Shared",inviteUser:"Invite User",accessList:"Shared Users",noUsers:"No shared users.",inviteSent:"Invite sent!",pendingInvites:"Pending Invites",confirmRevoke:"Revoke access for this user?",shareName:"Share Name",sendInvite:"Send Invite",cannotShareSelf:"Cannot share with yourself.",alreadyAdded:"User already added.",userNotFound:"User not found.",alreadyInvited:"User already invited.",addToShared:"Add to shared list",myTask:"My Task",sharedTask:"Shared Task",selectTarget:"Select Sharing Target",selectTargetPlaceholder:"-- Select Sharing Target --",noGroups:"No sharing groups found. Please create a group in 'Sharing Settings' first.",filter:"Filter",personal:"My Tasks",myShared:"Shared by Me",groupShared:"Group Shared",filterPersonal:"Personal Tasks (Private)",filterMyShared:"Tasks Shared by Me",filterGroupShared:"Tasks Shared by Group",group:"Group",allGroups:"All",noGroupsShort:"No Groups",title:"Sharing Status",columnMember:"Member",columnPermission:"Permission",columnManage:"Manage",me:"(Me)",roleView:"Can View",roleEdit:"Can Edit",roleAdmin:"Admin",roleViewer:"Viewer",roleEditor:"Editor",removeMember:"Remove Member",waitingAccept:"Waiting for acceptance...",invited:"Invited",confirmDeleteGroup:"Are you sure you want to delete this group? All shared data will be deleted.",subtitle:"Share tasks and collaborate with your team",createNewGroup:"Create New Group",incomingInvites:"Incoming Invites",inviteMessage:"{{email}} invited you to '{{group}}'",accept:"Accept",reject:"Reject",permissionChange:"Permission Change",permissionChangeMessage:"{{email}} changed your permission in '{{group}}'",check:"OK",groupNamePlaceholder:"Group Name (e.g. Family, Marketing Team)",inviteMember:"Invite Member",searchEmailPlaceholder:"Search email address",search:"Search",add:"Add",createGroupSendInvite:"Create Group & Send Invites",cancel:"Cancel",owner:"Owner",leave:"Leave",deleteGroup:"Delete Group",referenceGroup:"Reference Group",inviteMemberPlaceholder:"Email to invite",savePermissionChanges:"Save Permission Changes",noGroupsDesc:"Create a new group to share tasks with your team!"},aj={auth:VS,nav:US,settings:BS,updateNotification:HS,common:GS,days:zS,appearance:KS,todo:YS,modal:qS,projectTemplate:XS,calendar:QS,search:JS,analysis:ZS,recurring:ej,detailedStats:tj,history:rj,guide:sj,sharing:nj},ij={loginTitle:"ë¡œê·¸ì¸",loginSubtitle:"ê³„ì •ì„ ì„ íƒí•˜ì—¬ ê³„ì†í•˜ì„¸ìš”",googleSignIn:"Google ê³„ì •ìœ¼ë¡œ ê³„ì†í•˜ê¸°",guestSignIn:"ê²ŒìŠ¤íŠ¸ë¡œ ì²´í—˜í•˜ê¸°",or:"ë˜ëŠ”",terms:"ê³„ì† ì§„í–‰ì‹œ ì´ìš©ì•½ê´€ ë° ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤.",brandTitle:"Manage your work",brandTitleHighlight:"efficiently.",brandSubtitle:`ë³µì¡í•œ ì¼ì •ì„ ì‹¬í”Œí•˜ê²Œ ê´€ë¦¬í•˜ì„¸ìš”.
ê°œì¸, íŒ€, ê¸°ì—… ëª¨ë‘ë¥¼ ìœ„í•œ ìµœê³ ì˜ ìƒì‚°ì„± ë„êµ¬.`,features:{boardView:{title:"ì§ê´€ì ì¸ ë³´ë“œ ë·°",desc:"í•œëˆˆì— íŒŒì•…í•˜ëŠ” ì—…ë¬´ íë¦„"},sync:{title:"ì‹¤ì‹œê°„ ë™ê¸°í™”",desc:"ì–¸ì œ ì–´ë””ì„œë‚˜ ëŠê¹€ ì—†ëŠ” ì—°ê²°"},smartNotify:{title:"ìŠ¤ë§ˆíŠ¸í•œ ì•Œë¦¼",desc:"ë†“ì¹˜ì§€ ì•ŠëŠ” ì¤‘ìš”í•œ ì¼ì •"}},footer:"Â© 2025 Todolist Corp. Trusted by leaders."},oj={today:"ì˜¤ëŠ˜ í• ì¼",week:"ì£¼ê°„ ìº˜ë¦°ë”",month:"ì›”ê°„ ìº˜ë¦°ë”",board:"ì¹¸ë°˜ ë³´ë“œ",recurring:"ë°˜ë³µ ê´€ë¦¬",history:"ì™„ë£Œ ê¸°ë¡",analytics:"í†µê³„/ë¶„ì„",vacation:"íœ´ê°€ ê´€ë¦¬",sharing:"ê³µìœ  ì„¤ì •",settings:"ì„¤ì •",summary:{yesterday:"ì–´ì œ ë¯¸ì™„ë£Œ",overdue:"ì§€ì—°ëœ í• ì¼",tomorrow:"ë‚´ì¼ ì˜ˆì •",count:"ê°œ"},notifications:"ì•Œë¦¼"},lj={widget:{title:"ìœ„ì ¯ ì„¤ì •",transparency:"ë°°ê²½ íˆ¬ëª…ë„",transparencyDesc:"í™ˆ í™”ë©´ ìœ„ì ¯ì˜ ë°°ê²½ íˆ¬ëª…ë„ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤.",refresh:"ìœ„ì ¯ ë™ê¸°í™”",refreshDesc:"ìœ„ì ¯ì— í• ì¼ì´ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ë©´ ìˆ˜ë™ìœ¼ë¡œ ë™ê¸°í™”í•´ë³´ì„¸ìš”."},title:"ì„¤ì •",subtitle:"ì•± ì„¤ì • ë° ë°ì´í„° ê´€ë¦¬",account:{title:"ê³„ì •",guest:"ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì",guestDesc:"ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš© ì¤‘",sync:"í´ë¼ìš°ë“œ ë™ê¸°í™”",syncing:"ë™ê¸°í™” ì¤‘...",logout:"ë¡œê·¸ì•„ì›ƒ",confirmLogout:"ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",loggedIn:"ë¡œê·¸ì¸ë¨"},appearance:{title:"í™”ë©´ ì„¤ì •",theme:"í…Œë§ˆ",calendarLayout:"ì›”ê°„ ìº˜ë¦°ë” ë ˆì´ì•„ì›ƒ",calendarLayoutSplit:"ë¶„í•  í™”ë©´ (ìº˜ë¦°ë” + ë¦¬ìŠ¤íŠ¸)",calendarLayoutFull:"ì „ì²´ í™”ë©´ (ìº˜ë¦°ë”ë§Œ)",transparency:"íˆ¬ëª…ë„ ì¡°ì ˆ",transparencyDesc:"UIì˜ íˆ¬ëª…ë„ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤ (ë‚®ì„ìˆ˜ë¡ íˆ¬ëª…í•´ì§‘ë‹ˆë‹¤)",light:"ë¼ì´íŠ¸ ëª¨ë“œ",dark:"ë‹¤í¬ ëª¨ë“œ",system:"ì‹œìŠ¤í…œ ì„¤ì •"},seasonal:{spring:"ë´„",summer:"ì—¬ë¦„",autumn:"ê°€ì„",winter:"ê²¨ìš¸"},city:{cairo:"ì¹´ì´ë¡œ",london:"ëŸ°ë˜",la:"ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤",moscow:"ëª¨ìŠ¤í¬ë°”",seoul:"ì„œìš¸",busan:"ë¶€ì‚°",jeju:"ì œì£¼",gyeongju:"ê²½ì£¼",gwangju:"ê´‘ì£¼",tokyo:"ë„ì¿„",beijing:"ë² ì´ì§•",hongkong:"í™ì½©",bangkok:"ë°©ì½•",hanoi:"í•˜ë…¸ì´"},colorTheme:{title:"ê°•ì¡° ìƒ‰ìƒ",blue:"ë¸”ë£¨",sky:"ìŠ¤ì¹´ì´",teal:"í‹¸",forest:"í¬ë ˆìŠ¤íŠ¸",lime:"ë¼ì„",sunset:"ì„ ì…‹",red:"ë ˆë“œ",berry:"ë² ë¦¬",purple:"í¼í”Œ",indigo:"ì¸ë””ê³ ",gray:"ê·¸ë ˆì´"},tabs:{mode:"í™”ë©´ ëª¨ë“œ",background:"ë°°ê²½",display:"í™”ë©´",seasonal:"ê³„ì ˆ",city:"ë„ì‹œ",colors:"ìƒ‰ìƒ"},language:{title:"ì–¸ì–´",desc:"ì• í”Œë¦¬ì¼€ì´ì…˜ ì–¸ì–´ ì„ íƒ",korean:"í•œêµ­ì–´",english:"English"},font:{title:"ê¸€ì í¬ê¸°",small:"ì‘ê²Œ",large:"í¬ê²Œ",preview:"ë‹¤ëŒì¥ í—Œ ì³‡ë°”í€´ì— íƒ€ê³ íŒŒ. The quick brown fox jumps over the lazy dog."},holiday:{title:"ê³µíœ´ì¼ ì„¤ì •",name:"ê³µíœ´ì¼ ì´ë¦„",date:"ë‚ ì§œ",namePlaceholder:"ê³µíœ´ì¼ ì´ë¦„ ì…ë ¥",datePlaceholder:"ë‚ ì§œ ì„ íƒ",addPlaceholder:"ê³µíœ´ì¼ ì´ë¦„",recurring:"ë§¤ë…„ ë°˜ë³µ",noHolidays:"ë“±ë¡ëœ ê³µíœ´ì¼ì´ ì—†ìŠµë‹ˆë‹¤.",confirmDelete:"ì´ ê³µíœ´ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",yearly:"ë§¤ë…„",everyYear:"ë§¤ë…„"},data:{title:"ë°ì´í„° í†µê³„",storage:"ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš© ì¤‘",localOnly:"ì„œë²„ì— ì €ì¥ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ì…ë‹ˆë‹¤",backup:"ë°ì´í„° ë°±ì—…",backupDesc:"í˜„ì¬ ë°ì´í„°ë¥¼ íŒŒì¼ë¡œ ì €ì¥",restore:"ë°ì´í„° ë³µì›",restoreDesc:"ë°±ì—… íŒŒì¼ì—ì„œ ë³µì›",restoreSuccess:"ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤!",invalidFormat:"ì˜¬ë°”ë¥´ì§€ ì•Šì€ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.",importError:"ë°ì´í„° ë³µì›ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",confirmClear:"ì™„ë£Œëœ í•­ëª© {{count}}ê°œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",clearCompleted:"ì™„ë£Œëœ í•­ëª© ì‚­ì œ",noCompleted:"ì‚­ì œí•  ì™„ë£Œëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."},general:{startScreen:"ì‹œì‘ í™”ë©´ ì„¤ì •",lastView:"ë§ˆì§€ë§‰ ì¢…ë£Œ í™”ë©´",today:"ì˜¤ëŠ˜ í•  ì¼",week:"ì£¼ê°„ ë‹¬ë ¥",month:"ì›”ê°„ ë‹¬ë ¥"},stats:{title:"ë°ì´í„° í†µê³„",total:"ì´ í• ì¼",completed:"ì™„ë£Œ",pending:"ì§„í–‰ì¤‘",storage:"ì €ì¥ê³µê°„"},notification:{title:"ì•Œë¦¼",configure:"ì•Œë¦¼ ì„¤ì •",setup:"ì•Œë¦¼ ì„¤ì •",desc:"ë§ˆê° ì•Œë¦¼, ì™„ë£Œ ì¶•í•˜ ë“± ì„¤ì •"},notifications:{empty:"ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.",inviteTitle:"ê³µìœ  ì´ˆëŒ€"},appInfo:"Designed for simplicity & productivity"},cj={title:"ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ì•ˆë‚´",newFeatures:"ìƒˆë¡œìš´ ê¸°ëŠ¥ (v1.3.1)",changes:["ìƒˆë¡œìš´ ê³µìœ /í˜‘ì—… ê¸°ëŠ¥ ì¶”ê°€ (ê·¸ë£¹ ìƒì„±, ì´ˆëŒ€, ê¶Œí•œ ê´€ë¦¬)","ì£¼ê°„ ìº˜ë¦°ë” ìœ„ì ¯ ì¶”ê°€ (í™ˆ í™”ë©´ì—ì„œ ì¼ì • í™•ì¸)","ì•Œë¦¼ ì„¼í„° ì¶”ê°€ (ê³µìœ  ì´ˆëŒ€, ë³€ë™ ì‚¬í•­ í™•ì¸)","ì „ì²´ì ì¸ UI/UX ê°œì„  ë° ì•ˆì •ì„± í–¥ìƒ"],dontShowAgain:"ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°",close:"ë‹«ê¸°"},dj={loading:"ë¡œë”© ì¤‘...",monthSuffix:"ì›”",error:"ì˜¤ë¥˜",success:"ì„±ê³µ",confirm:"í™•ì¸",cancel:"ì·¨ì†Œ",save:"ì €ì¥",delete:"ì‚­ì œ",edit:"ìˆ˜ì •",add:"ì¶”ê°€",close:"ë‹«ê¸°",today:"ì˜¤ëŠ˜",addTodo:"í• ì¼ ì¶”ê°€",confirmExit:"ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",progress:"ì§„í–‰ë¥ ",accept:"ìˆ˜ë½",decline:"ê±°ì ˆ"},uj={title:"ê³µìœ  ìƒíƒœ",settingsTitle:"ê³µìœ  ì„¤ì •",private:"ê°œì¸ (ë¹„ê³µê°œ)",shared:"ê³µìœ ë¨",inviteUser:"ì‚¬ìš©ì ì´ˆëŒ€",accessList:"ê³µìœ ëœ ì‚¬ìš©ì",noUsers:"ê³µìœ ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.",inviteSent:"ì´ˆëŒ€ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!",pendingInvites:"ëŒ€ê¸° ì¤‘ì¸ ì´ˆëŒ€",confirmRevoke:"ì´ ì‚¬ìš©ìì˜ ì ‘ê·¼ ê¶Œí•œì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",shareName:"ê³µìœ  ì´ë¦„",sendInvite:"ì´ˆëŒ€ ë³´ë‚´ê¸°",cannotShareSelf:"ìì‹ ì—ê²ŒëŠ” ê³µìœ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",alreadyAdded:"ì´ë¯¸ ì¶”ê°€ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.",userNotFound:"ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",alreadyInvited:"ì´ë¯¸ ì´ˆëŒ€ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.",addToShared:"ê³µìœ  ëª©ë¡ì— ì¶”ê°€",myTask:"ë‚´ í•  ì¼",sharedTask:"ê³µìœ  í•  ì¼",selectTarget:"ê³µìœ  ëŒ€ìƒ ì„ íƒ",selectTargetPlaceholder:"-- ê³µìœ  ëŒ€ìƒ ì„ íƒ --",noGroups:"ê³µìœ  ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì´ë“œë°” 'ê³µìœ  ì„¤ì •'ì—ì„œ ë¨¼ì € ê·¸ë£¹ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.",groupShared:"ê·¸ë£¹ ê³µìœ ",group:"ê·¸ë£¹",allGroups:"ì „ì²´",filter:"í•„í„°",personal:"ë‚´ í• ì¼",myShared:"ë‚´ê°€ ê³µìœ ",filterPersonal:"ê°œì¸ í• ì¼",filterMyShared:"ë‚´ê°€ ê³µìœ í•œ í• ì¼",filterGroupShared:"ê·¸ë£¹ì´ ê³µìœ í•œ í• ì¼",noGroupsShort:"ê·¸ë£¹ ì—†ìŒ",columnMember:"ë©¤ë²„",columnPermission:"ê¶Œí•œ",columnManage:"ê´€ë¦¬",me:"(ë‚˜)",roleView:"ë³´ê¸° ê°€ëŠ¥",roleEdit:"í¸ì§‘ ê°€ëŠ¥",roleAdmin:"ê´€ë¦¬ì",roleViewer:"ë·°ì–´",roleEditor:"í¸ì§‘ì",removeMember:"ë©¤ë²„ ë‚´ë³´ë‚´ê¸°",waitingAccept:"ìˆ˜ë½ ëŒ€ê¸° ì¤‘...",invited:"ì´ˆëŒ€ë¨",confirmDeleteGroup:"ê·¸ë£¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ê³µìœ  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.",subtitle:"íŒ€ì›ë“¤ê³¼ í• ì¼ì„ ê³µìœ í•˜ê³  í˜‘ì—…í•˜ì„¸ìš”",createNewGroup:"ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°",incomingInvites:"ë°›ì€ ì´ˆëŒ€ ìš”ì²­",inviteMessage:"{{email}}ë‹˜ì´ '{{group}}' ê·¸ë£¹ì— ì´ˆëŒ€í–ˆìŠµë‹ˆë‹¤",accept:"ìˆ˜ë½",reject:"ê±°ì ˆ",permissionChange:"ê¶Œí•œ ë³€ê²½ ì•Œë¦¼",permissionChangeMessage:"{{email}}ë‹˜ì´ '{{group}}' ê·¸ë£¹ì—ì„œ ê¶Œí•œì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤",check:"í™•ì¸",groupNamePlaceholder:"ê·¸ë£¹ ì´ë¦„ (ì˜ˆ: ê°€ì¡±, ë§ˆì¼€íŒ…íŒ€)",inviteMember:"ë©¤ë²„ ì´ˆëŒ€",searchEmailPlaceholder:"ì´ë©”ì¼ ì£¼ì†Œ ê²€ìƒ‰",search:"ê²€ìƒ‰",add:"ì¶”ê°€",createGroupSendInvite:"ê·¸ë£¹ ìƒì„± ë° ì´ˆëŒ€ ë°œì†¡",cancel:"ì·¨ì†Œ",owner:"ì†Œìœ ì",leave:"ë‚˜ê°€ê¸°",deleteGroup:"ê·¸ë£¹ ì‚­ì œ",referenceGroup:"ì°¸ì¡° ê·¸ë£¹",inviteMemberPlaceholder:"ì´ˆëŒ€í•  íŒ€ì›ì˜ ì´ë©”ì¼",savePermissionChanges:"ê¶Œí•œ ë³€ê²½ ì €ì¥",noGroupsDesc:"ìƒˆ ê·¸ë£¹ì„ ë§Œë“¤ì–´ íŒ€ì›ë“¤ê³¼ í• ì¼ì„ ê³µìœ í•´ë³´ì„¸ìš”!"},hj={sunday:"ì¼ìš”ì¼",monday:"ì›”ìš”ì¼",tuesday:"í™”ìš”ì¼",wednesday:"ìˆ˜ìš”ì¼",thursday:"ëª©ìš”ì¼",friday:"ê¸ˆìš”ì¼",saturday:"í† ìš”ì¼"},gj={yesterday:{title:"ì–´ì œ ëª»í•œ ì¼",empty:"ì–´ì œ ë¯¸ì™„ë£Œëœ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤"},vacation:{title:"ì˜¤ëŠ˜ì˜ íœ´ê°€"},inprogress:{title:"ì§„í–‰ ì¤‘ì¸ í• ì¼",empty:"í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤"},completed:{title:"ì™„ë£Œëœ í• ì¼",subtask:"í•˜ìœ„ì‘ì—…",parentProject:"ìƒìœ„ í”„ë¡œì íŠ¸",time:"ì™„ë£Œì‹œê°„"},tomorrow:{title:"ë‚´ì¼ í• ì¼",empty:"ë‚´ì¼ ì˜ˆì •ëœ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤"}},mj={addTodo:{title:"ìƒˆë¡œìš´ í• ì¼",taskTitle:"ì œëª©",placeholder:"í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”",naturalLanguageHint:"ì˜ˆ: ë‚´ì¼ ì˜¤í›„ 2ì‹œ íšŒì˜ !ê¸´ê¸‰ #ì—…ë¬´",description:"ì„¤ëª…",descPlaceholder:"í• ì¼ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”",type:"ìœ í˜•",simpleTask:"ë‹¨ì¼ íƒœìŠ¤í¬",project:"í”„ë¡œì íŠ¸",priority:"ìš°ì„ ìˆœìœ„",low:"ë‚®ìŒ",medium:"ë³´í†µ",high:"ë†’ìŒ",urgent:"ê¸´ê¸‰",projectCategory:"í”„ë¡œì íŠ¸ êµ¬ë¶„",manageTemplates:"í…œí”Œë¦¿ ê´€ë¦¬",noTemplate:"í…œí”Œë¦¿ ì„ íƒ ì•ˆí•¨",shortTerm:"ìˆí…€",longTerm:"ë¡±í…€",subtasks:"í•˜ìœ„ ì‘ì—…",addSubtaskPlaceholder:"í•˜ìœ„ ì‘ì—… ì¶”ê°€...",startDate:"ì‹œì‘ ë‚ ì§œ",startTime:"ì‹œì‘ ì‹œê°„",dueDate:"ë§ˆê° ë‚ ì§œ",dueTime:"ë§ˆê° ì‹œê°„",showDueDate:"ë§ˆê°ì¼ ì„¤ì • ì¶”ê°€ (ì„ íƒ)",hideDueDate:"ë§ˆê°ì¼ ì„¤ì • ìˆ¨ê¸°ê¸°",tags:"íƒœê·¸",addTag:"íƒœê·¸ ì¶”ê°€",newTagPlaceholder:"ìƒˆ íƒœê·¸ ì…ë ¥",recurrence:"ë°˜ë³µ ì„¤ì •",recurrenceNone:"ë°˜ë³µ ì•ˆí•¨",daily:"ë§¤ì¼",weekly:"ë§¤ì£¼",monthly:"ë§¤ë‹¬",yearly:"ë§¤ë…„",selectDay:"ìš”ì¼ ì„ íƒ",selectDate:"ë‚ ì§œ ì„ íƒ",selectWeek:"ì£¼ì°¨ ì„ íƒ",recurrenceType:"ë°˜ë³µ ë°©ì‹",byDate:"ë‚ ì§œ ê¸°ì¤€ (ì˜ˆ: ë§¤ì›” 15ì¼)",byWeekday:"ìš”ì¼ ê¸°ì¤€ (ì˜ˆ: ë§¤ì›” ì²«ì§¸ì£¼ ì›”ìš”ì¼)",holidayHandling:"ê³µíœ´ì¼ ì²˜ë¦¬",holidayShow:"ê·¸ëŒ€ë¡œ í‘œì‹œ (ê¸°ë³¸)",holidaySkip:"ê±´ë„ˆë›°ê¸°",holidayNext:"ë‹¤ìŒ ë‚ ë¡œ ë¯¸ë£¨ê¸°",holidayPrev:"ì´ì „ ë‚ ë¡œ ë‹¹ê¸°ê¸°",holidayHint:"* ë°˜ë³µ ì˜ˆì •ì¼ì´ ê³µíœ´ì¼ì¸ ê²½ìš° ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ì„¤ì •í•©ë‹ˆë‹¤.",submit:"ì¶”ê°€í•˜ê¸°"}},fj={manage:"í…œí”Œë¦¿ ê´€ë¦¬",title:"í”„ë¡œì íŠ¸ í…œí”Œë¦¿ ê´€ë¦¬",create:"ìƒˆ í…œí”Œë¦¿ ë§Œë“¤ê¸°",newTemplate:"ìƒˆ í…œí”Œë¦¿",editTemplate:"í…œí”Œë¦¿ ìˆ˜ì •",name:"í…œí”Œë¦¿ ì´ë¦„",namePlaceholder:"ì˜ˆ: 7ì›” ì§„í¥ì› êµìœ¡ í”„ë¡œì íŠ¸",category:"ì¹´í…Œê³ ë¦¬",description:"ì„¤ëª…",descPlaceholder:"í”„ë¡œì íŠ¸ ì„¤ëª…",subTasks:"í•˜ìœ„ ì‘ì—…",addSubTask:"ì‘ì—… ì¶”ê°€",subTaskName:"ì‘ì—…ëª…",empty:"ì €ì¥ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.",emptyHint:"ìì£¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í•´ë³´ì„¸ìš”.",use:"ì´ í…œí”Œë¦¿ ì‚¬ìš©",copySuffix:"(ë³µì‚¬ë³¸)",save:"ì €ì¥",saving:"ì €ì¥ ì¤‘...",update:"ìˆ˜ì • ì™„ë£Œ",updating:"ìˆ˜ì • ì¤‘...",deleteConfirm:"ì´ í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",shortterm:"ìˆí…€",longterm:"ë¡±í…€"},pj={week:"ì§¸ì£¼",daySuffix:"ì¼",thisMonth:"ì´ë²ˆ ë‹¬",thisWeek:"ì´ë²ˆ ì£¼",prevWeek:"ì´ì „ ì£¼",nextWeek:"ë‹¤ìŒ ì£¼",detailedInfo:"ì´ë²ˆ ì£¼ ìƒì„¸ ì •ë³´",today:"ì˜¤ëŠ˜",tasksAndVacations:"í• ì¼ ë° íœ´ê°€",more:"ê°œ ë”",start:"ì‹œì‘",due:"ë§ˆê°",close:"ë‹«ê¸°",noTasks:"ì„ íƒí•œ ë‚ ì§œì— í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤.",completedCancel:"ì™„ë£Œ ì·¨ì†Œ",complete:"ì™„ë£Œ ì²˜ë¦¬",deleteConfirm:"í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"},yj={placeholder:"í• ì¼ ê²€ìƒ‰...",filter:"í•„í„°",on:"ON",clear:"í•„í„° ì´ˆê¸°í™”",priority:"ìš°ì„ ìˆœìœ„",type:"íƒ€ì…",projectCategory:"í”„ë¡œì íŠ¸ êµ¬ë¶„",tags:"íƒœê·¸",completionDate:"ì™„ë£Œì¼",noTags:"íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤",countTags:"ê°œ íƒœê·¸",all:"ì „ì²´",todayCompleted:"ì˜¤ëŠ˜ ì™„ë£Œ",yesterdayCompleted:"ì–´ì œ ì™„ë£Œ",thisWeekCompleted:"ì´ë²ˆ ì£¼ ì™„ë£Œ",lastWeekCompleted:"ì§€ë‚œ ì£¼ ì™„ë£Œ",thisMonthCompleted:"ì´ë²ˆ ë‹¬ ì™„ë£Œ"},xj={title:"í”„ë¡œì íŠ¸ ë¶„ì„",distribution:"ì „ì²´ í”„ë¡œì íŠ¸ ë¶„í¬",totalProjects:"ì´ í”„ë¡œì íŠ¸",longTerm:"ë¡±í…€ í”„ë¡œì íŠ¸",shortTerm:"ìˆí…€ í”„ë¡œì íŠ¸",singleTasks:"ë‹¨ì¼ íƒœìŠ¤í¬",total:"Total",project:"í”„ë¡œì íŠ¸",single:"ë‹¨ì¼",longTermLabel:"ë¡±í…€",shortTermLabel:"ìˆí…€"},bj={title:"ë°˜ë³µ ê´€ë¦¬",addTemplate:"ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€",templates:"ë°˜ë³µ í…œí”Œë¦¿",exceptions:"ì˜ˆì™¸ ì²˜ë¦¬",holidays:"íœ´ê°€ ê´€ë¦¬",activeTemplates:"í™œì„± ë°˜ë³µ í• ì¼",inactiveTemplates:"ì¼ì‹œì •ì§€ëœ ë°˜ë³µ í• ì¼",resume:"ì¬ê°œ",pause:"ì¼ì‹œì •ì§€",delete:"ì‚­ì œ",edit:"ìˆ˜ì •",empty:"ë°˜ë³µ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤",emptyHint:"ìƒˆë¡œìš´ ë°˜ë³µ í• ì¼ í…œí”Œë¦¿ì„ ì¶”ê°€í•˜ì—¬ ì¼ì •ì„ ìë™í™”í•˜ì„¸ìš”.",addFirst:"ì²« ë²ˆì§¸ í…œí”Œë¦¿ ì¶”ê°€",exceptionTitle:"ë°˜ë³µ í• ì¼ ì˜ˆì™¸ ì²˜ë¦¬ ì„¤ì •",monthlySettings:"ì›”ë³„ ì£¼ ì„¤ì •",firstWeek:"ì²«ì§¸ì£¼",secondWeek:"ë‘˜ì§¸ì£¼",thirdWeek:"ì…‹ì§¸ì£¼",fourthWeek:"ë„·ì§¸ì£¼",lastWeek:"ë§ˆì§€ë§‰ì£¼",weekHint:"* ë§ˆì§€ë§‰ì£¼ëŠ” í•´ë‹¹ ë‹¬ì˜ ë§ˆì§€ë§‰ ì£¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. (4ì£¼ê°€ ìˆëŠ” ë‹¬ì€ 4ì£¼ì°¨, 5ì£¼ê°€ ìˆëŠ” ë‹¬ì€ 5ì£¼ì°¨)",excludeSettings:"íŠ¹ì • ì£¼ ì œì™¸ ì„¤ì •",excludeHint:"ì²´í¬ëœ ì£¼ì—ëŠ” ë°˜ë³µ í• ì¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",currentExcluded:"í˜„ì¬ ì œì™¸ëœ ì£¼",excludedHint:"ì´ ì£¼ë“¤ì—ëŠ” ìƒˆë¡œìš´ ë°˜ë³µ í• ì¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",exceptionDateTitle:"íŠ¹ì • ë‚ ì§œ ì˜ˆì™¸ ê´€ë¦¬",addExceptionDate:"ì˜ˆì™¸ ë‚ ì§œ ì¶”ê°€",exceptionDateHint:"íŠ¹ì • ë‚ ì§œì— ë°˜ë³µ í• ì¼ì„ ê±´ë„ˆë›°ê±°ë‚˜ ë‹¤ë¥¸ ë‚ ì§œë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",holidayTitle:"íœ´ê°€ ê´€ë¦¬ ê¸°ëŠ¥",holidayDesc:"íœ´ê°€ ì¼ì • ê´€ë¦¬ ê¸°ëŠ¥ì´ ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.",plannedFeatureList:{vacation:"íœ´ê°€ ì¼ì • ë“±ë¡",autoAdjust:"ë°˜ë³µ í• ì¼ ìë™ ì¡°ì •",notification:"íœ´ê°€ ê¸°ê°„ ì•Œë¦¼",holidaySync:"ê³µíœ´ì¼ ì—°ë™"},plannedFeatures:"ê³„íšëœ ê¸°ëŠ¥",totalTemplates:"ì´ í…œí”Œë¦¿",active:"í™œì„±",todayInstances:"ì˜¤ëŠ˜ ì¸ìŠ¤í„´ìŠ¤",editModalTitle:"ë°˜ë³µ í…œí”Œë¦¿ ìˆ˜ì •",updateSuccess:"í…œí”Œë¦¿ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",updateError:"í…œí”Œë¦¿ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",form:{title:"ì œëª©",description:"ì„¤ëª…",priority:"ìš°ì„ ìˆœìœ„",recurrenceType:"ë°˜ë³µ ì£¼ê¸°",daily:"ë§¤ì¼",weekly:"ë§¤ì£¼",monthly:"ë§¤ì›”",selectWeekday:"ìš”ì¼ ì„ íƒ",monthlyPattern:"ì›”ê°„ íŒ¨í„´",byDate:"ë‚ ì§œ ê¸°ì¤€ (ì˜ˆ: 15ì¼)",byWeekday:"ìš”ì¼ ê¸°ì¤€ (ì˜ˆ: ì²«ì§¸ì£¼ ì›”ìš”ì¼)",selectDate:"ë‚ ì§œ ì„ íƒ",lastDay:"ë§ì¼",firstWorkDay:"ì²« ë²ˆì§¸ ê·¼ë¬´ì¼",lastWorkDay:"ë§ˆì§€ë§‰ ê·¼ë¬´ì¼",week:"ì£¼ì°¨",weekday:"ìš”ì¼",holidayHandling:"ê³µíœ´ì¼ ì²˜ë¦¬",moveBefore:"ì´ì „ìœ¼ë¡œ ì´ë™",moveAfter:"ì´í›„ë¡œ ì´ë™",show:"ê·¸ëŒ€ë¡œ í‘œì‹œ",exceptionSettings:"ì˜ˆì™¸ ì„¤ì • (ì œì™¸í•  ì¡°ê±´)",addException:"ì˜ˆì™¸ ì¶”ê°€",byDateOption:"íŠ¹ì • ë‚ ì§œ ì œì™¸",byWeekdayOption:"íŠ¹ì • ìš”ì¼ ì œì™¸",byWeekOption:"íŠ¹ì • ì£¼ì°¨ ì œì™¸",byMonthOption:"íŠ¹ì • ë‹¬ ì œì™¸",conflictOption:"ë‹¤ë¥¸ í…œí”Œë¦¿ê³¼ ì¤‘ë³µ",conflictRule:"ì¤‘ë³µ ì˜ˆì™¸ ê·œì¹™",targetTemplate:"ëŒ€ìƒ í…œí”Œë¦¿",selectTemplate:"í…œí”Œë¦¿ ì„ íƒ",conflictCondition:"ì¤‘ë³µ ì¡°ê±´",sameDate:"ê°™ì€ ë‚ ì§œ ì¤‘ë³µ",sameWeek:"ê°™ì€ ì£¼ ì¤‘ë³µ",sameMonth:"ê°™ì€ ë‹¬ ì¤‘ë³µ",addConflictRule:"ì¤‘ë³µ ê·œì¹™ ì¶”ê°€",save:"ì €ì¥í•˜ê¸°",saving:"ì €ì¥ ì¤‘..."}},vj={title:"ì˜¤ëŠ˜ í• ì¼",completionRate:"ì™„ë£Œìœ¨",totalCompletion:"ì „ì²´ ì™„ë£Œìœ¨",todayProgress:"ì˜¤ëŠ˜ ì§„í–‰ë¥ ",weeklyProgress:"ì£¼ê°„ ë‹¬ì„±",daily:"ì˜¤ëŠ˜",weekly:"ì£¼ê°„",overdueLabel:"ì§€ì—°",inProgress:"ì§„í–‰",scheduled:"ì˜ˆì •",overdue:"ì§€ì—°",urgent:"ê¸´ê¸‰",high:"ë†’ìŒ",filter:"í•„í„°"},wj={title:"ì™„ë£Œ íˆìŠ¤í† ë¦¬",totalCount:"ì´ {{count}}ê°œì˜ í• ì¼ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤",period:"ê¸°ê°„ë³„",daily:"ì¼ë³„",weekly:"ì£¼ë³„",monthly:"ì›”ë³„",today:"ì˜¤ëŠ˜",yesterday:"ì–´ì œ",thisWeek:"ì´ë²ˆ ì£¼",lastWeek:"ì €ë²ˆ ì£¼",thisMonth:"ì´ë²ˆ ë‹¬",lastMonth:"ì €ë²ˆ ë‹¬",older:"ë” ì´ì „ì— ì™„ë£Œí•œ í• ì¼",completedDay:"ì™„ë£Œí•œ ë‚ ",completedWeek:"ì™„ë£Œí•œ ì£¼",completedMonth:"ì™„ë£Œí•œ ì›”",empty:"ì•„ì§ ì™„ë£Œí•œ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤",emptyHint:"í• ì¼ì„ ì™„ë£Œí•˜ë©´ ì—¬ê¸°ì— íˆìŠ¤í† ë¦¬ê°€ í‘œì‹œë©ë‹ˆë‹¤."},kj={title:"ì‚¬ìš© ì„¤ëª…ì„œ",subtitle:"TodoList ì•±ì„ 100% í™œìš©í•˜ëŠ” ë°©ë²•ì„ ìƒì„¸í•˜ê²Œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.",basics:{title:"1. ê¸°ë³¸ ì‚¬ìš©ë²•",add:"í•  ì¼ ì¶”ê°€í•˜ê¸°",addDesc:"í™”ë©´ ìš°ì¸¡ í•˜ë‹¨ì˜ ì›í˜• '+' ë²„íŠ¼(í”Œë¡œíŒ… ë²„íŠ¼)ì„ ëˆ„ë¥´ê±°ë‚˜, í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ 'N'ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ í•  ì¼ì„ ë¹ ë¥´ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•  ì¼ì˜ ì œëª©, ì„¤ëª…, ë§ˆê°ì¼, ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.",complete:"ì™„ë£Œ ì²˜ë¦¬ ë° ì·¨ì†Œ",completeDesc:"í•  ì¼ ëª©ë¡ì—ì„œ í•­ëª© ì™¼ìª½ì˜ ì²´í¬ë°•ìŠ¤ë¥¼ í´ë¦­í•˜ë©´ ì™„ë£Œ ì²˜ë¦¬ë©ë‹ˆë‹¤. ì‹¤ìˆ˜ë¡œ ì™„ë£Œí•œ ê²½ìš°, í•˜ë‹¨ì˜ 'ì™„ë£Œ ì·¨ì†Œ' ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ 'ì™„ë£Œ ê¸°ë¡' íƒ­ì—ì„œ ë‹¤ì‹œ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",edit:"ìˆ˜ì • ë° ì‚­ì œ",editDesc:"ëª©ë¡ì—ì„œ í•  ì¼ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ìˆ˜ì • íŒì—…ì´ ì—´ë¦½ë‹ˆë‹¤. ë‚´ìš©ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ìš°ì¸¡ ìƒë‹¨ì˜ íœ´ì§€í†µ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."},calendar:{title:"2. ìº˜ë¦°ë” ë° ì¼ì • ê´€ë¦¬",views:"ë‹¤ì–‘í•œ ìº˜ë¦°ë” ë·°",viewsDesc:"ì‚¬ì´ë“œë°” ë˜ëŠ” í•˜ë‹¨ ë©”ë‰´ë¥¼ í†µí•´ 'ì˜¤ëŠ˜', 'ì£¼ê°„', 'ì›”ê°„' ë·°ë¥¼ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 'ì£¼ê°„' ë·°ì—ì„œëŠ” ì£¼ ë‹¨ìœ„ì˜ ì—…ë¬´ íë¦„ì„, 'ì›”ê°„' ë·°ì—ì„œëŠ” ì „ì²´ì ì¸ ì¼ì •ì„ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.",nav:"ë‚ ì§œ íƒìƒ‰",navDesc:"ìƒë‹¨ì˜ ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ í™”ì‚´í‘œ(<, >)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³¼ê±° ë˜ëŠ” ë¯¸ë˜ì˜ ë‚ ì§œë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 'ì˜¤ëŠ˜' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¦‰ì‹œ í˜„ì¬ ë‚ ì§œë¡œ ëŒì•„ì˜µë‹ˆë‹¤."},advanced:{title:"3. ê³ ê¸‰ ê¸°ëŠ¥ í™œìš©",recurring:"ë°˜ë³µ í•  ì¼ ê´€ë¦¬ (ì¤‘ìš”)",recurringDesc:"**ì£¼ì˜:** ìƒˆë¡œìš´ í•  ì¼ ì¶”ê°€ íŒì—…ì—ì„œëŠ” 'ë°˜ë³µ'ì„ ì„¤ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§¤ì¼ ë˜ëŠ” ë§¤ì£¼ ë°˜ë³µë˜ëŠ” ì¼ì •ì€ ì‚¬ì´ë“œë°”ì˜ **'ë°˜ë³µ ê´€ë¦¬'** íƒ­ì—ì„œ ë³„ë„ë¡œ ë“±ë¡í•˜ê³  ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. ì´ê³³ì—ì„œ ì˜ˆì™¸ ë‚ ì§œ ì²˜ë¦¬ ë“± ì •êµí•œ ì„¤ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.",subtasks:"í•˜ìœ„ ì‘ì—… (Subtasks)",subtasksDesc:"í•˜ë‚˜ì˜ í° í”„ë¡œì íŠ¸ë¥¼ ì—¬ëŸ¬ ê°œì˜ ì‘ì€ ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”. í•  ì¼ ìƒì„¸ í™”ë©´ì—ì„œ 'í•˜ìœ„ ì‘ì—… ì¶”ê°€'ë¥¼ í†µí•´ ì§„í–‰ ìƒí™©ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",tags:"íƒœê·¸ ë° í•„í„°ë§",tagsDesc:"í•  ì¼ ì¶”ê°€ ì‹œ '#ì—…ë¬´', '#ê°œì¸'ê³¼ ê°™ì´ í•´ì‹œíƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë©”ì¸ í™”ë©´ì˜ ê²€ìƒ‰/í•„í„° ë°”ì—ì„œ íŠ¹ì • íƒœê·¸ë‚˜ ìš°ì„ ìˆœìœ„(ê¸´ê¸‰, ë†’ìŒ ë“±)ë³„ë¡œ í•„í„°ë§í•˜ì—¬ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."},account:{title:"4. ê³„ì • ë° ë°ì´í„°",login:"ë¡œê·¸ì¸ ë°©ì‹",loginDesc:"êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë©´ í´ë¼ìš°ë“œ ë™ê¸°í™”ê°€ ì§€ì›ë˜ì–´ ì—¬ëŸ¬ ê¸°ê¸°(PC, íƒœë¸”ë¦¿, ëª¨ë°”ì¼)ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²ŒìŠ¤íŠ¸ ëª¨ë“œëŠ” ê¸°ê¸° ë‚´ë¶€ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.",security:"ë³´ì•ˆ ë° ë°±ì—…",securityDesc:"ëª¨ë“  ë°ì´í„°ëŠ” ì•ˆì „í•˜ê²Œ ì „ì†¡ ë° ì €ì¥ë©ë‹ˆë‹¤. ì•± ì‚­ì œ ì‹œ ê²ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” ì†Œì‹¤ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì¤‘ìš”í•œ ë°ì´í„° ë³´í˜¸ë¥¼ ìœ„í•´ êµ¬ê¸€ ë¡œê·¸ì¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤."},sharing:{title:"5. ê³µìœ  ë° í˜‘ì—…",createDetail:"ìƒˆ ê·¸ë£¹ ë§Œë“¤ê¸°",createDetailDesc:"ì‚¬ì´ë“œë°”ì˜ 'ê³µìœ  ì„¤ì •' ë©”ë‰´ì—ì„œ ìƒˆë¡œìš´ ê·¸ë£¹ì„ ë§Œë“¤ê³  íŒ€ì›ë“¤ì„ ì´ë©”ì¼ë¡œ ì´ˆëŒ€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",permissionDetail:"ê¶Œí•œ ê´€ë¦¬",permissionDetailDesc:"íŒ€ì›ë³„ë¡œ 'ë³´ê¸° ê°€ëŠ¥', 'í¸ì§‘ ê°€ëŠ¥', 'ê´€ë¦¬ì' ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ì•ˆì „í•˜ê²Œ í˜‘ì—…í•˜ì„¸ìš”.",filterDetail:"ê³µìœ  í•„í„°",filterDetailDesc:"ë©”ì¸ í™”ë©´ ìƒë‹¨ì˜ í•„í„°ë¥¼ í†µí•´ 'ê°œì¸ í• ì¼'ê³¼ 'ê³µìœ ëœ í• ì¼'ì„ êµ¬ë¶„í•´ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."},notifications:{title:"6. ì•Œë¦¼ ì„¼í„°",centerDetail:"ì•Œë¦¼ í™•ì¸",centerDetailDesc:"ìš°ì¸¡ ìƒë‹¨ì˜ ì¢… ëª¨ì–‘ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ ìƒˆë¡œìš´ ì´ˆëŒ€ ìš”ì²­ì´ë‚˜ í”„ë¡œì íŠ¸ ë³€ê²½ ì‚¬í•­ì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."},more:{title:"ë” ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?",contact:"ì¶”ê°€ì ì¸ ë„ì›€ì´ í•„ìš”í•˜ê±°ë‚˜ ê±´ì˜ì‚¬í•­ì´ ìˆë‹¤ë©´ ì„¤ì • ë©”ë‰´ì˜ 'ë¬¸ì˜í•˜ê¸°'ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.",button:"ë¬¸ì˜í•˜ê¸°"}},Tj={auth:ij,nav:oj,settings:lj,updateNotification:cj,common:dj,sharing:uj,days:hj,todo:gj,modal:mj,projectTemplate:fj,calendar:pj,search:yj,analysis:xj,recurring:bj,detailedStats:vj,history:wj,guide:kj};Et.use(Cp).use(wS).init({resources:{en:{translation:aj},ko:{translation:Tj}},fallbackLng:"ko",interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const Nj={lessThanXSeconds:{one:"1ì´ˆ ë¯¸ë§Œ",other:"{{count}}ì´ˆ ë¯¸ë§Œ"},xSeconds:{one:"1ì´ˆ",other:"{{count}}ì´ˆ"},halfAMinute:"30ì´ˆ",lessThanXMinutes:{one:"1ë¶„ ë¯¸ë§Œ",other:"{{count}}ë¶„ ë¯¸ë§Œ"},xMinutes:{one:"1ë¶„",other:"{{count}}ë¶„"},aboutXHours:{one:"ì•½ 1ì‹œê°„",other:"ì•½ {{count}}ì‹œê°„"},xHours:{one:"1ì‹œê°„",other:"{{count}}ì‹œê°„"},xDays:{one:"1ì¼",other:"{{count}}ì¼"},aboutXWeeks:{one:"ì•½ 1ì£¼",other:"ì•½ {{count}}ì£¼"},xWeeks:{one:"1ì£¼",other:"{{count}}ì£¼"},aboutXMonths:{one:"ì•½ 1ê°œì›”",other:"ì•½ {{count}}ê°œì›”"},xMonths:{one:"1ê°œì›”",other:"{{count}}ê°œì›”"},aboutXYears:{one:"ì•½ 1ë…„",other:"ì•½ {{count}}ë…„"},xYears:{one:"1ë…„",other:"{{count}}ë…„"},overXYears:{one:"1ë…„ ì´ìƒ",other:"{{count}}ë…„ ì´ìƒ"},almostXYears:{one:"ê±°ì˜ 1ë…„",other:"ê±°ì˜ {{count}}ë…„"}},Sj=(t,e,r)=>{let s;const n=Nj[t];return typeof n=="string"?s=n:e===1?s=n.one:s=n.other.replace("{{count}}",e.toString()),r?.addSuffix?r.comparison&&r.comparison>0?s+" í›„":s+" ì „":s},jj={full:"yë…„ Mì›” dì¼ EEEE",long:"yë…„ Mì›” dì¼",medium:"y.MM.dd",short:"y.MM.dd"},_j={full:"a Hì‹œ mmë¶„ ssì´ˆ zzzz",long:"a H:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Dj={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Cj={date:uo({formats:jj,defaultWidth:"full"}),time:uo({formats:_j,defaultWidth:"full"}),dateTime:uo({formats:Dj,defaultWidth:"full"})},Ej={lastWeek:"'ì§€ë‚œ' eeee p",yesterday:"'ì–´ì œ' p",today:"'ì˜¤ëŠ˜' p",tomorrow:"'ë‚´ì¼' p",nextWeek:"'ë‹¤ìŒ' eeee p",other:"P"},Ij=(t,e,r,s)=>Ej[t],Aj={narrow:["BC","AD"],abbreviated:["BC","AD"],wide:["ê¸°ì›ì „","ì„œê¸°"]},Rj={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1ë¶„ê¸°","2ë¶„ê¸°","3ë¶„ê¸°","4ë¶„ê¸°"]},Pj={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"],wide:["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"]},Mj={narrow:["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "],short:["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "],abbreviated:["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "],wide:["ì¼ìš”ì¼","ì›”ìš”ì¼","í™”ìš”ì¼","ìˆ˜ìš”ì¼","ëª©ìš”ì¼","ê¸ˆìš”ì¼","í† ìš”ì¼"]},Oj={narrow:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},abbreviated:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},wide:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"}},Lj={narrow:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},abbreviated:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"},wide:{am:"ì˜¤ì „",pm:"ì˜¤í›„",midnight:"ìì •",noon:"ì •ì˜¤",morning:"ì•„ì¹¨",afternoon:"ì˜¤í›„",evening:"ì €ë…",night:"ë°¤"}},$j=(t,e)=>{const r=Number(t);switch(String(e?.unit)){case"minute":case"second":return String(r);case"date":return r+"ì¼";default:return r+"ë²ˆì§¸"}},Fj={ordinalNumber:$j,era:vn({values:Aj,defaultWidth:"wide"}),quarter:vn({values:Rj,defaultWidth:"wide",argumentCallback:t=>t-1}),month:vn({values:Pj,defaultWidth:"wide"}),day:vn({values:Mj,defaultWidth:"wide"}),dayPeriod:vn({values:Oj,defaultWidth:"wide",formattingValues:Lj,defaultFormattingWidth:"wide"})},Wj=/^(\d+)(ì¼|ë²ˆì§¸)?/i,Vj=/\d+/i,Uj={narrow:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(ê¸°ì›ì „|ì„œê¸°)/i},Bj={any:[/^(bc|ê¸°ì›ì „)/i,/^(ad|ì„œê¸°)/i]},Hj={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234]ì‚¬?ë¶„ê¸°/i},Gj={any:[/1/i,/2/i,/3/i,/4/i]},zj={narrow:/^(1[012]|[123456789])/,abbreviated:/^(1[012]|[123456789])ì›”/i,wide:/^(1[012]|[123456789])ì›”/i},Kj={any:[/^1ì›”?$/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},Yj={narrow:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]/,short:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]/,abbreviated:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]/,wide:/^[ì¼ì›”í™”ìˆ˜ëª©ê¸ˆí† ]ìš”ì¼/},qj={any:[/^ì¼/,/^ì›”/,/^í™”/,/^ìˆ˜/,/^ëª©/,/^ê¸ˆ/,/^í† /]},Xj={any:/^(am|pm|ì˜¤ì „|ì˜¤í›„|ìì •|ì •ì˜¤|ì•„ì¹¨|ì €ë…|ë°¤)/i},Qj={any:{am:/^(am|ì˜¤ì „)/i,pm:/^(pm|ì˜¤í›„)/i,midnight:/^ìì •/i,noon:/^ì •ì˜¤/i,morning:/^ì•„ì¹¨/i,afternoon:/^ì˜¤í›„/i,evening:/^ì €ë…/i,night:/^ë°¤/i}},Jj={ordinalNumber:$x({matchPattern:Wj,parsePattern:Vj,valueCallback:t=>parseInt(t,10)}),era:wn({matchPatterns:Uj,defaultMatchWidth:"wide",parsePatterns:Bj,defaultParseWidth:"any"}),quarter:wn({matchPatterns:Hj,defaultMatchWidth:"wide",parsePatterns:Gj,defaultParseWidth:"any",valueCallback:t=>t+1}),month:wn({matchPatterns:zj,defaultMatchWidth:"wide",parsePatterns:Kj,defaultParseWidth:"any"}),day:wn({matchPatterns:Yj,defaultMatchWidth:"wide",parsePatterns:qj,defaultParseWidth:"any"}),dayPeriod:wn({matchPatterns:Xj,defaultMatchWidth:"any",parsePatterns:Qj,defaultParseWidth:"any"})},cn={code:"ko",formatDistance:Sj,formatLong:Cj,formatRelative:Ij,localize:Fj,match:Jj,options:{weekStartsOn:0,firstWeekContainsDate:1}};var wl;(function(t){t[t.Sunday=1]="Sunday",t[t.Monday=2]="Monday",t[t.Tuesday=3]="Tuesday",t[t.Wednesday=4]="Wednesday",t[t.Thursday=5]="Thursday",t[t.Friday=6]="Friday",t[t.Saturday=7]="Saturday"})(wl||(wl={}));const _t=Ar("LocalNotifications",{web:()=>Je(()=>import("./web-6H05fciy.js"),__vite__mapDeps([5,2,3,1,4]),import.meta.url).then(t=>new t.LocalNotificationsWeb)}),Zj=Object.freeze(Object.defineProperty({__proto__:null,LocalNotifications:_t,get Weekday(){return wl}},Symbol.toStringTag,{value:"Module"})),Sr=class Sr{constructor(){Ht(this,"notifications",[]);Ht(this,"listeners",[]);this.loadNotifications(),this.checkScheduledNotifications(),this.checkWeeklyReport(),this.initializeNativeNotifications(),setInterval(()=>{this.checkScheduledNotifications(),this.checkWeeklyReport()},6e4),Ke.isNativePlatform()&&_t.addListener("localNotificationActionPerformed",e=>{console.log("ğŸ”” Notification action performed:",e.actionId,e.notification.id)})}async ensureChannel(){if(Ke.isNativePlatform())try{await _t.createChannel({id:"todo_alert_channel",name:"Todo ì•Œë¦¼ (ì¤‘ìš”)",description:"ì¤‘ìš”í•œ í• ì¼ ì•Œë¦¼",importance:5,visibility:1,vibration:!0})}catch(e){console.error("Failed to create notification channel",e)}}async initializeNativeNotifications(){if(Ke.isNativePlatform()){await this.ensureChannel();try{await _t.requestPermissions()}catch(e){console.error("Failed to request permissions",e)}try{await _t.registerActionTypes({types:[{id:"REMINDER_ACTIONS",actions:[{id:"COMPLETE",title:"ì™„ë£Œí•˜ê¸°",foreground:!0},{id:"SNOOZE",title:"15ë¶„ ë’¤ ì•Œë¦¼",destructive:!1,foreground:!1}]},{id:"DAILY_BRIEFING_ACTIONS",actions:[{id:"OPEN_APP",title:"ì–´í”Œë¡œ í™•ì¸",foreground:!0},{id:"DISMISS",title:"ë‹«ê¸°",destructive:!1,foreground:!1}]}]})}catch(e){console.error("Failed to register action types",e)}console.log("Native notifications initialized")}}loadNotifications(){const e=localStorage.getItem("notifications");if(e)try{this.notifications=JSON.parse(e).map(r=>({...r,scheduledTime:new Date(r.scheduledTime),createdAt:new Date(r.createdAt)}))}catch(r){console.error("Failed to load notifications:",r)}}saveNotifications(){localStorage.setItem("notifications",JSON.stringify(this.notifications))}async showNotification(e){if(Ke.isNativePlatform())try{await this.ensureChannel(),await _t.schedule({notifications:[{title:e.title,body:e.body,id:Date.now()%1e5,schedule:{at:new Date(Date.now()+1e3)},channelId:"default"}]})}catch(r){console.error("Show notification failed",r)}else"Notification"in window&&Notification.permission==="granted"&&new Notification(e.title,{body:e.body,tag:e.tag})}checkScheduledNotifications(){if(Ke.isNativePlatform())return;const e=new Date;this.notifications.filter(s=>s.scheduledTime<=e&&s.scheduledTime>new Date(e.getTime()-6e4*5)&&!s.isRead).forEach(s=>{this.showBrowserNotification(s),this.listeners.forEach(n=>n(s))})}showBrowserNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification(e.title,{body:e.message,icon:"/favicon.ico",tag:e.tag||e.id})}async scheduleAllNotifications(e,r,s){const n=new Date;if(this.notifications=this.notifications.filter(i=>i.scheduledTime<=n),Ke.isNativePlatform())try{const i=await _t.getPending();i.notifications.length>0&&await _t.cancel({notifications:i.notifications})}catch(i){console.error("Failed to cancel native notifications",i)}await this.scheduleDailyBriefing(e,r,s),await this.scheduleWeeklyReport(e);for(const i of r)i.completed||(await this.scheduleReminder(i,e),await this.scheduleStartReminder(i,e));this.saveNotifications()}async scheduleDailyBriefing(e,r,s){if(!e.dailyReminder||!e.dailyReminderTime)return;const[n,i]=e.dailyReminderTime.split(":").map(Number),o=e.dailyRecurrence||[1,2,3,4,5],l=[];for(let c=0;c<14;c++){const d=xs(new Date,c);if(d.setHours(n,i,0,0),d<=new Date)continue;const u=ri(d);if(!o.includes(u)||e.dailyExcludeHolidays&&s.some(x=>Vt(d,new Date(x.date))))continue;const h=this.buildFutureBriefingMessage(r,d),g=(Sr.DAILY_ID_BASE+c).toString();this.notifications.push({id:g,type:"daily_briefing",title:"ì˜¤ëŠ˜ì˜ í• ì¼ ğŸ“‹",message:h,scheduledTime:d,isRead:!1,createdAt:new Date,tag:`daily_${c}`}),Ke.isNativePlatform()&&l.push({id:Sr.DAILY_ID_BASE+c,title:"ì˜¤ëŠ˜ì˜ í• ì¼ ğŸ“‹",body:h,schedule:{at:d,allowWhileIdle:!0},channelId:"todo_alert_channel",actionTypeId:"DAILY_BRIEFING_ACTIONS",extra:{type:"daily_briefing"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"})}l.length>0&&await _t.schedule({notifications:l})}buildFutureBriefingMessage(e,r){const s=qe(r,"yyyy-MM-dd"),n=e.filter(i=>{if(i.completed)return!1;const o=i.dueDate?qe(new Date(i.dueDate),"yyyy-MM-dd")===s:!1,l=i.startDate?qe(new Date(i.startDate),"yyyy-MM-dd")<=s:!1;return o||l});return n.length===0?"ì˜¤ëŠ˜ ì˜ˆì •ëœ í• ì¼ì„ í™•ì¸í•´ë³´ì„¸ìš”! ğŸ“":`ì˜¤ëŠ˜ ${n.length}ê°œì˜ í• ì¼ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`}async scheduleWeeklyReport(e){if(!e.weeklyReport||!e.weeklyReportTime)return;const[r,s]=e.weeklyReportTime.split(":").map(Number);let n=new Date;for(n.setHours(r,s,0,0);ri(n)!==1||n<=new Date;)n=xs(n,1),n.setHours(r,s,0,0);this.notifications.push({id:Sr.WEEKLY_REPORT_ID.toString(),type:"weekly_report",title:"ì£¼ê°„ ì„±ê³¼ ë¦¬í¬íŠ¸ ğŸ“Š",message:"ì§€ë‚œ í•œ ì£¼ì˜ ì„±ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!",scheduledTime:n,isRead:!1,createdAt:new Date}),Ke.isNativePlatform()&&await _t.schedule({notifications:[{id:Sr.WEEKLY_REPORT_ID,title:"ì£¼ê°„ ì„±ê³¼ ë¦¬í¬íŠ¸ ğŸ“Š",body:"ì§€ë‚œ í•œ ì£¼ì˜ ì„±ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!",schedule:{at:n,allowWhileIdle:!0,every:"week"},channelId:"todo_alert_channel",extra:{type:"weekly_report"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"}]})}async scheduleReminder(e,r){if(!r.dueReminders||!e.dueDate)return;let s=new Date(e.dueDate);if(r.dueReminderTiming!==void 0)s=new Date(s.getTime()-r.dueReminderTiming*6e4);else{s.setDate(s.getDate()-r.advanceDays);const[i,o]=r.time.split(":").map(Number);s.setHours(i,o,0,0)}if(s<=new Date)return;const n=this.hashCode(e.id);this.notifications.push({id:n.toString(),todoId:e.id,type:"reminder",title:"ë§ˆê° ì„ë°• ì•Œë¦¼",message:`"${e.title}" ë§ˆê° ì‹œê°„ì´ ë‹¤ê°€ì˜µë‹ˆë‹¤.`,scheduledTime:s,isRead:!1,createdAt:new Date,tag:`reminder-${e.id}`}),Ke.isNativePlatform()&&await _t.schedule({notifications:[{title:"ë§ˆê° ì„ë°• ì•Œë¦¼",body:`"${e.title}" ë§ˆê° ì‹œê°„ì´ ë‹¤ê°€ì˜µë‹ˆë‹¤.`,id:n,schedule:{at:s,allowWhileIdle:!0},channelId:"todo_alert_channel",actionTypeId:"REMINDER_ACTIONS",extra:{todoId:e.id,type:"reminder"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"}]})}async scheduleStartReminder(e,r){if(!r.startReminder||!e.startDate||!r.startReminderTime)return;const[s,n]=r.startReminderTime.split(":").map(Number),i=new Date(e.startDate);if(i.setHours(s,n,0,0),i<=new Date)return;const o=this.hashCode(e.id+"_start");this.notifications.push({id:o.toString(),todoId:e.id,type:"start_reminder",title:"í• ì¼ ì‹œì‘ ì•Œë¦¼ ğŸš€",message:`"${e.title}" ì‹œì‘ì¼ì…ë‹ˆë‹¤.`,scheduledTime:i,isRead:!1,createdAt:new Date,tag:`start-${e.id}`}),Ke.isNativePlatform()&&await _t.schedule({notifications:[{title:"í• ì¼ ì‹œì‘ ì•Œë¦¼ ğŸš€",body:`"${e.title}" ì‹œì‘ì¼ì…ë‹ˆë‹¤.`,id:o,schedule:{at:i,allowWhileIdle:!0},channelId:"default",actionTypeId:"REMINDER_ACTIONS",extra:{todoId:e.id,type:"start_reminder"},smallIcon:"ic_puppy",iconColor:"#4F46E5",largeIcon:"ic_puppy"}]})}hashCode(e){let r=0,s,n;if(e.length===0)return r;for(s=0;s<e.length;s++)n=e.charCodeAt(s),r=(r<<5)-r+n,r|=0;return Math.abs(r)}isSupported(){return Ke.isNativePlatform()?!0:"Notification"in window}async requestPermission(){return Ke.isNativePlatform()?(await _t.requestPermissions()).display==="granted":"Notification"in window?await Notification.requestPermission()==="granted":!1}async checkPermissions(){return Ke.isNativePlatform()?await _t.checkPermissions():"Notification"in window?{display:Notification.permission==="granted"?"granted":Notification.permission==="denied"?"denied":"prompt"}:{display:"denied"}}async cancelDailyBriefing(){}checkWeeklyReport(){}scheduleOverdueNotification(e){}suggestRecurringTask(e){}showCompletionCelebration(e){}markAsRead(e){}dismissNotification(e){}getUnreadNotifications(){return[]}getAllNotifications(){return[]}addListener(e){}removeListener(e){}async clearNotificationsForTodo(e){if(this.notifications=this.notifications.filter(r=>r.todoId!==e),this.saveNotifications(),Ke.isNativePlatform()){const r=this.hashCode(e),s=this.hashCode(e+"_start");await _t.cancel({notifications:[{id:r},{id:s}]})}}};Ht(Sr,"DAILY_ID_BASE",1e5),Ht(Sr,"START_REMINDER_ID_BASE",2e5),Ht(Sr,"WEEKLY_REPORT_ID",9e5);let Ni=Sr;const Nr=new Ni,kl=Object.freeze(Object.defineProperty({__proto__:null,NotificationManager:Ni,notificationManager:Nr},Symbol.toStringTag,{value:"Module"})),e_=()=>{const{todos:t}=ot(),{customHolidays:e}=sn();return y.useEffect(()=>{const r=localStorage.getItem("notification-settings");if(r)try{const s=JSON.parse(r),n=setTimeout(()=>{Nr.scheduleAllNotifications(s,t,e)},2e3);return()=>clearTimeout(n)}catch(s){console.error("Failed to parse notification settings",s)}},[t,e]),null},Ji=(t,e={})=>{const{minSwipeDistance:r=50,preventDefaultTouchmoveEvent:s=!1}=e,n=y.useRef(null),i=y.useRef(null),o=y.useRef(null),l=y.useRef(null);return{onTouchStart:h=>{n.current=h.touches[0].clientX,i.current=h.touches[0].clientY},onTouchMove:h=>{s&&h.preventDefault()},onTouchEnd:h=>{if(!n.current||!i.current)return;o.current=h.changedTouches[0].clientX,l.current=h.changedTouches[0].clientY;const g=n.current-o.current,m=i.current-l.current;Math.abs(g)>Math.abs(m)&&Math.abs(g)>r&&(g>0?t.onSwipeLeft?.():t.onSwipeRight?.()),n.current=null,i.current=null,o.current=null,l.current=null}}},Hc=y.forwardRef(({todoId:t,subTasks:e},r)=>{const{addSubTask:s,updateSubTask:n,deleteSubTask:i,toggleSubTask:o}=ot(),[l,c]=y.useState(""),[d,u]=y.useState(!1),[h,g]=y.useState(null),m=k=>{k&&k.preventDefault(),l.trim()&&(s(t,l.trim()),c(""),u(!1))};y.useImperativeHandle(r,()=>({savePending:()=>{l.trim()&&m(),h?.title.trim()&&f()}}));const x=k=>{g({id:k.id,title:k.title})},f=()=>{!h||!h.title.trim()||(n(t,h.id,{title:h.title.trim()}),g(null))},p=()=>{g(null)},w=k=>{confirm("ì´ í•˜ìœ„ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&i(t,k)},v=(k,b)=>{k.key==="Enter"?(k.preventDefault(),b==="add"?m(k):f()):k.key==="Escape"&&(b==="add"?(u(!1),c("")):p())};return a.jsxs("div",{className:"mt-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["í•˜ìœ„ ì‘ì—… (",e.length,")"]}),!d&&a.jsxs("button",{onClick:k=>{k.stopPropagation(),u(!0)},className:"flex items-center gap-1 px-2 py-1 text-xs text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",children:[a.jsx(gt,{className:"w-3 h-3"}),"ì¶”ê°€"]})]}),a.jsxs("div",{className:"space-y-2",children:[e.map(k=>a.jsx("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg group",children:h?.id===k.id?a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"checkbox",checked:k.completed,onChange:()=>o(t,k.id),onClick:b=>b.stopPropagation(),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),a.jsx("input",{type:"text",value:h.title,onChange:b=>g({...h,title:b.target.value}),onKeyDown:b=>v(b,"edit"),onClick:b=>b.stopPropagation(),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-600 dark:text-white",placeholder:"í•˜ìœ„ ì‘ì—… ì œëª©",autoFocus:!0}),a.jsx("button",{onClick:b=>{b.stopPropagation(),f()},className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded",title:"ì €ì¥",children:a.jsx(Yt,{className:"w-3 h-3"})}),a.jsx("button",{onClick:b=>{b.stopPropagation(),p()},className:"p-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded",title:"ì·¨ì†Œ",children:a.jsx(rt,{className:"w-3 h-3"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"checkbox",checked:k.completed,onChange:()=>o(t,k.id),onClick:b=>b.stopPropagation(),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:`text-sm ${k.completed?"line-through text-gray-500":"text-gray-700 dark:text-gray-300"}`,children:k.title}),k.completed&&k.completedAt&&k.completedAt!==null&&a.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["ì™„ë£Œ: ",(()=>{try{const b=new Date(k.completedAt);return isNaN(b.getTime())?(console.warn("Invalid Date detected for subtask:",k.id,k.completedAt),"ë‚ ì§œ ì˜¤ë¥˜"):b.toLocaleString("ko-KR")}catch(b){return console.error("Date parsing error:",b,k.completedAt),"ë‚ ì§œ ì˜¤ë¥˜"}})()]})]}),a.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx("button",{onClick:b=>{b.stopPropagation(),x(k)},className:"p-1 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded",title:"ìˆ˜ì •",children:a.jsx(Bg,{className:"w-3 h-3"})}),a.jsx("button",{onClick:b=>{b.stopPropagation(),w(k.id)},className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",title:"ì‚­ì œ",children:a.jsx(rt,{className:"w-3 h-3"})})]})]})},k.id)),d&&a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[a.jsx("input",{type:"text",value:l,onChange:k=>c(k.target.value),onKeyDown:k=>v(k,"add"),onClick:k=>k.stopPropagation(),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-600 dark:text-white",placeholder:"í•˜ìœ„ ì‘ì—… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”",autoFocus:!0}),a.jsx("button",{type:"button",onClick:k=>{k.preventDefault(),k.stopPropagation(),m()},className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded",title:"ì¶”ê°€",children:a.jsx(Yt,{className:"w-3 h-3"})}),a.jsx("button",{type:"button",onClick:k=>{k.stopPropagation(),u(!1),c("")},className:"p-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded",title:"ì·¨ì†Œ",children:a.jsx(rt,{className:"w-3 h-3"})})]}),e.length===0&&!d&&a.jsx("div",{className:"text-center py-4 text-sm text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/30 rounded-lg border-2 border-dashed border-gray-200 dark:border-gray-600",children:"í•˜ìœ„ ì‘ì—…ì„ ì¶”ê°€í•´ë³´ì„¸ìš”"})]})]})});Hc.displayName="SubTaskManager";const Wr=({todo:t,onEdit:e,compact:r=!1})=>{const{t:s,i18n:n}=Xe(),i=n.language==="ko"?cn:rn,{toggleTodo:o,deleteTodo:l,updateTodo:c}=ot(),{currentUser:d}=wt(),[u,h]=y.useState(!1),g=y.useRef(null),[m,x]=y.useState(!1),f=t.visibility?.isShared,p=24,w=new Date,v=f&&t.ownerId&&t.ownerId!==d?.uid&&t.createdAt&&$d(w,new Date(t.createdAt))<=p,k=f&&t.lastModifiedBy&&t.lastModifiedBy!==d?.uid&&t.updatedAt&&t.createdAt&&new Date(t.updatedAt).getTime()!==new Date(t.createdAt).getTime()&&$d(w,new Date(t.updatedAt))<=p,b=t.subTasks?.length||0,T=t.subTasks?.filter(q=>q.completed).length||0,_=b>0,j=_?T/b*100:0,N=t.dueDate&&Fd(new Date(t.dueDate),ho(new Date))&&!t.completed;t.dueDate&&Fx(new Date(t.dueDate),ho(new Date))&&Fd(new Date(t.dueDate),xs(ho(new Date),1));const D=q=>qe(new Date(q),"yyyy.MM.dd",{locale:i}),$=()=>{if(!t.startDate&&!t.dueDate)return null;if(t.startDate&&t.dueDate)return a.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded",children:[a.jsx("span",{children:D(t.startDate)}),a.jsx("span",{className:"text-gray-400",children:"~"}),a.jsx("span",{className:`${N?"text-red-500 font-bold":""}`,children:D(t.dueDate)})]});if(t.startDate)return a.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded",children:[a.jsx(Jo,{className:"w-3 h-3 text-primary-500"}),a.jsx("span",{children:D(t.startDate)})]});if(t.dueDate)return a.jsxs("div",{className:`flex items-center gap-1 text-[10px] font-medium bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded ${N?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:[a.jsx(ya,{className:`w-3 h-3 ${N?"text-red-500 fill-red-500":"text-gray-400"}`}),a.jsx("span",{children:D(t.dueDate)})]})},C=()=>{u||o(t.id)},R=!t.myPermission||t.myPermission==="edit"||t.myPermission==="admin",B=!t.myPermission||t.myPermission==="admin",Y=Ji({onSwipeLeft:()=>{B&&confirm(s("calendar.deleteConfirm"))&&l(t.id)},onSwipeRight:()=>{R&&o(t.id)}},{minSwipeDistance:50}),V=()=>{if(t.completed)return"border-gray-200 dark:border-gray-700";switch(t.priority){case"urgent":return"border-red-500 dark:border-red-500";case"high":return"border-orange-500 dark:border-orange-500";case"medium":return"border-primary-500 dark:border-primary-500";default:return"border-gray-200 dark:border-gray-700"}};return a.jsx("div",{ref:g,className:`
        relative group mb-3 transition-all duration-300 ease-out
        ${t.completed?"opacity-60":"opacity-100"}
      `,onClick:()=>{e?.(t)},...Y,children:a.jsxs("div",{className:`
        relative p-5 rounded-2xl border backdrop-blur-sm transition-all duration-300
        ${t.completed?"bg-gray-50/50 dark:bg-gray-800/30 border-gray-200 dark:border-gray-700":`bg-white/70 dark:bg-gray-800/70 shadow-sm hover:shadow-md hover:-translate-y-0.5 ${V()} md:border-white/50 md:dark:border-gray-700`}
      `,children:[!r&&a.jsxs("div",{className:"hidden md:flex absolute top-4 right-20 flex-col items-end gap-1.5 z-10",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[t.visibility?.isShared&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 rounded-full border border-blue-200 dark:border-blue-800 flex items-center gap-1",children:[a.jsx(tr,{className:"w-3 h-3"}),s("sharing.shared")||"Shared"]}),v&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-green-500 text-white rounded-full flex items-center gap-1 animate-pulse",children:[a.jsx(Qo,{className:"w-3 h-3"}),"NEW"]}),!v&&k&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-orange-500 text-white rounded-full flex items-center gap-1",children:[a.jsx(Za,{className:"w-3 h-3"}),"ìµœê·¼ ìˆ˜ì •"]}),t.recurrence&&t.recurrence!=="none"&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 rounded-full border border-purple-200 dark:border-purple-800 flex items-center gap-1",children:[a.jsx(Hy,{className:"w-3 h-3"}),s("modal.addTodo.recurrence")]}),t.priority&&t.priority!=="medium"&&a.jsx("span",{className:`px-2 py-0.5 text-[10px] font-bold rounded-full border flex items-center gap-1 ${t.priority==="urgent"?"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800":t.priority==="high"?"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/30 dark:text-orange-300 dark:border-orange-800":"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-900/30 dark:text-gray-300 dark:border-gray-800"}`,children:t.priority==="urgent"?s("modal.addTodo.urgent"):t.priority==="high"?s("modal.addTodo.high"):s("modal.addTodo.low")}),t.type==="project"&&a.jsxs("span",{className:"px-2 py-0.5 text-[10px] font-bold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 rounded-full border border-indigo-200 dark:border-indigo-800 flex items-center gap-1",children:[t.project==="longterm"?s("projectTemplate.longterm"):s("projectTemplate.shortterm"),_&&a.jsxs("span",{className:"ml-1 opacity-80",children:[T,"/",b]})]})]}),$()]}),a.jsxs("div",{className:"md:hidden absolute top-4 right-20 flex items-center gap-1.5 z-10",children:[v&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-green-500 text-white rounded-full flex items-center gap-0.5 animate-pulse",children:[a.jsx(Qo,{className:"w-3 h-3"}),"NEW"]}),!v&&k&&a.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-orange-500 text-white rounded-full flex items-center gap-0.5",children:[a.jsx(Za,{className:"w-3 h-3"}),"ìˆ˜ì •ë¨"]}),t.visibility?.isShared&&a.jsx(tr,{className:"w-4 h-4 text-blue-500"}),t.recurrence&&t.recurrence!=="none"&&a.jsx(ql,{className:"w-4 h-4 text-purple-500"}),t.type==="project"&&t.project==="longterm"&&a.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-bold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 rounded-full border border-indigo-200 dark:border-indigo-800",children:s("projectTemplate.longterm")})]}),a.jsx("div",{className:"absolute top-4 right-4 z-20 flex flex-col items-end gap-1",children:a.jsxs("div",{className:"flex items-center gap-1",children:[R&&a.jsx("button",{onClick:q=>{q.stopPropagation(),e?.(t)},className:"p-1.5 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",title:s("common.edit"),children:a.jsx(Hg,{className:"w-4 h-4"})}),B&&a.jsx("button",{onClick:q=>{q.stopPropagation(),window.confirm(s("common.deleteConfirm")||"ì´ í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&l(t.id)},className:"p-1.5 text-gray-400 hover:text-red-600 dark:hover:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",title:s("common.delete"),children:a.jsx(Ut,{className:"w-4 h-4"})})]})}),a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("button",{onClick:q=>{q.stopPropagation(),R&&C()},disabled:!R,className:`
              flex-shrink-0 w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all duration-300 mt-1
              ${t.completed?"bg-primary-500 border-primary-500 text-white scale-110":"border-gray-300 dark:border-gray-600 hover:border-primary-400 dark:hover:border-primary-400 bg-white dark:bg-gray-800"}
              ${R?"":"opacity-50 cursor-not-allowed"}
            `,children:t.completed&&a.jsx(Yt,{className:"w-4 h-4",strokeWidth:3})}),a.jsxs("div",{className:"flex-1 min-w-0 pt-0.5 pr-28 sm:pr-24",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("h3",{className:`
                text-base font-semibold leading-snug transition-all duration-300 break-words
                ${t.completed?"text-gray-400 dark:text-gray-500 line-through decoration-2 decoration-gray-300":"text-gray-900 dark:text-white"}
              `,children:t.title}),_&&a.jsx("button",{onClick:q=>{q.stopPropagation(),x(!m)},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:m?a.jsx(Gg,{className:"w-4 h-4"}):a.jsx(pa,{className:"w-4 h-4"})})]}),t.description&&a.jsx("p",{className:`mt-1.5 text-sm line-clamp-2 ${t.completed?"text-gray-400":"text-gray-600 dark:text-gray-300"}`,children:t.description}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[a.jsx("div",{className:r?"":"md:hidden",children:$()}),t.tags&&t.tags.length>0&&a.jsx("div",{className:"flex flex-wrap gap-1",children:t.tags.map((q,z)=>a.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-md font-medium",children:["#",q]},z))})]}),_&&!t.completed&&a.jsxs("div",{className:"mt-3 w-full",children:[a.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 mb-1",children:[a.jsx("span",{children:s("common.progress")}),a.jsxs("span",{children:[Math.round(j),"%"]})]}),a.jsx("div",{className:"h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden",children:a.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${j===100?"bg-green-500":"bg-primary-500"}`,style:{width:`${j}%`}})})]}),m&&a.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700/50 animate-fade-in-down",children:a.jsx(Hc,{todoId:t.id,subTasks:t.subTasks||[]})})]})]})]})})},lh=({vacation:t,employee:e,compact:r=!1})=>{const s=n=>{switch(n){case"ì—°ì°¨":return"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800";case"ì˜¤ì „":return"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800";case"ì˜¤í›„":return"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-300 dark:border-purple-800";case"íŠ¹ë³„":return"bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800";case"ë³‘ê°€":return"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800";case"ì—…ë¬´":return"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600";default:return"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}};return r?a.jsx("div",{className:`p-2 mb-1.5 rounded border ${s(t.type)}`,children:a.jsxs("div",{className:"flex items-center gap-2",children:[e&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 rounded-full flex items-center justify-center text-white text-xs font-semibold flex-shrink-0",style:{backgroundColor:e.color},children:e.name.charAt(0)}),a.jsx("span",{className:"text-xs font-medium truncate",children:e.name})]}),a.jsx("span",{className:"text-[8px] font-medium px-1 py-0.5 rounded",children:t.type})]})}):a.jsx("div",{className:`p-3 rounded-lg border ${s(t.type)}`,children:a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"flex items-center gap-2",children:e?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-semibold",style:{backgroundColor:e.color},children:e.name.charAt(0)}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.name}),a.jsx("div",{className:"text-xs opacity-75",children:e.team})]})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(qn,{className:"w-5 h-5"}),a.jsxs("span",{className:"font-medium",children:["ì§ì› ID: ",t.employeeId]})]})}),a.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded",children:t.type})]})})},Tl=y.memo(({currentView:t,searchTerm:e="",priorityFilter:r="all",typeFilter:s="all",projectFilter:n="all",tagFilter:i=[],completionDateFilter:o="all",sharingFilter:l="all",sharingFilterState:c,selectedDate:d,onDateChange:u,onEdit:h})=>{const{t:g,i18n:m}=Xe(),{todos:x,getTodayTodos:f,getWeekTodos:p,getMonthTodos:w,reorderTodos:v,getYesterdayIncompleteTodos:k,getTomorrowTodos:b}=ot(),{currentUser:T}=wt(),{showVacationsInTodos:_,getVacationsForDate:j,employees:N}=ln(),[D,$]=y.useState(null),[C,R]=y.useState(null),B=Ji({onSwipeLeft:()=>{t==="today"&&u&&d&&u(xs(d,1))},onSwipeRight:()=>{t==="today"&&u&&d&&u(An(d))}},{minSwipeDistance:60}),Y=y.useMemo(()=>{let H=[];switch(t){case"today":H=f(d);break;case"week":H=p();break;case"month":H=w();break;default:H=x}return H},[t,d,f,p,w,x]),V=y.useMemo(()=>(I=>{const J=new Set;return I.filter(O=>J.has(O.id)?!1:(J.add(O.id),!0)).filter(O=>{if(e){const G=e.toLowerCase(),M=O.title.toLowerCase().includes(G),se=O.description?.toLowerCase().includes(G)||!1;if(!M&&!se)return!1}if(r!=="all"&&O.priority!==r||s!=="all"&&O.type!==s||n!=="all"&&O.type==="project"&&O.project!==n||i.length>0&&(!O.tags||O.tags.length===0||!O.tags.some(M=>i.includes(M))))return!1;if(c){const{showPersonal:G,showMyShared:M,showGroupShared:se,selectedGroupId:ue}=c;if(ue&&O.sharedGroupId!==ue)return!1;const ge=O.visibility?.isPersonal!==!1,re=O.visibility?.isShared===!0,Ie=re&&O.ownerId===T?.uid,K=re&&O.ownerId!==T?.uid;let pe=!1;if(G&&ge&&!re&&(pe=!0),M&&Ie&&(pe=!0),se&&K&&(pe=!0),G&&ge&&!re&&(pe=!0),G&&ge&&re&&(pe=!0),pe=!1,G&&ge&&!re&&(pe=!0),M&&Ie&&(pe=!0),se&&K&&(pe=!0),!pe)return!1}else if(l!=="all"){const G=O.visibility?.isPersonal!==!1,M=O.visibility?.isShared===!0,se=M&&O.ownerId===T?.uid,ue=M&&O.ownerId!==T?.uid;if(l==="private"){if(M||!G)return!1}else if(l==="shared"){if(!ue)return!1}else if(l==="my_shared"){if(!se)return!1}else if(O.sharedGroupId!==l)return!1}return!0})})(Y),[Y,e,r,s,n,i,o,l,c]),q=V.filter(H=>!H.completed),z=V.filter(H=>H.completed),de=[];if(t==="today"){const H=d||new Date;H.setHours(0,0,0,0),V.forEach(I=>{I.subTasks&&I.subTasks.length>0&&I.subTasks.forEach(J=>{if(J.completed&&J.completedAt&&J.completedAt!==null)try{const ce=new Date(J.completedAt);ce.setHours(0,0,0,0),ce.getTime()===H.getTime()&&de.push({...J,type:"simple",recurrence:"none",isSubTask:!0,parentTitle:I.title,parentDescription:I.description,createdAt:J.createdAt,updatedAt:J.updatedAt})}catch{}})})}const Te=[...z,...de],we=()=>t==="today"&&d?d:new Date,W=Hr(T?.email)&&_?j(we()):[],le=(H,I)=>{$(I),H.dataTransfer.effectAllowed="move",H.dataTransfer.setData("text/plain",I.toString())},ie=async(H,I)=>{if(H.preventDefault(),D!==null){try{if(D!==I){let J=I;I>D&&(J=I-1),await v(D,J,ke)}}catch(J){console.error("Drop error:",J)}$(null),R(null)}},be=()=>{$(null),R(null)},ke=(H=>{const I={urgent:0,high:1,medium:2,low:3};return H.sort((ce,O)=>{const G=I[ce.priority]-I[O.priority];if(G!==0)return G;const M=ce.order,se=O.order;return M!==void 0&&se!==void 0&&M!==se?M-se:M!==void 0&&se===void 0?-1:M===void 0&&se!==void 0?1:ce.dueDate&&O.dueDate?new Date(ce.dueDate).getTime()-new Date(O.dueDate).getTime():ce.dueDate?-1:O.dueDate?1:new Date(O.createdAt).getTime()-new Date(ce.createdAt).getTime()})})(q),E=Te.sort((H,I)=>{const J=ce=>{if(ce.isSubTask&&ce.completedAt)try{return new Date(ce.completedAt).getTime()}catch{return 0}if(ce.completedAt)try{return new Date(ce.completedAt).getTime()}catch{return new Date(ce.updatedAt).getTime()}return new Date(ce.updatedAt).getTime()};return J(I)-J(H)}),te=t==="today"?k(d):[],Q=t==="today"?b(d):[];return t==="today"?a.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-8 items-start",onTouchStart:B.onTouchStart,onTouchMove:B.onTouchMove,onTouchEnd:B.onTouchEnd,children:[a.jsx("div",{className:"xl:col-span-2 space-y-4",children:a.jsxs("div",{className:"glass-card p-3 sm:p-4 rounded-xl",children:[a.jsxs("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-2",children:[a.jsx(ql,{className:"w-4 h-4"}),g("todo.yesterday.title"),a.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded-full text-gray-600 dark:text-gray-300",children:te.length})]}),a.jsx("div",{className:"space-y-2",children:te.length>0?te.map(H=>a.jsx("div",{className:"opacity-75 hover:opacity-100 transition-opacity",children:a.jsx(Wr,{todo:H,compact:!0,onEdit:h})},H.id)):a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 text-center py-4",children:g("todo.yesterday.empty")})})]})}),a.jsxs("div",{className:"xl:col-span-8 space-y-6",children:[W.length>0&&a.jsxs("div",{className:"glass-card p-4 sm:p-6 relative overflow-hidden group mb-4 sm:mb-6",children:[a.jsxs("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-3 sm:mb-4 flex items-center gap-2 relative z-10",children:[a.jsx(at,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-500"}),g("todo.vacation.title")," ",a.jsxs("span",{className:"text-sm sm:text-base font-medium text-gray-500 dark:text-gray-300 ml-1",children:["(",W.length,")"]})]}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:W.map(H=>{const I=N.find(J=>J.id===H.employeeId);return a.jsx(lh,{vacation:H,employee:I,compact:!0},H.id)})})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:[g("todo.inprogress.title")," (",ke.length,")"]}),ke.length===0&&W.length===0?a.jsx("div",{className:"glass-card p-12 text-center text-gray-500 dark:text-gray-400",children:a.jsx("p",{className:"text-lg",children:g("todo.inprogress.empty")})}):a.jsx("div",{className:"relative",onDragOver:H=>{if(H.preventDefault(),D===null)return;const I=H.currentTarget,J=I.getBoundingClientRect(),ce=H.clientY-J.top,O=I.querySelectorAll("[data-todo-index]");let G=O.length;for(let M=0;M<O.length;M++){const se=O[M].getBoundingClientRect(),ue=se.top-J.top,ge=se.bottom-J.top,re=ue+(ge-ue)/2;if(ce<re){G=M;break}}if(G===D){R(null);return}R(G)},onDrop:H=>{H.preventDefault(),C!==null&&ie(H,C)},children:ke.map((H,I)=>a.jsxs("div",{className:"relative",children:[D!==null&&C===I&&a.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-500 z-30"}),a.jsx("div",{"data-todo-index":I,draggable:!0,onDragStart:J=>le(J,I),onDragEnd:be,className:`
                          cursor-grab active:cursor-grabbing transition-all duration-200 relative
                          ${D===I?"scale-105 shadow-lg z-20":""}
                          mb-1
                        `,children:a.jsx(Wr,{todo:H,onEdit:h})}),D!==null&&C===I+1&&I===ke.length-1&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-blue-500 z-30"})]},H.id))})]}),E.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-300 mb-4 flex items-center gap-2",children:[a.jsx(Cn,{className:"w-5 h-5"}),g("todo.completed.title")," (",E.length,")"]}),a.jsx("div",{className:"space-y-2",children:E.map(H=>{if(H.isSubTask){const I=H,J=I.completedAt?new Date(I.completedAt):new Date(I.updatedAt);return a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Cn,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200 line-through",children:H.title}),a.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded border",children:g("todo.completed.subtask")})]}),a.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300",children:[a.jsxs("span",{className:"font-medium",children:[g("todo.completed.parentProject"),":"]})," ",I.parentTitle,I.parentDescription&&a.jsxs("span",{className:"ml-2 opacity-75",children:["â€¢ ",I.parentDescription]})]}),a.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[g("todo.completed.time"),": ",J.toLocaleTimeString(m.language==="ko"?"ko-KR":"en-US",{hour:"2-digit",minute:"2-digit"})]})]})]},`subtask-${H.id}`)}return a.jsx(Wr,{todo:H,onEdit:h},H.id)})})]})]}),a.jsx("div",{className:"xl:col-span-2 space-y-4",children:a.jsxs("div",{className:"glass-card p-3 sm:p-4 rounded-xl",children:[a.jsxs("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mb-3 flex items-center gap-2",children:[a.jsx(gr,{className:"w-4 h-4"}),g("todo.tomorrow.title"),a.jsx("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded-full text-gray-600 dark:text-gray-300",children:Q.length})]}),a.jsx("div",{className:"space-y-2",children:Q.length>0?Q.map(H=>a.jsx("div",{className:"opacity-75 hover:opacity-100 transition-opacity",children:a.jsx(Wr,{todo:H,compact:!0,onEdit:h})},H.id)):a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 text-center py-4",children:g("todo.tomorrow.empty")})})]})})]}):a.jsxs("div",{className:"space-y-6 relative",children:[W.length>0&&a.jsxs("div",{className:"glass-card p-6 relative overflow-hidden group mb-6",children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2 relative z-10",children:[a.jsx(at,{className:"w-6 h-6 text-blue-500"}),g("todo.vacation.title")," ",a.jsxs("span",{className:"text-base font-medium text-gray-500 dark:text-gray-300 ml-1",children:["(",W.length,")"]})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:W.map(H=>{const I=N.find(J=>J.id===H.employeeId);return a.jsx(lh,{vacation:H,employee:I,compact:!1},H.id)})})]}),ke.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:[g("todo.inprogress.title")," (",ke.length,")"]}),a.jsx("div",{className:"relative",onDragOver:H=>{if(H.preventDefault(),D===null)return;const I=H.currentTarget,J=I.getBoundingClientRect(),ce=H.clientY-J.top,O=I.querySelectorAll("[data-todo-index]");let G=O.length;for(let M=0;M<O.length;M++){const se=O[M].getBoundingClientRect(),ue=se.top-J.top,ge=se.bottom-J.top,re=ue+(ge-ue)/2;if(ce<re){G=M;break}}if(G===D){R(null);return}R(G)},onDrop:H=>{H.preventDefault(),C!==null&&ie(H,C)},children:ke.map((H,I)=>a.jsxs("div",{className:"relative",children:[D!==null&&C===I&&a.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-500 z-30"}),a.jsx("div",{"data-todo-index":I,draggable:!0,onDragStart:J=>le(J,I),onDragEnd:be,className:`
                      cursor-grab active:cursor-grabbing transition-all duration-200 relative
                      ${D===I?"scale-105 shadow-lg z-20":""}
                      mb-1
                    `,children:a.jsx(Wr,{todo:H,onEdit:h})}),D!==null&&C===I+1&&I===ke.length-1&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-blue-500 z-30"})]},H.id))})]}),E.length>0&&(t==="week"||t==="month")&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-300 mb-4 flex items-center gap-2",children:[a.jsx(Cn,{className:"w-5 h-5"}),g("todo.completed.title")," (",E.length,")"]}),a.jsx("div",{className:"space-y-2",children:E.map(H=>{if(H.isSubTask){const I=H,J=I.completedAt?new Date(I.completedAt):new Date(I.updatedAt);return a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Cn,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200 line-through",children:H.title}),a.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded border",children:g("todo.completed.subtask")})]}),a.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300",children:[a.jsxs("span",{className:"font-medium",children:[g("todo.completed.parentProject"),":"]})," ",I.parentTitle,I.parentDescription&&a.jsxs("span",{className:"ml-2 opacity-75",children:["â€¢ ",I.parentDescription]})]}),a.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[g("todo.completed.time"),": ",J.toLocaleTimeString(m.language==="ko"?"ko-KR":"en-US",{hour:"2-digit",minute:"2-digit"})]})]})]},`subtask-${H.id}`)}return a.jsx(Wr,{todo:H,onEdit:h},H.id)})})]})]})});Tl.displayName="TodoList";var Ur=Ug();const t_=({todoId:t,todoTitle:e="Task",currentUserId:r,initialSharedWith:s,onUpdate:n,isOwner:i=!1,onClose:o})=>{const{t:l}=Xe(),{currentUser:c}=wt(),[d,u]=y.useState(s),[h,g]=y.useState([]),[m,x]=y.useState(""),[f,p]=y.useState(null),[w,v]=y.useState(""),[k,b]=y.useState("read"),[T,_]=y.useState(!1),[j,N]=y.useState(""),[D,$]=y.useState(!1);y.useEffect(()=>{if(u(s),x(""),p(null),N(""),v(e),t&&c){const V=ee.subscribeToSentInvitations(c.uid,q=>{const z=q.filter(de=>de.todoId===t&&de.status==="pending");g(z)});return()=>V()}},[s,t,c,e]);const C=async()=>{if(m.trim()){_(!0),N(""),p(null);try{const V=await ee.findUserByEmail(m);V?V.uid===r?N(l("sharing.cannotShareSelf")||"Cannot share with yourself"):d.some(q=>q.uid===V.uid)?N(l("sharing.alreadyAdded")||"User already has access"):p({uid:V.uid,email:V.email,displayName:V.displayName,photoURL:V.photoURL,permission:"read"}):N(l("sharing.userNotFound")||"User not found")}catch(V){console.error("Search error:",V),N(l("common.error")||"Error occurred")}finally{_(!1)}}},R=async()=>{if(!(!f||!c))if(t){$(!0);try{const V={uid:c.uid,email:c.email,displayName:c.displayName||void 0,photoURL:c.photoURL,permission:"admin"};await ee.sendSharingInvitation(V,f.email,t,e,k,w),p(null),x(""),v(e),await ee.updateTodo(t,{visibility:{isPersonal:!0,isShared:!0}},c.uid),alert(l("sharing.inviteSent")||"Invitation sent!")}catch(V){console.error("Failed to send invite:",V),V.message==="Already invited this user to this task."?N(l("sharing.alreadyInvited")||"Invitation already pending"):alert("Failed to send invite")}finally{$(!1)}}else{const V={...f,permission:k},q=[...d,V];u(q),n?.(q),p(null),x("")}},B=async V=>{if(c)if(t){if(confirm(l("sharing.confirmRevoke")||"Revoke access for this user?")){const q=d.filter(z=>z.uid!==V);try{await ee.updateTodo(t,{sharedWith:q,visibility:{isPersonal:!0,isShared:q.length>0||h.length>0}},c.uid),u(q)}catch(z){console.error("Revoke failed",z),alert("Failed to revoke access")}}}else{const q=d.filter(z=>z.uid!==V);u(q),n?.(q)}},Y=async(V,q)=>{if(c)if(t){const z=d.map(de=>de.uid===V?{...de,permission:q}:de);try{await ee.updateTodo(t,{sharedWith:z},c.uid),u(z)}catch(de){console.error("Update permission failed",de)}}else{const z=d.map(de=>de.uid===V?{...de,permission:q}:de);u(z),n?.(z)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("sharing.inviteUser")}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(Zo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),a.jsx("input",{type:"email",value:m,onChange:V=>x(V.target.value),onKeyPress:V=>V.key==="Enter"&&C(),placeholder:"email@example.com",className:"w-full pl-9 pr-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-xl focus:ring-2 focus:ring-blue-500 transition-all text-sm"})]}),a.jsx("button",{onClick:C,disabled:T||!m,className:"px-3 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl font-medium text-sm hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 transition-colors",children:T?a.jsx(Ys,{className:"w-4 h-4 animate-spin"}):a.jsx(Zo,{className:"w-4 h-4"})})]}),j&&a.jsx("p",{className:"text-xs text-red-500 ml-1",children:j}),f&&a.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-100 dark:border-blue-800 space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-200 dark:bg-blue-800 flex items-center justify-center text-sm font-bold text-blue-700 dark:text-blue-300",children:f.email[0].toUpperCase()}),a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:f.displayName||f.email}),a.jsx("p",{className:"text-xs text-gray-500",children:f.email})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:l("sharing.shareName")}),a.jsx("input",{type:"text",value:w,onChange:V=>v(V.target.value),className:"w-full mt-1 border-gray-200 dark:border-gray-700 rounded-lg text-sm bg-white dark:bg-gray-800",placeholder:"Task Name for Recipient"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:l("modal.addTodo.priority")}),a.jsxs("select",{value:k,onChange:V=>b(V.target.value),className:"w-full mt-1 border-gray-200 dark:border-gray-700 rounded-lg text-sm bg-white dark:bg-gray-800",children:[a.jsx("option",{value:"read",children:"Can View"}),a.jsx("option",{value:"edit",children:"Can Edit"}),a.jsx("option",{value:"admin",children:"Admin"})]})]})]}),a.jsxs("button",{onClick:R,disabled:D,className:"w-full py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 disabled:opacity-70 transition-colors flex items-center justify-center gap-2",children:[D?a.jsx(Ys,{className:"w-4 h-4 animate-spin"}):a.jsx(Gy,{className:"w-4 h-4"}),l(t?"sharing.sendInvite":"sharing.addToShared")]})]})]}),t&&h.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[a.jsx(gr,{className:"w-4 h-4 text-orange-500"}),l("sharing.pendingInvites")]}),a.jsx("div",{className:"space-y-2 max-h-[120px] overflow-y-auto",children:h.map(V=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-orange-50 dark:bg-orange-900/10 rounded-lg border border-orange-100 dark:border-orange-800",children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"font-medium",children:V.toEmail}),a.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",V.permission,")"]})]}),a.jsx("span",{className:"text-xs text-orange-600 dark:text-orange-400 font-medium",children:"Waiting"})]},V.id))})]}),a.jsx("div",{className:"h-px bg-gray-100 dark:bg-gray-700"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[l("sharing.accessList")," (",d.length,")"]}),a.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto pr-1",children:d.length===0?a.jsx("p",{className:"text-center text-gray-400 text-sm py-2",children:l("sharing.noUsers")}):d.map(V=>a.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-xl transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-xs font-medium",children:V.displayName?.[0]||V.email[0].toUpperCase()}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:V.displayName||V.email.split("@")[0]}),V.uid===r&&a.jsx("span",{className:"text-[10px] bg-gray-100 text-gray-600 px-1.5 rounded",children:"You"})]}),a.jsx("p",{className:"text-xs text-gray-500 truncate",children:V.email})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{value:V.permission,onChange:q=>Y(V.uid,q.target.value),disabled:V.uid===r,className:"bg-transparent border-none text-xs font-medium text-gray-600 dark:text-gray-300 focus:ring-0 cursor-pointer disabled:cursor-default",children:[a.jsx("option",{value:"read",children:"Can View"}),a.jsx("option",{value:"edit",children:"Can Edit"}),a.jsx("option",{value:"admin",children:"Admin"})]}),V.uid!==r&&a.jsx("button",{onClick:()=>B(V.uid),className:"p-1.5 text-gray-400 hover:text-red-500 transition-colors",children:a.jsx(rt,{className:"w-4 h-4"})})]})]},V.uid))})]}),o&&a.jsx("div",{className:"pt-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-end",children:a.jsx("button",{onClick:o,className:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg shadow-sm transition-all dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600",children:l(t?"common.close":"common.done")})})]})},Gc=({isOpen:t,onClose:e,todo:r,isMobile:s=!1})=>{const{updateTodo:n,updateRecurringTemplate:i,deleteTodo:o}=ot(),{currentUser:l}=wt(),{t:c}=Xe(),[d,u]=y.useState({title:"",description:"",priority:"medium",type:"simple",startDate:"",startTime:"",dueDate:"",dueTime:"",showStartTime:!1,showDueTime:!1,recurrence:"none",recurrenceDay:1,recurrenceDate:1,project:"shortterm",tags:[],exceptions:[]}),[h,g]=y.useState({}),[m,x]=y.useState(!1),f=y.useRef(null),[p,w]=y.useState(!0),[v,k]=y.useState(!1),[b,T]=y.useState([]),[_,j]=y.useState(null),[N,D]=y.useState(null),[$,C]=y.useState([]);y.useEffect(()=>{if(!l?.uid)return;const W=ee.subscribeSharingGroups(l.uid,le=>C(le));return()=>W()},[l?.uid]);const R=!r||r.myPermission==="edit"||r.myPermission==="admin",B=!r||r.myPermission==="admin";y.useEffect(()=>{if(r&&t){const W=r.id.startsWith("recurring_");x(W),u({title:r.title.replace("ğŸ”„ ",""),description:r.description||"",priority:r.priority,type:r.type,startDate:r.startDate?(()=>{const le=new Date(r.startDate);return`${le.getFullYear()}-${String(le.getMonth()+1).padStart(2,"0")}-${String(le.getDate()).padStart(2,"0")}`})():"",startTime:r.startTime||"",dueDate:r.dueDate?(()=>{const le=new Date(r.dueDate);return`${le.getFullYear()}-${String(le.getMonth()+1).padStart(2,"0")}-${String(le.getDate()).padStart(2,"0")}`})():"",dueTime:r.dueDate?new Date(r.dueDate).toTimeString().split(" ")[0].substring(0,5):r.dueTime||"",showStartTime:r.showStartTime||!1,showDueTime:r.showDueTime||!1,recurrence:r.recurrence||"none",recurrenceDay:r.recurrenceDay||1,recurrenceDate:r.recurrenceDate||1,project:r.project||"shortterm",tags:r.tags||[],exceptions:[]}),w(r.visibility?.isPersonal!==!1),k(r.visibility?.isShared||!1),T(r.sharedWith||[]),j(r.sharedGroupId||null),D(r.sharedGroupOwnerId||null)}},[r,t]);const Y=()=>{const W={};if(d.title.trim()||(W.title="í• ì¼ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."),d.startDate&&d.dueDate)try{const le=new Date(`${d.startDate}T${d.startTime||"00:00"}`),ie=new Date(`${d.dueDate}T${d.dueTime||"23:59"}`);le>=ie&&(W.startDate="ì‹œì‘ì¼ì€ ë§ˆê°ì¼ë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤")}catch(le){console.error("ë‚ ì§œ ê²€ì¦ ì˜¤ë¥˜:",le),W.general="ë‚ ì§œ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”"}return g(W),Object.keys(W).length===0},V=async W=>{if(W.preventDefault(),!(!Y()||!r)){if(!R){alert("í¸ì§‘ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");return}f.current&&f.current.savePending();try{if(m){const le=r._templateId;le&&i(le,{title:d.title,description:d.description,priority:d.priority,type:d.type,tags:d.tags,exceptions:d.exceptions})}else{const le=!r.ownerId||r.ownerId===l?.uid,ie=le?p:r.visibility?.isPersonal??!0,be=le?v:r.visibility?.isShared??!0,ye={title:d.title.trim(),description:d.description.trim()||"",priority:d.priority,type:d.type,tags:d.tags,visibility:{isPersonal:ie,isShared:be},...le?{sharedWith:be?b:[],sharedGroupId:be?_:null,sharedGroupOwnerId:be?N:null}:{}};if(d.startDate)try{ye.startDate=new Date(d.startDate)}catch(ke){throw console.error("ìˆ˜ì •: ì‹œì‘ì¼ íŒŒì‹± ì˜¤ë¥˜:",ke),new Error("ì‹œì‘ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤")}else ye.startDate=null;if(d.startTime&&(ye.startTime=d.startTime),ye.showStartTime=d.showStartTime,ye.showDueTime=d.showDueTime,d.dueDate)try{const ke=d.dueDate,E=d.dueTime||"23:59",te=`${ke}T${E}:00`;ye.dueDate=new Date(te)}catch(ke){throw console.error("ìˆ˜ì •: ë§ˆê°ì¼ íŒŒì‹± ì˜¤ë¥˜:",ke),new Error(`ë§ˆê°ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ${d.dueDate} ${d.dueTime||""}`)}else ye.dueDate=null;d.type==="project"&&(ye.project=d.project),await n(r.id,ye)}e()}catch(le){console.error("í• ì¼ ìˆ˜ì • ì‹¤íŒ¨:",le),g({general:"í• ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}}},q=(W,le)=>{u(ie=>({...ie,[W]:le})),h[W]&&g(ie=>({...ie,[W]:""}))},z=()=>{u(W=>({...W,exceptions:[...W.exceptions,{type:"date",values:[]}]}))},de=W=>{u(le=>({...le,exceptions:le.exceptions.filter((ie,be)=>be!==W)}))},Te=(W,le,ie)=>{u(be=>({...be,exceptions:be.exceptions.map((ye,ke)=>ke===W?{...ye,[le]:ie}:ye)}))},we=(W,le)=>{u(ie=>({...ie,exceptions:ie.exceptions.map((be,ye)=>ye===W?{...be,values:le}:be)}))};if(!t||!r)return null;const fe=[{value:1,label:"ì›”ìš”ì¼"},{value:2,label:"í™”ìš”ì¼"},{value:3,label:"ìˆ˜ìš”ì¼"},{value:4,label:"ëª©ìš”ì¼"},{value:5,label:"ê¸ˆìš”ì¼"},{value:6,label:"í† ìš”ì¼"},{value:0,label:"ì¼ìš”ì¼"}];return Ur.createPortal(a.jsxs("div",{className:`fixed inset-0 z-50 flex items-center justify-center ${s?"":"p-4"}`,children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:e}),a.jsxs("div",{className:`relative z-10 bg-white dark:bg-gray-800 shadow-xl flex flex-col ${s?"w-full h-full fixed inset-0":"w-full max-w-2xl max-h-[90vh] rounded-lg"}`,children:[a.jsxs("div",{className:`flex-shrink-0 flex items-center justify-between border-b border-gray-200 dark:border-gray-700 ${s?"px-4 py-3":"p-6"}`,children:[a.jsxs("h2",{className:`font-semibold text-gray-900 dark:text-white ${s?"text-lg":"text-xl"}`,children:["í• ì¼ ìˆ˜ì • ",m?"(ë°˜ë³µ í• ì¼)":""]}),a.jsx("button",{onClick:e,className:`hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg ${s?"p-3":"p-2"}`,children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:V,className:"flex flex-col flex-1 min-h-0 overflow-hidden",children:[a.jsx("div",{className:`flex-1 overflow-y-auto min-h-0 ${s?"px-4 py-4":"p-6"}`,children:a.jsxs("div",{className:`${s?"space-y-4":"space-y-6"}`,children:[h.general&&a.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:h.general}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(zg,{className:"w-4 h-4 inline mr-1"}),"ì œëª© *"]}),a.jsx("input",{type:"text",value:d.title,onChange:W=>q("title",W.target.value),disabled:!R,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white disabled:opacity-60 disabled:cursor-not-allowed ${h.title?"border-red-500":"border-gray-300 dark:border-gray-600"}`,placeholder:"í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"}),h.title&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.title})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ì„¤ëª…"}),a.jsx("textarea",{value:d.description,onChange:W=>q("description",W.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"í• ì¼ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(Xl,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ìœ í˜•"]}),a.jsxs("select",{value:d.type,onChange:W=>q("type",W.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"simple",children:"ë‹¨ì¼ íƒœìŠ¤í¬"}),a.jsx("option",{value:"project",children:"í”„ë¡œì íŠ¸"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(ya,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ìš°ì„ ìˆœìœ„"]}),a.jsxs("select",{value:d.priority,onChange:W=>q("priority",W.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"low",children:"ë‚®ìŒ"}),a.jsx("option",{value:"medium",children:"ë³´í†µ"}),a.jsx("option",{value:"high",children:"ë†’ìŒ"}),a.jsx("option",{value:"urgent",children:"ê¸´ê¸‰"})]})]})]}),d.type==="project"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"í”„ë¡œì íŠ¸ êµ¬ë¶„"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"shortterm",checked:d.project==="shortterm",onChange:W=>q("project",W.target.value),className:"mr-2"}),"ìˆí…€ í”„ë¡œì íŠ¸"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"longterm",checked:d.project==="longterm",onChange:W=>q("project",W.target.value),className:"mr-2"}),"ë¡±í…€ í”„ë¡œì íŠ¸"]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(at,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ì‹œì‘ ë‚ ì§œ"]}),a.jsx("input",{type:"date",value:d.startDate,onChange:W=>q("startDate",W.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(gr,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ì‹œì‘ ì‹œê°„"]}),a.jsx("input",{type:"time",value:d.startTime,onChange:W=>q("startTime",W.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(at,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ë§ˆê° ë‚ ì§œ"]}),a.jsx("input",{type:"date",value:d.dueDate,onChange:W=>q("dueDate",W.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[a.jsx(gr,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),"ë§ˆê° ì‹œê°„"]}),a.jsx("input",{type:"time",value:d.dueTime,onChange:W=>q("dueTime",W.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),a.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:d.showStartTime,onChange:W=>q("showStartTime",W.target.checked),className:"mr-2"}),a.jsx(gr,{className:"w-4 h-4 inline mr-1"}),"ì‹œì‘ì‹œê°„ í‘œì‹œ"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:d.showDueTime,onChange:W=>q("showDueTime",W.target.checked),className:"mr-2"}),a.jsx(gr,{className:"w-4 h-4 inline mr-1"}),"ë§ˆê°ì‹œê°„ í‘œì‹œ"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"íƒœê·¸"}),a.jsx("input",{type:"text",value:d.tags.join(", "),onChange:W=>q("tags",W.target.value.split(",").map(le=>le.trim()).filter(le=>le)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"íƒœê·¸ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì—…ë¬´, ê°œì¸, ì¤‘ìš”)"})]}),d.type==="project"&&r&&!m&&a.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:a.jsx(Hc,{ref:f,todoId:r.id,subTasks:r.subTasks||[]})}),m&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a.jsx(Ql,{className:"w-4 h-4 inline mr-1"}),"ì˜ˆì™¸ ì„¤ì • (ë°˜ë³µì—ì„œ ì œì™¸í•  ì¡°ê±´)"]}),a.jsxs("button",{type:"button",onClick:z,className:"flex items-center gap-1 px-2 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/30",children:[a.jsx(gt,{className:"w-3 h-3"}),"ì˜ˆì™¸ ì¶”ê°€"]})]}),d.exceptions.map((W,le)=>a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("select",{value:W.type,onChange:ie=>Te(le,"type",ie.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"date",children:"íŠ¹ì • ë‚ ì§œ"}),a.jsx("option",{value:"weekday",children:"íŠ¹ì • ìš”ì¼"}),a.jsx("option",{value:"week",children:"íŠ¹ì • ì£¼"}),a.jsx("option",{value:"month",children:"íŠ¹ì • ë‹¬"})]}),a.jsx("button",{type:"button",onClick:()=>de(le),className:"ml-2 p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[W.type==="date"&&Array.from({length:31},(ie,be)=>be+1).map(ie=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:W.values.includes(ie),onChange:be=>{const ye=W.values,ke=be.target.checked?[...ye,ie]:ye.filter(E=>E!==ie);we(le,ke)},className:"text-sm"}),a.jsxs("span",{className:"text-xs",children:[ie,"ì¼"]})]},ie)),W.type==="weekday"&&fe.map(ie=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:W.values.includes(ie.value),onChange:be=>{const ye=W.values,ke=be.target.checked?[...ye,ie.value]:ye.filter(E=>E!==ie.value);we(le,ke)},className:"text-sm"}),a.jsx("span",{className:"text-xs",children:ie.label})]},ie.value)),W.type==="week"&&[1,2,3,4,-1].map(ie=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:W.values.includes(ie),onChange:be=>{const ye=W.values,ke=be.target.checked?[...ye,ie]:ye.filter(E=>E!==ie);we(le,ke)},className:"text-sm"}),a.jsx("span",{className:"text-xs",children:$i(ie)})]},ie)),W.type==="month"&&Array.from({length:12},(ie,be)=>be+1).map(ie=>a.jsxs("label",{className:"flex items-center space-x-1",children:[a.jsx("input",{type:"checkbox",checked:W.values.includes(ie),onChange:be=>{const ye=W.values,ke=be.target.checked?[...ye,ie]:ye.filter(E=>E!==ie);we(le,ke)},className:"text-sm"}),a.jsxs("span",{className:"text-xs",children:[ie,"ì›”"]})]},ie))]}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:W.values.length>0&&a.jsxs("span",{children:["ì„ íƒëœ ",W.type==="date"?"ë‚ ì§œ":W.type==="weekday"?"ìš”ì¼":W.type==="week"?"ì£¼ì°¨":"ì›”",": ",W.values.join(", ")]})})]},le))]}),!m&&(!r?.ownerId||r.ownerId===l?.uid)&&a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:c("sharing.settingsTitle")}),a.jsxs("div",{className:"flex space-x-4 mb-3",children:[a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:p,onChange:W=>w(W.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c("sharing.myTask")})]}),a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v,onChange:W=>k(W.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c("sharing.sharedTask")})]})]}),v&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:c("sharing.selectTarget")}),a.jsxs("select",{value:_||"",onChange:W=>{const le=W.target.value;if(le){const ie=$.find(be=>be.id===le);ie&&(T(ie.members||[]),ie.isReference?(j(ie.originalGroupId||null),D(ie.originalOwnerId||null)):(j(le),D(l?.uid||null)))}else T([]),j(null),D(null)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm",children:[a.jsx("option",{value:"",children:c("sharing.selectTargetPlaceholder")}),$.map(W=>a.jsxs("option",{value:W.id,children:["ğŸ‘¥ ",W.name," (",W.members.length,"ëª…)"]},W.id))]}),$.length===0&&a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["ğŸ’¡ ",c("sharing.noGroups")]})]}),b.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(W=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full text-xs text-gray-600 dark:text-gray-300",children:[a.jsx("span",{className:"w-4 h-4 rounded-full bg-gray-100 dark:bg-gray-600 flex items-center justify-center text-[10px] font-bold",children:W.displayName?.[0]||W.email[0].toUpperCase()}),W.displayName||W.email.split("@")[0]]},W.uid))})]})]})]})}),a.jsxs("div",{className:"flex-none flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 z-10 rounded-b-2xl",children:[B&&a.jsx("button",{type:"button",onClick:()=>{window.confirm("ì •ë§ë¡œ ì´ í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(o(r.id),e())},className:"px-5 py-2.5 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors mr-auto",children:"ì‚­ì œ"}),a.jsx("button",{type:"button",onClick:e,className:"px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",children:R?"ì·¨ì†Œ":"ë‹«ê¸°"}),R&&a.jsxs("button",{type:"submit",className:`flex items-center gap-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 ${s?"px-6 py-3":"px-4 py-2"}`,children:[a.jsx(ei,{className:"w-4 h-4"}),"ì €ì¥"]})]})]})]})]}),document.body)},r_=({currentDate:t,onDateChange:e,searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,onAddTodo:u,isMobile:h=!1})=>{const{t:g,i18n:m}=Xe(),x=m.language==="ko"?cn:rn,{currentTheme:f,isDark:p}=Lt(),w=!!f.bg,[v,k]=y.useState({}),[b,T]=y.useState(null),[_,j]=y.useState(!1),[N,D]=y.useState(!1),[$,C]=y.useState([]),[R,B]=y.useState(null),[Y,V]=y.useState([]),{getFilteredTodos:q,toggleTodo:z,deleteTodo:de}=ot(),{currentUser:Te}=wt(),{showVacationsInTodos:we,getVacationsForDate:fe,employees:W}=ln(),{getCustomHoliday:le}=sn(),ie=y.useMemo(()=>{const I=as(t,{weekStartsOn:0}),J=is(t,{weekStartsOn:0});return mm({start:I,end:J})},[t]),be=y.useMemo(()=>Wx(t,{weekStartsOn:0}),[t]);y.useEffect(()=>{(()=>{const J={};ie.forEach(ce=>{const O=oc(ce),G=le(ce);G?J[ce.toISOString().split("T")[0]]={date:ce.toISOString().split("T")[0],name:G.name,isHoliday:!0,type:"custom"}:O&&(J[ce.toISOString().split("T")[0]]=O)}),k(J)})()},[ie]);const ye=y.useMemo(()=>q({searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,includeCompleted:!0}),[r,s,n,i,o,l,c,d,q]),ke=I=>{const J=ye.filter(O=>{if(O.completed&&O.completedAt)return Vt(O.completedAt,I);if(!O.completed){const G=O.startDate?new Date(O.startDate):null,M=O.dueDate?new Date(O.dueDate):null;if(G&&M){const se=new Date(I);return G.setHours(0,0,0,0),M.setHours(0,0,0,0),se.setHours(0,0,0,0),se.getTime()>=G.getTime()&&se.getTime()<=M.getTime()}if(G&&!M){const se=new Date(I);G.setHours(0,0,0,0),se.setHours(0,0,0,0);const ue=new Date;return ue.setHours(0,0,0,0),se.getTime()===G.getTime()?!0:se.getTime()>G.getTime()&&se.getTime()<=ue.getTime()?!O.completed:!1}return!G&&M?Vt(M,I):!1}return!1}),ce={urgent:0,high:1,medium:2,low:3};return J.sort((O,G)=>{const M=ce[O.priority]-ce[G.priority];if(M!==0)return M;const se=O.order||0,ue=G.order||0;return se!==ue?se-ue:new Date(O.createdAt).getTime()-new Date(G.createdAt).getTime()})},E=()=>{e(Rn(t))},te=()=>{e(fm(t,1))},Q=()=>{e(new Date)},H=Ji({onSwipeLeft:te,onSwipeRight:E},{minSwipeDistance:60});return a.jsxs("div",{className:"space-y-4",...h?{onTouchStart:H.onTouchStart,onTouchMove:H.onTouchMove,onTouchEnd:H.onTouchEnd}:{},children:[a.jsxs("div",{className:`flex items-center ${h?"flex-col gap-2":"justify-between"}`,children:[a.jsxs("div",{className:`flex items-center ${h?"w-full justify-between":"gap-4"}`,children:[a.jsxs("h2",{className:`${h?"text-base":"text-xl"} font-semibold text-gray-900 dark:text-white ${h?"flex-1 text-center min-w-0":""}`,children:[qe(t,m.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:x})," ",be,g("calendar.week")]}),a.jsxs("div",{className:`flex items-center ${h?"gap-1":"gap-2"}`,children:[a.jsx("button",{onClick:E,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:g("calendar.prevWeek"),children:a.jsx(Jl,{className:`${h?"w-3 h-3":"w-4 h-4"}`})}),a.jsx("button",{onClick:Q,className:`${h?"px-2 py-1 text-xs":"px-3 py-1 text-sm"} bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/40`,children:g("calendar.thisWeek")}),a.jsx("button",{onClick:te,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:g("calendar.nextWeek"),children:a.jsx(gs,{className:`${h?"w-3 h-3":"w-4 h-4"}`})})]})]}),!h&&a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[qe(ie[0],m.language==="ko"?"Mì›” dì¼":"MMM d",{locale:x})," - ",qe(ie[6],m.language==="ko"?"Mì›” dì¼":"MMM d",{locale:x})]})]}),a.jsx("div",{className:`grid grid-cols-7 rounded-lg border overflow-hidden ${w?"glass-card backdrop-blur-none border-white/20":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}`,style:w?{backgroundColor:`rgba(${p?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:ie.map((I,J)=>{const ce=ke(I);ce.filter(re=>re.completed).length,ce.length;const O=I.toISOString().split("T")[0],G=v[O],M=Br(I),se=tl(I),ge=Hr(Te?.email)&&we?fe(I):[];return a.jsxs("div",{className:"border-r border-gray-200 dark:border-gray-700 last:border-r-0 relative flex flex-col",children:[a.jsxs("div",{className:`${h?"p-1":"p-2"} border-b border-gray-200 dark:border-gray-700 text-center cursor-pointer hover:bg-opacity-80 transition-colors ${se?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":G||M?"bg-red-50 dark:bg-red-900/20":"bg-gray-50 dark:bg-gray-700/50"}`,onClick:()=>{C(ce),V(ge),B(I),D(!0)},children:[a.jsx("div",{className:`text-xs font-medium mb-1 ${G||M?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"}`,children:qe(I,"E",{locale:x})}),a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:`text-lg font-semibold ${se?"text-blue-700 dark:text-blue-300":G||M?"text-red-700 dark:text-red-300":"text-gray-900 dark:text-white"}`,children:qe(I,"d")}),G&&!h&&a.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 font-medium ml-1",children:G.name})]})]}),a.jsxs("div",{className:`${h?"px-0.5 py-1 min-h-[150px] space-y-0.5":"p-2 min-h-[200px] space-y-1"} flex-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors`,onClick:re=>{C(ce),V(ge),B(I),D(!0)},children:[ge.slice(0,Math.max(0,8-ce.length)).map(re=>{const Ie=W.find(K=>K.id===re.employeeId);return a.jsx("div",{className:`${h?"p-1 text-[9px]":"p-2 text-xs"} rounded border cursor-pointer hover:shadow-md transition-all ${re.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30":re.type==="ì˜¤ì „"||re.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30":re.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30":re.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800 hover:bg-yellow-100 dark:hover:bg-yellow-900/30"}`,title:Ie?`${Ie.name} - ${re.type}`:`ì§ì› ${re.employeeId} - ${re.type}`,children:a.jsx("div",{className:"truncate",children:h?`${re.type}`:Ie?`${Ie.name} ${re.type}`:`ì§ì›${re.employeeId} ${re.type}`})},`vacation-${re.id}`)}),ce.slice(0,Math.max(0,8-ge.length)).map(re=>a.jsxs("div",{className:`group relative ${h?"p-1":"p-2"} rounded ${h?"text-[10px]":"text-xs"} border cursor-pointer hover:shadow-md transition-all ${re.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":re.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":re.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800 hover:bg-orange-100 dark:hover:bg-orange-900/30":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30"}`,onClick:Ie=>{Ie.stopPropagation(),T(re),j(!0)},children:[a.jsx("div",{className:`font-medium truncate ${h?"text-[10px]":"text-xs"} ${re.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:re.title}),a.jsxs("div",{className:`${h?"text-[9px]":"text-xs"} text-gray-500 dark:text-gray-400 ${h?"mt-0.5":"mt-1"}`,children:[re.showStartTime&&re.startTime&&a.jsxs("span",{children:[g("calendar.start"),": ",re.startTime]}),re.showStartTime&&re.startTime&&re.showDueTime&&re.dueDate&&new Date(re.dueDate).getHours()!==23&&new Date(re.dueDate).getMinutes()!==59&&a.jsx("span",{children:" | "}),re.showDueTime&&re.dueDate&&(()=>{const Ie=new Date(re.dueDate);return Ie.getHours()===23&&Ie.getMinutes()===59?null:a.jsxs("span",{children:[g("calendar.due"),": ",Ie.toTimeString().slice(0,5)]})})()]}),a.jsxs("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[a.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),z(re.id)},className:"p-1.5 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-700",title:re.completed?g("calendar.completedCancel"):g("calendar.complete"),children:a.jsx("div",{className:`w-3 h-3 rounded-full ${re.completed?"bg-green-600":"border border-gray-400"}`})}),a.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),confirm(g("calendar.deleteConfirm"))&&de(re.id)},className:"p-1.5 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-900/30",title:g("common.delete"),children:a.jsx(Ut,{className:"w-3 h-3 text-red-600"})})]})]},re.id)),ce.length+ge.length>8&&a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center py-1 cursor-pointer hover:text-blue-600",onClick:re=>{re.stopPropagation(),C(ce),V(ge),B(I),D(!0)},children:["+",ce.length+ge.length-8,g("calendar.more")]}),a.jsx("button",{onClick:re=>{re.stopPropagation(),u(I)},className:`w-full ${h?"h-6":"h-8"} border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center text-gray-400 hover:border-blue-400 hover:text-blue-400 transition-colors`,title:g("modal.addTodo.title"),children:a.jsx(gt,{className:`${h?"w-2.5 h-2.5":"w-3 h-3"}`})})]}),G&&h&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0",children:a.jsx("div",{className:"text-[9px] text-red-600 dark:text-red-400 font-medium text-center bg-red-50 dark:bg-red-900/20 py-0.5 leading-tight",children:G.name})})]},J)})}),ie.some(I=>{const J=ke(I),O=Hr(Te?.email)&&we?fe(I):[];return J.length>0||O.length>0})&&a.jsxs("div",{className:"mt-8",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:g("calendar.detailedInfo")}),a.jsx("div",{className:"space-y-2",children:ie.map(I=>{const J=ke(I),O=Hr(Te?.email)&&we?fe(I):[];return J.length===0&&O.length===0?null:a.jsxs("div",{children:[a.jsxs("h4",{className:"text-md font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[a.jsx(at,{className:"w-4 h-4"}),qe(I,m.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:x}),tl(I)&&a.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded",children:g("calendar.today")})]}),a.jsxs("div",{className:"space-y-2",children:[O.map(G=>{const M=W.find(se=>se.id===G.employeeId);return a.jsx("div",{className:`p-3 rounded-lg border cursor-pointer hover:shadow-md transition-all ${G.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":G.type==="ì˜¤ì „"||G.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":G.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":G.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[M&&a.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:M.color},children:M.name.charAt(0)}),a.jsx("div",{className:"flex-1 truncate",children:a.jsx("div",{className:`font-medium text-gray-900 dark:text-white truncate ${h?"text-sm":"text-base"}`,children:M?M.name:`ì§ì› ${G.employeeId}`})}),a.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${G.type==="ì—°ì°¨"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":G.type==="ì˜¤ì „"||G.type==="ì˜¤í›„"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":G.type==="íŠ¹ë³„"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":G.type==="ë³‘ê°€"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:G.type})]})},`vacation-${G.id}`)}),J.map(G=>a.jsx(Wr,{todo:G},G.id))]})]},I.toISOString())})})]}),b&&a.jsx(Gc,{isOpen:_,onClose:()=>{j(!1),T(null)},todo:b,isMobile:h}),N&&R&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>D(!1),children:a.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-xl ${h?"w-[90vw] max-h-[80vh]":"w-[500px] max-h-[600px]"} overflow-hidden`,onClick:I=>I.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[qe(R,m.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:x}),a.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",$.length+Y.length,"ê°œ)"]})]}),a.jsx("button",{onClick:()=>D(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"p-4 overflow-y-auto max-h-[500px]",children:$.length>0||Y.length>0?a.jsxs("div",{className:"space-y-3",children:[Y.map(I=>{const J=W.find(ce=>ce.id===I.employeeId);return a.jsx("div",{className:`p-2 rounded border ${I.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":I.type==="ì˜¤ì „"||I.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":I.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":I.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[J&&a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:J.color},children:J.name.charAt(0)}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:J?J.name:`ì§ì› ${I.employeeId}`})}),a.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${I.type==="ì—°ì°¨"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":I.type==="ì˜¤ì „"||I.type==="ì˜¤í›„"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":I.type==="íŠ¹ë³„"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":I.type==="ë³‘ê°€"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:I.type})]})},`vacation-${I.id}`)}),$.map(I=>a.jsx("div",{className:`p-2 rounded border cursor-pointer hover:shadow-md transition-all ${I.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":I.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":I.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,onClick:()=>{T(I),j(!0),D(!1)},children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:`font-medium truncate ${I.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:I.title}),(I.showStartTime&&I.startTime||I.showDueTime&&I.dueDate)&&a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[I.showStartTime&&I.startTime&&a.jsxs("span",{children:[g("calendar.start"),": ",I.startTime]}),I.showStartTime&&I.startTime&&I.showDueTime&&I.dueDate&&(()=>{const J=new Date(I.dueDate);return J.getHours()===23&&J.getMinutes()===59?null:a.jsx("span",{children:" | "})})(),I.showDueTime&&I.dueDate&&(()=>{const J=new Date(I.dueDate);return J.getHours()===23&&J.getMinutes()===59?null:a.jsxs("span",{children:[g("calendar.due"),": ",J.toTimeString().slice(0,5)]})})()]})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[I.type==="project"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${I.project==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400"}`,children:I.project==="longterm"?g("projectTemplate.longterm")||"Long-term":g("projectTemplate.shortterm")||"Short-term"}),I.priority&&I.priority!=="medium"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${I.priority==="urgent"?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":I.priority==="high"?"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400":"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}`,children:I.priority==="urgent"?g("modal.addTodo.urgent"):I.priority==="high"?g("modal.addTodo.high"):g("modal.addTodo.low")}),a.jsx("button",{onClick:J=>{J.stopPropagation(),z(I.id)},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-600 border border-gray-200 dark:border-gray-600",title:I.completed?g("calendar.completedCancel"):g("calendar.complete"),children:a.jsx("div",{className:`w-3 h-3 rounded-full ${I.completed?"bg-green-600":"border border-gray-400"}`})}),a.jsx("button",{onClick:J=>{J.stopPropagation(),confirm(g("calendar.deleteConfirm"))&&(de(I.id),$.filter(ce=>ce.id!==I.id))},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-800 border border-gray-200 dark:border-gray-600",title:g("common.delete"),children:a.jsx(Ut,{className:"w-3 h-3 text-red-600"})})]})]})},I.id))]}):a.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:g("calendar.noTasks")})}),a.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[a.jsxs("button",{onClick:()=>{R&&(u(R),D(!1))},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",title:g("modal.addTodo.title"),children:[a.jsx(gt,{className:"w-4 h-4"}),g("common.addTodo")]}),a.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:g("calendar.close")})]})]})})]})},s_=({currentDate:t,onDateChange:e,searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,onAddTodo:u,isMobile:h=!1})=>{const{t:g,i18n:m}=Xe(),{currentTheme:x,isDark:f}=Lt(),p=!!x.bg,w=m.language==="ko"?cn:rn,[v,k]=y.useState({}),[b,T]=y.useState(null),[_,j]=y.useState(!1),[N,D]=y.useState(!1),[$,C]=y.useState([]),[R,B]=y.useState(null),[Y,V]=y.useState([]),{getFilteredTodos:q,toggleTodo:z,deleteTodo:de}=ot(),{currentUser:Te}=wt(),{showVacationsInTodos:we,getVacationsForDate:fe,employees:W}=ln(),{getCustomHoliday:le}=sn(),ie=Ha(t),be=rl(ie),ye=as(ie,{weekStartsOn:0}),ke=is(be,{weekStartsOn:0}),E=y.useMemo(()=>mm({start:ye,end:ke}),[ye,ke]);y.useEffect(()=>{(()=>{const se={};E.forEach(ue=>{const ge=oc(ue),re=le(ue);re?se[ue.toISOString().split("T")[0]]={date:ue.toISOString().split("T")[0],name:re.name,isHoliday:!0,type:"custom"}:ge&&(se[ue.toISOString().split("T")[0]]=ge)}),k(se)})()},[E]);const te=y.useMemo(()=>q({searchTerm:r,priorityFilter:s,typeFilter:n,projectFilter:i,tagFilter:o,completionDateFilter:l,sharingFilter:c,sharingFilterState:d,includeCompleted:!0}),[r,s,n,i,o,l,c,d,q]),Q=M=>{const se=te.filter(ge=>{if(ge.completed&&ge.completedAt)return Vt(ge.completedAt,M);if(!ge.completed){const re=ge.startDate?new Date(ge.startDate):null,Ie=ge.dueDate?new Date(ge.dueDate):null;if(re&&Ie){const K=new Date(M);return re.setHours(0,0,0,0),Ie.setHours(0,0,0,0),K.setHours(0,0,0,0),K.getTime()>=re.getTime()&&K.getTime()<=Ie.getTime()}if(re&&!Ie){const K=new Date(M);re.setHours(0,0,0,0),K.setHours(0,0,0,0);const pe=new Date;return pe.setHours(0,0,0,0),K.getTime()===re.getTime()?!0:K.getTime()>re.getTime()&&K.getTime()<=pe.getTime()?!ge.completed:!1}return!re&&Ie?Vt(Ie,M):!1}return!1}),ue={urgent:0,high:1,medium:2,low:3};return se.sort((ge,re)=>{const Ie=ue[ge.priority]-ue[re.priority];if(Ie!==0)return Ie;const K=ge.order||0,pe=re.order||0;return K!==pe?K-pe:new Date(ge.createdAt).getTime()-new Date(re.createdAt).getTime()})},H=()=>{e(si(t))},I=()=>{e(pm(t,1))},J=()=>{e(new Date)},ce=Ji({onSwipeLeft:I,onSwipeRight:H},{minSwipeDistance:60}),O=p?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",G=p?{backgroundColor:`rgba(${f?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{};return a.jsxs("div",{className:"space-y-4",...h?{onTouchStart:ce.onTouchStart,onTouchMove:ce.onTouchMove,onTouchEnd:ce.onTouchEnd}:{},children:[a.jsx("div",{className:`flex items-center ${h?"flex-col gap-2":"justify-between"}`,children:a.jsxs("div",{className:`flex items-center ${h?"w-full justify-between":"gap-4"}`,children:[a.jsx("h2",{className:`${h?"text-base":"text-xl"} font-semibold text-gray-900 dark:text-white ${h?"flex-1 text-center min-w-0":""}`,children:qe(t,m.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:w})}),a.jsxs("div",{className:`flex items-center ${h?"gap-1":"gap-2"}`,children:[a.jsx("button",{onClick:H,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:"ì´ì „ ë‹¬",children:a.jsx(Jl,{className:`${h?"w-3 h-3":"w-4 h-4"}`})}),a.jsx("button",{onClick:J,className:`${h?"px-2 py-1 text-xs":"px-3 py-1 text-sm"} bg-primary-100 text-primary-700 dark:bg-primary-900/20 dark:text-primary-300 rounded-lg hover:bg-primary-200 dark:hover:bg-primary-900/40`,children:g("calendar.thisMonth",{defaultValue:"This Month"})}),a.jsx("button",{onClick:I,className:`${h?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:"ë‹¤ìŒ ë‹¬",children:a.jsx(gs,{className:`${h?"w-3 h-3":"w-4 h-4"}`})})]})]})}),a.jsxs("div",{className:`${O} rounded-lg border overflow-hidden`,style:G,children:[a.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700",children:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].map((M,se)=>a.jsx("div",{className:`text-center py-2 text-sm font-medium ${se===0?"text-red-600 dark:text-red-400":se===6?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"}`,children:g(`days.${M}`)},M))}),a.jsx("div",{className:"grid grid-cols-7",children:E.map((M,se)=>{const ue=Q(M),ge=M.toISOString().split("T")[0],re=v[ge],Ie=Br(M),K=tl(M),pe=Vx(M,t),X=Hr(Te?.email)&&we?fe(M):[];return a.jsxs("div",{className:`min-h-[100px] border-b border-r border-gray-200 dark:border-gray-700 relative ${pe?"":"bg-gray-50/50 dark:bg-gray-900/20"} ${se%7===6?"border-r-0":""} hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors cursor-pointer`,onClick:()=>{C(ue),V(X),B(M),D(!0)},children:[a.jsxs("div",{className:`p-1 text-right ${pe?"":"opacity-30"}`,children:[a.jsx("span",{className:`inline-block w-6 h-6 text-center leading-6 rounded-full text-sm ${K?"bg-blue-600 text-white":re||Ie&&ri(M)===0?"text-red-600 dark:text-red-400 font-medium":Ie&&ri(M)===6?"text-blue-600 dark:text-blue-400 font-medium":"text-gray-700 dark:text-gray-300"}`,children:qe(M,"d")}),re&&a.jsx("div",{className:"text-[10px] text-red-600 dark:text-red-400 font-medium truncate px-1",children:re.name})]}),a.jsxs("div",{className:"px-1 pb-1 space-y-0.5",children:[X.slice(0,3).map(ve=>{const Be=W.find(S=>S.id===ve.employeeId);return a.jsxs("div",{className:`px-1.5 py-1 text-[10px] rounded-md truncate border shadow-sm transition-all hover:scale-[1.02] ${ve.type==="ì—°ì°¨"?"bg-green-50/90 text-green-700 border-green-200/60 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800/40":ve.type==="ì˜¤ì „"||ve.type==="ì˜¤í›„"?"bg-blue-50/90 text-blue-700 border-blue-200/60 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800/40":ve.type==="íŠ¹ë³„"?"bg-purple-50/90 text-purple-700 border-purple-200/60 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-800/40":ve.type==="ë³‘ê°€"?"bg-red-50/90 text-red-700 border-red-200/60 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800/40":"bg-yellow-50/90 text-yellow-700 border-yellow-200/60 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800/40"}`,title:Be?`${Be.name} - ${ve.type}`:`ì§ì› ${ve.employeeId} - ${ve.type}`,children:[Be?Be.name:`ì§ì›${ve.employeeId}`," ",ve.type]},`vacation-${ve.id}`)}),ue.slice(0,Math.max(0,3-X.length)).map(ve=>a.jsx("div",{className:`px-1.5 py-1 text-[10px] rounded-md truncate cursor-pointer border shadow-sm transition-all hover:scale-[1.02] ${ve.completed?"bg-gray-100/80 text-gray-400 border-gray-200/60 line-through dark:bg-gray-700/50 dark:text-gray-500 dark:border-gray-600/30":ve.priority==="urgent"?"bg-red-50/90 text-red-700 border-red-200/60 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800/40":ve.priority==="high"?"bg-orange-50/90 text-orange-700 border-orange-200/60 dark:bg-orange-900/30 dark:text-orange-300 dark:border-orange-800/40":"bg-primary-50/90 text-primary-700 border-primary-200/60 dark:bg-primary-900/30 dark:text-primary-300 dark:border-primary-800/40"}`,onClick:Be=>{Be.stopPropagation(),T(ve),j(!0)},children:ve.title},ve.id)),ue.length+X.length>3&&a.jsxs("div",{className:"text-[10px] text-gray-500 dark:text-gray-400 text-center",children:["+",ue.length+X.length-3,"ê°œ"]})]})]},M.toISOString())})})]}),b&&a.jsx(Gc,{isOpen:_,onClose:()=>{j(!1),T(null)},todo:b,isMobile:h}),N&&R&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>D(!1),children:a.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-xl ${h?"w-[90vw] max-h-[80vh]":"w-[500px] max-h-[600px]"} overflow-hidden`,onClick:M=>M.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[qe(R,m.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:w}),a.jsxs("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",$.length+Y.length,"ê°œ)"]})]}),a.jsx("button",{onClick:()=>D(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"p-4 overflow-y-auto max-h-[500px]",children:$.length>0||Y.length>0?a.jsxs("div",{className:"space-y-3",children:[Y.map(M=>{const se=W.find(ue=>ue.id===M.employeeId);return a.jsx("div",{className:`p-2 rounded border ${M.type==="ì—°ì°¨"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":M.type==="ì˜¤ì „"||M.type==="ì˜¤í›„"?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":M.type==="íŠ¹ë³„"?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":M.type==="ë³‘ê°€"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[se&&a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:se.color},children:se.name.charAt(0)}),a.jsx("div",{className:"flex-1",children:a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:se?se.name:`ì§ì› ${M.employeeId}`})}),a.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${M.type==="ì—°ì°¨"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":M.type==="ì˜¤ì „"||M.type==="ì˜¤í›„"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":M.type==="íŠ¹ë³„"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":M.type==="ë³‘ê°€"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:M.type})]})},`vacation-${M.id}`)}),$.map(M=>a.jsx("div",{className:`p-2 rounded border cursor-pointer hover:shadow-md transition-all ${M.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":M.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":M.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,onClick:()=>{T(M),j(!0),D(!1)},children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:`font-medium truncate ${M.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:M.title}),(M.showStartTime&&M.startTime||M.showDueTime&&M.dueDate)&&a.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[M.showStartTime&&M.startTime&&a.jsxs("span",{children:[g("calendar.start"),": ",M.startTime]}),M.showStartTime&&M.startTime&&M.showDueTime&&M.dueDate&&(()=>{const se=new Date(M.dueDate);return se.getHours()===23&&se.getMinutes()===59?null:a.jsx("span",{children:" | "})})(),M.showDueTime&&M.dueDate&&(()=>{const se=new Date(M.dueDate);return se.getHours()===23&&se.getMinutes()===59?null:a.jsxs("span",{children:[g("calendar.due"),": ",se.toTimeString().slice(0,5)]})})()]})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[M.type==="project"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${M.project==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400"}`,children:M.project==="longterm"?g("projectTemplate.longterm")||"Long-term":g("projectTemplate.shortterm")||"Short-term"}),M.priority&&M.priority!=="medium"&&a.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${M.priority==="urgent"?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":M.priority==="high"?"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400":"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}`,children:M.priority==="urgent"?g("modal.addTodo.urgent"):M.priority==="high"?g("modal.addTodo.high"):g("modal.addTodo.low")}),a.jsx("button",{onClick:se=>{se.stopPropagation(),z(M.id)},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-600 border border-gray-200 dark:border-gray-600",title:M.completed?g("calendar.completedCancel"):g("calendar.complete"),children:a.jsx("div",{className:`w-3 h-3 rounded-full ${M.completed?"bg-green-600":"border border-gray-400"}`})}),a.jsx("button",{onClick:se=>{se.stopPropagation(),confirm(g("calendar.deleteConfirm"))&&(de(M.id),$.filter(ue=>ue.id!==M.id))},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-800 border border-gray-200 dark:border-gray-600",title:g("common.delete"),children:a.jsx(Ut,{className:"w-3 h-3 text-red-600"})})]})]})},M.id))]}):a.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:g("calendar.noTasks")})}),a.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[a.jsxs("button",{onClick:()=>{R&&(u(R),D(!1))},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",title:g("modal.addTodo.title"),children:[a.jsx(gt,{className:"w-4 h-4"}),g("common.addTodo")]}),a.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:g("calendar.close")})]})]})})]})};function n_(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return y.useMemo(()=>s=>{e.forEach(n=>n(s))},e)}const Zi=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function dn(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function zc(t){return"nodeType"in t}function It(t){var e,r;return t?dn(t)?t:zc(t)&&(e=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?e:window:window}function Kc(t){const{Document:e}=It(t);return t instanceof e}function ja(t){return dn(t)?!1:t instanceof It(t).HTMLElement}function Ep(t){return t instanceof It(t).SVGElement}function un(t){return t?dn(t)?t.document:zc(t)?Kc(t)?t:ja(t)||Ep(t)?t.ownerDocument:document:document:document}const ir=Zi?y.useLayoutEffect:y.useEffect;function eo(t){const e=y.useRef(t);return ir(()=>{e.current=t}),y.useCallback(function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return e.current==null?void 0:e.current(...s)},[])}function a_(){const t=y.useRef(null),e=y.useCallback((s,n)=>{t.current=setInterval(s,n)},[]),r=y.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,r]}function ca(t,e){e===void 0&&(e=[t]);const r=y.useRef(t);return ir(()=>{r.current!==t&&(r.current=t)},e),r}function _a(t,e){const r=y.useRef();return y.useMemo(()=>{const s=t(r.current);return r.current=s,s},[...e])}function Si(t){const e=eo(t),r=y.useRef(null),s=y.useCallback(n=>{n!==r.current&&e?.(n,r.current),r.current=n},[]);return[r,s]}function ji(t){const e=y.useRef();return y.useEffect(()=>{e.current=t},[t]),e.current}let Io={};function Da(t,e){return y.useMemo(()=>{if(e)return e;const r=Io[t]==null?0:Io[t]+1;return Io[t]=r,t+"-"+r},[t,e])}function Ip(t){return function(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];return s.reduce((i,o)=>{const l=Object.entries(o);for(const[c,d]of l){const u=i[c];u!=null&&(i[c]=u+t*d)}return i},{...e})}}const zs=Ip(1),_i=Ip(-1);function i_(t){return"clientX"in t&&"clientY"in t}function to(t){if(!t)return!1;const{KeyboardEvent:e}=It(t.target);return e&&t instanceof e}function o_(t){if(!t)return!1;const{TouchEvent:e}=It(t.target);return e&&t instanceof e}function Di(t){if(o_(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:r}=t.touches[0];return{x:e,y:r}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:r}=t.changedTouches[0];return{x:e,y:r}}}return i_(t)?{x:t.clientX,y:t.clientY}:null}const Qr=Object.freeze({Translate:{toString(t){if(!t)return;const{x:e,y:r}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:e,scaleY:r}=t;return"scaleX("+e+") scaleY("+r+")"}},Transform:{toString(t){if(t)return[Qr.Translate.toString(t),Qr.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:r,easing:s}=t;return e+" "+r+"ms "+s}}}),ch="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function l_(t){return t.matches(ch)?t:t.querySelector(ch)}const c_={display:"none"};function d_(t){let{id:e,value:r}=t;return Ze.createElement("div",{id:e,style:c_},r)}function u_(t){let{id:e,announcement:r,ariaLiveType:s="assertive"}=t;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ze.createElement("div",{id:e,style:n,role:"status","aria-live":s,"aria-atomic":!0},r)}function h_(){const[t,e]=y.useState("");return{announce:y.useCallback(s=>{s!=null&&e(s)},[]),announcement:t}}const Ap=y.createContext(null);function g_(t){const e=y.useContext(Ap);y.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function m_(){const[t]=y.useState(()=>new Set),e=y.useCallback(s=>(t.add(s),()=>t.delete(s)),[t]);return[y.useCallback(s=>{let{type:n,event:i}=s;t.forEach(o=>{var l;return(l=o[n])==null?void 0:l.call(o,i)})},[t]),e]}const f_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},p_={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was moved over droppable area "+r.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was dropped over droppable area "+r.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function y_(t){let{announcements:e=p_,container:r,hiddenTextDescribedById:s,screenReaderInstructions:n=f_}=t;const{announce:i,announcement:o}=h_(),l=Da("DndLiveRegion"),[c,d]=y.useState(!1);if(y.useEffect(()=>{d(!0)},[]),g_(y.useMemo(()=>({onDragStart(h){let{active:g}=h;i(e.onDragStart({active:g}))},onDragMove(h){let{active:g,over:m}=h;e.onDragMove&&i(e.onDragMove({active:g,over:m}))},onDragOver(h){let{active:g,over:m}=h;i(e.onDragOver({active:g,over:m}))},onDragEnd(h){let{active:g,over:m}=h;i(e.onDragEnd({active:g,over:m}))},onDragCancel(h){let{active:g,over:m}=h;i(e.onDragCancel({active:g,over:m}))}}),[i,e])),!c)return null;const u=Ze.createElement(Ze.Fragment,null,Ze.createElement(d_,{id:s,value:n.draggable}),Ze.createElement(u_,{id:l,announcement:o}));return r?Ur.createPortal(u,r):u}var dt;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(dt||(dt={}));function Ci(){}function dh(t,e){return y.useMemo(()=>({sensor:t,options:e??{}}),[t,e])}function x_(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return y.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const or=Object.freeze({x:0,y:0});function b_(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function v_(t,e){const r=Di(t);if(!r)return"0 0";const s={x:(r.x-e.left)/e.width*100,y:(r.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function w_(t,e){let{data:{value:r}}=t,{data:{value:s}}=e;return r-s}function k_(t,e){let{data:{value:r}}=t,{data:{value:s}}=e;return s-r}function uh(t){let{left:e,top:r,height:s,width:n}=t;return[{x:e,y:r},{x:e+n,y:r},{x:e,y:r+s},{x:e+n,y:r+s}]}function T_(t,e){if(!t||t.length===0)return null;const[r]=t;return r[e]}const N_=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:s}=t;const n=uh(e),i=[];for(const o of s){const{id:l}=o,c=r.get(l);if(c){const d=uh(c),u=n.reduce((g,m,x)=>g+b_(d[x],m),0),h=Number((u/4).toFixed(4));i.push({id:l,data:{droppableContainer:o,value:h}})}}return i.sort(w_)};function S_(t,e){const r=Math.max(e.top,t.top),s=Math.max(e.left,t.left),n=Math.min(e.left+e.width,t.left+t.width),i=Math.min(e.top+e.height,t.top+t.height),o=n-s,l=i-r;if(s<n&&r<i){const c=e.width*e.height,d=t.width*t.height,u=o*l,h=u/(c+d-u);return Number(h.toFixed(4))}return 0}const j_=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:s}=t;const n=[];for(const i of s){const{id:o}=i,l=r.get(o);if(l){const c=S_(l,e);c>0&&n.push({id:o,data:{droppableContainer:i,value:c}})}}return n.sort(k_)};function __(t,e,r){return{...t,scaleX:e&&r?e.width/r.width:1,scaleY:e&&r?e.height/r.height:1}}function Rp(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:or}function D_(t){return function(r){for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];return n.reduce((o,l)=>({...o,top:o.top+t*l.y,bottom:o.bottom+t*l.y,left:o.left+t*l.x,right:o.right+t*l.x}),{...r})}}const C_=D_(1);function Pp(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function E_(t,e,r){const s=Pp(e);if(!s)return t;const{scaleX:n,scaleY:i,x:o,y:l}=s,c=t.left-o-(1-n)*parseFloat(r),d=t.top-l-(1-i)*parseFloat(r.slice(r.indexOf(" ")+1)),u=n?t.width/n:t.width,h=i?t.height/i:t.height;return{width:u,height:h,top:d,right:c+u,bottom:d+h,left:c}}const I_={ignoreTransform:!1};function hn(t,e){e===void 0&&(e=I_);let r=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:d,transformOrigin:u}=It(t).getComputedStyle(t);d&&(r=E_(r,d,u))}const{top:s,left:n,width:i,height:o,bottom:l,right:c}=r;return{top:s,left:n,width:i,height:o,bottom:l,right:c}}function hh(t){return hn(t,{ignoreTransform:!0})}function A_(t){const e=t.innerWidth,r=t.innerHeight;return{top:0,left:0,right:e,bottom:r,width:e,height:r}}function R_(t,e){return e===void 0&&(e=It(t).getComputedStyle(t)),e.position==="fixed"}function P_(t,e){e===void 0&&(e=It(t).getComputedStyle(t));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const i=e[n];return typeof i=="string"?r.test(i):!1})}function Yc(t,e){const r=[];function s(n){if(e!=null&&r.length>=e||!n)return r;if(Kc(n)&&n.scrollingElement!=null&&!r.includes(n.scrollingElement))return r.push(n.scrollingElement),r;if(!ja(n)||Ep(n)||r.includes(n))return r;const i=It(t).getComputedStyle(n);return n!==t&&P_(n,i)&&r.push(n),R_(n,i)?r:s(n.parentNode)}return t?s(t):r}function Mp(t){const[e]=Yc(t,1);return e??null}function Ao(t){return!Zi||!t?null:dn(t)?t:zc(t)?Kc(t)||t===un(t).scrollingElement?window:ja(t)?t:null:null}function Op(t){return dn(t)?t.scrollX:t.scrollLeft}function Lp(t){return dn(t)?t.scrollY:t.scrollTop}function Nl(t){return{x:Op(t),y:Lp(t)}}var yt;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(yt||(yt={}));function $p(t){return!Zi||!t?!1:t===document.scrollingElement}function Fp(t){const e={x:0,y:0},r=$p(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},s={x:t.scrollWidth-r.width,y:t.scrollHeight-r.height},n=t.scrollTop<=e.y,i=t.scrollLeft<=e.x,o=t.scrollTop>=s.y,l=t.scrollLeft>=s.x;return{isTop:n,isLeft:i,isBottom:o,isRight:l,maxScroll:s,minScroll:e}}const M_={x:.2,y:.2};function O_(t,e,r,s,n){let{top:i,left:o,right:l,bottom:c}=r;s===void 0&&(s=10),n===void 0&&(n=M_);const{isTop:d,isBottom:u,isLeft:h,isRight:g}=Fp(t),m={x:0,y:0},x={x:0,y:0},f={height:e.height*n.y,width:e.width*n.x};return!d&&i<=e.top+f.height?(m.y=yt.Backward,x.y=s*Math.abs((e.top+f.height-i)/f.height)):!u&&c>=e.bottom-f.height&&(m.y=yt.Forward,x.y=s*Math.abs((e.bottom-f.height-c)/f.height)),!g&&l>=e.right-f.width?(m.x=yt.Forward,x.x=s*Math.abs((e.right-f.width-l)/f.width)):!h&&o<=e.left+f.width&&(m.x=yt.Backward,x.x=s*Math.abs((e.left+f.width-o)/f.width)),{direction:m,speed:x}}function L_(t){if(t===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:r,right:s,bottom:n}=t.getBoundingClientRect();return{top:e,left:r,right:s,bottom:n,width:t.clientWidth,height:t.clientHeight}}function Wp(t){return t.reduce((e,r)=>zs(e,Nl(r)),or)}function $_(t){return t.reduce((e,r)=>e+Op(r),0)}function F_(t){return t.reduce((e,r)=>e+Lp(r),0)}function Vp(t,e){if(e===void 0&&(e=hn),!t)return;const{top:r,left:s,bottom:n,right:i}=e(t);Mp(t)&&(n<=0||i<=0||r>=window.innerHeight||s>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const W_=[["x",["left","right"],$_],["y",["top","bottom"],F_]];class qc{constructor(e,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Yc(r),n=Wp(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,l]of W_)for(const c of o)Object.defineProperty(this,c,{get:()=>{const d=l(s),u=n[i]-d;return this.rect[c]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Un{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...r)})},this.target=e}add(e,r,s){var n;(n=this.target)==null||n.addEventListener(e,r,s),this.listeners.push([e,r,s])}}function V_(t){const{EventTarget:e}=It(t);return t instanceof e?t:un(t)}function Ro(t,e){const r=Math.abs(t.x),s=Math.abs(t.y);return typeof e=="number"?Math.sqrt(r**2+s**2)>e:"x"in e&&"y"in e?r>e.x&&s>e.y:"x"in e?r>e.x:"y"in e?s>e.y:!1}var Kt;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Kt||(Kt={}));function gh(t){t.preventDefault()}function U_(t){t.stopPropagation()}var Ue;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(Ue||(Ue={}));const Up={start:[Ue.Space,Ue.Enter],cancel:[Ue.Esc],end:[Ue.Space,Ue.Enter,Ue.Tab]},B_=(t,e)=>{let{currentCoordinates:r}=e;switch(t.code){case Ue.Right:return{...r,x:r.x+25};case Ue.Left:return{...r,x:r.x-25};case Ue.Down:return{...r,y:r.y+25};case Ue.Up:return{...r,y:r.y-25}}};class Bp{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:r}}=e;this.props=e,this.listeners=new Un(un(r)),this.windowListeners=new Un(It(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Kt.Resize,this.handleCancel),this.windowListeners.add(Kt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Kt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:r}=this.props,s=e.node.current;s&&Vp(s),r(or)}handleKeyDown(e){if(to(e)){const{active:r,context:s,options:n}=this.props,{keyboardCodes:i=Up,coordinateGetter:o=B_,scrollBehavior:l="smooth"}=n,{code:c}=e;if(i.end.includes(c)){this.handleEnd(e);return}if(i.cancel.includes(c)){this.handleCancel(e);return}const{collisionRect:d}=s.current,u=d?{x:d.left,y:d.top}:or;this.referenceCoordinates||(this.referenceCoordinates=u);const h=o(e,{active:r,context:s.current,currentCoordinates:u});if(h){const g=_i(h,u),m={x:0,y:0},{scrollableAncestors:x}=s.current;for(const f of x){const p=e.code,{isTop:w,isRight:v,isLeft:k,isBottom:b,maxScroll:T,minScroll:_}=Fp(f),j=L_(f),N={x:Math.min(p===Ue.Right?j.right-j.width/2:j.right,Math.max(p===Ue.Right?j.left:j.left+j.width/2,h.x)),y:Math.min(p===Ue.Down?j.bottom-j.height/2:j.bottom,Math.max(p===Ue.Down?j.top:j.top+j.height/2,h.y))},D=p===Ue.Right&&!v||p===Ue.Left&&!k,$=p===Ue.Down&&!b||p===Ue.Up&&!w;if(D&&N.x!==h.x){const C=f.scrollLeft+g.x,R=p===Ue.Right&&C<=T.x||p===Ue.Left&&C>=_.x;if(R&&!g.y){f.scrollTo({left:C,behavior:l});return}R?m.x=f.scrollLeft-C:m.x=p===Ue.Right?f.scrollLeft-T.x:f.scrollLeft-_.x,m.x&&f.scrollBy({left:-m.x,behavior:l});break}else if($&&N.y!==h.y){const C=f.scrollTop+g.y,R=p===Ue.Down&&C<=T.y||p===Ue.Up&&C>=_.y;if(R&&!g.x){f.scrollTo({top:C,behavior:l});return}R?m.y=f.scrollTop-C:m.y=p===Ue.Down?f.scrollTop-T.y:f.scrollTop-_.y,m.y&&f.scrollBy({top:-m.y,behavior:l});break}}this.handleMove(e,zs(_i(h,this.referenceCoordinates),m))}}}handleMove(e,r){const{onMove:s}=this.props;e.preventDefault(),s(r)}handleEnd(e){const{onEnd:r}=this.props;e.preventDefault(),this.detach(),r()}handleCancel(e){const{onCancel:r}=this.props;e.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Bp.activators=[{eventName:"onKeyDown",handler:(t,e,r)=>{let{keyboardCodes:s=Up,onActivation:n}=e,{active:i}=r;const{code:o}=t.nativeEvent;if(s.start.includes(o)){const l=i.activatorNode.current;return l&&t.target!==l?!1:(t.preventDefault(),n?.({event:t.nativeEvent}),!0)}return!1}}];function mh(t){return!!(t&&"distance"in t)}function fh(t){return!!(t&&"delay"in t)}class Xc{constructor(e,r,s){var n;s===void 0&&(s=V_(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=r;const{event:i}=e,{target:o}=i;this.props=e,this.events=r,this.document=un(o),this.documentListeners=new Un(this.document),this.listeners=new Un(s),this.windowListeners=new Un(It(o)),this.initialCoordinates=(n=Di(i))!=null?n:or,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:r,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Kt.Resize,this.handleCancel),this.windowListeners.add(Kt.DragStart,gh),this.windowListeners.add(Kt.VisibilityChange,this.handleCancel),this.windowListeners.add(Kt.ContextMenu,gh),this.documentListeners.add(Kt.Keydown,this.handleKeydown),r){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(fh(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(mh(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,r){const{active:s,onPending:n}=this.props;n(s,e,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:e}=this,{onStart:r}=this.props;e&&(this.activated=!0,this.documentListeners.add(Kt.Click,U_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Kt.SelectionChange,this.removeTextSelection),r(e))}handleMove(e){var r;const{activated:s,initialCoordinates:n,props:i}=this,{onMove:o,options:{activationConstraint:l}}=i;if(!n)return;const c=(r=Di(e))!=null?r:or,d=_i(n,c);if(!s&&l){if(mh(l)){if(l.tolerance!=null&&Ro(d,l.tolerance))return this.handleCancel();if(Ro(d,l.distance))return this.handleStart()}if(fh(l)&&Ro(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}e.cancelable&&e.preventDefault(),o(c)}handleEnd(){const{onAbort:e,onEnd:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleCancel(){const{onAbort:e,onCancel:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleKeydown(e){e.code===Ue.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const H_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Hp extends Xc{constructor(e){const{event:r}=e,s=un(r.target);super(e,H_,s)}}Hp.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;return!r.isPrimary||r.button!==0?!1:(s?.({event:r}),!0)}}];const G_={move:{name:"mousemove"},end:{name:"mouseup"}};var Sl;(function(t){t[t.RightClick=2]="RightClick"})(Sl||(Sl={}));class Gp extends Xc{constructor(e){super(e,G_,un(e.event.target))}}Gp.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;return r.button===Sl.RightClick?!1:(s?.({event:r}),!0)}}];const Po={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class zp extends Xc{constructor(e){super(e,Po)}static setup(){return window.addEventListener(Po.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Po.move.name,e)};function e(){}}}zp.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;const{touches:n}=r;return n.length>1?!1:(s?.({event:r}),!0)}}];var Bn;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Bn||(Bn={}));var Ei;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ei||(Ei={}));function z_(t){let{acceleration:e,activator:r=Bn.Pointer,canScroll:s,draggingRect:n,enabled:i,interval:o=5,order:l=Ei.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:h,threshold:g}=t;const m=Y_({delta:h,disabled:!i}),[x,f]=a_(),p=y.useRef({x:0,y:0}),w=y.useRef({x:0,y:0}),v=y.useMemo(()=>{switch(r){case Bn.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Bn.DraggableRect:return n}},[r,n,c]),k=y.useRef(null),b=y.useCallback(()=>{const _=k.current;if(!_)return;const j=p.current.x*w.current.x,N=p.current.y*w.current.y;_.scrollBy(j,N)},[]),T=y.useMemo(()=>l===Ei.TreeOrder?[...d].reverse():d,[l,d]);y.useEffect(()=>{if(!i||!d.length||!v){f();return}for(const _ of T){if(s?.(_)===!1)continue;const j=d.indexOf(_),N=u[j];if(!N)continue;const{direction:D,speed:$}=O_(_,N,v,e,g);for(const C of["x","y"])m[C][D[C]]||($[C]=0,D[C]=0);if($.x>0||$.y>0){f(),k.current=_,x(b,o),p.current=$,w.current=D;return}}p.current={x:0,y:0},w.current={x:0,y:0},f()},[e,b,s,f,i,o,JSON.stringify(v),JSON.stringify(m),x,d,T,u,JSON.stringify(g)])}const K_={x:{[yt.Backward]:!1,[yt.Forward]:!1},y:{[yt.Backward]:!1,[yt.Forward]:!1}};function Y_(t){let{delta:e,disabled:r}=t;const s=ji(e);return _a(n=>{if(r||!s||!n)return K_;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[yt.Backward]:n.x[yt.Backward]||i.x===-1,[yt.Forward]:n.x[yt.Forward]||i.x===1},y:{[yt.Backward]:n.y[yt.Backward]||i.y===-1,[yt.Forward]:n.y[yt.Forward]||i.y===1}}},[r,e,s])}function q_(t,e){const r=e!=null?t.get(e):void 0,s=r?r.node.current:null;return _a(n=>{var i;return e==null?null:(i=s??n)!=null?i:null},[s,e])}function X_(t,e){return y.useMemo(()=>t.reduce((r,s)=>{const{sensor:n}=s,i=n.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,s)}));return[...r,...i]},[]),[t,e])}var da;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(da||(da={}));var jl;(function(t){t.Optimized="optimized"})(jl||(jl={}));const ph=new Map;function Q_(t,e){let{dragging:r,dependencies:s,config:n}=e;const[i,o]=y.useState(null),{frequency:l,measure:c,strategy:d}=n,u=y.useRef(t),h=p(),g=ca(h),m=y.useCallback(function(w){w===void 0&&(w=[]),!g.current&&o(v=>v===null?w:v.concat(w.filter(k=>!v.includes(k))))},[g]),x=y.useRef(null),f=_a(w=>{if(h&&!r)return ph;if(!w||w===ph||u.current!==t||i!=null){const v=new Map;for(let k of t){if(!k)continue;if(i&&i.length>0&&!i.includes(k.id)&&k.rect.current){v.set(k.id,k.rect.current);continue}const b=k.node.current,T=b?new qc(c(b),b):null;k.rect.current=T,T&&v.set(k.id,T)}return v}return w},[t,i,r,h,c]);return y.useEffect(()=>{u.current=t},[t]),y.useEffect(()=>{h||m()},[r,h]),y.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),y.useEffect(()=>{h||typeof l!="number"||x.current!==null||(x.current=setTimeout(()=>{m(),x.current=null},l))},[l,h,m,...s]),{droppableRects:f,measureDroppableContainers:m,measuringScheduled:i!=null};function p(){switch(d){case da.Always:return!1;case da.BeforeDragging:return r;default:return!r}}}function Qc(t,e){return _a(r=>t?r||(typeof e=="function"?e(t):t):null,[e,t])}function J_(t,e){return Qc(t,e)}function Z_(t){let{callback:e,disabled:r}=t;const s=eo(e),n=y.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,r]);return y.useEffect(()=>()=>n?.disconnect(),[n]),n}function ro(t){let{callback:e,disabled:r}=t;const s=eo(e),n=y.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[r]);return y.useEffect(()=>()=>n?.disconnect(),[n]),n}function eD(t){return new qc(hn(t),t)}function yh(t,e,r){e===void 0&&(e=eD);const[s,n]=y.useState(null);function i(){n(c=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=c??r)!=null?d:null}const u=e(t);return JSON.stringify(c)===JSON.stringify(u)?c:u})}const o=Z_({callback(c){if(t)for(const d of c){const{type:u,target:h}=d;if(u==="childList"&&h instanceof HTMLElement&&h.contains(t)){i();break}}}}),l=ro({callback:i});return ir(()=>{i(),t?(l?.observe(t),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[t]),s}function tD(t){const e=Qc(t);return Rp(t,e)}const xh=[];function rD(t){const e=y.useRef(t),r=_a(s=>t?s&&s!==xh&&t&&e.current&&t.parentNode===e.current.parentNode?s:Yc(t):xh,[t]);return y.useEffect(()=>{e.current=t},[t]),r}function sD(t){const[e,r]=y.useState(null),s=y.useRef(t),n=y.useCallback(i=>{const o=Ao(i.target);o&&r(l=>l?(l.set(o,Nl(o)),new Map(l)):null)},[]);return y.useEffect(()=>{const i=s.current;if(t!==i){o(i);const l=t.map(c=>{const d=Ao(c);return d?(d.addEventListener("scroll",n,{passive:!0}),[d,Nl(d)]):null}).filter(c=>c!=null);r(l.length?new Map(l):null),s.current=t}return()=>{o(t),o(i)};function o(l){l.forEach(c=>{const d=Ao(c);d?.removeEventListener("scroll",n)})}},[n,t]),y.useMemo(()=>t.length?e?Array.from(e.values()).reduce((i,o)=>zs(i,o),or):Wp(t):or,[t,e])}function bh(t,e){e===void 0&&(e=[]);const r=y.useRef(null);return y.useEffect(()=>{r.current=null},e),y.useEffect(()=>{const s=t!==or;s&&!r.current&&(r.current=t),!s&&r.current&&(r.current=null)},[t]),r.current?_i(t,r.current):or}function nD(t){y.useEffect(()=>{if(!Zi)return;const e=t.map(r=>{let{sensor:s}=r;return s.setup==null?void 0:s.setup()});return()=>{for(const r of e)r?.()}},t.map(e=>{let{sensor:r}=e;return r}))}function aD(t,e){return y.useMemo(()=>t.reduce((r,s)=>{let{eventName:n,handler:i}=s;return r[n]=o=>{i(o,e)},r},{}),[t,e])}function Kp(t){return y.useMemo(()=>t?A_(t):null,[t])}const vh=[];function iD(t,e){e===void 0&&(e=hn);const[r]=t,s=Kp(r?It(r):null),[n,i]=y.useState(vh);function o(){i(()=>t.length?t.map(c=>$p(c)?s:new qc(e(c),c)):vh)}const l=ro({callback:o});return ir(()=>{l?.disconnect(),o(),t.forEach(c=>l?.observe(c))},[t]),n}function Yp(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return ja(e)?e:t}function oD(t){let{measure:e}=t;const[r,s]=y.useState(null),n=y.useCallback(d=>{for(const{target:u}of d)if(ja(u)){s(h=>{const g=e(u);return h?{...h,width:g.width,height:g.height}:g});break}},[e]),i=ro({callback:n}),o=y.useCallback(d=>{const u=Yp(d);i?.disconnect(),u&&i?.observe(u),s(u?e(u):null)},[e,i]),[l,c]=Si(o);return y.useMemo(()=>({nodeRef:l,rect:r,setRef:c}),[r,l,c])}const lD=[{sensor:Hp,options:{}},{sensor:Bp,options:{}}],cD={current:{}},Ya={draggable:{measure:hh},droppable:{measure:hh,strategy:da.WhileDragging,frequency:jl.Optimized},dragOverlay:{measure:hn}};class Hn extends Map{get(e){var r;return e!=null&&(r=super.get(e))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:r}=e;return!r})}getNodeFor(e){var r,s;return(r=(s=this.get(e))==null?void 0:s.node.current)!=null?r:void 0}}const dD={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Hn,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ci},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ya,measureDroppableContainers:Ci,windowRect:null,measuringScheduled:!1},qp={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ci,draggableNodes:new Map,over:null,measureDroppableContainers:Ci},Ca=y.createContext(qp),Xp=y.createContext(dD);function uD(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Hn}}}function hD(t,e){switch(e.type){case dt.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case dt.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case dt.DragEnd:case dt.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case dt.RegisterDroppable:{const{element:r}=e,{id:s}=r,n=new Hn(t.droppable.containers);return n.set(s,r),{...t,droppable:{...t.droppable,containers:n}}}case dt.SetDroppableDisabled:{const{id:r,key:s,disabled:n}=e,i=t.droppable.containers.get(r);if(!i||s!==i.key)return t;const o=new Hn(t.droppable.containers);return o.set(r,{...i,disabled:n}),{...t,droppable:{...t.droppable,containers:o}}}case dt.UnregisterDroppable:{const{id:r,key:s}=e,n=t.droppable.containers.get(r);if(!n||s!==n.key)return t;const i=new Hn(t.droppable.containers);return i.delete(r),{...t,droppable:{...t.droppable,containers:i}}}default:return t}}function gD(t){let{disabled:e}=t;const{active:r,activatorEvent:s,draggableNodes:n}=y.useContext(Ca),i=ji(s),o=ji(r?.id);return y.useEffect(()=>{if(!e&&!s&&i&&o!=null){if(!to(i)||document.activeElement===i.target)return;const l=n.get(o);if(!l)return;const{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[c.current,d.current]){if(!u)continue;const h=l_(u);if(h){h.focus();break}}})}},[s,e,n,o,i]),null}function Qp(t,e){let{transform:r,...s}=e;return t!=null&&t.length?t.reduce((n,i)=>i({transform:n,...s}),r):r}function mD(t){return y.useMemo(()=>({draggable:{...Ya.draggable,...t?.draggable},droppable:{...Ya.droppable,...t?.droppable},dragOverlay:{...Ya.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function fD(t){let{activeNode:e,measure:r,initialRect:s,config:n=!0}=t;const i=y.useRef(!1),{x:o,y:l}=typeof n=="boolean"?{x:n,y:n}:n;ir(()=>{if(!o&&!l||!e){i.current=!1;return}if(i.current||!s)return;const d=e?.node.current;if(!d||d.isConnected===!1)return;const u=r(d),h=Rp(u,s);if(o||(h.x=0),l||(h.y=0),i.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const g=Mp(d);g&&g.scrollBy({top:h.y,left:h.x})}},[e,o,l,s,r])}const so=y.createContext({...or,scaleX:1,scaleY:1});var Vr;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Vr||(Vr={}));const pD=y.memo(function(e){var r,s,n,i;let{id:o,accessibility:l,autoScroll:c=!0,children:d,sensors:u=lD,collisionDetection:h=j_,measuring:g,modifiers:m,...x}=e;const f=y.useReducer(hD,void 0,uD),[p,w]=f,[v,k]=m_(),[b,T]=y.useState(Vr.Uninitialized),_=b===Vr.Initialized,{draggable:{active:j,nodes:N,translate:D},droppable:{containers:$}}=p,C=j!=null?N.get(j):null,R=y.useRef({initial:null,translated:null}),B=y.useMemo(()=>{var Pe;return j!=null?{id:j,data:(Pe=C?.data)!=null?Pe:cD,rect:R}:null},[j,C]),Y=y.useRef(null),[V,q]=y.useState(null),[z,de]=y.useState(null),Te=ca(x,Object.values(x)),we=Da("DndDescribedBy",o),fe=y.useMemo(()=>$.getEnabled(),[$]),W=mD(g),{droppableRects:le,measureDroppableContainers:ie,measuringScheduled:be}=Q_(fe,{dragging:_,dependencies:[D.x,D.y],config:W.droppable}),ye=q_(N,j),ke=y.useMemo(()=>z?Di(z):null,[z]),E=De(),te=J_(ye,W.draggable.measure);fD({activeNode:j!=null?N.get(j):null,config:E.layoutShiftCompensation,initialRect:te,measure:W.draggable.measure});const Q=yh(ye,W.draggable.measure,te),H=yh(ye?ye.parentElement:null),I=y.useRef({activatorEvent:null,active:null,activeNode:ye,collisionRect:null,collisions:null,droppableRects:le,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:$,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=$.getNodeFor((r=I.current.over)==null?void 0:r.id),ce=oD({measure:W.dragOverlay.measure}),O=(s=ce.nodeRef.current)!=null?s:ye,G=_?(n=ce.rect)!=null?n:Q:null,M=!!(ce.nodeRef.current&&ce.rect),se=tD(M?null:Q),ue=Kp(O?It(O):null),ge=rD(_?J??ye:null),re=iD(ge),Ie=Qp(m,{transform:{x:D.x-se.x,y:D.y-se.y,scaleX:1,scaleY:1},activatorEvent:z,active:B,activeNodeRect:Q,containerNodeRect:H,draggingNodeRect:G,over:I.current.over,overlayNodeRect:ce.rect,scrollableAncestors:ge,scrollableAncestorRects:re,windowRect:ue}),K=ke?zs(ke,D):null,pe=sD(ge),Fe=bh(pe),X=bh(pe,[Q]),ve=zs(Ie,Fe),Be=G?C_(G,Ie):null,S=B&&Be?h({active:B,collisionRect:Be,droppableRects:le,droppableContainers:fe,pointerCoordinates:K}):null,L=T_(S,"id"),[A,P]=y.useState(null),F=M?Ie:zs(Ie,X),U=__(F,(i=A?.rect)!=null?i:null,Q),ae=y.useRef(null),Ne=y.useCallback((Pe,st)=>{let{sensor:mt,options:Pr}=st;if(Y.current==null)return;const Bt=N.get(Y.current);if(!Bt)return;const $t=Pe.nativeEvent,lr=new mt({active:Y.current,activeNode:Bt,event:$t,options:Pr,context:I,onAbort(bt){if(!N.get(bt))return;const{onDragAbort:cr}=Te.current,wr={id:bt};cr?.(wr),v({type:"onDragAbort",event:wr})},onPending(bt,Mr,cr,wr){if(!N.get(bt))return;const{onDragPending:yn}=Te.current,Or={id:bt,constraint:Mr,initialCoordinates:cr,offset:wr};yn?.(Or),v({type:"onDragPending",event:Or})},onStart(bt){const Mr=Y.current;if(Mr==null)return;const cr=N.get(Mr);if(!cr)return;const{onDragStart:wr}=Te.current,pn={activatorEvent:$t,active:{id:Mr,data:cr.data,rect:R}};Ur.unstable_batchedUpdates(()=>{wr?.(pn),T(Vr.Initializing),w({type:dt.DragStart,initialCoordinates:bt,active:Mr}),v({type:"onDragStart",event:pn}),q(ae.current),de($t)})},onMove(bt){w({type:dt.DragMove,coordinates:bt})},onEnd:_s(dt.DragEnd),onCancel:_s(dt.DragCancel)});ae.current=lr;function _s(bt){return async function(){const{active:cr,collisions:wr,over:pn,scrollAdjustedTranslate:yn}=I.current;let Or=null;if(cr&&yn){const{cancelDrop:xn}=Te.current;Or={activatorEvent:$t,active:cr,collisions:wr,delta:yn,over:pn},bt===dt.DragEnd&&typeof xn=="function"&&await Promise.resolve(xn(Or))&&(bt=dt.DragCancel)}Y.current=null,Ur.unstable_batchedUpdates(()=>{w({type:bt}),T(Vr.Uninitialized),P(null),q(null),de(null),ae.current=null;const xn=bt===dt.DragEnd?"onDragEnd":"onDragCancel";if(Or){const oo=Te.current[xn];oo?.(Or),v({type:xn,event:Or})}})}}},[N]),Se=y.useCallback((Pe,st)=>(mt,Pr)=>{const Bt=mt.nativeEvent,$t=N.get(Pr);if(Y.current!==null||!$t||Bt.dndKit||Bt.defaultPrevented)return;const lr={active:$t};Pe(mt,st.options,lr)===!0&&(Bt.dndKit={capturedBy:st.sensor},Y.current=Pr,Ne(mt,st))},[N,Ne]),he=X_(u,Se);nD(u),ir(()=>{Q&&b===Vr.Initializing&&T(Vr.Initialized)},[Q,b]),y.useEffect(()=>{const{onDragMove:Pe}=Te.current,{active:st,activatorEvent:mt,collisions:Pr,over:Bt}=I.current;if(!st||!mt)return;const $t={active:st,activatorEvent:mt,collisions:Pr,delta:{x:ve.x,y:ve.y},over:Bt};Ur.unstable_batchedUpdates(()=>{Pe?.($t),v({type:"onDragMove",event:$t})})},[ve.x,ve.y]),y.useEffect(()=>{const{active:Pe,activatorEvent:st,collisions:mt,droppableContainers:Pr,scrollAdjustedTranslate:Bt}=I.current;if(!Pe||Y.current==null||!st||!Bt)return;const{onDragOver:$t}=Te.current,lr=Pr.get(L),_s=lr&&lr.rect.current?{id:lr.id,rect:lr.rect.current,data:lr.data,disabled:lr.disabled}:null,bt={active:Pe,activatorEvent:st,collisions:mt,delta:{x:Bt.x,y:Bt.y},over:_s};Ur.unstable_batchedUpdates(()=>{P(_s),$t?.(bt),v({type:"onDragOver",event:bt})})},[L]),ir(()=>{I.current={activatorEvent:z,active:B,activeNode:ye,collisionRect:Be,collisions:S,droppableRects:le,draggableNodes:N,draggingNode:O,draggingNodeRect:G,droppableContainers:$,over:A,scrollableAncestors:ge,scrollAdjustedTranslate:ve},R.current={initial:G,translated:Be}},[B,ye,S,Be,N,O,G,le,$,A,ge,ve]),z_({...E,delta:D,draggingRect:Be,pointerCoordinates:K,scrollableAncestors:ge,scrollableAncestorRects:re});const _e=y.useMemo(()=>({active:B,activeNode:ye,activeNodeRect:Q,activatorEvent:z,collisions:S,containerNodeRect:H,dragOverlay:ce,draggableNodes:N,droppableContainers:$,droppableRects:le,over:A,measureDroppableContainers:ie,scrollableAncestors:ge,scrollableAncestorRects:re,measuringConfiguration:W,measuringScheduled:be,windowRect:ue}),[B,ye,Q,z,S,H,ce,N,$,le,A,ie,ge,re,W,be,ue]),me=y.useMemo(()=>({activatorEvent:z,activators:he,active:B,activeNodeRect:Q,ariaDescribedById:{draggable:we},dispatch:w,draggableNodes:N,over:A,measureDroppableContainers:ie}),[z,he,B,Q,w,we,N,A,ie]);return Ze.createElement(Ap.Provider,{value:k},Ze.createElement(Ca.Provider,{value:me},Ze.createElement(Xp.Provider,{value:_e},Ze.createElement(so.Provider,{value:U},d)),Ze.createElement(gD,{disabled:l?.restoreFocus===!1})),Ze.createElement(y_,{...l,hiddenTextDescribedById:we}));function De(){const Pe=V?.autoScrollEnabled===!1,st=typeof c=="object"?c.enabled===!1:c===!1,mt=_&&!Pe&&!st;return typeof c=="object"?{...c,enabled:mt}:{enabled:mt}}}),yD=y.createContext(null),wh="button",xD="Draggable";function bD(t){let{id:e,data:r,disabled:s=!1,attributes:n}=t;const i=Da(xD),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:h,over:g}=y.useContext(Ca),{role:m=wh,roleDescription:x="draggable",tabIndex:f=0}=n??{},p=c?.id===e,w=y.useContext(p?so:yD),[v,k]=Si(),[b,T]=Si(),_=aD(o,e),j=ca(r);ir(()=>(h.set(e,{id:e,key:i,node:v,activatorNode:b,data:j}),()=>{const D=h.get(e);D&&D.key===i&&h.delete(e)}),[h,e]);const N=y.useMemo(()=>({role:m,tabIndex:f,"aria-disabled":s,"aria-pressed":p&&m===wh?!0:void 0,"aria-roledescription":x,"aria-describedby":u.draggable}),[s,m,f,p,x,u.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:N,isDragging:p,listeners:s?void 0:_,node:v,over:g,setNodeRef:k,setActivatorNodeRef:T,transform:w}}function Jp(){return y.useContext(Xp)}const vD="Droppable",wD={timeout:25};function Zp(t){let{data:e,disabled:r=!1,id:s,resizeObserverConfig:n}=t;const i=Da(vD),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=y.useContext(Ca),u=y.useRef({disabled:r}),h=y.useRef(!1),g=y.useRef(null),m=y.useRef(null),{disabled:x,updateMeasurementsFor:f,timeout:p}={...wD,...n},w=ca(f??s),v=y.useCallback(()=>{if(!h.current){h.current=!0;return}m.current!=null&&clearTimeout(m.current),m.current=setTimeout(()=>{d(Array.isArray(w.current)?w.current:[w.current]),m.current=null},p)},[p]),k=ro({callback:v,disabled:x||!o}),b=y.useCallback((N,D)=>{k&&(D&&(k.unobserve(D),h.current=!1),N&&k.observe(N))},[k]),[T,_]=Si(b),j=ca(e);return y.useEffect(()=>{!k||!T.current||(k.disconnect(),h.current=!1,k.observe(T.current))},[T,k]),y.useEffect(()=>(l({type:dt.RegisterDroppable,element:{id:s,key:i,disabled:r,node:T,rect:g,data:j}}),()=>l({type:dt.UnregisterDroppable,key:i,id:s})),[s]),y.useEffect(()=>{r!==u.current.disabled&&(l({type:dt.SetDroppableDisabled,id:s,key:i,disabled:r}),u.current.disabled=r)},[s,i,r,l]),{active:o,rect:g,isOver:c?.id===s,node:T,over:c,setNodeRef:_}}function kD(t){let{animation:e,children:r}=t;const[s,n]=y.useState(null),[i,o]=y.useState(null),l=ji(r);return!r&&!s&&l&&n(l),ir(()=>{if(!i)return;const c=s?.key,d=s?.props.id;if(c==null||d==null){n(null);return}Promise.resolve(e(d,i)).then(()=>{n(null)})},[e,s,i]),Ze.createElement(Ze.Fragment,null,r,s?y.cloneElement(s,{ref:o}):null)}const TD={x:0,y:0,scaleX:1,scaleY:1};function ND(t){let{children:e}=t;return Ze.createElement(Ca.Provider,{value:qp},Ze.createElement(so.Provider,{value:TD},e))}const SD={position:"fixed",touchAction:"none"},jD=t=>to(t)?"transform 250ms ease":void 0,_D=y.forwardRef((t,e)=>{let{as:r,activatorEvent:s,adjustScale:n,children:i,className:o,rect:l,style:c,transform:d,transition:u=jD}=t;if(!l)return null;const h=n?d:{...d,scaleX:1,scaleY:1},g={...SD,width:l.width,height:l.height,top:l.top,left:l.left,transform:Qr.Transform.toString(h),transformOrigin:n&&s?v_(s,l):void 0,transition:typeof u=="function"?u(s):u,...c};return Ze.createElement(r,{className:o,style:g,ref:e},i)}),DD=t=>e=>{let{active:r,dragOverlay:s}=e;const n={},{styles:i,className:o}=t;if(i!=null&&i.active)for(const[l,c]of Object.entries(i.active))c!==void 0&&(n[l]=r.node.style.getPropertyValue(l),r.node.style.setProperty(l,c));if(i!=null&&i.dragOverlay)for(const[l,c]of Object.entries(i.dragOverlay))c!==void 0&&s.node.style.setProperty(l,c);return o!=null&&o.active&&r.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[c,d]of Object.entries(n))r.node.style.setProperty(c,d);o!=null&&o.active&&r.node.classList.remove(o.active)}},CD=t=>{let{transform:{initial:e,final:r}}=t;return[{transform:Qr.Transform.toString(e)},{transform:Qr.Transform.toString(r)}]},ED={duration:250,easing:"ease",keyframes:CD,sideEffects:DD({styles:{active:{opacity:"0"}}})};function ID(t){let{config:e,draggableNodes:r,droppableContainers:s,measuringConfiguration:n}=t;return eo((i,o)=>{if(e===null)return;const l=r.get(i);if(!l)return;const c=l.node.current;if(!c)return;const d=Yp(o);if(!d)return;const{transform:u}=It(o).getComputedStyle(o),h=Pp(u);if(!h)return;const g=typeof e=="function"?e:AD(e);return Vp(c,n.draggable.measure),g({active:{id:i,data:l.data,node:c,rect:n.draggable.measure(c)},draggableNodes:r,dragOverlay:{node:o,rect:n.dragOverlay.measure(d)},droppableContainers:s,measuringConfiguration:n,transform:h})})}function AD(t){const{duration:e,easing:r,sideEffects:s,keyframes:n}={...ED,...t};return i=>{let{active:o,dragOverlay:l,transform:c,...d}=i;if(!e)return;const u={x:l.rect.left-o.rect.left,y:l.rect.top-o.rect.top},h={scaleX:c.scaleX!==1?o.rect.width*c.scaleX/l.rect.width:1,scaleY:c.scaleY!==1?o.rect.height*c.scaleY/l.rect.height:1},g={x:c.x-u.x,y:c.y-u.y,...h},m=n({...d,active:o,dragOverlay:l,transform:{initial:c,final:g}}),[x]=m,f=m[m.length-1];if(JSON.stringify(x)===JSON.stringify(f))return;const p=s?.({active:o,dragOverlay:l,...d}),w=l.node.animate(m,{duration:e,easing:r,fill:"forwards"});return new Promise(v=>{w.onfinish=()=>{p?.(),v()}})}}let kh=0;function RD(t){return y.useMemo(()=>{if(t!=null)return kh++,kh},[t])}const PD=Ze.memo(t=>{let{adjustScale:e=!1,children:r,dropAnimation:s,style:n,transition:i,modifiers:o,wrapperElement:l="div",className:c,zIndex:d=999}=t;const{activatorEvent:u,active:h,activeNodeRect:g,containerNodeRect:m,draggableNodes:x,droppableContainers:f,dragOverlay:p,over:w,measuringConfiguration:v,scrollableAncestors:k,scrollableAncestorRects:b,windowRect:T}=Jp(),_=y.useContext(so),j=RD(h?.id),N=Qp(o,{activatorEvent:u,active:h,activeNodeRect:g,containerNodeRect:m,draggingNodeRect:p.rect,over:w,overlayNodeRect:p.rect,scrollableAncestors:k,scrollableAncestorRects:b,transform:_,windowRect:T}),D=Qc(g),$=ID({config:s,draggableNodes:x,droppableContainers:f,measuringConfiguration:v}),C=D?p.setRef:void 0;return Ze.createElement(ND,null,Ze.createElement(kD,{animation:$},h&&j?Ze.createElement(_D,{key:j,id:h.id,ref:C,as:l,activatorEvent:u,adjustScale:e,className:c,transition:i,rect:D,style:{zIndex:d,...n},transform:N},r):null))});function e0(t,e,r){const s=t.slice();return s.splice(r<0?s.length+r:r,0,s.splice(e,1)[0]),s}function MD(t,e){return t.reduce((r,s,n)=>{const i=e.get(s);return i&&(r[n]=i),r},Array(t.length))}function Fa(t){return t!==null&&t>=0}function OD(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function LD(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const t0=t=>{let{rects:e,activeIndex:r,overIndex:s,index:n}=t;const i=e0(e,s,r),o=e[n],l=i[n];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},Wa={scaleX:1,scaleY:1},$D=t=>{var e;let{activeIndex:r,activeNodeRect:s,index:n,rects:i,overIndex:o}=t;const l=(e=i[r])!=null?e:s;if(!l)return null;if(n===r){const d=i[o];return d?{x:0,y:r<o?d.top+d.height-(l.top+l.height):d.top-l.top,...Wa}:null}const c=FD(i,n,r);return n>r&&n<=o?{x:0,y:-l.height-c,...Wa}:n<r&&n>=o?{x:0,y:l.height+c,...Wa}:{x:0,y:0,...Wa}};function FD(t,e,r){const s=t[e],n=t[e-1],i=t[e+1];return s?r<e?n?s.top-(n.top+n.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):n?s.top-(n.top+n.height):0:0}const r0="Sortable",s0=Ze.createContext({activeIndex:-1,containerId:r0,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:t0,disabled:{draggable:!1,droppable:!1}});function WD(t){let{children:e,id:r,items:s,strategy:n=t0,disabled:i=!1}=t;const{active:o,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:u}=Jp(),h=Da(r0,r),g=l.rect!==null,m=y.useMemo(()=>s.map(_=>typeof _=="object"&&"id"in _?_.id:_),[s]),x=o!=null,f=o?m.indexOf(o.id):-1,p=d?m.indexOf(d.id):-1,w=y.useRef(m),v=!OD(m,w.current),k=p!==-1&&f===-1||v,b=LD(i);ir(()=>{v&&x&&u(m)},[v,m,x,u]),y.useEffect(()=>{w.current=m},[m]);const T=y.useMemo(()=>({activeIndex:f,containerId:h,disabled:b,disableTransforms:k,items:m,overIndex:p,useDragOverlay:g,sortedRects:MD(m,c),strategy:n}),[f,h,b.draggable,b.droppable,k,m,p,c,g,n]);return Ze.createElement(s0.Provider,{value:T},e)}const VD=t=>{let{id:e,items:r,activeIndex:s,overIndex:n}=t;return e0(r,s,n).indexOf(e)},UD=t=>{let{containerId:e,isSorting:r,wasDragging:s,index:n,items:i,newIndex:o,previousItems:l,previousContainerId:c,transition:d}=t;return!d||!s||l!==i&&n===o?!1:r?!0:o!==n&&e===c},BD={duration:200,easing:"ease"},n0="transform",HD=Qr.Transition.toString({property:n0,duration:0,easing:"linear"}),GD={roleDescription:"sortable"};function zD(t){let{disabled:e,index:r,node:s,rect:n}=t;const[i,o]=y.useState(null),l=y.useRef(r);return ir(()=>{if(!e&&r!==l.current&&s.current){const c=n.current;if(c){const d=hn(s.current,{ignoreTransform:!0}),u={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(u.x||u.y)&&o(u)}}r!==l.current&&(l.current=r)},[e,r,s,n]),y.useEffect(()=>{i&&o(null)},[i]),i}function KD(t){let{animateLayoutChanges:e=UD,attributes:r,disabled:s,data:n,getNewIndex:i=VD,id:o,strategy:l,resizeObserverConfig:c,transition:d=BD}=t;const{items:u,containerId:h,activeIndex:g,disabled:m,disableTransforms:x,sortedRects:f,overIndex:p,useDragOverlay:w,strategy:v}=y.useContext(s0),k=YD(s,m),b=u.indexOf(o),T=y.useMemo(()=>({sortable:{containerId:h,index:b,items:u},...n}),[h,n,b,u]),_=y.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:j,node:N,isOver:D,setNodeRef:$}=Zp({id:o,data:T,disabled:k.droppable,resizeObserverConfig:{updateMeasurementsFor:_,...c}}),{active:C,activatorEvent:R,activeNodeRect:B,attributes:Y,setNodeRef:V,listeners:q,isDragging:z,over:de,setActivatorNodeRef:Te,transform:we}=bD({id:o,data:T,attributes:{...GD,...r},disabled:k.draggable}),fe=n_($,V),W=!!C,le=W&&!x&&Fa(g)&&Fa(p),ie=!w&&z,be=ie&&le?we:null,ke=le?be??(l??v)({rects:f,activeNodeRect:B,activeIndex:g,overIndex:p,index:b}):null,E=Fa(g)&&Fa(p)?i({id:o,items:u,activeIndex:g,overIndex:p}):b,te=C?.id,Q=y.useRef({activeId:te,items:u,newIndex:E,containerId:h}),H=u!==Q.current.items,I=e({active:C,containerId:h,isDragging:z,isSorting:W,id:o,index:b,items:u,newIndex:Q.current.newIndex,previousItems:Q.current.items,previousContainerId:Q.current.containerId,transition:d,wasDragging:Q.current.activeId!=null}),J=zD({disabled:!I,index:b,node:N,rect:j});return y.useEffect(()=>{W&&Q.current.newIndex!==E&&(Q.current.newIndex=E),h!==Q.current.containerId&&(Q.current.containerId=h),u!==Q.current.items&&(Q.current.items=u)},[W,E,h,u]),y.useEffect(()=>{if(te===Q.current.activeId)return;if(te!=null&&Q.current.activeId==null){Q.current.activeId=te;return}const O=setTimeout(()=>{Q.current.activeId=te},50);return()=>clearTimeout(O)},[te]),{active:C,activeIndex:g,attributes:Y,data:T,rect:j,index:b,newIndex:E,items:u,isOver:D,isSorting:W,isDragging:z,listeners:q,node:N,overIndex:p,over:de,setNodeRef:fe,setActivatorNodeRef:Te,setDroppableNodeRef:$,setDraggableNodeRef:V,transform:J??ke,transition:ce()};function ce(){if(J||H&&Q.current.newIndex===b)return HD;if(!(ie&&!to(R)||!d)&&(W||I))return Qr.Transition.toString({...d,property:n0})}}function YD(t,e){var r,s;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(r=t?.draggable)!=null?r:e.draggable,droppable:(s=t?.droppable)!=null?s:e.droppable}}Ue.Down,Ue.Right,Ue.Up,Ue.Left;const qD=y.memo(({id:t,title:e,count:r,priority:s,children:n,onAdd:i})=>{const{setNodeRef:o}=Zp({id:t}),{currentTheme:l,isDark:c}=Lt(),d=!!l.bg;let u="border-gray-200 dark:border-gray-700",h="bg-gray-100 dark:bg-gray-800",g="text-gray-700 dark:text-gray-300";return s==="urgent"?(u="border-red-200 dark:border-red-900/30",h="bg-red-50 dark:bg-red-900/10",g="text-red-700 dark:text-red-400"):s==="high"?(u="border-orange-200 dark:border-orange-900/30",h="bg-orange-50 dark:bg-orange-900/10",g="text-orange-700 dark:text-orange-400"):s==="medium"&&(u="border-blue-200 dark:border-blue-900/30",h="bg-blue-50 dark:bg-blue-900/10",g="text-blue-700 dark:text-blue-400"),a.jsxs("div",{ref:o,className:`
        flex-shrink-0 lg:flex-shrink lg:flex-1 w-80 max-w-[85vw] lg:max-w-none flex flex-col h-full 
        ${d?"backdrop-blur-none transition-[background-color] duration-200":"bg-gray-50/50 dark:bg-gray-900/20"} rounded-xl border ${u}
        transition-colors snap-center
      `,style:d?{backgroundColor:`rgba(${c?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:`p-4 flex items-center justify-between sticky top-0 backdrop-blur-sm rounded-t-xl z-10 ${h}`,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:`font-semibold ${g}`,children:e}),a.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-white/50 dark:bg-black/20",children:r})]}),a.jsx("button",{onClick:i,className:`
            p-1.5 rounded-lg hover:bg-white/50 dark:hover:bg-black/20 
            transition-colors ${g}
          `,children:a.jsx(gt,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3 min-h-0",children:n})]})}),Th=y.memo(({todo:t,onEdit:e,isOverlay:r})=>{const{currentTheme:s,isDark:n}=Lt(),i=!!s.bg,{attributes:o,listeners:l,setNodeRef:c,transform:d,transition:u,isDragging:h}=KD({id:t.id,data:{type:"Todo",todo:t}}),g={transform:Qr.Transform.toString(d),transition:u,opacity:h?.3:1},m=i?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700",x=i?{backgroundColor:`rgba(${n?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{};return a.jsx("div",{ref:c,style:g,...o,...l,className:`touch-none ${r?"shadow-2xl scale-105":""}`,children:a.jsx("div",{className:`${m} rounded-xl shadow-sm border`,style:x,children:a.jsx(Wr,{todo:t,onEdit:e,compact:!0})})})}),Mo=["urgent","high","medium","low"],XD=({searchTerm:t,priorityFilter:e,typeFilter:r,projectFilter:s,tagFilter:n,completionDateFilter:i,onAddTodo:o,onEdit:l,isMobile:c=!1})=>{const{t:d,i18n:u}=Xe(),{currentTheme:h,isDark:g}=Lt();h.bg,u.language==="ko"||rn;const{getFilteredTodos:m,updateTodo:x}=ot(),[f,p]=y.useState(null),w=x_(dh(Gp,{activationConstraint:{distance:10}}),dh(zp,{activationConstraint:{delay:250,tolerance:5}})),v=y.useMemo(()=>{const N=m({searchTerm:t,priorityFilter:e,typeFilter:r,projectFilter:s,tagFilter:n,completionDateFilter:"all",includeCompleted:!0});if(i==="today"){const D=new Date;return D.setHours(0,0,0,0),N.filter($=>{if($.completed)return $.completedAt&&Vt(new Date($.completedAt),D);const C=$.startDate?new Date($.startDate):null,R=$.dueDate?new Date($.dueDate):null;return C&&C.setHours(0,0,0,0),R&&R.setHours(0,0,0,0),C&&R?D>=C&&D<=R:C&&!R?D>=C:!C&&R?Vt(R,D)||R<D:!C&&!R})}return N},[t,e,r,s,n,i,m]),k=y.useMemo(()=>{const N={urgent:[],high:[],medium:[],low:[]};return v.forEach(D=>{N[D.priority]&&N[D.priority].push(D)}),Object.keys(N).forEach(D=>{N[D].sort(($,C)=>($.order||0)-(C.order||0))}),N},[v]),b=y.useMemo(()=>f?v.find(N=>N.id===f):null,[f,v]),T=N=>{p(N.active.id)},_=N=>{const{active:D,over:$}=N;if(!$)return;const C=D.id,R=$.id;if(Mo.includes(R)){const B=v.find(Y=>Y.id===C);B&&B.priority}},j=N=>{const{active:D,over:$}=N;if(!$){p(null);return}const C=D.id,R=$.id,B=v.find(V=>V.id===C);if(!B){p(null);return}let Y=B.priority;if(Mo.includes(R))Y=R;else{const V=v.find(q=>q.id===R);V&&(Y=V.priority)}B.priority!==Y&&x(C,{priority:Y}),p(null)};return a.jsxs(pD,{sensors:w,collisionDetection:N_,onDragStart:T,onDragOver:_,onDragEnd:j,children:[a.jsx("div",{className:"flex h-full gap-4 overflow-x-auto pb-4 items-start snap-x snap-mandatory px-4",children:Mo.map(N=>a.jsx(qD,{id:N,title:d(`modal.addTodo.${N}`)||N.toUpperCase(),count:k[N].length,priority:N,onAdd:()=>o(N),children:a.jsx(WD,{items:k[N].map(D=>D.id),strategy:$D,children:a.jsx("div",{className:"space-y-3 min-h-[100px]",children:k[N].map(D=>a.jsx(Th,{todo:D,onEdit:l},D.id))})})},N))}),a.jsx(PD,{children:b?a.jsx("div",{className:"transform rotate-3 opacity-90 cursor-grabbing",children:a.jsx(Th,{todo:b,onEdit:()=>{},isOverlay:!0})}):null})]})},QD=({layout:t="sidebar"})=>{const{t:e}=Xe(),{currentTheme:r,isDark:s}=Lt(),n=!!r.bg,{todos:i,getTodayTodos:o,getWeekTodos:l,getOverdueTodos:c}=ot(),d=i.length,u=i.filter(_=>_.completed).length,h=d>0?Math.round(u/d*100):0,g=o(),m=g.filter(_=>_.completed).length,x=g.length,f=l(),p=f.filter(_=>_.completed).length,w=f.length,v=w>0?Math.round(p/w*100):0,k=c().length,b=({value:_,color:j,size:N=60})=>{const D=N/2-4,$=2*Math.PI*D,C=$-_/100*$;return a.jsxs("div",{className:"relative flex items-center justify-center",style:{width:N,height:N},children:[a.jsxs("svg",{className:"transform -rotate-90 w-full h-full",children:[a.jsx("circle",{className:"text-gray-200 dark:text-gray-700",strokeWidth:"4",stroke:"currentColor",fill:"transparent",r:D,cx:N/2,cy:N/2}),a.jsx("circle",{className:j,strokeWidth:"4",strokeDasharray:$,strokeDashoffset:C,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:D,cx:N/2,cy:N/2})]}),a.jsxs("span",{className:"absolute text-xs font-bold text-gray-700 dark:text-gray-200",children:[_,"%"]})]})},T=[{title:e("detailedStats.totalCompletion"),value:`${h}%`,icon:a.jsx(zy,{className:"w-5 h-5"}),textColor:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-100 dark:border-green-800",chart:a.jsx(b,{value:h,color:"text-green-500"})},{title:e("detailedStats.todayProgress"),value:`${m}/${x}`,icon:a.jsx(Ky,{className:"w-5 h-5"}),textColor:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-100 dark:border-blue-800",chart:a.jsx("div",{className:"w-full h-2 bg-blue-100 dark:bg-blue-900/30 rounded-full overflow-hidden mt-2",children:a.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-500",style:{width:`${x>0?m/x*100:0}%`}})})},{title:e("detailedStats.weeklyProgress"),value:`${v}%`,icon:a.jsx(Yy,{className:"w-5 h-5"}),textColor:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-100 dark:border-purple-800",chart:a.jsx(b,{value:v,color:"text-purple-500"})},{title:e("detailedStats.overdue"),value:k.toString(),icon:a.jsx(qy,{className:"w-5 h-5"}),textColor:"text-red-600",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-100 dark:border-red-800",chart:a.jsx("div",{className:"flex items-center justify-center h-[60px]",children:a.jsx("span",{className:"text-3xl font-bold text-red-500",children:k})})}];return t==="compact"?a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsxs("p",{className:"text-green-600 text-xs font-bold leading-none",children:[h,"%"]}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.completionRate")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsxs("p",{className:"text-blue-600 text-xs font-bold leading-none",children:[m,"/",x]}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.daily")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsxs("p",{className:"text-purple-600 text-xs font-bold leading-none",children:[v,"%"]}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.weekly")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-red-600 text-xs font-bold leading-none",children:k}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:e("detailedStats.overdueLabel")})]})]}):a.jsx("div",{className:`grid ${t==="full"?"grid-cols-2 lg:grid-cols-4":"grid-cols-2"} gap-4 lg:gap-6`,children:T.map((_,j)=>a.jsxs("div",{className:`${n?"glass-card backdrop-blur-none transition-[background-color] duration-200":`${_.bgColor} ${_.borderColor}`} rounded-xl p-4 lg:p-6 border transition-all duration-300 hover:shadow-md hover:-translate-y-1 flex flex-col justify-between min-h-[140px]`,style:n?{backgroundColor:`rgba(${s?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("div",{className:`p-2.5 rounded-xl bg-white dark:bg-gray-800 ${_.textColor} shadow-sm`,children:_.icon}),a.jsx("p",{className:"text-sm lg:text-base font-semibold text-gray-600 dark:text-gray-400",children:_.title})]}),a.jsxs("div",{className:"flex items-end justify-between mt-2",children:[a.jsx("div",{className:"flex flex-col",children:a.jsx("span",{className:`text-2xl lg:text-3xl font-bold ${_.textColor} dark:text-gray-200 tracking-tight`,children:_.value})}),a.jsx("div",{className:"flex items-center justify-center scale-110 lg:scale-125 origin-bottom-right",children:_.chart})]})]},j))})},Nh=({layout:t="full"})=>{const{todos:e}=ot(),{t:r}=Xe(),{currentTheme:s,isDark:n}=Lt(),i=!!s.bg,o=i?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700",l=i?{backgroundColor:`rgba(${n?"0, 0, 0":"255, 255, 255"}, var(--glass - opacity, 0.1))`}:{},c=e.filter(f=>f.type==="project"),d=c.filter(f=>f.project==="longterm").length,u=c.filter(f=>f.project==="shortterm").length,h=e.length-c.length,g=e.length,m=({size:f=100})=>{if(g===0)return null;const p=f/2-10,w=2*Math.PI*p,v=d/g*100,k=u/g*100,b=h/g*100;return a.jsxs("div",{className:"relative flex items-center justify-center",style:{width:f,height:f},children:[a.jsxs("svg",{className:"transform -rotate-90 w-full h-full",children:[a.jsx("circle",{className:"text-gray-100 dark:text-gray-700",strokeWidth:"8",stroke:"currentColor",fill:"transparent",r:p,cx:f/2,cy:f/2}),d>0&&a.jsx("circle",{className:"text-purple-500 transition-all duration-1000 ease-out",strokeWidth:"8",strokeDasharray:w,strokeDashoffset:w-v/100*w,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:p,cx:f/2,cy:f/2}),u>0&&a.jsx("circle",{className:"text-green-500 transition-all duration-1000 ease-out",strokeWidth:"8",strokeDasharray:w,strokeDashoffset:w-k/100*w,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:p,cx:f/2,cy:f/2,style:{transform:`rotate(${v/100*360}deg)`,transformOrigin:"center"}}),h>0&&a.jsx("circle",{className:"text-orange-500 transition-all duration-1000 ease-out",strokeWidth:"8",strokeDasharray:w,strokeDashoffset:w-b/100*w,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:p,cx:f/2,cy:f/2,style:{transform:`rotate(${(v+k)/100*360}deg)`,transformOrigin:"center"}})]}),a.jsxs("div",{className:"absolute flex flex-col items-center",children:[a.jsx("span",{className:"text-xl lg:text-3xl font-bold text-gray-800 dark:text-white",children:g}),a.jsx("span",{className:"text-[10px] lg:text-xs text-gray-500",children:r("analysis.total")})]})]})},x=[{label:r("analysis.totalProjects"),value:c.length,icon:a.jsx(Xy,{className:"w-5 h-5"}),color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-100 dark:border-blue-800"},{label:r("analysis.longTermLabel"),value:d,icon:a.jsx(Qy,{className:"w-5 h-5"}),color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-100 dark:border-purple-800"},{label:r("analysis.shortTermLabel"),value:u,icon:a.jsx(Kg,{className:"w-5 h-5"}),color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-100 dark:border-green-800"},{label:r("analysis.singleTasks"),value:h,icon:a.jsx(Yg,{className:"w-5 h-5"}),color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-50 dark:bg-orange-900/20",borderColor:"border-orange-100 dark:border-orange-800"}];return t==="compact"?a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-blue-600 text-xs font-bold leading-none",children:c.length}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.project")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-orange-600 text-xs font-bold leading-none",children:h}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.single")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-purple-600 text-xs font-bold leading-none",children:d}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.longTermLabel")})]}),a.jsxs("div",{className:"text-center min-w-[28px]",children:[a.jsx("p",{className:"text-green-600 text-xs font-bold leading-none",children:u}),a.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:r("analysis.shortTermLabel")})]})]}):a.jsxs("div",{className:`${o} rounded - 2xl p - 6 lg: p - 8 shadow - sm border border - gray - 100 dark: border - gray - 700`,style:l,children:[a.jsx("div",{className:"flex items-center justify-between mb-8",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:a.jsx(qg,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),a.jsx("h3",{className:"text-lg lg:text-xl font-bold text-gray-900 dark:text-white",children:r("analysis.title")})]})}),a.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-10 lg:gap-16",children:[a.jsxs("div",{className:"flex-shrink-0 relative",children:[a.jsx(m,{size:180}),a.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-sm font-medium text-gray-500 whitespace-nowrap",children:r("analysis.distribution")})]}),a.jsx("div",{className:"flex-1 w-full grid grid-cols-2 gap-4 lg:gap-6",children:x.map((f,p)=>a.jsxs("div",{className:`${f.bgColor} ${f.borderColor} rounded - xl p - 4 lg: p - 5 border transition - all duration - 300 hover: shadow - md hover: -translate - y - 1`,children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsx("div",{className:`p - 2.5 rounded - xl bg - white dark: bg - gray - 800 ${f.color} shadow - sm`,children:f.icon})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:f.label}),a.jsx("p",{className:`text - 2xl lg: text - 3xl font - bold ${f.color} `,children:f.value})]})]},p))})]})]})},JD=({isOpen:t,onClose:e,todoId:r,todoTitle:s="Task",currentUserId:n,initialSharedWith:i,onUpdate:o,isOwner:l=!1})=>{const{t:c}=Xe();return t?Ur.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[10000] flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-md shadow-xl overflow-hidden animate-in fade-in zoom-in duration-200",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100 dark:border-gray-700",children:[a.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[a.jsx(tr,{className:"w-5 h-5 text-blue-500"}),c("sharing.settingsTitle")||"Sharing Settings"]}),a.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:a.jsx(rt,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("div",{className:"p-4",children:a.jsx(t_,{todoId:r,todoTitle:s,currentUserId:n,initialSharedWith:i,onUpdate:o,isOwner:l,onClose:e})})]})}),document.body):null},a0=({isOpen:t,onClose:e,onSelectTemplate:r,mode:s="modal"})=>{const{t:n}=Xe(),{currentUser:i}=wt(),[o,l]=y.useState([]),[c,d]=y.useState(!1),[u,h]=y.useState(null),[g,m]=y.useState(!1),[x,f]=y.useState({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}),[p,w]=y.useState(!1),[v,k]=y.useState(null);y.useEffect(()=>{if(!i?.uid)return;const R=ee.subscribeProjectTemplates(i.uid,B=>{l(B)});return()=>R()},[i?.uid]),y.useEffect(()=>{!t&&s==="modal"&&(h(null),d(!1),f({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}))},[t,s]);const b=async()=>{if(!(!x.name.trim()||!i?.uid)){m(!0);try{ne.log("ìƒˆ í…œí”Œë¦¿ ìƒì„±",{template:x}),await ee.addProjectTemplate(x,i.uid),f({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}),d(!1)}catch(R){ne.error("í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨:",R),alert(n("common.error"))}finally{m(!1)}}},T=async()=>{if(!(!u||!i?.uid)){m(!0);try{ne.log("í…œí”Œë¦¿ ì—…ë°ì´íŠ¸",{template:u});const R=u.subTasks.map(de=>({...de,completedAt:de.completedAt?new Date(de.completedAt):void 0})),{id:B,createdAt:Y,updatedAt:V,...q}=u,z={...q,subTasks:R};await ee.updateProjectTemplate(B,z,i.uid),h(null)}catch(R){ne.error("í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",R),alert(n("common.error"))}finally{m(!1)}}},_=async R=>{if(!(!confirm(n("projectTemplate.deleteConfirm"))||!i?.uid)){m(!0);try{ne.log("í…œí”Œë¦¿ ì‚­ì œ",{templateId:R}),await ee.deleteProjectTemplate(R,i.uid)}catch(B){ne.error("í…œí”Œë¦¿ ì‚­ì œ ì‹¤íŒ¨:",B),alert(n("common.error"))}finally{m(!1)}}},j=async R=>{if(i?.uid){m(!0);try{const{id:B,createdAt:Y,updatedAt:V,...q}=R,z={...q,name:`${R.name} ${n("projectTemplate.copySuffix")}`};ne.log("í…œí”Œë¦¿ ë³µì‚¬",{duplicated:z}),await ee.addProjectTemplate(z,i.uid)}catch(B){ne.error("í…œí”Œë¦¿ ë³µì‚¬ ì‹¤íŒ¨:",B),alert(n("common.error"))}finally{m(!1)}}},N=(R,B)=>{const Y={title:"",completed:!1,priority:"medium"};B({...R,subTasks:[...R.subTasks,Y]})},D=(R,B,Y,V)=>{const q=R.subTasks.map((z,de)=>de===B?{...z,...Y}:z);V({...R,subTasks:q})},$=(R,B,Y)=>{Y({...R,subTasks:R.subTasks.filter((V,q)=>q!==B)})};if(!t&&s==="modal")return null;const C=a.jsxs("div",{className:`bg-white dark:bg-gray-800 ${s==="modal"?"rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden":"h-full flex flex-col"}`,children:[s==="modal"&&a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:n("projectTemplate.title")}),a.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:`p-6 overflow-y-auto ${s==="modal"?"max-h-[calc(90vh-120px)]":"flex-1 custom-scrollbar"}`,children:[a.jsx("div",{className:"mb-6",children:a.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",children:[a.jsx(gt,{className:"w-4 h-4"}),n("projectTemplate.create")]})}),c&&a.jsxs("div",{className:"mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:n("projectTemplate.newTemplate")}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.name")}),a.jsx("input",{type:"text",value:x.name,onChange:R=>f({...x,name:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:n("projectTemplate.namePlaceholder")})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.category")}),a.jsxs("select",{value:x.category,onChange:R=>f({...x,category:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"shortterm",children:n("projectTemplate.shortterm")||n("modal.addTodo.shortTerm")}),a.jsx("option",{value:"longterm",children:n("projectTemplate.longterm")||n("modal.addTodo.longTerm")})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.description")}),a.jsx("textarea",{value:x.description,onChange:R=>f({...x,description:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:3,placeholder:n("projectTemplate.descPlaceholder")})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:n("projectTemplate.subTasks")}),a.jsxs("button",{onClick:()=>N(x,f),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[a.jsx(gt,{className:"w-3 h-3"}),n("projectTemplate.addSubTask")]})]}),a.jsx("div",{className:"space-y-2",children:x.subTasks.map((R,B)=>a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("input",{type:"checkbox",checked:R.completed,onChange:Y=>{const V=new Date;D(x,B,{completed:Y.target.checked,completedAt:Y.target.checked?V:null},f)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),a.jsx("input",{type:"text",value:R.title,onChange:Y=>D(x,B,{title:Y.target.value},f),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-1 focus:ring-blue-500 dark:bg-gray-600 dark:text-white",placeholder:n("projectTemplate.subTaskName")}),a.jsxs("select",{value:R.priority,onChange:Y=>D(x,B,{priority:Y.target.value},f),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",children:[a.jsx("option",{value:"low",children:n("modal.addTodo.low")}),a.jsx("option",{value:"medium",children:n("modal.addTodo.medium")}),a.jsx("option",{value:"high",children:n("modal.addTodo.high")}),a.jsx("option",{value:"urgent",children:n("modal.addTodo.urgent")})]}),R.completed&&R.completedAt&&a.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:["ì™„ë£Œ: ",new Date(R.completedAt).toLocaleString()]}),a.jsx("button",{onClick:()=>$(x,B,f),className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:a.jsx(rt,{className:"w-3 h-3"})})]},B))})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:n("common.cancel")}),a.jsxs("button",{onClick:b,disabled:g,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[g?a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):a.jsx(ei,{className:"w-4 h-4"}),n(g?"projectTemplate.saving":"projectTemplate.save")]})]})]}),u&&a.jsxs("div",{className:"mb-6 p-4 border border-blue-200 dark:border-blue-700 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[a.jsx("h3",{className:"text-lg font-medium mb-4 text-blue-800 dark:text-blue-200",children:n("projectTemplate.editTemplate")}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.name")}),a.jsx("input",{type:"text",value:u.name,onChange:R=>h({...u,name:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:n("projectTemplate.namePlaceholder")})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.category")}),a.jsxs("select",{value:u.category,onChange:R=>h({...u,category:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"shortterm",children:n("projectTemplate.shortterm")||n("modal.addTodo.shortTerm")}),a.jsx("option",{value:"longterm",children:n("projectTemplate.longterm")||n("modal.addTodo.longTerm")})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:n("projectTemplate.description")}),a.jsx("textarea",{value:u.description,onChange:R=>h({...u,description:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:3,placeholder:n("projectTemplate.descPlaceholder")})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:n("projectTemplate.subTasks")}),a.jsxs("button",{onClick:()=>N(u,h),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[a.jsx(gt,{className:"w-3 h-3"}),n("projectTemplate.addSubTask")]})]}),a.jsx("div",{className:"space-y-2",children:u.subTasks.map((R,B)=>a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("input",{type:"checkbox",checked:R.completed,onChange:Y=>{const V=new Date;D(u,B,{completed:Y.target.checked,completedAt:Y.target.checked?V:void 0},h)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),a.jsx("input",{type:"text",value:R.title,onChange:Y=>D(u,B,{title:Y.target.value},h),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-1 focus:ring-blue-500 dark:bg-gray-600 dark:text-white",placeholder:n("projectTemplate.subTaskName")}),a.jsxs("select",{value:R.priority,onChange:Y=>D(u,B,{priority:Y.target.value},h),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",children:[a.jsx("option",{value:"low",children:n("modal.addTodo.low")}),a.jsx("option",{value:"medium",children:n("modal.addTodo.medium")}),a.jsx("option",{value:"high",children:n("modal.addTodo.high")}),a.jsx("option",{value:"urgent",children:n("modal.addTodo.urgent")})]}),R.completed&&R.completedAt&&a.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[n("modal.addTodo.completed")||"ì™„ë£Œ",": ",new Date(R.completedAt).toLocaleString()]}),a.jsx("button",{onClick:()=>$(u,B,h),className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:a.jsx(rt,{className:"w-3 h-3"})})]},B))})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>h(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:n("common.cancel")}),a.jsxs("button",{onClick:T,disabled:g,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[g?a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):a.jsx(ei,{className:"w-4 h-4"}),n(g?"projectTemplate.updating":"projectTemplate.update")]})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(R=>a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:R.name}),a.jsx("span",{className:`text-xs px-2 py-1 rounded ${R.category==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-300":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:R.category==="longterm"?n("projectTemplate.longterm")||"Long-term":n("projectTemplate.shortterm")||"Short-term"})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("button",{onClick:()=>{h(R)},disabled:g,className:"p-1 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:n("common.edit")||"Edit",children:a.jsx(Bg,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>j(R),disabled:g,className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:n("common.copy")||"Copy",children:a.jsx(Jy,{className:"w-3 h-3"})}),a.jsx("button",{onClick:()=>_(R.id),disabled:g,className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:n("common.delete")||"Delete",children:a.jsx(Ut,{className:"w-3 h-3"})})]})]}),R.description&&a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:R.description}),a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:[n("projectTemplate.subTasks"),": ",R.subTasks.length]}),r&&a.jsx("button",{onClick:()=>{r(R),e()},className:"w-full btn-secondary text-sm",children:n("projectTemplate.use")})]},R.id))}),o.length===0&&!c&&a.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[a.jsx("p",{children:n("projectTemplate.empty")}),a.jsx("p",{className:"text-sm",children:n("projectTemplate.emptyHint")})]})]})]});return s==="embedded"?C:a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:C})},ZD=({onCancel:t,onSuccess:e,initialDate:r,preselectedTemplate:s})=>{const{t:n}=Xe(),{addTodo:i,allTags:o}=ot(),{currentUser:l}=wt(),[c,d]=y.useState(""),[u,h]=y.useState(!1),[g,m]=y.useState(""),[x,f]=y.useState(!0),[p,w]=y.useState([]),[v,k]=y.useState(""),[b,T]=y.useState(!1),_={startDate:qe(r||new Date,"yyyy-MM-dd"),startTime:"",dueDate:"",dueTime:"",priority:"medium",tags:[],showStartTime:!1,showDueDate:!1,type:"simple",projectCategory:"shortterm",subTasks:[],description:""},[j,N]=y.useState(_),[D,$]=y.useState({}),[C,R]=y.useState(""),[B,Y]=y.useState(!0),[V,q]=y.useState(!1),[z,de]=y.useState(""),[Te,we]=y.useState(null),[fe,W]=y.useState([]),[le,ie]=y.useState(!1),[be,ye]=y.useState(""),[ke,E]=y.useState(!1),[te,Q]=y.useState(null),[H,I]=y.useState(null),[J,ce]=y.useState([]);y.useEffect(()=>{if(!l?.uid)return;const K=ee.subscribeSharingGroups(l.uid,pe=>ce(pe));return()=>K()},[l?.uid]),y.useEffect(()=>{N(K=>({...K,startDate:qe(r||new Date,"yyyy-MM-dd")}))},[r]),y.useEffect(()=>{if(!l?.uid)return;const K=ee.subscribeProjectTemplates(l.uid,pe=>{w(pe)});return()=>K()},[l?.uid]),y.useEffect(()=>{s&&O(s)},[s]);const O=K=>{let pe;if(typeof K=="string"){if(!K){k("");return}pe=p.find(Fe=>Fe.id===K)}else pe=K;pe&&(k(pe.id),d(pe.name),N(Fe=>({...Fe,type:"project",projectCategory:pe.category,priority:pe.defaultPriority,tags:[...Fe.tags,...pe.tags||[]],subTasks:pe.subTasks.map(X=>({id:crypto.randomUUID(),title:X.title})),description:pe.description||""})))},G=(K,pe)=>{N(Fe=>({...Fe,[K]:pe})),D[K]&&$(Fe=>{const X={...Fe};return delete X[K],X})},M=()=>{g.trim()&&!j.tags.includes(g.trim())&&(G("tags",[...j.tags,g.trim()]),m(""),h(!1))},se=K=>{j.tags.includes(K)?G("tags",j.tags.filter(pe=>pe!==K)):G("tags",[...j.tags,K])},ue=()=>{if(!C.trim())return;const K={id:crypto.randomUUID(),title:C.trim()};G("subTasks",[...j.subTasks,K]),R("")},ge=K=>{G("subTasks",j.subTasks.filter(pe=>pe.id!==K))},re=K=>{const pe=new Date;let Fe=null,X=null,ve=[];K.includes("ì˜¤ëŠ˜")?Fe=pe:K.includes("ë‚´ì¼")?Fe=xs(pe,1):K.includes("ëª¨ë ˆ")&&(Fe=xs(pe,2)),K.includes("!ê¸´ê¸‰")?X="urgent":K.includes("!ë†’ìŒ")?X="high":K.includes("!ë‚®ìŒ")&&(X="low");const Be=K.match(/#(\S+)/g);Be&&(ve=Be.map(L=>L.slice(1)));const S={};return Fe&&(S.startDate=qe(Fe,"yyyy-MM-dd")),X&&(S.priority=X),ve.length>0&&(S.tags=ve),S},Ie=K=>{if(K.preventDefault(),!c.trim()){$(Fe=>({...Fe,text:"í• ì¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"}));return}if(!B&&!V){alert(n("sharing.selectOne")||"Please select at least one task type.");return}const pe={title:c,completed:!1,recurrence:"none",...j,startDate:new Date(`${j.startDate}T${j.startTime||"00:00"}`),dueDate:j.showDueDate&&j.dueDate?new Date(`${j.dueDate}T${j.dueTime||"23:59"}`):void 0,project:j.type==="project"?j.projectCategory:void 0,subTasks:j.type==="project"?j.subTasks.map(Fe=>({...Fe,completed:!1,priority:"medium",createdAt:new Date,updatedAt:new Date})):void 0,ownerId:l?.uid,visibility:{isPersonal:B,isShared:V},sharedWith:V?fe:[],sharedGroupId:V?te:void 0,sharedGroupOwnerId:V?H:void 0};i(pe),e(),d(""),N(_),Y(!0),q(!1),W([]),de(""),Q(null),I(null)};return a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:Ie,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(zg,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.taskTitle")," *"]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{autoFocus:!1,autoComplete:"off",type:"text",value:c,onChange:K=>{if(d(K.target.value),x&&j.type==="simple"){const pe=re(K.target.value);N(Fe=>({...Fe,...pe}))}},placeholder:x&&j.type==="simple"?n("modal.addTodo.naturalLanguageHint"):n("modal.addTodo.placeholder"),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${D.text?"border-red-500":"border-gray-300 dark:border-gray-600"}`}),j.type==="simple"&&a.jsx("button",{type:"button",onClick:()=>f(!x),className:`absolute right-2 top-1/2 -translate-y-1/2 text-xs px-2 py-1 rounded-md transition-colors ${x?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-500 dark:bg-gray-600 dark:text-gray-400"}`,children:x?"âœ¨ ON":"OFF"})]}),D.text&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:D.text})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("modal.addTodo.description")}),a.jsx("textarea",{value:j.description,onChange:K=>G("description",K.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white resize-none",placeholder:n("modal.addTodo.descPlaceholder")})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(Xl,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.type")]}),a.jsxs("select",{value:j.type,onChange:K=>G("type",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"simple",children:n("modal.addTodo.simpleTask")}),a.jsx("option",{value:"project",children:n("modal.addTodo.project")})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(ya,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.priority")]}),a.jsxs("select",{value:j.priority,onChange:K=>G("priority",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"low",children:n("modal.addTodo.low")}),a.jsx("option",{value:"medium",children:n("modal.addTodo.medium")}),a.jsx("option",{value:"high",children:n("modal.addTodo.high")}),a.jsx("option",{value:"urgent",children:n("modal.addTodo.urgent")})]})]})]}),j.type==="project"&&a.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl border border-gray-200 dark:border-gray-700 animate-fadeIn",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:n("modal.addTodo.projectCategory")}),a.jsxs("button",{type:"button",onClick:()=>T(!0),className:"text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 font-medium flex items-center gap-1",children:[a.jsx(Zy,{className:"w-3 h-3"}),n("modal.addTodo.manageTemplates")]})]}),p.length>0&&a.jsxs("select",{value:v,onChange:K=>O(K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"",children:n("modal.addTodo.noTemplate")}),p.map(K=>a.jsxs("option",{value:K.id,children:[K.name," (",K.subTasks.length,"ê°œ í•˜ìœ„ì‘ì—…)"]},K.id))]}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"shortterm",checked:j.projectCategory==="shortterm",onChange:K=>G("projectCategory",K.target.value),className:"mr-2"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("modal.addTodo.shortTerm")})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"longterm",checked:j.projectCategory==="longterm",onChange:K=>G("projectCategory",K.target.value),className:"mr-2"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("modal.addTodo.longTerm")})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(qg,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.subtasks")," (",j.subTasks.length,")"]}),a.jsx("div",{className:"space-y-2 mb-2",children:j.subTasks.map((K,pe)=>a.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded-lg border border-gray-200 dark:border-gray-700",children:[a.jsx("span",{className:"text-xs text-gray-500 font-mono",children:pe+1}),a.jsx("span",{className:"flex-1 text-sm text-gray-700 dark:text-gray-300",children:K.title}),a.jsx("button",{type:"button",onClick:()=>ge(K.id),className:"text-red-400 hover:text-red-600",children:a.jsx(Ut,{className:"w-4 h-4"})})]},K.id))}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:C,onChange:K=>R(K.target.value),onKeyPress:K=>K.key==="Enter"&&(K.preventDefault(),ue()),placeholder:n("modal.addTodo.addSubtaskPlaceholder"),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"}),a.jsx("button",{type:"button",onClick:ue,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:n("common.add")})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(at,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.startDate")]}),a.jsx("input",{type:"date",value:j.startDate,onChange:K=>G("startDate",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(gr,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.startTime")]}),a.jsx("input",{type:"time",value:j.startTime,onChange:K=>G("startTime",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),a.jsxs("div",{className:"border-t border-gray-100 dark:border-gray-700 pt-4",children:[a.jsxs("button",{type:"button",onClick:()=>G("showDueDate",!j.showDueDate),className:"flex items-center text-sm text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors mb-2",children:[j.showDueDate?a.jsx(Gg,{className:"w-4 h-4 mr-1"}):a.jsx(pa,{className:"w-4 h-4 mr-1"}),j.showDueDate?n("modal.addTodo.hideDueDate"):n("modal.addTodo.showDueDate")]}),j.showDueDate&&a.jsxs("div",{className:"grid grid-cols-2 gap-4 animate-fadeIn",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("modal.addTodo.dueDate")}),a.jsx("input",{type:"date",value:j.dueDate,onChange:K=>G("dueDate",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("modal.addTodo.dueTime")}),a.jsx("input",{type:"time",value:j.dueTime,onChange:K=>G("dueTime",K.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]})]}),a.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4 bg-gray-50 dark:bg-gray-800/50",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("sharing.settingsTitle")||"Sharing"}),a.jsxs("div",{className:"flex space-x-4 mb-3",children:[a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:B,onChange:K=>Y(K.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("sharing.myTask")||"My Task"})]}),a.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:V,onChange:K=>q(K.target.checked),className:"form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("sharing.sharedTask")||"Shared Task"})]})]}),V&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"ê³µìœ  ëŒ€ìƒ ì„ íƒ"}),a.jsxs("select",{value:fe.length>0?fe.map(K=>K.uid).sort().join(","):"",onChange:K=>{const pe=K.target.value;if(pe){const Fe=J.find(X=>X.id===pe);Fe&&(W(Fe.members||[]),Fe.isReference?(Q(Fe.originalGroupId||null),I(Fe.originalOwnerId||null)):(Q(pe),I(l?.uid||null)))}else W([]),Q(null),I(null)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm",children:[a.jsx("option",{value:"",children:"-- ê³µìœ  ëŒ€ìƒ ì„ íƒ ë˜ëŠ” ì§ì ‘ ì¶”ê°€ --"}),J.map(K=>a.jsxs("option",{value:K.id,children:["ğŸ‘¥ ",K.name," (",K.members.length,"ëª…)"]},K.id))]}),J.length===0&&a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:'ğŸ’¡ ê³µìœ  ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì´ë“œë°” "ê³µìœ  ì„¤ì •"ì—ì„œ ë¨¼ì € ê·¸ë£¹ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.'})]}),fe.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(K=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full text-xs text-gray-600 dark:text-gray-300",children:[a.jsx("span",{className:"w-4 h-4 rounded-full bg-gray-100 dark:bg-gray-600 flex items-center justify-center text-[10px] font-bold",children:K.displayName?.[0]||K.email[0].toUpperCase()}),K.displayName||K.email.split("@")[0]]},K.uid))})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(el,{className:"w-4 h-4 inline mr-1"}),n("modal.addTodo.tags")]}),a.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[o.map(K=>a.jsxs("button",{type:"button",onClick:()=>se(K),className:`px-3 py-1 rounded-full text-sm transition-colors ${j.tags.includes(K)?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["#",K]},K)),a.jsx("button",{type:"button",onClick:()=>h(!0),className:"px-3 py-1 rounded-full text-sm border border-dashed border-gray-300 text-gray-500 hover:border-gray-400 hover:text-gray-600 transition-colors",children:n("modal.addTodo.addTag")})]}),u&&a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:g,onChange:K=>m(K.target.value),placeholder:n("modal.addTodo.newTagPlaceholder"),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",onKeyPress:K=>K.key==="Enter"&&(K.preventDefault(),M())}),a.jsx("button",{type:"button",onClick:M,className:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:n("common.add")})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:n("common.cancel")}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(gt,{className:"w-4 h-4"}),n("modal.addTodo.submit")]})]})]}),a.jsx(a0,{isOpen:b,onClose:()=>T(!1),onSelectTemplate:O}),a.jsx(JD,{isOpen:ke,onClose:()=>E(!1),initialSharedWith:fe,onUpdate:K=>{W(K),K.length>0&&q(!0)},currentUserId:l?.uid})]})},eC=({onCancel:t,onSuccess:e})=>{const{addRecurringTemplate:r,recurringTemplates:s}=ot(),{t:n}=Xe(),[i,o]=y.useState({title:"",description:"",priority:"medium",type:"simple",recurrenceType:"daily",weekday:1,monthlyDate:1,monthlyPattern:"date",monthlyWeek:"first",monthlyWeekday:3,tags:[],exceptions:[],holidayHandling:"show"}),[l,c]=y.useState(!1),d=()=>{o(v=>({...v,exceptions:[...v.exceptions,{type:"date",values:[]}]}))},u=v=>{o(k=>({...k,exceptions:k.exceptions.filter((b,T)=>T!==v)}))},h=(v,k,b)=>{o(T=>({...T,exceptions:T.exceptions.map((_,j)=>j===v?{..._,[k]:b}:_)}))},g=(v,k)=>{o(b=>({...b,exceptions:b.exceptions.map((T,_)=>_===v?{...T,values:k}:T)}))},m=v=>{const b=i.exceptions[v].values||[],T={targetTemplateTitle:"",scope:"same_week"};g(v,[...b,T])},x=(v,k)=>{const T=i.exceptions[v].values||[];g(v,T.filter((_,j)=>j!==k))},f=(v,k,b,T)=>{const N=(i.exceptions[v].values||[]).map((D,$)=>$===k?{...D,[b]:T}:D);g(v,N)},p=[{value:0,label:n("days.sunday")},{value:1,label:n("days.monday")},{value:2,label:n("days.tuesday")},{value:3,label:n("days.wednesday")},{value:4,label:n("days.thursday")},{value:5,label:n("days.friday")},{value:6,label:n("days.saturday")}],w=async v=>{if(v.preventDefault(),!!i.title.trim()){c(!0);try{const k={title:i.title.trim(),description:i.description.trim()||void 0,priority:i.priority,type:i.type,recurrenceType:i.recurrenceType,isActive:!0,tags:i.tags,exceptions:i.exceptions,holidayHandling:i.holidayHandling};i.recurrenceType==="weekly"?k.weekday=i.weekday:i.recurrenceType==="monthly"&&(i.monthlyPattern==="weekday"?(k.monthlyPattern="weekday",k.monthlyWeek=i.monthlyWeek,k.monthlyWeekday=i.monthlyWeekday):(k.monthlyPattern="date",k.monthlyDate=i.monthlyDate)),await r(k),e(),o({title:"",description:"",priority:"medium",type:"simple",recurrenceType:"daily",weekday:1,monthlyDate:1,monthlyPattern:"date",monthlyWeek:"first",monthlyWeekday:3,tags:[],exceptions:[],holidayHandling:"show"})}catch(k){console.error("ë°˜ë³µ í…œí”Œë¦¿ ì¶”ê°€ ì‹¤íŒ¨:",k),alert(n("common.error"))}finally{c(!1)}}};return a.jsxs("form",{onSubmit:w,className:"space-y-6",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.title")}),a.jsx("input",{type:"text",value:i.title,onChange:v=>o({...i,title:v.target.value}),placeholder:n("modal.addTodo.placeholder"),className:"w-full text-lg px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.description")}),a.jsx("textarea",{value:i.description,onChange:v=>o({...i,description:v.target.value}),placeholder:n("modal.addTodo.descPlaceholder"),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white resize-none",rows:2})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(ya,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.priority")]}),a.jsx("div",{className:"flex gap-2",children:[{value:"urgent",label:n("modal.addTodo.urgent"),color:"text-red-700 bg-red-100 dark:bg-red-900/40 border-red-200 dark:border-red-800"},{value:"high",label:n("modal.addTodo.high"),color:"text-orange-700 bg-orange-100 dark:bg-orange-900/40 border-orange-200 dark:border-orange-800"},{value:"medium",label:n("modal.addTodo.medium"),color:"text-yellow-700 bg-yellow-100 dark:bg-yellow-900/40 border-yellow-200 dark:border-yellow-800"},{value:"low",label:n("modal.addTodo.low"),color:"text-green-700 bg-green-100 dark:bg-green-900/40 border-green-200 dark:border-green-800"}].map(v=>a.jsxs("label",{className:`flex-1 flex items-center justify-center p-2 rounded-lg cursor-pointer transition-all border ${i.priority===v.value?`ring-2 ring-offset-1 ring-blue-500 ${v.color} font-bold`:"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[a.jsx("input",{type:"radio",name:"priority",value:v.value,checked:i.priority===v.value,onChange:k=>o({...i,priority:k.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:v.label})]},v.value))})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(Xg,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.recurrenceType")]}),a.jsxs("select",{value:i.recurrenceType,onChange:v=>o({...i,recurrenceType:v.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"daily",children:n("recurring.form.daily")}),a.jsx("option",{value:"weekly",children:n("recurring.form.weekly")}),a.jsx("option",{value:"monthly",children:n("recurring.form.monthly")})]})]}),i.recurrenceType==="weekly"&&a.jsxs("div",{className:"animate-fadeIn",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectWeekday")}),a.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:p.map(v=>a.jsx("button",{type:"button",onClick:()=>o({...i,weekday:v.value}),className:`flex-1 min-w-[60px] py-2 rounded-lg text-sm font-medium transition-colors ${i.weekday===v.value?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 ring-2 ring-blue-500":"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:v.label},v.value))})]}),i.recurrenceType==="monthly"&&a.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.monthlyPattern")}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:i.monthlyPattern==="date",onChange:()=>o({...i,monthlyPattern:"date"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byDate")})]}),a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:i.monthlyPattern==="weekday",onChange:()=>o({...i,monthlyPattern:"weekday"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byWeekday")})]})]})]}),i.monthlyPattern==="date"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectDate")}),a.jsxs("select",{value:i.monthlyDate,onChange:v=>o({...i,monthlyDate:parseInt(v.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[Array.from({length:31},(v,k)=>k+1).map(v=>a.jsxs("option",{value:v,children:[v,n("calendar.daySuffix",{defaultValue:""})]},v)),a.jsx("option",{value:-1,children:n("recurring.form.lastDay")}),a.jsx("option",{value:-2,children:n("recurring.form.firstWorkDay")}),a.jsx("option",{value:-3,children:n("recurring.form.lastWorkDay")})]})]}),i.monthlyPattern==="weekday"&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.week")}),a.jsxs("select",{value:i.monthlyWeek,onChange:v=>o({...i,monthlyWeek:v.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"first",children:n("recurring.firstWeek")}),a.jsx("option",{value:"second",children:n("recurring.secondWeek")}),a.jsx("option",{value:"third",children:n("recurring.thirdWeek")}),a.jsx("option",{value:"fourth",children:n("recurring.fourthWeek")}),a.jsx("option",{value:"last",children:n("recurring.lastWeek")})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.weekday")}),a.jsx("select",{value:i.monthlyWeekday,onChange:v=>o({...i,monthlyWeekday:parseInt(v.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:p.map(v=>a.jsx("option",{value:v.value,children:v.label},v.value))})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.holidayHandling")}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"before",label:n("recurring.form.moveBefore")},{value:"after",label:n("recurring.form.moveAfter")},{value:"show",label:n("recurring.form.show")}].map(v=>a.jsxs("label",{className:`flex items-center justify-center p-2 rounded-lg cursor-pointer border transition-all ${i.holidayHandling===v.value?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/30 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-200 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:[a.jsx("input",{type:"radio",name:"holidayHandling",value:v.value,checked:i.holidayHandling===v.value,onChange:k=>o({...i,holidayHandling:k.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:v.label})]},v.value))})]}),a.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a.jsx(Ql,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.exceptionSettings")]}),a.jsxs("button",{type:"button",onClick:d,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[a.jsx(gt,{className:"w-3 h-3"}),n("recurring.form.addException")]})]}),i.exceptions.map((v,k)=>a.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl space-y-3 border border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("select",{value:v.type,onChange:b=>h(k,"type",b.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white mr-2",children:[a.jsx("option",{value:"date",children:n("recurring.form.byDateOption")}),a.jsx("option",{value:"weekday",children:n("recurring.form.byWeekdayOption")}),a.jsx("option",{value:"week",children:n("recurring.form.byWeekOption")}),a.jsx("option",{value:"month",children:n("recurring.form.byMonthOption")}),a.jsx("option",{value:"conflict",children:n("recurring.form.conflictOption")})]}),a.jsx("button",{type:"button",onClick:()=>u(k),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:a.jsx(Ut,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[v.type==="date"&&Array.from({length:31},(b,T)=>T+1).map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b),onChange:T=>{const _=v.values,j=T.target.checked?[..._,b]:_.filter(N=>N!==b);g(k,j)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[b,n("calendar.daySuffix",{defaultValue:""})]})]},b)),v.type==="weekday"&&p.map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b.value),onChange:T=>{const _=v.values,j=T.target.checked?[..._,b.value]:_.filter(N=>N!==b.value);g(k,j)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:b.label})]},b.value)),v.type==="week"&&[1,2,3,4,-1].map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b),onChange:T=>{const _=v.values,j=T.target.checked?[..._,b]:_.filter(N=>N!==b);g(k,j)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:$i(b)})]},b)),v.type==="month"&&Array.from({length:12},(b,T)=>T+1).map(b=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:v.values.includes(b),onChange:T=>{const _=v.values,j=T.target.checked?[..._,b]:_.filter(N=>N!==b);g(k,j)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[b,n("common.monthSuffix",{defaultValue:"ì›”"})]})]},b))]}),v.type==="conflict"&&a.jsxs("div",{className:"space-y-3",children:[(v.values||[]).map((b,T)=>a.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:[n("recurring.form.conflictRule")," ",T+1]}),a.jsx("button",{type:"button",onClick:()=>x(k,T),className:"text-red-500 hover:text-red-700 p-1",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.targetTemplate")}),a.jsxs("select",{value:b.targetTemplateTitle,onChange:_=>f(k,T,"targetTemplateTitle",_.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"",children:n("recurring.form.selectTemplate")}),s.map(_=>a.jsx("option",{value:_.title,children:_.title},_.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.conflictCondition")}),a.jsxs("select",{value:b.scope,onChange:_=>f(k,T,"scope",_.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"same_date",children:n("recurring.form.sameDate")}),a.jsx("option",{value:"same_week",children:n("recurring.form.sameWeek")}),a.jsx("option",{value:"same_month",children:n("recurring.form.sameMonth")})]})]})]})]},T)),a.jsxs("button",{type:"button",onClick:()=>m(k),className:"w-full py-2 px-3 text-sm border-2 border-dashed border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center gap-2",children:[a.jsx(gt,{className:"w-4 h-4"}),n("recurring.form.addConflictRule")]})]})]},k))]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:t,className:"px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",disabled:l,children:n("common.cancel")}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-0.5 font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:l||!i.title.trim(),children:[a.jsx(gt,{className:"w-4 h-4"}),n(l?"recurring.form.saving":"recurring.addTemplate")]})]})]})},i0=({isOpen:t,onClose:e,initialDate:r,initialTab:s="todo"})=>{const{t:n}=Xe(),[i,o]=y.useState(s),[l,c]=y.useState(null);y.useEffect(()=>{t&&(o(s),c(null))},[t,s]);const d=u=>{c(u),o("todo")};return t?a.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:e}),a.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:a.jsxs("div",{className:"relative w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[a.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 shrink-0",children:[a.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[i==="todo"&&n("modal.addTodo.title"),i==="recurring"&&(n("recurring.title")||"Add Recurring Task"),i==="template"&&(n("projectTemplate.title")||"Manage Templates")]}),a.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 shrink-0",children:[a.jsxs("button",{onClick:()=>o("todo"),className:`flex-1 py-3 text-sm font-medium transition-colors border-b-2 ${i==="todo"?"border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[n("modal.addTodo.simpleTask")," / ",n("modal.addTodo.project")]}),a.jsx("button",{onClick:()=>o("recurring"),className:`flex-1 py-3 text-sm font-medium transition-colors border-b-2 ${i==="recurring"?"border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:n("recurring.title")||"Repeating Task"}),a.jsx("button",{onClick:()=>o("template"),className:`flex-1 py-3 text-sm font-medium transition-colors border-b-2 ${i==="template"?"border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:n("projectTemplate.manage")||"Templates"})]}),a.jsxs("div",{className:"p-6 overflow-y-auto min-h-0 flex-1",children:[i==="todo"&&a.jsx(ZD,{onCancel:e,onSuccess:e,initialDate:r,preselectedTemplate:l}),i==="recurring"&&a.jsx(eC,{onCancel:e,onSuccess:e}),i==="template"&&a.jsx(a0,{isOpen:!0,onClose:()=>o("todo"),onSelectTemplate:d,mode:"embedded"})]})]})})]}):null},tC=()=>{const{recurringTemplates:t,recurringInstances:e,updateRecurringTemplate:r,deleteRecurringTemplate:s,cleanupDuplicateTemplates:n}=ot(),{t:i}=Xe(),{currentTheme:o,isDark:l}=Lt(),c=!!o.bg,[d,u]=y.useState("templates"),[h,g]=y.useState(!1),[m,x]=y.useState(!1),[f,p]=y.useState(null),[w,v]=y.useState({excludeWeeks:[],excludeDates:[]});y.useEffect(()=>{try{const C=localStorage.getItem("globalRecurringExceptions");C&&v(JSON.parse(C))}catch(C){console.error("ì˜ˆì™¸ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:",C)}},[]);const k=C=>{try{localStorage.setItem("globalRecurringExceptions",JSON.stringify(C)),v(C)}catch(R){console.error("ì˜ˆì™¸ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:",R)}},b=C=>{const R={...w},B=R.excludeWeeks.indexOf(C);B===-1?R.excludeWeeks.push(C):R.excludeWeeks.splice(B,1),k(R)},T=t.filter(C=>C.isActive),_=t.filter(C=>!C.isActive),j=async C=>{const R=t.find(B=>B.id===C);R&&await r(C,{isActive:!R.isActive})},N=async C=>{confirm("ì´ ë°˜ë³µ í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&await s(C)},D=C=>{p(C),x(!0)},$=C=>{if(C.recurrenceType==="weekly")return`ë§¤ì£¼ ${["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][C.weekday||0]}ìš”ì¼`;if(C.recurrenceType==="monthly")if(C.monthlyPattern==="weekday"&&C.monthlyWeek&&C.monthlyWeekday!==void 0){const R=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];return`ë§¤ì›” ${{first:"ì²« ë²ˆì§¸",second:"ë‘ ë²ˆì§¸",third:"ì„¸ ë²ˆì§¸",fourth:"ë„¤ ë²ˆì§¸",last:"ë§ˆì§€ë§‰"}[C.monthlyWeek]} ì£¼ ${R[C.monthlyWeekday]}ìš”ì¼`}else return C.monthlyDate===-1?"ë§¤ì›” ë§ì¼":C.monthlyDate===-2?"ë§¤ì›” ì²« ë²ˆì§¸ ê·¼ë¬´ì¼":C.monthlyDate===-3?"ë§¤ì›” ë§ˆì§€ë§‰ ê·¼ë¬´ì¼":`ë§¤ì›” ${C.monthlyDate}ì¼`;return"ë§¤ì¼"};return a.jsxs("div",{className:`space-y-6 transition-all duration-300 ${c?"rounded-2xl border border-white/20 shadow-lg backdrop-blur-md":"glass-card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:i("recurring.title")}),a.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-0.5 font-medium",children:[a.jsx(gt,{className:"w-4 h-4"}),i("recurring.addTemplate")]})]}),a.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:a.jsxs("nav",{className:"flex justify-between",children:[a.jsx("button",{onClick:()=>u("templates"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="templates"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:i("recurring.templates")}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx("button",{onClick:()=>u("exceptions"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="exceptions"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:i("recurring.exceptions")}),a.jsx("button",{onClick:()=>u("holidays"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="holidays"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:i("recurring.holidays")})]})]})}),d==="templates"&&a.jsxs("div",{className:"space-y-6",children:[T.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[a.jsx(Jo,{className:"w-5 h-5 text-green-600"}),i("recurring.activeTemplates")," (",T.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(C=>a.jsx("div",{className:`p-3 border-green-200 dark:border-green-800 transition-all ${c?"rounded-xl backdrop-blur-sm hover:bg-green-50/30":"card bg-green-50 dark:bg-green-900/10"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1 truncate",children:C.title}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 whitespace-nowrap overflow-hidden text-ellipsis",children:$(C)})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx("span",{className:`px-2 py-1 rounded text-xs ${C.priority==="urgent"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300":C.priority==="high"?"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300":C.priority==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"}`,children:C.priority==="urgent"?i("modal.addTodo.urgent"):C.priority==="high"?i("modal.addTodo.high"):C.priority==="medium"?i("modal.addTodo.medium"):i("modal.addTodo.low")}),a.jsx("button",{onClick:()=>D(C),className:"p-1 hover:bg-blue-100 dark:hover:bg-blue-800 rounded",title:i("recurring.edit")||"Edit",children:a.jsx(Hg,{className:"w-4 h-4 text-blue-600"})}),a.jsx("button",{onClick:()=>j(C.id),className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded",title:i("recurring.pause")||"Pause",children:a.jsx(Ed,{className:"w-4 h-4 text-green-600"})}),a.jsx("button",{onClick:()=>N(C.id),className:"p-1 hover:bg-red-100 dark:hover:bg-red-800 rounded",title:i("recurring.delete")||"Delete",children:a.jsx(Ut,{className:"w-4 h-4 text-red-600"})})]})]})},C.id))})]}),_.length>0&&a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[a.jsx(Ed,{className:"w-5 h-5 text-gray-500"}),i("recurring.inactiveTemplates")," (",_.length,")"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map(C=>a.jsx("div",{className:`p-3 opacity-75 border-gray-200 dark:border-gray-700 transition-all ${c?"rounded-xl backdrop-blur-sm hover:bg-white/20":"card bg-gray-50 dark:bg-gray-800"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.1)`}:{},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-600 dark:text-gray-300 mb-1 truncate",children:C.title}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap overflow-hidden text-ellipsis",children:$(C)})]}),a.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[a.jsx("button",{onClick:()=>j(C.id),className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded",title:i("recurring.resume")||"Resume",children:a.jsx(Jo,{className:"w-4 h-4 text-green-600"})}),a.jsx("button",{onClick:()=>N(C.id),className:"p-1 hover:bg-red-100 dark:hover:bg-red-800 rounded",title:i("recurring.delete")||"Delete",children:a.jsx(Ut,{className:"w-4 h-4 text-red-600"})})]})]})},C.id))})]}),t.length===0&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(at,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:i("recurring.empty")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:i("recurring.emptyHint")}),a.jsx("button",{onClick:()=>g(!0),className:"btn-primary",children:i("recurring.addFirst")})]})]}),d==="exceptions"&&a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:`p-4 transition-all ${c?"rounded-xl backdrop-blur-sm border border-white/20":"card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:i("recurring.exceptionTitle")}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200 mb-3",children:i("recurring.monthlySettings")}),a.jsxs("div",{className:"flex gap-1 justify-between overflow-hidden",children:[a.jsx("div",{className:"text-center px-1 py-1 bg-blue-50 dark:bg-blue-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-blue-700 dark:text-blue-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.firstWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-green-50 dark:bg-green-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-green-700 dark:text-green-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.secondWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-yellow-50 dark:bg-yellow-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-yellow-700 dark:text-yellow-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.thirdWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-purple-50 dark:bg-purple-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-purple-700 dark:text-purple-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.fourthWeek")})}),a.jsx("div",{className:"text-center px-1 py-1 bg-red-50 dark:bg-red-900/30 rounded flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-red-700 dark:text-red-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.lastWeek")})})]}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-3",children:i("recurring.weekHint")})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[a.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200 mb-3",children:i("recurring.excludeSettings")}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex gap-1 justify-between overflow-hidden",children:[a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-blue-50 dark:bg-blue-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-blue-700 dark:text-blue-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.firstWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(1),onChange:()=>b(1)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-green-50 dark:bg-green-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-green-700 dark:text-green-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.secondWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(2),onChange:()=>b(2)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-yellow-50 dark:bg-yellow-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-yellow-700 dark:text-yellow-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.thirdWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(3),onChange:()=>b(3)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-purple-50 dark:bg-purple-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-purple-700 dark:text-purple-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.fourthWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(4),onChange:()=>b(4)})]}),a.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-red-50 dark:bg-red-900/30 rounded cursor-pointer flex-1 min-w-0",children:[a.jsx("span",{className:"text-red-700 dark:text-red-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:i("recurring.lastWeek")}),a.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:w.excludeWeeks.includes(5),onChange:()=>b(5)})]})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("recurring.excludeHint")}),w.excludeWeeks.length>0&&a.jsxs("div",{className:"mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[a.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 font-medium",children:[i("recurring.currentExcluded"),": ",w.excludeWeeks.map(C=>$i(C)).join(", ")]}),a.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:i("recurring.excludedHint")})]})]}),a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200",children:i("recurring.exceptionDateTitle")}),a.jsx("button",{className:"btn-secondary px-2 py-1 whitespace-nowrap",style:{fontSize:"clamp(10px, 2vw, 14px)"},children:i("recurring.addExceptionDate")})]}),a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded-lg",children:a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:i("recurring.exceptionDateHint")})})]})]})]})]})}),d==="holidays"&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(Qg,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:i("recurring.holidayTitle")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:i("recurring.holidayDesc")}),a.jsxs("div",{className:`p-6 max-w-md mx-auto transition-all ${c?"rounded-xl backdrop-blur-sm border border-white/20":"card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:[a.jsx("h4",{className:"font-medium mb-3",children:i("recurring.plannedFeatures")}),a.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 text-left space-y-2",children:[a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.vacation",{defaultValue:"Vacation Scheduling"})]}),a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.autoAdjust",{defaultValue:"Auto-adjust Recurring Tasks"})]}),a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.notification",{defaultValue:"Vacation Alerts"})]}),a.jsxs("li",{children:["â€¢ ",i("recurring.plannedFeatureList.holidaySync",{defaultValue:"Holiday Sync"})]})]})]})]}),a.jsx("div",{className:`p-4 transition-all ${c?"rounded-xl backdrop-blur-sm border border-white/20":"card"}`,style:c?{backgroundColor:`rgba(${l?"0, 0, 0":"255, 255, 255"}, 0.2)`}:{},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i("recurring.totalTemplates")}),a.jsx("p",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:t.length})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i("recurring.active")}),a.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:T.length})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i("recurring.todayInstances")}),a.jsx("p",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:e.filter(C=>{const R=new Date().toDateString();return new Date(C.date).toDateString()===R}).length})]})]})}),a.jsx(i0,{isOpen:h,onClose:()=>g(!1),initialTab:"recurring"}),m&&f&&a.jsx(rC,{template:f,onClose:()=>{x(!1),p(null)},onSave:async C=>{await r(f.id,C),x(!1),p(null)}})]})},rC=({template:t,onClose:e,onSave:r})=>{const{recurringTemplates:s}=ot(),{t:n}=Xe(),{currentTheme:i}=Lt(),o=!!i.bg,[l,c]=y.useState({title:t.title,description:t.description||"",priority:t.priority,type:t.type,recurrenceType:t.recurrenceType,weekday:t.weekday||0,monthlyDate:t.monthlyDate||1,monthlyPattern:t.monthlyPattern||"date",monthlyWeek:t.monthlyWeek||"first",monthlyWeekday:t.monthlyWeekday||3,tags:t.tags||[],exceptions:t.exceptions||[],holidayHandling:t.holidayHandling||"show"}),[d,u]=y.useState(!1);y.useEffect(()=>{c({title:t.title,description:t.description||"",priority:t.priority,type:t.type,recurrenceType:t.recurrenceType,weekday:t.weekday||0,monthlyDate:t.monthlyDate||1,monthlyPattern:t.monthlyPattern||"date",monthlyWeek:t.monthlyWeek||"first",monthlyWeekday:t.monthlyWeekday||3,tags:t.tags||[],exceptions:t.exceptions||[],holidayHandling:t.holidayHandling||"show"})},[t]);const h=()=>{c(b=>({...b,exceptions:[...b.exceptions,{type:"date",values:[]}]}))},g=b=>{c(T=>({...T,exceptions:T.exceptions.filter((_,j)=>j!==b)}))},m=(b,T,_)=>{c(j=>({...j,exceptions:j.exceptions.map((N,D)=>D===b?{...N,[T]:_}:N)}))},x=(b,T)=>{c(_=>({..._,exceptions:_.exceptions.map((j,N)=>N===b?{...j,values:T}:j)}))},f=b=>{const _=l.exceptions[b].values||[],j={targetTemplateTitle:"",scope:"same_week"};x(b,[..._,j])},p=(b,T)=>{const j=l.exceptions[b].values||[];x(b,j.filter((N,D)=>D!==T))},w=(b,T,_,j)=>{const $=(l.exceptions[b].values||[]).map((C,R)=>R===T?{...C,[_]:j}:C);x(b,$)},v=[{value:0,label:n("days.sunday")},{value:1,label:n("days.monday")},{value:2,label:n("days.tuesday")},{value:3,label:n("days.wednesday")},{value:4,label:n("days.thursday")},{value:5,label:n("days.friday")},{value:6,label:n("days.saturday")}],k=async b=>{b.preventDefault(),u(!0);try{const T={title:l.title.trim(),description:l.description.trim()||void 0,priority:l.priority,type:l.type,recurrenceType:l.recurrenceType,tags:l.tags,exceptions:l.exceptions,holidayHandling:l.holidayHandling,updatedAt:new Date};l.recurrenceType==="weekly"?T.weekday=l.weekday:l.recurrenceType==="monthly"&&(l.monthlyPattern==="weekday"?(T.monthlyPattern="weekday",T.monthlyWeek=l.monthlyWeek,T.monthlyWeekday=l.monthlyWeekday):(T.monthlyPattern="date",T.monthlyDate=l.monthlyDate)),await r(T),e()}catch(T){console.error("í…œí”Œë¦¿ ìˆ˜ì • ì‹¤íŒ¨:",T),alert(n("recurring.updateError"))}finally{u(!1)}};return a.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[a.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm transition-opacity",onClick:e}),a.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:a.jsxs("form",{onSubmit:k,className:`relative w-full max-w-2xl rounded-2xl shadow-2xl p-6 transform transition-all ${o?"glass-card backdrop-blur-xl border border-white/20":"bg-white dark:bg-gray-800"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:n("recurring.editModalTitle")}),a.jsx("button",{type:"button",onClick:e,className:"p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.title")}),a.jsx("input",{type:"text",value:l.title,onChange:b=>c({...l,title:b.target.value}),className:"w-full text-lg px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.description")}),a.jsx("textarea",{value:l.description,onChange:b=>c({...l,description:b.target.value}),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border-0 rounded-xl focus:ring-2 focus:ring-blue-500 placeholder-gray-400 dark:text-white resize-none",rows:2})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(ya,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.priority")]}),a.jsx("div",{className:"flex gap-2",children:[{value:"urgent",label:n("modal.addTodo.urgent"),color:"text-red-700 bg-red-100 dark:bg-red-900/40 border-red-200 dark:border-red-800"},{value:"high",label:n("modal.addTodo.high"),color:"text-orange-700 bg-orange-100 dark:bg-orange-900/40 border-orange-200 dark:border-orange-800"},{value:"medium",label:n("modal.addTodo.medium"),color:"text-yellow-700 bg-yellow-100 dark:bg-yellow-900/40 border-yellow-200 dark:border-yellow-800"},{value:"low",label:n("modal.addTodo.low"),color:"text-green-700 bg-green-100 dark:bg-green-900/40 border-green-200 dark:border-green-800"}].map(b=>a.jsxs("label",{className:`flex-1 flex items-center justify-center p-2 rounded-lg cursor-pointer transition-all border ${l.priority===b.value?`ring-2 ring-offset-1 ring-blue-500 ${b.color} font-bold`:"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[a.jsx("input",{type:"radio",name:"priority",value:b.value,checked:l.priority===b.value,onChange:T=>c({...l,priority:T.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:b.label})]},b.value))})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[a.jsx(Xg,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.recurrenceType")]}),a.jsxs("select",{value:l.recurrenceType,onChange:b=>c({...l,recurrenceType:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"daily",children:n("recurring.form.daily")}),a.jsx("option",{value:"weekly",children:n("recurring.form.weekly")}),a.jsx("option",{value:"monthly",children:n("recurring.form.monthly")})]})]}),l.recurrenceType==="weekly"&&a.jsxs("div",{className:"animate-fadeIn",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectWeekday")}),a.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:v.map(b=>a.jsx("button",{type:"button",onClick:()=>c({...l,weekday:b.value}),className:`flex-1 min-w-[60px] py-2 rounded-lg text-sm font-medium transition-colors ${l.weekday===b.value?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 ring-2 ring-blue-500":"bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:b.label},b.value))})]}),l.recurrenceType==="monthly"&&a.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.monthlyPattern")}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:l.monthlyPattern==="date",onChange:()=>c({...l,monthlyPattern:"date"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byDate")})]}),a.jsxs("label",{className:"flex items-center p-3 rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors flex-1",children:[a.jsx("input",{type:"radio",checked:l.monthlyPattern==="weekday",onChange:()=>c({...l,monthlyPattern:"weekday"}),className:"mr-3 w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n("recurring.form.byWeekday")})]})]})]}),l.monthlyPattern==="date"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.selectDate")}),a.jsxs("select",{value:l.monthlyDate,onChange:b=>c({...l,monthlyDate:parseInt(b.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[Array.from({length:31},(b,T)=>T+1).map(b=>a.jsxs("option",{value:b,children:[b,n("calendar.daySuffix",{defaultValue:""})]},b)),a.jsx("option",{value:-1,children:n("recurring.form.lastDay")}),a.jsx("option",{value:-2,children:n("recurring.form.firstWorkDay")}),a.jsx("option",{value:-3,children:n("recurring.form.lastWorkDay")})]})]}),l.monthlyPattern==="weekday"&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.week")}),a.jsxs("select",{value:l.monthlyWeek,onChange:b=>c({...l,monthlyWeek:b.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"first",children:n("recurring.firstWeek")}),a.jsx("option",{value:"second",children:n("recurring.secondWeek")}),a.jsx("option",{value:"third",children:n("recurring.thirdWeek")}),a.jsx("option",{value:"fourth",children:n("recurring.fourthWeek")}),a.jsx("option",{value:"last",children:n("recurring.lastWeek")})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.weekday")}),a.jsx("select",{value:l.monthlyWeekday,onChange:b=>c({...l,monthlyWeekday:parseInt(b.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:v.map(b=>a.jsx("option",{value:b.value,children:b.label},b.value))})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("recurring.form.holidayHandling")}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"before",label:n("recurring.form.moveBefore")},{value:"after",label:n("recurring.form.moveAfter")},{value:"show",label:n("recurring.form.show")}].map(b=>a.jsxs("label",{className:`flex items-center justify-center p-2 rounded-lg cursor-pointer border transition-all ${l.holidayHandling===b.value?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/30 dark:border-blue-800 dark:text-blue-300":"bg-white border-gray-200 text-gray-600 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:[a.jsx("input",{type:"radio",name:"holidayHandling",value:b.value,checked:l.holidayHandling===b.value,onChange:T=>c({...l,holidayHandling:T.target.value}),className:"sr-only"}),a.jsx("span",{className:"text-sm",children:b.label})]},b.value))})]}),a.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a.jsx(Ql,{className:"w-4 h-4 inline mr-1"}),n("recurring.form.exceptionSettings")]}),a.jsxs("button",{type:"button",onClick:h,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[a.jsx(gt,{className:"w-3 h-3"}),n("recurring.form.addException")]})]}),l.exceptions.map((b,T)=>a.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl space-y-3 border border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("select",{value:b.type,onChange:_=>m(T,"type",_.target.value),className:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white mr-2",children:[a.jsx("option",{value:"date",children:n("recurring.form.byDateOption")}),a.jsx("option",{value:"weekday",children:n("recurring.form.byWeekdayOption")}),a.jsx("option",{value:"week",children:n("recurring.form.byWeekOption")}),a.jsx("option",{value:"month",children:n("recurring.form.byMonthOption")}),a.jsx("option",{value:"conflict",children:n("recurring.form.conflictOption")})]}),a.jsx("button",{type:"button",onClick:()=>g(T),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:a.jsx(Ut,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[b.type==="date"&&Array.from({length:31},(_,j)=>j+1).map(_=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(_),onChange:j=>{const N=b.values,D=j.target.checked?[...N,_]:N.filter($=>$!==_);x(T,D)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[_,n("calendar.daySuffix",{defaultValue:""})]})]},_)),b.type==="weekday"&&v.map(_=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(_.value),onChange:j=>{const N=b.values,D=j.target.checked?[...N,_.value]:N.filter($=>$!==_.value);x(T,D)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:_.label})]},_.value)),b.type==="week"&&[1,2,3,4,-1].map(_=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(_),onChange:j=>{const N=b.values,D=j.target.checked?[...N,_]:N.filter($=>$!==_);x(T,D)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:$i(_)})]},_)),b.type==="month"&&Array.from({length:12},(_,j)=>j+1).map(_=>a.jsxs("label",{className:"flex items-center space-x-2 p-1 hover:bg-white dark:hover:bg-gray-600 rounded cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b.values.includes(_),onChange:j=>{const N=b.values,D=j.target.checked?[...N,_]:N.filter($=>$!==_);x(T,D)},className:"rounded text-blue-600 focus:ring-blue-500"}),a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[_,n("common.monthSuffix",{defaultValue:"ì›”"})]})]},_))]}),b.type==="conflict"&&a.jsxs("div",{className:"space-y-3",children:[(b.values||[]).map((_,j)=>a.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:[n("recurring.form.conflictRule")," ",j+1]}),a.jsx("button",{type:"button",onClick:()=>p(T,j),className:"text-red-500 hover:text-red-700 p-1",children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.targetTemplate")}),a.jsxs("select",{value:_.targetTemplateTitle,onChange:N=>w(T,j,"targetTemplateTitle",N.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"",children:n("recurring.form.selectTemplate")}),s.map(N=>a.jsx("option",{value:N.title,children:N.title},N.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:n("recurring.form.conflictCondition")}),a.jsxs("select",{value:_.scope,onChange:N=>w(T,j,"scope",N.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[a.jsx("option",{value:"same_date",children:n("recurring.form.sameDate")}),a.jsx("option",{value:"same_week",children:n("recurring.form.sameWeek")}),a.jsx("option",{value:"same_month",children:n("recurring.form.sameMonth")})]})]})]})]},j)),a.jsxs("button",{type:"button",onClick:()=>f(T),className:"w-full py-2 px-3 text-sm border-2 border-dashed border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center gap-2",children:[a.jsx(gt,{className:"w-4 h-4"}),n("recurring.form.addConflictRule")]})]})]},T))]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:e,className:"px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",disabled:d,children:n("common.cancel")}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 transform hover:-translate-y-0.5 font-medium disabled:opacity-50 disabled:cursor-not-allowed",disabled:d,children:[a.jsx(Yt,{className:"w-4 h-4"}),n(d?"recurring.form.saving":"recurring.form.save")]})]})]})})]})},sC=({searchTerm:t="",priorityFilter:e="all",typeFilter:r="all",projectFilter:s="all",tagFilter:n=[]})=>{const{todos:i,toggleTodo:o,getRecurringTodos:l}=ot(),{t:c,i18n:d}=Xe(),{currentTheme:u,isDark:h}=Lt(),g=!!u.bg,m=d.language==="ko"?cn:rn,[x,f]=y.useState(new Set(["today"])),[p,w]=y.useState("period"),[v,k]=y.useState("yesterday"),b=new Date,T=g?"glass-card p-3 transition-[background-color] duration-200":"bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border",_=g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},j=l(),N=new Set,D=[...i,...j].filter(E=>N.has(E.id)?!1:(N.add(E.id),!0)),$=D.filter(E=>E.completed&&E.completedAt&&(t===""||E.title.toLowerCase().includes(t.toLowerCase())||E.description&&E.description.toLowerCase().includes(t.toLowerCase()))&&(e==="all"||E.priority===e)&&(r==="all"||E.type===r)&&(s==="all"||s==="longterm"&&E.project==="longterm"||s==="shortterm"&&E.project==="shortterm")&&(n.length===0||E.tags&&n.every(te=>E.tags?.includes(te)))),C=[];D.forEach(E=>{E.subTasks&&E.subTasks.length>0&&E.subTasks.filter(te=>te.completed&&te.completedAt&&te.completedAt!==null).forEach(te=>{const Q=t===""||te.title.toLowerCase().includes(t.toLowerCase())||te.description&&te.description.toLowerCase().includes(t.toLowerCase()),H=e==="all"||te.priority===e;Q&&H&&C.push({...te,type:"simple",recurrence:"none",isSubTask:!0,parentTitle:E.title,parentDescription:E.description,createdAt:te.createdAt,updatedAt:te.updatedAt})})});const R=[...$,...C].sort((E,te)=>{const Q=J=>{if(!J)return 0;try{const ce=new Date(J).getTime();return isNaN(ce)?0:ce}catch{return 0}},H=Q(E.completedAt);return Q(te.completedAt)-H});console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì™„ë£Œëœ í• ì¼:",R.length),console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì™„ë£Œëœ ë°˜ë³µ í• ì¼:",R.filter(E=>E._isRecurringInstance).length);const B=R.find(E=>E.title==="ì£¼ê°„ì—…ë¬´ë³´ê³ ");B?console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì£¼ê°„ì—…ë¬´ë³´ê³  ë°œê²¬:",{title:B.title,completed:B.completed,completedAt:B.completedAt,_isRecurringInstance:B._isRecurringInstance}):(console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì£¼ê°„ì—…ë¬´ë³´ê³ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"),console.log("ğŸ“Š ì™„ë£Œ íˆìŠ¤í† ë¦¬ - ì™„ë£Œëœ í• ì¼ ì œëª©ë“¤:",R.map(E=>E.title)));const Y={today:R.filter(E=>E.completedAt&&Vt(new Date(E.completedAt),b)),yesterday:R.filter(E=>E.completedAt&&Vt(new Date(E.completedAt),An(b))),thisWeek:R.filter(E=>{if(!E.completedAt)return!1;const te=new Date(E.completedAt);return Ds(te,{start:as(b,{locale:m}),end:is(b,{locale:m})})&&!Vt(te,b)&&!Vt(te,An(b))}),lastWeek:R.filter(E=>{if(!E.completedAt)return!1;const te=as(Rn(b),{locale:m}),Q=is(Rn(b),{locale:m});return Ds(new Date(E.completedAt),{start:te,end:Q})}),thisMonth:R.filter(E=>{if(!E.completedAt)return!1;const te=new Date(E.completedAt),Q=as(Rn(b),{locale:m});return Ds(te,{start:Ha(b),end:rl(b)})&&!Vt(te,b)&&!Vt(te,An(b))&&!Ds(te,{start:as(b,{locale:m}),end:is(b,{locale:m})})&&!Ds(te,{start:Q,end:is(Q,{locale:m})})}),lastMonth:R.filter(E=>{if(!E.completedAt)return!1;const te=new Date(E.completedAt);return Ds(te,{start:Ha(si(b)),end:rl(si(b))})}),older:R.filter(E=>E.completedAt?new Date(E.completedAt)<Ha(b):!1)},V=()=>{const E={};R.forEach(Q=>{if(!Q.completedAt)return;const H=new Date(Q.completedAt),I=qe(H,d.language==="ko"?"Mì›” dì¼ (E)":"MMM d (E)",{locale:m});E[I]||(E[I]=[]),E[I].push(Q)}),Object.values(E).forEach(Q=>{Q.sort((H,I)=>!H.completedAt||!I.completedAt?0:new Date(I.completedAt).getTime()-new Date(H.completedAt).getTime())});const te=Object.keys(E).sort((Q,H)=>{const I=new Date(E[Q][0].completedAt);return new Date(E[H][0].completedAt).getTime()-I.getTime()});return{groupedByDay:E,sortedKeys:te}},q=()=>{const E={};R.forEach(Q=>{if(!Q.completedAt)return;const H=new Date(Q.completedAt),I=new Date(H);I.setDate(H.getDate()-H.getDay()),I.setHours(0,0,0,0);const J=new Date(I);J.setDate(I.getDate()+6);const ce=`${qe(I,d.language==="ko"?"Mì›” dì¼":"MMM d",{locale:m})} ~ ${qe(J,d.language==="ko"?"Mì›” dì¼":"MMM d",{locale:m})}`;E[ce]||(E[ce]=[]),E[ce].push(Q)}),Object.values(E).forEach(Q=>{Q.sort((H,I)=>!H.completedAt||!I.completedAt?0:new Date(I.completedAt).getTime()-new Date(H.completedAt).getTime())});const te=Object.keys(E).sort((Q,H)=>{const I=new Date(E[Q][0].completedAt);return new Date(E[H][0].completedAt).getTime()-I.getTime()});return{groupedByWeek:E,sortedKeys:te}},z=()=>{const E={};R.forEach(Q=>{if(!Q.completedAt)return;const H=new Date(Q.completedAt),I=qe(H,d.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:m});E[I]||(E[I]=[]),E[I].push(Q)}),Object.values(E).forEach(Q=>{Q.sort((H,I)=>!H.completedAt||!I.completedAt?0:new Date(I.completedAt).getTime()-new Date(H.completedAt).getTime())});const te=Object.keys(E).sort((Q,H)=>{const I=new Date(E[Q][0].completedAt);return new Date(E[H][0].completedAt).getTime()-I.getTime()});return{groupedByMonth:E,sortedKeys:te}},de=E=>{const te=new Set(x);te.has(E)?te.delete(E):te.add(E),f(te)},Te=()=>{k(E=>{switch(E){case"yesterday":return"lastWeek";case"lastWeek":return"lastMonth";case"lastMonth":return"yesterday";default:return"yesterday"}})},we=E=>{const te={low:"text-gray-500 bg-gray-100 dark:bg-gray-800",medium:"text-blue-700 bg-blue-100 dark:bg-blue-900/30",high:"text-orange-700 bg-orange-100 dark:bg-orange-900/30",urgent:"text-red-700 bg-red-100 dark:bg-red-900/30"},Q=()=>{o(E.id)};return a.jsx("div",{className:`border-l-2 border-green-500 p-2 sm:p-3 rounded-r-lg ${g?"bg-green-50/20 backdrop-blur-none":"bg-green-50 dark:bg-green-900/10"}`,style:g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.05))`}:{},children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[a.jsx(lo,{className:"w-3 h-3 text-green-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-green-800 dark:text-green-300 line-through truncate",children:E.isSubTask?`â†³ ${E.title} (${E.parentTitle})`:E.title})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-1 mb-1",children:[E.isSubTask?E.parentDescription&&a.jsx("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 py-0.5 rounded text-xs",children:E.parentDescription}):E.description&&a.jsx("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 py-0.5 rounded text-xs",children:E.description}),a.jsxs("span",{className:`px-1 py-0.5 rounded text-xs ${te[E.priority]}`,children:[E.priority==="low"&&c("modal.addTodo.low"),E.priority==="medium"&&c("modal.addTodo.medium"),E.priority==="high"&&c("modal.addTodo.high"),E.priority==="urgent"&&c("modal.addTodo.urgent")]}),E.isSubTask&&a.jsx("span",{className:"bg-indigo-200 dark:bg-indigo-800 text-indigo-700 dark:text-indigo-300 px-1 py-0.5 rounded text-xs",children:"í•˜ìœ„ì‘ì—…"}),E._isRecurringInstance&&a.jsx("span",{className:"bg-purple-200 dark:bg-purple-800 text-purple-700 dark:text-purple-300 px-1 py-0.5 rounded text-xs",children:"ë°˜ë³µí• ì¼"}),E.type==="project"&&a.jsx("span",{className:"bg-green-200 dark:bg-green-800 text-green-700 dark:text-green-300 px-1 py-0.5 rounded text-xs",children:E.project==="longterm"?"ë¡±í…€":"ìˆí…€"})]}),E.completedAt&&a.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(gr,{className:"w-3 h-3"}),Yx(E.completedAt)," ì™„ë£Œ"]})})]}),a.jsx("div",{className:"flex items-start",children:a.jsx("button",{onClick:Q,className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded transition-colors",title:"ì™„ë£Œ ì·¨ì†Œ",children:a.jsx(ql,{className:"w-3 h-3 text-green-600 dark:text-green-400"})})})]})},E.id)},fe=(E,te,Q,H)=>{if(te.length===0)return null;const I=x.has(Q);return a.jsxs("div",{className:"mb-4",children:[a.jsxs("button",{onClick:()=>de(Q),className:`w-full flex items-center justify-between p-2 sm:p-3 rounded-lg transition-colors ${g?"backdrop-blur-none hover:bg-white/10":"bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700"}`,style:g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx("div",{className:"w-4 h-4 flex-shrink-0",children:H}),a.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-white flex-1 leading-tight",children:[E," (",te.length,"ê°œ)"]})]}),I?a.jsx(pa,{className:"w-4 h-4 flex-shrink-0"}):a.jsx(gs,{className:"w-4 h-4 flex-shrink-0"})]}),I&&a.jsx("div",{className:"mt-2 space-y-2",children:te.map(we)})]},Q)},W=V(),le=q(),ie=z(),be=R.length,ye=()=>{switch(v){case"yesterday":return{count:Y.yesterday.length,label:"ì–´ì œ",color:"text-orange-600 dark:text-orange-400"};case"lastWeek":return{count:Y.lastWeek.length,label:"ì €ë²ˆì£¼",color:"text-indigo-600 dark:text-indigo-400"};case"lastMonth":return{count:Y.lastMonth.length,label:"ì €ë²ˆë‹¬",color:"text-pink-600 dark:text-pink-400"};default:return{count:Y.yesterday.length,label:"ì–´ì œ",color:"text-orange-600 dark:text-orange-400"}}},ke=()=>{if(p==="daily"){const{groupedByDay:E,sortedKeys:te}=W;return a.jsx("div",{className:"space-y-4",children:te.map(Q=>fe(Q,E[Q],`day-${Q}`,a.jsx(at,{className:"w-5 h-5 text-blue-600"})))})}else if(p==="weekly"){const{groupedByWeek:E,sortedKeys:te}=le;return a.jsx("div",{className:"space-y-4",children:te.map(Q=>fe(Q,E[Q],`week-${Q}`,a.jsx(at,{className:"w-5 h-5 text-purple-600"})))})}else if(p==="monthly"){const{groupedByMonth:E,sortedKeys:te}=ie;return a.jsx("div",{className:"space-y-4",children:te.map(Q=>fe(Q,E[Q],`month-${Q}`,a.jsx(at,{className:"w-5 h-5 text-indigo-600"})))})}return a.jsxs("div",{className:"space-y-4",children:[fe(c("history.today"),Y.today,"today",a.jsx(lo,{className:"w-5 h-5 text-green-600"})),fe(c("history.yesterday"),Y.yesterday,"yesterday",a.jsx(at,{className:"w-5 h-5 text-blue-600"})),fe(c("history.thisWeek"),Y.thisWeek,"thisWeek",a.jsx(at,{className:"w-5 h-5 text-purple-600"})),fe(c("history.lastWeek"),Y.lastWeek,"lastWeek",a.jsx(at,{className:"w-5 h-5 text-orange-600"})),fe(c("history.thisMonth"),Y.thisMonth,"thisMonth",a.jsx(at,{className:"w-5 h-5 text-indigo-600"})),fe(c("history.lastMonth"),Y.lastMonth,"lastMonth",a.jsx(at,{className:"w-5 h-5 text-pink-600"})),fe(c("history.older"),Y.older,"older",a.jsx(gr,{className:"w-5 h-5 text-gray-600"}))]})};return a.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-1",children:c("history.title")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:c("history.totalCount",{count:be})})]}),a.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[{key:"period",label:"ê¸°ê°„ë³„"},{key:"daily",label:"ì¼ë³„"},{key:"weekly",label:"ì£¼ë³„"},{key:"monthly",label:"ì›”ë³„"}].map(({key:E,label:te})=>a.jsx("button",{onClick:()=>w(E),className:`flex-1 px-2 py-1.5 text-xs sm:text-sm font-medium rounded-md transition-colors ${p===E?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:c(`history.${E}`)},E))}),p==="period"&&a.jsx("div",{className:T,style:_,children:a.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[a.jsxs("div",{className:"text-center px-2 py-2",children:[a.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600 dark:text-green-400",children:Y.today.length}),a.jsx("div",{className:"text-xs text-green-700 dark:text-green-300 leading-tight",children:c("history.today")})]}),a.jsxs("div",{className:"text-center px-2 py-2",children:[a.jsx("div",{className:"text-lg sm:text-xl font-bold text-blue-600 dark:text-blue-400",children:Y.today.length+Y.yesterday.length+Y.thisWeek.length}),a.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300 leading-tight",children:c("history.thisWeek")})]}),a.jsxs("div",{className:"text-center px-2 py-2",children:[a.jsx("div",{className:"text-lg sm:text-xl font-bold text-purple-600 dark:text-purple-400",children:be-Y.lastMonth.length-Y.older.length}),a.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300 leading-tight",children:c("history.thisMonth")})]}),a.jsxs("button",{onClick:Te,className:"text-center px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors cursor-pointer",title:"í´ë¦­í•˜ì—¬ ì–´ì œ â†’ ì €ë²ˆì£¼ â†’ ì €ë²ˆë‹¬ ìˆœí™˜",children:[a.jsx("div",{className:`text-lg sm:text-xl font-bold ${ye().color}`,children:ye().count}),a.jsx("div",{className:`text-xs leading-tight ${ye().color.replace("text-","text-").replace("600","700").replace("400","300")}`,children:ye().label})]})]})}),p==="daily"&&a.jsxs("div",{className:`${T} text-center`,style:_,children:[a.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:W.sortedKeys.length}),a.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:c("history.completedDay")})]}),p==="weekly"&&a.jsxs("div",{className:`${T} text-center`,style:_,children:[a.jsx("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:le.sortedKeys.length}),a.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300",children:c("history.completedWeek")})]}),p==="monthly"&&a.jsxs("div",{className:`${T} text-center`,style:_,children:[a.jsx("div",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:ie.sortedKeys.length}),a.jsx("div",{className:"text-xs text-indigo-700 dark:text-indigo-300",children:c("history.completedMonth")})]}),a.jsx("div",{className:"space-y-4",children:ke()}),be===0&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(lo,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:c("history.empty")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:c("history.emptyHint")})]})]})},nC=({onClose:t})=>{const{todos:e}=ot(),{customHolidays:r}=sn(),[s,n]=y.useState("default"),[i,o]=y.useState(!1),l={dueReminders:!0,dueReminderTiming:60,time:"09:00",advanceDays:0,startReminder:!1,startReminderTime:"09:00",weeklyReport:!1,weeklyReportTime:"09:00",dailyReminder:!0,dailyReminderTime:"09:00",dailyRecurrence:[1,2,3,4,5],dailyExcludeHolidays:!1},[c,d]=y.useState(l);y.useEffect(()=>{(async()=>{try{const{Capacitor:v}=await Je(async()=>{const{Capacitor:k}=await Promise.resolve().then(()=>ms);return{Capacitor:k}},void 0,import.meta.url);if(v.isNativePlatform())try{const k=await Nr.checkPermissions(),b=k.display==="prompt"?"default":k.display;n(b),console.log("Native permission status:",b)}catch(k){console.error("Failed to check native permissions:",k),n("denied")}else n(typeof Notification<"u"?Notification.permission:"default")}catch(v){console.error("Permission check failed",v),n(typeof Notification<"u"?Notification.permission:"default")}})(),o(Nr.isSupported());const w=localStorage.getItem("notification-settings");if(w){const v=JSON.parse(w);v.reminderTime&&!v.dailyReminderTime&&(v.dailyReminderTime=v.reminderTime),d({...l,...v,dueReminderTiming:v.dueReminderTiming??(v.advanceDays?v.advanceDays*24*60:60)})}},[]);const u=async()=>{const p=await Nr.requestPermission();n(p?"granted":"denied")},h=async()=>{try{if(typeof Nr.checkPermissions=="function"){const p=await Nr.checkPermissions(),w=p.display==="prompt"?"default":p.display;console.log("Manual check result:",w),n(w),alert(w==="denied"?`âš ï¸ ì—¬ì „íˆ ê¶Œí•œì´ "ì°¨ë‹¨" ìƒíƒœì…ë‹ˆë‹¤.

ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ ê¶Œí•œì„ í—ˆìš©í–ˆëŠ”ë°ë„ ì´ ë©”ì‹œì§€ê°€ ëœ¬ë‹¤ë©´, ì•±ì„ ì™„ì „íˆ ì¢…ë£Œí–ˆë‹¤ê°€ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.`:w==="granted"?"âœ… ê¶Œí•œì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.":`í˜„ì¬ ê¶Œí•œ ìƒíƒœ: ${w}
ì•Œë¦¼ì„ í—ˆìš©í•˜ë ¤ë©´ "í—ˆìš©í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`)}else await u()}catch(p){console.error("Failed to check permission manually:",p),alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${p.message||JSON.stringify(p)}`)}},g=async(p,w)=>{const v={...c,[p]:w};d(v),localStorage.setItem("notification-settings",JSON.stringify(v)),s==="granted"&&await Nr.scheduleAllNotifications(v,e,r)},m=p=>{const w=c.dailyRecurrence||[];let v;w.includes(p)?v=w.filter(k=>k!==p):v=[...w,p].sort(),g("dailyRecurrence",v)},x=async()=>{try{await Nr.showNotification({title:"í…ŒìŠ¤íŠ¸ ì•Œë¦¼",body:"ì•Œë¦¼ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤! ğŸ‰",tag:"test"}),alert(`í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.
(ì ì‹œ í›„ ë„ì°©í•©ë‹ˆë‹¤)`)}catch(p){alert("í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì‹¤íŒ¨: "+p.message)}},f=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];return i?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ì•Œë¦¼ ì„¤ì •"}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"âœ•"})]}),a.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto flex-1",children:[a.jsxs("div",{className:"space-y-3",children:[s==="default"&&a.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg",children:[a.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 mb-2",children:"ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."}),a.jsx("button",{onClick:u,className:"w-full px-3 py-2 bg-yellow-600 text-white text-sm rounded-lg",children:"í—ˆìš©í•˜ê¸°"})]}),s==="denied"&&a.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg",children:[a.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[a.jsx("span",{className:"text-xl",children:"âš ï¸"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-bold text-red-800 dark:text-red-200",children:"ì•Œë¦¼ ê¶Œí•œì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤."}),a.jsx("p",{className:"text-xs text-red-600 dark:text-red-300 mt-1",children:"ì„¤ì • ì•±ì—ì„œ ì•Œë¦¼ì„ ì¼œì£¼ì„¸ìš”."})]})]}),a.jsx("button",{onClick:h,className:"w-full px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:"ê¶Œí•œ ë‹¤ì‹œ í™•ì¸í•˜ê¸° â†»"})]}),s==="granted"&&a.jsx("button",{onClick:x,className:"w-full px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700",children:"í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë³´ë‚´ê¸°"})]}),s==="granted"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-3 border-b border-gray-200 dark:border-gray-700 pb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ì¼ê°„ ë¸Œë¦¬í•‘"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ë§¤ì¼ ì•„ì¹¨ ì˜¤ëŠ˜ì˜ í• ì¼ ë¸Œë¦¬í•‘"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.dailyReminder,onChange:p=>g("dailyReminder",p.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.dailyReminder&&a.jsxs("div",{className:"space-y-4 pl-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ì‹œê°„"}),a.jsx("input",{type:"time",value:c.dailyReminderTime,onChange:p=>g("dailyReminderTime",p.target.value),className:"px-2 py-1 border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 block mb-2",children:"ë°˜ë³µ ìš”ì¼"}),a.jsx("div",{className:"flex justify-between gap-1",children:f.map((p,w)=>a.jsx("button",{onClick:()=>m(w),className:`w-8 h-8 rounded-full text-xs font-medium transition-colors ${c.dailyRecurrence?.includes(w)?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:p},w))})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ê³µíœ´ì¼ ì œì™¸"}),a.jsx("input",{type:"checkbox",checked:c.dailyExcludeHolidays,onChange:p=>g("dailyExcludeHolidays",p.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})]})]})]}),a.jsxs("div",{className:"space-y-3 border-b border-gray-200 dark:border-gray-700 pb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ì‹œì‘ì¼ ì•Œë¦¼"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"í• ì¼ ì‹œì‘ ì‹œê°„ì— ì•Œë¦¼"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.startReminder,onChange:p=>g("startReminder",p.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.startReminder&&a.jsxs("div",{className:"flex items-center justify-between pl-2",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ì‹œê°„"}),a.jsx("input",{type:"time",value:c.startReminderTime||"09:00",onChange:p=>g("startReminderTime",p.target.value),className:"px-2 py-1 border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),a.jsxs("div",{className:"space-y-3 border-b border-gray-200 dark:border-gray-700 pb-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ì£¼ê°„ ë¦¬í¬íŠ¸"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ë§¤ì£¼ ì›”ìš”ì¼ ì§€ë‚œì£¼ ì„±ê³¼ ìš”ì•½"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.weeklyReport,onChange:p=>g("weeklyReport",p.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.weeklyReport&&a.jsxs("div",{className:"flex items-center justify-between pl-2",children:[a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ì‹œê°„"}),a.jsx("input",{type:"time",value:c.weeklyReportTime||"09:00",onChange:p=>g("weeklyReportTime",p.target.value),className:"px-2 py-1 border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ë§ˆê° ì„ë°• ì•Œë¦¼"}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"í• ì¼ ë§ˆê° ì „ ë¯¸ë¦¬ ì•Œë¦¼"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:c.dueReminders,onChange:p=>g("dueReminders",p.target.checked),className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),c.dueReminders&&a.jsx("div",{className:"pl-2",children:a.jsxs("select",{value:c.dueReminderTiming,onChange:p=>g("dueReminderTiming",Number(p.target.value)),className:"w-full px-3 py-2 border rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[a.jsx("option",{value:10,children:"10ë¶„ ì „"}),a.jsx("option",{value:30,children:"30ë¶„ ì „"}),a.jsx("option",{value:60,children:"1ì‹œê°„ ì „"}),a.jsx("option",{value:180,children:"3ì‹œê°„ ì „"}),a.jsx("option",{value:1440,children:"1ì¼ ì „"}),a.jsx("option",{value:2880,children:"2ì¼ ì „"})]})})]})]})]}),a.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:a.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"ì™„ë£Œ"})})]})}):a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl mb-4",children:"âŒ"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"ì•Œë¦¼ ì§€ì› ì•ˆë¨"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"í˜„ì¬ í™˜ê²½ì—ì„œëŠ” ì•Œë¦¼ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."}),a.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg",children:"í™•ì¸"})]})})})},aC=Ar("TodoListWidget"),iC=Object.freeze(Object.defineProperty({__proto__:null,default:aC},Symbol.toStringTag,{value:"Module"})),o0=async t=>{try{const{Capacitor:e}=await Je(async()=>{const{Capacitor:f}=await Promise.resolve().then(()=>ms);return{Capacitor:f}},void 0,import.meta.url);if(!e.isNativePlatform()||e.getPlatform()!=="android")return;let r;try{r=(await Je(()=>Promise.resolve().then(()=>iC),void 0,import.meta.url)).default}catch(f){console.warn("Widget plugin not found",f);return}if(!r)return;let s,n=[];Array.isArray(t)?s=t:(s=t.todos,n=t.vacations||[]);const i=new Date;i.setHours(0,0,0,0),console.log("ğŸ“± syncWidget: Starting with",s.length,"todos,",n.length,"vacations");const o=s.filter(f=>{if(f.completed&&f.completedAt){const p=new Date(f.completedAt);return p.setHours(0,0,0,0),p.getTime()===i.getTime()}if(!f.completed){if(f.startDate){const p=new Date(f.startDate);return p.setHours(0,0,0,0),i>=p}if(f.dueDate){const p=new Date(f.dueDate);return p.setHours(0,0,0,0),i>=p}return!0}return!1});console.log("ğŸ“± syncWidget: Filtered to",o.length,"today todos");const c=[...o].sort((f,p)=>{const w={urgent:0,high:1,medium:2,low:3},v=w[f.priority]??2,k=w[p.priority]??2;return v!==k?v-k:f.dueDate&&p.dueDate?new Date(f.dueDate).getTime()-new Date(p.dueDate).getTime():f.dueDate?-1:p.dueDate?1:(f.order??0)-(p.order??0)}).slice(0,30).map(f=>{let p="",w="",v="";if(f.dueDate)try{p=f.dueDate instanceof Date?f.dueDate.toISOString():new Date(f.dueDate).toISOString()}catch{p=String(f.dueDate)}if(f.startDate)try{w=f.startDate instanceof Date?f.startDate.toISOString():new Date(f.startDate).toISOString()}catch{w=String(f.startDate)}if(f.completedAt)try{v=f.completedAt instanceof Date?f.completedAt.toISOString():new Date(f.completedAt).toISOString()}catch{v=String(f.completedAt)}const k=f.subTasks||[],b=k.filter(_=>_.completed).length,T=k.length>0?Math.round(b/k.length*100):-1;return{id:f.id||"",title:f.title||"",completed:f.completed||!1,priority:f.priority||"medium",description:f.description||"",dueDate:p,startDate:w,completedAt:v,progress:T}});console.log("ğŸ“± syncWidget: Today widget data:",c.length,"items");const h=[...s.filter(f=>{if(f.completed&&f.completedAt){const p=new Date;p.setHours(0,0,0,0);const w=new Date(f.completedAt);if(w.setHours(0,0,0,0),w.getTime()===p.getTime())return!0}return f.completed?!1:(f.startDate||f.dueDate||f.recurrence&&f.recurrence!=="none",!0)})].sort((f,p)=>{const w={urgent:0,high:1,medium:2,low:3},v=w[f.priority]??2,k=w[p.priority]??2;return v-k}).map(f=>{let p="",w="",v="";if(f.dueDate)try{p=f.dueDate instanceof Date?f.dueDate.toISOString():new Date(f.dueDate).toISOString()}catch{p=String(f.dueDate)}if(f.startDate)try{w=f.startDate instanceof Date?f.startDate.toISOString():new Date(f.startDate).toISOString()}catch{w=String(f.startDate)}if(f.completedAt)try{v=f.completedAt instanceof Date?f.completedAt.toISOString():new Date(f.completedAt).toISOString()}catch{v=String(f.completedAt)}return{id:f.id||"",title:f.title||"",completed:f.completed||!1,priority:f.priority||"medium",dueDate:p,startDate:w,completedAt:v}});console.log("ğŸ“± syncWidget: Calendar widget data:",h.length,"items");const g=n.map(f=>({id:f.id,date:f.date,type:f.type,employeeName:f.employeeName||""}));console.log("ğŸ“± syncWidget: Vacation data:",g.length,"items");const m=parseInt(localStorage.getItem("widgetTransparency")||"80"),x={today:c,calendar:h,vacations:g};console.log("ğŸ“± syncWidget: Sending combined data to native..."),await r.updateWidget({data:JSON.stringify(x),date:new Date().toLocaleDateString(),transparency:m}),console.log("ğŸ“± syncWidget: SUCCESS!")}catch(e){console.error("Widget sync failed",e)}},oC=({isOpen:t,onClose:e})=>t?Ur.createPortal(a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-lg max-h-[85vh] flex flex-col animate-scale-in",onClick:r=>r.stopPropagation(),children:[a.jsxs("div",{className:"shrink-0 flex items-center justify-between p-4 border-b border-gray-100 dark:border-gray-700 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-t-2xl",children:[a.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx("span",{className:"text-xl",children:"ğŸ“š"})," Google Tasks ì—°ë™ ê°€ì´ë“œ"]}),a.jsx("button",{onClick:e,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6 space-y-8 overflow-y-auto",children:[a.jsxs("section",{className:"space-y-3",children:[a.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-primary-100 text-primary-600 text-sm font-bold",children:"1"}),"ì—°ë™ ì‹œì‘í•˜ê¸°"]}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 pl-8",children:["ì‚¬ì´ë“œë°” í•˜ë‹¨ì˜ ",a.jsx("span",{className:"font-semibold text-primary-600 dark:text-primary-400",children:"Google Tasks"})," ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¡œê·¸ì¸ì„ ì§„í–‰í•´ì£¼ì„¸ìš”."]})]}),a.jsxs("section",{className:"space-y-3",children:[a.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-orange-100 text-orange-600 text-sm font-bold",children:"2"}),"'í™•ì¸ë˜ì§€ ì•Šì€ ì•±' ê²½ê³  í•´ê²°"]}),a.jsxs("div",{className:"pl-8 space-y-3",children:[a.jsx("div",{className:"p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-100 dark:border-orange-900/30 rounded-xl text-sm text-orange-800 dark:text-orange-200",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(ex,{className:"w-5 h-5 flex-shrink-0"}),a.jsx("p",{children:"ì•±ì´ Googleì˜ ì •ì‹ ìŠ¹ì¸ì„ ë°›ê¸° ì „ê¹Œì§€ëŠ” ë³´ì•ˆ ê²½ê³  í™”ë©´ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì •ìƒì ì¸ ê³¼ì •ì…ë‹ˆë‹¤."})]})}),a.jsxs("ol",{className:"list-decimal pl-4 space-y-2 text-sm text-gray-600 dark:text-gray-400 marker:text-gray-400",children:[a.jsxs("li",{children:["ê²½ê³  í™”ë©´ ì¢Œì¸¡ í•˜ë‹¨ì˜ ",a.jsx("span",{className:"font-bold text-gray-800 dark:text-gray-200",children:"ê³ ê¸‰(Advanced)"})," ê¸€ìë¥¼ í´ë¦­í•©ë‹ˆë‹¤."]}),a.jsxs("li",{children:["í¼ì³ì§„ ë‚´ìš© í•˜ë‹¨ì˜",a.jsx("span",{className:"block mt-1 p-2 bg-gray-100 dark:bg-gray-700/50 rounded text-xs break-all font-mono",children:"todolist-116f3.firebaseapp.com(ìœ¼)ë¡œ ì´ë™(ì•ˆì „í•˜ì§€ ì•ŠìŒ)"}),"ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤."]}),a.jsxs("li",{children:["ê¶Œí•œ ìš”ì²­ í™”ë©´ì—ì„œ ",a.jsx("span",{className:"font-bold text-blue-600",children:"ê³„ì†/í—ˆìš©"}),"ì„ ì„ íƒí•©ë‹ˆë‹¤."]})]})]})]}),a.jsxs("section",{className:"space-y-3",children:[a.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-600 text-sm font-bold",children:"3"}),"(ê°œë°œììš©) API í™œì„±í™” í•„ìš” ì‹œ"]}),a.jsxs("div",{className:"pl-8 space-y-3",children:[a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["ë§Œì•½ ",a.jsx("b",{children:'"API has not been used in project"'})," ë˜ëŠ” ",a.jsx("b",{children:"403 Forbidden"})," ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´, Google Cloud Consoleì—ì„œ APIë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤."]}),a.jsxs("a",{href:"https://console.developers.google.com/apis/api/tasks.googleapis.com/overview?project=470825187407",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-xl transition-colors text-sm font-medium group",children:[a.jsx(tx,{className:"w-4 h-4"}),"Google Tasks API í™œì„±í™” í˜ì´ì§€ ë°”ë¡œê°€ê¸°"]}),a.jsxs("div",{className:"flex gap-2 items-start text-xs text-gray-500 dark:text-gray-400",children:[a.jsx(Cn,{className:"w-4 h-4 text-green-500 mt-0.5"}),a.jsxs("span",{children:["ìœ„ ë§í¬ ì ‘ì† í›„ ìƒë‹¨ì˜ ",a.jsx("b",{children:"ì‚¬ìš©(ENABLE)"})," ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í•´ê²°ë©ë‹ˆë‹¤."]})]})]})]}),a.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl text-xs text-gray-500 dark:text-gray-400 text-center leading-relaxed",children:["ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ë©´, ",a.jsx("b",{children:"ì„¤ì • > Google Tasks Auto-Sync"})," í† ê¸€ì„ ì¼œì„œ ì•± ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ í•  ì¼ì„ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."]})]}),a.jsx("div",{className:"shrink-0 p-4 border-t border-gray-100 dark:border-gray-700 flex justify-end",children:a.jsx("button",{onClick:e,className:"px-6 py-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-medium rounded-xl hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors",children:"í™•ì¸"})})]})}),document.body):null,lC=()=>{const{t,i18n:e}=Xe(),{currentUser:r,logout:s}=wt(),{todos:n,exportData:i,importData:o,clearCompleted:l,stats:c,syncing:d,syncWithCloud:u,getRecurringTodos:h}=ot(),{theme:g,setTheme:m,currentThemeId:x,setCurrentThemeId:f,currentTheme:p,isDark:w,transparency:v,setTransparency:k}=Lt(),b=!!p.bg,{fontSizeLevel:T,setFontSizeLevel:_}=PN(),{customHolidays:j,addCustomHoliday:N,deleteCustomHoliday:D}=sn(),{vacations:$,employees:C}=ln(),[R,B]=y.useState(null),[Y,V]=y.useState(!1),[q,z]=y.useState("colors"),[de,Te]=y.useState(!1),[we,fe]=y.useState(""),[W,le]=y.useState(""),[ie,be]=y.useState(!1),[ye,ke]=y.useState("last"),[E,te]=y.useState(()=>parseInt(localStorage.getItem("widgetTransparency")||"80")),[Q,H]=y.useState(!1),[I,J]=y.useState(!1),[ce,O]=y.useState(!1);Ze.useEffect(()=>{r&&ee.getUserSettings(r.uid).then(X=>{X?.startScreen&&ke(X.startScreen),X?.googleTasksLinked&&J(!0),X?.autoSyncGoogleTasks&&H(!0)})},[r]);const G=async X=>{if(ke(X),r)try{await ee.updateUserStartScreen(r.uid,X)}catch(ve){console.error("Failed to update start screen:",ve)}},M=async X=>{const ve=X.target.checked;if(H(ve),r)try{await ee.updateGoogleTasksSettings(r.uid,{autoSync:ve})}catch(Be){console.error("Failed to update auto-sync setting:",Be),H(!ve)}},se=X=>{const ve=X.target.files?.[0];if(!ve)return;const Be=new FileReader;Be.onload=async S=>{try{const L=S.target?.result;await o(L)?(B(null),V(!0),setTimeout(()=>V(!1),3e3)):B(t("settings.data.invalidFormat"))}catch{B(t("settings.data.importError"))}},Be.readAsText(ve),X.target.value=""},ue=()=>{const X=i(),ve=new Blob([X],{type:"application/json"}),Be=URL.createObjectURL(ve),S=document.createElement("a");S.href=Be,S.download=`todos-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(Be)},ge=async X=>{if(X.preventDefault(),!(!we||!W))try{await N(we,W,ie),fe(""),le(""),be(!1)}catch(ve){console.error("Failed to add holiday:",ve),alert(t("common.error"))}},re=async X=>{if(confirm(t("settings.holiday.confirmDelete")))try{await D(X)}catch(ve){console.error("Failed to delete holiday:",ve),alert(t("common.error"))}},Ie=()=>{const X=c?.completed||0;if(X===0){alert(t("settings.data.noCompleted"));return}confirm(t("settings.data.confirmClear",{count:X}))&&l()},K=async()=>{if(confirm(t("settings.account.confirmLogout")))try{await s()}catch(X){console.error("Logout failed:",X)}},pe=async()=>{try{await u()}catch(X){console.error("Sync failed:",X)}},Fe=()=>{try{const X=localStorage.getItem("todolist-app-todos");if(X)return`${(new Blob([X]).size/1024).toFixed(2)} KB`}catch(X){console.error("Storage size calculation failed:",X)}return"0 KB"};return a.jsx("div",{className:"pb-safe min-h-safe bg-transparent",children:a.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-8 animate-fade-in-up",children:[a.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700",children:a.jsx(Qg,{className:"w-8 h-8 text-primary-600 dark:text-primary-400"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("settings.title")}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("settings.subtitle")})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.1s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-primary-50 dark:bg-primary-900/30 flex items-center justify-center text-primary-600 dark:text-primary-400",children:a.jsx(qn,{className:"w-5 h-5",strokeWidth:2})}),t("settings.account.title")]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 backdrop-blur-sm",children:[r?.photoURL?a.jsx("img",{src:r.photoURL,alt:r.email||"User",className:"w-12 h-12 rounded-full object-cover shadow-sm border border-gray-200 dark:border-gray-700"}):a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary-100 to-primary-200 dark:from-primary-900 dark:to-primary-800 rounded-full flex items-center justify-center text-primary-600 dark:text-primary-300 font-bold text-xl shadow-inner",children:r?.email?.[0].toUpperCase()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:r?.email}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),t("settings.account.loggedIn")]})]}),a.jsx("button",{onClick:pe,disabled:d,className:`p-2.5 rounded-xl border transition-all duration-200 ${d?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white dark:bg-gray-700 text-primary-600 dark:text-primary-400 border-gray-200 dark:border-gray-600 hover:border-primary-300 hover:shadow-md active:scale-95"}`,title:t("settings.account.sync"),children:a.jsx(Za,{className:`w-5 h-5 ${d?"animate-spin":""}`})})]}),a.jsxs("button",{onClick:K,className:"w-full flex items-center justify-center gap-2 p-4 rounded-xl border border-red-100 dark:border-red-900/30 text-red-600 dark:text-red-400 font-medium hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200 group relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-red-100/50 dark:bg-red-900/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"}),a.jsx(Jg,{className:"w-5 h-5 relative z-10"}),a.jsx("span",{className:"relative z-10",children:t("settings.account.logout")})]})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.15s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-cyan-50 dark:bg-cyan-900/30 flex items-center justify-center text-cyan-600 dark:text-cyan-400",children:a.jsx(Id,{className:"w-5 h-5",strokeWidth:2})}),t("settings.general.startScreen")]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[{key:"last",label:t("settings.general.lastView")},{key:"today",label:t("settings.general.today")},{key:"week",label:t("settings.general.week")},{key:"month",label:t("settings.general.month")}].map(X=>a.jsx("button",{onClick:()=>G(X.key),className:`p-4 rounded-xl border-2 transition-all duration-200 text-sm font-medium ${ye===X.key?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-transparent bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400"}`,children:X.label},X.key))}),a.jsxs("div",{className:"pt-6 border-t border-gray-100 dark:border-gray-800",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsxs("span",{children:["Google Tasks ",t("settings.sync","Auto-Sync")]}),I&&a.jsx("span",{className:"px-2 py-0.5 text-[10px] bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-full font-bold",children:"LINKED"}),a.jsx("button",{onClick:()=>O(!0),className:"p-1 text-gray-400 hover:text-primary-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",title:"ì—°ë™ ê°€ì´ë“œ ë³´ê¸°",children:a.jsx(rx,{className:"w-4 h-4"})})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ì•± ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ Google Tasksë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤."})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:Q,onChange:M,disabled:!I,className:"sr-only peer"}),a.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]}),!I&&a.jsxs("p",{className:"text-xs text-orange-500 mt-2 bg-orange-50 dark:bg-orange-900/10 p-2 rounded-lg",children:["âš ï¸ ë¨¼ì € ì‚¬ì´ë“œë°”ì˜ ",a.jsx("b",{children:"Google Tasks"})," ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—°ë™í•´ì£¼ì„¸ìš”."]}),a.jsx(oC,{isOpen:ce,onClose:()=>O(!1)})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.2s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-purple-50 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400",children:a.jsx(sx,{className:"w-5 h-5",strokeWidth:2})}),t("settings.appearance.title")]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex p-1 bg-gray-100 dark:bg-gray-800 rounded-xl",children:["mode","background","display"].map(X=>a.jsx("button",{onClick:()=>z(X),className:`flex-1 py-2 text-sm font-medium rounded-lg transition-all duration-200 ${q===X||X==="background"&&(q==="city"||q==="seasonal")||X==="display"&&q==="colors"?"bg-white dark:bg-gray-700 text-primary-600 dark:text-primary-400 shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:t(`settings.tabs.${X}`)||X.charAt(0).toUpperCase()+X.slice(1)},X))}),a.jsxs("div",{className:"min-h-[300px]",children:[q==="mode"&&a.jsx("div",{className:"space-y-6 animate-fade-in",children:a.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{key:"light",icon:nx,label:t("settings.appearance.light")},{key:"dark",icon:ax,label:t("settings.appearance.dark")},{key:"system",icon:Id,label:t("settings.appearance.system")}].map(X=>a.jsxs("button",{onClick:()=>m(X.key),className:`flex flex-col items-center justify-center gap-3 p-4 rounded-xl border-2 transition-all duration-200 ${g===X.key?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-transparent bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[a.jsx(X.icon,{className:`w-6 h-6 ${g===X.key?"text-primary-500":"text-gray-400"}`}),a.jsx("span",{className:"text-sm font-medium",children:X.label})]},X.key))})}),(q==="background"||q==="seasonal"||q==="city")&&a.jsxs("div",{className:"space-y-6 animate-fade-in",children:[a.jsxs("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:[a.jsx("button",{onClick:()=>z("seasonal"),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${q==="seasonal"?"bg-primary-100 dark:bg-primary-900/40 text-primary-700 dark:text-primary-300":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:t("settings.tabs.seasonal")||"Seasonal"}),a.jsx("button",{onClick:()=>z("city"),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${q==="city"?"bg-primary-100 dark:bg-primary-900/40 text-primary-700 dark:text-primary-300":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:t("settings.tabs.city")||"City"})]}),a.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(q==="seasonal"||q==="background")&&ls.seasonal.map(X=>a.jsxs("button",{onClick:()=>f(X.id),className:`relative group overflow-hidden rounded-xl aspect-video border-2 transition-all duration-200 ${x===X.id?"border-primary-500 ring-2 ring-primary-500/30":"border-transparent hover:border-gray-200 dark:hover:border-gray-700"}`,children:[a.jsx("img",{src:X.bg,alt:t(X.nameKey),className:"absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),a.jsxs("div",{className:`absolute inset-0 flex items-center justify-center ${x===X.id?"bg-black/40":"bg-black/20 group-hover:bg-black/30"}`,children:[a.jsx("span",{className:"text-white font-medium text-sm drop-shadow-md",children:t(X.nameKey)}),x===X.id&&a.jsx("div",{className:"absolute top-2 right-2 bg-primary-500 rounded-full p-0.5",children:a.jsx(Yt,{className:"w-3 h-3 text-white"})})]})]},X.id)),(q==="city"||q==="background")&&ls.city.map(X=>a.jsxs("button",{onClick:()=>f(X.id),className:`relative group overflow-hidden rounded-xl aspect-video border-2 transition-all duration-200 ${x===X.id?"border-primary-500 ring-2 ring-primary-500/30":"border-transparent hover:border-gray-200 dark:hover:border-gray-700"}`,children:[a.jsx("img",{src:X.bg,alt:t(X.nameKey),className:"absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),a.jsxs("div",{className:`absolute inset-0 flex items-center justify-center ${x===X.id?"bg-black/40":"bg-black/20 group-hover:bg-black/30"}`,children:[a.jsx("span",{className:"text-white font-medium text-sm drop-shadow-md",children:t(X.nameKey)}),x===X.id&&a.jsx("div",{className:"absolute top-2 right-2 bg-primary-500 rounded-full p-0.5",children:a.jsx(Yt,{className:"w-3 h-3 text-white"})})]})]},X.id))]}),p.bg&&a.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.appearance.transparency")}),a.jsxs("span",{className:"text-sm text-gray-500",children:[(v*100).toFixed(0),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:v,onChange:X=>k(parseFloat(X.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-primary-500"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("settings.appearance.transparencyDesc")})]})]}),(q==="display"||q==="colors")&&a.jsx("div",{className:"space-y-8 animate-fade-in",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:t("settings.tabs.colors")}),a.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-3",children:ls.colors.map(X=>a.jsx("button",{onClick:()=>f(X.id),className:`group relative flex flex-col items-center gap-2 p-2 rounded-xl border transition-all duration-200 ${x===X.id?"border-primary-500 bg-primary-50/50 dark:bg-primary-900/20":"border-transparent hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:a.jsx("div",{className:`w-10 h-10 rounded-full shadow-sm flex items-center justify-center ${X.colorClass} text-white`,children:x===X.id&&a.jsx(Yt,{className:"w-5 h-5"})})},X.id))})]})})]})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.25s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400",children:a.jsx(ix,{className:"w-5 h-5",strokeWidth:2})}),t("settings.language.title")]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{type:"button",onClick:()=>{e.changeLanguage("ko"),r&&ee.updateUserLanguage(r.uid,"ko")},className:`p-4 rounded-xl border transition-all duration-200 flex flex-col items-center gap-2 ${e.language.startsWith("ko")?b?"bg-primary-500/30 border-primary-400 text-primary-100 font-bold":"bg-primary-50 dark:bg-primary-900/20 border-primary-500 text-primary-700 dark:text-primary-300":b?"glass-card backdrop-blur-none border-white/20 hover:bg-white/10":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-700"}`,style:b&&!e.language.startsWith("ko")?{backgroundColor:`rgba(${w?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsx("span",{className:"text-2xl",children:"ğŸ‡°ğŸ‡·"}),a.jsx("span",{className:"font-medium text-sm",children:t("settings.language.korean")})]}),a.jsxs("button",{type:"button",onClick:()=>{e.changeLanguage("en"),r&&ee.updateUserLanguage(r.uid,"en")},className:`p-4 rounded-xl border transition-all duration-200 flex flex-col items-center gap-2 ${e.language.startsWith("en")?b?"bg-primary-500/30 border-primary-400 text-primary-100 font-bold":"bg-primary-50 dark:bg-primary-900/20 border-primary-500 text-primary-700 dark:text-primary-300":b?"glass-card backdrop-blur-none border-white/20 hover:bg-white/10":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-700"}`,style:b&&!e.language.startsWith("en")?{backgroundColor:`rgba(${w?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsx("span",{className:"text-2xl",children:"ğŸ‡ºğŸ‡¸"}),a.jsx("span",{className:"font-medium text-sm",children:t("settings.language.english")})]})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.3s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-orange-50 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400",children:a.jsx(ox,{className:"w-5 h-5",strokeWidth:2})}),t("settings.font.title")]}),a.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-2xl border text-center ${b?"glass-card backdrop-blur-none border-white/20":"bg-gray-50 dark:bg-gray-800 border-gray-100 dark:border-gray-700"}`,style:b?{backgroundColor:`rgba(${w?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsx("button",{onClick:()=>_(Math.max(1,T-1)),disabled:T<=1,className:"p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-30 transition-colors",children:a.jsx("span",{className:"text-xs font-bold text-gray-600 dark:text-gray-300",children:"A"})}),a.jsx("div",{className:"flex-1 px-4",children:a.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-primary-500 transition-all duration-300",style:{width:`${(T-1)/6*100}%`}})})}),a.jsx("button",{onClick:()=>_(Math.min(7,T+1)),disabled:T>=7,className:"p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-30 transition-colors",children:a.jsx("span",{className:"text-xl font-bold text-gray-600 dark:text-gray-300",children:"A"})})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.4s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-red-50 dark:bg-red-900/30 flex items-center justify-center text-red-600 dark:text-red-400",children:a.jsx(at,{className:"w-5 h-5",strokeWidth:2})}),t("settings.holiday.title")]}),a.jsxs("form",{onSubmit:ge,className:"space-y-4 mb-6",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.holiday.name")}),a.jsx("input",{type:"text",value:W,onChange:X=>le(X.target.value),placeholder:t("settings.holiday.namePlaceholder"),className:"glass-input w-full focus:ring-primary-500 focus:border-primary-500"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.holiday.date")}),a.jsx("input",{type:"date",value:we,onChange:X=>fe(X.target.value),className:"glass-input w-full focus:ring-primary-500 focus:border-primary-500"})]})]}),a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[a.jsx("input",{type:"checkbox",checked:ie,onChange:X=>be(X.target.checked),className:" rounded border-gray-300 text-primary-600 focus:ring-primary-500 transition-colors"}),a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors",children:t("settings.holiday.recurring")}),a.jsxs("div",{className:"group relative",children:[a.jsx(Ad,{className:"w-4 h-4 text-gray-400 hover:text-primary-500 cursor-help transition-colors"}),a.jsx("div",{className:"absolute left-1/2 -top-10 -translate-x-1/2 w-48 p-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10 text-center",children:t("settings.holiday.recurringTooltip")})]})]}),a.jsxs("button",{type:"submit",disabled:!we||!W,className:"btn-primary flex items-center gap-2 px-6 py-2.5 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed transform active:scale-95 transition-all",children:[a.jsx(gt,{className:"w-4 h-4"}),t("common.add")]})]})]}),j.length>0?a.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto custom-scrollbar pr-2",children:j.map(X=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 hover:border-red-200 dark:hover:border-red-800/50 transition-all group",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${X.isRecurring?"bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400":"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"}`,children:X.isRecurring?a.jsx(Za,{className:"w-4 h-4"}):a.jsx(at,{className:"w-4 h-4"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:X.name}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[X.date," ",X.isRecurring&&`â€¢ ${t("settings.holiday.everyYear")}`]})]})]}),a.jsx("button",{onClick:()=>re(X.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:t("common.delete"),children:a.jsx(Ut,{className:"w-4 h-4"})})]},X.id))}):a.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 bg-gray-50/50 dark:bg-gray-800/50 rounded-2xl border border-dashed border-gray-200 dark:border-gray-700",children:[a.jsx(at,{className:"w-8 h-8 mx-auto mb-2 opacity-20"}),a.jsx("p",{children:t("settings.holiday.noHolidays")})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.45s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-yellow-50 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-600 dark:text-yellow-400",children:a.jsx(Xn,{className:"w-5 h-5",strokeWidth:2})}),t("settings.notification.title")]}),a.jsx("div",{className:"bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 overflow-hidden",children:a.jsxs("button",{onClick:()=>Te(!0),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[a.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:t("settings.notification.configure")}),a.jsx(gs,{className:"w-5 h-5 text-gray-400 group-hover:translate-x-1 transition-transform"})]})})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.5s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:a.jsx(lx,{className:"w-5 h-5",strokeWidth:2})}),t("settings.stats.title")]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:c?.total||0}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:t("settings.stats.total")})]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1",children:c?.completed||0}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:t("settings.stats.completed")})]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400 mb-1",children:c?.pending||0}),a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wider",children:t("settings.stats.pending")})]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50 text-center flex flex-col justify-center items-center",children:[a.jsx("div",{className:"text-lg font-bold text-gray-700 dark:text-gray-300 mb-1",children:Fe()}),a.jsxs("div",{className:"text-[10px] text-gray-400 dark:text-gray-500 font-medium uppercase tracking-wider flex items-center gap-1 justify-center",children:[a.jsx(Rd,{className:"w-3 h-3"}),t("settings.data.storage")]})]})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.5s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-purple-50 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400",children:a.jsx(cx,{className:"w-5 h-5",strokeWidth:2})}),t("settings.widget.title","Widget Settings")]}),a.jsxs("div",{className:"p-4 bg-white/50 dark:bg-gray-700/30 rounded-2xl border border-gray-100 dark:border-gray-700/50",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("settings.widget.transparency","Background Transparency")}),a.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[E,"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"100",value:E,onChange:X=>{const ve=parseInt(X.target.value);te(ve),localStorage.setItem("widgetTransparency",ve.toString())},className:"w-32 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-purple-600"})]}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:t("settings.widget.transparencyDesc","Adjust the transparency of the widget background on your home screen.")}),a.jsx("button",{onClick:async()=>{try{if(Ke.getPlatform()!=="android"){alert("ìœ„ì ¯ì€ Androidì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");return}const ve=[...n,...h()],Be=$.map(S=>{const L=C.find(A=>A.id===S.employeeId);return{...S,employeeName:L?.name||""}});await o0({todos:ve,vacations:Be}),alert("ìœ„ì ¯ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!")}catch(X){console.error("ğŸ“± Widget Sync ERROR:",X),alert("ìœ„ì ¯ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: "+X?.message)}},className:"mt-4 w-full py-2 bg-purple-600 text-white rounded-xl active:scale-95 transition-transform",children:t("settings.widget.refresh","Sync Widget Now")}),a.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:t("settings.widget.refreshDesc","If tasks are not showing, try syncing manually.")})]})]}),a.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.6s"},children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-2xl bg-green-50 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400",children:a.jsx(Rd,{className:"w-5 h-5",strokeWidth:2})}),t("settings.data.title")]}),a.jsx("div",{className:"grid grid-cols-1 gap-4",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{onClick:ue,className:"w-full flex items-center justify-between p-4 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 hover:bg-white dark:hover:bg-gray-700 hover:shadow-md transition-all group",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform",children:a.jsx(dx,{className:"w-4 h-4"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:t("settings.data.backup")}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("settings.data.backupDesc")})]})]}),a.jsx(gs,{className:"w-4 h-4 text-gray-400 group-hover:translate-x-1 transition-transform"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"file",accept:".json",onChange:se,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),a.jsxs("div",{className:"w-full flex items-center justify-between p-4 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 hover:bg-white dark:hover:bg-gray-700 hover:shadow-md transition-all group",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/30 rounded-lg text-green-600 dark:text-green-400 group-hover:scale-110 transition-transform",children:a.jsx(ux,{className:"w-4 h-4"})}),a.jsxs("div",{className:"text-left",children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:t("settings.data.restore")}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("settings.data.restoreDesc")})]})]}),a.jsx(gs,{className:"w-4 h-4 text-gray-400 group-hover:translate-x-1 transition-transform"})]})]})]})}),R&&a.jsxs("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 rounded-xl flex items-center gap-2 text-sm text-red-600 dark:text-red-400 animate-shake",children:[a.jsx(Zg,{className:"w-4 h-4 flex-shrink-0"}),R]}),Y&&a.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-900/30 rounded-xl flex items-center gap-2 text-sm text-green-600 dark:text-green-400 animate-slide-in",children:[a.jsx(Yt,{className:"w-4 h-4 flex-shrink-0"}),t("settings.data.restoreSuccess")]}),a.jsxs("button",{onClick:Ie,className:"mt-6 w-full flex items-center justify-center gap-2 p-3 text-red-600 dark:text-red-400 bg-red-50 hover:bg-red-100 dark:bg-red-900/10 dark:hover:bg-red-900/20 rounded-xl transition-colors text-sm font-medium",children:[a.jsx(Ut,{className:"w-4 h-4"}),t("settings.data.clearCompleted")]})]}),a.jsx("div",{className:"text-center pb-8 pt-4",children:a.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full",children:[a.jsx(Ad,{className:"w-3 h-3 text-gray-400"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"TodoList App v1.0.0 â€¢ Â© 2024"})]})}),de&&a.jsx(nC,{onClose:()=>Te(!1)})]})})},l0=({onClick:t})=>{const{theme:e}=Lt();return a.jsxs("button",{onClick:t,className:"fixed bottom-24 right-4 z-50 group md:bottom-8","aria-label":"í• ì¼ ì¶”ê°€",children:[a.jsx("div",{className:"absolute inset-0 rounded-full bg-primary-500 blur-lg opacity-40 group-hover:opacity-60 transition-opacity duration-300 animate-pulse"}),a.jsx("div",{className:`
        relative flex items-center justify-center 
        w-14 h-14 rounded-full
        bg-gradient-to-r from-primary-600 to-primary-500
        text-white shadow-lg shadow-primary-500/40
        transform transition-all duration-300
        group-hover:scale-110 group-active:scale-95
        group-hover:shadow-primary-500/60
      `,children:a.jsx(gt,{className:"w-7 h-7 transition-transform duration-300 group-hover:rotate-90",strokeWidth:2.5})})]})},cC=Object.freeze(Object.defineProperty({__proto__:null,default:l0},Symbol.toStringTag,{value:"Module"})),c0=y.createContext({});function dC(t){const e=y.useRef(null);return e.current===null&&(e.current=t()),e.current}const Jc=typeof window<"u",uC=Jc?y.useLayoutEffect:y.useEffect,Zc=y.createContext(null);function ed(t,e){t.indexOf(e)===-1&&t.push(e)}function td(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}const Cr=(t,e,r)=>r>e?e:r<t?t:r;let rd=()=>{};const Er={},d0=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function u0(t){return typeof t=="object"&&t!==null}const h0=t=>/^0[^.\s]+$/u.test(t);function sd(t){let e;return()=>(e===void 0&&(e=t()),e)}const Xt=t=>t,hC=(t,e)=>r=>e(t(r)),Ea=(...t)=>t.reduce(hC),ua=(t,e,r)=>{const s=e-t;return s===0?1:(r-t)/s};class nd{constructor(){this.subscriptions=[]}add(e){return ed(this.subscriptions,e),()=>td(this.subscriptions,e)}notify(e,r,s){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](e,r,s);else for(let i=0;i<n;i++){const o=this.subscriptions[i];o&&o(e,r,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const fr=t=>t*1e3,qt=t=>t/1e3;function g0(t,e){return e?t*(1e3/e):0}const m0=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,gC=1e-7,mC=12;function fC(t,e,r,s,n){let i,o,l=0;do o=e+(r-e)/2,i=m0(o,s,n)-t,i>0?r=o:e=o;while(Math.abs(i)>gC&&++l<mC);return o}function Ia(t,e,r,s){if(t===e&&r===s)return Xt;const n=i=>fC(i,0,1,t,r);return i=>i===0||i===1?i:m0(n(i),e,s)}const f0=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,p0=t=>e=>1-t(1-e),y0=Ia(.33,1.53,.69,.99),ad=p0(y0),x0=f0(ad),b0=t=>(t*=2)<1?.5*ad(t):.5*(2-Math.pow(2,-10*(t-1))),id=t=>1-Math.sin(Math.acos(t)),v0=p0(id),w0=f0(id),pC=Ia(.42,0,1,1),yC=Ia(0,0,.58,1),k0=Ia(.42,0,.58,1),xC=t=>Array.isArray(t)&&typeof t[0]!="number",T0=t=>Array.isArray(t)&&typeof t[0]=="number",bC={linear:Xt,easeIn:pC,easeInOut:k0,easeOut:yC,circIn:id,circInOut:w0,circOut:v0,backIn:ad,backInOut:x0,backOut:y0,anticipate:b0},vC=t=>typeof t=="string",Sh=t=>{if(T0(t)){rd(t.length===4);const[e,r,s,n]=t;return Ia(e,r,s,n)}else if(vC(t))return bC[t];return t},Va=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function wC(t,e){let r=new Set,s=new Set,n=!1,i=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(d.schedule(u),t()),u(l)}const d={schedule:(u,h=!1,g=!1)=>{const x=g&&n?r:s;return h&&o.add(u),x.has(u)||x.add(u),u},cancel:u=>{s.delete(u),o.delete(u)},process:u=>{if(l=u,n){i=!0;return}n=!0,[r,s]=[s,r],r.forEach(c),r.clear(),n=!1,i&&(i=!1,d.process(u))}};return d}const kC=40;function N0(t,e){let r=!1,s=!0;const n={delta:0,timestamp:0,isProcessing:!1},i=()=>r=!0,o=Va.reduce((k,b)=>(k[b]=wC(i),k),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:h,preRender:g,render:m,postRender:x}=o,f=()=>{const k=Er.useManualTiming?n.timestamp:performance.now();r=!1,Er.useManualTiming||(n.delta=s?1e3/60:Math.max(Math.min(k-n.timestamp,kC),1)),n.timestamp=k,n.isProcessing=!0,l.process(n),c.process(n),d.process(n),u.process(n),h.process(n),g.process(n),m.process(n),x.process(n),n.isProcessing=!1,r&&e&&(s=!1,t(f))},p=()=>{r=!0,s=!0,n.isProcessing||t(f)};return{schedule:Va.reduce((k,b)=>{const T=o[b];return k[b]=(_,j=!1,N=!1)=>(r||p(),T.schedule(_,j,N)),k},{}),cancel:k=>{for(let b=0;b<Va.length;b++)o[Va[b]].cancel(k)},state:n,steps:o}}const{schedule:et,cancel:Jr,state:vt,steps:Oo}=N0(typeof requestAnimationFrame<"u"?requestAnimationFrame:Xt,!0);let qa;function TC(){qa=void 0}const Rt={now:()=>(qa===void 0&&Rt.set(vt.isProcessing||Er.useManualTiming?vt.timestamp:performance.now()),qa),set:t=>{qa=t,queueMicrotask(TC)}},S0=t=>e=>typeof e=="string"&&e.startsWith(t),j0=S0("--"),NC=S0("var(--"),od=t=>NC(t)?SC.test(t.split("/*")[0].trim()):!1,SC=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,gn={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ha={...gn,transform:t=>Cr(0,1,t)},Ua={...gn,default:1},Gn=t=>Math.round(t*1e5)/1e5,ld=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function jC(t){return t==null}const _C=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,cd=(t,e)=>r=>!!(typeof r=="string"&&_C.test(r)&&r.startsWith(t)||e&&!jC(r)&&Object.prototype.hasOwnProperty.call(r,e)),_0=(t,e,r)=>s=>{if(typeof s!="string")return s;const[n,i,o,l]=s.match(ld);return{[t]:parseFloat(n),[e]:parseFloat(i),[r]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},DC=t=>Cr(0,255,t),Lo={...gn,transform:t=>Math.round(DC(t))},us={test:cd("rgb","red"),parse:_0("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:s=1})=>"rgba("+Lo.transform(t)+", "+Lo.transform(e)+", "+Lo.transform(r)+", "+Gn(ha.transform(s))+")"};function CC(t){let e="",r="",s="",n="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),s=t.substring(5,7),n=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),s=t.substring(3,4),n=t.substring(4,5),e+=e,r+=r,s+=s,n+=n),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(s,16),alpha:n?parseInt(n,16)/255:1}}const _l={test:cd("#"),parse:CC,transform:us.transform},Aa=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Fr=Aa("deg"),pr=Aa("%"),Ce=Aa("px"),EC=Aa("vh"),IC=Aa("vw"),jh={...pr,parse:t=>pr.parse(t)/100,transform:t=>pr.transform(t*100)},$s={test:cd("hsl","hue"),parse:_0("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:s=1})=>"hsla("+Math.round(t)+", "+pr.transform(Gn(e))+", "+pr.transform(Gn(r))+", "+Gn(ha.transform(s))+")"},lt={test:t=>us.test(t)||_l.test(t)||$s.test(t),parse:t=>us.test(t)?us.parse(t):$s.test(t)?$s.parse(t):_l.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?us.transform(t):$s.transform(t),getAnimatableNone:t=>{const e=lt.parse(t);return e.alpha=0,lt.transform(e)}},AC=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function RC(t){return isNaN(t)&&typeof t=="string"&&(t.match(ld)?.length||0)+(t.match(AC)?.length||0)>0}const D0="number",C0="color",PC="var",MC="var(",_h="${}",OC=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ga(t){const e=t.toString(),r=[],s={color:[],number:[],var:[]},n=[];let i=0;const l=e.replace(OC,c=>(lt.test(c)?(s.color.push(i),n.push(C0),r.push(lt.parse(c))):c.startsWith(MC)?(s.var.push(i),n.push(PC),r.push(c)):(s.number.push(i),n.push(D0),r.push(parseFloat(c))),++i,_h)).split(_h);return{values:r,split:l,indexes:s,types:n}}function E0(t){return ga(t).values}function I0(t){const{split:e,types:r}=ga(t),s=e.length;return n=>{let i="";for(let o=0;o<s;o++)if(i+=e[o],n[o]!==void 0){const l=r[o];l===D0?i+=Gn(n[o]):l===C0?i+=lt.transform(n[o]):i+=n[o]}return i}}const LC=t=>typeof t=="number"?0:lt.test(t)?lt.getAnimatableNone(t):t;function $C(t){const e=E0(t);return I0(t)(e.map(LC))}const Zr={test:RC,parse:E0,createTransformer:I0,getAnimatableNone:$C};function $o(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function FC({hue:t,saturation:e,lightness:r,alpha:s}){t/=360,e/=100,r/=100;let n=0,i=0,o=0;if(!e)n=i=o=r;else{const l=r<.5?r*(1+e):r+e-r*e,c=2*r-l;n=$o(c,l,t+1/3),i=$o(c,l,t),o=$o(c,l,t-1/3)}return{red:Math.round(n*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:s}}function Ii(t,e){return r=>r>0?e:t}const tt=(t,e,r)=>t+(e-t)*r,Fo=(t,e,r)=>{const s=t*t,n=r*(e*e-s)+s;return n<0?0:Math.sqrt(n)},WC=[_l,us,$s],VC=t=>WC.find(e=>e.test(t));function Dh(t){const e=VC(t);if(!e)return!1;let r=e.parse(t);return e===$s&&(r=FC(r)),r}const Ch=(t,e)=>{const r=Dh(t),s=Dh(e);if(!r||!s)return Ii(t,e);const n={...r};return i=>(n.red=Fo(r.red,s.red,i),n.green=Fo(r.green,s.green,i),n.blue=Fo(r.blue,s.blue,i),n.alpha=tt(r.alpha,s.alpha,i),us.transform(n))},Dl=new Set(["none","hidden"]);function UC(t,e){return Dl.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function BC(t,e){return r=>tt(t,e,r)}function dd(t){return typeof t=="number"?BC:typeof t=="string"?od(t)?Ii:lt.test(t)?Ch:zC:Array.isArray(t)?A0:typeof t=="object"?lt.test(t)?Ch:HC:Ii}function A0(t,e){const r=[...t],s=r.length,n=t.map((i,o)=>dd(i)(i,e[o]));return i=>{for(let o=0;o<s;o++)r[o]=n[o](i);return r}}function HC(t,e){const r={...t,...e},s={};for(const n in r)t[n]!==void 0&&e[n]!==void 0&&(s[n]=dd(t[n])(t[n],e[n]));return n=>{for(const i in s)r[i]=s[i](n);return r}}function GC(t,e){const r=[],s={color:0,var:0,number:0};for(let n=0;n<e.values.length;n++){const i=e.types[n],o=t.indexes[i][s[i]],l=t.values[o]??0;r[n]=l,s[i]++}return r}const zC=(t,e)=>{const r=Zr.createTransformer(e),s=ga(t),n=ga(e);return s.indexes.var.length===n.indexes.var.length&&s.indexes.color.length===n.indexes.color.length&&s.indexes.number.length>=n.indexes.number.length?Dl.has(t)&&!n.values.length||Dl.has(e)&&!s.values.length?UC(t,e):Ea(A0(GC(s,n),n.values),r):Ii(t,e)};function R0(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?tt(t,e,r):dd(t)(t,e)}const KC=t=>{const e=({timestamp:r})=>t(r);return{start:(r=!0)=>et.update(e,r),stop:()=>Jr(e),now:()=>vt.isProcessing?vt.timestamp:Rt.now()}},P0=(t,e,r=10)=>{let s="";const n=Math.max(Math.round(e/r),2);for(let i=0;i<n;i++)s+=Math.round(t(i/(n-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},Ai=2e4;function ud(t){let e=0;const r=50;let s=t.next(e);for(;!s.done&&e<Ai;)e+=r,s=t.next(e);return e>=Ai?1/0:e}function YC(t,e=100,r){const s=r({...t,keyframes:[0,e]}),n=Math.min(ud(s),Ai);return{type:"keyframes",ease:i=>s.next(n*i).value/e,duration:qt(n)}}const qC=5;function M0(t,e,r){const s=Math.max(e-qC,0);return g0(r-t(s),e-s)}const nt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Wo=.001;function XC({duration:t=nt.duration,bounce:e=nt.bounce,velocity:r=nt.velocity,mass:s=nt.mass}){let n,i,o=1-e;o=Cr(nt.minDamping,nt.maxDamping,o),t=Cr(nt.minDuration,nt.maxDuration,qt(t)),o<1?(n=d=>{const u=d*o,h=u*t,g=u-r,m=Cl(d,o),x=Math.exp(-h);return Wo-g/m*x},i=d=>{const h=d*o*t,g=h*r+r,m=Math.pow(o,2)*Math.pow(d,2)*t,x=Math.exp(-h),f=Cl(Math.pow(d,2),o);return(-n(d)+Wo>0?-1:1)*((g-m)*x)/f}):(n=d=>{const u=Math.exp(-d*t),h=(d-r)*t+1;return-Wo+u*h},i=d=>{const u=Math.exp(-d*t),h=(r-d)*(t*t);return u*h});const l=5/t,c=JC(n,i,l);if(t=fr(t),isNaN(c))return{stiffness:nt.stiffness,damping:nt.damping,duration:t};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:o*2*Math.sqrt(s*d),duration:t}}}const QC=12;function JC(t,e,r){let s=r;for(let n=1;n<QC;n++)s=s-t(s)/e(s);return s}function Cl(t,e){return t*Math.sqrt(1-e*e)}const ZC=["duration","bounce"],eE=["stiffness","damping","mass"];function Eh(t,e){return e.some(r=>t[r]!==void 0)}function tE(t){let e={velocity:nt.velocity,stiffness:nt.stiffness,damping:nt.damping,mass:nt.mass,isResolvedFromDuration:!1,...t};if(!Eh(t,eE)&&Eh(t,ZC))if(t.visualDuration){const r=t.visualDuration,s=2*Math.PI/(r*1.2),n=s*s,i=2*Cr(.05,1,1-(t.bounce||0))*Math.sqrt(n);e={...e,mass:nt.mass,stiffness:n,damping:i}}else{const r=XC(t);e={...e,...r,mass:nt.mass},e.isResolvedFromDuration=!0}return e}function Ri(t=nt.visualDuration,e=nt.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:s,restDelta:n}=r;const i=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],l={done:!1,value:i},{stiffness:c,damping:d,mass:u,duration:h,velocity:g,isResolvedFromDuration:m}=tE({...r,velocity:-qt(r.velocity||0)}),x=g||0,f=d/(2*Math.sqrt(c*u)),p=o-i,w=qt(Math.sqrt(c/u)),v=Math.abs(p)<5;s||(s=v?nt.restSpeed.granular:nt.restSpeed.default),n||(n=v?nt.restDelta.granular:nt.restDelta.default);let k;if(f<1){const T=Cl(w,f);k=_=>{const j=Math.exp(-f*w*_);return o-j*((x+f*w*p)/T*Math.sin(T*_)+p*Math.cos(T*_))}}else if(f===1)k=T=>o-Math.exp(-w*T)*(p+(x+w*p)*T);else{const T=w*Math.sqrt(f*f-1);k=_=>{const j=Math.exp(-f*w*_),N=Math.min(T*_,300);return o-j*((x+f*w*p)*Math.sinh(N)+T*p*Math.cosh(N))/T}}const b={calculatedDuration:m&&h||null,next:T=>{const _=k(T);if(m)l.done=T>=h;else{let j=T===0?x:0;f<1&&(j=T===0?fr(x):M0(k,T,_));const N=Math.abs(j)<=s,D=Math.abs(o-_)<=n;l.done=N&&D}return l.value=l.done?o:_,l},toString:()=>{const T=Math.min(ud(b),Ai),_=P0(j=>b.next(T*j).value,T,30);return T+"ms "+_},toTransition:()=>{}};return b}Ri.applyToOptions=t=>{const e=YC(t,100,Ri);return t.ease=e.ease,t.duration=fr(e.duration),t.type="keyframes",t};function El({keyframes:t,velocity:e=0,power:r=.8,timeConstant:s=325,bounceDamping:n=10,bounceStiffness:i=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:u}){const h=t[0],g={done:!1,value:h},m=N=>l!==void 0&&N<l||c!==void 0&&N>c,x=N=>l===void 0?c:c===void 0||Math.abs(l-N)<Math.abs(c-N)?l:c;let f=r*e;const p=h+f,w=o===void 0?p:o(p);w!==p&&(f=w-h);const v=N=>-f*Math.exp(-N/s),k=N=>w+v(N),b=N=>{const D=v(N),$=k(N);g.done=Math.abs(D)<=d,g.value=g.done?w:$};let T,_;const j=N=>{m(g.value)&&(T=N,_=Ri({keyframes:[g.value,x(g.value)],velocity:M0(k,N,g.value),damping:n,stiffness:i,restDelta:d,restSpeed:u}))};return j(0),{calculatedDuration:null,next:N=>{let D=!1;return!_&&T===void 0&&(D=!0,b(N),j(N)),T!==void 0&&N>=T?_.next(N-T):(!D&&b(N),g)}}}function rE(t,e,r){const s=[],n=r||Er.mix||R0,i=t.length-1;for(let o=0;o<i;o++){let l=n(t[o],t[o+1]);if(e){const c=Array.isArray(e)?e[o]||Xt:e;l=Ea(c,l)}s.push(l)}return s}function sE(t,e,{clamp:r=!0,ease:s,mixer:n}={}){const i=t.length;if(rd(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=rE(e,s,n),c=l.length,d=u=>{if(o&&u<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(u<t[h+1]);h++);const g=ua(t[h],t[h+1],u);return l[h](g)};return r?u=>d(Cr(t[0],t[i-1],u)):d}function nE(t,e){const r=t[t.length-1];for(let s=1;s<=e;s++){const n=ua(0,e,s);t.push(tt(r,1,n))}}function aE(t){const e=[0];return nE(e,t.length-1),e}function iE(t,e){return t.map(r=>r*e)}function oE(t,e){return t.map(()=>e||k0).splice(0,t.length-1)}function zn({duration:t=300,keyframes:e,times:r,ease:s="easeInOut"}){const n=xC(s)?s.map(Sh):Sh(s),i={done:!1,value:e[0]},o=iE(r&&r.length===e.length?r:aE(e),t),l=sE(o,e,{ease:Array.isArray(n)?n:oE(e,n)});return{calculatedDuration:t,next:c=>(i.value=l(c),i.done=c>=t,i)}}const lE=t=>t!==null;function hd(t,{repeat:e,repeatType:r="loop"},s,n=1){const i=t.filter(lE),l=n<0||e&&r!=="loop"&&e%2===1?0:i.length-1;return!l||s===void 0?i[l]:s}const cE={decay:El,inertia:El,tween:zn,keyframes:zn,spring:Ri};function O0(t){typeof t.type=="string"&&(t.type=cE[t.type])}class gd{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,r){return this.finished.then(e,r)}}const dE=t=>t/100;class md extends gd{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==Rt.now()&&this.tick(Rt.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;O0(e);const{type:r=zn,repeat:s=0,repeatDelay:n=0,repeatType:i,velocity:o=0}=e;let{keyframes:l}=e;const c=r||zn;c!==zn&&typeof l[0]!="number"&&(this.mixKeyframes=Ea(dE,R0(l[0],l[1])),l=[0,100]);const d=c({...e,keyframes:l});i==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=ud(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+n,this.totalDuration=this.resolvedDuration*(s+1)-n,this.generator=d}updateTime(e){const r=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(e,r=!1){const{generator:s,totalDuration:n,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:g,repeatDelay:m,type:x,onUpdate:f,finalKeyframe:p}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-n/this.speed,this.startTime)),r?this.currentTime=e:this.updateTime(e);const w=this.currentTime-d*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?w<0:w>n;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=n);let k=this.currentTime,b=s;if(h){const N=Math.min(this.currentTime,n)/l;let D=Math.floor(N),$=N%1;!$&&N>=1&&($=1),$===1&&D--,D=Math.min(D,h+1),!!(D%2)&&(g==="reverse"?($=1-$,m&&($-=m/l)):g==="mirror"&&(b=o)),k=Cr(0,1,$)*l}const T=v?{done:!1,value:u[0]}:b.next(k);i&&(T.value=i(T.value));let{done:_}=T;!v&&c!==null&&(_=this.playbackSpeed>=0?this.currentTime>=n:this.currentTime<=0);const j=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&_);return j&&x!==El&&(T.value=hd(u,this.options,p,this.speed)),f&&f(T.value),j&&this.finish(),T}then(e,r){return this.finished.then(e,r)}get duration(){return qt(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+qt(e)}get time(){return qt(this.currentTime)}set time(e){e=fr(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Rt.now());const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=qt(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=KC,startTime:r}=this.options;this.driver||(this.driver=e(n=>this.tick(n))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=r??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Rt.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function uE(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const hs=t=>t*180/Math.PI,Il=t=>{const e=hs(Math.atan2(t[1],t[0]));return Al(e)},hE={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Il,rotateZ:Il,skewX:t=>hs(Math.atan(t[1])),skewY:t=>hs(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Al=t=>(t=t%360,t<0&&(t+=360),t),Ih=Il,Ah=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),Rh=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),gE={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Ah,scaleY:Rh,scale:t=>(Ah(t)+Rh(t))/2,rotateX:t=>Al(hs(Math.atan2(t[6],t[5]))),rotateY:t=>Al(hs(Math.atan2(-t[2],t[0]))),rotateZ:Ih,rotate:Ih,skewX:t=>hs(Math.atan(t[4])),skewY:t=>hs(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Rl(t){return t.includes("scale")?1:0}function Pl(t,e){if(!t||t==="none")return Rl(e);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,n;if(r)s=gE,n=r;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=hE,n=l}if(!n)return Rl(e);const i=s[e],o=n[1].split(",").map(fE);return typeof i=="function"?i(o):o[i]}const mE=(t,e)=>{const{transform:r="none"}=getComputedStyle(t);return Pl(r,e)};function fE(t){return parseFloat(t.trim())}const mn=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],fn=new Set(mn),Ph=t=>t===gn||t===Ce,pE=new Set(["x","y","z"]),yE=mn.filter(t=>!pE.has(t));function xE(t){const e=[];return yE.forEach(r=>{const s=t.getValue(r);s!==void 0&&(e.push([r,s.get()]),s.set(r.startsWith("scale")?1:0))}),e}const ps={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Pl(e,"x"),y:(t,{transform:e})=>Pl(e,"y")};ps.translateX=ps.x;ps.translateY=ps.y;const ys=new Set;let Ml=!1,Ol=!1,Ll=!1;function L0(){if(Ol){const t=Array.from(ys).filter(s=>s.needsMeasurement),e=new Set(t.map(s=>s.element)),r=new Map;e.forEach(s=>{const n=xE(s);n.length&&(r.set(s,n),s.render())}),t.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const n=r.get(s);n&&n.forEach(([i,o])=>{s.getValue(i)?.set(o)})}),t.forEach(s=>s.measureEndState()),t.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}Ol=!1,Ml=!1,ys.forEach(t=>t.complete(Ll)),ys.clear()}function $0(){ys.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Ol=!0)})}function bE(){Ll=!0,$0(),L0(),Ll=!1}class fd{constructor(e,r,s,n,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=s,this.motionValue=n,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(ys.add(this),Ml||(Ml=!0,et.read($0),et.resolveKeyframes(L0))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:s,motionValue:n}=this;if(e[0]===null){const i=n?.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(s&&r){const l=s.readValue(r,o);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=o),n&&i===void 0&&n.set(e[0])}uE(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),ys.delete(this)}cancel(){this.state==="scheduled"&&(ys.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const vE=t=>t.startsWith("--");function wE(t,e,r){vE(e)?t.style.setProperty(e,r):t.style[e]=r}const kE=sd(()=>window.ScrollTimeline!==void 0),TE={};function NE(t,e){const r=sd(t);return()=>TE[e]??r()}const F0=NE(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),In=([t,e,r,s])=>`cubic-bezier(${t}, ${e}, ${r}, ${s})`,Mh={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:In([0,.65,.55,1]),circOut:In([.55,0,1,.45]),backIn:In([.31,.01,.66,-.59]),backOut:In([.33,1.53,.69,.99])};function W0(t,e){if(t)return typeof t=="function"?F0()?P0(t,e):"ease-out":T0(t)?In(t):Array.isArray(t)?t.map(r=>W0(r,e)||Mh.easeOut):Mh[t]}function SE(t,e,r,{delay:s=0,duration:n=300,repeat:i=0,repeatType:o="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[e]:r};c&&(u.offset=c);const h=W0(l,n);Array.isArray(h)&&(u.easing=h);const g={delay:s,duration:n,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return d&&(g.pseudoElement=d),t.animate(u,g)}function V0(t){return typeof t=="function"&&"applyToOptions"in t}function jE({type:t,...e}){return V0(t)&&F0()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class _E extends gd{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:r,name:s,keyframes:n,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,rd(typeof e.type!="string");const d=jE(e);this.animation=SE(r,s,n,d,i),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const u=hd(n,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):wE(r,s,u),this.animation.cancel()}c?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return qt(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+qt(e)}get time(){return qt(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=fr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&kE()?(this.animation.timeline=e,Xt):r(this)}}const U0={anticipate:b0,backInOut:x0,circInOut:w0};function DE(t){return t in U0}function CE(t){typeof t.ease=="string"&&DE(t.ease)&&(t.ease=U0[t.ease])}const Oh=10;class EE extends _E{constructor(e){CE(e),O0(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:r,onUpdate:s,onComplete:n,element:i,...o}=this.options;if(!r)return;if(e!==void 0){r.set(e);return}const l=new md({...o,autoplay:!1}),c=fr(this.finishedTime??this.time);r.setWithVelocity(l.sample(c-Oh).value,l.sample(c).value,Oh),l.stop()}}const Lh=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Zr.test(t)||t==="0")&&!t.startsWith("url("));function IE(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function AE(t,e,r,s){const n=t[0];if(n===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=Lh(n,e),l=Lh(i,e);return!o||!l?!1:IE(t)||(r==="spring"||V0(r))&&s}function $l(t){t.duration=0,t.type="keyframes"}const RE=new Set(["opacity","clipPath","filter","transform"]),PE=sd(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function ME(t){const{motionValue:e,name:r,repeatDelay:s,repeatType:n,damping:i,type:o}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=e.owner.getProps();return PE()&&r&&RE.has(r)&&(r!=="transform"||!d)&&!c&&!s&&n!=="mirror"&&i!==0&&o!=="inertia"}const OE=40;class LE extends gd{constructor({autoplay:e=!0,delay:r=0,type:s="keyframes",repeat:n=0,repeatDelay:i=0,repeatType:o="loop",keyframes:l,name:c,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Rt.now();const g={autoplay:e,delay:r,type:s,repeat:n,repeatDelay:i,repeatType:o,name:c,motionValue:d,element:u,...h},m=u?.KeyframeResolver||fd;this.keyframeResolver=new m(l,(x,f,p)=>this.onKeyframesResolved(x,f,g,!p),c,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,r,s,n){this.keyframeResolver=void 0;const{name:i,type:o,velocity:l,delay:c,isHandoff:d,onUpdate:u}=s;this.resolvedAt=Rt.now(),AE(e,i,o,l)||((Er.instantAnimations||!c)&&u?.(hd(e,s,r)),e[0]=e[e.length-1],$l(s),s.repeat=0);const g={startTime:n?this.resolvedAt?this.resolvedAt-this.createdAt>OE?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...s,keyframes:e},m=!d&&ME(g)?new EE({...g,element:g.motionValue.owner.current}):new md(g);m.finished.then(()=>this.notifyFinished()).catch(Xt),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,r){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),bE()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const $E=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function FE(t){const e=$E.exec(t);if(!e)return[,];const[,r,s,n]=e;return[`--${r??s}`,n]}function B0(t,e,r=1){const[s,n]=FE(t);if(!s)return;const i=window.getComputedStyle(e).getPropertyValue(s);if(i){const o=i.trim();return d0(o)?parseFloat(o):o}return od(n)?B0(n,e,r+1):n}function pd(t,e){return t?.[e]??t?.default??t}const H0=new Set(["width","height","top","left","right","bottom",...mn]),WE={test:t=>t==="auto",parse:t=>t},G0=t=>e=>e.test(t),z0=[gn,Ce,pr,Fr,IC,EC,WE],$h=t=>z0.find(G0(t));function VE(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||h0(t):!0}const UE=new Set(["brightness","contrast","saturate","opacity"]);function BE(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=r.match(ld)||[];if(!s)return t;const n=r.replace(s,"");let i=UE.has(e)?1:0;return s!==r&&(i*=100),e+"("+i+n+")"}const HE=/\b([a-z-]*)\(.*?\)/gu,Fl={...Zr,getAnimatableNone:t=>{const e=t.match(HE);return e?e.map(BE).join(" "):t}},Fh={...gn,transform:Math.round},GE={rotate:Fr,rotateX:Fr,rotateY:Fr,rotateZ:Fr,scale:Ua,scaleX:Ua,scaleY:Ua,scaleZ:Ua,skew:Fr,skewX:Fr,skewY:Fr,distance:Ce,translateX:Ce,translateY:Ce,translateZ:Ce,x:Ce,y:Ce,z:Ce,perspective:Ce,transformPerspective:Ce,opacity:ha,originX:jh,originY:jh,originZ:Ce},yd={borderWidth:Ce,borderTopWidth:Ce,borderRightWidth:Ce,borderBottomWidth:Ce,borderLeftWidth:Ce,borderRadius:Ce,radius:Ce,borderTopLeftRadius:Ce,borderTopRightRadius:Ce,borderBottomRightRadius:Ce,borderBottomLeftRadius:Ce,width:Ce,maxWidth:Ce,height:Ce,maxHeight:Ce,top:Ce,right:Ce,bottom:Ce,left:Ce,padding:Ce,paddingTop:Ce,paddingRight:Ce,paddingBottom:Ce,paddingLeft:Ce,margin:Ce,marginTop:Ce,marginRight:Ce,marginBottom:Ce,marginLeft:Ce,backgroundPositionX:Ce,backgroundPositionY:Ce,...GE,zIndex:Fh,fillOpacity:ha,strokeOpacity:ha,numOctaves:Fh},zE={...yd,color:lt,backgroundColor:lt,outlineColor:lt,fill:lt,stroke:lt,borderColor:lt,borderTopColor:lt,borderRightColor:lt,borderBottomColor:lt,borderLeftColor:lt,filter:Fl,WebkitFilter:Fl},K0=t=>zE[t];function Y0(t,e){let r=K0(t);return r!==Fl&&(r=Zr),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const KE=new Set(["auto","none","0"]);function YE(t,e,r){let s=0,n;for(;s<t.length&&!n;){const i=t[s];typeof i=="string"&&!KE.has(i)&&ga(i).values.length&&(n=t[s]),s++}if(n&&r)for(const i of e)t[i]=Y0(r,n)}class qE extends fd{constructor(e,r,s,n,i){super(e,r,s,n,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:s}=this;if(!r||!r.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let d=e[c];if(typeof d=="string"&&(d=d.trim(),od(d))){const u=B0(d,r.current);u!==void 0&&(e[c]=u),c===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!H0.has(s)||e.length!==2)return;const[n,i]=e,o=$h(n),l=$h(i);if(o!==l)if(Ph(o)&&Ph(l))for(let c=0;c<e.length;c++){const d=e[c];typeof d=="string"&&(e[c]=parseFloat(d))}else ps[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,s=[];for(let n=0;n<e.length;n++)(e[n]===null||VE(e[n]))&&s.push(n);s.length&&YE(e,s,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ps[s](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const n=r[r.length-1];n!==void 0&&e.getValue(s,n).jump(n,!1)}measureEndState(){const{element:e,name:r,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const n=e.getValue(r);n&&n.jump(this.measuredOrigin,!1);const i=s.length-1,o=s[i];s[i]=ps[r](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([l,c])=>{e.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function XE(t,e,r){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let s=document;const n=r?.[t]??s.querySelectorAll(t);return n?Array.from(n):[]}return Array.from(t)}const q0=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function QE(t){return u0(t)&&"offsetHeight"in t}const Wh=30,JE=t=>!isNaN(parseFloat(t));class ZE{constructor(e,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const n=Rt.now();if(this.updatedAt!==n&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=Rt.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=JE(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new nd);const s=this.events[e].add(r);return e==="change"?()=>{s(),et.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,r,s){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Rt.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Wh)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,Wh);return g0(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function en(t,e){return new ZE(t,e)}const{schedule:xd}=N0(queueMicrotask,!1),Zt={x:!1,y:!1};function X0(){return Zt.x||Zt.y}function e1(t){return t==="x"||t==="y"?Zt[t]?null:(Zt[t]=!0,()=>{Zt[t]=!1}):Zt.x||Zt.y?null:(Zt.x=Zt.y=!0,()=>{Zt.x=Zt.y=!1})}function Q0(t,e){const r=XE(t),s=new AbortController,n={passive:!0,...e,signal:s.signal};return[r,n,()=>s.abort()]}function Vh(t){return!(t.pointerType==="touch"||X0())}function t1(t,e,r={}){const[s,n,i]=Q0(t,r),o=l=>{if(!Vh(l))return;const{target:c}=l,d=e(c,l);if(typeof d!="function"||!c)return;const u=h=>{Vh(h)&&(d(h),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,n)};return s.forEach(l=>{l.addEventListener("pointerenter",o,n)}),i}const J0=(t,e)=>e?t===e?!0:J0(t,e.parentElement):!1,bd=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,r1=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function s1(t){return r1.has(t.tagName)||t.tabIndex!==-1}const Xa=new WeakSet;function Uh(t){return e=>{e.key==="Enter"&&t(e)}}function Vo(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const n1=(t,e)=>{const r=t.currentTarget;if(!r)return;const s=Uh(()=>{if(Xa.has(r))return;Vo(r,"down");const n=Uh(()=>{Vo(r,"up")}),i=()=>Vo(r,"cancel");r.addEventListener("keyup",n,e),r.addEventListener("blur",i,e)});r.addEventListener("keydown",s,e),r.addEventListener("blur",()=>r.removeEventListener("keydown",s),e)};function Bh(t){return bd(t)&&!X0()}function a1(t,e,r={}){const[s,n,i]=Q0(t,r),o=l=>{const c=l.currentTarget;if(!Bh(l))return;Xa.add(c);const d=e(c,l),u=(m,x)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",g),Xa.has(c)&&Xa.delete(c),Bh(m)&&typeof d=="function"&&d(m,{success:x})},h=m=>{u(m,c===window||c===document||r.useGlobalTarget||J0(c,m.target))},g=m=>{u(m,!1)};window.addEventListener("pointerup",h,n),window.addEventListener("pointercancel",g,n)};return s.forEach(l=>{(r.useGlobalTarget?window:l).addEventListener("pointerdown",o,n),QE(l)&&(l.addEventListener("focus",d=>n1(d,n)),!s1(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),i}function Z0(t){return u0(t)&&"ownerSVGElement"in t}function i1(t){return Z0(t)&&t.tagName==="svg"}const Nt=t=>!!(t&&t.getVelocity),o1=[...z0,lt,Zr],l1=t=>o1.find(G0(t)),ey=y.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function c1(t=!0){const e=y.useContext(Zc);if(e===null)return[!0,null];const{isPresent:r,onExitComplete:s,register:n}=e,i=y.useId();y.useEffect(()=>{if(t)return n(i)},[t]);const o=y.useCallback(()=>t&&s&&s(i),[i,s,t]);return!r&&s?[!1,o]:[!0]}const ty=y.createContext({strict:!1}),Hh={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},tn={};for(const t in Hh)tn[t]={isEnabled:e=>Hh[t].some(r=>!!e[r])};function d1(t){for(const e in t)tn[e]={...tn[e],...t[e]}}const u1=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Pi(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||u1.has(t)}let ry=t=>!Pi(t);function h1(t){typeof t=="function"&&(ry=e=>e.startsWith("on")?!Pi(e):t(e))}try{h1(require("@emotion/is-prop-valid").default)}catch{}function g1(t,e,r){const s={};for(const n in t)n==="values"&&typeof t.values=="object"||(ry(n)||r===!0&&Pi(n)||!e&&!Pi(n)||t.draggable&&n.startsWith("onDrag"))&&(s[n]=t[n]);return s}const no=y.createContext({});function ao(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function ma(t){return typeof t=="string"||Array.isArray(t)}const vd=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],wd=["initial",...vd];function io(t){return ao(t.animate)||wd.some(e=>ma(t[e]))}function sy(t){return!!(io(t)||t.variants)}function m1(t,e){if(io(t)){const{initial:r,animate:s}=t;return{initial:r===!1||ma(r)?r:void 0,animate:ma(s)?s:void 0}}return t.inherit!==!1?e:{}}function f1(t){const{initial:e,animate:r}=m1(t,y.useContext(no));return y.useMemo(()=>({initial:e,animate:r}),[Gh(e),Gh(r)])}function Gh(t){return Array.isArray(t)?t.join(" "):t}function zh(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Dn={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Ce.test(t))t=parseFloat(t);else return t;const r=zh(t,e.target.x),s=zh(t,e.target.y);return`${r}% ${s}%`}},p1={correct:(t,{treeScale:e,projectionDelta:r})=>{const s=t,n=Zr.parse(t);if(n.length>5)return s;const i=Zr.createTransformer(t),o=typeof n[0]!="number"?1:0,l=r.x.scale*e.x,c=r.y.scale*e.y;n[0+o]/=l,n[1+o]/=c;const d=tt(l,c,.5);return typeof n[2+o]=="number"&&(n[2+o]/=d),typeof n[3+o]=="number"&&(n[3+o]/=d),i(n)}},Wl={borderRadius:{...Dn,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Dn,borderTopRightRadius:Dn,borderBottomLeftRadius:Dn,borderBottomRightRadius:Dn,boxShadow:p1};function ny(t,{layout:e,layoutId:r}){return fn.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!Wl[t]||t==="opacity")}const y1={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},x1=mn.length;function b1(t,e,r){let s="",n=!0;for(let i=0;i<x1;i++){const o=mn[i],l=t[o];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(o.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||r){const d=q0(l,yd[o]);if(!c){n=!1;const u=y1[o]||o;s+=`${u}(${d}) `}r&&(e[o]=d)}}return s=s.trim(),r?s=r(e,n?"":s):n&&(s="none"),s}function kd(t,e,r){const{style:s,vars:n,transformOrigin:i}=t;let o=!1,l=!1;for(const c in e){const d=e[c];if(fn.has(c)){o=!0;continue}else if(j0(c)){n[c]=d;continue}else{const u=q0(d,yd[c]);c.startsWith("origin")?(l=!0,i[c]=u):s[c]=u}}if(e.transform||(o||r?s.transform=b1(e,t.transform,r):s.transform&&(s.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=i;s.transformOrigin=`${c} ${d} ${u}`}}const Td=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ay(t,e,r){for(const s in e)!Nt(e[s])&&!ny(s,r)&&(t[s]=e[s])}function v1({transformTemplate:t},e){return y.useMemo(()=>{const r=Td();return kd(r,e,t),Object.assign({},r.vars,r.style)},[e])}function w1(t,e){const r=t.style||{},s={};return ay(s,r,t),Object.assign(s,v1(t,e)),s}function k1(t,e){const r={},s=w1(t,e);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=s,r}const T1={offset:"stroke-dashoffset",array:"stroke-dasharray"},N1={offset:"strokeDashoffset",array:"strokeDasharray"};function S1(t,e,r=1,s=0,n=!0){t.pathLength=1;const i=n?T1:N1;t[i.offset]=Ce.transform(-s);const o=Ce.transform(e),l=Ce.transform(r);t[i.array]=`${o} ${l}`}function iy(t,{attrX:e,attrY:r,attrScale:s,pathLength:n,pathSpacing:i=1,pathOffset:o=0,...l},c,d,u){if(kd(t,l,d),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:g}=t;h.transform&&(g.transform=h.transform,delete h.transform),(g.transform||h.transformOrigin)&&(g.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),g.transform&&(g.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),r!==void 0&&(h.y=r),s!==void 0&&(h.scale=s),n!==void 0&&S1(h,n,i,o,!1)}const oy=()=>({...Td(),attrs:{}}),ly=t=>typeof t=="string"&&t.toLowerCase()==="svg";function j1(t,e,r,s){const n=y.useMemo(()=>{const i=oy();return iy(i,e,ly(s),t.transformTemplate,t.style),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};ay(i,t.style,t),n.style={...i,...n.style}}return n}const _1=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Nd(t){return typeof t!="string"||t.includes("-")?!1:!!(_1.indexOf(t)>-1||/[A-Z]/u.test(t))}function D1(t,e,r,{latestValues:s},n,i=!1){const l=(Nd(t)?j1:k1)(e,s,n,t),c=g1(e,typeof t=="string",i),d=t!==y.Fragment?{...c,...l,ref:r}:{},{children:u}=e,h=y.useMemo(()=>Nt(u)?u.get():u,[u]);return y.createElement(t,{...d,children:h})}function Kh(t){const e=[{},{}];return t?.values.forEach((r,s)=>{e[0][s]=r.get(),e[1][s]=r.getVelocity()}),e}function Sd(t,e,r,s){if(typeof e=="function"){const[n,i]=Kh(s);e=e(r!==void 0?r:t.custom,n,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[n,i]=Kh(s);e=e(r!==void 0?r:t.custom,n,i)}return e}function Qa(t){return Nt(t)?t.get():t}function C1({scrapeMotionValuesFromProps:t,createRenderState:e},r,s,n){return{latestValues:E1(r,s,n,t),renderState:e()}}function E1(t,e,r,s){const n={},i=s(t,{});for(const g in i)n[g]=Qa(i[g]);let{initial:o,animate:l}=t;const c=io(t),d=sy(t);e&&d&&!c&&t.inherit!==!1&&(o===void 0&&(o=e.initial),l===void 0&&(l=e.animate));let u=r?r.initial===!1:!1;u=u||o===!1;const h=u?l:o;if(h&&typeof h!="boolean"&&!ao(h)){const g=Array.isArray(h)?h:[h];for(let m=0;m<g.length;m++){const x=Sd(t,g[m]);if(x){const{transitionEnd:f,transition:p,...w}=x;for(const v in w){let k=w[v];if(Array.isArray(k)){const b=u?k.length-1:0;k=k[b]}k!==null&&(n[v]=k)}for(const v in f)n[v]=f[v]}}}return n}const cy=t=>(e,r)=>{const s=y.useContext(no),n=y.useContext(Zc),i=()=>C1(t,e,s,n);return r?i():dC(i)};function jd(t,e,r){const{style:s}=t,n={};for(const i in s)(Nt(s[i])||e.style&&Nt(e.style[i])||ny(i,t)||r?.getValue(i)?.liveStyle!==void 0)&&(n[i]=s[i]);return n}const I1=cy({scrapeMotionValuesFromProps:jd,createRenderState:Td});function dy(t,e,r){const s=jd(t,e,r);for(const n in t)if(Nt(t[n])||Nt(e[n])){const i=mn.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;s[i]=t[n]}return s}const A1=cy({scrapeMotionValuesFromProps:dy,createRenderState:oy}),R1=Symbol.for("motionComponentSymbol");function Fs(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function P1(t,e,r){return y.useCallback(s=>{s&&t.onMount&&t.onMount(s),e&&(s?e.mount(s):e.unmount()),r&&(typeof r=="function"?r(s):Fs(r)&&(r.current=s))},[e])}const _d=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),M1="framerAppearId",uy="data-"+_d(M1),hy=y.createContext({});function O1(t,e,r,s,n){const{visualElement:i}=y.useContext(no),o=y.useContext(ty),l=y.useContext(Zc),c=y.useContext(ey).reducedMotion,d=y.useRef(null);s=s||o.renderer,!d.current&&s&&(d.current=s(t,{visualState:e,parent:i,props:r,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const u=d.current,h=y.useContext(hy);u&&!u.projection&&n&&(u.type==="html"||u.type==="svg")&&L1(d.current,r,n,h);const g=y.useRef(!1);y.useInsertionEffect(()=>{u&&g.current&&u.update(r,l)});const m=r[uy],x=y.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return uC(()=>{u&&(g.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),x.current&&u.animationState&&u.animationState.animateChanges())}),y.useEffect(()=>{u&&(!x.current&&u.animationState&&u.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),x.current=!1),u.enteringChildren=void 0)}),u}function L1(t,e,r,s){const{layoutId:n,layout:i,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=e;t.projection=new r(t.latestValues,e["data-framer-portal-id"]?void 0:gy(t.parent)),t.projection.setOptions({layoutId:n,layout:i,alwaysMeasureLayout:!!o||l&&Fs(l),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:c,layoutRoot:d})}function gy(t){if(t)return t.options.allowProjection!==!1?t.projection:gy(t.parent)}function Uo(t,{forwardMotionProps:e=!1}={},r,s){r&&d1(r);const n=Nd(t)?A1:I1;function i(l,c){let d;const u={...y.useContext(ey),...l,layoutId:$1(l)},{isStatic:h}=u,g=f1(l),m=n(l,h);if(!h&&Jc){F1();const x=W1(u);d=x.MeasureLayout,g.visualElement=O1(t,m,u,s,x.ProjectionNode)}return a.jsxs(no.Provider,{value:g,children:[d&&g.visualElement?a.jsx(d,{visualElement:g.visualElement,...u}):null,D1(t,l,P1(m,g.visualElement,c),m,h,e)]})}i.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=y.forwardRef(i);return o[R1]=t,o}function $1({layoutId:t}){const e=y.useContext(c0).id;return e&&t!==void 0?e+"-"+t:t}function F1(t,e){y.useContext(ty).strict}function W1(t){const{drag:e,layout:r}=tn;if(!e&&!r)return{};const s={...e,...r};return{MeasureLayout:e?.isEnabled(t)||r?.isEnabled(t)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function V1(t,e){if(typeof Proxy>"u")return Uo;const r=new Map,s=(i,o)=>Uo(i,o,t,e),n=(i,o)=>s(i,o);return new Proxy(n,{get:(i,o)=>o==="create"?s:(r.has(o)||r.set(o,Uo(o,void 0,t,e)),r.get(o))})}function my({top:t,left:e,right:r,bottom:s}){return{x:{min:e,max:r},y:{min:t,max:s}}}function U1({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function B1(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:s.y,right:s.x}}function Bo(t){return t===void 0||t===1}function Vl({scale:t,scaleX:e,scaleY:r}){return!Bo(t)||!Bo(e)||!Bo(r)}function ns(t){return Vl(t)||fy(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function fy(t){return Yh(t.x)||Yh(t.y)}function Yh(t){return t&&t!=="0%"}function Mi(t,e,r){const s=t-r,n=e*s;return r+n}function qh(t,e,r,s,n){return n!==void 0&&(t=Mi(t,n,s)),Mi(t,r,s)+e}function Ul(t,e=0,r=1,s,n){t.min=qh(t.min,e,r,s,n),t.max=qh(t.max,e,r,s,n)}function py(t,{x:e,y:r}){Ul(t.x,e.translate,e.scale,e.originPoint),Ul(t.y,r.translate,r.scale,r.originPoint)}const Xh=.999999999999,Qh=1.0000000000001;function H1(t,e,r,s=!1){const n=r.length;if(!n)return;e.x=e.y=1;let i,o;for(let l=0;l<n;l++){i=r[l],o=i.projectionDelta;const{visualElement:c}=i.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Vs(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,py(t,o)),s&&ns(i.latestValues)&&Vs(t,i.latestValues))}e.x<Qh&&e.x>Xh&&(e.x=1),e.y<Qh&&e.y>Xh&&(e.y=1)}function Ws(t,e){t.min=t.min+e,t.max=t.max+e}function Jh(t,e,r,s,n=.5){const i=tt(t.min,t.max,n);Ul(t,e,r,i,s)}function Vs(t,e){Jh(t.x,e.x,e.scaleX,e.scale,e.originX),Jh(t.y,e.y,e.scaleY,e.scale,e.originY)}function yy(t,e){return my(B1(t.getBoundingClientRect(),e))}function G1(t,e,r){const s=yy(t,r),{scroll:n}=e;return n&&(Ws(s.x,n.offset.x),Ws(s.y,n.offset.y)),s}const Zh=()=>({translate:0,scale:1,origin:0,originPoint:0}),Us=()=>({x:Zh(),y:Zh()}),eg=()=>({min:0,max:0}),ct=()=>({x:eg(),y:eg()}),Bl={current:null},xy={current:!1};function z1(){if(xy.current=!0,!!Jc)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Bl.current=t.matches;t.addEventListener("change",e),e()}else Bl.current=!1}const K1=new WeakMap;function Y1(t,e,r){for(const s in e){const n=e[s],i=r[s];if(Nt(n))t.addValue(s,n);else if(Nt(i))t.addValue(s,en(n,{owner:t}));else if(i!==n)if(t.hasValue(s)){const o=t.getValue(s);o.liveStyle===!0?o.jump(n):o.hasAnimated||o.set(n)}else{const o=t.getStaticValue(s);t.addValue(s,en(o!==void 0?o:n,{owner:t}))}}for(const s in r)e[s]===void 0&&t.removeValue(s);return e}const tg=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class q1{scrapeMotionValuesFromProps(e,r,s){return{}}constructor({parent:e,props:r,presenceContext:s,reducedMotionConfig:n,blockInitialAnimation:i,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=fd,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=Rt.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,et.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=r.initial?{...c}:{},this.renderState=d,this.parent=e,this.props=r,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=n,this.options=l,this.blockInitialAnimation=!!i,this.isControllingVariants=io(r),this.isVariantNode=sy(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(r,{},this);for(const g in h){const m=h[g];c[g]!==void 0&&Nt(m)&&m.set(c[g])}}mount(e){this.current=e,K1.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),xy.current||z1(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Bl.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Jr(this.notifyUpdate),Jr(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const r=this.features[e];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,r){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=fn.has(e);s&&this.onBindTransform&&this.onBindTransform();const n=r.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&et.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,r)),this.valueSubscriptions.set(e,()=>{n(),i&&i(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in tn){const r=tn[e];if(!r)continue;const{isEnabled:s,Feature:n}=r;if(!this.features[e]&&n&&s(this.props)&&(this.features[e]=new n(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ct()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let s=0;s<tg.length;s++){const n=tg[s];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const i="on"+n,o=e[i];o&&(this.propEventSubscriptions[n]=this.on(n,o))}this.prevMotionValues=Y1(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const s=this.values.get(e);r!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&r!==void 0&&(s=en(r===null?void 0:r,{owner:this}),this.addValue(e,s)),s}readValue(e,r){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(d0(s)||h0(s))?s=parseFloat(s):!l1(s)&&Zr.test(r)&&(s=Y0(e,r)),this.setBaseTarget(e,Nt(s)?s.get():s)),Nt(s)?s.get():s}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){const{initial:r}=this.props;let s;if(typeof r=="string"||typeof r=="object"){const i=Sd(this.props,r,this.presenceContext?.custom);i&&(s=i[e])}if(r&&s!==void 0)return s;const n=this.getBaseTargetFromProps(this.props,e);return n!==void 0&&!Nt(n)?n:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new nd),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}scheduleRenderMicrotask(){xd.render(this.render)}}class by extends q1{constructor(){super(...arguments),this.KeyframeResolver=qE}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){return e.style?e.style[r]:void 0}removeValueFromRenderState(e,{vars:r,style:s}){delete r[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Nt(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function vy(t,{style:e,vars:r},s,n){const i=t.style;let o;for(o in e)i[o]=e[o];n?.applyProjectionStyles(i,s);for(o in r)i.setProperty(o,r[o])}function X1(t){return window.getComputedStyle(t)}class Q1 extends by{constructor(){super(...arguments),this.type="html",this.renderInstance=vy}readValueFromInstance(e,r){if(fn.has(r))return this.projection?.isProjecting?Rl(r):mE(e,r);{const s=X1(e),n=(j0(r)?s.getPropertyValue(r):s[r])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(e,{transformPagePoint:r}){return yy(e,r)}build(e,r,s){kd(e,r,s.transformTemplate)}scrapeMotionValuesFromProps(e,r,s){return jd(e,r,s)}}const wy=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function J1(t,e,r,s){vy(t,e,void 0,s);for(const n in e.attrs)t.setAttribute(wy.has(n)?n:_d(n),e.attrs[n])}class Z1 extends by{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ct}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(fn.has(r)){const s=K0(r);return s&&s.default||0}return r=wy.has(r)?r:_d(r),e.getAttribute(r)}scrapeMotionValuesFromProps(e,r,s){return dy(e,r,s)}build(e,r,s){iy(e,r,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,r,s,n){J1(e,r,s,n)}mount(e){this.isSVGTag=ly(e.tagName),super.mount(e)}}const eI=(t,e)=>Nd(t)?new Z1(e):new Q1(e,{allowProjection:t!==y.Fragment});function Ks(t,e,r){const s=t.getProps();return Sd(s,e,r!==void 0?r:s.custom,t)}const Hl=t=>Array.isArray(t);function tI(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,en(r))}function rI(t){return Hl(t)?t[t.length-1]||0:t}function sI(t,e){const r=Ks(t,e);let{transitionEnd:s={},transition:n={},...i}=r||{};i={...i,...s};for(const o in i){const l=rI(i[o]);tI(t,o,l)}}function nI(t){return!!(Nt(t)&&t.add)}function Gl(t,e){const r=t.getValue("willChange");if(nI(r))return r.add(e);if(!r&&Er.WillChange){const s=new Er.WillChange("auto");t.addValue("willChange",s),s.add(e)}}function ky(t){return t.props[uy]}const aI=t=>t!==null;function iI(t,{repeat:e,repeatType:r="loop"},s){const n=t.filter(aI),i=e&&r!=="loop"&&e%2===1?0:n.length-1;return n[i]}const oI={type:"spring",stiffness:500,damping:25,restSpeed:10},lI=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),cI={type:"keyframes",duration:.8},dI={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},uI=(t,{keyframes:e})=>e.length>2?cI:fn.has(t)?t.startsWith("scale")?lI(e[1]):oI:dI;function hI({when:t,delay:e,delayChildren:r,staggerChildren:s,staggerDirection:n,repeat:i,repeatType:o,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Dd=(t,e,r,s={},n,i)=>o=>{const l=pd(s,t)||{},c=l.delay||s.delay||0;let{elapsed:d=0}=s;d=d-fr(c);const u={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-d,onUpdate:g=>{e.set(g),l.onUpdate&&l.onUpdate(g)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:i?void 0:n};hI(l)||Object.assign(u,uI(t,u)),u.duration&&(u.duration=fr(u.duration)),u.repeatDelay&&(u.repeatDelay=fr(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&($l(u),u.delay===0&&(h=!0)),(Er.instantAnimations||Er.skipAnimations)&&(h=!0,$l(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,h&&!i&&e.get()!==void 0){const g=iI(u.keyframes,l);if(g!==void 0){et.update(()=>{u.onUpdate(g),u.onComplete()});return}}return l.isSync?new md(u):new LE(u)};function gI({protectedKeys:t,needsAnimating:e},r){const s=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,s}function Ty(t,e,{delay:r=0,transitionOverride:s,type:n}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...l}=e;s&&(i=s);const c=[],d=n&&t.animationState&&t.animationState.getState()[n];for(const u in l){const h=t.getValue(u,t.latestValues[u]??null),g=l[u];if(g===void 0||d&&gI(d,u))continue;const m={delay:r,...pd(i||{},u)},x=h.get();if(x!==void 0&&!h.isAnimating&&!Array.isArray(g)&&g===x&&!m.velocity)continue;let f=!1;if(window.MotionHandoffAnimation){const w=ky(t);if(w){const v=window.MotionHandoffAnimation(w,u,et);v!==null&&(m.startTime=v,f=!0)}}Gl(t,u),h.start(Dd(u,h,g,t.shouldReduceMotion&&H0.has(u)?{type:!1}:m,t,f));const p=h.animation;p&&c.push(p)}return o&&Promise.all(c).then(()=>{et.update(()=>{o&&sI(t,o)})}),c}function Ny(t,e,r,s=0,n=1){const i=Array.from(t).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),o=t.size,l=(o-1)*s;return typeof r=="function"?r(i,o):n===1?i*s:l-i*s}function zl(t,e,r={}){const s=Ks(t,e,r.type==="exit"?t.presenceContext?.custom:void 0);let{transition:n=t.getDefaultTransition()||{}}=s||{};r.transitionOverride&&(n=r.transitionOverride);const i=s?()=>Promise.all(Ty(t,s,r)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=n;return mI(t,e,c,d,u,h,r)}:()=>Promise.resolve(),{when:l}=n;if(l){const[c,d]=l==="beforeChildren"?[i,o]:[o,i];return c().then(()=>d())}else return Promise.all([i(),o(r.delay)])}function mI(t,e,r=0,s=0,n=0,i=1,o){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(zl(c,e,{...o,delay:r+(typeof s=="function"?0:s)+Ny(t.variantChildren,c,s,n,i)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function fI(t,e,r={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const n=e.map(i=>zl(t,i,r));s=Promise.all(n)}else if(typeof e=="string")s=zl(t,e,r);else{const n=typeof e=="function"?Ks(t,e,r.custom):e;s=Promise.all(Ty(t,n,r))}return s.then(()=>{t.notify("AnimationComplete",e)})}function Sy(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let s=0;s<r;s++)if(e[s]!==t[s])return!1;return!0}const pI=wd.length;function jy(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?jy(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const e={};for(let r=0;r<pI;r++){const s=wd[r],n=t.props[s];(ma(n)||n===!1)&&(e[s]=n)}return e}const yI=[...vd].reverse(),xI=vd.length;function bI(t){return e=>Promise.all(e.map(({animation:r,options:s})=>fI(t,r,s)))}function vI(t){let e=bI(t),r=rg(),s=!0;const n=c=>(d,u)=>{const h=Ks(t,u,c==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:g,transitionEnd:m,...x}=h;d={...d,...x,...m}}return d};function i(c){e=c(t)}function o(c){const{props:d}=t,u=jy(t.parent)||{},h=[],g=new Set;let m={},x=1/0;for(let p=0;p<xI;p++){const w=yI[p],v=r[w],k=d[w]!==void 0?d[w]:u[w],b=ma(k),T=w===c?v.isActive:null;T===!1&&(x=p);let _=k===u[w]&&k!==d[w]&&b;if(_&&s&&t.manuallyAnimateOnMount&&(_=!1),v.protectedKeys={...m},!v.isActive&&T===null||!k&&!v.prevProp||ao(k)||typeof k=="boolean")continue;const j=wI(v.prevProp,k);let N=j||w===c&&v.isActive&&!_&&b||p>x&&b,D=!1;const $=Array.isArray(k)?k:[k];let C=$.reduce(n(w),{});T===!1&&(C={});const{prevResolvedValues:R={}}=v,B={...R,...C},Y=z=>{N=!0,g.has(z)&&(D=!0,g.delete(z)),v.needsAnimating[z]=!0;const de=t.getValue(z);de&&(de.liveStyle=!1)};for(const z in B){const de=C[z],Te=R[z];if(m.hasOwnProperty(z))continue;let we=!1;Hl(de)&&Hl(Te)?we=!Sy(de,Te):we=de!==Te,we?de!=null?Y(z):g.add(z):de!==void 0&&g.has(z)?Y(z):v.protectedKeys[z]=!0}v.prevProp=k,v.prevResolvedValues=C,v.isActive&&(m={...m,...C}),s&&t.blockInitialAnimation&&(N=!1);const V=_&&j;N&&(!V||D)&&h.push(...$.map(z=>{const de={type:w};if(typeof z=="string"&&s&&!V&&t.manuallyAnimateOnMount&&t.parent){const{parent:Te}=t,we=Ks(Te,z);if(Te.enteringChildren&&we){const{delayChildren:fe}=we.transition||{};de.delay=Ny(Te.enteringChildren,t,fe)}}return{animation:z,options:de}}))}if(g.size){const p={};if(typeof d.initial!="boolean"){const w=Ks(t,Array.isArray(d.initial)?d.initial[0]:d.initial);w&&w.transition&&(p.transition=w.transition)}g.forEach(w=>{const v=t.getBaseTarget(w),k=t.getValue(w);k&&(k.liveStyle=!0),p[w]=v??null}),h.push({animation:p})}let f=!!h.length;return s&&(d.initial===!1||d.initial===d.animate)&&!t.manuallyAnimateOnMount&&(f=!1),s=!1,f?e(h):Promise.resolve()}function l(c,d){if(r[c].isActive===d)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(c,d)),r[c].isActive=d;const u=o(c);for(const h in r)r[h].protectedKeys={};return u}return{animateChanges:o,setActive:l,setAnimateFunction:i,getState:()=>r,reset:()=>{r=rg()}}}function wI(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!Sy(e,t):!1}function rs(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function rg(){return{animate:rs(!0),whileInView:rs(),whileHover:rs(),whileTap:rs(),whileDrag:rs(),whileFocus:rs(),exit:rs()}}class es{constructor(e){this.isMounted=!1,this.node=e}update(){}}class kI extends es{constructor(e){super(e),e.animationState||(e.animationState=vI(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();ao(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let TI=0;class NI extends es{constructor(){super(...arguments),this.id=TI++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const n=this.node.animationState.setActive("exit",!e);r&&!e&&n.then(()=>{r(this.id)})}mount(){const{register:e,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const SI={animation:{Feature:kI},exit:{Feature:NI}};function fa(t,e,r,s={passive:!0}){return t.addEventListener(e,r,s),()=>t.removeEventListener(e,r)}function Ra(t){return{point:{x:t.pageX,y:t.pageY}}}const jI=t=>e=>bd(e)&&t(e,Ra(e));function Kn(t,e,r,s){return fa(t,e,jI(r),s)}const _y=1e-4,_I=1-_y,DI=1+_y,Dy=.01,CI=0-Dy,EI=0+Dy;function Ct(t){return t.max-t.min}function II(t,e,r){return Math.abs(t-e)<=r}function sg(t,e,r,s=.5){t.origin=s,t.originPoint=tt(e.min,e.max,t.origin),t.scale=Ct(r)/Ct(e),t.translate=tt(r.min,r.max,t.origin)-t.originPoint,(t.scale>=_I&&t.scale<=DI||isNaN(t.scale))&&(t.scale=1),(t.translate>=CI&&t.translate<=EI||isNaN(t.translate))&&(t.translate=0)}function Yn(t,e,r,s){sg(t.x,e.x,r.x,s?s.originX:void 0),sg(t.y,e.y,r.y,s?s.originY:void 0)}function ng(t,e,r){t.min=r.min+e.min,t.max=t.min+Ct(e)}function AI(t,e,r){ng(t.x,e.x,r.x),ng(t.y,e.y,r.y)}function ag(t,e,r){t.min=e.min-r.min,t.max=t.min+Ct(e)}function Oi(t,e,r){ag(t.x,e.x,r.x),ag(t.y,e.y,r.y)}function zt(t){return[t("x"),t("y")]}const Cy=({current:t})=>t?t.ownerDocument.defaultView:null,ig=(t,e)=>Math.abs(t-e);function RI(t,e){const r=ig(t.x,e.x),s=ig(t.y,e.y);return Math.sqrt(r**2+s**2)}class Ey{constructor(e,r,{transformPagePoint:s,contextWindow:n=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=Go(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,x=RI(g.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!x)return;const{point:f}=g,{timestamp:p}=vt;this.history.push({...f,timestamp:p});const{onStart:w,onMove:v}=this.handlers;m||(w&&w(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,g)},this.handlePointerMove=(g,m)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=Ho(m,this.transformPagePoint),et.update(this.updatePoint,!0)},this.handlePointerUp=(g,m)=>{this.end();const{onEnd:x,onSessionEnd:f,resumeAnimation:p}=this.handlers;if(this.dragSnapToOrigin&&p&&p(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const w=Go(g.type==="pointercancel"?this.lastMoveEventInfo:Ho(m,this.transformPagePoint),this.history);this.startEvent&&x&&x(g,w),f&&f(g,w)},!bd(e))return;this.dragSnapToOrigin=i,this.handlers=r,this.transformPagePoint=s,this.distanceThreshold=o,this.contextWindow=n||window;const l=Ra(e),c=Ho(l,this.transformPagePoint),{point:d}=c,{timestamp:u}=vt;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=r;h&&h(e,Go(c,this.history)),this.removeListeners=Ea(Kn(this.contextWindow,"pointermove",this.handlePointerMove),Kn(this.contextWindow,"pointerup",this.handlePointerUp),Kn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Jr(this.updatePoint)}}function Ho(t,e){return e?{point:e(t.point)}:t}function og(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Go({point:t},e){return{point:t,delta:og(t,Iy(e)),offset:og(t,PI(e)),velocity:MI(e,.1)}}function PI(t){return t[0]}function Iy(t){return t[t.length-1]}function MI(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,s=null;const n=Iy(t);for(;r>=0&&(s=t[r],!(n.timestamp-s.timestamp>fr(e)));)r--;if(!s)return{x:0,y:0};const i=qt(n.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const o={x:(n.x-s.x)/i,y:(n.y-s.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function OI(t,{min:e,max:r},s){return e!==void 0&&t<e?t=s?tt(e,t,s.min):Math.max(t,e):r!==void 0&&t>r&&(t=s?tt(r,t,s.max):Math.min(t,r)),t}function lg(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function LI(t,{top:e,left:r,bottom:s,right:n}){return{x:lg(t.x,r,n),y:lg(t.y,e,s)}}function cg(t,e){let r=e.min-t.min,s=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,s]=[s,r]),{min:r,max:s}}function $I(t,e){return{x:cg(t.x,e.x),y:cg(t.y,e.y)}}function FI(t,e){let r=.5;const s=Ct(t),n=Ct(e);return n>s?r=ua(e.min,e.max-s,t.min):s>n&&(r=ua(t.min,t.max-n,e.min)),Cr(0,1,r)}function WI(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const Kl=.35;function VI(t=Kl){return t===!1?t=0:t===!0&&(t=Kl),{x:dg(t,"left","right"),y:dg(t,"top","bottom")}}function dg(t,e,r){return{min:ug(t,e),max:ug(t,r)}}function ug(t,e){return typeof t=="number"?t:t[e]||0}const UI=new WeakMap;class BI{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ct(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:r=!1,distanceThreshold:s}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const i=h=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Ra(h).point)},o=(h,g)=>{const{drag:m,dragPropagation:x,onDragStart:f}=this.getProps();if(m&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=e1(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),zt(w=>{let v=this.getAxisMotionValue(w).get()||0;if(pr.test(v)){const{projection:k}=this.visualElement;if(k&&k.layout){const b=k.layout.layoutBox[w];b&&(v=Ct(b)*(parseFloat(v)/100))}}this.originPoint[w]=v}),f&&et.postRender(()=>f(h,g)),Gl(this.visualElement,"transform");const{animationState:p}=this.visualElement;p&&p.setActive("whileDrag",!0)},l=(h,g)=>{this.latestPointerEvent=h,this.latestPanInfo=g;const{dragPropagation:m,dragDirectionLock:x,onDirectionLock:f,onDrag:p}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:w}=g;if(x&&this.currentDirection===null){this.currentDirection=HI(w),this.currentDirection!==null&&f&&f(this.currentDirection);return}this.updateAxis("x",g.point,w),this.updateAxis("y",g.point,w),this.visualElement.render(),p&&p(h,g)},c=(h,g)=>{this.latestPointerEvent=h,this.latestPanInfo=g,this.stop(h,g),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>zt(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Ey(e,{onSessionStart:i,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:Cy(this.visualElement)})}stop(e,r){const s=e||this.latestPointerEvent,n=r||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!n||!s)return;const{velocity:o}=n;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&et.postRender(()=>l(s,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(e,r,s){const{drag:n}=this.getProps();if(!s||!Ba(e,n,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(o=OI(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){const{dragConstraints:e,dragElastic:r}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,n=this.constraints;e&&Fs(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=LI(s.layoutBox,e):this.constraints=!1,this.elastic=VI(r),n!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&zt(i=>{this.constraints!==!1&&this.getAxisMotionValue(i)&&(this.constraints[i]=WI(s.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!Fs(e))return!1;const s=e.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const i=G1(s,n.root,this.visualElement.getTransformPagePoint());let o=$I(n.layout.layoutBox,i);if(r){const l=r(U1(o));this.hasMutatedConstraints=!!l,l&&(o=my(l))}return o}startAnimation(e){const{drag:r,dragMomentum:s,dragElastic:n,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=zt(u=>{if(!Ba(u,r,this.currentDirection))return;let h=c&&c[u]||{};o&&(h={min:0,max:0});const g=n?200:1e6,m=n?40:1e7,x={type:"inertia",velocity:s?e[u]:0,bounceStiffness:g,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(u,x)});return Promise.all(d).then(l)}startAxisValueAnimation(e,r){const s=this.getAxisMotionValue(e);return Gl(this.visualElement,e),s.start(Dd(e,s,0,r,this.visualElement,!1))}stopAnimation(){zt(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){zt(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),n=s[r];return n||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){zt(r=>{const{drag:s}=this.getProps();if(!Ba(r,s,this.currentDirection))return;const{projection:n}=this.visualElement,i=this.getAxisMotionValue(r);if(n&&n.layout){const{min:o,max:l}=n.layout.layoutBox[r];i.set(e[r]-tt(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:s}=this.visualElement;if(!Fs(r)||!s||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};zt(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();n[o]=FI({min:c,max:c},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),zt(o=>{if(!Ba(o,e,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(tt(c,d,n[o]))})}addListeners(){if(!this.visualElement.current)return;UI.set(this.visualElement,this);const e=this.visualElement.current,r=Kn(e,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();Fs(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",s);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),et.read(s);const o=fa(window,"resize",()=>this.scalePositionWithinConstraints()),l=n.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(zt(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())});return()=>{o(),r(),i(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:s=!1,dragPropagation:n=!1,dragConstraints:i=!1,dragElastic:o=Kl,dragMomentum:l=!0}=e;return{...e,drag:r,dragDirectionLock:s,dragPropagation:n,dragConstraints:i,dragElastic:o,dragMomentum:l}}}function Ba(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function HI(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class GI extends es{constructor(e){super(e),this.removeGroupControls=Xt,this.removeListeners=Xt,this.controls=new BI(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Xt}unmount(){this.removeGroupControls(),this.removeListeners()}}const hg=t=>(e,r)=>{t&&et.postRender(()=>t(e,r))};class zI extends es{constructor(){super(...arguments),this.removePointerDownListener=Xt}onPointerDown(e){this.session=new Ey(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Cy(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:s,onPanEnd:n}=this.node.getProps();return{onSessionStart:hg(e),onStart:hg(r),onMove:s,onEnd:(i,o)=>{delete this.session,n&&et.postRender(()=>n(i,o))}}}mount(){this.removePointerDownListener=Kn(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Ja={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let zo=!1;class KI extends y.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:s,layoutId:n}=this.props,{projection:i}=e;i&&(r.group&&r.group.add(i),s&&s.register&&n&&s.register(i),zo&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Ja.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:s,drag:n,isPresent:i}=this.props,{projection:o}=s;return o&&(o.isPresent=i,zo=!0,n||e.layoutDependency!==r||r===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||et.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),xd.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:s}=this.props,{projection:n}=e;zo=!0,n&&(n.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(n),s&&s.deregister&&s.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Ay(t){const[e,r]=c1(),s=y.useContext(c0);return a.jsx(KI,{...t,layoutGroup:s,switchLayoutGroup:y.useContext(hy),isPresent:e,safeToRemove:r})}function YI(t,e,r){const s=Nt(t)?t:en(t);return s.start(Dd("",s,e,r)),s.animation}const qI=(t,e)=>t.depth-e.depth;class XI{constructor(){this.children=[],this.isDirty=!1}add(e){ed(this.children,e),this.isDirty=!0}remove(e){td(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(qI),this.isDirty=!1,this.children.forEach(e)}}function QI(t,e){const r=Rt.now(),s=({timestamp:n})=>{const i=n-r;i>=e&&(Jr(s),t(i-e))};return et.setup(s,!0),()=>Jr(s)}const Ry=["TopLeft","TopRight","BottomLeft","BottomRight"],JI=Ry.length,gg=t=>typeof t=="string"?parseFloat(t):t,mg=t=>typeof t=="number"||Ce.test(t);function ZI(t,e,r,s,n,i){n?(t.opacity=tt(0,r.opacity??1,eA(s)),t.opacityExit=tt(e.opacity??1,0,tA(s))):i&&(t.opacity=tt(e.opacity??1,r.opacity??1,s));for(let o=0;o<JI;o++){const l=`border${Ry[o]}Radius`;let c=fg(e,l),d=fg(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||mg(c)===mg(d)?(t[l]=Math.max(tt(gg(c),gg(d),s),0),(pr.test(d)||pr.test(c))&&(t[l]+="%")):t[l]=d}(e.rotate||r.rotate)&&(t.rotate=tt(e.rotate||0,r.rotate||0,s))}function fg(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const eA=Py(0,.5,v0),tA=Py(.5,.95,Xt);function Py(t,e,r){return s=>s<t?0:s>e?1:r(ua(t,e,s))}function pg(t,e){t.min=e.min,t.max=e.max}function Qt(t,e){pg(t.x,e.x),pg(t.y,e.y)}function yg(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function xg(t,e,r,s,n){return t-=e,t=Mi(t,1/r,s),n!==void 0&&(t=Mi(t,1/n,s)),t}function rA(t,e=0,r=1,s=.5,n,i=t,o=t){if(pr.test(e)&&(e=parseFloat(e),e=tt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let l=tt(i.min,i.max,s);t===i&&(l-=e),t.min=xg(t.min,e,r,l,n),t.max=xg(t.max,e,r,l,n)}function bg(t,e,[r,s,n],i,o){rA(t,e[r],e[s],e[n],e.scale,i,o)}const sA=["x","scaleX","originX"],nA=["y","scaleY","originY"];function vg(t,e,r,s){bg(t.x,e,sA,r?r.x:void 0,s?s.x:void 0),bg(t.y,e,nA,r?r.y:void 0,s?s.y:void 0)}function wg(t){return t.translate===0&&t.scale===1}function My(t){return wg(t.x)&&wg(t.y)}function kg(t,e){return t.min===e.min&&t.max===e.max}function aA(t,e){return kg(t.x,e.x)&&kg(t.y,e.y)}function Tg(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function Oy(t,e){return Tg(t.x,e.x)&&Tg(t.y,e.y)}function Ng(t){return Ct(t.x)/Ct(t.y)}function Sg(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class iA{constructor(){this.members=[]}add(e){ed(this.members,e),e.scheduleRender()}remove(e){if(td(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(n=>e===n);if(r===0)return!1;let s;for(let n=r;n>=0;n--){const i=this.members[n];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(e,r){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,r&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;n===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:s}=e;r.onExitComplete&&r.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function oA(t,e,r){let s="";const n=t.x.translate/e.x,i=t.y.translate/e.y,o=r?.z||0;if((n||i||o)&&(s=`translate3d(${n}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:g,skewX:m,skewY:x}=r;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),g&&(s+=`rotateY(${g}deg) `),m&&(s+=`skewX(${m}deg) `),x&&(s+=`skewY(${x}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(s+=`scale(${l}, ${c})`),s||"none"}const Ko=["","X","Y","Z"],lA=1e3;let cA=0;function Yo(t,e,r,s){const{latestValues:n}=e;n[t]&&(r[t]=n[t],e.setStaticValue(t,0),s&&(s[t]=0))}function Ly(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const r=ky(e);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:n,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",et,!(n||i))}const{parent:s}=t;s&&!s.hasCheckedOptimisedAppear&&Ly(s)}function $y({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:s,resetTransform:n}){return class{constructor(o={},l=e?.()){this.id=cA++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(hA),this.nodes.forEach(pA),this.nodes.forEach(yA),this.nodes.forEach(gA)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new XI)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new nd),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=Z0(o)&&!i1(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let u,h=0;const g=()=>this.root.updateBlockedByResize=!1;et.read(()=>{h=window.innerWidth}),t(o,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=QI(g,250),Ja.hasAnimatedSinceResize&&(Ja.hasAnimatedSinceResize=!1,this.nodes.forEach(Dg)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:g,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||d.getDefaultTransition()||kA,{onLayoutAnimationStart:f,onLayoutAnimationComplete:p}=d.getProps(),w=!this.targetLayout||!Oy(this.targetLayout,m),v=!h&&g;if(this.options.layoutRoot||this.resumeFrom||v||h&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...pd(x,"layout"),onPlay:f,onComplete:p};(d.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(u,v)}else h||Dg(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Jr(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(xA),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Ly(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(jg);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(_g);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(fA),this.nodes.forEach(dA),this.nodes.forEach(uA)):this.nodes.forEach(_g),this.clearAllSnapshots();const l=Rt.now();vt.delta=Cr(0,1e3/60,l-vt.timestamp),vt.timestamp=l,vt.isProcessing=!0,Oo.update.process(vt),Oo.preRender.process(vt),Oo.render.process(vt),vt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,xd.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(mA),this.sharedNodes.forEach(bA)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,et.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){et.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ct(this.snapshot.measuredBox.x)&&!Ct(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ct(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!n)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!My(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;o&&this.instance&&(l||ns(this.latestValues)||u)&&(n(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),TA(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return ct();const l=o.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(NA))){const{scroll:d}=this.root;d&&(Ws(l.x,d.offset.x),Ws(l.y,d.offset.y))}return l}removeElementScroll(o){const l=ct();if(Qt(l,o),this.scroll?.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&Qt(l,o),Ws(l.x,u.offset.x),Ws(l.y,u.offset.y))}return l}applyTransform(o,l=!1){const c=ct();Qt(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Vs(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),ns(u.latestValues)&&Vs(c,u.latestValues)}return ns(this.latestValues)&&Vs(c,this.latestValues),c}removeTransform(o){const l=ct();Qt(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!ns(d.latestValues))continue;Vl(d.latestValues)&&d.updateSnapshot();const u=ct(),h=d.measurePageBox();Qt(u,h),vg(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return ns(this.latestValues)&&vg(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==vt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=vt.timestamp;const g=this.getClosestProjectingParent();g&&this.linkedParentVersion!==g.layoutVersion&&!g.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(g&&g.layout?this.createRelativeTarget(g,this.layout.layoutBox,g.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ct(),this.targetWithTransforms=ct()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),AI(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Qt(this.target,this.layout.layoutBox),py(this.target,this.targetDelta)):Qt(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?this.createRelativeTarget(g,this.target,g.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Vl(this.parent.latestValues)||fy(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,l,c){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ct(),this.relativeTargetOrigin=ct(),Oi(this.relativeTargetOrigin,l,c),Qt(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===vt.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Qt(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,g=this.treeScale.y;H1(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=ct());const{target:m}=o;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(yg(this.prevProjectionDelta.x,this.projectionDelta.x),yg(this.prevProjectionDelta.y,this.projectionDelta.y)),Yn(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==g||!Sg(this.projectionDelta.x,this.prevProjectionDelta.x)||!Sg(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.visualElement?.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Us(),this.projectionDelta=Us(),this.projectionDeltaWithTransform=Us()}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},h=Us();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const g=ct(),m=c?c.source:void 0,x=this.layout?this.layout.source:void 0,f=m!==x,p=this.getStack(),w=!p||p.members.length<=1,v=!!(f&&!w&&this.options.crossfade===!0&&!this.path.some(wA));this.animationProgress=0;let k;this.mixTargetDelta=b=>{const T=b/1e3;Cg(h.x,o.x,T),Cg(h.y,o.y,T),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Oi(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),vA(this.relativeTarget,this.relativeTargetOrigin,g,T),k&&aA(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=ct()),Qt(k,this.relativeTarget)),f&&(this.animationValues=u,ZI(u,d,this.latestValues,T,v,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Jr(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=et.update(()=>{Ja.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=en(0)),this.currentAnimation=YI(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:l=>{this.mixTargetDelta(l),o.onUpdate&&o.onUpdate(l)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(lA),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&Fy(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||ct();const h=Ct(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+h;const g=Ct(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+g}Qt(l,c),Vs(l,u),Yn(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new iA),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){const{layoutId:o}=this.options;return o?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:o}=this.options;return o?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Yo("z",o,d,this.animationValues);for(let u=0;u<Ko.length;u++)Yo(`rotate${Ko[u]}`,o,d,this.animationValues),Yo(`skew${Ko[u]}`,o,d,this.animationValues);o.render();for(const u in d)o.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Qa(l?.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Qa(l?.pointerEvents)||""),this.hasProjected&&!ns(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=oA(this.projectionDeltaWithTransform,this.treeScale,u);c&&(h=c(u,h)),o.transform=h;const{x:g,y:m}=this.projectionDelta;o.transformOrigin=`${g.origin*100}% ${m.origin*100}% 0`,d.animationValues?o.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const x in Wl){if(u[x]===void 0)continue;const{correct:f,applyTo:p,isCSSVariable:w}=Wl[x],v=h==="none"?u[x]:f(u[x],d);if(p){const k=p.length;for(let b=0;b<k;b++)o[p[b]]=v}else w?this.options.visualElement.renderState.vars[x]=v:o[x]=v}this.options.layoutId&&(o.pointerEvents=d===this?Qa(l?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>o.currentAnimation?.stop()),this.root.nodes.forEach(jg),this.root.sharedNodes.clear()}}}function dA(t){t.updateLayout()}function uA(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:n}=t.options,i=e.source!==t.layout.source;n==="size"?zt(u=>{const h=i?e.measuredBox[u]:e.layoutBox[u],g=Ct(h);h.min=r[u].min,h.max=h.min+g}):Fy(n,e.layoutBox,r)&&zt(u=>{const h=i?e.measuredBox[u]:e.layoutBox[u],g=Ct(r[u]);h.max=h.min+g,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+g)});const o=Us();Yn(o,r,e.layoutBox);const l=Us();i?Yn(l,t.applyTransform(s,!0),e.measuredBox):Yn(l,r,e.layoutBox);const c=!My(o);let d=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:g}=u;if(h&&g){const m=ct();Oi(m,e.layoutBox,h.layoutBox);const x=ct();Oi(x,r,g.layoutBox),Oy(m,x)||(d=!0),u.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=m,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function hA(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function gA(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function mA(t){t.clearSnapshot()}function jg(t){t.clearMeasurements()}function _g(t){t.isLayoutDirty=!1}function fA(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Dg(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function pA(t){t.resolveTargetDelta()}function yA(t){t.calcProjection()}function xA(t){t.resetSkewAndRotation()}function bA(t){t.removeLeadSnapshot()}function Cg(t,e,r){t.translate=tt(e.translate,0,r),t.scale=tt(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function Eg(t,e,r,s){t.min=tt(e.min,r.min,s),t.max=tt(e.max,r.max,s)}function vA(t,e,r,s){Eg(t.x,e.x,r.x,s),Eg(t.y,e.y,r.y,s)}function wA(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const kA={duration:.45,ease:[.4,0,.1,1]},Ig=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Ag=Ig("applewebkit/")&&!Ig("chrome/")?Math.round:Xt;function Rg(t){t.min=Ag(t.min),t.max=Ag(t.max)}function TA(t){Rg(t.x),Rg(t.y)}function Fy(t,e,r){return t==="position"||t==="preserve-aspect"&&!II(Ng(e),Ng(r),.2)}function NA(t){return t!==t.root&&t.scroll?.wasRoot}const SA=$y({attachResizeListener:(t,e)=>fa(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),qo={current:void 0},Wy=$y({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!qo.current){const t=new SA({});t.mount(window),t.setOptions({layoutScroll:!0}),qo.current=t}return qo.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),jA={pan:{Feature:zI},drag:{Feature:GI,ProjectionNode:Wy,MeasureLayout:Ay}};function Pg(t,e,r){const{props:s}=t;t.animationState&&s.whileHover&&t.animationState.setActive("whileHover",r==="Start");const n="onHover"+r,i=s[n];i&&et.postRender(()=>i(e,Ra(e)))}class _A extends es{mount(){const{current:e}=this.node;e&&(this.unmount=t1(e,(r,s)=>(Pg(this.node,s,"Start"),n=>Pg(this.node,n,"End"))))}unmount(){}}class DA extends es{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ea(fa(this.node.current,"focus",()=>this.onFocus()),fa(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Mg(t,e,r){const{props:s}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&s.whileTap&&t.animationState.setActive("whileTap",r==="Start");const n="onTap"+(r==="End"?"":r),i=s[n];i&&et.postRender(()=>i(e,Ra(e)))}class CA extends es{mount(){const{current:e}=this.node;e&&(this.unmount=a1(e,(r,s)=>(Mg(this.node,s,"Start"),(n,{success:i})=>Mg(this.node,n,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Yl=new WeakMap,Xo=new WeakMap,EA=t=>{const e=Yl.get(t.target);e&&e(t)},IA=t=>{t.forEach(EA)};function AA({root:t,...e}){const r=t||document;Xo.has(r)||Xo.set(r,{});const s=Xo.get(r),n=JSON.stringify(e);return s[n]||(s[n]=new IntersectionObserver(IA,{root:t,...e})),s[n]}function RA(t,e,r){const s=AA(e);return Yl.set(t,r),s.observe(t),()=>{Yl.delete(t),s.unobserve(t)}}const PA={some:0,all:1};class MA extends es{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:s,amount:n="some",once:i}=e,o={root:r?r.current:void 0,rootMargin:s,threshold:typeof n=="number"?n:PA[n]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),g=d?u:h;g&&g(c)};return RA(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(OA(e,r))&&this.startObserver()}unmount(){}}function OA({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const LA={inView:{Feature:MA},tap:{Feature:CA},focus:{Feature:DA},hover:{Feature:_A}},$A={layout:{ProjectionNode:Wy,MeasureLayout:Ay}},FA={...SI,...LA,...jA,...$A},WA=V1(FA,eI),VA=()=>{const{t}=Xe(),{currentTheme:e,isDark:r}=Lt(),s=!!e.bg,n=[{id:"basics",title:t("guide.basics.title"),icon:Yg,items:[{title:t("guide.basics.add"),desc:t("guide.basics.addDesc")},{title:t("guide.basics.complete"),desc:t("guide.basics.completeDesc")},{title:t("guide.basics.edit"),desc:t("guide.basics.editDesc")}]},{id:"calendar",title:t("guide.calendar.title"),icon:at,items:[{title:t("guide.calendar.views"),desc:t("guide.calendar.viewsDesc")},{title:t("guide.calendar.nav"),desc:t("guide.calendar.navDesc")}]},{id:"advanced",title:t("guide.advanced.title"),icon:Kg,items:[{title:t("guide.advanced.recurring"),desc:t("guide.advanced.recurringDesc")},{title:t("guide.advanced.subtasks"),desc:t("guide.advanced.subtasksDesc")},{title:t("guide.advanced.tags"),desc:t("guide.advanced.tagsDesc")}]},{id:"sharing",title:t("guide.sharing.title"),icon:tr,items:[{title:t("guide.sharing.createDetail"),desc:t("guide.sharing.createDetailDesc")},{title:t("guide.sharing.permissionDetail"),desc:t("guide.sharing.permissionDetailDesc")},{title:t("guide.sharing.filterDetail"),desc:t("guide.sharing.filterDetailDesc")}]},{id:"notifications",title:t("guide.notifications.title"),icon:Xn,items:[{title:t("guide.notifications.centerDetail"),desc:t("guide.notifications.centerDetailDesc")}]},{id:"account",title:t("guide.account.title"),icon:Zl,items:[{title:t("guide.account.login"),desc:t("guide.account.loginDesc")},{title:t("guide.account.backup"),desc:t("guide.account.backupDesc")}]}];return a.jsxs("div",{className:"max-w-4xl mx-auto pb-20",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[a.jsx(hx,{className:"w-8 h-8 text-indigo-600"}),t("guide.title")]}),a.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:t("guide.subtitle")})]}),a.jsx("div",{className:"grid gap-6",children:n.map((i,o)=>a.jsxs(WA.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:o*.1},className:`${s?"glass-card backdrop-blur-none transition-[background-color] duration-200":"bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700"} rounded-2xl p-6 shadow-sm border`,style:s?{backgroundColor:`rgba(${r?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-gray-100 dark:border-gray-700",children:[a.jsx("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:a.jsx(i.icon,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:i.title})]}),a.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:i.items.map((l,c)=>a.jsxs("div",{className:"space-y-2",children:[a.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500"}),l.title]}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed pl-3.5 border-l-2 border-gray-100 dark:border-gray-700",children:l.desc})]},c))})]},i.id))}),a.jsxs("div",{className:"mt-12 p-6 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl text-white shadow-xl",children:[a.jsx("h3",{className:"text-xl font-bold mb-2",children:t("guide.more.title")}),a.jsx("p",{className:"text-indigo-100 mb-6",children:t("guide.more.contact")}),a.jsx("button",{className:"px-6 py-2 bg-white text-indigo-600 font-bold rounded-lg hover:bg-indigo-50 transition-colors",children:t("guide.more.button")})]})]})},UA=()=>{const{t}=Xe(),{currentUser:e}=wt(),[r,s]=y.useState([]),[n,i]=y.useState([]),[o,l]=y.useState([]),[c,d]=y.useState(!1),[u,h]=y.useState(""),[g,m]=y.useState([]),[x,f]=y.useState(null),[p,w]=y.useState("edit"),[v,k]=y.useState(""),[b,T]=y.useState(null),[_,j]=y.useState(!1),[N,D]=y.useState(""),[$,C]=y.useState(!0),[R,B]=y.useState(""),[Y,V]=y.useState(!1),[q,z]=y.useState([]),de=O=>{switch(O){case"admin":return t("sharing.roleAdmin");case"edit":return t("sharing.roleEditor");case"view":return t("sharing.roleViewer");default:return O}};y.useEffect(()=>{if(!e?.uid)return;const O=ee.subscribeSharingGroups(e.uid,G=>{s(G),C(!1)});return()=>O()},[e?.uid]),y.useEffect(()=>{if(!e?.email)return;const O=e.email.toLowerCase().trim(),G=ee.subscribeToIncomingInvitations(O,M=>{i(M)});return()=>G()},[e?.email]),y.useEffect(()=>{if(!e?.uid)return;const O=ee.subscribeToSentInvitations(e.uid,G=>{l(G.filter(M=>M.status==="pending"))});return()=>O()},[e?.uid]);const[Te,we]=y.useState([]);y.useEffect(()=>{if(!e?.uid)return;const O=ee.subscribeToSharingNotifications(e.uid,G=>{const M=G.filter(se=>!se.read&&!se.isRead);we(M)});return()=>O()},[e?.uid]);const fe=async O=>{try{await ee.markNotificationAsRead(O)}catch(G){console.error("ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:",G)}},W=async()=>{if(v.trim()){if(v===e?.email){D(t("sharing.cannotShareSelf"));return}j(!0),D(""),T(null);try{const O=await ee.findUserByEmail(v);O?T(O):D(t("sharing.userNotFound"))}catch{D("Error searching user")}finally{j(!1)}}},le=()=>{if(b){if(g.some(O=>O.uid===b.uid)){D(t("sharing.alreadyAdded"));return}m(O=>[...O,{...b,permission:p}]),T(null),k(""),w("edit")}},ie=async()=>{if(!u.trim()||g.length===0){D("Group name and at least 1 member required");return}V(!0);try{const O=await ee.createSharingGroup(e.uid,{name:u,members:[{uid:e.uid,email:e.email.toLowerCase(),displayName:e.displayName||"",permission:"admin"}]});for(const G of g)await ee.sendSharingInvitation({uid:e.uid,email:e.email,displayName:e.displayName||"",permission:"admin"},G.email.toLowerCase(),O,u,G.permission,G.displayName);B(`Group '${u}' created`),d(!1),h(""),m([])}catch{D("Failed to create group")}finally{V(!1)}},be=async O=>{if(b){V(!0);try{await ee.sendSharingInvitation({uid:e.uid,email:e.email,displayName:e.displayName||"",permission:"admin"},b.email,O.id,O.name,p,b.displayName),B(t("sharing.inviteSent")),T(null),k(""),f(null),w("edit")}catch{D("Failed to invite")}finally{V(!1)}}},ye=(O,G,M)=>{const se=r.find(ge=>ge.id===O);if(!se)return;const ue=se.members.find(ge=>ge.uid===G);!ue||ue.permission===M||z(ge=>[...ge.filter(Ie=>!(Ie.groupId===O&&Ie.memberUid===G)),{groupId:O,memberUid:G,memberEmail:ue.email,previousPermission:ue.permission,newPermission:M}])},ke=async O=>{if(!e)return;const G=q.filter(M=>M.groupId===O);if(G.length!==0){V(!0);try{const M=r.find(ue=>ue.id===O);if(!M)return;const se=M.members.map(ue=>{const ge=G.find(re=>re.memberUid===ue.uid);return ge?{...ue,permission:ge.newPermission}:ue});await ee.updateSharingGroup(e.uid,O,{members:se});for(const ue of G)await ee.sendPermissionChangeNotification({uid:e.uid,email:e.email},ue.memberUid,O,M.name,ue.previousPermission,ue.newPermission);z(ue=>ue.filter(ge=>ge.groupId!==O)),B(`${G.length} permission(s) changed.`),setTimeout(()=>B(""),5e3)}catch(M){console.error("ê¶Œí•œ ë³€ê²½ ì €ì¥ ì‹¤íŒ¨:",M),D("Failed to save permission changes.")}finally{V(!1)}}},E=O=>q.some(G=>G.groupId===O),te=(O,G)=>q.find(se=>se.groupId===O&&se.memberUid===G)?.newPermission,Q=async(O,G)=>{if(!window.confirm(t("sharing.confirmRemoveMember")||"Remove this member?"))return;const M=r.find(ue=>ue.id===O);if(!M)return;const se=M.members.filter(ue=>ue.uid!==G);await ee.updateSharingGroup(e.uid,O,{members:se})},H=async O=>{window.confirm(t("sharing.confirmLeaveGroup")||"Leave this group?")&&await ee.leaveSharingGroup(e.uid,O)},I=async O=>{window.confirm(t("sharing.confirmDeleteGroup"))&&await ee.deleteSharingGroup(e.uid,O)},J=async(O,G)=>{await ee.respondToInvitation(O.id,G,{uid:e.uid,email:e.email,displayName:e.displayName||"",permission:O.permission})},ce=O=>o.filter(G=>G.groupId===O);return $?a.jsx("div",{className:"p-8 text-center",children:a.jsx(Ys,{className:"w-8 h-8 animate-spin mx-auto"})}):a.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx(tr,{className:"w-6 h-6 text-primary-600"}),t("sharing.settingsTitle")]}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t("sharing.subtitle")})]}),a.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition",children:[a.jsx(Xl,{className:"w-4 h-4"}),t("sharing.createNewGroup")]})]}),R&&a.jsxs("div",{className:"p-4 bg-green-50 text-green-700 rounded-xl flex items-center gap-2 animate-fade-in",children:[a.jsx(Yt,{className:"w-4 h-4"})," ",R]}),N&&a.jsxs("div",{className:"p-4 bg-red-50 text-red-700 rounded-xl flex items-center gap-2 animate-fade-in",children:[a.jsx(Zg,{className:"w-4 h-4"})," ",N]}),n.length>0&&a.jsxs("section",{className:"bg-orange-50 dark:bg-orange-900/10 border border-orange-200 dark:border-orange-800 rounded-2xl p-6",children:[a.jsxs("h3",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2 mb-4",children:[a.jsx(Xn,{className:"w-5 h-5"})," ",t("sharing.incomingInvites")," (",n.length,")"]}),a.jsx("div",{className:"space-y-3",children:n.map(O=>a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border border-orange-100 dark:border-orange-900/50 flex items-center justify-between shadow-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t("sharing.inviteMessage",{email:O.fromEmail,group:O.groupName})}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[t("sharing.columnPermission"),": ",de(O.permission)]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>J(O,"accepted"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium",children:t("sharing.accept")}),a.jsx("button",{onClick:()=>J(O,"rejected"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium",children:t("sharing.reject")})]})]},O.id))})]}),Te.length>0&&a.jsxs("section",{className:"bg-blue-50 dark:bg-blue-900/10 border border-blue-200 dark:border-blue-800 rounded-2xl p-6",children:[a.jsxs("h3",{className:"font-bold text-blue-800 dark:text-blue-200 flex items-center gap-2 mb-4",children:[a.jsx(Zl,{className:"w-5 h-5"})," ",t("sharing.permissionChange")," (",Te.length,")"]}),a.jsx("div",{className:"space-y-3",children:Te.map(O=>a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl border border-blue-100 dark:border-blue-900/50 flex items-center justify-between shadow-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t("sharing.permissionChangeMessage",{email:O.fromEmail,group:O.groupName})}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[de(O.previousPermission)," â†’ ",a.jsx("span",{className:"font-semibold text-blue-600",children:de(O.newPermission)})]})]}),a.jsx("button",{onClick:()=>fe(O.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:t("sharing.check")})]},O.id))})]}),c&&a.jsxs("section",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg",children:[a.jsx("h3",{className:"font-bold text-lg mb-4",children:t("sharing.createNewGroup")}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("input",{type:"text",placeholder:t("sharing.groupNamePlaceholder"),value:u,onChange:O=>h(O.target.value),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-primary-500"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("sharing.inviteMember")}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"email",placeholder:t("sharing.searchEmailPlaceholder"),value:v,onChange:O=>k(O.target.value),onKeyDown:O=>O.key==="Enter"&&W(),className:"flex-1 px-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg"}),a.jsx("button",{onClick:W,disabled:_,className:"px-4 py-2 bg-gray-600 text-white rounded-lg",children:t("sharing.search")})]}),b&&a.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[a.jsx("span",{className:"font-medium",children:b.displayName||b.email}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{value:p,onChange:O=>w(O.target.value),className:"px-2 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:[a.jsx("option",{value:"view",children:t("sharing.roleView")}),a.jsx("option",{value:"edit",children:t("sharing.roleEdit")}),a.jsx("option",{value:"admin",children:t("sharing.roleAdmin")})]}),a.jsx("button",{onClick:le,className:"text-sm bg-blue-600 text-white px-3 py-1.5 rounded-lg",children:t("sharing.add")})]})]}),g.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map((O,G)=>a.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm",children:[O.email," (",de(O.permission),")",a.jsx("button",{onClick:()=>m(M=>M.filter(se=>se.uid!==O.uid)),children:a.jsx(rt,{className:"w-3 h-3"})})]},G))})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{onClick:ie,disabled:Y,className:"flex-1 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-medium",children:t("sharing.createGroupSendInvite")}),a.jsx("button",{onClick:()=>d(!1),className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200",children:t("sharing.cancel")})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[r.map(O=>{const G=ce(O.id);return a.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-sm overflow-hidden",children:[a.jsxs("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between bg-gray-50/50 dark:bg-gray-800/50",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[O.name,O.isReference&&a.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:t("sharing.referenceGroup")})]}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t("sharing.owner"),": ",O.originalOwnerEmail||e?.email]})]}),a.jsx("div",{className:"flex gap-2",children:O.isReference?a.jsxs("button",{onClick:()=>H(O.id),className:"flex items-center gap-1 px-3 py-1.5 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg text-sm transition",children:[a.jsx(Jg,{className:"w-4 h-4"})," ",t("sharing.leave")]}):a.jsxs("button",{onClick:()=>I(O.id),className:"flex items-center gap-1 px-3 py-1.5 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg text-sm transition",children:[a.jsx(Ut,{className:"w-4 h-4"})," ",t("sharing.deleteGroup")]})})]}),a.jsx("div",{className:"p-4",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left text-gray-500 border-b border-gray-100 dark:border-gray-700",children:[a.jsx("th",{className:"pb-3 pl-2 font-medium",children:t("sharing.columnMember")}),a.jsx("th",{className:"pb-3 font-medium",children:t("sharing.columnPermission")}),a.jsx("th",{className:"pb-3 text-right pr-2",children:t("sharing.columnManage")})]})}),a.jsxs("tbody",{className:"divide-y divide-gray-50 dark:divide-gray-700/50",children:[O.members.map(M=>a.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[a.jsx("td",{className:"py-3 pl-2",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-100 to-purple-100 dark:from-primary-900 dark:to-purple-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold",children:M.email[0].toUpperCase()}),a.jsxs("div",{children:[a.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[M.displayName||M.email.split("@")[0],M.uid===e?.uid&&a.jsx("span",{className:"ml-2 text-xs text-primary-600",children:t("sharing.me")})]}),a.jsx("div",{className:"text-gray-400 text-xs",children:M.email})]})]})}),a.jsx("td",{className:"py-3",children:!O.isReference&&M.uid!==e?.uid?a.jsxs("div",{className:"relative inline-block",children:[a.jsxs("select",{value:te(O.id,M.uid)||M.permission,onChange:se=>ye(O.id,M.uid,se.target.value),className:`appearance-none pl-3 pr-8 py-1 border-none rounded-lg text-xs font-medium cursor-pointer focus:ring-2 focus:ring-primary-500 ${te(O.id,M.uid)?"bg-yellow-100 dark:bg-yellow-900/50 ring-2 ring-yellow-400":"bg-gray-100 dark:bg-gray-700"}`,children:[a.jsx("option",{value:"view",children:t("sharing.roleView")}),a.jsx("option",{value:"edit",children:t("sharing.roleEdit")}),a.jsx("option",{value:"admin",children:t("sharing.roleAdmin")})]}),a.jsx(pa,{className:"w-3 h-3 absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"})]}):a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${M.permission==="admin"?"bg-purple-100 text-purple-700":M.permission==="edit"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:de(M.permission)})}),a.jsx("td",{className:"py-3 text-right pr-2",children:!O.isReference&&M.uid!==e?.uid&&a.jsx("button",{onClick:()=>Q(O.id,M.uid),className:"text-gray-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded-lg transition",title:t("sharing.removeMember"),children:a.jsx(gx,{className:"w-4 h-4"})})})]},M.uid)),G.map(M=>a.jsxs("tr",{className:"bg-yellow-50/50 dark:bg-yellow-900/10",children:[a.jsx("td",{className:"py-3 pl-2",children:a.jsxs("div",{className:"flex items-center gap-3 opacity-70",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/50 flex items-center justify-center text-yellow-700",children:a.jsx(gr,{className:"w-4 h-4"})}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-700 dark:text-gray-300",children:M.toEmail}),a.jsx("div",{className:"text-yellow-600 text-xs",children:t("sharing.waitingAccept")})]})]})}),a.jsx("td",{className:"py-3",children:a.jsxs("span",{className:"text-xs text-gray-400",children:[t("sharing.invited")," (",de(M.permission),")"]})}),a.jsx("td",{className:"py-3 text-right pr-2",children:a.jsx("span",{className:"text-xs text-gray-400",children:"-"})})]},M.id))]})]})}),!O.isReference&&a.jsx("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/30",children:x===O.id?a.jsxs("div",{className:"flex gap-2 animate-fade-in items-center",children:[a.jsx("input",{type:"email",placeholder:t("sharing.inviteMemberPlaceholder"),value:v,onChange:M=>k(M.target.value),onKeyDown:M=>M.key==="Enter"&&W(),className:"flex-1 px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg"}),a.jsx("button",{onClick:W,className:"px-3 py-2 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700",children:t("sharing.search")}),b&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{value:p,onChange:M=>w(M.target.value),className:"px-2 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:[a.jsx("option",{value:"view",children:t("sharing.roleView")}),a.jsx("option",{value:"edit",children:t("sharing.roleEdit")}),a.jsx("option",{value:"admin",children:t("sharing.roleAdmin")})]}),a.jsx("button",{onClick:()=>be(O),className:"px-3 py-2 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700 animate-pulse",children:t("sharing.sendInvite")})]}),a.jsx("button",{onClick:()=>{f(null),k(""),T(null)},className:"p-2 text-gray-500 hover:text-gray-700",children:a.jsx(rt,{className:"w-5 h-5"})})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("button",{onClick:()=>f(O.id),className:"flex items-center gap-2 text-sm text-gray-500 hover:text-primary-600 font-medium transition px-2 py-1 rounded-lg hover:bg-primary-50",children:[a.jsx(em,{className:"w-4 h-4"})," ",t("sharing.inviteMember")]}),E(O.id)&&a.jsxs("button",{onClick:()=>ke(O.id),disabled:Y,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition font-medium disabled:opacity-50",children:[Y?a.jsx(Ys,{className:"w-4 h-4 animate-spin"}):a.jsx(ei,{className:"w-4 h-4"}),t("sharing.savePermissionChanges")]})]})})]},O.id)}),r.length===0&&!c&&a.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700",children:[a.jsx(tr,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 font-medium",children:t("sharing.noGroups")}),a.jsx("p",{className:"text-gray-400 text-sm mt-1",children:t("sharing.noGroupsDesc")})]})]})]})},BA=({searchTerm:t,onSearchChange:e,priorityFilter:r,onPriorityFilterChange:s,typeFilter:n,onTypeFilterChange:i,projectFilter:o,onProjectFilterChange:l,tagFilter:c,onTagFilterChange:d,completionDateFilter:u,onCompletionDateFilterChange:h,onClearFilters:g,searchInputRef:m,availableTags:x})=>{const{t:f}=Xe(),[p,w]=y.useState(!1),v=r!=="all"||n!=="all"||o!=="all"||t.length>0||c.length>0||u!=="all",k=b=>{c.includes(b)?d(c.filter(T=>T!==b)):d([...c,b])};return a.jsxs("div",{className:"mb-6 relative z-30",children:[a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("div",{className:"relative flex-1 group",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(Zo,{className:"h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"})}),a.jsx("input",{ref:m,type:"text",value:t,onChange:b=>e(b.target.value),className:"block w-full pl-10 pr-3 py-2.5 bg-white/50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 backdrop-blur-sm transition-all duration-200 text-sm placeholder-gray-400 dark:text-white shadow-sm hover:bg-white/80 dark:hover:bg-gray-800/80",placeholder:f("search.placeholder")})]}),a.jsxs("button",{onClick:()=>w(!p),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border transition-all duration-200 ${v||p?"bg-blue-500 text-white border-blue-600 shadow-md shadow-blue-500/20":"bg-white/50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 backdrop-blur-sm shadow-sm"}`,children:[a.jsx(tm,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:f("search.filter")}),v&&a.jsx("span",{className:"bg-white/20 text-white text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:f("search.on")})]}),v&&a.jsx("button",{onClick:g,className:"flex items-center justify-center w-10 h-10 rounded-xl bg-gray-100 text-gray-500 hover:bg-red-50 hover:text-red-500 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-red-900/30 dark:hover:text-red-400 transition-colors border border-transparent hover:border-red-200 dark:hover:border-red-800",title:f("search.clear"),children:a.jsx(rt,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:`
        absolute top-full left-0 right-0 mt-2 p-5 
        glass-panel shadow-xl transform origin-top transition-all duration-300 ease-out
        ${p?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 -translate-y-2 pointer-events-none"}
      `,children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:f("search.priority")}),a.jsxs("select",{value:r,onChange:b=>s(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsxs("option",{value:"urgent",children:["ğŸš¨ ",f("modal.addTodo.urgent")]}),a.jsxs("option",{value:"high",children:["ğŸ”´ ",f("modal.addTodo.high")]}),a.jsxs("option",{value:"medium",children:["ğŸŸ¡ ",f("modal.addTodo.medium")]}),a.jsxs("option",{value:"low",children:["ğŸŸ¢ ",f("modal.addTodo.low")]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:f("search.type")}),a.jsxs("select",{value:n,onChange:b=>i(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsxs("option",{value:"simple",children:["ğŸ“ ",f("modal.addTodo.simpleTask")]}),a.jsxs("option",{value:"project",children:["ğŸš€ ",f("modal.addTodo.project")]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:f("search.projectCategory")}),a.jsxs("select",{value:o,onChange:b=>l(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:n!=="project"&&n!=="all",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsxs("option",{value:"longterm",children:["ğŸ“… ",f("modal.addTodo.longTermProject")||f("projectTemplate.longterm")," ",f("modal.addTodo.project")]}),a.jsxs("option",{value:"shortterm",children:["âš¡ ",f("modal.addTodo.shortTermProject")||f("projectTemplate.shortterm")," ",f("modal.addTodo.project")]})]})]}),a.jsxs("div",{className:"space-y-2 sm:col-span-2 lg:col-span-1",children:[a.jsxs("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[a.jsx(el,{className:"w-3 h-3"}),f("search.tags")]}),a.jsx("div",{className:"p-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg max-h-32 overflow-y-auto custom-scrollbar",children:x.length>0?a.jsx("div",{className:"space-y-1",children:x.map(b=>a.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer transition-colors",children:[a.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center transition-colors ${c.includes(b)?"bg-blue-500 border-blue-500 text-white":"border-gray-300 dark:border-gray-600"}`,children:c.includes(b)&&a.jsx(Yt,{className:"w-3 h-3"})}),a.jsx("input",{type:"checkbox",checked:c.includes(b),onChange:()=>k(b),className:"hidden"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:b})]},b))}):a.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center py-2",children:f("search.noTags")})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[a.jsx(at,{className:"w-3 h-3"}),f("search.completionDate")]}),a.jsxs("select",{value:u,onChange:b=>h(b.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[a.jsx("option",{value:"all",children:f("search.all")}),a.jsx("option",{value:"today",children:f("search.todayCompleted")}),a.jsx("option",{value:"yesterday",children:f("search.yesterdayCompleted")}),a.jsx("option",{value:"thisWeek",children:f("search.thisWeekCompleted")}),a.jsx("option",{value:"lastWeek",children:f("search.lastWeekCompleted")}),a.jsx("option",{value:"thisMonth",children:f("search.thisMonthCompleted")})]})]})]}),v&&a.jsx("div",{className:"mt-5 pt-4 border-t border-gray-200/50 dark:border-gray-700/50",children:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.length>0&&a.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs font-medium border border-blue-200 dark:border-blue-800",children:[a.jsx(el,{className:"w-3 h-3"}),c.length,f("search.countTags")]}),u!=="all"&&a.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full text-xs font-medium border border-green-200 dark:border-green-800",children:[a.jsx(at,{className:"w-3 h-3"}),u==="today"&&f("search.todayCompleted"),u==="yesterday"&&f("search.yesterdayCompleted"),u==="thisWeek"&&f("search.thisWeekCompleted"),u==="lastWeek"&&f("search.lastWeekCompleted"),u==="thisMonth"&&f("search.thisMonthCompleted")]})]})})]})]})},Og=({filterState:t,onChange:e,className:r="",isMobile:s=!1})=>{const{t:n}=Xe(),{currentUser:i}=wt(),{todos:o}=ot(),[l,c]=y.useState([]),[d,u]=y.useState(!1);y.useEffect(()=>{if(!i?.uid)return;const p=ee.subscribeSharingGroups(i.uid,w=>c(w));return()=>p()},[i?.uid]);const h=y.useMemo(()=>{if(!i)return{personal:0,myShared:0,groupShared:0};let p=0,w=0,v=0;return o.forEach(k=>{if(t.selectedGroupId&&k.sharedGroupId!==t.selectedGroupId&&k.sharedGroupOwnerId!==t.selectedGroupId&&k.sharedGroupId!==t.selectedGroupId)return;const b=k.visibility?.isPersonal!==!1,T=k.visibility?.isShared===!0,_=T&&k.ownerId===i.uid,j=T&&k.ownerId!==i.uid;b&&!T&&p++,_&&w++,j&&v++}),{personal:p,myShared:w,groupShared:v}},[o,i,t.selectedGroupId]),g=p=>{e({...t,[p]:!t[p]})},m=p=>{e({...t,selectedGroupId:p}),u(!1)},x=()=>t.selectedGroupId?l.find(w=>w.id===t.selectedGroupId||w.originalGroupId===t.selectedGroupId)?.name||n("sharing.allGroups")||"ì „ì²´":n("sharing.allGroups")||"ì „ì²´",f=p=>p?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-700 ring-1 ring-blue-500/20":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700";return s?a.jsxs("div",{className:`flex flex-col gap-5 ${r}`,children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 px-1",children:[a.jsx(co,{className:"w-3.5 h-3.5 text-blue-500"}),a.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:n("sharing.filter")||"í•„í„°"})]}),a.jsxs("div",{className:"grid gap-2",children:[a.jsxs("button",{onClick:()=>g("showPersonal"),className:`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${f(t.showPersonal)}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${t.showPersonal?"bg-blue-100 dark:bg-blue-900/50 text-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:a.jsx(qn,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium",children:n("sharing.personal")||"ë‚´ í• ì¼"})]}),a.jsx("span",{className:`px-2.5 py-0.5 rounded-md text-xs font-bold ${t.showPersonal?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.personal})]}),a.jsxs("button",{onClick:()=>g("showMyShared"),className:`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${f(t.showMyShared)}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${t.showMyShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:a.jsx(co,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium",children:n("sharing.myShared")||"ë‚´ê°€ ê³µìœ "})]}),a.jsx("span",{className:`px-2.5 py-0.5 rounded-md text-xs font-bold ${t.showMyShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.myShared})]}),a.jsxs("button",{onClick:()=>g("showGroupShared"),className:`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${f(t.showGroupShared)}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${t.showGroupShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:a.jsx(tr,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium",children:n("sharing.groupShared")||"ê·¸ë£¹ ê³µìœ "})]}),a.jsx("span",{className:`px-2.5 py-0.5 rounded-md text-xs font-bold ${t.showGroupShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.groupShared})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 px-1",children:[a.jsx(tr,{className:"w-3.5 h-3.5 text-blue-500"}),a.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:n("sharing.group")||"ê·¸ë£¹ ì„ íƒ"})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-2 border border-gray-200 dark:border-gray-700 max-h-56 overflow-y-auto",children:[a.jsxs("button",{onClick:()=>m(null),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all mb-1 ${t.selectedGroupId?"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50":"bg-white dark:bg-gray-700 shadow-sm ring-1 ring-blue-500/20 text-blue-600 dark:text-blue-300 font-medium"}`,children:[a.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${t.selectedGroupId?"bg-gray-300 dark:bg-gray-600":"bg-blue-500"}`}),n("sharing.allGroups")||"ì „ì²´"]}),l.map(p=>{const w=p.isReference?p.originalGroupId:p.id,v=t.selectedGroupId===w;return a.jsxs("button",{onClick:()=>m(w||null),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all mb-1 ${v?"bg-white dark:bg-gray-700 shadow-sm ring-1 ring-blue-500/20 text-blue-600 dark:text-blue-300 font-medium":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50"}`,children:[a.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${v?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`}),a.jsx("span",{className:"flex-1 text-left truncate",children:p.name}),a.jsxs("span",{className:"text-xs px-2 py-0.5 bg-gray-100 dark:bg-gray-600 rounded-full text-gray-500 dark:text-gray-300",children:[p.members?.length||0,"ëª…"]})]},p.id)}),l.length===0&&a.jsx("div",{className:"p-4 text-center text-xs text-gray-400 italic",children:n("sharing.noGroupsShort")||"ê·¸ë£¹ ì—†ìŒ"})]})]})]}):a.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${r}`,children:[a.jsxs("button",{type:"button",onClick:()=>g("showPersonal"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${f(t.showPersonal)}`,title:n("sharing.filterPersonal")||"ê°œì¸ í• ì¼",children:[a.jsx(qn,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:n("sharing.personal")||"ë‚´ í• ì¼"}),a.jsx("span",{className:`ml-0.5 px-1.5 py-0.5 rounded-full text-[10px] ${t.showPersonal?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.personal})]}),a.jsxs("button",{type:"button",onClick:()=>g("showMyShared"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${f(t.showMyShared)}`,title:n("sharing.filterMyShared")||"ë‚´ê°€ ê³µìœ í•œ í• ì¼",children:[a.jsx(co,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:n("sharing.myShared")||"ë‚´ê°€ ê³µìœ "}),a.jsx("span",{className:`ml-0.5 px-1.5 py-0.5 rounded-full text-[10px] ${t.showMyShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.myShared})]}),a.jsxs("button",{type:"button",onClick:()=>g("showGroupShared"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${f(t.showGroupShared)}`,title:n("sharing.filterGroupShared")||"ê·¸ë£¹ì´ ê³µìœ í•œ í• ì¼",children:[a.jsx(tr,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:n("sharing.groupShared")||"ê·¸ë£¹ ê³µìœ "}),a.jsx("span",{className:`ml-0.5 px-1.5 py-0.5 rounded-full text-[10px] ${t.showGroupShared?"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-500"}`,children:h.groupShared})]}),a.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-gray-700 mx-1"}),a.jsxs("div",{className:"relative",children:[a.jsxs("button",{type:"button",onClick:()=>u(!d),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[a.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[n("sharing.group")||"ê·¸ë£¹",":"]}),a.jsx("span",{className:"text-gray-900 dark:text-white max-w-[100px] truncate",children:x()}),a.jsx(pa,{className:`w-3.5 h-3.5 text-gray-400 transition-transform ${d?"rotate-180":""}`})]}),d&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),a.jsxs("div",{className:"absolute top-full right-0 mt-1 min-w-[200px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50 py-1 max-h-60 overflow-y-auto",children:[a.jsx("button",{type:"button",onClick:()=>m(null),className:`w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${t.selectedGroupId?"text-gray-700 dark:text-gray-300":"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300"}`,children:n("sharing.allGroups")||"ì „ì²´"}),l.length>0&&a.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700 my-1"}),l.map(p=>{const w=p.isReference?p.originalGroupId:p.id,v=t.selectedGroupId===w;return a.jsxs("button",{type:"button",onClick:()=>m(w||null),className:`w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center gap-2 ${v?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300":"text-gray-700 dark:text-gray-300"}`,children:[a.jsx(tr,{className:"w-3.5 h-3.5 flex-shrink-0 text-gray-400"}),a.jsx("span",{className:"truncate flex-1",children:p.name}),a.jsxs("span",{className:"text-xs text-gray-400",children:["(",p.members?.length||0,")"]})]},p.id)}),l.length===0&&a.jsx("div",{className:"px-4 py-3 text-xs text-gray-500 dark:text-gray-400 text-center",children:n("sharing.noGroupsShort")||"ê³µìœ  ê·¸ë£¹ ì—†ìŒ"})]})]})]})]})},HA=()=>{const{t}=Xe(),{currentUser:e}=wt(),[r,s]=y.useState([]),[n,i]=y.useState([]),[o,l]=y.useState(!1),[c,d]=y.useState(!1),[u,h]=y.useState(null),g=y.useRef(null);y.useEffect(()=>{const x=f=>{g.current&&!g.current.contains(f.target)&&l(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]),y.useEffect(()=>{if(!e?.email)return;const x=ee.subscribeToIncomingInvitations(e.email,f=>{s(f)});return()=>x()},[e?.email]),y.useEffect(()=>{if(!e?.uid)return;const x=ee.subscribeToSharingNotifications(e.uid,f=>{i(f)});return()=>x()},[e?.uid]),y.useEffect(()=>{const x=r.length>0,f=n.some(p=>!p.read);d(x||f)},[r,n]);const m=async(x,f)=>{if(e){h(x.id);try{const p={uid:e.uid,email:e.email,displayName:e.displayName||void 0,photoURL:e.photoURL,permission:x.permission||"read"};await ee.respondToInvitation(x.id,f,p),s(w=>w.filter(v=>v.id!==x.id))}catch(p){console.error("Action failed:",p),alert(t("common.error")||"Action failed")}finally{h(null)}}};return a.jsxs("div",{className:"relative z-50",children:[a.jsxs("button",{onClick:()=>l(!o),className:"relative p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:t("nav.notifications")||"Notifications",children:[a.jsx(Xn,{className:`w-6 h-6 ${c?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"}`}),c&&a.jsx("span",{className:"absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-900"})]}),o&&a.jsxs("div",{ref:g,className:"absolute right-0 top-full mt-2 w-80 sm:w-96 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[a.jsxs("div",{className:"p-3 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[a.jsx("h3",{className:"font-semibold text-sm text-gray-900 dark:text-white",children:t("nav.notifications")||"Notifications"}),r.length>0&&a.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full dark:bg-blue-900/30 dark:text-blue-300",children:r.length})]}),a.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:r.length===0&&n.length===0?a.jsxs("div",{className:"p-8 text-center text-gray-400 text-sm",children:[a.jsx(Xn,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:t("notifications.empty")||"No new notifications"})]}):a.jsxs("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[n.map(x=>a.jsx("div",{className:`p-4 transition-colors cursor-pointer ${x.read?"bg-white dark:bg-gray-800 opacity-70":"bg-orange-50 dark:bg-orange-900/20"}`,onClick:async()=>{x.read||await ee.markNotificationAsRead(x.id)},children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${x.read?"bg-gray-100 dark:bg-gray-700 text-gray-500":"bg-orange-100 dark:bg-orange-900/50 text-orange-600 dark:text-orange-300"}`,children:a.jsx(Zl,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"ê¶Œí•œ ë³€ê²½"}),!x.read&&a.jsx("span",{className:"text-xs bg-red-100 text-red-700 px-1.5 py-0.5 rounded-full font-bold",children:"!"})]}),a.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-0.5",children:[a.jsxs("span",{className:"font-medium text-primary-600",children:["'",x.groupName,"'"]})," ê·¸ë£¹ì—ì„œ"]}),a.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-200 mt-1 font-medium",children:[x.previousPermission==="admin"?"ê´€ë¦¬ì":x.previousPermission==="edit"?"í¸ì§‘ì":"ë·°ì–´",a.jsx("span",{className:"mx-1.5",children:"â†’"}),a.jsx("span",{className:`${x.newPermission==="admin"?"text-purple-600":x.newPermission==="edit"?"text-blue-600":"text-gray-600"}`,children:x.newPermission==="admin"?"ê´€ë¦¬ì":x.newPermission==="edit"?"í¸ì§‘ì":"ë·°ì–´"}),a.jsx("span",{className:"text-gray-400 ml-1",children:"ë¡œ ë³€ê²½ë¨"})]}),a.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[x.fromEmail,"ë‹˜ì´ ë³€ê²½ â€¢ ",x.createdAt instanceof Date?x.createdAt.toLocaleString("ko-KR"):"ë°©ê¸ˆ"]})]})]})},x.id)),r.map(x=>a.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-blue-600 dark:text-blue-300 shrink-0",children:a.jsx(em,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t("notifications.inviteTitle")||"Invitation to share"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-0.5 break-all",children:[a.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:x.fromEmail})," invited you to ",a.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:['"',x.shareName||x.todoTitle,'"']})]}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:x.createdAt instanceof Date?x.createdAt.toLocaleDateString():"Just now"}),a.jsxs("div",{className:"flex gap-2 mt-3",children:[a.jsxs("button",{onClick:()=>m(x,"accepted"),disabled:!!u,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white rounded-lg text-xs font-semibold hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[u===x.id?a.jsx(Ys,{className:"w-3 h-3 animate-spin"}):a.jsx(Yt,{className:"w-3.5 h-3.5"}),t("common.accept")||"Accept"]}),a.jsxs("button",{onClick:()=>m(x,"rejected"),disabled:!!u,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 bg-white border border-gray-200 text-gray-700 rounded-lg text-xs font-semibold hover:bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 transition-colors",children:[a.jsx(rt,{className:"w-3.5 h-3.5"}),t("common.decline")||"Decline"]})]})]})]})},x.id))]})})]})]})},Bs=Ar("App",{web:()=>Je(()=>import("./web-D53_8Scr.js"),__vite__mapDeps([6,2,3,1,4]),import.meta.url).then(t=>new t.AppWeb)}),GA=Object.freeze(Object.defineProperty({__proto__:null,App:Bs},Symbol.toStringTag,{value:"Module"})),zA=({children:t})=>{const[e,r]=y.useState(0),[s,n]=y.useState(0),[i,o]=y.useState(!1),l=y.useRef(null),{forceRefresh:c}=ot(),{loading:d}=ln(),u=80,h=x=>{const f=x.target.closest(".overflow-y-auto"),p=f?f.scrollTop===0:window.scrollY===0;r(p?x.touches[0].clientY:0)},g=x=>{if(e===0||i)return;const p=x.touches[0].clientY-e;p>0&&n(Math.min(p*.5,u+20))},m=async()=>{if(!(e===0||i)){if(s>=u){o(!0),n(u);try{console.log("ğŸ”„ Pull-to-Refresh triggered"),await c(),await new Promise(x=>setTimeout(x,500))}catch(x){console.error("Refresh failed:",x)}finally{o(!1),n(0)}}else n(0);r(0)}};return a.jsxs("div",{className:"relative min-h-screen",onTouchStart:h,onTouchMove:g,onTouchEnd:m,ref:l,children:[a.jsx("div",{className:"absolute top-0 left-0 w-full flex justify-center pointer-events-none transition-transform duration-200 ease-out z-50",style:{transform:`translateY(${s>0?s-40:-40}px)`,opacity:s>0?Math.min(s/u,1):0},children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-full p-2 shadow-md border border-gray-200 dark:border-gray-700",children:a.jsx(Ys,{className:`w-6 h-6 text-blue-500 ${i?"animate-spin":""}`})})}),a.jsx("div",{style:{transform:`translateY(${s}px)`,transition:"transform 0.2s ease-out"},children:t})]})},KA=({currentView:t,isSidebarOpen:e,onToggleSidebar:r,searchInputRef:s,isMobile:n})=>{const{t:i,i18n:o}=Xe(),l=o.language==="ko"?cn:rn,{currentUser:c}=wt(),{allTags:d}=ot(),{currentTheme:u,isDark:h}=Lt(),g=!!u.bg,[m,x]=y.useState(!1),[f,p]=y.useState(null),[w,v]=y.useState(new Date),[k,b]=y.useState(void 0),[T,_]=y.useState(""),[j,N]=y.useState("all"),[D,$]=y.useState("all"),[C,R]=y.useState("all"),[B,Y]=y.useState([]),[V,q]=y.useState("all"),[z,de]=y.useState(()=>{const E=localStorage.getItem("sharingFilterState");if(E)try{return JSON.parse(E)}catch(te){console.error("Failed to parse sharingFilterState",te)}return{showPersonal:!0,showMyShared:!0,showGroupShared:!0,selectedGroupId:null}});y.useEffect(()=>{localStorage.setItem("sharingFilterState",JSON.stringify(z))},[z]);const[Te,we]=y.useState(!1),fe=z.showPersonal&&z.showMyShared&&z.showGroupShared?z.selectedGroupId||"all":z.showPersonal&&!z.showMyShared&&!z.showGroupShared?"private":!z.showPersonal&&z.showMyShared&&!z.showGroupShared?"my_shared":!z.showPersonal&&!z.showMyShared&&z.showGroupShared?"shared":"all";y.useEffect(()=>{t==="board"&&q("today")},[t]),y.useEffect(()=>{const E=()=>{console.log("Received openAddTodoModal event"),b(void 0),x(!0)};return window.addEventListener("openAddTodoModal",E),()=>{window.removeEventListener("openAddTodoModal",E)}},[]),y.useEffect(()=>{if(!c?.uid)return;const E=ee.subscribeToSentInvitations(c.uid,async te=>{const Q=te.filter(H=>H.status==="accepted");for(const H of Q){console.log("ğŸ”” ìˆ˜ë½ëœ ì´ˆëŒ€ ê°ì§€:",H.toEmail);try{await ee.processAcceptedInvitation(H)}catch(I){console.error("ì´ˆëŒ€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",I)}}});return()=>E()},[c?.uid]);const W=E=>{v(E)},le=()=>{v(t==="week"?E=>Rn(E):t==="month"?E=>si(E):E=>An(E))},ie=()=>{v(t==="week"?E=>fm(E,1):t==="month"?E=>pm(E,1):E=>xs(E,1))},be=()=>{v(new Date)},ye=()=>{_(""),N("all"),$("all"),R("all"),Y([]),q("all"),de({showPersonal:!0,showMyShared:!0,showGroupShared:!0,selectedGroupId:null})},ke=E=>{p(E)};return y.useEffect(()=>{let E=0;const te=async()=>{const H=Date.now();if(m){x(!1),b(void 0);return}if(f){p(null);return}if(n&&e){r();return}H-E<2e3?Bs.exitApp():(E=H,window.confirm(i("common.confirmExit")||"ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&Bs.exitApp())};return(async()=>{try{await Bs.addListener("backButton",te)}catch(H){console.warn("Back button listener setup failed:",H)}})(),()=>{Bs.removeAllListeners()}},[m,f,e,n,r,i]),a.jsxs("main",{className:`flex-1 min-w-0 transition-all duration-300 ease-in-out ${e?"lg:ml-64":"lg:ml-20"}`,children:[a.jsx("header",{className:`border-b border-white/20 dark:border-white/10 sticky top-0 z-20 pt-[env(safe-area-inset-top)] 
          ${g?"shadow-none border-white/30 dark:border-white/20 backdrop-blur-none transition-[background-color] duration-200":"bg-white/70 dark:bg-gray-900/70 backdrop-blur-md"}`,style:g?{backgroundColor:`rgba(${h?"0, 0, 0":"255, 255, 255"}, var(--glass-opacity, 0.1))`}:{},children:a.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg lg:hidden",children:a.jsx(mx,{className:"w-6 h-6 text-gray-600"})}),a.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[t==="today"&&i("nav.today"),t==="week"&&i("nav.week"),t==="month"&&i("nav.month"),t==="board"&&(i("nav.board")||"Kanban Board"),t==="settings"&&i("nav.settings"),t==="analytics"&&i("nav.analytics"),t==="recurring"&&i("nav.recurring"),t==="history"&&i("nav.history"),t==="vacation"&&i("nav.vacation"),t==="guide"&&i("guide.title")]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"hidden lg:block",children:a.jsx(Og,{filterState:z,onChange:de})}),a.jsxs("button",{onClick:()=>we(!0),className:"lg:hidden p-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded-lg relative",children:[a.jsx(tr,{className:"w-6 h-6"}),(!z.showPersonal||!z.showMyShared||!z.showGroupShared||z.selectedGroupId)&&a.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-blue-500 rounded-full"})]}),a.jsx(HA,{}),a.jsxs("button",{onClick:()=>{b(void 0),x(!0)},className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors shadow-sm hover:shadow-md",children:[a.jsx(gt,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:i("common.addTodo")})]}),a.jsx("div",{className:"h-8 w-px bg-gray-200 hidden sm:block"}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"text-right hidden sm:block",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:c?.displayName||"User"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c?.email||"user@example.com"})]}),a.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden border border-primary-200",children:c?.photoURL?a.jsx("img",{src:c.photoURL,alt:"Profile",className:"w-full h-full object-cover"}):a.jsx(qn,{className:"w-6 h-6 text-primary-600"})})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"w-full",children:a.jsx(BA,{searchTerm:T,onSearchChange:_,priorityFilter:j,onPriorityFilterChange:N,typeFilter:D,onTypeFilterChange:$,projectFilter:C,onProjectFilterChange:R,tagFilter:B,onTagFilterChange:Y,completionDateFilter:V,onCompletionDateFilterChange:q,onClearFilters:ye,availableTags:d,searchInputRef:s})}),(t==="today"||t==="week"||t==="month"||t==="board")&&a.jsxs("div",{className:"flex items-center justify-center gap-4 glass-panel p-2",children:[a.jsx("button",{onClick:le,className:"p-1 hover:bg-gray-200 rounded-full",children:a.jsx(Jl,{className:"w-5 h-5 text-gray-600"})}),a.jsxs("div",{onClick:()=>{const E=document.getElementById("date-picker-input");if(E&&"showPicker"in HTMLInputElement.prototype)try{E.showPicker()}catch{E.focus()}else E&&(E.focus(),E.click())},className:"relative flex items-center gap-2 px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors cursor-pointer group",children:[a.jsx("input",{id:"date-picker-input",type:"date",value:qe(w,"yyyy-MM-dd"),onChange:E=>{E.target.value&&W(new Date(E.target.value))},className:"sr-only","aria-label":"Select date"}),a.jsx(at,{className:"w-5 h-5 text-primary-600 group-hover:text-primary-700 dark:text-primary-400 dark:group-hover:text-primary-300 transition-colors"}),a.jsx("span",{className:"text-lg font-medium text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors",children:t==="week"?`${qe(as(w,{weekStartsOn:0}),o.language==="ko"?"Mì›” dì¼":"MMM d",{locale:l})} - ${qe(is(w,{weekStartsOn:0}),o.language==="ko"?"Mì›” dì¼":"MMM d",{locale:l})}`:t==="month"?qe(w,o.language==="ko"?"yyyyë…„ Mì›”":"MMMM yyyy",{locale:l}):qe(w,o.language==="ko"?"yyyyë…„ Mì›” dì¼ (EEE)":"MMM d yyyy (EEE)",{locale:l})})]}),a.jsx("button",{onClick:ie,className:"p-1 hover:bg-gray-200 rounded-full",children:a.jsx(gs,{className:"w-5 h-5 text-gray-600"})}),a.jsx("button",{onClick:be,className:"px-3 py-1 text-sm font-medium text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded-md border border-primary-200 dark:border-primary-500/30 ml-2",children:i("common.today")})]})]})]})}),a.jsx(zA,{children:a.jsx("div",{className:"p-4 sm:p-6 lg:p-8 max-w-[1920px] mx-auto min-h-[calc(100vh-80px)]",children:t==="today"?a.jsx(Tl,{currentView:"today",searchTerm:T,priorityFilter:j,typeFilter:D,projectFilter:C,tagFilter:B,completionDateFilter:V,sharingFilter:fe,sharingFilterState:z,selectedDate:w,onDateChange:W,onEdit:ke}):t==="week"?a.jsx(r_,{currentDate:w,onDateChange:W,searchTerm:T,priorityFilter:j,typeFilter:D,projectFilter:C,tagFilter:B,completionDateFilter:V,sharingFilter:fe,sharingFilterState:z,onAddTodo:E=>{b(E),x(!0)},isMobile:n}):t==="month"?a.jsxs("div",{className:"space-y-8",children:[a.jsx(s_,{currentDate:w,onDateChange:W,searchTerm:T,priorityFilter:j,typeFilter:D,projectFilter:C,tagFilter:B,completionDateFilter:V,sharingFilter:fe,sharingFilterState:z,onAddTodo:E=>{b(E),x(!0)},isMobile:n}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[a.jsx(Tl,{currentView:"month",onEdit:ke,sharingFilter:fe,sharingFilterState:z}),a.jsx("div",{className:"hidden lg:block",children:a.jsx(Nh,{})})]})]}):t==="board"?a.jsx(XD,{searchTerm:T,priorityFilter:j,typeFilter:D,projectFilter:C,tagFilter:B,completionDateFilter:V,onAddTodo:E=>{b(void 0),x(!0)},onEdit:ke,isMobile:n}):t==="analytics"?a.jsxs("div",{className:"w-full space-y-8",children:[a.jsx(QD,{}),a.jsx(Nh,{})]}):t==="recurring"?a.jsx(tC,{}):t==="history"?a.jsx(sC,{searchTerm:T,priorityFilter:j,typeFilter:D,projectFilter:C,tagFilter:B}):t==="vacation"?a.jsx("div",{className:"w-full h-[calc(100vh-100px)] rounded-xl overflow-hidden bg-white dark:bg-gray-900 shadow-sm border border-gray-200 dark:border-gray-800",children:a.jsx("iframe",{src:"https://anzpek.github.io/vacation-manager-react/",className:"w-full h-full border-0",title:"Vacation Management System",allow:"clipboard-write"})}):t==="settings"?a.jsx(lC,{}):t==="guide"?a.jsx(VA,{}):t==="sharing"?a.jsx(UA,{}):null})}),a.jsx("div",{className:"md:hidden",children:a.jsx(l0,{onClick:()=>{b(void 0),x(!0)}})}),a.jsx(i0,{isOpen:m,onClose:()=>{x(!1),b(void 0)},initialDate:k}),f&&a.jsx(Gc,{isOpen:!!f,onClose:()=>p(null),todo:f}),Te&&a.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-24 px-4 sm:pt-32",onClick:()=>we(!1),children:[a.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-opacity"}),a.jsxs("div",{className:"relative w-full max-w-sm bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl rounded-2xl p-5 shadow-2xl border border-white/20 dark:border-white/10 ring-1 ring-black/5 animate-in slide-in-from-top-4 duration-200",onClick:E=>E.stopPropagation(),style:{maxHeight:"calc(100vh - 140px)",overflowY:"auto"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-5 pb-4 border-b border-gray-200/50 dark:border-gray-700/50",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[a.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:a.jsx(tm,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),i("sharing.settingsTitle")]}),a.jsx("button",{onClick:()=>we(!1),className:"p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})})]}),a.jsx(Og,{filterState:z,onChange:de,isMobile:!0}),a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200/50 dark:border-gray-700/50",children:a.jsx("button",{onClick:()=>we(!1),className:"w-full py-3.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-blue-500/25 transition-all active:scale-[0.98] flex items-center justify-center gap-2",children:a.jsx("span",{children:i("common.confirm")})})})]})]})]})},YA="https://anzpek.github.io/todolist/version.json",qA=()=>{const[t,e]=y.useState(!1),[r,s]=y.useState("");return y.useEffect(()=>{(async()=>{try{const o=await(await fetch("/version.json")).json();if(s(o.version),!Ke.isNativePlatform()&&window.location.hostname!=="localhost")return;const l=await fetch(YA,{cache:"no-store"});if(!l.ok)return;(await l.json()).build>o.build&&e(!0)}catch(i){console.error("Failed to check for updates:",i)}})()},[]),{isUpdateAvailable:t,currentVersion:r}},Lg="hideUpdateModal_v1.3.1",XA=()=>{const{t}=Xe(),[e,r]=y.useState(!1),[s,n]=y.useState(!1),{isUpdateAvailable:i}=qA();y.useEffect(()=>{if(i){r(!0);return}localStorage.getItem(Lg)||r(!0)},[i]);const o=()=>{s&&localStorage.setItem(Lg,"true"),r(!1)};return e?a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden border border-gray-100 dark:border-gray-700 animate-in fade-in zoom-in duration-300",children:[a.jsxs("div",{className:"relative p-6 bg-gradient-to-br from-indigo-500 to-purple-600",children:[a.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-1 bg-white/20 hover:bg-white/30 rounded-full text-white transition-colors",children:a.jsx(rt,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex items-center gap-3 text-white mb-2",children:[a.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:a.jsx(Qo,{className:"w-6 h-6"})}),a.jsx("h2",{className:"text-xl font-bold",children:t("updateNotification.title")})]}),a.jsx("p",{className:"text-indigo-100 text-sm",children:t("updateNotification.newFeatures")})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"space-y-4 mb-6",children:(()=>{const l=t("updateNotification.changes",{returnObjects:!0});return(Array.isArray(l)?l:[]).map((d,u)=>a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"mt-0.5 p-1 bg-green-100 dark:bg-green-900/30 rounded-full",children:a.jsx(Yt,{className:"w-3 h-3 text-green-600 dark:text-green-400"})}),a.jsx("span",{className:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed",children:d})]},u))})()}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[a.jsx("div",{className:"relative flex items-center",children:a.jsx("input",{type:"checkbox",checked:s,onChange:l=>n(l.target.checked),className:"w-4 h-4 border-2 border-gray-300 dark:border-gray-600 rounded text-indigo-600 focus:ring-indigo-500 dark:bg-gray-700 transition-colors"})}),a.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors",children:t("updateNotification.dontShowAgain")})]}),a.jsx("button",{onClick:o,className:"w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-xl shadow-lg shadow-indigo-200 dark:shadow-none transition-all hover:scale-[1.02] active:scale-[0.98]",children:t("updateNotification.close")})]})]})]})}):null};var $g;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UPDATE_NOT_AVAILABLE=1]="UPDATE_NOT_AVAILABLE",t[t.UPDATE_AVAILABLE=2]="UPDATE_AVAILABLE",t[t.UPDATE_IN_PROGRESS=3]="UPDATE_IN_PROGRESS"})($g||($g={}));var Fg;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.PENDING=1]="PENDING",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.INSTALLING=3]="INSTALLING",t[t.INSTALLED=4]="INSTALLED",t[t.FAILED=5]="FAILED",t[t.CANCELED=6]="CANCELED",t[t.DOWNLOADED=11]="DOWNLOADED"})(Fg||(Fg={}));var Wg;(function(t){t[t.OK=0]="OK",t[t.CANCELED=1]="CANCELED",t[t.FAILED=2]="FAILED",t[t.NOT_AVAILABLE=3]="NOT_AVAILABLE",t[t.NOT_ALLOWED=4]="NOT_ALLOWED",t[t.INFO_MISSING=5]="INFO_MISSING"})(Wg||(Wg={}));const Vg=Ar("AppUpdate",{web:()=>Je(()=>import("./web-CFFLU050.js"),__vite__mapDeps([7,2,3,1,4]),import.meta.url).then(t=>new t.AppUpdateWeb)});Ar("Browser",{web:()=>Je(()=>import("./web-PiDjsOMT.js"),__vite__mapDeps([8,2,3,1,4]),import.meta.url).then(t=>new t.BrowserWeb)});const QA=y.createContext(null),JA=({children:t})=>{const e=y.useCallback(async()=>{if(Ke.isNativePlatform()){if(Ke.getPlatform()==="android")try{const r=await Vg.getAppUpdateInfo();r.updateAvailability===2?(console.log("ğŸš€ Android In-App Update available. Starting immediate update flow."),await Vg.performImmediateUpdate()):console.log("âœ… Android App is up to date (or update not allowed). Availability:",r.updateAvailability)}catch(r){console.error("âŒ Android In-App Update check failed:",r)}else if(Ke.getPlatform()==="ios")try{console.log("iOS update check is handled by OS automatic updates or manual App Store visit")}catch(r){console.error("âŒ iOS Update check failed:",r)}}},[]);return y.useEffect(()=>{e();const r=Bs.addListener("appStateChange",({isActive:s})=>{s&&e()});return()=>{r.then(s=>s.remove())}},[e]),a.jsx(QA.Provider,{value:{checkForUpdate:e},children:t})},ZA=y.lazy(()=>Je(()=>import("./LoginScreen-CUdxjRbV.js"),__vite__mapDeps([9,3,2,1,4]),import.meta.url)),eR=y.lazy(()=>Je(()=>import("./Sidebar-Df2gzWeA.js"),__vite__mapDeps([10,3,2,1,4]),import.meta.url)),tR=y.lazy(()=>Je(()=>import("./PWAInstallPrompt-PQqWkx6C.js"),__vite__mapDeps([11,3,2,1,4]),import.meta.url));y.lazy(()=>Je(()=>Promise.resolve().then(()=>cC),void 0,import.meta.url));const rR=y.lazy(()=>Je(()=>import("./ErrorBoundary-BgcXXvX2.js"),__vite__mapDeps([12,3,2,1,4]),import.meta.url)),sR=y.lazy(()=>Je(()=>import("./OfflineNotification-2VWx8yvV.js"),__vite__mapDeps([13,3,2,1,4]),import.meta.url)),nR=y.lazy(()=>Je(()=>import("./BottomNavigation-DRGGLu4w.js"),__vite__mapDeps([14,3,2,1,4]),import.meta.url)),Cd=()=>a.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50 dark:bg-gray-900",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});function aR({currentView:t,setCurrentView:e,isSidebarOpen:r,setIsSidebarOpen:s,searchInputRef:n,addTodoModalRef:i,isMobile:o,forceMobile:l,setForceMobile:c}){const d=FN("AppInner");return ON(),y.useEffect(()=>d,[o]),a.jsx(y.Suspense,{fallback:a.jsx(Cd,{}),children:a.jsxs("div",{className:`h-screen flex bg-transparent ${o?"flex-col":""}`,children:[o&&r&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-40",onClick:()=>s(!1)}),a.jsx(eR,{currentView:t,onViewChange:e,isOpen:r,onToggle:()=>s(!r),isMobile:o,forceMobile:l,onToggleForceMobile:c}),a.jsx("div",{className:`flex-1 flex flex-col min-w-0 overflow-y-auto overflow-x-hidden ${o?"pb-20":""}`,children:a.jsx(KA,{currentView:t,isSidebarOpen:r,onToggleSidebar:()=>s(!r),searchInputRef:n,addTodoModalRef:i,isMobile:o})}),o&&a.jsx(nR,{currentView:t,onViewChange:e,onToggleSidebar:()=>s(!0)}),a.jsx(sR,{}),a.jsx(tR,{}),a.jsx(XA,{})]})})}function iR(){const{currentUser:t,loading:e}=wt(),[r,s]=y.useState("today"),[n,i]=y.useState(!0),[o,l]=y.useState(!1),[c,d]=y.useState(null),u=y.useRef(null),h=y.useRef(null),{i18n:g}=Xe(),{todos:m,getRecurringTodos:x,toggleTodo:f,loadHistoricalTodos:p}=ot(),{vacations:w,employees:v,loadMonthVacations:k}=ln();y.useEffect(()=>{(async()=>{const C=new Date;await k(C.getFullYear(),C.getMonth()+1),await k(C.getFullYear(),C.getMonth()+2),r==="month"?(await p(C.getFullYear(),C.getMonth()+1),await p(C.getFullYear(),C.getMonth())):r==="week"&&await p(C.getFullYear(),C.getMonth()+1)})()},[r,k,p]),y.useEffect(()=>{const $=setTimeout(()=>{const C=[...m,...x()],R=w.map(B=>{const Y=v.find(V=>V.id===B.employeeId);return{...B,employeeName:Y?.name||""}});o0({todos:C,vacations:R})},1e3);return()=>clearTimeout($)},[m,x,w,v]),y.useEffect(()=>{t&&!t.isAnonymous&&ee.getUserSettings(t.uid).then($=>{if($?.language&&g.changeLanguage($.language),$?.startScreen)if($.startScreen==="last"){const C=localStorage.getItem("lastView");C&&s(C)}else s($.startScreen)}).catch($=>console.error("Failed to load user settings:",$))},[t,g]),y.useEffect(()=>{r&&localStorage.setItem("lastView",r)},[r]),y.useEffect(()=>{HN(),Vu();const $=setInterval(()=>{$N.measureMemoryUsage()},5e3),C=setInterval(()=>{bp.getErrorStats().total>0},1e4),R=setInterval(()=>{const Y=Vu().checks.filter(V=>V.status==="fail");Y.length>0&&ne.error("Critical security issues detected:",Y)},3e4);return()=>{clearInterval($),clearInterval(C),clearInterval(R)}},[]),y.useEffect(()=>{let $=0;(async()=>{try{const{Capacitor:R}=await Je(async()=>{const{Capacitor:z}=await Promise.resolve().then(()=>ms);return{Capacitor:z}},void 0,import.meta.url);if(!R.isNativePlatform())return;const{App:B}=await Je(async()=>{const{App:z}=await Promise.resolve().then(()=>GA);return{App:z}},void 0,import.meta.url),Y=z=>{const de=Date.now();if(console.log("Processing deep link:",z),z.includes("todolist://add")){if(de-$<500){console.log("Add modal debounce - skipping");return}$=de,console.log("Dispatching openAddTodoModal event"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("openAddTodoModal"))},300)}else if(z.includes("todolist://toggle")){const we=new URL(z).searchParams.get("taskId");we&&(console.log("Toggling task from widget:",we),setTimeout(()=>{f(we)},300))}},V=await B.getLaunchUrl();V?.url&&Y(V.url);const q=await B.addListener("appUrlOpen",z=>{console.log("Deep link opened:",z.url),Y(z.url)});return()=>{q.remove()}}catch(R){console.warn("Deep link handling not available:",R)}})()},[f]),y.useEffect(()=>{(async()=>{try{const{Capacitor:C}=await Je(async()=>{const{Capacitor:V}=await Promise.resolve().then(()=>ms);return{Capacitor:V}},void 0,import.meta.url);if(!C.isNativePlatform())return;const{registerPlugin:R}=await Je(async()=>{const{registerPlugin:V}=await Promise.resolve().then(()=>ms);return{registerPlugin:V}},void 0,import.meta.url),Y=await R("TodoListWidget").addListener("toggleTodo",V=>{console.log("Widget toggleTodo event received:",V.taskId),V.taskId&&f(V.taskId)});return()=>{Y.remove()}}catch(C){console.warn("Widget listener not available:",C)}})()},[f]),y.useEffect(()=>{const $=()=>{const Y=window.innerWidth;if(c!==null){l(c),i(!c);return}const V=Y<=768,q="ontouchstart"in window||navigator.maxTouchPoints>0,z=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),de=Y>768&&Y<=1024&&q,Te=window.matchMedia("(max-width: 768px)").matches,we=window.matchMedia("(pointer: coarse)").matches,fe=Y<=500&&q&&z||q&&z&&window.devicePixelRatio>=2||navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("Android")||Te&&q||we&&z;let W=!1;fe||Te||V||de?W=!0:W=!1,l(W),i(!W)};$();let C;const R=()=>{clearTimeout(C),C=setTimeout($,100)};window.addEventListener("resize",R),window.addEventListener("orientationchange",()=>{setTimeout($,200)});const B=setTimeout($,300);return()=>{window.removeEventListener("resize",R),window.removeEventListener("orientationchange",$),clearTimeout(C),clearTimeout(B)}},[c]);const b=()=>{h.current?.open()},T=()=>{u.current?.focus()},_=()=>{i(!n)},j=()=>{s("today")},N=()=>{s("week")},D=()=>{s("month")};return e?a.jsx(Cd,{}):t?a.jsx("div",{children:a.jsxs(AN,{onOpenAddTodo:b,onFocusSearch:T,onToggleSidebar:_,onSwitchToTodayView:j,onSwitchToWeekView:N,onSwitchToMonthView:D,children:[a.jsx(aR,{currentView:r,setCurrentView:s,isSidebarOpen:n,setIsSidebarOpen:i,searchInputRef:u,addTodoModalRef:h,isMobile:o,forceMobile:c,setForceMobile:d}),a.jsx(e_,{})]})}):a.jsx(ZA,{})}function oR(){return a.jsx(y.Suspense,{fallback:a.jsx(Cd,{}),children:a.jsx(rR,{children:a.jsx(yw,{children:a.jsx(Yv,{children:a.jsx(MN,{children:a.jsx(IN,{children:a.jsx(qv,{children:a.jsx(Jv,{children:a.jsx(JA,{children:a.jsx(iR,{})})})})})})})})})})}Gx.createRoot(document.getElementById("root")).render(a.jsx(y.StrictMode,{children:a.jsx(oR,{})}));export{Kd as P,lc as W,wt as a,Lt as b,ot as c,mo as d,ln as e,ee as f,ts as g,ne as h,Hr as i,a as j,mR as k,bp as l,WA as m,zd as n,Pn as s,Xe as u};
