const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Sidebar-BLLMYq2N.js","assets/icons-Ezod4H6N.js","assets/react-DJG_os-6.js","assets/firebase-BUAVoIHS.js","assets/date-C6uY6f2f.js","assets/PWAInstallPrompt-BHoMEHfS.js","assets/ErrorBoundary-pdSYDw6p.js","assets/OfflineNotification-BjA2SRGk.js"])))=>i.map(i=>d[i]);
import{r as M,P as Bt,C as jo,X as ct,a as Bp,b as Lu,D as th,U as sh,T as os,c as Hu,d as lt,e as Im,f as is,F as pw,S as Fp,V as yw,g as xw,R as Vp,h as $u,i as zu,j as xu,k as Yp,l as qp,m as nh,M as Go,n as Bu,o as To,p as bw,q as Gp,s as xa,t as Pp,u as So,v as vw,A as ww,w as kw,x as ah,y as Gl,z as _w,W as Um,B as Nw,E as Wp,G as Fu,H as jw,I as Tw,J as wo,K as Po,L as Sw,N as Lm,O as Dw,Q as Hm,Y as Ew,Z as Cw,_ as Aw,$ as Rw,a0 as Ow,a1 as Mw,a2 as Iw,a3 as Uw,a4 as $m,a5 as Lw,a6 as Hw}from"./icons-Ezod4H6N.js";import{r as $w,a as Qp}from"./react-DJG_os-6.js";import{_ as Xp,C as Kp,r as Do,S as Zp,a as Jp,F as zw,g as ey,b as Vn,c as ty,d as sy,i as rh,p as ny,u as ay,e as ry,f as ly,h as iy,j as Bw,k as Fw,G as Vw,o as Yw,s as qw,l as Gw,m as Pw,n as Ww,q as Qw,t as Xw,v as Ze,w as Rt,x as In,y as Nt,z as bt,A as Ns,B as bu,D as Mn,E as jl,H as ko,I as ca,J as Tl,K as po,L as Kw,M as zm,N as Zw,O as de,P as jt,Q as lh,R as on,T as hr,U as Eo,V as Jw,W as ek,X as tk,Y as Pl,Z as ih,$ as sk,a0 as oh,a1 as nk,a2 as ak,a3 as rk,a4 as Bm,a5 as oy,a6 as lk,a7 as ik,a8 as Wo,a9 as ok,aa as ck,ab as dk}from"./firebase-BUAVoIHS.js";import{f as ht,s as ch,i as uk,a as cy,b as hk,c as Ls,d as dy,e as vu,g as pl,h as yl,j as gk,k as uy,l as hy,m as fk,n as gr,o as mk,p as Dl,q as pk,r as yk,t as xk,u as bk,v as vk}from"./date-C6uY6f2f.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function n(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(c){if(c.ep)return;c.ep=!0;const d=n(c);fetch(c.href,d)}})();var wu={exports:{}},xl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fm;function wk(){if(Fm)return xl;Fm=1;var l=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(i,c,d){var h=null;if(d!==void 0&&(h=""+d),c.key!==void 0&&(h=""+c.key),"key"in c){d={};for(var f in c)f!=="key"&&(d[f]=c[f])}else d=c;return c=d.ref,{$$typeof:l,type:i,key:h,ref:c!==void 0?c:null,props:d}}return xl.Fragment=t,xl.jsx=n,xl.jsxs=n,xl}var Vm;function kk(){return Vm||(Vm=1,wu.exports=wk()),wu.exports}var r=kk(),ku={exports:{}},bl={},_u={exports:{}},Nu={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ym;function _k(){return Ym||(Ym=1,function(l){function t(F,ee){var ce=F.length;F.push(ee);e:for(;0<ce;){var I=ce-1>>>1,N=F[I];if(0<c(N,ee))F[I]=ee,F[ce]=N,ce=I;else break e}}function n(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var ee=F[0],ce=F.pop();if(ce!==ee){F[0]=ce;e:for(var I=0,N=F.length,A=N>>>1;I<A;){var _=2*(I+1)-1,H=F[_],U=_+1,Z=F[U];if(0>c(H,ce))U<N&&0>c(Z,H)?(F[I]=Z,F[U]=ce,I=U):(F[I]=H,F[_]=ce,I=_);else if(U<N&&0>c(Z,ce))F[I]=Z,F[U]=ce,I=U;else break e}}return ee}function c(F,ee){var ce=F.sortIndex-ee.sortIndex;return ce!==0?ce:F.id-ee.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;l.unstable_now=function(){return d.now()}}else{var h=Date,f=h.now();l.unstable_now=function(){return h.now()-f}}var m=[],p=[],x=1,b=null,w=3,C=!1,T=!1,z=!1,W=!1,k=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function E(F){for(var ee=n(p);ee!==null;){if(ee.callback===null)i(p);else if(ee.startTime<=F)i(p),ee.sortIndex=ee.expirationTime,t(m,ee);else break;ee=n(p)}}function O(F){if(z=!1,E(F),!T)if(n(m)!==null)T=!0,P||(P=!0,ye());else{var ee=n(p);ee!==null&&Ue(O,ee.startTime-F)}}var P=!1,$=-1,J=5,ae=-1;function me(){return W?!0:!(l.unstable_now()-ae<J)}function ke(){if(W=!1,P){var F=l.unstable_now();ae=F;var ee=!0;try{e:{T=!1,z&&(z=!1,R($),$=-1),C=!0;var ce=w;try{t:{for(E(F),b=n(m);b!==null&&!(b.expirationTime>F&&me());){var I=b.callback;if(typeof I=="function"){b.callback=null,w=b.priorityLevel;var N=I(b.expirationTime<=F);if(F=l.unstable_now(),typeof N=="function"){b.callback=N,E(F),ee=!0;break t}b===n(m)&&i(m),E(F)}else i(m);b=n(m)}if(b!==null)ee=!0;else{var A=n(p);A!==null&&Ue(O,A.startTime-F),ee=!1}}break e}finally{b=null,w=ce,C=!1}ee=void 0}}finally{ee?ye():P=!1}}}var ye;if(typeof D=="function")ye=function(){D(ke)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,Re=fe.port2;fe.port1.onmessage=ke,ye=function(){Re.postMessage(null)}}else ye=function(){k(ke,0)};function Ue(F,ee){$=k(function(){F(l.unstable_now())},ee)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(F){F.callback=null},l.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<F?Math.floor(1e3/F):5},l.unstable_getCurrentPriorityLevel=function(){return w},l.unstable_next=function(F){switch(w){case 1:case 2:case 3:var ee=3;break;default:ee=w}var ce=w;w=ee;try{return F()}finally{w=ce}},l.unstable_requestPaint=function(){W=!0},l.unstable_runWithPriority=function(F,ee){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var ce=w;w=F;try{return ee()}finally{w=ce}},l.unstable_scheduleCallback=function(F,ee,ce){var I=l.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?I+ce:I):ce=I,F){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=ce+N,F={id:x++,callback:ee,priorityLevel:F,startTime:ce,expirationTime:N,sortIndex:-1},ce>I?(F.sortIndex=ce,t(p,F),n(m)===null&&F===n(p)&&(z?(R($),$=-1):z=!0,Ue(O,ce-I))):(F.sortIndex=N,t(m,F),T||C||(T=!0,P||(P=!0,ye()))),F},l.unstable_shouldYield=me,l.unstable_wrapCallback=function(F){var ee=w;return function(){var ce=w;w=ee;try{return F.apply(this,arguments)}finally{w=ce}}}}(Nu)),Nu}var qm;function Nk(){return qm||(qm=1,_u.exports=_k()),_u.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gm;function jk(){if(Gm)return bl;Gm=1;var l=Nk(),t=$w(),n=Qp();function i(e){var s="https://react.dev/errors/"+e;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var s=e,a=e;if(e.alternate)for(;s.return;)s=s.return;else{e=s;do s=e,(s.flags&4098)!==0&&(a=s.return),e=s.return;while(e)}return s.tag===3?a:null}function h(e){if(e.tag===13){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function f(e){if(d(e)!==e)throw Error(i(188))}function m(e){var s=e.alternate;if(!s){if(s=d(e),s===null)throw Error(i(188));return s!==e?null:e}for(var a=e,o=s;;){var u=a.return;if(u===null)break;var g=u.alternate;if(g===null){if(o=u.return,o!==null){a=o;continue}break}if(u.child===g.child){for(g=u.child;g;){if(g===a)return f(u),e;if(g===o)return f(u),s;g=g.sibling}throw Error(i(188))}if(a.return!==o.return)a=u,o=g;else{for(var y=!1,v=u.child;v;){if(v===a){y=!0,a=u,o=g;break}if(v===o){y=!0,o=u,a=g;break}v=v.sibling}if(!y){for(v=g.child;v;){if(v===a){y=!0,a=g,o=u;break}if(v===o){y=!0,o=g,a=u;break}v=v.sibling}if(!y)throw Error(i(189))}}if(a.alternate!==o)throw Error(i(190))}if(a.tag!==3)throw Error(i(188));return a.stateNode.current===a?e:s}function p(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e;for(e=e.child;e!==null;){if(s=p(e),s!==null)return s;e=e.sibling}return null}var x=Object.assign,b=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),k=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),D=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ae=Symbol.for("react.activity"),me=Symbol.for("react.memo_cache_sentinel"),ke=Symbol.iterator;function ye(e){return e===null||typeof e!="object"?null:(e=ke&&e[ke]||e["@@iterator"],typeof e=="function"?e:null)}var fe=Symbol.for("react.client.reference");function Re(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===fe?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case T:return"Fragment";case W:return"Profiler";case z:return"StrictMode";case O:return"Suspense";case P:return"SuspenseList";case ae:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case C:return"Portal";case D:return(e.displayName||"Context")+".Provider";case R:return(e._context.displayName||"Context")+".Consumer";case E:var s=e.render;return e=e.displayName,e||(e=s.displayName||s.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case $:return s=e.displayName||null,s!==null?s:Re(e.type)||"Memo";case J:s=e._payload,e=e._init;try{return Re(e(s))}catch{}}return null}var Ue=Array.isArray,F=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ce={pending:!1,data:null,method:null,action:null},I=[],N=-1;function A(e){return{current:e}}function _(e){0>N||(e.current=I[N],I[N]=null,N--)}function H(e,s){N++,I[N]=e.current,e.current=s}var U=A(null),Z=A(null),le=A(null),ue=A(null);function be(e,s){switch(H(le,s),H(Z,e),H(U,null),s.nodeType){case 9:case 11:e=(e=s.documentElement)&&(e=e.namespaceURI)?cm(e):0;break;default:if(e=s.tagName,s=s.namespaceURI)s=cm(s),e=dm(s,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}_(U),H(U,e)}function Oe(){_(U),_(Z),_(le)}function Le(e){e.memoizedState!==null&&H(ue,e);var s=U.current,a=dm(s,e.type);s!==a&&(H(Z,e),H(U,a))}function we(e){Z.current===e&&(_(U),_(Z)),ue.current===e&&(_(ue),ul._currentValue=ce)}var pt=Object.prototype.hasOwnProperty,dn=l.unstable_scheduleCallback,qt=l.unstable_cancelCallback,j=l.unstable_shouldYield,V=l.unstable_requestPaint,q=l.unstable_now,K=l.unstable_getCurrentPriorityLevel,oe=l.unstable_ImmediatePriority,ie=l.unstable_UserBlockingPriority,te=l.unstable_NormalPriority,Ne=l.unstable_LowPriority,pe=l.unstable_IdlePriority,ge=l.log,je=l.unstable_setDisableYieldValue,he=null,xe=null;function Ie(e){if(typeof ge=="function"&&je(e),xe&&typeof xe.setStrictMode=="function")try{xe.setStrictMode(he,e)}catch{}}var Je=Math.clz32?Math.clz32:sb,Yn=Math.log,tb=Math.LN2;function sb(e){return e>>>=0,e===0?32:31-(Yn(e)/tb|0)|0}var si=256,ni=4194304;function qn(e){var s=e&42;if(s!==0)return s;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ai(e,s,a){var o=e.pendingLanes;if(o===0)return 0;var u=0,g=e.suspendedLanes,y=e.pingedLanes;e=e.warmLanes;var v=o&134217727;return v!==0?(o=v&~g,o!==0?u=qn(o):(y&=v,y!==0?u=qn(y):a||(a=v&~e,a!==0&&(u=qn(a))))):(v=o&~g,v!==0?u=qn(v):y!==0?u=qn(y):a||(a=o&~e,a!==0&&(u=qn(a)))),u===0?0:s!==0&&s!==u&&(s&g)===0&&(g=u&-u,a=s&-s,g>=a||g===32&&(a&4194048)!==0)?s:u}function vr(e,s){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&s)===0}function nb(e,s){switch(e){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qh(){var e=si;return si<<=1,(si&4194048)===0&&(si=256),e}function Gh(){var e=ni;return ni<<=1,(ni&62914560)===0&&(ni=4194304),e}function ic(e){for(var s=[],a=0;31>a;a++)s.push(e);return s}function wr(e,s){e.pendingLanes|=s,s!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function ab(e,s,a,o,u,g){var y=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var v=e.entanglements,S=e.expirationTimes,G=e.hiddenUpdates;for(a=y&~a;0<a;){var se=31-Je(a),re=1<<se;v[se]=0,S[se]=-1;var Q=G[se];if(Q!==null)for(G[se]=null,se=0;se<Q.length;se++){var X=Q[se];X!==null&&(X.lane&=-536870913)}a&=~re}o!==0&&Ph(e,o,0),g!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=g&~(y&~s))}function Ph(e,s,a){e.pendingLanes|=s,e.suspendedLanes&=~s;var o=31-Je(s);e.entangledLanes|=s,e.entanglements[o]=e.entanglements[o]|1073741824|a&4194090}function Wh(e,s){var a=e.entangledLanes|=s;for(e=e.entanglements;a;){var o=31-Je(a),u=1<<o;u&s|e[o]&s&&(e[o]|=s),a&=~u}}function oc(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function cc(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Qh(){var e=ee.p;return e!==0?e:(e=window.event,e===void 0?32:Em(e.type))}function rb(e,s){var a=ee.p;try{return ee.p=e,s()}finally{ee.p=a}}var un=Math.random().toString(36).slice(2),Ht="__reactFiber$"+un,Gt="__reactProps$"+un,wa="__reactContainer$"+un,dc="__reactEvents$"+un,lb="__reactListeners$"+un,ib="__reactHandles$"+un,Xh="__reactResources$"+un,kr="__reactMarker$"+un;function uc(e){delete e[Ht],delete e[Gt],delete e[dc],delete e[lb],delete e[ib]}function ka(e){var s=e[Ht];if(s)return s;for(var a=e.parentNode;a;){if(s=a[wa]||a[Ht]){if(a=s.alternate,s.child!==null||a!==null&&a.child!==null)for(e=fm(e);e!==null;){if(a=e[Ht])return a;e=fm(e)}return s}e=a,a=e.parentNode}return null}function _a(e){if(e=e[Ht]||e[wa]){var s=e.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return e}return null}function _r(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e.stateNode;throw Error(i(33))}function Na(e){var s=e[Xh];return s||(s=e[Xh]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function St(e){e[kr]=!0}var Kh=new Set,Zh={};function Gn(e,s){ja(e,s),ja(e+"Capture",s)}function ja(e,s){for(Zh[e]=s,e=0;e<s.length;e++)Kh.add(s[e])}var ob=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Jh={},e0={};function cb(e){return pt.call(e0,e)?!0:pt.call(Jh,e)?!1:ob.test(e)?e0[e]=!0:(Jh[e]=!0,!1)}function ri(e,s,a){if(cb(s))if(a===null)e.removeAttribute(s);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(s);return;case"boolean":var o=s.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(s);return}}e.setAttribute(s,""+a)}}function li(e,s,a){if(a===null)e.removeAttribute(s);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttribute(s,""+a)}}function Bs(e,s,a,o){if(o===null)e.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(s,a,""+o)}}var hc,t0;function Ta(e){if(hc===void 0)try{throw Error()}catch(a){var s=a.stack.trim().match(/\n( *(at )?)/);hc=s&&s[1]||"",t0=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+hc+e+t0}var gc=!1;function fc(e,s){if(!e||gc)return"";gc=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(s){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(X){var Q=X}Reflect.construct(e,[],re)}else{try{re.call()}catch(X){Q=X}e.call(re.prototype)}}else{try{throw Error()}catch(X){Q=X}(re=e())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(X){if(X&&Q&&typeof X.stack=="string")return[X.stack,Q.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=o.DetermineComponentFrameRoot(),y=g[0],v=g[1];if(y&&v){var S=y.split(`
`),G=v.split(`
`);for(u=o=0;o<S.length&&!S[o].includes("DetermineComponentFrameRoot");)o++;for(;u<G.length&&!G[u].includes("DetermineComponentFrameRoot");)u++;if(o===S.length||u===G.length)for(o=S.length-1,u=G.length-1;1<=o&&0<=u&&S[o]!==G[u];)u--;for(;1<=o&&0<=u;o--,u--)if(S[o]!==G[u]){if(o!==1||u!==1)do if(o--,u--,0>u||S[o]!==G[u]){var se=`
`+S[o].replace(" at new "," at ");return e.displayName&&se.includes("<anonymous>")&&(se=se.replace("<anonymous>",e.displayName)),se}while(1<=o&&0<=u);break}}}finally{gc=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Ta(a):""}function db(e){switch(e.tag){case 26:case 27:case 5:return Ta(e.type);case 16:return Ta("Lazy");case 13:return Ta("Suspense");case 19:return Ta("SuspenseList");case 0:case 15:return fc(e.type,!1);case 11:return fc(e.type.render,!1);case 1:return fc(e.type,!0);case 31:return Ta("Activity");default:return""}}function s0(e){try{var s="";do s+=db(e),e=e.return;while(e);return s}catch(a){return`
Error generating stack: `+a.message+`
`+a.stack}}function cs(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function n0(e){var s=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function ub(e){var s=n0(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,s),o=""+e[s];if(!e.hasOwnProperty(s)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var u=a.get,g=a.set;return Object.defineProperty(e,s,{configurable:!0,get:function(){return u.call(this)},set:function(y){o=""+y,g.call(this,y)}}),Object.defineProperty(e,s,{enumerable:a.enumerable}),{getValue:function(){return o},setValue:function(y){o=""+y},stopTracking:function(){e._valueTracker=null,delete e[s]}}}}function ii(e){e._valueTracker||(e._valueTracker=ub(e))}function a0(e){if(!e)return!1;var s=e._valueTracker;if(!s)return!0;var a=s.getValue(),o="";return e&&(o=n0(e)?e.checked?"true":"false":e.value),e=o,e!==a?(s.setValue(e),!0):!1}function oi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var hb=/[\n"\\]/g;function ds(e){return e.replace(hb,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function mc(e,s,a,o,u,g,y,v){e.name="",y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?e.type=y:e.removeAttribute("type"),s!=null?y==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+cs(s)):e.value!==""+cs(s)&&(e.value=""+cs(s)):y!=="submit"&&y!=="reset"||e.removeAttribute("value"),s!=null?pc(e,y,cs(s)):a!=null?pc(e,y,cs(a)):o!=null&&e.removeAttribute("value"),u==null&&g!=null&&(e.defaultChecked=!!g),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.name=""+cs(v):e.removeAttribute("name")}function r0(e,s,a,o,u,g,y,v){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),s!=null||a!=null){if(!(g!=="submit"&&g!=="reset"||s!=null))return;a=a!=null?""+cs(a):"",s=s!=null?""+cs(s):a,v||s===e.value||(e.value=s),e.defaultValue=s}o=o??u,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=v?e.checked:!!o,e.defaultChecked=!!o,y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(e.name=y)}function pc(e,s,a){s==="number"&&oi(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function Sa(e,s,a,o){if(e=e.options,s){s={};for(var u=0;u<a.length;u++)s["$"+a[u]]=!0;for(a=0;a<e.length;a++)u=s.hasOwnProperty("$"+e[a].value),e[a].selected!==u&&(e[a].selected=u),u&&o&&(e[a].defaultSelected=!0)}else{for(a=""+cs(a),s=null,u=0;u<e.length;u++){if(e[u].value===a){e[u].selected=!0,o&&(e[u].defaultSelected=!0);return}s!==null||e[u].disabled||(s=e[u])}s!==null&&(s.selected=!0)}}function l0(e,s,a){if(s!=null&&(s=""+cs(s),s!==e.value&&(e.value=s),a==null)){e.defaultValue!==s&&(e.defaultValue=s);return}e.defaultValue=a!=null?""+cs(a):""}function i0(e,s,a,o){if(s==null){if(o!=null){if(a!=null)throw Error(i(92));if(Ue(o)){if(1<o.length)throw Error(i(93));o=o[0]}a=o}a==null&&(a=""),s=a}a=cs(s),e.defaultValue=a,o=e.textContent,o===a&&o!==""&&o!==null&&(e.value=o)}function Da(e,s){if(s){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=s;return}}e.textContent=s}var gb=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function o0(e,s,a){var o=s.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?o?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="":o?e.setProperty(s,a):typeof a!="number"||a===0||gb.has(s)?s==="float"?e.cssFloat=a:e[s]=(""+a).trim():e[s]=a+"px"}function c0(e,s,a){if(s!=null&&typeof s!="object")throw Error(i(62));if(e=e.style,a!=null){for(var o in a)!a.hasOwnProperty(o)||s!=null&&s.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var u in s)o=s[u],s.hasOwnProperty(u)&&a[u]!==o&&o0(e,u,o)}else for(var g in s)s.hasOwnProperty(g)&&o0(e,g,s[g])}function yc(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),mb=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ci(e){return mb.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var xc=null;function bc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ea=null,Ca=null;function d0(e){var s=_a(e);if(s&&(e=s.stateNode)){var a=e[Gt]||null;e:switch(e=s.stateNode,s.type){case"input":if(mc(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),s=a.name,a.type==="radio"&&s!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ds(""+s)+'"][type="radio"]'),s=0;s<a.length;s++){var o=a[s];if(o!==e&&o.form===e.form){var u=o[Gt]||null;if(!u)throw Error(i(90));mc(o,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(s=0;s<a.length;s++)o=a[s],o.form===e.form&&a0(o)}break e;case"textarea":l0(e,a.value,a.defaultValue);break e;case"select":s=a.value,s!=null&&Sa(e,!!a.multiple,s,!1)}}}var vc=!1;function u0(e,s,a){if(vc)return e(s,a);vc=!0;try{var o=e(s);return o}finally{if(vc=!1,(Ea!==null||Ca!==null)&&(Wi(),Ea&&(s=Ea,e=Ca,Ca=Ea=null,d0(s),e)))for(s=0;s<e.length;s++)d0(e[s])}}function Nr(e,s){var a=e.stateNode;if(a===null)return null;var o=a[Gt]||null;if(o===null)return null;a=o[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(i(231,s,typeof a));return a}var Fs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wc=!1;if(Fs)try{var jr={};Object.defineProperty(jr,"passive",{get:function(){wc=!0}}),window.addEventListener("test",jr,jr),window.removeEventListener("test",jr,jr)}catch{wc=!1}var hn=null,kc=null,di=null;function h0(){if(di)return di;var e,s=kc,a=s.length,o,u="value"in hn?hn.value:hn.textContent,g=u.length;for(e=0;e<a&&s[e]===u[e];e++);var y=a-e;for(o=1;o<=y&&s[a-o]===u[g-o];o++);return di=u.slice(e,1<o?1-o:void 0)}function ui(e){var s=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&s===13&&(e=13)):e=s,e===10&&(e=13),32<=e||e===13?e:0}function hi(){return!0}function g0(){return!1}function Pt(e){function s(a,o,u,g,y){this._reactName=a,this._targetInst=u,this.type=o,this.nativeEvent=g,this.target=y,this.currentTarget=null;for(var v in e)e.hasOwnProperty(v)&&(a=e[v],this[v]=a?a(g):g[v]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?hi:g0,this.isPropagationStopped=g0,this}return x(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=hi)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=hi)},persist:function(){},isPersistent:hi}),s}var Pn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gi=Pt(Pn),Tr=x({},Pn,{view:0,detail:0}),pb=Pt(Tr),_c,Nc,Sr,fi=x({},Tr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Sr&&(Sr&&e.type==="mousemove"?(_c=e.screenX-Sr.screenX,Nc=e.screenY-Sr.screenY):Nc=_c=0,Sr=e),_c)},movementY:function(e){return"movementY"in e?e.movementY:Nc}}),f0=Pt(fi),yb=x({},fi,{dataTransfer:0}),xb=Pt(yb),bb=x({},Tr,{relatedTarget:0}),jc=Pt(bb),vb=x({},Pn,{animationName:0,elapsedTime:0,pseudoElement:0}),wb=Pt(vb),kb=x({},Pn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_b=Pt(kb),Nb=x({},Pn,{data:0}),m0=Pt(Nb),jb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Db(e){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(e):(e=Sb[e])?!!s[e]:!1}function Tc(){return Db}var Eb=x({},Tr,{key:function(e){if(e.key){var s=jb[e.key]||e.key;if(s!=="Unidentified")return s}return e.type==="keypress"?(e=ui(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Tb[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tc,charCode:function(e){return e.type==="keypress"?ui(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ui(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Cb=Pt(Eb),Ab=x({},fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),p0=Pt(Ab),Rb=x({},Tr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tc}),Ob=Pt(Rb),Mb=x({},Pn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ib=Pt(Mb),Ub=x({},fi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Lb=Pt(Ub),Hb=x({},Pn,{newState:0,oldState:0}),$b=Pt(Hb),zb=[9,13,27,32],Sc=Fs&&"CompositionEvent"in window,Dr=null;Fs&&"documentMode"in document&&(Dr=document.documentMode);var Bb=Fs&&"TextEvent"in window&&!Dr,y0=Fs&&(!Sc||Dr&&8<Dr&&11>=Dr),x0=" ",b0=!1;function v0(e,s){switch(e){case"keyup":return zb.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function w0(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Aa=!1;function Fb(e,s){switch(e){case"compositionend":return w0(s);case"keypress":return s.which!==32?null:(b0=!0,x0);case"textInput":return e=s.data,e===x0&&b0?null:e;default:return null}}function Vb(e,s){if(Aa)return e==="compositionend"||!Sc&&v0(e,s)?(e=h0(),di=kc=hn=null,Aa=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return y0&&s.locale!=="ko"?null:s.data;default:return null}}var Yb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function k0(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s==="input"?!!Yb[e.type]:s==="textarea"}function _0(e,s,a,o){Ea?Ca?Ca.push(o):Ca=[o]:Ea=o,s=eo(s,"onChange"),0<s.length&&(a=new gi("onChange","change",null,a,o),e.push({event:a,listeners:s}))}var Er=null,Cr=null;function qb(e){am(e,0)}function mi(e){var s=_r(e);if(a0(s))return e}function N0(e,s){if(e==="change")return s}var j0=!1;if(Fs){var Dc;if(Fs){var Ec="oninput"in document;if(!Ec){var T0=document.createElement("div");T0.setAttribute("oninput","return;"),Ec=typeof T0.oninput=="function"}Dc=Ec}else Dc=!1;j0=Dc&&(!document.documentMode||9<document.documentMode)}function S0(){Er&&(Er.detachEvent("onpropertychange",D0),Cr=Er=null)}function D0(e){if(e.propertyName==="value"&&mi(Cr)){var s=[];_0(s,Cr,e,bc(e)),u0(qb,s)}}function Gb(e,s,a){e==="focusin"?(S0(),Er=s,Cr=a,Er.attachEvent("onpropertychange",D0)):e==="focusout"&&S0()}function Pb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return mi(Cr)}function Wb(e,s){if(e==="click")return mi(s)}function Qb(e,s){if(e==="input"||e==="change")return mi(s)}function Xb(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var es=typeof Object.is=="function"?Object.is:Xb;function Ar(e,s){if(es(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;var a=Object.keys(e),o=Object.keys(s);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var u=a[o];if(!pt.call(s,u)||!es(e[u],s[u]))return!1}return!0}function E0(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function C0(e,s){var a=E0(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=s&&o>=s)return{node:a,offset:s-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=E0(a)}}function A0(e,s){return e&&s?e===s?!0:e&&e.nodeType===3?!1:s&&s.nodeType===3?A0(e,s.parentNode):"contains"in e?e.contains(s):e.compareDocumentPosition?!!(e.compareDocumentPosition(s)&16):!1:!1}function R0(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var s=oi(e.document);s instanceof e.HTMLIFrameElement;){try{var a=typeof s.contentWindow.location.href=="string"}catch{a=!1}if(a)e=s.contentWindow;else break;s=oi(e.document)}return s}function Cc(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s&&(s==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||s==="textarea"||e.contentEditable==="true")}var Kb=Fs&&"documentMode"in document&&11>=document.documentMode,Ra=null,Ac=null,Rr=null,Rc=!1;function O0(e,s,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Rc||Ra==null||Ra!==oi(o)||(o=Ra,"selectionStart"in o&&Cc(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Rr&&Ar(Rr,o)||(Rr=o,o=eo(Ac,"onSelect"),0<o.length&&(s=new gi("onSelect","select",null,s,a),e.push({event:s,listeners:o}),s.target=Ra)))}function Wn(e,s){var a={};return a[e.toLowerCase()]=s.toLowerCase(),a["Webkit"+e]="webkit"+s,a["Moz"+e]="moz"+s,a}var Oa={animationend:Wn("Animation","AnimationEnd"),animationiteration:Wn("Animation","AnimationIteration"),animationstart:Wn("Animation","AnimationStart"),transitionrun:Wn("Transition","TransitionRun"),transitionstart:Wn("Transition","TransitionStart"),transitioncancel:Wn("Transition","TransitionCancel"),transitionend:Wn("Transition","TransitionEnd")},Oc={},M0={};Fs&&(M0=document.createElement("div").style,"AnimationEvent"in window||(delete Oa.animationend.animation,delete Oa.animationiteration.animation,delete Oa.animationstart.animation),"TransitionEvent"in window||delete Oa.transitionend.transition);function Qn(e){if(Oc[e])return Oc[e];if(!Oa[e])return e;var s=Oa[e],a;for(a in s)if(s.hasOwnProperty(a)&&a in M0)return Oc[e]=s[a];return e}var I0=Qn("animationend"),U0=Qn("animationiteration"),L0=Qn("animationstart"),Zb=Qn("transitionrun"),Jb=Qn("transitionstart"),ev=Qn("transitioncancel"),H0=Qn("transitionend"),$0=new Map,Mc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Mc.push("scrollEnd");function ws(e,s){$0.set(e,s),Gn(s,[e])}var z0=new WeakMap;function us(e,s){if(typeof e=="object"&&e!==null){var a=z0.get(e);return a!==void 0?a:(s={value:e,source:s,stack:s0(s)},z0.set(e,s),s)}return{value:e,source:s,stack:s0(s)}}var hs=[],Ma=0,Ic=0;function pi(){for(var e=Ma,s=Ic=Ma=0;s<e;){var a=hs[s];hs[s++]=null;var o=hs[s];hs[s++]=null;var u=hs[s];hs[s++]=null;var g=hs[s];if(hs[s++]=null,o!==null&&u!==null){var y=o.pending;y===null?u.next=u:(u.next=y.next,y.next=u),o.pending=u}g!==0&&B0(a,u,g)}}function yi(e,s,a,o){hs[Ma++]=e,hs[Ma++]=s,hs[Ma++]=a,hs[Ma++]=o,Ic|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function Uc(e,s,a,o){return yi(e,s,a,o),xi(e)}function Ia(e,s){return yi(e,null,null,s),xi(e)}function B0(e,s,a){e.lanes|=a;var o=e.alternate;o!==null&&(o.lanes|=a);for(var u=!1,g=e.return;g!==null;)g.childLanes|=a,o=g.alternate,o!==null&&(o.childLanes|=a),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(u=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,u&&s!==null&&(u=31-Je(a),e=g.hiddenUpdates,o=e[u],o===null?e[u]=[s]:o.push(s),s.lane=a|536870912),g):null}function xi(e){if(50<nl)throw nl=0,Fd=null,Error(i(185));for(var s=e.return;s!==null;)e=s,s=e.return;return e.tag===3?e.stateNode:null}var Ua={};function tv(e,s,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(e,s,a,o){return new tv(e,s,a,o)}function Lc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Vs(e,s){var a=e.alternate;return a===null?(a=ts(e.tag,s,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=s,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,s=e.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function F0(e,s){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=s,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,s=a.dependencies,e.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),e}function bi(e,s,a,o,u,g){var y=0;if(o=e,typeof e=="function")Lc(e)&&(y=1);else if(typeof e=="string")y=nw(e,a,U.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ae:return e=ts(31,a,s,u),e.elementType=ae,e.lanes=g,e;case T:return Xn(a.children,u,g,s);case z:y=8,u|=24;break;case W:return e=ts(12,a,s,u|2),e.elementType=W,e.lanes=g,e;case O:return e=ts(13,a,s,u),e.elementType=O,e.lanes=g,e;case P:return e=ts(19,a,s,u),e.elementType=P,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case k:case D:y=10;break e;case R:y=9;break e;case E:y=11;break e;case $:y=14;break e;case J:y=16,o=null;break e}y=29,a=Error(i(130,e===null?"null":typeof e,"")),o=null}return s=ts(y,a,s,u),s.elementType=e,s.type=o,s.lanes=g,s}function Xn(e,s,a,o){return e=ts(7,e,o,s),e.lanes=a,e}function Hc(e,s,a){return e=ts(6,e,null,s),e.lanes=a,e}function $c(e,s,a){return s=ts(4,e.children!==null?e.children:[],e.key,s),s.lanes=a,s.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},s}var La=[],Ha=0,vi=null,wi=0,gs=[],fs=0,Kn=null,Ys=1,qs="";function Zn(e,s){La[Ha++]=wi,La[Ha++]=vi,vi=e,wi=s}function V0(e,s,a){gs[fs++]=Ys,gs[fs++]=qs,gs[fs++]=Kn,Kn=e;var o=Ys;e=qs;var u=32-Je(o)-1;o&=~(1<<u),a+=1;var g=32-Je(s)+u;if(30<g){var y=u-u%5;g=(o&(1<<y)-1).toString(32),o>>=y,u-=y,Ys=1<<32-Je(s)+u|a<<u|o,qs=g+e}else Ys=1<<g|a<<u|o,qs=e}function zc(e){e.return!==null&&(Zn(e,1),V0(e,1,0))}function Bc(e){for(;e===vi;)vi=La[--Ha],La[Ha]=null,wi=La[--Ha],La[Ha]=null;for(;e===Kn;)Kn=gs[--fs],gs[fs]=null,qs=gs[--fs],gs[fs]=null,Ys=gs[--fs],gs[fs]=null}var Vt=null,gt=null,We=!1,Jn=null,Cs=!1,Fc=Error(i(519));function ea(e){var s=Error(i(418,""));throw Ir(us(s,e)),Fc}function Y0(e){var s=e.stateNode,a=e.type,o=e.memoizedProps;switch(s[Ht]=e,s[Gt]=o,a){case"dialog":Ve("cancel",s),Ve("close",s);break;case"iframe":case"object":case"embed":Ve("load",s);break;case"video":case"audio":for(a=0;a<rl.length;a++)Ve(rl[a],s);break;case"source":Ve("error",s);break;case"img":case"image":case"link":Ve("error",s),Ve("load",s);break;case"details":Ve("toggle",s);break;case"input":Ve("invalid",s),r0(s,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),ii(s);break;case"select":Ve("invalid",s);break;case"textarea":Ve("invalid",s),i0(s,o.value,o.defaultValue,o.children),ii(s)}a=o.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||s.textContent===""+a||o.suppressHydrationWarning===!0||om(s.textContent,a)?(o.popover!=null&&(Ve("beforetoggle",s),Ve("toggle",s)),o.onScroll!=null&&Ve("scroll",s),o.onScrollEnd!=null&&Ve("scrollend",s),o.onClick!=null&&(s.onclick=to),s=!0):s=!1,s||ea(e)}function q0(e){for(Vt=e.return;Vt;)switch(Vt.tag){case 5:case 13:Cs=!1;return;case 27:case 3:Cs=!0;return;default:Vt=Vt.return}}function Or(e){if(e!==Vt)return!1;if(!We)return q0(e),We=!0,!1;var s=e.tag,a;if((a=s!==3&&s!==27)&&((a=s===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||au(e.type,e.memoizedProps)),a=!a),a&&gt&&ea(e),q0(e),s===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(i(317));e:{for(e=e.nextSibling,s=0;e;){if(e.nodeType===8)if(a=e.data,a==="/$"){if(s===0){gt=_s(e.nextSibling);break e}s--}else a!=="$"&&a!=="$!"&&a!=="$?"||s++;e=e.nextSibling}gt=null}}else s===27?(s=gt,Dn(e.type)?(e=ou,ou=null,gt=e):gt=s):gt=Vt?_s(e.stateNode.nextSibling):null;return!0}function Mr(){gt=Vt=null,We=!1}function G0(){var e=Jn;return e!==null&&(Xt===null?Xt=e:Xt.push.apply(Xt,e),Jn=null),e}function Ir(e){Jn===null?Jn=[e]:Jn.push(e)}var Vc=A(null),ta=null,Gs=null;function gn(e,s,a){H(Vc,s._currentValue),s._currentValue=a}function Ps(e){e._currentValue=Vc.current,_(Vc)}function Yc(e,s,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&s)!==s?(e.childLanes|=s,o!==null&&(o.childLanes|=s)):o!==null&&(o.childLanes&s)!==s&&(o.childLanes|=s),e===a)break;e=e.return}}function qc(e,s,a,o){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var g=u.dependencies;if(g!==null){var y=u.child;g=g.firstContext;e:for(;g!==null;){var v=g;g=u;for(var S=0;S<s.length;S++)if(v.context===s[S]){g.lanes|=a,v=g.alternate,v!==null&&(v.lanes|=a),Yc(g.return,a,e),o||(y=null);break e}g=v.next}}else if(u.tag===18){if(y=u.return,y===null)throw Error(i(341));y.lanes|=a,g=y.alternate,g!==null&&(g.lanes|=a),Yc(y,a,e),y=null}else y=u.child;if(y!==null)y.return=u;else for(y=u;y!==null;){if(y===e){y=null;break}if(u=y.sibling,u!==null){u.return=y.return,y=u;break}y=y.return}u=y}}function Ur(e,s,a,o){e=null;for(var u=s,g=!1;u!==null;){if(!g){if((u.flags&524288)!==0)g=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var y=u.alternate;if(y===null)throw Error(i(387));if(y=y.memoizedProps,y!==null){var v=u.type;es(u.pendingProps.value,y.value)||(e!==null?e.push(v):e=[v])}}else if(u===ue.current){if(y=u.alternate,y===null)throw Error(i(387));y.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(ul):e=[ul])}u=u.return}e!==null&&qc(s,e,a,o),s.flags|=262144}function ki(e){for(e=e.firstContext;e!==null;){if(!es(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function sa(e){ta=e,Gs=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function $t(e){return P0(ta,e)}function _i(e,s){return ta===null&&sa(e),P0(e,s)}function P0(e,s){var a=s._currentValue;if(s={context:s,memoizedValue:a,next:null},Gs===null){if(e===null)throw Error(i(308));Gs=s,e.dependencies={lanes:0,firstContext:s},e.flags|=524288}else Gs=Gs.next=s;return a}var sv=typeof AbortController<"u"?AbortController:function(){var e=[],s=this.signal={aborted:!1,addEventListener:function(a,o){e.push(o)}};this.abort=function(){s.aborted=!0,e.forEach(function(a){return a()})}},nv=l.unstable_scheduleCallback,av=l.unstable_NormalPriority,kt={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gc(){return{controller:new sv,data:new Map,refCount:0}}function Lr(e){e.refCount--,e.refCount===0&&nv(av,function(){e.controller.abort()})}var Hr=null,Pc=0,$a=0,za=null;function rv(e,s){if(Hr===null){var a=Hr=[];Pc=0,$a=Qd(),za={status:"pending",value:void 0,then:function(o){a.push(o)}}}return Pc++,s.then(W0,W0),s}function W0(){if(--Pc===0&&Hr!==null){za!==null&&(za.status="fulfilled");var e=Hr;Hr=null,$a=0,za=null;for(var s=0;s<e.length;s++)(0,e[s])()}}function lv(e,s){var a=[],o={status:"pending",value:null,reason:null,then:function(u){a.push(u)}};return e.then(function(){o.status="fulfilled",o.value=s;for(var u=0;u<a.length;u++)(0,a[u])(s)},function(u){for(o.status="rejected",o.reason=u,u=0;u<a.length;u++)(0,a[u])(void 0)}),o}var Q0=F.S;F.S=function(e,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&rv(e,s),Q0!==null&&Q0(e,s)};var na=A(null);function Wc(){var e=na.current;return e!==null?e:rt.pooledCache}function Ni(e,s){s===null?H(na,na.current):H(na,s.pool)}function X0(){var e=Wc();return e===null?null:{parent:kt._currentValue,pool:e}}var $r=Error(i(460)),K0=Error(i(474)),ji=Error(i(542)),Qc={then:function(){}};function Z0(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ti(){}function J0(e,s,a){switch(a=e[a],a===void 0?e.push(s):a!==s&&(s.then(Ti,Ti),s=a),s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,tg(e),e;default:if(typeof s.status=="string")s.then(Ti,Ti);else{if(e=rt,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=s,e.status="pending",e.then(function(o){if(s.status==="pending"){var u=s;u.status="fulfilled",u.value=o}},function(o){if(s.status==="pending"){var u=s;u.status="rejected",u.reason=o}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,tg(e),e}throw zr=s,$r}}var zr=null;function eg(){if(zr===null)throw Error(i(459));var e=zr;return zr=null,e}function tg(e){if(e===$r||e===ji)throw Error(i(483))}var fn=!1;function Xc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Kc(e,s){e=e.updateQueue,s.updateQueue===e&&(s.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function mn(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function pn(e,s,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(Qe&2)!==0){var u=o.pending;return u===null?s.next=s:(s.next=u.next,u.next=s),o.pending=s,s=xi(e),B0(e,null,a),s}return yi(e,o,s,a),xi(e)}function Br(e,s,a){if(s=s.updateQueue,s!==null&&(s=s.shared,(a&4194048)!==0)){var o=s.lanes;o&=e.pendingLanes,a|=o,s.lanes=a,Wh(e,a)}}function Zc(e,s){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var u=null,g=null;if(a=a.firstBaseUpdate,a!==null){do{var y={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};g===null?u=g=y:g=g.next=y,a=a.next}while(a!==null);g===null?u=g=s:g=g.next=s}else u=g=s;a={baseState:o.baseState,firstBaseUpdate:u,lastBaseUpdate:g,shared:o.shared,callbacks:o.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=s:e.next=s,a.lastBaseUpdate=s}var Jc=!1;function Fr(){if(Jc){var e=za;if(e!==null)throw e}}function Vr(e,s,a,o){Jc=!1;var u=e.updateQueue;fn=!1;var g=u.firstBaseUpdate,y=u.lastBaseUpdate,v=u.shared.pending;if(v!==null){u.shared.pending=null;var S=v,G=S.next;S.next=null,y===null?g=G:y.next=G,y=S;var se=e.alternate;se!==null&&(se=se.updateQueue,v=se.lastBaseUpdate,v!==y&&(v===null?se.firstBaseUpdate=G:v.next=G,se.lastBaseUpdate=S))}if(g!==null){var re=u.baseState;y=0,se=G=S=null,v=g;do{var Q=v.lane&-536870913,X=Q!==v.lane;if(X?(qe&Q)===Q:(o&Q)===Q){Q!==0&&Q===$a&&(Jc=!0),se!==null&&(se=se.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});e:{var Me=e,De=v;Q=s;var st=a;switch(De.tag){case 1:if(Me=De.payload,typeof Me=="function"){re=Me.call(st,re,Q);break e}re=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=De.payload,Q=typeof Me=="function"?Me.call(st,re,Q):Me,Q==null)break e;re=x({},re,Q);break e;case 2:fn=!0}}Q=v.callback,Q!==null&&(e.flags|=64,X&&(e.flags|=8192),X=u.callbacks,X===null?u.callbacks=[Q]:X.push(Q))}else X={lane:Q,tag:v.tag,payload:v.payload,callback:v.callback,next:null},se===null?(G=se=X,S=re):se=se.next=X,y|=Q;if(v=v.next,v===null){if(v=u.shared.pending,v===null)break;X=v,v=X.next,X.next=null,u.lastBaseUpdate=X,u.shared.pending=null}}while(!0);se===null&&(S=re),u.baseState=S,u.firstBaseUpdate=G,u.lastBaseUpdate=se,g===null&&(u.shared.lanes=0),Nn|=y,e.lanes=y,e.memoizedState=re}}function sg(e,s){if(typeof e!="function")throw Error(i(191,e));e.call(s)}function ng(e,s){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)sg(a[e],s)}var Ba=A(null),Si=A(0);function ag(e,s){e=en,H(Si,e),H(Ba,s),en=e|s.baseLanes}function ed(){H(Si,en),H(Ba,Ba.current)}function td(){en=Si.current,_(Ba),_(Si)}var yn=0,He=null,et=null,vt=null,Di=!1,Fa=!1,aa=!1,Ei=0,Yr=0,Va=null,iv=0;function yt(){throw Error(i(321))}function sd(e,s){if(s===null)return!1;for(var a=0;a<s.length&&a<e.length;a++)if(!es(e[a],s[a]))return!1;return!0}function nd(e,s,a,o,u,g){return yn=g,He=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,F.H=e===null||e.memoizedState===null?Bg:Fg,aa=!1,g=a(o,u),aa=!1,Fa&&(g=lg(s,a,o,u)),rg(e),g}function rg(e){F.H=Ii;var s=et!==null&&et.next!==null;if(yn=0,vt=et=He=null,Di=!1,Yr=0,Va=null,s)throw Error(i(300));e===null||Dt||(e=e.dependencies,e!==null&&ki(e)&&(Dt=!0))}function lg(e,s,a,o){He=e;var u=0;do{if(Fa&&(Va=null),Yr=0,Fa=!1,25<=u)throw Error(i(301));if(u+=1,vt=et=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}F.H=fv,g=s(a,o)}while(Fa);return g}function ov(){var e=F.H,s=e.useState()[0];return s=typeof s.then=="function"?qr(s):s,e=e.useState()[0],(et!==null?et.memoizedState:null)!==e&&(He.flags|=1024),s}function ad(){var e=Ei!==0;return Ei=0,e}function rd(e,s,a){s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~a}function ld(e){if(Di){for(e=e.memoizedState;e!==null;){var s=e.queue;s!==null&&(s.pending=null),e=e.next}Di=!1}yn=0,vt=et=He=null,Fa=!1,Yr=Ei=0,Va=null}function Wt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?He.memoizedState=vt=e:vt=vt.next=e,vt}function wt(){if(et===null){var e=He.alternate;e=e!==null?e.memoizedState:null}else e=et.next;var s=vt===null?He.memoizedState:vt.next;if(s!==null)vt=s,et=e;else{if(e===null)throw He.alternate===null?Error(i(467)):Error(i(310));et=e,e={memoizedState:et.memoizedState,baseState:et.baseState,baseQueue:et.baseQueue,queue:et.queue,next:null},vt===null?He.memoizedState=vt=e:vt=vt.next=e}return vt}function id(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function qr(e){var s=Yr;return Yr+=1,Va===null&&(Va=[]),e=J0(Va,e,s),s=He,(vt===null?s.memoizedState:vt.next)===null&&(s=s.alternate,F.H=s===null||s.memoizedState===null?Bg:Fg),e}function Ci(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return qr(e);if(e.$$typeof===D)return $t(e)}throw Error(i(438,String(e)))}function od(e){var s=null,a=He.updateQueue;if(a!==null&&(s=a.memoCache),s==null){var o=He.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(s={data:o.data.map(function(u){return u.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),a===null&&(a=id(),He.updateQueue=a),a.memoCache=s,a=s.data[s.index],a===void 0)for(a=s.data[s.index]=Array(e),o=0;o<e;o++)a[o]=me;return s.index++,a}function Ws(e,s){return typeof s=="function"?s(e):s}function Ai(e){var s=wt();return cd(s,et,e)}function cd(e,s,a){var o=e.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=a;var u=e.baseQueue,g=o.pending;if(g!==null){if(u!==null){var y=u.next;u.next=g.next,g.next=y}s.baseQueue=u=g,o.pending=null}if(g=e.baseState,u===null)e.memoizedState=g;else{s=u.next;var v=y=null,S=null,G=s,se=!1;do{var re=G.lane&-536870913;if(re!==G.lane?(qe&re)===re:(yn&re)===re){var Q=G.revertLane;if(Q===0)S!==null&&(S=S.next={lane:0,revertLane:0,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null}),re===$a&&(se=!0);else if((yn&Q)===Q){G=G.next,Q===$a&&(se=!0);continue}else re={lane:0,revertLane:G.revertLane,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},S===null?(v=S=re,y=g):S=S.next=re,He.lanes|=Q,Nn|=Q;re=G.action,aa&&a(g,re),g=G.hasEagerState?G.eagerState:a(g,re)}else Q={lane:re,revertLane:G.revertLane,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},S===null?(v=S=Q,y=g):S=S.next=Q,He.lanes|=re,Nn|=re;G=G.next}while(G!==null&&G!==s);if(S===null?y=g:S.next=v,!es(g,e.memoizedState)&&(Dt=!0,se&&(a=za,a!==null)))throw a;e.memoizedState=g,e.baseState=y,e.baseQueue=S,o.lastRenderedState=g}return u===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function dd(e){var s=wt(),a=s.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=e;var o=a.dispatch,u=a.pending,g=s.memoizedState;if(u!==null){a.pending=null;var y=u=u.next;do g=e(g,y.action),y=y.next;while(y!==u);es(g,s.memoizedState)||(Dt=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),a.lastRenderedState=g}return[g,o]}function ig(e,s,a){var o=He,u=wt(),g=We;if(g){if(a===void 0)throw Error(i(407));a=a()}else a=s();var y=!es((et||u).memoizedState,a);y&&(u.memoizedState=a,Dt=!0),u=u.queue;var v=dg.bind(null,o,u,e);if(Gr(2048,8,v,[e]),u.getSnapshot!==s||y||vt!==null&&vt.memoizedState.tag&1){if(o.flags|=2048,Ya(9,Ri(),cg.bind(null,o,u,a,s),null),rt===null)throw Error(i(349));g||(yn&124)!==0||og(o,s,a)}return a}function og(e,s,a){e.flags|=16384,e={getSnapshot:s,value:a},s=He.updateQueue,s===null?(s=id(),He.updateQueue=s,s.stores=[e]):(a=s.stores,a===null?s.stores=[e]:a.push(e))}function cg(e,s,a,o){s.value=a,s.getSnapshot=o,ug(s)&&hg(e)}function dg(e,s,a){return a(function(){ug(s)&&hg(e)})}function ug(e){var s=e.getSnapshot;e=e.value;try{var a=s();return!es(e,a)}catch{return!0}}function hg(e){var s=Ia(e,2);s!==null&&ls(s,e,2)}function ud(e){var s=Wt();if(typeof e=="function"){var a=e;if(e=a(),aa){Ie(!0);try{a()}finally{Ie(!1)}}}return s.memoizedState=s.baseState=e,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:e},s}function gg(e,s,a,o){return e.baseState=a,cd(e,et,typeof o=="function"?o:Ws)}function cv(e,s,a,o,u){if(Mi(e))throw Error(i(485));if(e=s.action,e!==null){var g={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(y){g.listeners.push(y)}};F.T!==null?a(!0):g.isTransition=!1,o(g),a=s.pending,a===null?(g.next=s.pending=g,fg(s,g)):(g.next=a.next,s.pending=a.next=g)}}function fg(e,s){var a=s.action,o=s.payload,u=e.state;if(s.isTransition){var g=F.T,y={};F.T=y;try{var v=a(u,o),S=F.S;S!==null&&S(y,v),mg(e,s,v)}catch(G){hd(e,s,G)}finally{F.T=g}}else try{g=a(u,o),mg(e,s,g)}catch(G){hd(e,s,G)}}function mg(e,s,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(o){pg(e,s,o)},function(o){return hd(e,s,o)}):pg(e,s,a)}function pg(e,s,a){s.status="fulfilled",s.value=a,yg(s),e.state=a,s=e.pending,s!==null&&(a=s.next,a===s?e.pending=null:(a=a.next,s.next=a,fg(e,a)))}function hd(e,s,a){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do s.status="rejected",s.reason=a,yg(s),s=s.next;while(s!==o)}e.action=null}function yg(e){e=e.listeners;for(var s=0;s<e.length;s++)(0,e[s])()}function xg(e,s){return s}function bg(e,s){if(We){var a=rt.formState;if(a!==null){e:{var o=He;if(We){if(gt){t:{for(var u=gt,g=Cs;u.nodeType!==8;){if(!g){u=null;break t}if(u=_s(u.nextSibling),u===null){u=null;break t}}g=u.data,u=g==="F!"||g==="F"?u:null}if(u){gt=_s(u.nextSibling),o=u.data==="F!";break e}}ea(o)}o=!1}o&&(s=a[0])}}return a=Wt(),a.memoizedState=a.baseState=s,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xg,lastRenderedState:s},a.queue=o,a=Hg.bind(null,He,o),o.dispatch=a,o=ud(!1),g=yd.bind(null,He,!1,o.queue),o=Wt(),u={state:s,dispatch:null,action:e,pending:null},o.queue=u,a=cv.bind(null,He,u,g,a),u.dispatch=a,o.memoizedState=e,[s,a,!1]}function vg(e){var s=wt();return wg(s,et,e)}function wg(e,s,a){if(s=cd(e,s,xg)[0],e=Ai(Ws)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var o=qr(s)}catch(y){throw y===$r?ji:y}else o=s;s=wt();var u=s.queue,g=u.dispatch;return a!==s.memoizedState&&(He.flags|=2048,Ya(9,Ri(),dv.bind(null,u,a),null)),[o,g,e]}function dv(e,s){e.action=s}function kg(e){var s=wt(),a=et;if(a!==null)return wg(s,a,e);wt(),s=s.memoizedState,a=wt();var o=a.queue.dispatch;return a.memoizedState=e,[s,o,!1]}function Ya(e,s,a,o){return e={tag:e,create:a,deps:o,inst:s,next:null},s=He.updateQueue,s===null&&(s=id(),He.updateQueue=s),a=s.lastEffect,a===null?s.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,s.lastEffect=e),e}function Ri(){return{destroy:void 0,resource:void 0}}function _g(){return wt().memoizedState}function Oi(e,s,a,o){var u=Wt();o=o===void 0?null:o,He.flags|=e,u.memoizedState=Ya(1|s,Ri(),a,o)}function Gr(e,s,a,o){var u=wt();o=o===void 0?null:o;var g=u.memoizedState.inst;et!==null&&o!==null&&sd(o,et.memoizedState.deps)?u.memoizedState=Ya(s,g,a,o):(He.flags|=e,u.memoizedState=Ya(1|s,g,a,o))}function Ng(e,s){Oi(8390656,8,e,s)}function jg(e,s){Gr(2048,8,e,s)}function Tg(e,s){return Gr(4,2,e,s)}function Sg(e,s){return Gr(4,4,e,s)}function Dg(e,s){if(typeof s=="function"){e=e();var a=s(e);return function(){typeof a=="function"?a():s(null)}}if(s!=null)return e=e(),s.current=e,function(){s.current=null}}function Eg(e,s,a){a=a!=null?a.concat([e]):null,Gr(4,4,Dg.bind(null,s,e),a)}function gd(){}function Cg(e,s){var a=wt();s=s===void 0?null:s;var o=a.memoizedState;return s!==null&&sd(s,o[1])?o[0]:(a.memoizedState=[e,s],e)}function Ag(e,s){var a=wt();s=s===void 0?null:s;var o=a.memoizedState;if(s!==null&&sd(s,o[1]))return o[0];if(o=e(),aa){Ie(!0);try{e()}finally{Ie(!1)}}return a.memoizedState=[o,s],o}function fd(e,s,a){return a===void 0||(yn&1073741824)!==0?e.memoizedState=s:(e.memoizedState=a,e=If(),He.lanes|=e,Nn|=e,a)}function Rg(e,s,a,o){return es(a,s)?a:Ba.current!==null?(e=fd(e,a,o),es(e,s)||(Dt=!0),e):(yn&42)===0?(Dt=!0,e.memoizedState=a):(e=If(),He.lanes|=e,Nn|=e,s)}function Og(e,s,a,o,u){var g=ee.p;ee.p=g!==0&&8>g?g:8;var y=F.T,v={};F.T=v,yd(e,!1,s,a);try{var S=u(),G=F.S;if(G!==null&&G(v,S),S!==null&&typeof S=="object"&&typeof S.then=="function"){var se=lv(S,o);Pr(e,s,se,rs(e))}else Pr(e,s,o,rs(e))}catch(re){Pr(e,s,{then:function(){},status:"rejected",reason:re},rs())}finally{ee.p=g,F.T=y}}function uv(){}function md(e,s,a,o){if(e.tag!==5)throw Error(i(476));var u=Mg(e).queue;Og(e,u,s,ce,a===null?uv:function(){return Ig(e),a(o)})}function Mg(e){var s=e.memoizedState;if(s!==null)return s;s={memoizedState:ce,baseState:ce,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:ce},next:null};var a={};return s.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:a},next:null},e.memoizedState=s,e=e.alternate,e!==null&&(e.memoizedState=s),s}function Ig(e){var s=Mg(e).next.queue;Pr(e,s,{},rs())}function pd(){return $t(ul)}function Ug(){return wt().memoizedState}function Lg(){return wt().memoizedState}function hv(e){for(var s=e.return;s!==null;){switch(s.tag){case 24:case 3:var a=rs();e=mn(a);var o=pn(s,e,a);o!==null&&(ls(o,s,a),Br(o,s,a)),s={cache:Gc()},e.payload=s;return}s=s.return}}function gv(e,s,a){var o=rs();a={lane:o,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null},Mi(e)?$g(s,a):(a=Uc(e,s,a,o),a!==null&&(ls(a,e,o),zg(a,s,o)))}function Hg(e,s,a){var o=rs();Pr(e,s,a,o)}function Pr(e,s,a,o){var u={lane:o,revertLane:0,action:a,hasEagerState:!1,eagerState:null,next:null};if(Mi(e))$g(s,u);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var y=s.lastRenderedState,v=g(y,a);if(u.hasEagerState=!0,u.eagerState=v,es(v,y))return yi(e,s,u,0),rt===null&&pi(),!1}catch{}finally{}if(a=Uc(e,s,u,o),a!==null)return ls(a,e,o),zg(a,s,o),!0}return!1}function yd(e,s,a,o){if(o={lane:2,revertLane:Qd(),action:o,hasEagerState:!1,eagerState:null,next:null},Mi(e)){if(s)throw Error(i(479))}else s=Uc(e,a,o,2),s!==null&&ls(s,e,2)}function Mi(e){var s=e.alternate;return e===He||s!==null&&s===He}function $g(e,s){Fa=Di=!0;var a=e.pending;a===null?s.next=s:(s.next=a.next,a.next=s),e.pending=s}function zg(e,s,a){if((a&4194048)!==0){var o=s.lanes;o&=e.pendingLanes,a|=o,s.lanes=a,Wh(e,a)}}var Ii={readContext:$t,use:Ci,useCallback:yt,useContext:yt,useEffect:yt,useImperativeHandle:yt,useLayoutEffect:yt,useInsertionEffect:yt,useMemo:yt,useReducer:yt,useRef:yt,useState:yt,useDebugValue:yt,useDeferredValue:yt,useTransition:yt,useSyncExternalStore:yt,useId:yt,useHostTransitionStatus:yt,useFormState:yt,useActionState:yt,useOptimistic:yt,useMemoCache:yt,useCacheRefresh:yt},Bg={readContext:$t,use:Ci,useCallback:function(e,s){return Wt().memoizedState=[e,s===void 0?null:s],e},useContext:$t,useEffect:Ng,useImperativeHandle:function(e,s,a){a=a!=null?a.concat([e]):null,Oi(4194308,4,Dg.bind(null,s,e),a)},useLayoutEffect:function(e,s){return Oi(4194308,4,e,s)},useInsertionEffect:function(e,s){Oi(4,2,e,s)},useMemo:function(e,s){var a=Wt();s=s===void 0?null:s;var o=e();if(aa){Ie(!0);try{e()}finally{Ie(!1)}}return a.memoizedState=[o,s],o},useReducer:function(e,s,a){var o=Wt();if(a!==void 0){var u=a(s);if(aa){Ie(!0);try{a(s)}finally{Ie(!1)}}}else u=s;return o.memoizedState=o.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},o.queue=e,e=e.dispatch=gv.bind(null,He,e),[o.memoizedState,e]},useRef:function(e){var s=Wt();return e={current:e},s.memoizedState=e},useState:function(e){e=ud(e);var s=e.queue,a=Hg.bind(null,He,s);return s.dispatch=a,[e.memoizedState,a]},useDebugValue:gd,useDeferredValue:function(e,s){var a=Wt();return fd(a,e,s)},useTransition:function(){var e=ud(!1);return e=Og.bind(null,He,e.queue,!0,!1),Wt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,s,a){var o=He,u=Wt();if(We){if(a===void 0)throw Error(i(407));a=a()}else{if(a=s(),rt===null)throw Error(i(349));(qe&124)!==0||og(o,s,a)}u.memoizedState=a;var g={value:a,getSnapshot:s};return u.queue=g,Ng(dg.bind(null,o,g,e),[e]),o.flags|=2048,Ya(9,Ri(),cg.bind(null,o,g,a,s),null),a},useId:function(){var e=Wt(),s=rt.identifierPrefix;if(We){var a=qs,o=Ys;a=(o&~(1<<32-Je(o)-1)).toString(32)+a,s=""+s+"R"+a,a=Ei++,0<a&&(s+="H"+a.toString(32)),s+=""}else a=iv++,s=""+s+"r"+a.toString(32)+"";return e.memoizedState=s},useHostTransitionStatus:pd,useFormState:bg,useActionState:bg,useOptimistic:function(e){var s=Wt();s.memoizedState=s.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=a,s=yd.bind(null,He,!0,a),a.dispatch=s,[e,s]},useMemoCache:od,useCacheRefresh:function(){return Wt().memoizedState=hv.bind(null,He)}},Fg={readContext:$t,use:Ci,useCallback:Cg,useContext:$t,useEffect:jg,useImperativeHandle:Eg,useInsertionEffect:Tg,useLayoutEffect:Sg,useMemo:Ag,useReducer:Ai,useRef:_g,useState:function(){return Ai(Ws)},useDebugValue:gd,useDeferredValue:function(e,s){var a=wt();return Rg(a,et.memoizedState,e,s)},useTransition:function(){var e=Ai(Ws)[0],s=wt().memoizedState;return[typeof e=="boolean"?e:qr(e),s]},useSyncExternalStore:ig,useId:Ug,useHostTransitionStatus:pd,useFormState:vg,useActionState:vg,useOptimistic:function(e,s){var a=wt();return gg(a,et,e,s)},useMemoCache:od,useCacheRefresh:Lg},fv={readContext:$t,use:Ci,useCallback:Cg,useContext:$t,useEffect:jg,useImperativeHandle:Eg,useInsertionEffect:Tg,useLayoutEffect:Sg,useMemo:Ag,useReducer:dd,useRef:_g,useState:function(){return dd(Ws)},useDebugValue:gd,useDeferredValue:function(e,s){var a=wt();return et===null?fd(a,e,s):Rg(a,et.memoizedState,e,s)},useTransition:function(){var e=dd(Ws)[0],s=wt().memoizedState;return[typeof e=="boolean"?e:qr(e),s]},useSyncExternalStore:ig,useId:Ug,useHostTransitionStatus:pd,useFormState:kg,useActionState:kg,useOptimistic:function(e,s){var a=wt();return et!==null?gg(a,et,e,s):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:od,useCacheRefresh:Lg},qa=null,Wr=0;function Ui(e){var s=Wr;return Wr+=1,qa===null&&(qa=[]),J0(qa,e,s)}function Qr(e,s){s=s.props.ref,e.ref=s!==void 0?s:null}function Li(e,s){throw s.$$typeof===b?Error(i(525)):(e=Object.prototype.toString.call(s),Error(i(31,e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)))}function Vg(e){var s=e._init;return s(e._payload)}function Yg(e){function s(B,L){if(e){var Y=B.deletions;Y===null?(B.deletions=[L],B.flags|=16):Y.push(L)}}function a(B,L){if(!e)return null;for(;L!==null;)s(B,L),L=L.sibling;return null}function o(B){for(var L=new Map;B!==null;)B.key!==null?L.set(B.key,B):L.set(B.index,B),B=B.sibling;return L}function u(B,L){return B=Vs(B,L),B.index=0,B.sibling=null,B}function g(B,L,Y){return B.index=Y,e?(Y=B.alternate,Y!==null?(Y=Y.index,Y<L?(B.flags|=67108866,L):Y):(B.flags|=67108866,L)):(B.flags|=1048576,L)}function y(B){return e&&B.alternate===null&&(B.flags|=67108866),B}function v(B,L,Y,ne){return L===null||L.tag!==6?(L=Hc(Y,B.mode,ne),L.return=B,L):(L=u(L,Y),L.return=B,L)}function S(B,L,Y,ne){var ve=Y.type;return ve===T?se(B,L,Y.props.children,ne,Y.key):L!==null&&(L.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===J&&Vg(ve)===L.type)?(L=u(L,Y.props),Qr(L,Y),L.return=B,L):(L=bi(Y.type,Y.key,Y.props,null,B.mode,ne),Qr(L,Y),L.return=B,L)}function G(B,L,Y,ne){return L===null||L.tag!==4||L.stateNode.containerInfo!==Y.containerInfo||L.stateNode.implementation!==Y.implementation?(L=$c(Y,B.mode,ne),L.return=B,L):(L=u(L,Y.children||[]),L.return=B,L)}function se(B,L,Y,ne,ve){return L===null||L.tag!==7?(L=Xn(Y,B.mode,ne,ve),L.return=B,L):(L=u(L,Y),L.return=B,L)}function re(B,L,Y){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return L=Hc(""+L,B.mode,Y),L.return=B,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case w:return Y=bi(L.type,L.key,L.props,null,B.mode,Y),Qr(Y,L),Y.return=B,Y;case C:return L=$c(L,B.mode,Y),L.return=B,L;case J:var ne=L._init;return L=ne(L._payload),re(B,L,Y)}if(Ue(L)||ye(L))return L=Xn(L,B.mode,Y,null),L.return=B,L;if(typeof L.then=="function")return re(B,Ui(L),Y);if(L.$$typeof===D)return re(B,_i(B,L),Y);Li(B,L)}return null}function Q(B,L,Y,ne){var ve=L!==null?L.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return ve!==null?null:v(B,L,""+Y,ne);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case w:return Y.key===ve?S(B,L,Y,ne):null;case C:return Y.key===ve?G(B,L,Y,ne):null;case J:return ve=Y._init,Y=ve(Y._payload),Q(B,L,Y,ne)}if(Ue(Y)||ye(Y))return ve!==null?null:se(B,L,Y,ne,null);if(typeof Y.then=="function")return Q(B,L,Ui(Y),ne);if(Y.$$typeof===D)return Q(B,L,_i(B,Y),ne);Li(B,Y)}return null}function X(B,L,Y,ne,ve){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return B=B.get(Y)||null,v(L,B,""+ne,ve);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case w:return B=B.get(ne.key===null?Y:ne.key)||null,S(L,B,ne,ve);case C:return B=B.get(ne.key===null?Y:ne.key)||null,G(L,B,ne,ve);case J:var $e=ne._init;return ne=$e(ne._payload),X(B,L,Y,ne,ve)}if(Ue(ne)||ye(ne))return B=B.get(Y)||null,se(L,B,ne,ve,null);if(typeof ne.then=="function")return X(B,L,Y,Ui(ne),ve);if(ne.$$typeof===D)return X(B,L,Y,_i(L,ne),ve);Li(L,ne)}return null}function Me(B,L,Y,ne){for(var ve=null,$e=null,_e=L,Ee=L=0,Ct=null;_e!==null&&Ee<Y.length;Ee++){_e.index>Ee?(Ct=_e,_e=null):Ct=_e.sibling;var Ge=Q(B,_e,Y[Ee],ne);if(Ge===null){_e===null&&(_e=Ct);break}e&&_e&&Ge.alternate===null&&s(B,_e),L=g(Ge,L,Ee),$e===null?ve=Ge:$e.sibling=Ge,$e=Ge,_e=Ct}if(Ee===Y.length)return a(B,_e),We&&Zn(B,Ee),ve;if(_e===null){for(;Ee<Y.length;Ee++)_e=re(B,Y[Ee],ne),_e!==null&&(L=g(_e,L,Ee),$e===null?ve=_e:$e.sibling=_e,$e=_e);return We&&Zn(B,Ee),ve}for(_e=o(_e);Ee<Y.length;Ee++)Ct=X(_e,B,Ee,Y[Ee],ne),Ct!==null&&(e&&Ct.alternate!==null&&_e.delete(Ct.key===null?Ee:Ct.key),L=g(Ct,L,Ee),$e===null?ve=Ct:$e.sibling=Ct,$e=Ct);return e&&_e.forEach(function(On){return s(B,On)}),We&&Zn(B,Ee),ve}function De(B,L,Y,ne){if(Y==null)throw Error(i(151));for(var ve=null,$e=null,_e=L,Ee=L=0,Ct=null,Ge=Y.next();_e!==null&&!Ge.done;Ee++,Ge=Y.next()){_e.index>Ee?(Ct=_e,_e=null):Ct=_e.sibling;var On=Q(B,_e,Ge.value,ne);if(On===null){_e===null&&(_e=Ct);break}e&&_e&&On.alternate===null&&s(B,_e),L=g(On,L,Ee),$e===null?ve=On:$e.sibling=On,$e=On,_e=Ct}if(Ge.done)return a(B,_e),We&&Zn(B,Ee),ve;if(_e===null){for(;!Ge.done;Ee++,Ge=Y.next())Ge=re(B,Ge.value,ne),Ge!==null&&(L=g(Ge,L,Ee),$e===null?ve=Ge:$e.sibling=Ge,$e=Ge);return We&&Zn(B,Ee),ve}for(_e=o(_e);!Ge.done;Ee++,Ge=Y.next())Ge=X(_e,B,Ee,Ge.value,ne),Ge!==null&&(e&&Ge.alternate!==null&&_e.delete(Ge.key===null?Ee:Ge.key),L=g(Ge,L,Ee),$e===null?ve=Ge:$e.sibling=Ge,$e=Ge);return e&&_e.forEach(function(mw){return s(B,mw)}),We&&Zn(B,Ee),ve}function st(B,L,Y,ne){if(typeof Y=="object"&&Y!==null&&Y.type===T&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case w:e:{for(var ve=Y.key;L!==null;){if(L.key===ve){if(ve=Y.type,ve===T){if(L.tag===7){a(B,L.sibling),ne=u(L,Y.props.children),ne.return=B,B=ne;break e}}else if(L.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===J&&Vg(ve)===L.type){a(B,L.sibling),ne=u(L,Y.props),Qr(ne,Y),ne.return=B,B=ne;break e}a(B,L);break}else s(B,L);L=L.sibling}Y.type===T?(ne=Xn(Y.props.children,B.mode,ne,Y.key),ne.return=B,B=ne):(ne=bi(Y.type,Y.key,Y.props,null,B.mode,ne),Qr(ne,Y),ne.return=B,B=ne)}return y(B);case C:e:{for(ve=Y.key;L!==null;){if(L.key===ve)if(L.tag===4&&L.stateNode.containerInfo===Y.containerInfo&&L.stateNode.implementation===Y.implementation){a(B,L.sibling),ne=u(L,Y.children||[]),ne.return=B,B=ne;break e}else{a(B,L);break}else s(B,L);L=L.sibling}ne=$c(Y,B.mode,ne),ne.return=B,B=ne}return y(B);case J:return ve=Y._init,Y=ve(Y._payload),st(B,L,Y,ne)}if(Ue(Y))return Me(B,L,Y,ne);if(ye(Y)){if(ve=ye(Y),typeof ve!="function")throw Error(i(150));return Y=ve.call(Y),De(B,L,Y,ne)}if(typeof Y.then=="function")return st(B,L,Ui(Y),ne);if(Y.$$typeof===D)return st(B,L,_i(B,Y),ne);Li(B,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,L!==null&&L.tag===6?(a(B,L.sibling),ne=u(L,Y),ne.return=B,B=ne):(a(B,L),ne=Hc(Y,B.mode,ne),ne.return=B,B=ne),y(B)):a(B,L)}return function(B,L,Y,ne){try{Wr=0;var ve=st(B,L,Y,ne);return qa=null,ve}catch(_e){if(_e===$r||_e===ji)throw _e;var $e=ts(29,_e,null,B.mode);return $e.lanes=ne,$e.return=B,$e}finally{}}}var Ga=Yg(!0),qg=Yg(!1),ms=A(null),As=null;function xn(e){var s=e.alternate;H(_t,_t.current&1),H(ms,e),As===null&&(s===null||Ba.current!==null||s.memoizedState!==null)&&(As=e)}function Gg(e){if(e.tag===22){if(H(_t,_t.current),H(ms,e),As===null){var s=e.alternate;s!==null&&s.memoizedState!==null&&(As=e)}}else bn()}function bn(){H(_t,_t.current),H(ms,ms.current)}function Qs(e){_(ms),As===e&&(As=null),_(_t)}var _t=A(0);function Hi(e){for(var s=e;s!==null;){if(s.tag===13){var a=s.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||iu(a)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function xd(e,s,a,o){s=e.memoizedState,a=a(o,s),a=a==null?s:x({},s,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var bd={enqueueSetState:function(e,s,a){e=e._reactInternals;var o=rs(),u=mn(o);u.payload=s,a!=null&&(u.callback=a),s=pn(e,u,o),s!==null&&(ls(s,e,o),Br(s,e,o))},enqueueReplaceState:function(e,s,a){e=e._reactInternals;var o=rs(),u=mn(o);u.tag=1,u.payload=s,a!=null&&(u.callback=a),s=pn(e,u,o),s!==null&&(ls(s,e,o),Br(s,e,o))},enqueueForceUpdate:function(e,s){e=e._reactInternals;var a=rs(),o=mn(a);o.tag=2,s!=null&&(o.callback=s),s=pn(e,o,a),s!==null&&(ls(s,e,a),Br(s,e,a))}};function Pg(e,s,a,o,u,g,y){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,g,y):s.prototype&&s.prototype.isPureReactComponent?!Ar(a,o)||!Ar(u,g):!0}function Wg(e,s,a,o){e=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(a,o),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(a,o),s.state!==e&&bd.enqueueReplaceState(s,s.state,null)}function ra(e,s){var a=s;if("ref"in s){a={};for(var o in s)o!=="ref"&&(a[o]=s[o])}if(e=e.defaultProps){a===s&&(a=x({},a));for(var u in e)a[u]===void 0&&(a[u]=e[u])}return a}var $i=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)};function Qg(e){$i(e)}function Xg(e){console.error(e)}function Kg(e){$i(e)}function zi(e,s){try{var a=e.onUncaughtError;a(s.value,{componentStack:s.stack})}catch(o){setTimeout(function(){throw o})}}function Zg(e,s,a){try{var o=e.onCaughtError;o(a.value,{componentStack:a.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function vd(e,s,a){return a=mn(a),a.tag=3,a.payload={element:null},a.callback=function(){zi(e,s)},a}function Jg(e){return e=mn(e),e.tag=3,e}function ef(e,s,a,o){var u=a.type.getDerivedStateFromError;if(typeof u=="function"){var g=o.value;e.payload=function(){return u(g)},e.callback=function(){Zg(s,a,o)}}var y=a.stateNode;y!==null&&typeof y.componentDidCatch=="function"&&(e.callback=function(){Zg(s,a,o),typeof u!="function"&&(jn===null?jn=new Set([this]):jn.add(this));var v=o.stack;this.componentDidCatch(o.value,{componentStack:v!==null?v:""})})}function mv(e,s,a,o,u){if(a.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(s=a.alternate,s!==null&&Ur(s,a,u,!0),a=ms.current,a!==null){switch(a.tag){case 13:return As===null?Yd():a.alternate===null&&ft===0&&(ft=3),a.flags&=-257,a.flags|=65536,a.lanes=u,o===Qc?a.flags|=16384:(s=a.updateQueue,s===null?a.updateQueue=new Set([o]):s.add(o),Gd(e,o,u)),!1;case 22:return a.flags|=65536,o===Qc?a.flags|=16384:(s=a.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([o])},a.updateQueue=s):(a=s.retryQueue,a===null?s.retryQueue=new Set([o]):a.add(o)),Gd(e,o,u)),!1}throw Error(i(435,a.tag))}return Gd(e,o,u),Yd(),!1}if(We)return s=ms.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=u,o!==Fc&&(e=Error(i(422),{cause:o}),Ir(us(e,a)))):(o!==Fc&&(s=Error(i(423),{cause:o}),Ir(us(s,a))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,o=us(o,a),u=vd(e.stateNode,o,u),Zc(e,u),ft!==4&&(ft=2)),!1;var g=Error(i(520),{cause:o});if(g=us(g,a),sl===null?sl=[g]:sl.push(g),ft!==4&&(ft=2),s===null)return!0;o=us(o,a),a=s;do{switch(a.tag){case 3:return a.flags|=65536,e=u&-u,a.lanes|=e,e=vd(a.stateNode,o,e),Zc(a,e),!1;case 1:if(s=a.type,g=a.stateNode,(a.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(jn===null||!jn.has(g))))return a.flags|=65536,u&=-u,a.lanes|=u,u=Jg(u),ef(u,e,a,o),Zc(a,u),!1}a=a.return}while(a!==null);return!1}var tf=Error(i(461)),Dt=!1;function It(e,s,a,o){s.child=e===null?qg(s,null,a,o):Ga(s,e.child,a,o)}function sf(e,s,a,o,u){a=a.render;var g=s.ref;if("ref"in o){var y={};for(var v in o)v!=="ref"&&(y[v]=o[v])}else y=o;return sa(s),o=nd(e,s,a,y,g,u),v=ad(),e!==null&&!Dt?(rd(e,s,u),Xs(e,s,u)):(We&&v&&zc(s),s.flags|=1,It(e,s,o,u),s.child)}function nf(e,s,a,o,u){if(e===null){var g=a.type;return typeof g=="function"&&!Lc(g)&&g.defaultProps===void 0&&a.compare===null?(s.tag=15,s.type=g,af(e,s,g,o,u)):(e=bi(a.type,null,o,s,s.mode,u),e.ref=s.ref,e.return=s,s.child=e)}if(g=e.child,!Dd(e,u)){var y=g.memoizedProps;if(a=a.compare,a=a!==null?a:Ar,a(y,o)&&e.ref===s.ref)return Xs(e,s,u)}return s.flags|=1,e=Vs(g,o),e.ref=s.ref,e.return=s,s.child=e}function af(e,s,a,o,u){if(e!==null){var g=e.memoizedProps;if(Ar(g,o)&&e.ref===s.ref)if(Dt=!1,s.pendingProps=o=g,Dd(e,u))(e.flags&131072)!==0&&(Dt=!0);else return s.lanes=e.lanes,Xs(e,s,u)}return wd(e,s,a,o,u)}function rf(e,s,a){var o=s.pendingProps,u=o.children,g=e!==null?e.memoizedState:null;if(o.mode==="hidden"){if((s.flags&128)!==0){if(o=g!==null?g.baseLanes|a:a,e!==null){for(u=s.child=e.child,g=0;u!==null;)g=g|u.lanes|u.childLanes,u=u.sibling;s.childLanes=g&~o}else s.childLanes=0,s.child=null;return lf(e,s,o,a)}if((a&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},e!==null&&Ni(s,g!==null?g.cachePool:null),g!==null?ag(s,g):ed(),Gg(s);else return s.lanes=s.childLanes=536870912,lf(e,s,g!==null?g.baseLanes|a:a,a)}else g!==null?(Ni(s,g.cachePool),ag(s,g),bn(),s.memoizedState=null):(e!==null&&Ni(s,null),ed(),bn());return It(e,s,u,a),s.child}function lf(e,s,a,o){var u=Wc();return u=u===null?null:{parent:kt._currentValue,pool:u},s.memoizedState={baseLanes:a,cachePool:u},e!==null&&Ni(s,null),ed(),Gg(s),e!==null&&Ur(e,s,o,!0),null}function Bi(e,s){var a=s.ref;if(a===null)e!==null&&e.ref!==null&&(s.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(i(284));(e===null||e.ref!==a)&&(s.flags|=4194816)}}function wd(e,s,a,o,u){return sa(s),a=nd(e,s,a,o,void 0,u),o=ad(),e!==null&&!Dt?(rd(e,s,u),Xs(e,s,u)):(We&&o&&zc(s),s.flags|=1,It(e,s,a,u),s.child)}function of(e,s,a,o,u,g){return sa(s),s.updateQueue=null,a=lg(s,o,a,u),rg(e),o=ad(),e!==null&&!Dt?(rd(e,s,g),Xs(e,s,g)):(We&&o&&zc(s),s.flags|=1,It(e,s,a,g),s.child)}function cf(e,s,a,o,u){if(sa(s),s.stateNode===null){var g=Ua,y=a.contextType;typeof y=="object"&&y!==null&&(g=$t(y)),g=new a(o,g),s.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=bd,s.stateNode=g,g._reactInternals=s,g=s.stateNode,g.props=o,g.state=s.memoizedState,g.refs={},Xc(s),y=a.contextType,g.context=typeof y=="object"&&y!==null?$t(y):Ua,g.state=s.memoizedState,y=a.getDerivedStateFromProps,typeof y=="function"&&(xd(s,a,y,o),g.state=s.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(y=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),y!==g.state&&bd.enqueueReplaceState(g,g.state,null),Vr(s,o,g,u),Fr(),g.state=s.memoizedState),typeof g.componentDidMount=="function"&&(s.flags|=4194308),o=!0}else if(e===null){g=s.stateNode;var v=s.memoizedProps,S=ra(a,v);g.props=S;var G=g.context,se=a.contextType;y=Ua,typeof se=="object"&&se!==null&&(y=$t(se));var re=a.getDerivedStateFromProps;se=typeof re=="function"||typeof g.getSnapshotBeforeUpdate=="function",v=s.pendingProps!==v,se||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(v||G!==y)&&Wg(s,g,o,y),fn=!1;var Q=s.memoizedState;g.state=Q,Vr(s,o,g,u),Fr(),G=s.memoizedState,v||Q!==G||fn?(typeof re=="function"&&(xd(s,a,re,o),G=s.memoizedState),(S=fn||Pg(s,a,S,o,Q,G,y))?(se||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(s.flags|=4194308)):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=o,s.memoizedState=G),g.props=o,g.state=G,g.context=y,o=S):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),o=!1)}else{g=s.stateNode,Kc(e,s),y=s.memoizedProps,se=ra(a,y),g.props=se,re=s.pendingProps,Q=g.context,G=a.contextType,S=Ua,typeof G=="object"&&G!==null&&(S=$t(G)),v=a.getDerivedStateFromProps,(G=typeof v=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(y!==re||Q!==S)&&Wg(s,g,o,S),fn=!1,Q=s.memoizedState,g.state=Q,Vr(s,o,g,u),Fr();var X=s.memoizedState;y!==re||Q!==X||fn||e!==null&&e.dependencies!==null&&ki(e.dependencies)?(typeof v=="function"&&(xd(s,a,v,o),X=s.memoizedState),(se=fn||Pg(s,a,se,o,Q,X,S)||e!==null&&e.dependencies!==null&&ki(e.dependencies))?(G||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(o,X,S),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(o,X,S)),typeof g.componentDidUpdate=="function"&&(s.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof g.componentDidUpdate!="function"||y===e.memoizedProps&&Q===e.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&Q===e.memoizedState||(s.flags|=1024),s.memoizedProps=o,s.memoizedState=X),g.props=o,g.state=X,g.context=S,o=se):(typeof g.componentDidUpdate!="function"||y===e.memoizedProps&&Q===e.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||y===e.memoizedProps&&Q===e.memoizedState||(s.flags|=1024),o=!1)}return g=o,Bi(e,s),o=(s.flags&128)!==0,g||o?(g=s.stateNode,a=o&&typeof a.getDerivedStateFromError!="function"?null:g.render(),s.flags|=1,e!==null&&o?(s.child=Ga(s,e.child,null,u),s.child=Ga(s,null,a,u)):It(e,s,a,u),s.memoizedState=g.state,e=s.child):e=Xs(e,s,u),e}function df(e,s,a,o){return Mr(),s.flags|=256,It(e,s,a,o),s.child}var kd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _d(e){return{baseLanes:e,cachePool:X0()}}function Nd(e,s,a){return e=e!==null?e.childLanes&~a:0,s&&(e|=ps),e}function uf(e,s,a){var o=s.pendingProps,u=!1,g=(s.flags&128)!==0,y;if((y=g)||(y=e!==null&&e.memoizedState===null?!1:(_t.current&2)!==0),y&&(u=!0,s.flags&=-129),y=(s.flags&32)!==0,s.flags&=-33,e===null){if(We){if(u?xn(s):bn(),We){var v=gt,S;if(S=v){e:{for(S=v,v=Cs;S.nodeType!==8;){if(!v){v=null;break e}if(S=_s(S.nextSibling),S===null){v=null;break e}}v=S}v!==null?(s.memoizedState={dehydrated:v,treeContext:Kn!==null?{id:Ys,overflow:qs}:null,retryLane:536870912,hydrationErrors:null},S=ts(18,null,null,0),S.stateNode=v,S.return=s,s.child=S,Vt=s,gt=null,S=!0):S=!1}S||ea(s)}if(v=s.memoizedState,v!==null&&(v=v.dehydrated,v!==null))return iu(v)?s.lanes=32:s.lanes=536870912,null;Qs(s)}return v=o.children,o=o.fallback,u?(bn(),u=s.mode,v=Fi({mode:"hidden",children:v},u),o=Xn(o,u,a,null),v.return=s,o.return=s,v.sibling=o,s.child=v,u=s.child,u.memoizedState=_d(a),u.childLanes=Nd(e,y,a),s.memoizedState=kd,o):(xn(s),jd(s,v))}if(S=e.memoizedState,S!==null&&(v=S.dehydrated,v!==null)){if(g)s.flags&256?(xn(s),s.flags&=-257,s=Td(e,s,a)):s.memoizedState!==null?(bn(),s.child=e.child,s.flags|=128,s=null):(bn(),u=o.fallback,v=s.mode,o=Fi({mode:"visible",children:o.children},v),u=Xn(u,v,a,null),u.flags|=2,o.return=s,u.return=s,o.sibling=u,s.child=o,Ga(s,e.child,null,a),o=s.child,o.memoizedState=_d(a),o.childLanes=Nd(e,y,a),s.memoizedState=kd,s=u);else if(xn(s),iu(v)){if(y=v.nextSibling&&v.nextSibling.dataset,y)var G=y.dgst;y=G,o=Error(i(419)),o.stack="",o.digest=y,Ir({value:o,source:null,stack:null}),s=Td(e,s,a)}else if(Dt||Ur(e,s,a,!1),y=(a&e.childLanes)!==0,Dt||y){if(y=rt,y!==null&&(o=a&-a,o=(o&42)!==0?1:oc(o),o=(o&(y.suspendedLanes|a))!==0?0:o,o!==0&&o!==S.retryLane))throw S.retryLane=o,Ia(e,o),ls(y,e,o),tf;v.data==="$?"||Yd(),s=Td(e,s,a)}else v.data==="$?"?(s.flags|=192,s.child=e.child,s=null):(e=S.treeContext,gt=_s(v.nextSibling),Vt=s,We=!0,Jn=null,Cs=!1,e!==null&&(gs[fs++]=Ys,gs[fs++]=qs,gs[fs++]=Kn,Ys=e.id,qs=e.overflow,Kn=s),s=jd(s,o.children),s.flags|=4096);return s}return u?(bn(),u=o.fallback,v=s.mode,S=e.child,G=S.sibling,o=Vs(S,{mode:"hidden",children:o.children}),o.subtreeFlags=S.subtreeFlags&65011712,G!==null?u=Vs(G,u):(u=Xn(u,v,a,null),u.flags|=2),u.return=s,o.return=s,o.sibling=u,s.child=o,o=u,u=s.child,v=e.child.memoizedState,v===null?v=_d(a):(S=v.cachePool,S!==null?(G=kt._currentValue,S=S.parent!==G?{parent:G,pool:G}:S):S=X0(),v={baseLanes:v.baseLanes|a,cachePool:S}),u.memoizedState=v,u.childLanes=Nd(e,y,a),s.memoizedState=kd,o):(xn(s),a=e.child,e=a.sibling,a=Vs(a,{mode:"visible",children:o.children}),a.return=s,a.sibling=null,e!==null&&(y=s.deletions,y===null?(s.deletions=[e],s.flags|=16):y.push(e)),s.child=a,s.memoizedState=null,a)}function jd(e,s){return s=Fi({mode:"visible",children:s},e.mode),s.return=e,e.child=s}function Fi(e,s){return e=ts(22,e,null,s),e.lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Td(e,s,a){return Ga(s,e.child,null,a),e=jd(s,s.pendingProps.children),e.flags|=2,s.memoizedState=null,e}function hf(e,s,a){e.lanes|=s;var o=e.alternate;o!==null&&(o.lanes|=s),Yc(e.return,s,a)}function Sd(e,s,a,o,u){var g=e.memoizedState;g===null?e.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:u}:(g.isBackwards=s,g.rendering=null,g.renderingStartTime=0,g.last=o,g.tail=a,g.tailMode=u)}function gf(e,s,a){var o=s.pendingProps,u=o.revealOrder,g=o.tail;if(It(e,s,o.children,a),o=_t.current,(o&2)!==0)o=o&1|2,s.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=s.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&hf(e,a,s);else if(e.tag===19)hf(e,a,s);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break e;for(;e.sibling===null;){if(e.return===null||e.return===s)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(H(_t,o),u){case"forwards":for(a=s.child,u=null;a!==null;)e=a.alternate,e!==null&&Hi(e)===null&&(u=a),a=a.sibling;a=u,a===null?(u=s.child,s.child=null):(u=a.sibling,a.sibling=null),Sd(s,!1,u,a,g);break;case"backwards":for(a=null,u=s.child,s.child=null;u!==null;){if(e=u.alternate,e!==null&&Hi(e)===null){s.child=u;break}e=u.sibling,u.sibling=a,a=u,u=e}Sd(s,!0,a,null,g);break;case"together":Sd(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Xs(e,s,a){if(e!==null&&(s.dependencies=e.dependencies),Nn|=s.lanes,(a&s.childLanes)===0)if(e!==null){if(Ur(e,s,a,!1),(a&s.childLanes)===0)return null}else return null;if(e!==null&&s.child!==e.child)throw Error(i(153));if(s.child!==null){for(e=s.child,a=Vs(e,e.pendingProps),s.child=a,a.return=s;e.sibling!==null;)e=e.sibling,a=a.sibling=Vs(e,e.pendingProps),a.return=s;a.sibling=null}return s.child}function Dd(e,s){return(e.lanes&s)!==0?!0:(e=e.dependencies,!!(e!==null&&ki(e)))}function pv(e,s,a){switch(s.tag){case 3:be(s,s.stateNode.containerInfo),gn(s,kt,e.memoizedState.cache),Mr();break;case 27:case 5:Le(s);break;case 4:be(s,s.stateNode.containerInfo);break;case 10:gn(s,s.type,s.memoizedProps.value);break;case 13:var o=s.memoizedState;if(o!==null)return o.dehydrated!==null?(xn(s),s.flags|=128,null):(a&s.child.childLanes)!==0?uf(e,s,a):(xn(s),e=Xs(e,s,a),e!==null?e.sibling:null);xn(s);break;case 19:var u=(e.flags&128)!==0;if(o=(a&s.childLanes)!==0,o||(Ur(e,s,a,!1),o=(a&s.childLanes)!==0),u){if(o)return gf(e,s,a);s.flags|=128}if(u=s.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),H(_t,_t.current),o)break;return null;case 22:case 23:return s.lanes=0,rf(e,s,a);case 24:gn(s,kt,e.memoizedState.cache)}return Xs(e,s,a)}function ff(e,s,a){if(e!==null)if(e.memoizedProps!==s.pendingProps)Dt=!0;else{if(!Dd(e,a)&&(s.flags&128)===0)return Dt=!1,pv(e,s,a);Dt=(e.flags&131072)!==0}else Dt=!1,We&&(s.flags&1048576)!==0&&V0(s,wi,s.index);switch(s.lanes=0,s.tag){case 16:e:{e=s.pendingProps;var o=s.elementType,u=o._init;if(o=u(o._payload),s.type=o,typeof o=="function")Lc(o)?(e=ra(o,e),s.tag=1,s=cf(null,s,o,e,a)):(s.tag=0,s=wd(null,s,o,e,a));else{if(o!=null){if(u=o.$$typeof,u===E){s.tag=11,s=sf(null,s,o,e,a);break e}else if(u===$){s.tag=14,s=nf(null,s,o,e,a);break e}}throw s=Re(o)||o,Error(i(306,s,""))}}return s;case 0:return wd(e,s,s.type,s.pendingProps,a);case 1:return o=s.type,u=ra(o,s.pendingProps),cf(e,s,o,u,a);case 3:e:{if(be(s,s.stateNode.containerInfo),e===null)throw Error(i(387));o=s.pendingProps;var g=s.memoizedState;u=g.element,Kc(e,s),Vr(s,o,null,a);var y=s.memoizedState;if(o=y.cache,gn(s,kt,o),o!==g.cache&&qc(s,[kt],a,!0),Fr(),o=y.element,g.isDehydrated)if(g={element:o,isDehydrated:!1,cache:y.cache},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){s=df(e,s,o,a);break e}else if(o!==u){u=us(Error(i(424)),s),Ir(u),s=df(e,s,o,a);break e}else{switch(e=s.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(gt=_s(e.firstChild),Vt=s,We=!0,Jn=null,Cs=!0,a=qg(s,null,o,a),s.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(Mr(),o===u){s=Xs(e,s,a);break e}It(e,s,o,a)}s=s.child}return s;case 26:return Bi(e,s),e===null?(a=xm(s.type,null,s.pendingProps,null))?s.memoizedState=a:We||(a=s.type,e=s.pendingProps,o=so(le.current).createElement(a),o[Ht]=s,o[Gt]=e,Lt(o,a,e),St(o),s.stateNode=o):s.memoizedState=xm(s.type,e.memoizedProps,s.pendingProps,e.memoizedState),null;case 27:return Le(s),e===null&&We&&(o=s.stateNode=mm(s.type,s.pendingProps,le.current),Vt=s,Cs=!0,u=gt,Dn(s.type)?(ou=u,gt=_s(o.firstChild)):gt=u),It(e,s,s.pendingProps.children,a),Bi(e,s),e===null&&(s.flags|=4194304),s.child;case 5:return e===null&&We&&((u=o=gt)&&(o=Yv(o,s.type,s.pendingProps,Cs),o!==null?(s.stateNode=o,Vt=s,gt=_s(o.firstChild),Cs=!1,u=!0):u=!1),u||ea(s)),Le(s),u=s.type,g=s.pendingProps,y=e!==null?e.memoizedProps:null,o=g.children,au(u,g)?o=null:y!==null&&au(u,y)&&(s.flags|=32),s.memoizedState!==null&&(u=nd(e,s,ov,null,null,a),ul._currentValue=u),Bi(e,s),It(e,s,o,a),s.child;case 6:return e===null&&We&&((e=a=gt)&&(a=qv(a,s.pendingProps,Cs),a!==null?(s.stateNode=a,Vt=s,gt=null,e=!0):e=!1),e||ea(s)),null;case 13:return uf(e,s,a);case 4:return be(s,s.stateNode.containerInfo),o=s.pendingProps,e===null?s.child=Ga(s,null,o,a):It(e,s,o,a),s.child;case 11:return sf(e,s,s.type,s.pendingProps,a);case 7:return It(e,s,s.pendingProps,a),s.child;case 8:return It(e,s,s.pendingProps.children,a),s.child;case 12:return It(e,s,s.pendingProps.children,a),s.child;case 10:return o=s.pendingProps,gn(s,s.type,o.value),It(e,s,o.children,a),s.child;case 9:return u=s.type._context,o=s.pendingProps.children,sa(s),u=$t(u),o=o(u),s.flags|=1,It(e,s,o,a),s.child;case 14:return nf(e,s,s.type,s.pendingProps,a);case 15:return af(e,s,s.type,s.pendingProps,a);case 19:return gf(e,s,a);case 31:return o=s.pendingProps,a=s.mode,o={mode:o.mode,children:o.children},e===null?(a=Fi(o,a),a.ref=s.ref,s.child=a,a.return=s,s=a):(a=Vs(e.child,o),a.ref=s.ref,s.child=a,a.return=s,s=a),s;case 22:return rf(e,s,a);case 24:return sa(s),o=$t(kt),e===null?(u=Wc(),u===null&&(u=rt,g=Gc(),u.pooledCache=g,g.refCount++,g!==null&&(u.pooledCacheLanes|=a),u=g),s.memoizedState={parent:o,cache:u},Xc(s),gn(s,kt,u)):((e.lanes&a)!==0&&(Kc(e,s),Vr(s,null,null,a),Fr()),u=e.memoizedState,g=s.memoizedState,u.parent!==o?(u={parent:o,cache:o},s.memoizedState=u,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=u),gn(s,kt,o)):(o=g.cache,gn(s,kt,o),o!==u.cache&&qc(s,[kt],a,!0))),It(e,s,s.pendingProps.children,a),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Ks(e){e.flags|=4}function mf(e,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!_m(s)){if(s=ms.current,s!==null&&((qe&4194048)===qe?As!==null:(qe&62914560)!==qe&&(qe&536870912)===0||s!==As))throw zr=Qc,K0;e.flags|=8192}}function Vi(e,s){s!==null&&(e.flags|=4),e.flags&16384&&(s=e.tag!==22?Gh():536870912,e.lanes|=s,Xa|=s)}function Xr(e,s){if(!We)switch(e.tailMode){case"hidden":s=e.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?s||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function ut(e){var s=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(s)for(var u=e.child;u!==null;)a|=u.lanes|u.childLanes,o|=u.subtreeFlags&65011712,o|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)a|=u.lanes|u.childLanes,o|=u.subtreeFlags,o|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=o,e.childLanes=a,s}function yv(e,s,a){var o=s.pendingProps;switch(Bc(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ut(s),null;case 1:return ut(s),null;case 3:return a=s.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),Ps(kt),Oe(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Or(s)?Ks(s):e===null||e.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,G0())),ut(s),null;case 26:return a=s.memoizedState,e===null?(Ks(s),a!==null?(ut(s),mf(s,a)):(ut(s),s.flags&=-16777217)):a?a!==e.memoizedState?(Ks(s),ut(s),mf(s,a)):(ut(s),s.flags&=-16777217):(e.memoizedProps!==o&&Ks(s),ut(s),s.flags&=-16777217),null;case 27:we(s),a=le.current;var u=s.type;if(e!==null&&s.stateNode!=null)e.memoizedProps!==o&&Ks(s);else{if(!o){if(s.stateNode===null)throw Error(i(166));return ut(s),null}e=U.current,Or(s)?Y0(s):(e=mm(u,o,a),s.stateNode=e,Ks(s))}return ut(s),null;case 5:if(we(s),a=s.type,e!==null&&s.stateNode!=null)e.memoizedProps!==o&&Ks(s);else{if(!o){if(s.stateNode===null)throw Error(i(166));return ut(s),null}if(e=U.current,Or(s))Y0(s);else{switch(u=so(le.current),e){case 1:e=u.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:e=u.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":e=u.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":e=u.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":e=u.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e=typeof o.is=="string"?u.createElement("select",{is:o.is}):u.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e=typeof o.is=="string"?u.createElement(a,{is:o.is}):u.createElement(a)}}e[Ht]=s,e[Gt]=o;e:for(u=s.child;u!==null;){if(u.tag===5||u.tag===6)e.appendChild(u.stateNode);else if(u.tag!==4&&u.tag!==27&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===s)break e;for(;u.sibling===null;){if(u.return===null||u.return===s)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}s.stateNode=e;e:switch(Lt(e,a,o),a){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Ks(s)}}return ut(s),s.flags&=-16777217,null;case 6:if(e&&s.stateNode!=null)e.memoizedProps!==o&&Ks(s);else{if(typeof o!="string"&&s.stateNode===null)throw Error(i(166));if(e=le.current,Or(s)){if(e=s.stateNode,a=s.memoizedProps,o=null,u=Vt,u!==null)switch(u.tag){case 27:case 5:o=u.memoizedProps}e[Ht]=s,e=!!(e.nodeValue===a||o!==null&&o.suppressHydrationWarning===!0||om(e.nodeValue,a)),e||ea(s)}else e=so(e).createTextNode(o),e[Ht]=s,s.stateNode=e}return ut(s),null;case 13:if(o=s.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=Or(s),o!==null&&o.dehydrated!==null){if(e===null){if(!u)throw Error(i(318));if(u=s.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(i(317));u[Ht]=s}else Mr(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;ut(s),u=!1}else u=G0(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return s.flags&256?(Qs(s),s):(Qs(s),null)}if(Qs(s),(s.flags&128)!==0)return s.lanes=a,s;if(a=o!==null,e=e!==null&&e.memoizedState!==null,a){o=s.child,u=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(u=o.alternate.memoizedState.cachePool.pool);var g=null;o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(g=o.memoizedState.cachePool.pool),g!==u&&(o.flags|=2048)}return a!==e&&a&&(s.child.flags|=8192),Vi(s,s.updateQueue),ut(s),null;case 4:return Oe(),e===null&&Jd(s.stateNode.containerInfo),ut(s),null;case 10:return Ps(s.type),ut(s),null;case 19:if(_(_t),u=s.memoizedState,u===null)return ut(s),null;if(o=(s.flags&128)!==0,g=u.rendering,g===null)if(o)Xr(u,!1);else{if(ft!==0||e!==null&&(e.flags&128)!==0)for(e=s.child;e!==null;){if(g=Hi(e),g!==null){for(s.flags|=128,Xr(u,!1),e=g.updateQueue,s.updateQueue=e,Vi(s,e),s.subtreeFlags=0,e=a,a=s.child;a!==null;)F0(a,e),a=a.sibling;return H(_t,_t.current&1|2),s.child}e=e.sibling}u.tail!==null&&q()>Gi&&(s.flags|=128,o=!0,Xr(u,!1),s.lanes=4194304)}else{if(!o)if(e=Hi(g),e!==null){if(s.flags|=128,o=!0,e=e.updateQueue,s.updateQueue=e,Vi(s,e),Xr(u,!0),u.tail===null&&u.tailMode==="hidden"&&!g.alternate&&!We)return ut(s),null}else 2*q()-u.renderingStartTime>Gi&&a!==536870912&&(s.flags|=128,o=!0,Xr(u,!1),s.lanes=4194304);u.isBackwards?(g.sibling=s.child,s.child=g):(e=u.last,e!==null?e.sibling=g:s.child=g,u.last=g)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=q(),s.sibling=null,e=_t.current,H(_t,o?e&1|2:e&1),s):(ut(s),null);case 22:case 23:return Qs(s),td(),o=s.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(s.flags|=8192):o&&(s.flags|=8192),o?(a&536870912)!==0&&(s.flags&128)===0&&(ut(s),s.subtreeFlags&6&&(s.flags|=8192)):ut(s),a=s.updateQueue,a!==null&&Vi(s,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),o=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(o=s.memoizedState.cachePool.pool),o!==a&&(s.flags|=2048),e!==null&&_(na),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),s.memoizedState.cache!==a&&(s.flags|=2048),Ps(kt),ut(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function xv(e,s){switch(Bc(s),s.tag){case 1:return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 3:return Ps(kt),Oe(),e=s.flags,(e&65536)!==0&&(e&128)===0?(s.flags=e&-65537|128,s):null;case 26:case 27:case 5:return we(s),null;case 13:if(Qs(s),e=s.memoizedState,e!==null&&e.dehydrated!==null){if(s.alternate===null)throw Error(i(340));Mr()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 19:return _(_t),null;case 4:return Oe(),null;case 10:return Ps(s.type),null;case 22:case 23:return Qs(s),td(),e!==null&&_(na),e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 24:return Ps(kt),null;case 25:return null;default:return null}}function pf(e,s){switch(Bc(s),s.tag){case 3:Ps(kt),Oe();break;case 26:case 27:case 5:we(s);break;case 4:Oe();break;case 13:Qs(s);break;case 19:_(_t);break;case 10:Ps(s.type);break;case 22:case 23:Qs(s),td(),e!==null&&_(na);break;case 24:Ps(kt)}}function Kr(e,s){try{var a=s.updateQueue,o=a!==null?a.lastEffect:null;if(o!==null){var u=o.next;a=u;do{if((a.tag&e)===e){o=void 0;var g=a.create,y=a.inst;o=g(),y.destroy=o}a=a.next}while(a!==u)}}catch(v){nt(s,s.return,v)}}function vn(e,s,a){try{var o=s.updateQueue,u=o!==null?o.lastEffect:null;if(u!==null){var g=u.next;o=g;do{if((o.tag&e)===e){var y=o.inst,v=y.destroy;if(v!==void 0){y.destroy=void 0,u=s;var S=a,G=v;try{G()}catch(se){nt(u,S,se)}}}o=o.next}while(o!==g)}}catch(se){nt(s,s.return,se)}}function yf(e){var s=e.updateQueue;if(s!==null){var a=e.stateNode;try{ng(s,a)}catch(o){nt(e,e.return,o)}}}function xf(e,s,a){a.props=ra(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(o){nt(e,s,o)}}function Zr(e,s){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof a=="function"?e.refCleanup=a(o):a.current=o}}catch(u){nt(e,s,u)}}function Rs(e,s){var a=e.ref,o=e.refCleanup;if(a!==null)if(typeof o=="function")try{o()}catch(u){nt(e,s,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(u){nt(e,s,u)}else a.current=null}function bf(e){var s=e.type,a=e.memoizedProps,o=e.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":a.autoFocus&&o.focus();break e;case"img":a.src?o.src=a.src:a.srcSet&&(o.srcset=a.srcSet)}}catch(u){nt(e,e.return,u)}}function Ed(e,s,a){try{var o=e.stateNode;$v(o,e.type,a,s),o[Gt]=s}catch(u){nt(e,e.return,u)}}function vf(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Dn(e.type)||e.tag===4}function Cd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||vf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Dn(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ad(e,s,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,s?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,s):(s=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,s.appendChild(e),a=a._reactRootContainer,a!=null||s.onclick!==null||(s.onclick=to));else if(o!==4&&(o===27&&Dn(e.type)&&(a=e.stateNode,s=null),e=e.child,e!==null))for(Ad(e,s,a),e=e.sibling;e!==null;)Ad(e,s,a),e=e.sibling}function Yi(e,s,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,s?a.insertBefore(e,s):a.appendChild(e);else if(o!==4&&(o===27&&Dn(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Yi(e,s,a),e=e.sibling;e!==null;)Yi(e,s,a),e=e.sibling}function wf(e){var s=e.stateNode,a=e.memoizedProps;try{for(var o=e.type,u=s.attributes;u.length;)s.removeAttributeNode(u[0]);Lt(s,o,a),s[Ht]=e,s[Gt]=a}catch(g){nt(e,e.return,g)}}var Zs=!1,xt=!1,Rd=!1,kf=typeof WeakSet=="function"?WeakSet:Set,Et=null;function bv(e,s){if(e=e.containerInfo,su=oo,e=R0(e),Cc(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var u=o.anchorOffset,g=o.focusNode;o=o.focusOffset;try{a.nodeType,g.nodeType}catch{a=null;break e}var y=0,v=-1,S=-1,G=0,se=0,re=e,Q=null;t:for(;;){for(var X;re!==a||u!==0&&re.nodeType!==3||(v=y+u),re!==g||o!==0&&re.nodeType!==3||(S=y+o),re.nodeType===3&&(y+=re.nodeValue.length),(X=re.firstChild)!==null;)Q=re,re=X;for(;;){if(re===e)break t;if(Q===a&&++G===u&&(v=y),Q===g&&++se===o&&(S=y),(X=re.nextSibling)!==null)break;re=Q,Q=re.parentNode}re=X}a=v===-1||S===-1?null:{start:v,end:S}}else a=null}a=a||{start:0,end:0}}else a=null;for(nu={focusedElem:e,selectionRange:a},oo=!1,Et=s;Et!==null;)if(s=Et,e=s.child,(s.subtreeFlags&1024)!==0&&e!==null)e.return=s,Et=e;else for(;Et!==null;){switch(s=Et,g=s.alternate,e=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,a=s,u=g.memoizedProps,g=g.memoizedState,o=a.stateNode;try{var Me=ra(a.type,u,a.elementType===a.type);e=o.getSnapshotBeforeUpdate(Me,g),o.__reactInternalSnapshotBeforeUpdate=e}catch(De){nt(a,a.return,De)}}break;case 3:if((e&1024)!==0){if(e=s.stateNode.containerInfo,a=e.nodeType,a===9)lu(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":lu(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(i(163))}if(e=s.sibling,e!==null){e.return=s.return,Et=e;break}Et=s.return}}function _f(e,s,a){var o=a.flags;switch(a.tag){case 0:case 11:case 15:wn(e,a),o&4&&Kr(5,a);break;case 1:if(wn(e,a),o&4)if(e=a.stateNode,s===null)try{e.componentDidMount()}catch(y){nt(a,a.return,y)}else{var u=ra(a.type,s.memoizedProps);s=s.memoizedState;try{e.componentDidUpdate(u,s,e.__reactInternalSnapshotBeforeUpdate)}catch(y){nt(a,a.return,y)}}o&64&&yf(a),o&512&&Zr(a,a.return);break;case 3:if(wn(e,a),o&64&&(e=a.updateQueue,e!==null)){if(s=null,a.child!==null)switch(a.child.tag){case 27:case 5:s=a.child.stateNode;break;case 1:s=a.child.stateNode}try{ng(e,s)}catch(y){nt(a,a.return,y)}}break;case 27:s===null&&o&4&&wf(a);case 26:case 5:wn(e,a),s===null&&o&4&&bf(a),o&512&&Zr(a,a.return);break;case 12:wn(e,a);break;case 13:wn(e,a),o&4&&Tf(e,a),o&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Dv.bind(null,a),Gv(e,a))));break;case 22:if(o=a.memoizedState!==null||Zs,!o){s=s!==null&&s.memoizedState!==null||xt,u=Zs;var g=xt;Zs=o,(xt=s)&&!g?kn(e,a,(a.subtreeFlags&8772)!==0):wn(e,a),Zs=u,xt=g}break;case 30:break;default:wn(e,a)}}function Nf(e){var s=e.alternate;s!==null&&(e.alternate=null,Nf(s)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(s=e.stateNode,s!==null&&uc(s)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var dt=null,Qt=!1;function Js(e,s,a){for(a=a.child;a!==null;)jf(e,s,a),a=a.sibling}function jf(e,s,a){if(xe&&typeof xe.onCommitFiberUnmount=="function")try{xe.onCommitFiberUnmount(he,a)}catch{}switch(a.tag){case 26:xt||Rs(a,s),Js(e,s,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:xt||Rs(a,s);var o=dt,u=Qt;Dn(a.type)&&(dt=a.stateNode,Qt=!1),Js(e,s,a),il(a.stateNode),dt=o,Qt=u;break;case 5:xt||Rs(a,s);case 6:if(o=dt,u=Qt,dt=null,Js(e,s,a),dt=o,Qt=u,dt!==null)if(Qt)try{(dt.nodeType===9?dt.body:dt.nodeName==="HTML"?dt.ownerDocument.body:dt).removeChild(a.stateNode)}catch(g){nt(a,s,g)}else try{dt.removeChild(a.stateNode)}catch(g){nt(a,s,g)}break;case 18:dt!==null&&(Qt?(e=dt,gm(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),ml(e)):gm(dt,a.stateNode));break;case 4:o=dt,u=Qt,dt=a.stateNode.containerInfo,Qt=!0,Js(e,s,a),dt=o,Qt=u;break;case 0:case 11:case 14:case 15:xt||vn(2,a,s),xt||vn(4,a,s),Js(e,s,a);break;case 1:xt||(Rs(a,s),o=a.stateNode,typeof o.componentWillUnmount=="function"&&xf(a,s,o)),Js(e,s,a);break;case 21:Js(e,s,a);break;case 22:xt=(o=xt)||a.memoizedState!==null,Js(e,s,a),xt=o;break;default:Js(e,s,a)}}function Tf(e,s){if(s.memoizedState===null&&(e=s.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ml(e)}catch(a){nt(s,s.return,a)}}function vv(e){switch(e.tag){case 13:case 19:var s=e.stateNode;return s===null&&(s=e.stateNode=new kf),s;case 22:return e=e.stateNode,s=e._retryCache,s===null&&(s=e._retryCache=new kf),s;default:throw Error(i(435,e.tag))}}function Od(e,s){var a=vv(e);s.forEach(function(o){var u=Ev.bind(null,e,o);a.has(o)||(a.add(o),o.then(u,u))})}function ss(e,s){var a=s.deletions;if(a!==null)for(var o=0;o<a.length;o++){var u=a[o],g=e,y=s,v=y;e:for(;v!==null;){switch(v.tag){case 27:if(Dn(v.type)){dt=v.stateNode,Qt=!1;break e}break;case 5:dt=v.stateNode,Qt=!1;break e;case 3:case 4:dt=v.stateNode.containerInfo,Qt=!0;break e}v=v.return}if(dt===null)throw Error(i(160));jf(g,y,u),dt=null,Qt=!1,g=u.alternate,g!==null&&(g.return=null),u.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)Sf(s,e),s=s.sibling}var ks=null;function Sf(e,s){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:ss(s,e),ns(e),o&4&&(vn(3,e,e.return),Kr(3,e),vn(5,e,e.return));break;case 1:ss(s,e),ns(e),o&512&&(xt||a===null||Rs(a,a.return)),o&64&&Zs&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?o:a.concat(o))));break;case 26:var u=ks;if(ss(s,e),ns(e),o&512&&(xt||a===null||Rs(a,a.return)),o&4){var g=a!==null?a.memoizedState:null;if(o=e.memoizedState,a===null)if(o===null)if(e.stateNode===null){e:{o=e.type,a=e.memoizedProps,u=u.ownerDocument||u;t:switch(o){case"title":g=u.getElementsByTagName("title")[0],(!g||g[kr]||g[Ht]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=u.createElement(o),u.head.insertBefore(g,u.querySelector("head > title"))),Lt(g,o,a),g[Ht]=e,St(g),o=g;break e;case"link":var y=wm("link","href",u).get(o+(a.href||""));if(y){for(var v=0;v<y.length;v++)if(g=y[v],g.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&g.getAttribute("rel")===(a.rel==null?null:a.rel)&&g.getAttribute("title")===(a.title==null?null:a.title)&&g.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){y.splice(v,1);break t}}g=u.createElement(o),Lt(g,o,a),u.head.appendChild(g);break;case"meta":if(y=wm("meta","content",u).get(o+(a.content||""))){for(v=0;v<y.length;v++)if(g=y[v],g.getAttribute("content")===(a.content==null?null:""+a.content)&&g.getAttribute("name")===(a.name==null?null:a.name)&&g.getAttribute("property")===(a.property==null?null:a.property)&&g.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&g.getAttribute("charset")===(a.charSet==null?null:a.charSet)){y.splice(v,1);break t}}g=u.createElement(o),Lt(g,o,a),u.head.appendChild(g);break;default:throw Error(i(468,o))}g[Ht]=e,St(g),o=g}e.stateNode=o}else km(u,e.type,e.stateNode);else e.stateNode=vm(u,o,e.memoizedProps);else g!==o?(g===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):g.count--,o===null?km(u,e.type,e.stateNode):vm(u,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Ed(e,e.memoizedProps,a.memoizedProps)}break;case 27:ss(s,e),ns(e),o&512&&(xt||a===null||Rs(a,a.return)),a!==null&&o&4&&Ed(e,e.memoizedProps,a.memoizedProps);break;case 5:if(ss(s,e),ns(e),o&512&&(xt||a===null||Rs(a,a.return)),e.flags&32){u=e.stateNode;try{Da(u,"")}catch(X){nt(e,e.return,X)}}o&4&&e.stateNode!=null&&(u=e.memoizedProps,Ed(e,u,a!==null?a.memoizedProps:u)),o&1024&&(Rd=!0);break;case 6:if(ss(s,e),ns(e),o&4){if(e.stateNode===null)throw Error(i(162));o=e.memoizedProps,a=e.stateNode;try{a.nodeValue=o}catch(X){nt(e,e.return,X)}}break;case 3:if(ro=null,u=ks,ks=no(s.containerInfo),ss(s,e),ks=u,ns(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{ml(s.containerInfo)}catch(X){nt(e,e.return,X)}Rd&&(Rd=!1,Df(e));break;case 4:o=ks,ks=no(e.stateNode.containerInfo),ss(s,e),ns(e),ks=o;break;case 12:ss(s,e),ns(e);break;case 13:ss(s,e),ns(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&($d=q()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Od(e,o)));break;case 22:u=e.memoizedState!==null;var S=a!==null&&a.memoizedState!==null,G=Zs,se=xt;if(Zs=G||u,xt=se||S,ss(s,e),xt=se,Zs=G,ns(e),o&8192)e:for(s=e.stateNode,s._visibility=u?s._visibility&-2:s._visibility|1,u&&(a===null||S||Zs||xt||la(e)),a=null,s=e;;){if(s.tag===5||s.tag===26){if(a===null){S=a=s;try{if(g=S.stateNode,u)y=g.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none";else{v=S.stateNode;var re=S.memoizedProps.style,Q=re!=null&&re.hasOwnProperty("display")?re.display:null;v.style.display=Q==null||typeof Q=="boolean"?"":(""+Q).trim()}}catch(X){nt(S,S.return,X)}}}else if(s.tag===6){if(a===null){S=s;try{S.stateNode.nodeValue=u?"":S.memoizedProps}catch(X){nt(S,S.return,X)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===e)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;a===s&&(a=null),s=s.return}a===s&&(a=null),s.sibling.return=s.return,s=s.sibling}o&4&&(o=e.updateQueue,o!==null&&(a=o.retryQueue,a!==null&&(o.retryQueue=null,Od(e,a))));break;case 19:ss(s,e),ns(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Od(e,o)));break;case 30:break;case 21:break;default:ss(s,e),ns(e)}}function ns(e){var s=e.flags;if(s&2){try{for(var a,o=e.return;o!==null;){if(vf(o)){a=o;break}o=o.return}if(a==null)throw Error(i(160));switch(a.tag){case 27:var u=a.stateNode,g=Cd(e);Yi(e,g,u);break;case 5:var y=a.stateNode;a.flags&32&&(Da(y,""),a.flags&=-33);var v=Cd(e);Yi(e,v,y);break;case 3:case 4:var S=a.stateNode.containerInfo,G=Cd(e);Ad(e,G,S);break;default:throw Error(i(161))}}catch(se){nt(e,e.return,se)}e.flags&=-3}s&4096&&(e.flags&=-4097)}function Df(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var s=e;Df(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),e=e.sibling}}function wn(e,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)_f(e,s.alternate,s),s=s.sibling}function la(e){for(e=e.child;e!==null;){var s=e;switch(s.tag){case 0:case 11:case 14:case 15:vn(4,s,s.return),la(s);break;case 1:Rs(s,s.return);var a=s.stateNode;typeof a.componentWillUnmount=="function"&&xf(s,s.return,a),la(s);break;case 27:il(s.stateNode);case 26:case 5:Rs(s,s.return),la(s);break;case 22:s.memoizedState===null&&la(s);break;case 30:la(s);break;default:la(s)}e=e.sibling}}function kn(e,s,a){for(a=a&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var o=s.alternate,u=e,g=s,y=g.flags;switch(g.tag){case 0:case 11:case 15:kn(u,g,a),Kr(4,g);break;case 1:if(kn(u,g,a),o=g,u=o.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(G){nt(o,o.return,G)}if(o=g,u=o.updateQueue,u!==null){var v=o.stateNode;try{var S=u.shared.hiddenCallbacks;if(S!==null)for(u.shared.hiddenCallbacks=null,u=0;u<S.length;u++)sg(S[u],v)}catch(G){nt(o,o.return,G)}}a&&y&64&&yf(g),Zr(g,g.return);break;case 27:wf(g);case 26:case 5:kn(u,g,a),a&&o===null&&y&4&&bf(g),Zr(g,g.return);break;case 12:kn(u,g,a);break;case 13:kn(u,g,a),a&&y&4&&Tf(u,g);break;case 22:g.memoizedState===null&&kn(u,g,a),Zr(g,g.return);break;case 30:break;default:kn(u,g,a)}s=s.sibling}}function Md(e,s){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(e=s.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Lr(a))}function Id(e,s){e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Lr(e))}function Os(e,s,a,o){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Ef(e,s,a,o),s=s.sibling}function Ef(e,s,a,o){var u=s.flags;switch(s.tag){case 0:case 11:case 15:Os(e,s,a,o),u&2048&&Kr(9,s);break;case 1:Os(e,s,a,o);break;case 3:Os(e,s,a,o),u&2048&&(e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Lr(e)));break;case 12:if(u&2048){Os(e,s,a,o),e=s.stateNode;try{var g=s.memoizedProps,y=g.id,v=g.onPostCommit;typeof v=="function"&&v(y,s.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(S){nt(s,s.return,S)}}else Os(e,s,a,o);break;case 13:Os(e,s,a,o);break;case 23:break;case 22:g=s.stateNode,y=s.alternate,s.memoizedState!==null?g._visibility&2?Os(e,s,a,o):Jr(e,s):g._visibility&2?Os(e,s,a,o):(g._visibility|=2,Pa(e,s,a,o,(s.subtreeFlags&10256)!==0)),u&2048&&Md(y,s);break;case 24:Os(e,s,a,o),u&2048&&Id(s.alternate,s);break;default:Os(e,s,a,o)}}function Pa(e,s,a,o,u){for(u=u&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var g=e,y=s,v=a,S=o,G=y.flags;switch(y.tag){case 0:case 11:case 15:Pa(g,y,v,S,u),Kr(8,y);break;case 23:break;case 22:var se=y.stateNode;y.memoizedState!==null?se._visibility&2?Pa(g,y,v,S,u):Jr(g,y):(se._visibility|=2,Pa(g,y,v,S,u)),u&&G&2048&&Md(y.alternate,y);break;case 24:Pa(g,y,v,S,u),u&&G&2048&&Id(y.alternate,y);break;default:Pa(g,y,v,S,u)}s=s.sibling}}function Jr(e,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var a=e,o=s,u=o.flags;switch(o.tag){case 22:Jr(a,o),u&2048&&Md(o.alternate,o);break;case 24:Jr(a,o),u&2048&&Id(o.alternate,o);break;default:Jr(a,o)}s=s.sibling}}var el=8192;function Wa(e){if(e.subtreeFlags&el)for(e=e.child;e!==null;)Cf(e),e=e.sibling}function Cf(e){switch(e.tag){case 26:Wa(e),e.flags&el&&e.memoizedState!==null&&rw(ks,e.memoizedState,e.memoizedProps);break;case 5:Wa(e);break;case 3:case 4:var s=ks;ks=no(e.stateNode.containerInfo),Wa(e),ks=s;break;case 22:e.memoizedState===null&&(s=e.alternate,s!==null&&s.memoizedState!==null?(s=el,el=16777216,Wa(e),el=s):Wa(e));break;default:Wa(e)}}function Af(e){var s=e.alternate;if(s!==null&&(e=s.child,e!==null)){s.child=null;do s=e.sibling,e.sibling=null,e=s;while(e!==null)}}function tl(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var a=0;a<s.length;a++){var o=s[a];Et=o,Of(o,e)}Af(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Rf(e),e=e.sibling}function Rf(e){switch(e.tag){case 0:case 11:case 15:tl(e),e.flags&2048&&vn(9,e,e.return);break;case 3:tl(e);break;case 12:tl(e);break;case 22:var s=e.stateNode;e.memoizedState!==null&&s._visibility&2&&(e.return===null||e.return.tag!==13)?(s._visibility&=-3,qi(e)):tl(e);break;default:tl(e)}}function qi(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var a=0;a<s.length;a++){var o=s[a];Et=o,Of(o,e)}Af(e)}for(e=e.child;e!==null;){switch(s=e,s.tag){case 0:case 11:case 15:vn(8,s,s.return),qi(s);break;case 22:a=s.stateNode,a._visibility&2&&(a._visibility&=-3,qi(s));break;default:qi(s)}e=e.sibling}}function Of(e,s){for(;Et!==null;){var a=Et;switch(a.tag){case 0:case 11:case 15:vn(8,a,s);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var o=a.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:Lr(a.memoizedState.cache)}if(o=a.child,o!==null)o.return=a,Et=o;else e:for(a=e;Et!==null;){o=Et;var u=o.sibling,g=o.return;if(Nf(o),o===a){Et=null;break e}if(u!==null){u.return=g,Et=u;break e}Et=g}}}var wv={getCacheForType:function(e){var s=$t(kt),a=s.data.get(e);return a===void 0&&(a=e(),s.data.set(e,a)),a}},kv=typeof WeakMap=="function"?WeakMap:Map,Qe=0,rt=null,Fe=null,qe=0,Xe=0,as=null,_n=!1,Qa=!1,Ud=!1,en=0,ft=0,Nn=0,ia=0,Ld=0,ps=0,Xa=0,sl=null,Xt=null,Hd=!1,$d=0,Gi=1/0,Pi=null,jn=null,Ut=0,Tn=null,Ka=null,Za=0,zd=0,Bd=null,Mf=null,nl=0,Fd=null;function rs(){if((Qe&2)!==0&&qe!==0)return qe&-qe;if(F.T!==null){var e=$a;return e!==0?e:Qd()}return Qh()}function If(){ps===0&&(ps=(qe&536870912)===0||We?qh():536870912);var e=ms.current;return e!==null&&(e.flags|=32),ps}function ls(e,s,a){(e===rt&&(Xe===2||Xe===9)||e.cancelPendingCommit!==null)&&(Ja(e,0),Sn(e,qe,ps,!1)),wr(e,a),((Qe&2)===0||e!==rt)&&(e===rt&&((Qe&2)===0&&(ia|=a),ft===4&&Sn(e,qe,ps,!1)),Ms(e))}function Uf(e,s,a){if((Qe&6)!==0)throw Error(i(327));var o=!a&&(s&124)===0&&(s&e.expiredLanes)===0||vr(e,s),u=o?jv(e,s):qd(e,s,!0),g=o;do{if(u===0){Qa&&!o&&Sn(e,s,0,!1);break}else{if(a=e.current.alternate,g&&!_v(a)){u=qd(e,s,!1),g=!1;continue}if(u===2){if(g=s,e.errorRecoveryDisabledLanes&g)var y=0;else y=e.pendingLanes&-536870913,y=y!==0?y:y&536870912?536870912:0;if(y!==0){s=y;e:{var v=e;u=sl;var S=v.current.memoizedState.isDehydrated;if(S&&(Ja(v,y).flags|=256),y=qd(v,y,!1),y!==2){if(Ud&&!S){v.errorRecoveryDisabledLanes|=g,ia|=g,u=4;break e}g=Xt,Xt=u,g!==null&&(Xt===null?Xt=g:Xt.push.apply(Xt,g))}u=y}if(g=!1,u!==2)continue}}if(u===1){Ja(e,0),Sn(e,s,0,!0);break}e:{switch(o=e,g=u,g){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:Sn(o,s,ps,!_n);break e;case 2:Xt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(u=$d+300-q(),10<u)){if(Sn(o,s,ps,!_n),ai(o,0,!0)!==0)break e;o.timeoutHandle=um(Lf.bind(null,o,a,Xt,Pi,Hd,s,ps,ia,Xa,_n,g,2,-0,0),u);break e}Lf(o,a,Xt,Pi,Hd,s,ps,ia,Xa,_n,g,0,-0,0)}}break}while(!0);Ms(e)}function Lf(e,s,a,o,u,g,y,v,S,G,se,re,Q,X){if(e.timeoutHandle=-1,re=s.subtreeFlags,(re&8192||(re&16785408)===16785408)&&(dl={stylesheets:null,count:0,unsuspend:aw},Cf(s),re=lw(),re!==null)){e.cancelPendingCommit=re(Yf.bind(null,e,s,g,a,o,u,y,v,S,se,1,Q,X)),Sn(e,g,y,!G);return}Yf(e,s,g,a,o,u,y,v,S)}function _v(e){for(var s=e;;){var a=s.tag;if((a===0||a===11||a===15)&&s.flags&16384&&(a=s.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var o=0;o<a.length;o++){var u=a[o],g=u.getSnapshot;u=u.value;try{if(!es(g(),u))return!1}catch{return!1}}if(a=s.child,s.subtreeFlags&16384&&a!==null)a.return=s,s=a;else{if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Sn(e,s,a,o){s&=~Ld,s&=~ia,e.suspendedLanes|=s,e.pingedLanes&=~s,o&&(e.warmLanes|=s),o=e.expirationTimes;for(var u=s;0<u;){var g=31-Je(u),y=1<<g;o[g]=-1,u&=~y}a!==0&&Ph(e,a,s)}function Wi(){return(Qe&6)===0?(al(0),!1):!0}function Vd(){if(Fe!==null){if(Xe===0)var e=Fe.return;else e=Fe,Gs=ta=null,ld(e),qa=null,Wr=0,e=Fe;for(;e!==null;)pf(e.alternate,e),e=e.return;Fe=null}}function Ja(e,s){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Bv(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Vd(),rt=e,Fe=a=Vs(e.current,null),qe=s,Xe=0,as=null,_n=!1,Qa=vr(e,s),Ud=!1,Xa=ps=Ld=ia=Nn=ft=0,Xt=sl=null,Hd=!1,(s&8)!==0&&(s|=s&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=s;0<o;){var u=31-Je(o),g=1<<u;s|=e[u],o&=~g}return en=s,pi(),a}function Hf(e,s){He=null,F.H=Ii,s===$r||s===ji?(s=eg(),Xe=3):s===K0?(s=eg(),Xe=4):Xe=s===tf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,as=s,Fe===null&&(ft=1,zi(e,us(s,e.current)))}function $f(){var e=F.H;return F.H=Ii,e===null?Ii:e}function zf(){var e=F.A;return F.A=wv,e}function Yd(){ft=4,_n||(qe&4194048)!==qe&&ms.current!==null||(Qa=!0),(Nn&134217727)===0&&(ia&134217727)===0||rt===null||Sn(rt,qe,ps,!1)}function qd(e,s,a){var o=Qe;Qe|=2;var u=$f(),g=zf();(rt!==e||qe!==s)&&(Pi=null,Ja(e,s)),s=!1;var y=ft;e:do try{if(Xe!==0&&Fe!==null){var v=Fe,S=as;switch(Xe){case 8:Vd(),y=6;break e;case 3:case 2:case 9:case 6:ms.current===null&&(s=!0);var G=Xe;if(Xe=0,as=null,er(e,v,S,G),a&&Qa){y=0;break e}break;default:G=Xe,Xe=0,as=null,er(e,v,S,G)}}Nv(),y=ft;break}catch(se){Hf(e,se)}while(!0);return s&&e.shellSuspendCounter++,Gs=ta=null,Qe=o,F.H=u,F.A=g,Fe===null&&(rt=null,qe=0,pi()),y}function Nv(){for(;Fe!==null;)Bf(Fe)}function jv(e,s){var a=Qe;Qe|=2;var o=$f(),u=zf();rt!==e||qe!==s?(Pi=null,Gi=q()+500,Ja(e,s)):Qa=vr(e,s);e:do try{if(Xe!==0&&Fe!==null){s=Fe;var g=as;t:switch(Xe){case 1:Xe=0,as=null,er(e,s,g,1);break;case 2:case 9:if(Z0(g)){Xe=0,as=null,Ff(s);break}s=function(){Xe!==2&&Xe!==9||rt!==e||(Xe=7),Ms(e)},g.then(s,s);break e;case 3:Xe=7;break e;case 4:Xe=5;break e;case 7:Z0(g)?(Xe=0,as=null,Ff(s)):(Xe=0,as=null,er(e,s,g,7));break;case 5:var y=null;switch(Fe.tag){case 26:y=Fe.memoizedState;case 5:case 27:var v=Fe;if(!y||_m(y)){Xe=0,as=null;var S=v.sibling;if(S!==null)Fe=S;else{var G=v.return;G!==null?(Fe=G,Qi(G)):Fe=null}break t}}Xe=0,as=null,er(e,s,g,5);break;case 6:Xe=0,as=null,er(e,s,g,6);break;case 8:Vd(),ft=6;break e;default:throw Error(i(462))}}Tv();break}catch(se){Hf(e,se)}while(!0);return Gs=ta=null,F.H=o,F.A=u,Qe=a,Fe!==null?0:(rt=null,qe=0,pi(),ft)}function Tv(){for(;Fe!==null&&!j();)Bf(Fe)}function Bf(e){var s=ff(e.alternate,e,en);e.memoizedProps=e.pendingProps,s===null?Qi(e):Fe=s}function Ff(e){var s=e,a=s.alternate;switch(s.tag){case 15:case 0:s=of(a,s,s.pendingProps,s.type,void 0,qe);break;case 11:s=of(a,s,s.pendingProps,s.type.render,s.ref,qe);break;case 5:ld(s);default:pf(a,s),s=Fe=F0(s,en),s=ff(a,s,en)}e.memoizedProps=e.pendingProps,s===null?Qi(e):Fe=s}function er(e,s,a,o){Gs=ta=null,ld(s),qa=null,Wr=0;var u=s.return;try{if(mv(e,u,s,a,qe)){ft=1,zi(e,us(a,e.current)),Fe=null;return}}catch(g){if(u!==null)throw Fe=u,g;ft=1,zi(e,us(a,e.current)),Fe=null;return}s.flags&32768?(We||o===1?e=!0:Qa||(qe&536870912)!==0?e=!1:(_n=e=!0,(o===2||o===9||o===3||o===6)&&(o=ms.current,o!==null&&o.tag===13&&(o.flags|=16384))),Vf(s,e)):Qi(s)}function Qi(e){var s=e;do{if((s.flags&32768)!==0){Vf(s,_n);return}e=s.return;var a=yv(s.alternate,s,en);if(a!==null){Fe=a;return}if(s=s.sibling,s!==null){Fe=s;return}Fe=s=e}while(s!==null);ft===0&&(ft=5)}function Vf(e,s){do{var a=xv(e.alternate,e);if(a!==null){a.flags&=32767,Fe=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!s&&(e=e.sibling,e!==null)){Fe=e;return}Fe=e=a}while(e!==null);ft=6,Fe=null}function Yf(e,s,a,o,u,g,y,v,S){e.cancelPendingCommit=null;do Xi();while(Ut!==0);if((Qe&6)!==0)throw Error(i(327));if(s!==null){if(s===e.current)throw Error(i(177));if(g=s.lanes|s.childLanes,g|=Ic,ab(e,a,g,y,v,S),e===rt&&(Fe=rt=null,qe=0),Ka=s,Tn=e,Za=a,zd=g,Bd=u,Mf=o,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Cv(te,function(){return Qf(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||o){o=F.T,F.T=null,u=ee.p,ee.p=2,y=Qe,Qe|=4;try{bv(e,s,a)}finally{Qe=y,ee.p=u,F.T=o}}Ut=1,qf(),Gf(),Pf()}}function qf(){if(Ut===1){Ut=0;var e=Tn,s=Ka,a=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||a){a=F.T,F.T=null;var o=ee.p;ee.p=2;var u=Qe;Qe|=4;try{Sf(s,e);var g=nu,y=R0(e.containerInfo),v=g.focusedElem,S=g.selectionRange;if(y!==v&&v&&v.ownerDocument&&A0(v.ownerDocument.documentElement,v)){if(S!==null&&Cc(v)){var G=S.start,se=S.end;if(se===void 0&&(se=G),"selectionStart"in v)v.selectionStart=G,v.selectionEnd=Math.min(se,v.value.length);else{var re=v.ownerDocument||document,Q=re&&re.defaultView||window;if(Q.getSelection){var X=Q.getSelection(),Me=v.textContent.length,De=Math.min(S.start,Me),st=S.end===void 0?De:Math.min(S.end,Me);!X.extend&&De>st&&(y=st,st=De,De=y);var B=C0(v,De),L=C0(v,st);if(B&&L&&(X.rangeCount!==1||X.anchorNode!==B.node||X.anchorOffset!==B.offset||X.focusNode!==L.node||X.focusOffset!==L.offset)){var Y=re.createRange();Y.setStart(B.node,B.offset),X.removeAllRanges(),De>st?(X.addRange(Y),X.extend(L.node,L.offset)):(Y.setEnd(L.node,L.offset),X.addRange(Y))}}}}for(re=[],X=v;X=X.parentNode;)X.nodeType===1&&re.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<re.length;v++){var ne=re[v];ne.element.scrollLeft=ne.left,ne.element.scrollTop=ne.top}}oo=!!su,nu=su=null}finally{Qe=u,ee.p=o,F.T=a}}e.current=s,Ut=2}}function Gf(){if(Ut===2){Ut=0;var e=Tn,s=Ka,a=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||a){a=F.T,F.T=null;var o=ee.p;ee.p=2;var u=Qe;Qe|=4;try{_f(e,s.alternate,s)}finally{Qe=u,ee.p=o,F.T=a}}Ut=3}}function Pf(){if(Ut===4||Ut===3){Ut=0,V();var e=Tn,s=Ka,a=Za,o=Mf;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Ut=5:(Ut=0,Ka=Tn=null,Wf(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(jn=null),cc(a),s=s.stateNode,xe&&typeof xe.onCommitFiberRoot=="function")try{xe.onCommitFiberRoot(he,s,void 0,(s.current.flags&128)===128)}catch{}if(o!==null){s=F.T,u=ee.p,ee.p=2,F.T=null;try{for(var g=e.onRecoverableError,y=0;y<o.length;y++){var v=o[y];g(v.value,{componentStack:v.stack})}}finally{F.T=s,ee.p=u}}(Za&3)!==0&&Xi(),Ms(e),u=e.pendingLanes,(a&4194090)!==0&&(u&42)!==0?e===Fd?nl++:(nl=0,Fd=e):nl=0,al(0)}}function Wf(e,s){(e.pooledCacheLanes&=s)===0&&(s=e.pooledCache,s!=null&&(e.pooledCache=null,Lr(s)))}function Xi(e){return qf(),Gf(),Pf(),Qf()}function Qf(){if(Ut!==5)return!1;var e=Tn,s=zd;zd=0;var a=cc(Za),o=F.T,u=ee.p;try{ee.p=32>a?32:a,F.T=null,a=Bd,Bd=null;var g=Tn,y=Za;if(Ut=0,Ka=Tn=null,Za=0,(Qe&6)!==0)throw Error(i(331));var v=Qe;if(Qe|=4,Rf(g.current),Ef(g,g.current,y,a),Qe=v,al(0,!1),xe&&typeof xe.onPostCommitFiberRoot=="function")try{xe.onPostCommitFiberRoot(he,g)}catch{}return!0}finally{ee.p=u,F.T=o,Wf(e,s)}}function Xf(e,s,a){s=us(a,s),s=vd(e.stateNode,s,2),e=pn(e,s,2),e!==null&&(wr(e,2),Ms(e))}function nt(e,s,a){if(e.tag===3)Xf(e,e,a);else for(;s!==null;){if(s.tag===3){Xf(s,e,a);break}else if(s.tag===1){var o=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(jn===null||!jn.has(o))){e=us(a,e),a=Jg(2),o=pn(s,a,2),o!==null&&(ef(a,o,s,e),wr(o,2),Ms(o));break}}s=s.return}}function Gd(e,s,a){var o=e.pingCache;if(o===null){o=e.pingCache=new kv;var u=new Set;o.set(s,u)}else u=o.get(s),u===void 0&&(u=new Set,o.set(s,u));u.has(a)||(Ud=!0,u.add(a),e=Sv.bind(null,e,s,a),s.then(e,e))}function Sv(e,s,a){var o=e.pingCache;o!==null&&o.delete(s),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,rt===e&&(qe&a)===a&&(ft===4||ft===3&&(qe&62914560)===qe&&300>q()-$d?(Qe&2)===0&&Ja(e,0):Ld|=a,Xa===qe&&(Xa=0)),Ms(e)}function Kf(e,s){s===0&&(s=Gh()),e=Ia(e,s),e!==null&&(wr(e,s),Ms(e))}function Dv(e){var s=e.memoizedState,a=0;s!==null&&(a=s.retryLane),Kf(e,a)}function Ev(e,s){var a=0;switch(e.tag){case 13:var o=e.stateNode,u=e.memoizedState;u!==null&&(a=u.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(i(314))}o!==null&&o.delete(s),Kf(e,a)}function Cv(e,s){return dn(e,s)}var Ki=null,tr=null,Pd=!1,Zi=!1,Wd=!1,oa=0;function Ms(e){e!==tr&&e.next===null&&(tr===null?Ki=tr=e:tr=tr.next=e),Zi=!0,Pd||(Pd=!0,Rv())}function al(e,s){if(!Wd&&Zi){Wd=!0;do for(var a=!1,o=Ki;o!==null;){if(e!==0){var u=o.pendingLanes;if(u===0)var g=0;else{var y=o.suspendedLanes,v=o.pingedLanes;g=(1<<31-Je(42|e)+1)-1,g&=u&~(y&~v),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(a=!0,tm(o,g))}else g=qe,g=ai(o,o===rt?g:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(g&3)===0||vr(o,g)||(a=!0,tm(o,g));o=o.next}while(a);Wd=!1}}function Av(){Zf()}function Zf(){Zi=Pd=!1;var e=0;oa!==0&&(zv()&&(e=oa),oa=0);for(var s=q(),a=null,o=Ki;o!==null;){var u=o.next,g=Jf(o,s);g===0?(o.next=null,a===null?Ki=u:a.next=u,u===null&&(tr=a)):(a=o,(e!==0||(g&3)!==0)&&(Zi=!0)),o=u}al(e)}function Jf(e,s){for(var a=e.suspendedLanes,o=e.pingedLanes,u=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var y=31-Je(g),v=1<<y,S=u[y];S===-1?((v&a)===0||(v&o)!==0)&&(u[y]=nb(v,s)):S<=s&&(e.expiredLanes|=v),g&=~v}if(s=rt,a=qe,a=ai(e,e===s?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,a===0||e===s&&(Xe===2||Xe===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&qt(o),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||vr(e,a)){if(s=a&-a,s===e.callbackPriority)return s;switch(o!==null&&qt(o),cc(a)){case 2:case 8:a=ie;break;case 32:a=te;break;case 268435456:a=pe;break;default:a=te}return o=em.bind(null,e),a=dn(a,o),e.callbackPriority=s,e.callbackNode=a,s}return o!==null&&o!==null&&qt(o),e.callbackPriority=2,e.callbackNode=null,2}function em(e,s){if(Ut!==0&&Ut!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Xi()&&e.callbackNode!==a)return null;var o=qe;return o=ai(e,e===rt?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(Uf(e,o,s),Jf(e,q()),e.callbackNode!=null&&e.callbackNode===a?em.bind(null,e):null)}function tm(e,s){if(Xi())return null;Uf(e,s,!0)}function Rv(){Fv(function(){(Qe&6)!==0?dn(oe,Av):Zf()})}function Qd(){return oa===0&&(oa=qh()),oa}function sm(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ci(""+e)}function nm(e,s){var a=s.ownerDocument.createElement("input");return a.name=s.name,a.value=s.value,e.id&&a.setAttribute("form",e.id),s.parentNode.insertBefore(a,s),e=new FormData(e),a.parentNode.removeChild(a),e}function Ov(e,s,a,o,u){if(s==="submit"&&a&&a.stateNode===u){var g=sm((u[Gt]||null).action),y=o.submitter;y&&(s=(s=y[Gt]||null)?sm(s.formAction):y.getAttribute("formAction"),s!==null&&(g=s,y=null));var v=new gi("action","action",null,o,u);e.push({event:v,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(oa!==0){var S=y?nm(u,y):new FormData(u);md(a,{pending:!0,data:S,method:u.method,action:g},null,S)}}else typeof g=="function"&&(v.preventDefault(),S=y?nm(u,y):new FormData(u),md(a,{pending:!0,data:S,method:u.method,action:g},g,S))},currentTarget:u}]})}}for(var Xd=0;Xd<Mc.length;Xd++){var Kd=Mc[Xd],Mv=Kd.toLowerCase(),Iv=Kd[0].toUpperCase()+Kd.slice(1);ws(Mv,"on"+Iv)}ws(I0,"onAnimationEnd"),ws(U0,"onAnimationIteration"),ws(L0,"onAnimationStart"),ws("dblclick","onDoubleClick"),ws("focusin","onFocus"),ws("focusout","onBlur"),ws(Zb,"onTransitionRun"),ws(Jb,"onTransitionStart"),ws(ev,"onTransitionCancel"),ws(H0,"onTransitionEnd"),ja("onMouseEnter",["mouseout","mouseover"]),ja("onMouseLeave",["mouseout","mouseover"]),ja("onPointerEnter",["pointerout","pointerover"]),ja("onPointerLeave",["pointerout","pointerover"]),Gn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Uv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(rl));function am(e,s){s=(s&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],u=o.event;o=o.listeners;e:{var g=void 0;if(s)for(var y=o.length-1;0<=y;y--){var v=o[y],S=v.instance,G=v.currentTarget;if(v=v.listener,S!==g&&u.isPropagationStopped())break e;g=v,u.currentTarget=G;try{g(u)}catch(se){$i(se)}u.currentTarget=null,g=S}else for(y=0;y<o.length;y++){if(v=o[y],S=v.instance,G=v.currentTarget,v=v.listener,S!==g&&u.isPropagationStopped())break e;g=v,u.currentTarget=G;try{g(u)}catch(se){$i(se)}u.currentTarget=null,g=S}}}}function Ve(e,s){var a=s[dc];a===void 0&&(a=s[dc]=new Set);var o=e+"__bubble";a.has(o)||(rm(s,e,2,!1),a.add(o))}function Zd(e,s,a){var o=0;s&&(o|=4),rm(a,e,o,s)}var Ji="_reactListening"+Math.random().toString(36).slice(2);function Jd(e){if(!e[Ji]){e[Ji]=!0,Kh.forEach(function(a){a!=="selectionchange"&&(Uv.has(a)||Zd(a,!1,e),Zd(a,!0,e))});var s=e.nodeType===9?e:e.ownerDocument;s===null||s[Ji]||(s[Ji]=!0,Zd("selectionchange",!1,s))}}function rm(e,s,a,o){switch(Em(s)){case 2:var u=cw;break;case 8:u=dw;break;default:u=gu}a=u.bind(null,s,a,e),u=void 0,!wc||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(u=!0),o?u!==void 0?e.addEventListener(s,a,{capture:!0,passive:u}):e.addEventListener(s,a,!0):u!==void 0?e.addEventListener(s,a,{passive:u}):e.addEventListener(s,a,!1)}function eu(e,s,a,o,u){var g=o;if((s&1)===0&&(s&2)===0&&o!==null)e:for(;;){if(o===null)return;var y=o.tag;if(y===3||y===4){var v=o.stateNode.containerInfo;if(v===u)break;if(y===4)for(y=o.return;y!==null;){var S=y.tag;if((S===3||S===4)&&y.stateNode.containerInfo===u)return;y=y.return}for(;v!==null;){if(y=ka(v),y===null)return;if(S=y.tag,S===5||S===6||S===26||S===27){o=g=y;continue e}v=v.parentNode}}o=o.return}u0(function(){var G=g,se=bc(a),re=[];e:{var Q=$0.get(e);if(Q!==void 0){var X=gi,Me=e;switch(e){case"keypress":if(ui(a)===0)break e;case"keydown":case"keyup":X=Cb;break;case"focusin":Me="focus",X=jc;break;case"focusout":Me="blur",X=jc;break;case"beforeblur":case"afterblur":X=jc;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=f0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=xb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=Ob;break;case I0:case U0:case L0:X=wb;break;case H0:X=Ib;break;case"scroll":case"scrollend":X=pb;break;case"wheel":X=Lb;break;case"copy":case"cut":case"paste":X=_b;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=p0;break;case"toggle":case"beforetoggle":X=$b}var De=(s&4)!==0,st=!De&&(e==="scroll"||e==="scrollend"),B=De?Q!==null?Q+"Capture":null:Q;De=[];for(var L=G,Y;L!==null;){var ne=L;if(Y=ne.stateNode,ne=ne.tag,ne!==5&&ne!==26&&ne!==27||Y===null||B===null||(ne=Nr(L,B),ne!=null&&De.push(ll(L,ne,Y))),st)break;L=L.return}0<De.length&&(Q=new X(Q,Me,null,a,se),re.push({event:Q,listeners:De}))}}if((s&7)===0){e:{if(Q=e==="mouseover"||e==="pointerover",X=e==="mouseout"||e==="pointerout",Q&&a!==xc&&(Me=a.relatedTarget||a.fromElement)&&(ka(Me)||Me[wa]))break e;if((X||Q)&&(Q=se.window===se?se:(Q=se.ownerDocument)?Q.defaultView||Q.parentWindow:window,X?(Me=a.relatedTarget||a.toElement,X=G,Me=Me?ka(Me):null,Me!==null&&(st=d(Me),De=Me.tag,Me!==st||De!==5&&De!==27&&De!==6)&&(Me=null)):(X=null,Me=G),X!==Me)){if(De=f0,ne="onMouseLeave",B="onMouseEnter",L="mouse",(e==="pointerout"||e==="pointerover")&&(De=p0,ne="onPointerLeave",B="onPointerEnter",L="pointer"),st=X==null?Q:_r(X),Y=Me==null?Q:_r(Me),Q=new De(ne,L+"leave",X,a,se),Q.target=st,Q.relatedTarget=Y,ne=null,ka(se)===G&&(De=new De(B,L+"enter",Me,a,se),De.target=Y,De.relatedTarget=st,ne=De),st=ne,X&&Me)t:{for(De=X,B=Me,L=0,Y=De;Y;Y=sr(Y))L++;for(Y=0,ne=B;ne;ne=sr(ne))Y++;for(;0<L-Y;)De=sr(De),L--;for(;0<Y-L;)B=sr(B),Y--;for(;L--;){if(De===B||B!==null&&De===B.alternate)break t;De=sr(De),B=sr(B)}De=null}else De=null;X!==null&&lm(re,Q,X,De,!1),Me!==null&&st!==null&&lm(re,st,Me,De,!0)}}e:{if(Q=G?_r(G):window,X=Q.nodeName&&Q.nodeName.toLowerCase(),X==="select"||X==="input"&&Q.type==="file")var ve=N0;else if(k0(Q))if(j0)ve=Qb;else{ve=Pb;var $e=Gb}else X=Q.nodeName,!X||X.toLowerCase()!=="input"||Q.type!=="checkbox"&&Q.type!=="radio"?G&&yc(G.elementType)&&(ve=N0):ve=Wb;if(ve&&(ve=ve(e,G))){_0(re,ve,a,se);break e}$e&&$e(e,Q,G),e==="focusout"&&G&&Q.type==="number"&&G.memoizedProps.value!=null&&pc(Q,"number",Q.value)}switch($e=G?_r(G):window,e){case"focusin":(k0($e)||$e.contentEditable==="true")&&(Ra=$e,Ac=G,Rr=null);break;case"focusout":Rr=Ac=Ra=null;break;case"mousedown":Rc=!0;break;case"contextmenu":case"mouseup":case"dragend":Rc=!1,O0(re,a,se);break;case"selectionchange":if(Kb)break;case"keydown":case"keyup":O0(re,a,se)}var _e;if(Sc)e:{switch(e){case"compositionstart":var Ee="onCompositionStart";break e;case"compositionend":Ee="onCompositionEnd";break e;case"compositionupdate":Ee="onCompositionUpdate";break e}Ee=void 0}else Aa?v0(e,a)&&(Ee="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Ee="onCompositionStart");Ee&&(y0&&a.locale!=="ko"&&(Aa||Ee!=="onCompositionStart"?Ee==="onCompositionEnd"&&Aa&&(_e=h0()):(hn=se,kc="value"in hn?hn.value:hn.textContent,Aa=!0)),$e=eo(G,Ee),0<$e.length&&(Ee=new m0(Ee,e,null,a,se),re.push({event:Ee,listeners:$e}),_e?Ee.data=_e:(_e=w0(a),_e!==null&&(Ee.data=_e)))),(_e=Bb?Fb(e,a):Vb(e,a))&&(Ee=eo(G,"onBeforeInput"),0<Ee.length&&($e=new m0("onBeforeInput","beforeinput",null,a,se),re.push({event:$e,listeners:Ee}),$e.data=_e)),Ov(re,e,G,a,se)}am(re,s)})}function ll(e,s,a){return{instance:e,listener:s,currentTarget:a}}function eo(e,s){for(var a=s+"Capture",o=[];e!==null;){var u=e,g=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||g===null||(u=Nr(e,a),u!=null&&o.unshift(ll(e,u,g)),u=Nr(e,s),u!=null&&o.push(ll(e,u,g))),e.tag===3)return o;e=e.return}return[]}function sr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function lm(e,s,a,o,u){for(var g=s._reactName,y=[];a!==null&&a!==o;){var v=a,S=v.alternate,G=v.stateNode;if(v=v.tag,S!==null&&S===o)break;v!==5&&v!==26&&v!==27||G===null||(S=G,u?(G=Nr(a,g),G!=null&&y.unshift(ll(a,G,S))):u||(G=Nr(a,g),G!=null&&y.push(ll(a,G,S)))),a=a.return}y.length!==0&&e.push({event:s,listeners:y})}var Lv=/\r\n?/g,Hv=/\u0000|\uFFFD/g;function im(e){return(typeof e=="string"?e:""+e).replace(Lv,`
`).replace(Hv,"")}function om(e,s){return s=im(s),im(e)===s}function to(){}function tt(e,s,a,o,u,g){switch(a){case"children":typeof o=="string"?s==="body"||s==="textarea"&&o===""||Da(e,o):(typeof o=="number"||typeof o=="bigint")&&s!=="body"&&Da(e,""+o);break;case"className":li(e,"class",o);break;case"tabIndex":li(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":li(e,a,o);break;case"style":c0(e,o,g);break;case"data":if(s!=="object"){li(e,"data",o);break}case"src":case"href":if(o===""&&(s!=="a"||a!=="href")){e.removeAttribute(a);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=ci(""+o),e.setAttribute(a,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(a==="formAction"?(s!=="input"&&tt(e,s,"name",u.name,u,null),tt(e,s,"formEncType",u.formEncType,u,null),tt(e,s,"formMethod",u.formMethod,u,null),tt(e,s,"formTarget",u.formTarget,u,null)):(tt(e,s,"encType",u.encType,u,null),tt(e,s,"method",u.method,u,null),tt(e,s,"target",u.target,u,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=ci(""+o),e.setAttribute(a,o);break;case"onClick":o!=null&&(e.onclick=to);break;case"onScroll":o!=null&&Ve("scroll",e);break;case"onScrollEnd":o!=null&&Ve("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(i(61));if(a=o.__html,a!=null){if(u.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}a=ci(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""+o):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":o===!0?e.setAttribute(a,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,o):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(a,o):e.removeAttribute(a);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(a):e.setAttribute(a,o);break;case"popover":Ve("beforetoggle",e),Ve("toggle",e),ri(e,"popover",o);break;case"xlinkActuate":Bs(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":Bs(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":Bs(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":Bs(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":Bs(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":Bs(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":Bs(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":Bs(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":Bs(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":ri(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=fb.get(a)||a,ri(e,a,o))}}function tu(e,s,a,o,u,g){switch(a){case"style":c0(e,o,g);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(i(61));if(a=o.__html,a!=null){if(u.children!=null)throw Error(i(60));e.innerHTML=a}}break;case"children":typeof o=="string"?Da(e,o):(typeof o=="number"||typeof o=="bigint")&&Da(e,""+o);break;case"onScroll":o!=null&&Ve("scroll",e);break;case"onScrollEnd":o!=null&&Ve("scrollend",e);break;case"onClick":o!=null&&(e.onclick=to);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Zh.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(u=a.endsWith("Capture"),s=a.slice(2,u?a.length-7:void 0),g=e[Gt]||null,g=g!=null?g[a]:null,typeof g=="function"&&e.removeEventListener(s,g,u),typeof o=="function")){typeof g!="function"&&g!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(s,o,u);break e}a in e?e[a]=o:o===!0?e.setAttribute(a,""):ri(e,a,o)}}}function Lt(e,s,a){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ve("error",e),Ve("load",e);var o=!1,u=!1,g;for(g in a)if(a.hasOwnProperty(g)){var y=a[g];if(y!=null)switch(g){case"src":o=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:tt(e,s,g,y,a,null)}}u&&tt(e,s,"srcSet",a.srcSet,a,null),o&&tt(e,s,"src",a.src,a,null);return;case"input":Ve("invalid",e);var v=g=y=u=null,S=null,G=null;for(o in a)if(a.hasOwnProperty(o)){var se=a[o];if(se!=null)switch(o){case"name":u=se;break;case"type":y=se;break;case"checked":S=se;break;case"defaultChecked":G=se;break;case"value":g=se;break;case"defaultValue":v=se;break;case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(i(137,s));break;default:tt(e,s,o,se,a,null)}}r0(e,g,v,S,G,y,u,!1),ii(e);return;case"select":Ve("invalid",e),o=y=g=null;for(u in a)if(a.hasOwnProperty(u)&&(v=a[u],v!=null))switch(u){case"value":g=v;break;case"defaultValue":y=v;break;case"multiple":o=v;default:tt(e,s,u,v,a,null)}s=g,a=y,e.multiple=!!o,s!=null?Sa(e,!!o,s,!1):a!=null&&Sa(e,!!o,a,!0);return;case"textarea":Ve("invalid",e),g=u=o=null;for(y in a)if(a.hasOwnProperty(y)&&(v=a[y],v!=null))switch(y){case"value":o=v;break;case"defaultValue":u=v;break;case"children":g=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(i(91));break;default:tt(e,s,y,v,a,null)}i0(e,o,u,g),ii(e);return;case"option":for(S in a)if(a.hasOwnProperty(S)&&(o=a[S],o!=null))switch(S){case"selected":e.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:tt(e,s,S,o,a,null)}return;case"dialog":Ve("beforetoggle",e),Ve("toggle",e),Ve("cancel",e),Ve("close",e);break;case"iframe":case"object":Ve("load",e);break;case"video":case"audio":for(o=0;o<rl.length;o++)Ve(rl[o],e);break;case"image":Ve("error",e),Ve("load",e);break;case"details":Ve("toggle",e);break;case"embed":case"source":case"link":Ve("error",e),Ve("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(G in a)if(a.hasOwnProperty(G)&&(o=a[G],o!=null))switch(G){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:tt(e,s,G,o,a,null)}return;default:if(yc(s)){for(se in a)a.hasOwnProperty(se)&&(o=a[se],o!==void 0&&tu(e,s,se,o,a,void 0));return}}for(v in a)a.hasOwnProperty(v)&&(o=a[v],o!=null&&tt(e,s,v,o,a,null))}function $v(e,s,a,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,g=null,y=null,v=null,S=null,G=null,se=null;for(X in a){var re=a[X];if(a.hasOwnProperty(X)&&re!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":S=re;default:o.hasOwnProperty(X)||tt(e,s,X,null,o,re)}}for(var Q in o){var X=o[Q];if(re=a[Q],o.hasOwnProperty(Q)&&(X!=null||re!=null))switch(Q){case"type":g=X;break;case"name":u=X;break;case"checked":G=X;break;case"defaultChecked":se=X;break;case"value":y=X;break;case"defaultValue":v=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(137,s));break;default:X!==re&&tt(e,s,Q,X,o,re)}}mc(e,y,v,S,G,se,g,u);return;case"select":X=y=v=Q=null;for(g in a)if(S=a[g],a.hasOwnProperty(g)&&S!=null)switch(g){case"value":break;case"multiple":X=S;default:o.hasOwnProperty(g)||tt(e,s,g,null,o,S)}for(u in o)if(g=o[u],S=a[u],o.hasOwnProperty(u)&&(g!=null||S!=null))switch(u){case"value":Q=g;break;case"defaultValue":v=g;break;case"multiple":y=g;default:g!==S&&tt(e,s,u,g,o,S)}s=v,a=y,o=X,Q!=null?Sa(e,!!a,Q,!1):!!o!=!!a&&(s!=null?Sa(e,!!a,s,!0):Sa(e,!!a,a?[]:"",!1));return;case"textarea":X=Q=null;for(v in a)if(u=a[v],a.hasOwnProperty(v)&&u!=null&&!o.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:tt(e,s,v,null,o,u)}for(y in o)if(u=o[y],g=a[y],o.hasOwnProperty(y)&&(u!=null||g!=null))switch(y){case"value":Q=u;break;case"defaultValue":X=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(i(91));break;default:u!==g&&tt(e,s,y,u,o,g)}l0(e,Q,X);return;case"option":for(var Me in a)if(Q=a[Me],a.hasOwnProperty(Me)&&Q!=null&&!o.hasOwnProperty(Me))switch(Me){case"selected":e.selected=!1;break;default:tt(e,s,Me,null,o,Q)}for(S in o)if(Q=o[S],X=a[S],o.hasOwnProperty(S)&&Q!==X&&(Q!=null||X!=null))switch(S){case"selected":e.selected=Q&&typeof Q!="function"&&typeof Q!="symbol";break;default:tt(e,s,S,Q,o,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var De in a)Q=a[De],a.hasOwnProperty(De)&&Q!=null&&!o.hasOwnProperty(De)&&tt(e,s,De,null,o,Q);for(G in o)if(Q=o[G],X=a[G],o.hasOwnProperty(G)&&Q!==X&&(Q!=null||X!=null))switch(G){case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,s));break;default:tt(e,s,G,Q,o,X)}return;default:if(yc(s)){for(var st in a)Q=a[st],a.hasOwnProperty(st)&&Q!==void 0&&!o.hasOwnProperty(st)&&tu(e,s,st,void 0,o,Q);for(se in o)Q=o[se],X=a[se],!o.hasOwnProperty(se)||Q===X||Q===void 0&&X===void 0||tu(e,s,se,Q,o,X);return}}for(var B in a)Q=a[B],a.hasOwnProperty(B)&&Q!=null&&!o.hasOwnProperty(B)&&tt(e,s,B,null,o,Q);for(re in o)Q=o[re],X=a[re],!o.hasOwnProperty(re)||Q===X||Q==null&&X==null||tt(e,s,re,Q,o,X)}var su=null,nu=null;function so(e){return e.nodeType===9?e:e.ownerDocument}function cm(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function dm(e,s){if(e===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&s==="foreignObject"?0:e}function au(e,s){return e==="textarea"||e==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var ru=null;function zv(){var e=window.event;return e&&e.type==="popstate"?e===ru?!1:(ru=e,!0):(ru=null,!1)}var um=typeof setTimeout=="function"?setTimeout:void 0,Bv=typeof clearTimeout=="function"?clearTimeout:void 0,hm=typeof Promise=="function"?Promise:void 0,Fv=typeof queueMicrotask=="function"?queueMicrotask:typeof hm<"u"?function(e){return hm.resolve(null).then(e).catch(Vv)}:um;function Vv(e){setTimeout(function(){throw e})}function Dn(e){return e==="head"}function gm(e,s){var a=s,o=0,u=0;do{var g=a.nextSibling;if(e.removeChild(a),g&&g.nodeType===8)if(a=g.data,a==="/$"){if(0<o&&8>o){a=o;var y=e.ownerDocument;if(a&1&&il(y.documentElement),a&2&&il(y.body),a&4)for(a=y.head,il(a),y=a.firstChild;y;){var v=y.nextSibling,S=y.nodeName;y[kr]||S==="SCRIPT"||S==="STYLE"||S==="LINK"&&y.rel.toLowerCase()==="stylesheet"||a.removeChild(y),y=v}}if(u===0){e.removeChild(g),ml(s);return}u--}else a==="$"||a==="$?"||a==="$!"?u++:o=a.charCodeAt(0)-48;else o=0;a=g}while(a);ml(s)}function lu(e){var s=e.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var a=s;switch(s=s.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":lu(a),uc(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Yv(e,s,a,o){for(;e.nodeType===1;){var u=a;if(e.nodeName.toLowerCase()!==s.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[kr])switch(s){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(s==="input"&&e.type==="hidden"){var g=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=_s(e.nextSibling),e===null)break}return null}function qv(e,s,a){if(s==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=_s(e.nextSibling),e===null))return null;return e}function iu(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState==="complete"}function Gv(e,s){var a=e.ownerDocument;if(e.data!=="$?"||a.readyState==="complete")s();else{var o=function(){s(),a.removeEventListener("DOMContentLoaded",o)};a.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function _s(e){for(;e!=null;e=e.nextSibling){var s=e.nodeType;if(s===1||s===3)break;if(s===8){if(s=e.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return e}var ou=null;function fm(e){e=e.previousSibling;for(var s=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(s===0)return e;s--}else a==="/$"&&s++}e=e.previousSibling}return null}function mm(e,s,a){switch(s=so(a),e){case"html":if(e=s.documentElement,!e)throw Error(i(452));return e;case"head":if(e=s.head,!e)throw Error(i(453));return e;case"body":if(e=s.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function il(e){for(var s=e.attributes;s.length;)e.removeAttributeNode(s[0]);uc(e)}var ys=new Map,pm=new Set;function no(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var tn=ee.d;ee.d={f:Pv,r:Wv,D:Qv,C:Xv,L:Kv,m:Zv,X:ew,S:Jv,M:tw};function Pv(){var e=tn.f(),s=Wi();return e||s}function Wv(e){var s=_a(e);s!==null&&s.tag===5&&s.type==="form"?Ig(s):tn.r(e)}var nr=typeof document>"u"?null:document;function ym(e,s,a){var o=nr;if(o&&typeof s=="string"&&s){var u=ds(s);u='link[rel="'+e+'"][href="'+u+'"]',typeof a=="string"&&(u+='[crossorigin="'+a+'"]'),pm.has(u)||(pm.add(u),e={rel:e,crossOrigin:a,href:s},o.querySelector(u)===null&&(s=o.createElement("link"),Lt(s,"link",e),St(s),o.head.appendChild(s)))}}function Qv(e){tn.D(e),ym("dns-prefetch",e,null)}function Xv(e,s){tn.C(e,s),ym("preconnect",e,s)}function Kv(e,s,a){tn.L(e,s,a);var o=nr;if(o&&e&&s){var u='link[rel="preload"][as="'+ds(s)+'"]';s==="image"&&a&&a.imageSrcSet?(u+='[imagesrcset="'+ds(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(u+='[imagesizes="'+ds(a.imageSizes)+'"]')):u+='[href="'+ds(e)+'"]';var g=u;switch(s){case"style":g=ar(e);break;case"script":g=rr(e)}ys.has(g)||(e=x({rel:"preload",href:s==="image"&&a&&a.imageSrcSet?void 0:e,as:s},a),ys.set(g,e),o.querySelector(u)!==null||s==="style"&&o.querySelector(ol(g))||s==="script"&&o.querySelector(cl(g))||(s=o.createElement("link"),Lt(s,"link",e),St(s),o.head.appendChild(s)))}}function Zv(e,s){tn.m(e,s);var a=nr;if(a&&e){var o=s&&typeof s.as=="string"?s.as:"script",u='link[rel="modulepreload"][as="'+ds(o)+'"][href="'+ds(e)+'"]',g=u;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=rr(e)}if(!ys.has(g)&&(e=x({rel:"modulepreload",href:e},s),ys.set(g,e),a.querySelector(u)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(cl(g)))return}o=a.createElement("link"),Lt(o,"link",e),St(o),a.head.appendChild(o)}}}function Jv(e,s,a){tn.S(e,s,a);var o=nr;if(o&&e){var u=Na(o).hoistableStyles,g=ar(e);s=s||"default";var y=u.get(g);if(!y){var v={loading:0,preload:null};if(y=o.querySelector(ol(g)))v.loading=5;else{e=x({rel:"stylesheet",href:e,"data-precedence":s},a),(a=ys.get(g))&&cu(e,a);var S=y=o.createElement("link");St(S),Lt(S,"link",e),S._p=new Promise(function(G,se){S.onload=G,S.onerror=se}),S.addEventListener("load",function(){v.loading|=1}),S.addEventListener("error",function(){v.loading|=2}),v.loading|=4,ao(y,s,o)}y={type:"stylesheet",instance:y,count:1,state:v},u.set(g,y)}}}function ew(e,s){tn.X(e,s);var a=nr;if(a&&e){var o=Na(a).hoistableScripts,u=rr(e),g=o.get(u);g||(g=a.querySelector(cl(u)),g||(e=x({src:e,async:!0},s),(s=ys.get(u))&&du(e,s),g=a.createElement("script"),St(g),Lt(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},o.set(u,g))}}function tw(e,s){tn.M(e,s);var a=nr;if(a&&e){var o=Na(a).hoistableScripts,u=rr(e),g=o.get(u);g||(g=a.querySelector(cl(u)),g||(e=x({src:e,async:!0,type:"module"},s),(s=ys.get(u))&&du(e,s),g=a.createElement("script"),St(g),Lt(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},o.set(u,g))}}function xm(e,s,a,o){var u=(u=le.current)?no(u):null;if(!u)throw Error(i(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(s=ar(a.href),a=Na(u).hoistableStyles,o=a.get(s),o||(o={type:"style",instance:null,count:0,state:null},a.set(s,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=ar(a.href);var g=Na(u).hoistableStyles,y=g.get(e);if(y||(u=u.ownerDocument||u,y={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,y),(g=u.querySelector(ol(e)))&&!g._p&&(y.instance=g,y.state.loading=5),ys.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},ys.set(e,a),g||sw(u,e,a,y.state))),s&&o===null)throw Error(i(528,""));return y}if(s&&o!==null)throw Error(i(529,""));return null;case"script":return s=a.async,a=a.src,typeof a=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=rr(a),a=Na(u).hoistableScripts,o=a.get(s),o||(o={type:"script",instance:null,count:0,state:null},a.set(s,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,e))}}function ar(e){return'href="'+ds(e)+'"'}function ol(e){return'link[rel="stylesheet"]['+e+"]"}function bm(e){return x({},e,{"data-precedence":e.precedence,precedence:null})}function sw(e,s,a,o){e.querySelector('link[rel="preload"][as="style"]['+s+"]")?o.loading=1:(s=e.createElement("link"),o.preload=s,s.addEventListener("load",function(){return o.loading|=1}),s.addEventListener("error",function(){return o.loading|=2}),Lt(s,"link",a),St(s),e.head.appendChild(s))}function rr(e){return'[src="'+ds(e)+'"]'}function cl(e){return"script[async]"+e}function vm(e,s,a){if(s.count++,s.instance===null)switch(s.type){case"style":var o=e.querySelector('style[data-href~="'+ds(a.href)+'"]');if(o)return s.instance=o,St(o),o;var u=x({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),St(o),Lt(o,"style",u),ao(o,a.precedence,e),s.instance=o;case"stylesheet":u=ar(a.href);var g=e.querySelector(ol(u));if(g)return s.state.loading|=4,s.instance=g,St(g),g;o=bm(a),(u=ys.get(u))&&cu(o,u),g=(e.ownerDocument||e).createElement("link"),St(g);var y=g;return y._p=new Promise(function(v,S){y.onload=v,y.onerror=S}),Lt(g,"link",o),s.state.loading|=4,ao(g,a.precedence,e),s.instance=g;case"script":return g=rr(a.src),(u=e.querySelector(cl(g)))?(s.instance=u,St(u),u):(o=a,(u=ys.get(g))&&(o=x({},a),du(o,u)),e=e.ownerDocument||e,u=e.createElement("script"),St(u),Lt(u,"link",o),e.head.appendChild(u),s.instance=u);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(o=s.instance,s.state.loading|=4,ao(o,a.precedence,e));return s.instance}function ao(e,s,a){for(var o=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=o.length?o[o.length-1]:null,g=u,y=0;y<o.length;y++){var v=o[y];if(v.dataset.precedence===s)g=v;else if(g!==u)break}g?g.parentNode.insertBefore(e,g.nextSibling):(s=a.nodeType===9?a.head:a,s.insertBefore(e,s.firstChild))}function cu(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.title==null&&(e.title=s.title)}function du(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.integrity==null&&(e.integrity=s.integrity)}var ro=null;function wm(e,s,a){if(ro===null){var o=new Map,u=ro=new Map;u.set(a,o)}else u=ro,o=u.get(a),o||(o=new Map,u.set(a,o));if(o.has(e))return o;for(o.set(e,null),a=a.getElementsByTagName(e),u=0;u<a.length;u++){var g=a[u];if(!(g[kr]||g[Ht]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var y=g.getAttribute(s)||"";y=e+y;var v=o.get(y);v?v.push(g):o.set(y,[g])}}return o}function km(e,s,a){e=e.ownerDocument||e,e.head.insertBefore(a,s==="title"?e.querySelector("head > title"):null)}function nw(e,s,a){if(a===1||s.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return e=s.disabled,typeof s.precedence=="string"&&e==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function _m(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}var dl=null;function aw(){}function rw(e,s,a){if(dl===null)throw Error(i(475));var o=dl;if(s.type==="stylesheet"&&(typeof a.media!="string"||matchMedia(a.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var u=ar(a.href),g=e.querySelector(ol(u));if(g){e=g._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(o.count++,o=lo.bind(o),e.then(o,o)),s.state.loading|=4,s.instance=g,St(g);return}g=e.ownerDocument||e,a=bm(a),(u=ys.get(u))&&cu(a,u),g=g.createElement("link"),St(g);var y=g;y._p=new Promise(function(v,S){y.onload=v,y.onerror=S}),Lt(g,"link",a),s.instance=g}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(s,e),(e=s.state.preload)&&(s.state.loading&3)===0&&(o.count++,s=lo.bind(o),e.addEventListener("load",s),e.addEventListener("error",s))}}function lw(){if(dl===null)throw Error(i(475));var e=dl;return e.stylesheets&&e.count===0&&uu(e,e.stylesheets),0<e.count?function(s){var a=setTimeout(function(){if(e.stylesheets&&uu(e,e.stylesheets),e.unsuspend){var o=e.unsuspend;e.unsuspend=null,o()}},6e4);return e.unsuspend=s,function(){e.unsuspend=null,clearTimeout(a)}}:null}function lo(){if(this.count--,this.count===0){if(this.stylesheets)uu(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var io=null;function uu(e,s){e.stylesheets=null,e.unsuspend!==null&&(e.count++,io=new Map,s.forEach(iw,e),io=null,lo.call(e))}function iw(e,s){if(!(s.state.loading&4)){var a=io.get(e);if(a)var o=a.get(null);else{a=new Map,io.set(e,a);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<u.length;g++){var y=u[g];(y.nodeName==="LINK"||y.getAttribute("media")!=="not all")&&(a.set(y.dataset.precedence,y),o=y)}o&&a.set(null,o)}u=s.instance,y=u.getAttribute("data-precedence"),g=a.get(y)||o,g===o&&a.set(null,u),a.set(y,u),this.count++,o=lo.bind(this),u.addEventListener("load",o),u.addEventListener("error",o),g?g.parentNode.insertBefore(u,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),s.state.loading|=4}}var ul={$$typeof:D,Provider:null,Consumer:null,_currentValue:ce,_currentValue2:ce,_threadCount:0};function ow(e,s,a,o,u,g,y,v){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ic(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ic(0),this.hiddenUpdates=ic(null),this.identifierPrefix=o,this.onUncaughtError=u,this.onCaughtError=g,this.onRecoverableError=y,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=v,this.incompleteTransitions=new Map}function Nm(e,s,a,o,u,g,y,v,S,G,se,re){return e=new ow(e,s,a,y,v,S,G,re),s=1,g===!0&&(s|=24),g=ts(3,null,null,s),e.current=g,g.stateNode=e,s=Gc(),s.refCount++,e.pooledCache=s,s.refCount++,g.memoizedState={element:o,isDehydrated:a,cache:s},Xc(g),e}function jm(e){return e?(e=Ua,e):Ua}function Tm(e,s,a,o,u,g){u=jm(u),o.context===null?o.context=u:o.pendingContext=u,o=mn(s),o.payload={element:a},g=g===void 0?null:g,g!==null&&(o.callback=g),a=pn(e,o,s),a!==null&&(ls(a,e,s),Br(a,e,s))}function Sm(e,s){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<s?a:s}}function hu(e,s){Sm(e,s),(e=e.alternate)&&Sm(e,s)}function Dm(e){if(e.tag===13){var s=Ia(e,67108864);s!==null&&ls(s,e,67108864),hu(e,67108864)}}var oo=!0;function cw(e,s,a,o){var u=F.T;F.T=null;var g=ee.p;try{ee.p=2,gu(e,s,a,o)}finally{ee.p=g,F.T=u}}function dw(e,s,a,o){var u=F.T;F.T=null;var g=ee.p;try{ee.p=8,gu(e,s,a,o)}finally{ee.p=g,F.T=u}}function gu(e,s,a,o){if(oo){var u=fu(o);if(u===null)eu(e,s,o,co,a),Cm(e,o);else if(hw(u,e,s,a,o))o.stopPropagation();else if(Cm(e,o),s&4&&-1<uw.indexOf(e)){for(;u!==null;){var g=_a(u);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var y=qn(g.pendingLanes);if(y!==0){var v=g;for(v.pendingLanes|=2,v.entangledLanes|=2;y;){var S=1<<31-Je(y);v.entanglements[1]|=S,y&=~S}Ms(g),(Qe&6)===0&&(Gi=q()+500,al(0))}}break;case 13:v=Ia(g,2),v!==null&&ls(v,g,2),Wi(),hu(g,2)}if(g=fu(o),g===null&&eu(e,s,o,co,a),g===u)break;u=g}u!==null&&o.stopPropagation()}else eu(e,s,o,null,a)}}function fu(e){return e=bc(e),mu(e)}var co=null;function mu(e){if(co=null,e=ka(e),e!==null){var s=d(e);if(s===null)e=null;else{var a=s.tag;if(a===13){if(e=h(s),e!==null)return e;e=null}else if(a===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;e=null}else s!==e&&(e=null)}}return co=e,null}function Em(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(K()){case oe:return 2;case ie:return 8;case te:case Ne:return 32;case pe:return 268435456;default:return 32}default:return 32}}var pu=!1,En=null,Cn=null,An=null,hl=new Map,gl=new Map,Rn=[],uw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Cm(e,s){switch(e){case"focusin":case"focusout":En=null;break;case"dragenter":case"dragleave":Cn=null;break;case"mouseover":case"mouseout":An=null;break;case"pointerover":case"pointerout":hl.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":gl.delete(s.pointerId)}}function fl(e,s,a,o,u,g){return e===null||e.nativeEvent!==g?(e={blockedOn:s,domEventName:a,eventSystemFlags:o,nativeEvent:g,targetContainers:[u]},s!==null&&(s=_a(s),s!==null&&Dm(s)),e):(e.eventSystemFlags|=o,s=e.targetContainers,u!==null&&s.indexOf(u)===-1&&s.push(u),e)}function hw(e,s,a,o,u){switch(s){case"focusin":return En=fl(En,e,s,a,o,u),!0;case"dragenter":return Cn=fl(Cn,e,s,a,o,u),!0;case"mouseover":return An=fl(An,e,s,a,o,u),!0;case"pointerover":var g=u.pointerId;return hl.set(g,fl(hl.get(g)||null,e,s,a,o,u)),!0;case"gotpointercapture":return g=u.pointerId,gl.set(g,fl(gl.get(g)||null,e,s,a,o,u)),!0}return!1}function Am(e){var s=ka(e.target);if(s!==null){var a=d(s);if(a!==null){if(s=a.tag,s===13){if(s=h(a),s!==null){e.blockedOn=s,rb(e.priority,function(){if(a.tag===13){var o=rs();o=oc(o);var u=Ia(a,o);u!==null&&ls(u,a,o),hu(a,o)}});return}}else if(s===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function uo(e){if(e.blockedOn!==null)return!1;for(var s=e.targetContainers;0<s.length;){var a=fu(e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);xc=o,a.target.dispatchEvent(o),xc=null}else return s=_a(a),s!==null&&Dm(s),e.blockedOn=a,!1;s.shift()}return!0}function Rm(e,s,a){uo(e)&&a.delete(s)}function gw(){pu=!1,En!==null&&uo(En)&&(En=null),Cn!==null&&uo(Cn)&&(Cn=null),An!==null&&uo(An)&&(An=null),hl.forEach(Rm),gl.forEach(Rm)}function ho(e,s){e.blockedOn===s&&(e.blockedOn=null,pu||(pu=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,gw)))}var go=null;function Om(e){go!==e&&(go=e,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){go===e&&(go=null);for(var s=0;s<e.length;s+=3){var a=e[s],o=e[s+1],u=e[s+2];if(typeof o!="function"){if(mu(o||a)===null)continue;break}var g=_a(a);g!==null&&(e.splice(s,3),s-=3,md(g,{pending:!0,data:u,method:a.method,action:o},o,u))}}))}function ml(e){function s(S){return ho(S,e)}En!==null&&ho(En,e),Cn!==null&&ho(Cn,e),An!==null&&ho(An,e),hl.forEach(s),gl.forEach(s);for(var a=0;a<Rn.length;a++){var o=Rn[a];o.blockedOn===e&&(o.blockedOn=null)}for(;0<Rn.length&&(a=Rn[0],a.blockedOn===null);)Am(a),a.blockedOn===null&&Rn.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(o=0;o<a.length;o+=3){var u=a[o],g=a[o+1],y=u[Gt]||null;if(typeof g=="function")y||Om(a);else if(y){var v=null;if(g&&g.hasAttribute("formAction")){if(u=g,y=g[Gt]||null)v=y.formAction;else if(mu(u)!==null)continue}else v=y.action;typeof v=="function"?a[o+1]=v:(a.splice(o,3),o-=3),Om(a)}}}function yu(e){this._internalRoot=e}fo.prototype.render=yu.prototype.render=function(e){var s=this._internalRoot;if(s===null)throw Error(i(409));var a=s.current,o=rs();Tm(a,o,e,s,null,null)},fo.prototype.unmount=yu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var s=e.containerInfo;Tm(e.current,2,null,e,null,null),Wi(),s[wa]=null}};function fo(e){this._internalRoot=e}fo.prototype.unstable_scheduleHydration=function(e){if(e){var s=Qh();e={blockedOn:null,target:e,priority:s};for(var a=0;a<Rn.length&&s!==0&&s<Rn[a].priority;a++);Rn.splice(a,0,e),a===0&&Am(e)}};var Mm=t.version;if(Mm!=="19.1.0")throw Error(i(527,Mm,"19.1.0"));ee.findDOMNode=function(e){var s=e._reactInternals;if(s===void 0)throw typeof e.render=="function"?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return e=m(s),e=e!==null?p(e):null,e=e===null?null:e.stateNode,e};var fw={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mo.isDisabled&&mo.supportsFiber)try{he=mo.inject(fw),xe=mo}catch{}}return bl.createRoot=function(e,s){if(!c(e))throw Error(i(299));var a=!1,o="",u=Qg,g=Xg,y=Kg,v=null;return s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onUncaughtError!==void 0&&(u=s.onUncaughtError),s.onCaughtError!==void 0&&(g=s.onCaughtError),s.onRecoverableError!==void 0&&(y=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(v=s.unstable_transitionCallbacks)),s=Nm(e,1,!1,null,null,a,o,u,g,y,v,null),e[wa]=s.current,Jd(e),new yu(s)},bl.hydrateRoot=function(e,s,a){if(!c(e))throw Error(i(299));var o=!1,u="",g=Qg,y=Xg,v=Kg,S=null,G=null;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(y=a.onCaughtError),a.onRecoverableError!==void 0&&(v=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(S=a.unstable_transitionCallbacks),a.formState!==void 0&&(G=a.formState)),s=Nm(e,1,!0,s,a??null,o,u,g,y,v,S,G),s.context=jm(null),a=s.current,o=rs(),o=oc(o),u=mn(o),u.callback=null,pn(a,u,o),a=o,s.current.lanes=a,wr(s,a),Ms(s),e[wa]=s.current,Jd(e),new fo(s)},bl.version="19.1.0",bl}var Pm;function Tk(){if(Pm)return ku.exports;Pm=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(t){console.error(t)}}return l(),ku.exports=jk(),ku.exports}var Sk=Tk();const Dk="modulepreload",Ek=function(l){return"/todolist/"+l},Wm={},Wl=function(t,n,i){let c=Promise.resolve();if(n&&n.length>0){let m=function(p){return Promise.all(p.map(x=>Promise.resolve(x).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),f=h?.nonce||h?.getAttribute("nonce");c=m(n.map(p=>{if(p=Ek(p),p in Wm)return;Wm[p]=!0;const x=p.endsWith(".css"),b=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const w=document.createElement("link");if(w.rel=x?"stylesheet":Dk,x||(w.as="script"),w.crossOrigin="",w.href=p,f&&w.setAttribute("nonce",f),document.head.appendChild(w),x)return new Promise((C,T)=>{w.addEventListener("load",C),w.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${p}`)))})}))}function d(h){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=h,window.dispatchEvent(f),!f.defaultPrevented)throw h}return c.then(h=>{for(const f of h||[])f.status==="rejected"&&d(f.reason);return t().catch(d)})};function _o(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}function Ck(l){return l.toLocaleString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function Ak(l,t){const n=new Date,i=new Date(l);if(t){const[c,d]=t.split(":");i.setHours(parseInt(c),parseInt(d))}else i.setHours(23,59,59,999);return i<n}function Rk(l){switch(l){case"low":return"text-green-600 bg-green-50 border-green-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"urgent":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}}function Ok(l){switch(l){case"low":return"";case"medium":return"";case"high":return"";case"urgent":return"";default:return""}}function Ql(l){switch(l){case 1:return"";case 2:return"";case 3:return"";case 4:return"";case 5:return"";case-1:return"";default:return`${l}`}}function Mk(l){return{2024:["2024-01-01","2024-02-09","2024-02-10","2024-02-11","2024-02-12","2024-03-01","2024-04-10","2024-05-05","2024-05-06","2024-05-15","2024-06-06","2024-08-15","2024-09-16","2024-09-17","2024-09-18","2024-10-03","2024-10-09","2024-12-25"],2025:["2025-01-01","2025-01-28","2025-01-29","2025-01-30","2025-03-01","2025-05-05","2025-05-13","2025-06-06","2025-08-15","2025-10-05","2025-10-06","2025-10-07","2025-10-08","2025-10-03","2025-10-09","2025-12-25"],2026:["2026-01-01","2026-02-16","2026-02-17","2026-02-18","2026-03-01","2026-05-05","2026-05-02","2026-06-06","2026-08-15","2026-09-24","2026-09-25","2026-09-26","2026-10-03","2026-10-09","2026-12-25"]}[l.toString()]||[]}function Ik(l){return{2024:[{date:"2024-01-01",name:"",isHoliday:!0},{date:"2024-02-09",name:"",isHoliday:!0},{date:"2024-02-10",name:"",isHoliday:!0},{date:"2024-02-11",name:"",isHoliday:!0},{date:"2024-02-12",name:"",isHoliday:!0},{date:"2024-03-01",name:"",isHoliday:!0},{date:"2024-04-10",name:"",isHoliday:!0},{date:"2024-05-05",name:"",isHoliday:!0},{date:"2024-05-06",name:"",isHoliday:!0},{date:"2024-05-15",name:"",isHoliday:!0},{date:"2024-06-06",name:"",isHoliday:!0},{date:"2024-08-15",name:"",isHoliday:!0},{date:"2024-09-16",name:"",isHoliday:!0},{date:"2024-09-17",name:"",isHoliday:!0},{date:"2024-09-18",name:"",isHoliday:!0},{date:"2024-10-03",name:"",isHoliday:!0},{date:"2024-10-09",name:"",isHoliday:!0},{date:"2024-12-25",name:"",isHoliday:!0}],2025:[{date:"2025-01-01",name:"",isHoliday:!0},{date:"2025-01-28",name:"",isHoliday:!0},{date:"2025-01-29",name:"",isHoliday:!0},{date:"2025-01-30",name:"",isHoliday:!0},{date:"2025-03-01",name:"",isHoliday:!0},{date:"2025-05-05",name:"",isHoliday:!0},{date:"2025-05-13",name:"",isHoliday:!0},{date:"2025-06-06",name:"",isHoliday:!0},{date:"2025-08-15",name:"",isHoliday:!0},{date:"2025-10-05",name:"",isHoliday:!0},{date:"2025-10-06",name:"",isHoliday:!0},{date:"2025-10-07",name:"",isHoliday:!0},{date:"2025-10-08",name:"",isHoliday:!0},{date:"2025-10-03",name:"",isHoliday:!0},{date:"2025-10-09",name:"",isHoliday:!0},{date:"2025-12-25",name:"",isHoliday:!0}],2026:[{date:"2026-01-01",name:"",isHoliday:!0},{date:"2026-02-16",name:"",isHoliday:!0},{date:"2026-02-17",name:"",isHoliday:!0},{date:"2026-02-18",name:"",isHoliday:!0},{date:"2026-03-01",name:"",isHoliday:!0},{date:"2026-05-05",name:"",isHoliday:!0},{date:"2026-05-02",name:"",isHoliday:!0},{date:"2026-06-06",name:"",isHoliday:!0},{date:"2026-08-15",name:"",isHoliday:!0},{date:"2026-09-24",name:"",isHoliday:!0},{date:"2026-09-25",name:"",isHoliday:!0},{date:"2026-09-26",name:"",isHoliday:!0},{date:"2026-10-03",name:"",isHoliday:!0},{date:"2026-10-09",name:"",isHoliday:!0},{date:"2026-12-25",name:"",isHoliday:!0}]}[l.toString()]||[]}function gy(l){const t=l.getFullYear(),n=(l.getMonth()+1).toString().padStart(2,"0"),i=l.getDate().toString().padStart(2,"0"),c=`${t}-${n}-${i}`;return Mk(t).includes(c)}function Un(l){const t=l.getDay();return t===0||t===6}function fy(l){return Un(l)||gy(l)}function dh(l){const t=l.getFullYear(),n=(l.getMonth()+1).toString().padStart(2,"0"),i=l.getDate().toString().padStart(2,"0"),c=`${t}-${n}-${i}`;return Ik(t).find(h=>h.date===c)||null}function my(l,t){const n=new Date(l,t-1,1);let i=new Date(n);for(;fy(i);)i.setDate(i.getDate()+1);return i}function py(l,t){const n=new Date(l,t,0);let i=new Date(n);for(;fy(i);)i.setDate(i.getDate()-1);return i}function Co(l,t){if(gy(l))return!0;const n=l.getFullYear(),i=(l.getMonth()+1).toString().padStart(2,"0"),c=l.getDate().toString().padStart(2,"0"),d=`${n}-${i}-${c}`,h=`${i}-${c}`;return t.some(f=>{if(!!f.isRecurring){const p=f.date.split("-");if(p.length===3){const x=p[1].padStart(2,"0"),b=p[2].padStart(2,"0");return`${x}-${b}`===h}return f.date.endsWith(h)}return f.date===d})}class Uk{templates=[];setTemplates(t){this.templates=t}hasConflictingInstance(t,n,i){const c=this.templates.find(h=>h.title===i.targetTemplateTitle&&h.id!==n);if(!c)return!1;const d=this.generateInstancesForTemplate(c);for(const h of d)if(this.checkDateConflict(t,h.date,i.scope))return console.log(`[Conflict] ${t.toDateString()} ${c.title}()  `),!0;return!1}checkDateConflict(t,n,i){switch(i){case"same_date":return t.toDateString()===n.toDateString();case"same_week":const c=new Date(t);c.setDate(t.getDate()-t.getDay());const d=new Date(n);return d.setDate(n.getDate()-n.getDay()),c.toDateString()===d.toDateString();case"same_month":return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth();default:return!1}}generateInstancesForTemplate(t,n=[]){if(!t.isActive)return[];switch(t.recurrenceType){case"daily":return this.generateDailyInstancesRaw(t,n);case"weekly":return this.generateWeeklyInstancesRaw(t,n);case"monthly":return this.generateMonthlyInstancesRaw(t,n);default:return[]}}calculateWeekOfMonth(t){const n=t.getFullYear(),i=t.getMonth(),c=t.getDate();console.log(`calculateWeekOfMonth: ${t.toDateString()}, year=${n}, month=${i+1}, day=${c}`);const d=new Date(n,i,1),h=new Date(n,i+1,0),f=d.getDay(),m=Math.ceil((c+f)/7),p=h.getDate(),x=Math.ceil((p+f)/7);return console.log(`  firstWeekday=${f}, weekOfMonth=${m}, totalWeeks=${x}`),m===x?(console.log("   : -1 "),-1):(console.log(`   : ${m} `),m)}isLastOccurrenceOfWeekdayInMonth(t){const n=t.getFullYear(),i=t.getMonth(),c=t.getDay(),d=new Date(n,i+1,0);for(let h=d.getDate();h>=1;h--){const f=new Date(n,i,h);if(f.getDay()===c){const m=t.getDate()===h;return console.log(`  ${t.toDateString()}:  (${c})   ${f.toDateString()}, : ${m}`),m}}return!1}adjustForHolidays(t,n="show",i=[]){let c=new Date(t);if(n==="show")return console.log(`  'show' : ${c.toDateString()}  `),c;console.log(`   : ${t.toDateString()}, : ${n}`);const d=Co(c,i),h=Un(c);if(console.log(`     : =${d}, =${h}`),!d&&!h)return console.log("       "),c;c.getMonth();let f=0;const m=15;for(;f<m;){n==="before"?(c.setDate(c.getDate()-1),console.log(`     : ${c.toDateString()}`)):(c.setDate(c.getDate()+1),console.log(`     : ${c.toDateString()}`));const p=Co(c,i),x=Un(c);if(console.log(`   : =${p}, =${x}`),!p&&!x){console.log(`     : ${c.toDateString()}`);break}f++}return f>=m?(console.warn(`      (${m}),   `),console.log(`     : ${t.toDateString()}`),t):(console.log(`   : ${t.toDateString()}  ${c.toDateString()}`),c)}hasDuplicateOnDate(t,n,i){return!1}isExceptionDate(t,n,i){if(!n||n.length===0)return!1;for(const c of n)switch(c.type){case"date":const d=t.getDate();if(c.values.includes(d))return!0;break;case"weekday":const h=t.getDay();if(c.values.includes(h))return!0;break;case"week":const f=this.calculateWeekOfMonth(t);if(console.log(" :",t.toDateString(),":",f," :",c.values),c.values.includes(-1)){const p=this.isLastOccurrenceOfWeekdayInMonth(t);if(console.log(" :",t.toDateString(),"   :",p),p)return console.log("   ():",t.toDateString()),!0}if(c.values.includes(f))return console.log("  :",t.toDateString(),":",f),!0;break;case"month":const m=t.getMonth()+1;if(c.values.includes(m))return!0;break;case"conflict":if(i){const p=c.values;for(const x of p)if(console.log("  :",t.toDateString(),x),this.hasConflictingInstance(t,i,x))return console.log("   :",t.toDateString()),!0}break}return!1}generateDailyInstancesRaw(t,n=[]){if(t.recurrenceType!=="daily")return[];const i=[],c=new Date,d=new Date(t.createdAt),h=new Date(c);h.setFullYear(c.getFullYear()+1);let f=new Date(d);for(;f<=h;){const m=new Date(c.getFullYear(),c.getMonth(),c.getDate());if(new Date(f.getFullYear(),f.getMonth(),f.getDate())>=m&&!this.isExceptionDate(f,t.exceptions,t.id)){const x=t.holidayHandling||"show",b=this.adjustForHolidays(f,x,n);if(!this.hasDuplicateOnDate(b,t.id,t.title)){const w=`${b.getFullYear()}-${(b.getMonth()+1).toString().padStart(2,"0")}-${b.getDate().toString().padStart(2,"0")}`,C=`${t.id}_${w}`;i.push({id:C,templateId:t.id,date:b,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3})}}f.setDate(f.getDate()+1)}return i}generateWeeklyInstancesRaw(t,n=[]){if(t.recurrenceType!=="weekly"||t.weekday===void 0)return[];const i=[],c=new Date,d=new Date(t.createdAt),h=new Date(c);h.setFullYear(c.getFullYear()+1);const f=t.weekday;let m=new Date(d);const p=(f-d.getDay()+7)%7;p>0&&m.setDate(d.getDate()+p);let x=new Date(m);for(;x<=h;){const b=new Date(c.getFullYear(),c.getMonth(),c.getDate());if(new Date(x.getFullYear(),x.getMonth(),x.getDate())>=b&&!this.isExceptionDate(x,t.exceptions,t.id)){const C=t.holidayHandling||"show";console.log(`[${t.title}]  : ${x.toDateString()},  : ${C}`),console.log(`[${t.title}]   :`,t);const T=dh(x)!==null,z=Un(x);console.log(`[${t.title}]  : ${T},  : ${z}`);const W=this.adjustForHolidays(x,C,n);if(W.getTime()!==x.getTime()&&console.log(`[${t.title}]  : ${x.toDateString()}  ${W.toDateString()}`),this.hasDuplicateOnDate(W,t.id,t.title))console.log(`     : "${t.title}" - ${W.toDateString()}`);else{const k=`${W.getFullYear()}-${(W.getMonth()+1).toString().padStart(2,"0")}-${W.getDate().toString().padStart(2,"0")}`,R=`${t.id}_${k}`;t.title.includes("")&&(console.log("   :"),console.log(`    : ${W.toDateString()} (${W.getDate()})`),console.log(`    ID: ${R}`)),i.push({id:R,templateId:t.id,date:W,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3})}}x.setDate(x.getDate()+7)}return i}findNthWeekdayOfMonth(t,n,i,c){const d=new Date(t,n-1,1),h=d.getDay();if(console.log(`   findNthWeekdayOfMonth: ${t} ${n}, ${i}  ${["","","","","","",""][c]}`),console.log(`    : ${d.toDateString()},   : ${["","","","","","",""][h]}`),i==="last"){const f=new Date(t,n,0);console.log(`    : ${f.toDateString()}`);for(let m=f.getDate();m>=1;m--){const p=new Date(t,n-1,m);if(p.getDay()===c)return console.log(`    ${["","","","","","",""][c]}: ${p.toDateString()}`),p}}else{const m={first:1,second:2,third:3,fourth:4}[i];let p=(c-h+7)%7,x=new Date(t,n-1,1+p);console.log(`     ${["","","","","","",""][c]}: ${x.toDateString()}`);let b=new Date(x);return b.setDate(b.getDate()+(m-1)*7),console.log(`   ${m} ${["","","","","","",""][c]}: ${b.toDateString()}`),b.getMonth()===n-1?b:(console.log(`    ${m}    `),null)}return null}generateMonthlyInstancesRaw(t,n=[]){if(t.recurrenceType!=="monthly")return[];console.log(`
 [${t.title}]     `),console.log("     :",JSON.stringify(t,null,2)),console.log(`   monthlyDate: ${t.monthlyDate}`),console.log(`   monthlyPattern: ${t.monthlyPattern}`),console.log(`   monthlyWeek: ${t.monthlyWeek}`),console.log(`   monthlyWeekday: ${t.monthlyWeekday}`);const i=[],c=new Set,d=new Date,h=d.getFullYear(),f=d.getMonth()+1,m=d.getDate();console.log(`   : ${h} ${f} ${m}`);for(let p=0;p<12;p++){let x=h,b=f+p;b>12&&(x+=Math.floor((b-1)/12),b=(b-1)%12+1),console.log(`
  : ${x} ${b}`);let w=null;if(t.monthlyPattern==="weekday"&&t.monthlyWeek&&t.monthlyWeekday!==void 0)console.log(`   :  ${t.monthlyWeek}  ${["","","","","","",""][t.monthlyWeekday]}`),w=this.findNthWeekdayOfMonth(x,b,t.monthlyWeek,t.monthlyWeekday),console.log(w?`   ${t.monthlyWeek}  ${["","","","","","",""][t.monthlyWeekday]}: ${w.toDateString()}`:`    ${x} ${b} ${t.monthlyWeek}  ${["","","","","","",""][t.monthlyWeekday]} `);else if(t.monthlyDate===-1)w=new Date(x,b,0),console.log(`   : ${w.toDateString()}`);else if(t.monthlyDate===-2)w=my(x,b),console.log(`     : ${w.toDateString()}`);else if(t.monthlyDate===-3)w=py(x,b),console.log(`    : ${w.toDateString()}`);else if(t.monthlyDate&&t.monthlyDate>0){if(w=new Date(x,b-1,t.monthlyDate),w.getMonth()!==b-1){console.log(`    ${x} ${b} ${t.monthlyDate} `);continue}console.log(`     ${t.monthlyDate}: ${w.toDateString()}`)}else w=new Date(x,b-1,1),console.log(`    ( 1): ${w.toDateString()}`);if(!w){console.log("      ");continue}const C=new Date(h,f-1,m);if(w<C){console.log(`      : ${w.toDateString()}`);continue}let T=w;if(t.monthlyDate&&t.monthlyDate>0){const k=t.holidayHandling||"show";T=this.adjustForHolidays(w,k,n),T.getTime()!==w.getTime()&&console.log(`     : ${w.toDateString()}  ${T.toDateString()}`)}if(this.isExceptionDate(T,t.exceptions,t.id)){console.log(`      : ${T.toDateString()}`);continue}const z=`${T.getFullYear()}-${(T.getMonth()+1).toString().padStart(2,"0")}-${T.getDate().toString().padStart(2,"0")}`;if(c.has(z)){console.log(`     : ${z}  `);continue}const W=`${t.id}_${z}`;c.add(z),i.push({id:W,templateId:t.id,date:T,completed:!1,createdAt:new Date,updatedAt:new Date,order:-1e3}),console.log(`     : ${T.toDateString()} (ID: ${W})`)}return console.log(` [${t.title}]  ${i.length}   `),i}calculateMonthlyWeekday(t,n,i,c){const d=n-1,h=new Date(t,d+1,0);if(console.log(` calculateMonthlyWeekday: ${t} ${n} ${i}  ${["","","","","","",""][c]}`),console.log(`    : ${h.getDate()}`),i==="last"){console.log(`   ${["","","","","","",""][c]}  ...`);for(let f=h.getDate();f>=1;f--){const m=new Date(t,d,f);if(m.getDay()===c)return console.log(`  ${["","","","","","",""][c]} : ${m.getFullYear()} ${m.getMonth()+1} ${m.getDate()}`),m}}else{const m={first:1,second:2,third:3,fourth:4}[i];let p=0;for(let x=1;x<=h.getDate();x++){const b=new Date(t,d,x);if(b.getDay()===c&&(p++,p===m))return b}}return null}generateDailyInstances(t,n=[]){return this.generateDailyInstancesRaw(t,n)}generateWeeklyInstances(t,n=[]){return this.generateWeeklyInstancesRaw(t,n)}generateMonthlyInstances(t,n=[]){return this.generateMonthlyInstancesRaw(t,n)}generateInstances(t,n=[]){if(!t.isActive)return[];let i=[];switch(t.recurrenceType){case"daily":i=this.generateDailyInstances(t,n);break;case"weekly":i=this.generateWeeklyInstances(t,n);break;case"monthly":i=this.generateMonthlyInstances(t,n);break;default:return[]}return this.removeDuplicateInstances(i)}removeDuplicateInstances(t){const n=new Map;for(const i of t){const c=`${i.templateId}_${i.date.toDateString()}`;(!n.has(c)||n.get(c).createdAt<i.createdAt)&&(n.has(c)&&console.log(`   : ${i.date.toDateString()}`),n.set(c,i))}return Array.from(n.values()).sort((i,c)=>i.date.getTime()-c.date.getTime())}convertToTodo(t,n){const i=`recurring_${t.id}`;t.id==="PUH4xT3lVY5aK2vuQyUe_2025-08-21"&&(console.log(" convertToTodo  - "),console.log("   instance.completed:",t.completed,typeof t.completed),console.log("   instance :",JSON.stringify(t,null,2)),console.log("   :",n.title)),n.title.includes("")&&console.log("  convertToTodo - ID:",t.id,":",t.completed);const c=n.title.includes("")||n.title.includes(" ")||n.title.includes("")||n.title.includes(" "),d=c?"urgent":n.priority;c&&n.priority!=="urgent"&&console.log(`    : ${n.priority}  urgent`);const h={id:i,title:n.title,description:n.description,completed:t.completed,priority:d,type:n.type,dueDate:void 0,startDate:t.date,createdAt:t.createdAt,updatedAt:t.updatedAt,completedAt:t.completedAt,tags:[...n.tags||[]],order:t.order,_isRecurringInstance:!0,_instanceId:t.id,_templateId:n.id};return t.id==="PUH4xT3lVY5aK2vuQyUe_2025-08-21"&&(console.log(" convertToTodo  - "),console.log("   todo.completed:",h.completed,typeof h.completed),console.log("   todo :",JSON.stringify(h,null,2))),h}getTodayInstances(t){const i=new Date().toDateString();return t.filter(c=>c.date.toDateString()===i)}getWeekInstances(t){const n=new Date,i=new Date(n);i.setDate(n.getDate()-n.getDay());const c=new Date(i);return c.setDate(i.getDate()+6),t.filter(d=>d.date>=i&&d.date<=c)}getMonthInstances(t){const n=new Date,i=new Date(n.getFullYear(),n.getMonth(),1),c=new Date(n.getFullYear(),n.getMonth()+1,0);return t.filter(d=>d.date>=i&&d.date<=c)}removeDuplicateTodos(t){const n=new Map,i=[];for(const h of t){if(!h._isRecurringInstance){i.push(h);continue}const f=`${h.title}_${h.dueDate?.toDateString()||"no-date"}`;n.has(f)?console.log(`    : "${h.title}" - ${h.dueDate?.toDateString()}`):(n.set(f,h),console.log(`   : "${h.title}" - ${h.dueDate?.toDateString()}`))}const c=Array.from(n.values()),d=[...i,...c];return console.log(`   : ${t.length}  ${d.length} (${t.length-d.length} )`),d.sort((h,f)=>{const m=h.order||0,p=f.order||0;if(m!==p)return m-p;const x=h.dueDate||new Date(0),b=f.dueDate||new Date(0);return x.getTime()-b.getTime()})}}const ir=new Uk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy="firebasestorage.googleapis.com",Lk="storageBucket",Hk=120*1e3,$k=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs extends zw{constructor(t,n,i=0){super(ju(t),`Firebase Storage: ${n} (${ju(t)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,zs.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return ju(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Hs;(function(l){l.UNKNOWN="unknown",l.OBJECT_NOT_FOUND="object-not-found",l.BUCKET_NOT_FOUND="bucket-not-found",l.PROJECT_NOT_FOUND="project-not-found",l.QUOTA_EXCEEDED="quota-exceeded",l.UNAUTHENTICATED="unauthenticated",l.UNAUTHORIZED="unauthorized",l.UNAUTHORIZED_APP="unauthorized-app",l.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",l.INVALID_CHECKSUM="invalid-checksum",l.CANCELED="canceled",l.INVALID_EVENT_NAME="invalid-event-name",l.INVALID_URL="invalid-url",l.INVALID_DEFAULT_BUCKET="invalid-default-bucket",l.NO_DEFAULT_BUCKET="no-default-bucket",l.CANNOT_SLICE_BLOB="cannot-slice-blob",l.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",l.NO_DOWNLOAD_URL="no-download-url",l.INVALID_ARGUMENT="invalid-argument",l.INVALID_ARGUMENT_COUNT="invalid-argument-count",l.APP_DELETED="app-deleted",l.INVALID_ROOT_OPERATION="invalid-root-operation",l.INVALID_FORMAT="invalid-format",l.INTERNAL_ERROR="internal-error",l.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Hs||(Hs={}));function ju(l){return"storage/"+l}function zk(){const l="An unknown error occurred, please check the error payload for server response.";return new zs(Hs.UNKNOWN,l)}function Bk(){return new zs(Hs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Fk(){return new zs(Hs.CANCELED,"User canceled the upload/download.")}function Vk(l){return new zs(Hs.INVALID_URL,"Invalid URL '"+l+"'.")}function Yk(l){return new zs(Hs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+l+"'.")}function Qm(l){return new zs(Hs.INVALID_ARGUMENT,l)}function xy(){return new zs(Hs.APP_DELETED,"The Firebase app was deleted.")}function qk(l){return new zs(Hs.INVALID_ROOT_OPERATION,"The operation '"+l+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(t,n){this.bucket=t,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,n){let i;try{i=Ts.makeFromUrl(t,n)}catch{return new Ts(t,"")}if(i.path==="")return i;throw Yk(t)}static makeFromUrl(t,n){let i=null;const c="([A-Za-z0-9.\\-_]+)";function d(E){E.path.charAt(E.path.length-1)==="/"&&(E.path_=E.path_.slice(0,-1))}const h="(/(.*))?$",f=new RegExp("^gs://"+c+h,"i"),m={bucket:1,path:3};function p(E){E.path_=decodeURIComponent(E.path)}const x="v[A-Za-z0-9_]+",b=n.replace(/[.]/g,"\\."),w="(/([^?#]*).*)?$",C=new RegExp(`^https?://${b}/${x}/b/${c}/o${w}`,"i"),T={bucket:1,path:3},z=n===yy?"(?:storage.googleapis.com|storage.cloud.google.com)":n,W="([^?#]*)",k=new RegExp(`^https?://${z}/${c}/${W}`,"i"),D=[{regex:f,indices:m,postModify:d},{regex:C,indices:T,postModify:p},{regex:k,indices:{bucket:1,path:2},postModify:p}];for(let E=0;E<D.length;E++){const O=D[E],P=O.regex.exec(t);if(P){const $=P[O.indices.bucket];let J=P[O.indices.path];J||(J=""),i=new Ts($,J),O.postModify(i);break}}if(i==null)throw Vk(t);return i}}class Gk{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pk(l,t,n){let i=1,c=null,d=null,h=!1,f=0;function m(){return f===2}let p=!1;function x(...W){p||(p=!0,t.apply(null,W))}function b(W){c=setTimeout(()=>{c=null,l(C,m())},W)}function w(){d&&clearTimeout(d)}function C(W,...k){if(p){w();return}if(W){w(),x.call(null,W,...k);return}if(m()||h){w(),x.call(null,W,...k);return}i<64&&(i*=2);let D;f===1?(f=2,D=0):D=(i+Math.random())*1e3,b(D)}let T=!1;function z(W){T||(T=!0,w(),!p&&(c!==null?(W||(f=2),clearTimeout(c),b(0)):W||(f=1)))}return b(0),d=setTimeout(()=>{h=!0,z(!0)},n),z}function Wk(l){l(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(l){return l!==void 0}function Xm(l,t,n,i){if(i<t)throw Qm(`Invalid value for '${l}'. Expected ${t} or greater.`);if(i>n)throw Qm(`Invalid value for '${l}'. Expected ${n} or less.`)}function Xk(l){const t=encodeURIComponent;let n="?";for(const i in l)if(l.hasOwnProperty(i)){const c=t(i)+"="+t(l[i]);n=n+c+"&"}return n=n.slice(0,-1),n}var Ao;(function(l){l[l.NO_ERROR=0]="NO_ERROR",l[l.NETWORK_ERROR=1]="NETWORK_ERROR",l[l.ABORT=2]="ABORT"})(Ao||(Ao={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kk(l,t){const n=l>=500&&l<600,c=[408,429].indexOf(l)!==-1,d=t.indexOf(l)!==-1;return n||c||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zk{constructor(t,n,i,c,d,h,f,m,p,x,b,w=!0,C=!1){this.url_=t,this.method_=n,this.headers_=i,this.body_=c,this.successCodes_=d,this.additionalRetryCodes_=h,this.callback_=f,this.errorCallback_=m,this.timeout_=p,this.progressCallback_=x,this.connectionFactory_=b,this.retry=w,this.isUsingEmulator=C,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((T,z)=>{this.resolve_=T,this.reject_=z,this.start_()})}start_(){const t=(i,c)=>{if(c){i(!1,new yo(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const h=f=>{const m=f.loaded,p=f.lengthComputable?f.total:-1;this.progressCallback_!==null&&this.progressCallback_(m,p)};this.progressCallback_!==null&&d.addUploadProgressListener(h),d.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(h),this.pendingConnection_=null;const f=d.getErrorCode()===Ao.NO_ERROR,m=d.getStatus();if(!f||Kk(m,this.additionalRetryCodes_)&&this.retry){const x=d.getErrorCode()===Ao.ABORT;i(!1,new yo(!1,null,x));return}const p=this.successCodes_.indexOf(m)!==-1;i(!0,new yo(p,d))})},n=(i,c)=>{const d=this.resolve_,h=this.reject_,f=c.connection;if(c.wasSuccessCode)try{const m=this.callback_(f,f.getResponse());Qk(m)?d(m):d()}catch(m){h(m)}else if(f!==null){const m=zk();m.serverResponse=f.getErrorText(),this.errorCallback_?h(this.errorCallback_(f,m)):h(m)}else if(c.canceled){const m=this.appDelete_?xy():Fk();h(m)}else{const m=Bk();h(m)}};this.canceled_?n(!1,new yo(!1,null,!0)):this.backoffId_=Pk(t,n,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&Wk(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class yo{constructor(t,n,i){this.wasSuccessCode=t,this.connection=n,this.canceled=!!i}}function Jk(l,t){t!==null&&t.length>0&&(l.Authorization="Firebase "+t)}function e_(l,t){l["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function t_(l,t){t&&(l["X-Firebase-GMPID"]=t)}function s_(l,t){t!==null&&(l["X-Firebase-AppCheck"]=t)}function n_(l,t,n,i,c,d,h=!0,f=!1){const m=Xk(l.urlParams),p=l.url+m,x=Object.assign({},l.headers);return t_(x,t),Jk(x,n),e_(x,d),s_(x,i),new Zk(p,l.method,x,l.body,l.successCodes,l.additionalRetryCodes,l.handler,l.errorHandler,l.timeout,l.progressCallback,c,h,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a_(l){if(l.length===0)return null;const t=l.lastIndexOf("/");return t===-1?"":l.slice(0,t)}function r_(l){const t=l.lastIndexOf("/",l.length-2);return t===-1?l:l.slice(t+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(t,n){this._service=t,n instanceof Ts?this._location=n:this._location=Ts.makeFromUrl(n,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,n){return new Ro(t,n)}get root(){const t=new Ts(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return r_(this._location.path)}get storage(){return this._service}get parent(){const t=a_(this._location.path);if(t===null)return null;const n=new Ts(this._location.bucket,t);return new Ro(this._service,n)}_throwIfRoot(t){if(this._location.path==="")throw qk(t)}}function Km(l,t){const n=t?.[Lk];return n==null?null:Ts.makeFromBucketSpec(n,l)}function l_(l,t,n,i={}){l.host=`${t}:${n}`;const c=rh(t);c&&(ny(`https://${l.host}/b`),ay("Storage",!0)),l._isUsingEmulator=!0,l._protocol=c?"https":"http";const{mockUserToken:d}=i;d&&(l._overrideAuthToken=typeof d=="string"?d:ry(d,l.app.options.projectId))}class i_{constructor(t,n,i,c,d,h=!1){this.app=t,this._authProvider=n,this._appCheckProvider=i,this._url=c,this._firebaseVersion=d,this._isUsingEmulator=h,this._bucket=null,this._host=yy,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Hk,this._maxUploadRetryTime=$k,this._requests=new Set,c!=null?this._bucket=Ts.makeFromBucketSpec(c,this._host):this._bucket=Km(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Ts.makeFromBucketSpec(this._url,t):this._bucket=Km(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Xm("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Xm("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const n=await t.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(Jp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Ro(this,t)}_makeRequest(t,n,i,c,d=!0){if(this._deleted)return new Gk(xy());{const h=n_(t,this._appId,i,c,n,this._firebaseVersion,d,this._isUsingEmulator);return this._requests.add(h),h.getPromise().then(()=>this._requests.delete(h),()=>this._requests.delete(h)),h}}async makeRequestWithTokens(t,n){const[i,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,n,i,c).getPromise()}}const Zm="@firebase/storage",Jm="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by="storage";function o_(l=ey(),t){l=Vn(l);const i=ty(l,by).getImmediate({identifier:t}),c=sy("storage");return c&&c_(i,...c),i}function c_(l,t,n,i={}){l_(l,t,n,i)}function d_(l,{instanceIdentifier:t}){const n=l.getProvider("app").getImmediate(),i=l.getProvider("auth-internal"),c=l.getProvider("app-check-internal");return new i_(n,i,c,t,Zp)}function u_(){Xp(new Kp(by,d_,"PUBLIC").setMultipleInstances(!0)),Do(Zm,Jm,""),Do(Zm,Jm,"esm2020")}u_();const Te={log:(l,t)=>{},warn:(l,t)=>{},error:(l,t)=>{console.error(l,t?.message||t)},info:(l,t)=>{},time:l=>{},timeEnd:l=>{}},Vu={apiKey:"AIzaSyD8aBPw-o13mciSdV8gzRJN6TfaAy3OoWg",authDomain:"todolist-116f3.firebaseapp.com",databaseURL:"https://todolist-116f3-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"todolist-116f3",storageBucket:"todolist-116f3.firebasestorage.app",messagingSenderId:"470825187407",appId:"1:470825187407:web:4bd3f8c621c96890b2d23a",measurementId:"G-HS8CDYHDT1"},h_=()=>{const l=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"];for(const t of l)if(!Vu[t])throw new Error(`Firebase configuration missing: ${t}`);if(!Vu.apiKey.startsWith("AIzaSy"))throw new Error("Invalid Firebase API key format")};let Ml;try{h_();const l=ly();l.length===0?(Ml=iy(Vu),Te.log("Firebase app initialized")):(Ml=l[0],Te.log("Using existing Firebase app"))}catch(l){throw Te.error("Firebase initialization failed:",l),l}const xs=Bw(Ml),Se=Fw(Ml);o_(Ml);const fa=new Vw;fa.addScope("email");fa.addScope("profile");fa.addScope("https://www.googleapis.com/auth/userinfo.email");fa.addScope("https://www.googleapis.com/auth/userinfo.profile");fa.setCustomParameters({prompt:"select_account"});const g_=()=>{if(window.location.protocol!=="https:")throw Te.error("Firebase requires HTTPS in production"),new Error("HTTPS required for Firebase in production")};try{g_(),Te.log("Firebase    ")}catch(l){Te.error("Firebase security validation failed:",l)}const vy=M.createContext(void 0),f_=({children:l})=>{const[t,n]=M.useState(null),[i,c]=M.useState(!0),[d,h]=M.useState(!1);M.useEffect(()=>{if(!xs){console.log("Auth: Firebase disabled, using localStorage only"),c(!1);return}const z=Yw(xs,W=>{W?(n({uid:W.uid,email:W.email,displayName:W.displayName,photoURL:W.photoURL,isAnonymous:W.isAnonymous}),h(W.isAnonymous)):(n(null),h(!1)),c(!1)});return()=>z()},[]),M.useEffect(()=>{typeof window<"u"&&(window.authContext={signInWithGoogle:w})},[]);const f=async()=>{console.log("Auth: Use signInWithGoogle or signIn instead")},m=async()=>{xs?await Xw(xs):n(null)},p=async()=>{xs?await Qw(xs):(n({uid:"local-user",email:null,displayName:"Local User",isAnonymous:!0}),h(!0))},x=async(z,W)=>{xs?await Ww(xs,z,W):console.log("Auth: SignIn not available in localStorage mode",{email:z,password:W})},b=async(z,W,k)=>{if(xs){const R=await Gw(xs,z,W);k&&R.user&&await Pw(R.user,{displayName:k})}else console.log("Auth: SignUp not available in localStorage mode",{email:z,password:W,displayName:k})},w=async()=>{if(!xs||!fa)throw new Error("Firebase   .");try{const z=await qw(xs,fa);return console.log("  :",z.user),z.user}catch(z){throw console.error("  :",z),z.code==="auth/popup-closed-by-user"||z.code==="auth/cancelled-popup-request"?new Error(" ."):z.code==="auth/network-request-failed"?new Error("  ."):new Error("   : "+z.message)}},T={currentUser:t,loading:i,isAnonymous:d,login:f,logout:m,loginAnonymously:p,signIn:x,signUp:b,signInWithGoogle:w,signInAsGuest:async()=>{await p()}};return r.jsx(vy.Provider,{value:T,children:l})},vs=()=>{const l=M.useContext(vy);if(l===void 0)throw new Error("useAuth must be used within an AuthProvider");return l};class sn extends Error{constructor(t,n="UNKNOWN_ERROR",i){super(t),this.code=n,this.originalError=i,this.name="TodoError"}}const Sl=(l,t)=>{if(l&&typeof l=="object"&&"code"in l){const n=l;switch(n.code){case"permission-denied":return new sn(" .   .","PERMISSION_DENIED",l);case"not-found":return new sn("    .","NOT_FOUND",l);case"unavailable":return new sn("    .    .","UNAVAILABLE",l);case"failed-precondition":return new sn("   .","FAILED_PRECONDITION",l);case"already-exists":return new sn("  .","ALREADY_EXISTS",l);default:return new sn(`${t}   : ${n.message}`,n.code||"FIRESTORE_ERROR",l)}}return l instanceof Error?new sn(`${t}   : ${l.message}`,"GENERAL_ERROR",l):new sn(`${t}      .`,"UNKNOWN_ERROR",l)},m_=l=>["unavailable","deadline-exceeded","internal","NETWORK_ERROR"].includes(l.code.toLowerCase()),xo=async(l,t=3,n=1e3)=>{let i;for(let c=1;c<=t;c++)try{return await l()}catch(d){const h=d instanceof sn?d:Sl(d,"Operation");if(i=h,!m_(h)||c===t)throw h;const f=n*Math.pow(2,c-1);await new Promise(m=>setTimeout(m,f))}throw i},Ke=l=>{if(l){if(l instanceof Date)return l;if(typeof l?.toDate=="function")return l.toDate();if(typeof l=="string")return new Date(l)}},nn=l=>{if(l==null)return l;if(Array.isArray(l))return l.map(nn);if(l instanceof Date)return l;if(typeof l=="object"){const t={};return Object.keys(l).forEach(n=>{const i=l[n];i!==void 0&&(t[n]=nn(i))}),t}return l},p_=(l,t,n)=>{switch(n){case"same_date":return l.toDateString()===t.toDateString();case"same_week":const i=new Date(l);i.setDate(l.getDate()-l.getDay());const c=new Date(t);return c.setDate(t.getDate()-t.getDay()),i.toDateString()===c.toDateString();case"same_month":return l.getFullYear()===t.getFullYear()&&l.getMonth()===t.getMonth();default:return!1}},y_=l=>{const n=new Date(l.getFullYear(),l.getMonth(),1).getDay();return Math.ceil((l.getDate()+n)/7)},x_=l=>{const t=l.getFullYear(),n=l.getMonth(),i=l.getDay(),c=new Date(t,n+1,0);for(let d=c.getDate();d>=1;d--)if(new Date(t,n,d).getDay()===i)return l.getDate()===d;return!1},b_=(l,t,n,i)=>{const c=t-1;if(n==="last"){const d=new Date(l,c+1,0);for(let h=d.getDate();h>=1;h--){const f=new Date(l,c,h);if(f.getDay()===i)return f}}else{const h={first:1,second:2,third:3,fourth:4}[n];let f=0;const m=new Date(l,c+1,0).getDate();for(let p=1;p<=m;p++){const x=new Date(l,c,p);if(x.getDay()===i&&(f++,f===h))return x}}return null},v_=(l,t="show",n=[])=>{let i=new Date(l);if(t==="show")return i;const c=Co(i,n),d=Un(i);if(!c&&!d)return i;let h=0;for(;h<15;){t==="before"?i.setDate(i.getDate()-1):i.setDate(i.getDate()+1);const f=Co(i,n),m=Un(i);if(!f&&!m)break;h++}return i},Ce={getTodos:async l=>xo(async()=>{try{if(!l)throw new Error("User ID is required");const t=Ze(Se,`users/${l}/todos`),n=Ns(t,Mn("createdAt","desc")),c=(await Rt(n)).docs.map(d=>{const h=d.data();return{id:d.id,...h,createdAt:Ke(h.createdAt)||new Date,updatedAt:Ke(h.updatedAt)||new Date,dueDate:Ke(h.dueDate),startDate:Ke(h.startDate),completedAt:Ke(h.completedAt),subTasks:h.subTasks?h.subTasks.map(f=>({...f,createdAt:Ke(f.createdAt)||new Date,updatedAt:Ke(f.updatedAt)||new Date,completedAt:f.completedAt?Ke(f.completedAt):null})):[]}});return Te.log("Firestore getTodos :",{count:c.length,uid:l}),c}catch(t){throw Te.error("Firestore getTodos :",t),Sl(t,"getTodos")}}),addTodo:async(l,t)=>xo(async()=>{try{if(!t||!l.title?.trim())throw new Error("User ID and todo title are required");const n=Ze(Se,`users/${t}/todos`),c={...nn(l),createdAt:bt(),updatedAt:bt()},d=await Tl(n,c);return Te.log("Firestore addTodo :",d.id),d.id}catch(n){throw Te.error("Firestore addTodo :",n),Sl(n,"addTodo")}}),updateTodo:async(l,t,n)=>{try{const i=Nt(Se,`users/${n}/todos`,l);if(!(await po(i)).exists()){Te.warn(`  ${l}  .  .`);return}const d={...t,updatedAt:bt()};await ca(i,d)}catch(i){throw Te.error("Firestore updateTodo :",i),i}},deleteTodo:async(l,t)=>{try{const n=Nt(Se,`users/${t}/todos`,l);await ko(n)}catch(n){throw console.error(" Firestore deleteTodo :",n),n}},subscribeTodos:(l,t)=>{try{const n=Ze(Se,`users/${l}/todos`),i=Ns(n,Mn("createdAt","desc"));return jl(i,d=>{const h=d.docs.map(f=>{const m=f.data();return{...m,id:f.id,createdAt:Ke(m.createdAt)||new Date,updatedAt:Ke(m.updatedAt)||new Date,dueDate:Ke(m.dueDate),startDate:Ke(m.startDate),completedAt:Ke(m.completedAt),subTasks:m.subTasks?m.subTasks.map(p=>({...p,createdAt:Ke(p.createdAt)||new Date,updatedAt:Ke(p.updatedAt)||new Date,completedAt:p.completedAt?Ke(p.completedAt):null})):[]}});t(h)},d=>{console.error(" Firestore  :",d),t([])})}catch(n){return console.error(" Firestore subscribeTodos  :",n),t([]),()=>{}}},addSubTask:async(l,t,n)=>{const i=Nt(Se,`users/${t}/todos`,n);await ca(i,{subTasks:Kw(l),updatedAt:bt()})},updateSubTask:async(l,t,n,i)=>{const c=Nt(Se,`users/${n}/todos`,i),d=await po(c);if(!d.exists())throw new Error("   .");const m=(d.data().subTasks||[]).map(p=>p.id===l?{...p,...t,updatedAt:new Date}:p);await ca(c,{subTasks:m,updatedAt:bt()})},deleteSubTask:async(l,t,n)=>{const i=Nt(Se,`users/${t}/todos`,n),c=await po(i);if(!c.exists())throw new Error("   .");const f=(c.data().subTasks||[]).filter(m=>m.id!==l);await ca(i,{subTasks:f,updatedAt:bt()})},getRecurringTemplates:async l=>{const t=Ze(Se,`users/${l}/recurringTemplates`),n=Ns(t,Mn("createdAt","desc"));return(await Rt(n)).docs.map(c=>({id:c.id,...c.data(),createdAt:c.data().createdAt?.toDate()||new Date,updatedAt:c.data().updatedAt?.toDate()||new Date}))},addRecurringTemplate:async(l,t)=>{const n=Ze(Se,`users/${t}/recurringTemplates`),c={...nn(l),createdAt:bt(),updatedAt:bt()};return(await Tl(n,c)).id},updateRecurringTemplate:async(l,t,n)=>{const i=Nt(Se,`users/${n}/recurringTemplates`,l),c=nn(t);await ca(i,{...c,updatedAt:bt()})},deleteRecurringTemplate:async(l,t)=>{const n=In(Se),i=Nt(Se,`users/${t}/recurringTemplates`,l);n.delete(i);const c=Ze(Se,`users/${t}/recurringInstances`),d=Ns(c,bu("templateId","==",l));(await Rt(d)).forEach(f=>n.delete(f.ref)),await n.commit()},subscribeProjectTemplates:(l,t)=>{try{Te.log("   ",{uid:l});const n=Ze(Se,`users/${l}/projectTemplates`),i=Ns(n,Mn("createdAt","desc"));return jl(i,d=>{const h=d.docs.map(f=>{const m=f.data();return{id:f.id,...m,createdAt:Ke(m.createdAt)||new Date,updatedAt:Ke(m.updatedAt)||new Date}});Te.log("   ",{count:h.length}),t(h)},d=>{Te.error("   :",d),t([])})}catch(n){return Te.error("    :",n),t([]),()=>{}}},addProjectTemplate:async(l,t)=>{const n=Ze(Se,`users/${t}/projectTemplates`),c={...nn(l),createdAt:bt(),updatedAt:bt()};return(await Tl(n,c)).id},updateProjectTemplate:async(l,t,n)=>{const i=Nt(Se,`users/${n}/projectTemplates`,l),c=nn(t);await ca(i,{...c,updatedAt:bt()})},deleteProjectTemplate:async(l,t)=>{const n=Nt(Se,`users/${t}/projectTemplates`,l);await ko(n)},subscribeRecurringTemplates:(l,t)=>{const n=Ze(Se,`users/${l}/recurringTemplates`),i=Ns(n,Mn("createdAt","desc"));return jl(i,c=>{const d=c.docs.map(h=>({id:h.id,...h.data(),createdAt:Ke(h.data().createdAt)||new Date,updatedAt:Ke(h.data().updatedAt)||new Date}));t(d)})},getRecurringInstances:async l=>{const t=Ze(Se,`users/${l}/recurringInstances`),n=Ns(t,Mn("date","asc"));return(await Rt(n)).docs.map(c=>({id:c.id,...c.data(),date:Ke(c.data().date)||new Date,createdAt:Ke(c.data().createdAt)||new Date,updatedAt:Ke(c.data().updatedAt)||new Date,completedAt:Ke(c.data().completedAt)}))},addRecurringInstance:async(l,t)=>{const n=Ze(Se,`users/${t}/recurringInstances`),i=nn(l);return(await Tl(n,{...i,createdAt:bt(),updatedAt:bt()})).id},updateRecurringInstance:async(l,t,n)=>{const i=Nt(Se,`users/${n}/recurringInstances`,l),c=nn(t);await ca(i,{...c,updatedAt:bt()})},deleteRecurringInstance:async(l,t)=>{const n=Nt(Se,`users/${t}/recurringInstances`,l);await ko(n)},subscribeRecurringInstances:(l,t)=>{const n=Ze(Se,`users/${l}/recurringInstances`),i=Ns(n,Mn("date","asc"));return jl(i,c=>{const d=c.docs.map(h=>({id:h.id,...h.data(),date:Ke(h.data().date)||new Date,createdAt:Ke(h.data().createdAt)||new Date,updatedAt:Ke(h.data().updatedAt)||new Date,completedAt:Ke(h.data().completedAt)}));t(d)})},async _isExceptionDate(l,t,n,i){if(i||!t.exceptions)return!1;for(const c of t.exceptions)switch(c.type){case"date":if(c.values.includes(l.getDate()))return!0;break;case"weekday":if(c.values.includes(l.getDay()))return!0;break;case"week":const d=y_(l);if(c.values.includes(d)||c.values.includes(-1)&&x_(l))return!0;break;case"month":if(c.values.includes(l.getMonth()+1))return!0;break;case"conflict":const h=c.values;for(const f of h)if(await this._hasConflictingInstance(l,t.id,f,n))return!0;break}return!1},async _hasConflictingInstance(l,t,n,i){const c=Ze(Se,`users/${i}/recurringTemplates`),d=Ns(c,bu("title","==",n.targetTemplateTitle)),f=(await Rt(d)).docs.find(x=>x.id!==t);if(!f)return!1;const m={id:f.id,...f.data()},p=await this.generateInstancesForTemplate(m,i,!0,[]);for(const x of p)if(p_(l,x.date,n.scope))return Te.log(`[Conflict] ${l.toDateString()} on ${t} conflicts with ${m.title}`),!0;return!1},async generateInstancesForTemplate(l,t,n=!1,i=[]){if(!l.isActive)return[];const c=[],d=new Set,h=new Date,f=new Date(h);f.setFullYear(h.getFullYear()+1);let m=new Date(h.getFullYear(),h.getMonth(),1);for(;m<=f;){let p=null;if(l.recurrenceType==="daily")p=new Date(m);else if(l.recurrenceType==="weekly")m.getDay()===l.weekday&&(p=new Date(m));else if(l.recurrenceType==="monthly"){let x=null;if(l.monthlyPattern==="weekday"&&l.monthlyWeek&&l.monthlyWeekday!==void 0)x=b_(m.getFullYear(),m.getMonth()+1,l.monthlyWeek,l.monthlyWeekday);else{const b=l.monthlyDate;if(b===-1)x=new Date(m.getFullYear(),m.getMonth()+1,0);else if(b===-2)x=my(m.getFullYear(),m.getMonth()+1);else if(b===-3)x=py(m.getFullYear(),m.getMonth()+1);else if(b&&b>0){const w=new Date(m.getFullYear(),m.getMonth(),b);w.getMonth()===m.getMonth()&&(x=w)}}x&&x.getFullYear()===m.getFullYear()&&x.getMonth()===m.getMonth()&&(p=x)}if(p&&p>=new Date(new Date().setHours(0,0,0,0))){let x=v_(p,l.holidayHandling,i);if(!await this._isExceptionDate(x,l,t,n)){const w=`${x.getFullYear()}-${(x.getMonth()+1).toString().padStart(2,"0")}-${x.getDate().toString().padStart(2,"0")}`;d.has(w)||(c.push({id:`${l.id}_${w}`,templateId:l.id,date:x,completed:!1,createdAt:new Date,updatedAt:new Date}),d.add(w))}}l.recurrenceType==="monthly"?(m.setMonth(m.getMonth()+1),m.setDate(1)):m.setDate(m.getDate()+1)}return c},async _copyCollection(l,t,n){const i=Ze(Se,`users/${l}/${n}`),c=Ze(Se,`users/${t}/${n}`),d=await Rt(i),h=In(Se);d.forEach(f=>{const m=f.data();h.set(Nt(c,f.id),{...m,createdAt:m.createdAt||bt(),updatedAt:bt()})}),await h.commit()},async _deleteCollection(l,t){const n=Ze(Se,`users/${l}/${t}`),i=await Rt(n),c=In(Se);i.forEach(d=>{c.delete(d.ref)}),await c.commit()},migrateUserData:async(l,t)=>xo(async()=>{try{if(!l||!t)throw new Error("Old UID and New UID are required for migration.");if(l===t)throw new Error("Cannot migrate data to the same UID.");Te.log(`Starting data migration from old UID: ${l} to new UID: ${t}`),await Ce._copyCollection(l,t,"todos"),await Ce._copyCollection(l,t,"recurringTemplates"),await Ce._copyCollection(l,t,"recurringInstances"),await Ce._copyCollection(l,t,"projectTemplates"),Te.log(`Deleting old data for UID: ${l}`),await Ce._deleteCollection(l,"todos"),await Ce._deleteCollection(l,"recurringTemplates"),await Ce._deleteCollection(l,"recurringInstances"),await Ce._deleteCollection(l,"projectTemplates"),Te.log(`Data migration completed successfully from ${l} to ${t}`)}catch(n){throw Te.error("Data migration failed:",n),Sl(n,"migrateUserData")}}),regenerateRecurringInstances:async(l,t)=>xo(async()=>{try{if(!t||!l)throw new Error("User ID and template ID are required");Te.log("    ",{templateId:l,uid:t});const n=Ze(Se,`users/${t}/recurringInstances`),i=Nt(Se,`users/${t}/recurringTemplates`,l),c=Ns(n,bu("templateId","==",l)),d=await Rt(c),h=new Map;d.forEach(z=>{h.set(z.id,z.data())}),Te.log("    ",{count:h.size});const f=await po(i);if(!f.exists())throw new Error(`Template ${l} not found`);const m={id:f.id,...f.data()},p=Ze(Se,`users/${t}/custom_holidays`),b=(await Rt(p)).docs.map(z=>{const W=z.data();return{id:z.id,date:W.date,name:W.name,isRecurring:W.isRecurring,createdAt:W.createdAt}}),w=await Ce.generateInstancesForTemplate(m,t,!1,b);Te.log("   ",{count:w.length});const C=In(Se),T=new Set;w.forEach(z=>{const W=Nt(n,z.id),k=h.get(z.id);k?(T.add(z.id),C.update(W,{...z,completed:k.completed||!1,completedAt:k.completedAt||null,updatedAt:bt()})):(T.add(z.id),C.set(W,{...z,createdAt:bt(),updatedAt:bt()}))}),h.forEach((z,W)=>{if(!T.has(W)){const k=Ke(z.date),R=new Date;R.setHours(0,0,0,0),z.completed||k&&k>=R?(C.delete(Nt(n,W)),Te.log("    (  )",{id:W})):Te.log("     ",{id:W})}}),await C.commit(),Te.log("    ",{templateId:l})}catch(n){throw Te.error("    :",n),Sl(n,"regenerateRecurringInstances")}})},Tu={cleanupOrphanedInstances:async l=>{try{console.log("    ");const t=Ze(Se,`users/${l}/recurringTemplates`),n=await Rt(t),i=new Set;n.forEach(x=>{i.add(x.id)}),console.log(` : ${i.size}`);const c=Ze(Se,`users/${l}/recurringInstances`),d=await Rt(c),h=[];d.forEach(x=>{const b=x.data();i.has(b.templateId)||(h.push(x.id),console.log(`  : ${x.id} (: ${b.templateId})`))});const f=Ze(Se,`users/${l}/todos`),m=await Rt(f),p=[];if(m.forEach(x=>{const b=x.data();b._templateId&&!i.has(b._templateId)&&(p.push(x.id),console.log(`  : ${b.title} (: ${b._templateId})`))}),h.length>0||p.length>0){const x=In(Se);h.forEach(b=>{const w=Nt(Se,`users/${l}/recurringInstances`,b);x.delete(w)}),p.forEach(b=>{const w=Nt(Se,`users/${l}/todos`,b);x.delete(w)}),await x.commit(),console.log(`  :  ${h.length},  ${p.length}`)}else console.log("    ");return{orphanedInstances:h.length,orphanedTodos:p.length,totalCleaned:h.length+p.length}}catch(t){throw console.error("    :",t),t}},validateTemplateConsistency:async l=>{try{console.log("     ");const t=Ze(Se,`users/${l}/recurringTemplates`),n=await Rt(t),i=Ze(Se,`users/${l}/recurringInstances`),c=await Rt(i),d=Ze(Se,`users/${l}/todos`),h=await Rt(d),f=new Map;return n.forEach(m=>{const p=m.data();f.set(m.id,{templateTitle:p.title,instances:0,todos:0,isActive:p.isActive!==!1})}),c.forEach(m=>{const x=m.data().templateId;f.has(x)&&f.get(x).instances++}),h.forEach(m=>{const x=m.data()._templateId;x&&f.has(x)&&f.get(x).todos++}),console.log(`
   :`),console.log("=".repeat(60)),f.forEach((m,p)=>{console.log(`${m.templateTitle} (${p}):`),console.log(`  : ${m.isActive}`),console.log(`  : ${m.instances}`),console.log(`  : ${m.todos}`),m.instances>0&&m.todos===0&&console.log("   :     "),console.log("")}),f}catch(t){throw console.error("    :",t),t}},regenerateAllInstances:async l=>{try{console.log("    ");const t=Ze(Se,`users/${l}/recurringInstances`),n=await Rt(t),i=In(Se);n.forEach(c=>{i.delete(c.ref)}),await i.commit(),console.log(`   ${n.size}  `),console.log("       ")}catch(t){throw console.error("   :",t),t}},smartCleanupInstances:async l=>{try{console.log("    "),console.log("    ...");const t=Ze(Se,`users/${l}/recurringTemplates`),n=await Rt(t),i=new Set;n.forEach(m=>{const p=m.data();p.isActive!==!1&&(i.add(m.id),console.log(` : ${p.title} (${m.id})`))}),console.log(` : ${i.size}`),console.log("2     ...");const c=Ze(Se,`users/${l}/recurringInstances`),d=await Rt(c),h=[],f=[];if(d.forEach(m=>{const p=m.data(),x=p.templateId,b=p.completed===!0;!i.has(x)?h.push(m.id):f.push(m.id)}),console.log(`  :  ${h.length},  ${f.length}`),h.length>0){console.log("3    ...");const m=[];let p=In(Se),x=0;h.forEach(b=>{const w=Nt(Se,`users/${l}/recurringInstances`,b);p.delete(w),x++,x>=500&&(m.push(p),p=In(Se),x=0)}),x>0&&m.push(p);for(let b=0;b<m.length;b++)await m[b].commit(),console.log(` ${b+1}/${m.length}  `);console.log(`  ${h.length}   `)}else console.log("  ");return console.log("   !"),console.log(`-  : ${i.size}`),console.log(`-  : ${h.length}`),console.log(`-  : ${f.length}`),console.log(`-  : ${d.size}`),{activeTemplates:i.size,deletedInstances:h.length,keptInstances:f.length,totalInstances:d.size}}catch(t){throw console.error("    :",t),t}}},wy=M.createContext(void 0),w_=({children:l})=>{const[t,n]=M.useState([]),[i,c]=M.useState(!0),{currentUser:d}=vs();M.useEffect(()=>{if(!d){n([]),c(!1);return}const p=Ns(Ze(Se,`users/${d.uid}/custom_holidays`),Mn("date","asc")),x=jl(p,b=>{const w=b.docs.map(C=>({id:C.id,...C.data()}));n(w),c(!1)},b=>{console.error("Error fetching custom holidays:",b),c(!1)});return()=>x()},[d]);const h=async(p,x,b=!1)=>{if(d)try{await Tl(Ze(Se,`users/${d.uid}/custom_holidays`),{date:p,name:x,isRecurring:b,createdAt:bt()})}catch(w){throw console.error("Error adding custom holiday:",w),w}},f=async p=>{if(d)try{await ko(Nt(Se,`users/${d.uid}/custom_holidays`,p))}catch(x){throw console.error("Error deleting custom holiday:",x),x}},m=p=>t.find(x=>{const b=new Date(x.date);b.setHours(0,0,0,0);const w=new Date(p);return w.setHours(0,0,0,0),b.getTime()===w.getTime()});return r.jsx(wy.Provider,{value:{customHolidays:t,addCustomHoliday:h,deleteCustomHoliday:f,getCustomHoliday:m,loading:i},children:l})},Qo=()=>{const l=M.useContext(wy);if(l===void 0)throw new Error("useCustomHolidays must be used within a CustomHolidayProvider");return l},ky=M.createContext(void 0),k_={todos:[],recurringTemplates:[],recurringInstances:[],loading:!1,error:null,syncing:!1};function __(l,t){switch(t.type){case"SET_LOADING":return{...l,loading:t.payload};case"SET_SYNCING":return{...l,syncing:t.payload};case"SET_ERROR":return{...l,error:t.payload};case"SET_TODOS":const n=t.payload.filter((d,h,f)=>f.findIndex(m=>m.id===d.id)===h);return n.length!==t.payload.length&&console.warn(` SET_TODOS  : ${t.payload.length}  ${n.length}`),{...l,todos:n};case"ADD_TODO":return l.todos.some(d=>d.id===t.payload.id)?(console.warn(` ADD_TODO  : ${t.payload.id}  `),l):{...l,todos:[t.payload,...l.todos]};case"UPDATE_TODO":return{...l,todos:l.todos.map(d=>d.id===t.payload.id?{...d,...t.payload.updates,updatedAt:new Date}:d)};case"DELETE_TODO":return{...l,todos:l.todos.filter(d=>d.id!==t.payload)};case"TOGGLE_TODO":{const d=new Date;return{...l,todos:l.todos.map(h=>h.id===t.payload?{...h,completed:!h.completed,completedAt:h.completed?void 0:d,updatedAt:d}:h)}}case"ADD_SUBTASK":return{...l,todos:l.todos.map(d=>d.id===t.payload.todoId?{...d,subTasks:[...d.subTasks||[],t.payload.subTask],updatedAt:new Date}:d)};case"UPDATE_SUBTASK":return{...l,todos:l.todos.map(d=>d.id===t.payload.todoId?{...d,subTasks:d.subTasks?.map(h=>h.id===t.payload.subTaskId?{...h,...t.payload.updates,updatedAt:new Date}:h)||[],updatedAt:new Date}:d)};case"DELETE_SUBTASK":return{...l,todos:l.todos.map(d=>d.id===t.payload.todoId?{...d,subTasks:d.subTasks?.filter(h=>h.id!==t.payload.subTaskId)||[],updatedAt:new Date}:d)};case"TOGGLE_SUBTASK":return{...l,todos:l.todos.map(d=>d.id===t.payload.todoId?{...d,subTasks:d.subTasks?.map(h=>h.id===t.payload.subTaskId?{...h,completed:!h.completed,updatedAt:new Date}:h)||[],updatedAt:new Date}:d)};case"SET_RECURRING_TEMPLATES":return{...l,recurringTemplates:t.payload};case"ADD_RECURRING_TEMPLATE":return{...l,recurringTemplates:[t.payload,...l.recurringTemplates]};case"UPDATE_RECURRING_TEMPLATE":return{...l,recurringTemplates:l.recurringTemplates.map(d=>d.id===t.payload.id?{...d,...t.payload.updates,updatedAt:new Date}:d)};case"DELETE_RECURRING_TEMPLATE":return{...l,recurringTemplates:l.recurringTemplates.filter(d=>d.id!==t.payload),recurringInstances:l.recurringInstances.filter(d=>d.templateId!==t.payload)};case"SET_RECURRING_INSTANCES":console.log(" SET_RECURRING_INSTANCES - Firebase  state "),console.log(`     : ${l.recurringInstances.length}`),console.log(`    Firebase  : ${t.payload.length}`);const c=t.payload.find(d=>d.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");return c&&console.log(`    Firebase  : completed=${c.completed}`),{...l,recurringInstances:t.payload};case"UPDATE_RECURRING_INSTANCE":return{...l,recurringInstances:l.recurringInstances.map(d=>d.id===t.payload.id?{...d,...t.payload.updates,updatedAt:new Date}:d)};case"GENERATE_RECURRING_INSTANCES":{let d=[],h=[];try{const f=localStorage.getItem("recurringInstances");f&&(h=JSON.parse(f).map(p=>({...p,date:new Date(p.date),createdAt:new Date(p.createdAt),updatedAt:new Date(p.updatedAt),completedAt:p.completedAt?new Date(p.completedAt):void 0})),console.log(" localStorage   :",h.length,""))}catch(f){console.error(" localStorage   :",f)}return console.log("   -    "),l.recurringTemplates.filter(f=>f.isActive).forEach(f=>{try{const p=ir.generateInstances(f).map(x=>{const b=h.find(w=>w.id===x.id);return b?(console.log(` localStorage   : ${x.id} (: ${b.completed})`),{...x,completed:b.completed,completedAt:b.completedAt,updatedAt:b.updatedAt}):x});d=[...d,...p]}catch(m){console.error(` ${f.id}   :`,m)}}),{...l,recurringInstances:d}}default:return l}}const N_=({children:l})=>{const[t,n]=M.useReducer(__,k_),{currentUser:i,loading:c}=vs(),{customHolidays:d}=Qo(),h=M.useRef(null),f=M.useRef(null),m=M.useRef(null);M.useEffect(()=>{if(c)return;if(!i){console.log("  "),p();return}return console.log("   - :",i.uid),n({type:"SET_LOADING",payload:!0}),h.current&&(h.current(),h.current=null),f.current&&(f.current(),f.current=null),m.current&&(m.current(),m.current=null),(async()=>{try{if(await b(),!i)return;console.log("     - :",i.uid),console.log(" Firestore    -  ID:",i.uid),h.current=Ce.subscribeTodos(i.uid,ie=>{console.log(" Firestore   :",ie.length,""),console.log(" Firestore    ID:",ie.map(te=>te.id)),n({type:"SET_TODOS",payload:ie}),n({type:"SET_LOADING",payload:!1}),n({type:"SET_ERROR",payload:null})}),f.current=Ce.subscribeRecurringTemplates(i.uid,ie=>{n({type:"SET_RECURRING_TEMPLATES",payload:ie}),console.log("  Firestore :",ie.length,"")}),console.log("      ..."),console.log("       ..."),console.log("   :"),console.log("  UID:",i.uid),console.log("  Email:",i.email),console.log("  DisplayName:",i.displayName),console.log(" Firestore : users/"+i.uid+"/recurringInstances");const V=await Ce.getRecurringInstances(i.uid),q=V.find(ie=>ie.id==="PUH4xT3lVY5aK2vuQyUe_2025-08-21");q&&(console.log("    :"),console.log("  completed:",q.completed,typeof q.completed),console.log("  completedAt:",q.completedAt),console.log("   :",JSON.stringify(q,null,2)),console.log("    : users/"+i.uid+"/recurringInstances/PUH4xT3lVY5aK2vuQyUe_2025-08-21"));const K=V.find(ie=>ie.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");K?(console.log("    :"),console.log("  ID:",K.id),console.log("  completed:",K.completed,typeof K.completed),console.log("  completedAt:",K.completedAt),console.log("  updatedAt:",K.updatedAt)):(console.log("      "),console.log("    :",V.map(ie=>ie.id)));const oe=Ce.subscribeRecurringInstances(i.uid,ie=>{console.log("     - :",ie.length),console.log("   :",new Date().toISOString());const te=ie.filter(Ne=>Ne.templateId==="vCyWLYn3LuDq1nVUPSyE");te.length>0&&(console.log(" Firebase  - :"),te.forEach(Ne=>{console.log(`   ID: ${Ne.id}, : ${Ne.completed}`);const pe=t.recurringInstances.find(ge=>ge.id===Ne.id);pe&&pe.completed!==Ne.completed&&console.log(`     : (${pe.completed}) vs Firebase(${Ne.completed})`)})),n({type:"SET_RECURRING_INSTANCES",payload:ie}),console.log(" Firebase   dispatch ")});oe?(console.log("      "),m.current=oe,setTimeout(async()=>{try{console.log(" Firebase   ...");const ie=await Ce.getRecurringInstances(i.uid),te=ie.find(Ne=>Ne.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");te&&console.log(` Firebase : ID=${te.id}, =${te.completed}`),n({type:"SET_RECURRING_INSTANCES",payload:ie}),console.log(" Firebase   ")}catch(ie){console.error(" Firebase   :",ie)}},3e3)):console.error("      ")}catch(V){console.error("Firestore  :",V),n({type:"SET_LOADING",payload:!1}),n({type:"SET_ERROR",payload:"Firebase  ."})}})(),()=>{h.current&&h.current(),f.current&&f.current(),m.current&&m.current()}},[i,c]),M.useEffect(()=>{if(t.recurringTemplates.length===0)return;console.log("     -   "),console.log("   :",t.recurringTemplates.length),(async()=>{try{if(!i){const V=[];for(const q of t.recurringTemplates)try{console.log(`   : ${q.title}`);const K=ir.generateInstances(q,d);V.push(...K),console.log(`  ${q.title}: ${K.length}  `)}catch(K){console.error(`  ${q.title}   :`,K)}console.log("   :",V.length),n({type:"SET_RECURRING_INSTANCES",payload:V});return}for(const V of t.recurringTemplates)try{console.log(` Firebase  : ${V.title}`),await Ce.regenerateRecurringInstances(V.id,i.uid)}catch(q){console.error(` Firebase  ${V.title}  :`,q)}console.log("    ")}catch(V){console.error("    :",V)}})()},[t.recurringTemplates,i,d]),M.useEffect(()=>{if(!i||t.recurringInstances.length===0)return;const V=setTimeout(async()=>{try{console.log(`   Firebase   ... ( ${t.recurringInstances.length})`);const q=await Ce.getRecurringInstances(i.uid),K=new Set(q.map(ie=>ie.id));console.log(` Firebase  : ${q.length}`),console.log(`  : ${t.recurringInstances.length}`);const oe=t.recurringInstances.filter(ie=>{const te=!K.has(ie.id);return te&&console.log(`   : ${ie.id} (: ${ie.date})`),te});if(oe.length>0){console.log(` Firebase    ${oe.length}  ...`);for(const ie of oe)try{const te=await Ce.addRecurringInstance({...ie,id:ie.id},i.uid);console.log(`   Firebase  : ${ie.id} -> Firestore ID: ${te}`)}catch(te){console.error(`   Firebase  : ${ie.id}`,te)}console.log("   Firebase  !")}else console.log("     Firebase  ")}catch(q){console.error("   Firebase  :",q)}},500);return()=>clearTimeout(V)},[t.recurringInstances,i]);const p=()=>{try{if(console.log("=== localStorage    ==="),i){console.log("   -  Firebase  "),n({type:"SET_TODOS",payload:[]}),n({type:"SET_RECURRING_TEMPLATES",payload:[]}),n({type:"SET_LOADING",payload:!1});return}if(i)console.log("  - localStorage    (Firestore )");else{const j=localStorage.getItem("todos");if(j){const q=JSON.parse(j).map(K=>({...K,createdAt:new Date(K.createdAt),updatedAt:new Date(K.updatedAt),dueDate:K.dueDate?new Date(K.dueDate):void 0,startDate:K.startDate?new Date(K.startDate):void 0,completedAt:K.completedAt?new Date(K.completedAt):void 0}));console.log("localStorage   ():",q.length,""),n({type:"SET_TODOS",payload:q})}}if(i)console.log("   - localStorage     (Firestore )");else{const j=localStorage.getItem("recurringTemplates");if(j){const q=JSON.parse(j).map(K=>({...K,createdAt:new Date(K.createdAt),updatedAt:new Date(K.updatedAt)}));console.log("localStorage   :",q.length,""),n({type:"SET_RECURRING_TEMPLATES",payload:q})}}n({type:"SET_LOADING",payload:!1}),console.log("=== localStorage    ===")}catch(j){console.error("localStorage   :",j),n({type:"SET_ERROR",payload:"localStorage     ."}),n({type:"SET_LOADING",payload:!1})}},x=()=>{if(i){console.log("  - localStorage  ");return}try{localStorage.setItem("todos",JSON.stringify(t.todos)),localStorage.setItem("recurringTemplates",JSON.stringify(t.recurringTemplates)),console.log("localStorage    ()")}catch(j){console.error("localStorage  :",j)}},b=async()=>{if(i)try{if(console.log("=== localStorage  Firestore   ==="),!i)return;if(console.log("   - localStorage   "),localStorage.getItem(`migrated_${i.uid}`)){console.log("   :",i.uid);return}console.log("  - :",i.uid);const V=localStorage.getItem("todos"),q=localStorage.getItem("recurringTemplates");if(V||q){if(console.log(" localStorage  "),V){const oe=JSON.parse(V);if(oe.length>0){console.log(`${oe.length}  Firestore `);for(const ie of oe)try{await Ce.addTodo({...ie,createdAt:new Date(ie.createdAt),updatedAt:new Date(ie.updatedAt),dueDate:ie.dueDate?new Date(ie.dueDate):void 0,startDate:ie.startDate?new Date(ie.startDate):void 0,completedAt:ie.completedAt?new Date(ie.completedAt):void 0},i.uid),console.log(`  : ${ie.title}`)}catch(te){console.error(`  : ${ie.title}`,te)}}}if(q){const oe=JSON.parse(q);if(oe.length>0){console.log(`${oe.length}   Firestore `);for(const ie of oe)try{await Ce.addRecurringTemplate({...ie,createdAt:new Date(ie.createdAt),updatedAt:new Date(ie.updatedAt)},i.uid),console.log(`   : ${ie.title}`)}catch(te){console.error(`   : ${ie.title}`,te)}}}const K={todos:V?JSON.parse(V):[],recurringTemplates:q?JSON.parse(q):[],migratedAt:new Date().toISOString(),userId:i.uid};localStorage.setItem(`migrated_backup_${i.uid}`,JSON.stringify(K)),localStorage.setItem(`migrated_${i.uid}`,new Date().toISOString()),localStorage.removeItem("todos"),localStorage.removeItem("recurringTemplates"),console.log("===  : localStorage   ===")}else console.log(" localStorage  "),localStorage.setItem(`migrated_${i.uid}`,new Date().toISOString())}catch(j){console.error(" :",j),n({type:"SET_ERROR",payload:"    ."})}};M.useEffect(()=>{if(i){console.log("   - simpleRecurringSystem  !");return}ir.setTemplates(t.recurringTemplates)},[t.recurringTemplates,i]),M.useEffect(()=>{!i&&!c&&(console.log(" localStorage   - todos :",t.todos.length),x())},[t.todos,i,c]),M.useEffect(()=>{!i&&!c&&(console.log(" localStorage   -  :",t.recurringTemplates.length),x())},[t.recurringTemplates,i,c]);const w=async()=>{if(i){n({type:"SET_SYNCING",payload:!0});try{const j=await Ce.getTodos(i.uid);n({type:"SET_TODOS",payload:j}),n({type:"SET_ERROR",payload:null}),setTimeout(()=>{_()},500),typeof window<"u"&&(window.initializeOrderValues=_,window.forceFirebaseSync=async()=>{if(!i){console.log("  ");return}try{console.log("  Firebase   ...");const V=await Ce.getRecurringInstances(i.uid),q=V.find(K=>K.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");q&&console.log("   - Firebase  :",q.completed),n({type:"SET_RECURRING_INSTANCES",payload:V}),console.log("  Firebase  !"),setTimeout(()=>{const K=V.find(oe=>oe.id==="vCyWLYn3LuDq1nVUPSyE_2025-08-26");K&&console.log("    :",K.completed)},1e3)}catch(V){console.error("  Firebase  :",V)}},console.log("   : window.forceFirebaseSync()"))}catch(j){console.error("Firestore  :",j),n({type:"SET_ERROR",payload:"   ."})}finally{n({type:"SET_SYNCING",payload:!1})}}},C=async j=>{console.log("addTodo :",j,":",i?.uid);const V=K=>{const oe=t.todos.filter(te=>te.priority===K&&!te.completed);if(oe.length===0)return{urgent:0,high:1e3,medium:2e3,low:3e3}[K]||2e3;const ie=Math.min(...oe.map(te=>te.order||999));return Math.max(0,ie-1)},q={...j,id:_o(),createdAt:new Date,updatedAt:new Date,order:V(j.priority)};try{if(i){console.log("Firestore   :",q.title);try{const K=await Ce.addTodo(q,i.uid);console.log("Firestore   , ID:",K);const oe={...q,id:K};n({type:"ADD_TODO",payload:oe}),console.log("     - Firestore ID :",K)}catch(K){throw console.error("Firestore  :",K),K}}else console.log(" :   "),n({type:"ADD_TODO",payload:q}),console.log("   - localStorage   ")}catch(K){console.error("  :",K),n({type:"SET_ERROR",payload:"    ."})}},T=async(j,V)=>{try{i?await Ce.updateTodo(j,V,i.uid):(console.log(" :   "),n({type:"UPDATE_TODO",payload:{id:j,updates:V}}))}catch(q){console.error("  :",q),n({type:"SET_ERROR",payload:"    ."})}},z=async j=>{try{const q=[...t.todos,...A()].find(oe=>oe.id===j);if(j.startsWith("recurring_")||q?._isRecurringInstance){console.log('   "" :',j);let oe=q?._instanceId;if(!oe&&j.startsWith("recurring_")&&(oe=j.replace("recurring_","")),!oe){console.error("  ID      :",j);return}const ie={skipped:!0,skippedReason:"manual_deletion"},te=t.recurringInstances.map(Ne=>Ne.id===oe?{...Ne,...ie}:Ne);if(n({type:"SET_RECURRING_INSTANCES",payload:te}),i)try{await Ce.updateRecurringInstance(oe,ie,i.uid),console.log(' Firestore   "skipped"  :',oe)}catch(Ne){console.error(" Firestore    :",Ne),n({type:"SET_RECURRING_INSTANCES",payload:t.recurringInstances}),n({type:"SET_ERROR",payload:"   ."})}return}i?await Ce.deleteTodo(j,i.uid):n({type:"DELETE_TODO",payload:j}),console.log("    :",j)}catch(V){console.error("  :",V),n({type:"SET_ERROR",payload:"    ."})}},W=async j=>{console.log("   :",j),(j.includes("")||j.includes("vCyWLYn3LuDq1nVUPSyE"))&&(console.log("   !"),console.log("    ID:",j));const q=[...t.todos,...A()].find(te=>te.id===j),K=t.todos.find(te=>te.id===j);if(K&&K.startDate&&K.dueDate&&!K._isRecurringInstance){console.log("   :",j,":",K.startDate,":",K.dueDate);const te={completed:!K.completed,...K.completed?{completedAt:zm()}:{completedAt:new Date}};try{n({type:"TOGGLE_TODO",payload:j}),i?(await Ce.updateTodo(j,te,i.uid),console.log("   Firestore  :",j)):console.log("  :    "),console.log(`    : ${j}`);return}catch(Ne){console.error("    :",Ne),n({type:"TOGGLE_TODO",payload:j}),n({type:"SET_ERROR",payload:"     ."});return}}if(q&&q._isRecurringInstance){console.log("   :",j);let te=q._instanceId;!te&&j.startsWith("recurring_")?(te=j.replace("recurring_",""),console.log(" ID  ID :",te)):console.log("   ID:",te);const Ne=t.recurringInstances.find(pe=>pe.id===te);if(Ne){console.log("   :",Ne);const pe={...Ne,completed:!Ne.completed,completedAt:Ne.completed?void 0:new Date,updatedAt:new Date};if(i)try{console.log(` Firebase     : ${te}`),console.log("  :",{completed:pe.completed,completedAt:pe.completedAt});const ge={completed:pe.completed};pe.completedAt===void 0?(console.log(" completedAt undefined -> null "),ge.completedAt=null):(console.log(" completedAt :",pe.completedAt),ge.completedAt=pe.completedAt),console.log("   :",ge),console.log("  UI     ");const je=t.recurringInstances.map(he=>he.id===te?pe:he);n({type:"SET_RECURRING_INSTANCES",payload:je}),console.log("      (Firebase   )"),console.log(` Firestore   - instanceId: ${te}`),console.log("  :",ge),console.log(`   : ${new Date().toISOString()}`),await Ce.updateRecurringInstance(te,ge,i.uid),console.log("    Firebase  "),console.log(`   : ${new Date().toISOString()}`),q?.title.includes("")&&console.log("   :",pe.completed),te.includes("weekly_work_report")&&console.log(`  Firestore : completed=${ge.completed}`),console.log(" Firestore   -   ")}catch(ge){console.error(" Firebase  :",ge),n({type:"SET_RECURRING_INSTANCES",payload:t.recurringInstances}),n({type:"SET_ERROR",payload:"      ."})}else{const ge=t.recurringInstances.map(je=>je.id===te?pe:je);n({type:"SET_RECURRING_INSTANCES",payload:ge}),console.log("   - localStorage  ,  ")}console.log("     ");return}else{console.log("   .   :",te);const pe=te.split("_");if(pe.length>=2){const ge=pe[0],je=pe.slice(1).join("_"),he=t.recurringTemplates.find(xe=>xe.id===ge);if(he){console.log("  :",he);const xe={id:te,templateId:ge,date:new Date(je),completed:!0,completedAt:new Date,createdAt:new Date,updatedAt:new Date};if(i)try{console.log(` Firebase     : ${te}`),console.log("   :",xe);const Ie=[...t.recurringInstances,xe];n({type:"SET_RECURRING_INSTANCES",payload:Ie}),console.log("       "),await Ce.updateRecurringInstance(te,{templateId:xe.templateId,date:xe.date,completed:xe.completed,completedAt:xe.completedAt},i.uid),console.log("     Firebase  "),console.log("      -   ")}catch(Ie){console.error("   Firebase  :",Ie),n({type:"SET_RECURRING_INSTANCES",payload:t.recurringInstances}),n({type:"SET_ERROR",payload:"       ."})}else{const Ie=[...t.recurringInstances,xe];n({type:"SET_RECURRING_INSTANCES",payload:Ie}),console.log("   - localStorage  ,  ")}console.log("     ");return}else console.error("    :",ge)}else console.error("  ID  :",te);console.error("     :",te),console.log("   :",t.recurringInstances.map(ge=>ge.id)),console.log("   :",t.recurringTemplates.map(ge=>ge.id));return}}const oe=t.todos.find(te=>te.id===j);if(!oe){console.error("Todo not found:",j);return}const ie={completed:!oe.completed,...oe.completed?{completedAt:zm()}:{completedAt:new Date}};try{n({type:"TOGGLE_TODO",payload:j});const Ne=[...t.todos,...A()].find(ge=>ge.id===j),pe=j.startsWith("recurring_")||Ne?._isRecurringInstance;i&&!pe?(await Ce.updateTodo(j,ie,i.uid),console.log("Firestore  :",j)):pe?(console.log("   :",j),ie.order!==void 0&&(console.log("  order :",j," order:",ie.order),n({type:"UPDATE_RECURRING_INSTANCE",payload:{id:j,updates:{order:ie.order}}}))):console.log(" :   "),console.log(`  : ${j} (: ${pe})`)}catch(te){console.error("  :",te),n({type:"TOGGLE_TODO",payload:j}),n({type:"SET_ERROR",payload:"     ."})}},k=async(j,V)=>{const q={id:_o(),title:V,completed:!1,priority:"medium",createdAt:new Date,updatedAt:new Date};try{i?await Ce.addSubTask(q,i.uid,j):n({type:"ADD_SUBTASK",payload:{todoId:j,subTask:q}})}catch(K){console.error("  :",K),n({type:"SET_ERROR",payload:"     ."})}},R=async(j,V,q)=>{try{i?await Ce.updateSubTask(V,q,i.uid,j):n({type:"UPDATE_SUBTASK",payload:{todoId:j,subTaskId:V,updates:q}})}catch(K){console.error("  :",K),n({type:"SET_ERROR",payload:"     ."})}},D=async(j,V)=>{try{i?await Ce.deleteSubTask(V,i.uid,j):n({type:"DELETE_SUBTASK",payload:{todoId:j,subTaskId:V}})}catch(q){console.error("  :",q),n({type:"SET_ERROR",payload:"     ."})}},E=async(j,V)=>{console.log("   :",{todoId:j,subTaskId:V});const K=t.todos.find(te=>te.id===j)?.subTasks?.find(te=>te.id===V);if(!K){console.error("    :",{todoId:j,subTaskId:V});return}const oe=!K.completed;console.log("  :",{:K.completed,:oe,:K.completedAt});const ie={completed:oe,completedAt:oe?new Date:null};console.log("  :",ie),await R(j,V,ie)},O=j=>{const V=new Map,q=[];j.forEach(oe=>{const ie=oe._isRecurringInstance||oe.id.startsWith("recurring_"),te=oe._templateId;ie&&te?(V.has(te)||V.set(te,[]),V.get(te).push(oe)):q.push(oe)});const K=[];return V.forEach(oe=>{const ie=oe.filter(Ne=>Ne.completed);K.push(...ie);const te=oe.filter(Ne=>!Ne.completed);te.length>0&&(te.sort((Ne,pe)=>{const ge=Ne.startDate?new Date(Ne.startDate).getTime():0,je=pe.startDate?new Date(pe.startDate).getTime():0;return ge-je}),K.push(te[0]),te.length>1&&console.log(`  : ${te[0].title} (), ${te.length-1} `))}),[...q,...K]},P=j=>{const V=j?new Date(j):new Date;V.setHours(0,0,0,0),console.log(" getTodayTodos ,  :",V.toDateString());const q=t.todos.filter(pe=>{if(console.log(`  : "${pe.title}"`),console.log(`  startDate: ${pe.startDate?new Date(pe.startDate).toDateString():"null"}`),console.log(`  dueDate: ${pe.dueDate?new Date(pe.dueDate).toDateString():"null"}`),console.log(`  completed: ${pe.completed}`),pe.completed){if(pe.completedAt){const he=new Date(pe.completedAt);if(he.setHours(0,0,0,0),he.getTime()===V.getTime())return!0}return pe.subTasks&&pe.subTasks.length>0&&pe.subTasks.some(xe=>{if(xe.completed&&xe.completedAt&&xe.completedAt!==null)try{const Ie=new Date(xe.completedAt);return Ie.setHours(0,0,0,0),Ie.getTime()===V.getTime()}catch{return!1}return!1})?(console.log(` "${pe.title}" -    `),!0):!1}const ge=pe.startDate?new Date(pe.startDate):null,je=pe.dueDate?new Date(pe.dueDate):null;if(ge&&ge.setHours(0,0,0,0),je&&je.setHours(0,0,0,0),console.log(`   startDate: ${ge?ge.toDateString():"null"}`),console.log(`   dueDate: ${je?je.toDateString():"null"}`),ge&&je){const he=V.getTime()>=ge.getTime()&&V.getTime()<=je.getTime();return console.log(`   : "${pe.title}"`),console.log(`  : ${ge.toDateString()}, : ${je.toDateString()}`),console.log(`  : ${V.toDateString()},   : ${he}`),he}return ge&&!je?V.getTime()>=ge.getTime():!ge&&je?je.getTime()>=V.getTime()?(console.log(`   : "${pe.title}" -  `),console.log(`  : ${je.toDateString()}, : ${V.toDateString()}`),!0):(console.log(`   : "${pe.title}" -   `),!1):!pe.dueDate&&!pe.startDate}),oe=A().filter(pe=>{if(pe.startDate){const ge=new Date(pe.startDate);if(ge.setHours(0,0,0,0),ge.getTime()===V.getTime())return!0;if(ge.getTime()<V.getTime()&&!pe.completed)return console.log(`   : "${pe.title}" (${ge.toLocaleDateString()})`),!0}return!1}),ie=new Set,Ne=[...q,...oe].filter(pe=>ie.has(pe.id)?(console.warn(`     : ${pe.id}`),!1):(ie.add(pe.id),!0));return O(Ne)},$=()=>{const j=new Date;j.setHours(0,0,0,0),console.log(" getWeekTodos ");const q=A().filter(he=>he.title.includes(""));q.length>0&&console.log(" getWeekTodos - :",q[0]?.priority||"none");const K=new Date(j);K.setDate(j.getDate()-j.getDay()),K.setHours(0,0,0,0);const oe=new Date(K);oe.setDate(K.getDate()+6),oe.setHours(0,0,0,0);const ie=t.todos.filter(he=>{if(he.completed&&he.completedAt){const xe=new Date(he.completedAt);return xe.setHours(0,0,0,0),xe>=K&&xe<=oe}if(!he.completed){const xe=he.startDate?new Date(he.startDate):null,Ie=he.dueDate?new Date(he.dueDate):null;if(xe&&xe.setHours(0,0,0,0),Ie&&Ie.setHours(0,0,0,0),xe&&Ie)return Ie.getTime()>=K.getTime()&&xe.getTime()<=oe.getTime();if(xe&&!Ie)return xe<=oe;if(!xe&&Ie)return Ie>=j;if(!xe&&!Ie)return!0}return!1}),Ne=A().filter(he=>{if(he.title.includes("")&&console.log(`  -  : completed=${he.completed}, completedAt=${he.completedAt}`),he.completed){if(he.completedAt){const Je=new Date(he.completedAt);Je.setHours(0,0,0,0);const Yn=Je>=K&&Je<=oe;return he.title.includes("")&&console.log(`     : =${Je.toDateString()}, =${Yn}`),Yn}return he.title.includes("")&&console.log("     :   -  "),!1}const xe=he.startDate?new Date(he.startDate):null,Ie=he.dueDate?new Date(he.dueDate):null;if(xe&&xe.setHours(0,0,0,0),Ie&&Ie.setHours(0,0,0,0),xe&&Ie){const Je=Ie.getTime()>=K.getTime()&&xe.getTime()<=oe.getTime();return console.log(`     : "${he.title}"`),console.log(`   : ${xe.toDateString()} ~ ${Ie.toDateString()}`),console.log(`   : ${K.toDateString()} ~ ${oe.toDateString()}`),console.log(`   : ${Je}`),Je}return xe&&!Ie?xe<=oe:!xe&&Ie?Ie>=K:!xe&&!Ie}),pe=[...ie,...Ne];console.log(" getWeekTodos    :",pe.filter(he=>he.title.includes("")).length);const ge={urgent:0,high:1,medium:2,low:3},je=pe.sort((he,xe)=>{const Ie=ge[he.priority]-ge[xe.priority];if(Ie!==0)return Ie;const Je=he.order||0,Yn=xe.order||0;return Je!==Yn?Je-Yn:new Date(he.createdAt).getTime()-new Date(xe.createdAt).getTime()});return console.log(" getWeekTodos   :",je.filter(he=>he.title.includes("")).map(he=>`${he.title}: ${he.priority}`)),O(je)},J=()=>{const j=new Date;j.setHours(0,0,0,0),console.log(" getMonthTodos ");const V=new Date(j.getFullYear(),j.getMonth(),1);V.setHours(0,0,0,0);const q=new Date(j.getFullYear(),j.getMonth()+1,0);q.setHours(0,0,0,0);const K=t.todos.filter(ge=>{if(ge.completed&&ge.completedAt){const je=new Date(ge.completedAt);return je.setHours(0,0,0,0),je>=V&&je<=q}if(!ge.completed){const je=ge.startDate?new Date(ge.startDate):null,he=ge.dueDate?new Date(ge.dueDate):null;if(je&&je.setHours(0,0,0,0),he&&he.setHours(0,0,0,0),je&&he)return he.getTime()>=V.getTime()&&je.getTime()<=q.getTime();if(je&&!he)return je<=q;if(!je&&he)return he>=j;if(!je&&!he)return!0}return!1}),ie=A().filter(ge=>{if(ge.completed){if(ge.completedAt){const xe=new Date(ge.completedAt);return xe.setHours(0,0,0,0),xe>=V&&xe<=q}return!1}const je=ge.startDate?new Date(ge.startDate):null,he=ge.dueDate?new Date(ge.dueDate):null;if(je&&je.setHours(0,0,0,0),he&&he.setHours(0,0,0,0),je&&he){const xe=he.getTime()>=V.getTime()&&je.getTime()<=q.getTime();return console.log(`     : "${ge.title}"`),console.log(`   : ${je.toDateString()} ~ ${he.toDateString()}`),console.log(`   : ${V.toDateString()} ~ ${q.toDateString()}`),console.log(`   : ${xe}`),xe}return je&&!he?je<=q:!je&&he?he>=V:!je&&!he}),te=[...K,...ie];console.log(" getMonthTodos    :",te.filter(ge=>ge.title.includes("")).length);const Ne={urgent:0,high:1,medium:2,low:3},pe=te.sort((ge,je)=>{const he=Ne[ge.priority]-Ne[je.priority];if(he!==0)return he;const xe=ge.order||0,Ie=je.order||0;return xe!==Ie?xe-Ie:new Date(ge.createdAt).getTime()-new Date(je.createdAt).getTime()});return console.log(" getMonthTodos   :",pe.filter(ge=>ge.title.includes("")).map(ge=>`${ge.title}: ${ge.priority}`)),O(pe)},ae=()=>{const j=new Date;return j.setHours(0,0,0,0),t.todos.filter(V=>{if(!V.dueDate||V.completed)return!1;const q=new Date(V.dueDate);return q.setHours(0,0,0,0),q<j})},me=j=>{const V=j||new Date,q=new Date(V);return q.setDate(q.getDate()+1),t.todos.filter(K=>K.dueDate?new Date(K.dueDate).toDateString()===q.toDateString():!1)},ke=j=>{const V=j||new Date,q=new Date(V);return q.setHours(0,0,0,0),t.todos.filter(K=>{if(K.completed||!K.dueDate)return!1;const oe=new Date(K.dueDate);return oe.setHours(0,0,0,0),oe.getTime()<q.getTime()})},ye=j=>{if(j.completed||!j.dueDate)return!1;const V=new Date;V.setHours(0,0,0,0);const q=new Date(j.dueDate);return q.setHours(0,0,0,0),q.getTime()<V.getTime()},fe=async(j,V)=>{if(j.startsWith("recurring_")){const K=j.replace("recurring_","");n({type:"UPDATE_RECURRING_INSTANCE",payload:{id:K,updates:{order:V}}}),console.log("    ",{todoId:j,instanceId:K,newOrder:V})}else if(n({type:"UPDATE_TODO",payload:{id:j,updates:{order:V,updatedAt:new Date}}}),i?.uid)try{await Ce.updateTodo(j,{order:V},i.uid),console.log("  Firestore  ",{todoId:j,newOrder:V})}catch(K){console.error("  Firestore  :",K)}},Re=async(j,V,q)=>{const K=Array.from(q),[oe]=K.splice(j,1);K.splice(V,0,oe);const ie=K.map((te,Ne)=>fe(te.id,Ne));try{await Promise.all(ie),console.log("    ",{count:ie.length})}catch(te){console.error("     :",te)}},Ue=j=>{const V=[...t.todos,...A()],q=new Date;return q.setHours(0,0,0,0),V.filter(K=>{if(K.startDate&&!j.completionDateFilter){const oe=new Date(K.startDate);if(oe.setHours(0,0,0,0),oe>q)return!1}if(j.searchTerm){const oe=j.searchTerm.toLowerCase(),ie=K.title.toLowerCase().includes(oe),te=K.description?.toLowerCase().includes(oe)||!1,Ne=K.tags?.some(pe=>pe.toLowerCase().includes(oe))||!1;if(!ie&&!te&&!Ne)return!1}if(j.priorityFilter&&j.priorityFilter!=="all"&&K.priority!==j.priorityFilter||j.typeFilter&&j.typeFilter!=="all"&&K.type!==j.typeFilter||j.projectFilter&&j.projectFilter!=="all"&&K.project!==j.projectFilter)return!1;if(j.tagFilter&&j.tagFilter.length>0){const oe=K.tags||[];if(!j.tagFilter.some(te=>oe.includes(te)))return!1}if(j.completionDateFilter&&j.completionDateFilter!=="all"&&K.completedAt){const oe=new Date(K.completedAt),ie=new Date;switch(j.completionDateFilter){case"today":if(oe.toDateString()!==ie.toDateString())return!1;break;case"yesterday":const te=new Date;if(te.setDate(ie.getDate()-1),oe.toDateString()!==te.toDateString())return!1;break;case"thisWeek":const Ne=new Date(ie);if(Ne.setDate(ie.getDate()-ie.getDay()),Ne.setHours(0,0,0,0),oe<Ne)return!1;break;case"lastWeek":const pe=new Date(ie);pe.setDate(ie.getDate()-ie.getDay()-7),pe.setHours(0,0,0,0);const ge=new Date(ie);if(ge.setDate(ie.getDate()-ie.getDay()-1),ge.setHours(23,59,59,999),oe<pe||oe>ge)return!1;break;case"thisMonth":const je=new Date(ie.getFullYear(),ie.getMonth(),1);if(oe<je)return!1;break}}return!(j.includeCompleted===!1&&K.completed)})},F=async j=>{console.log("===     ==="),console.log("currentUser:",i),console.log("templateData:",j);try{if(i){console.log("Firestore   ");const V=await Ce.addRecurringTemplate(j,i.uid);console.log("  Firestore  :",V),console.log("    -  useEffect  ")}else{console.log(" :    ");const V={...j,id:_o(),createdAt:new Date,updatedAt:new Date};n({type:"ADD_RECURRING_TEMPLATE",payload:V})}console.log("===     ===")}catch(V){console.error("   :",V),n({type:"SET_ERROR",payload:"     ."})}},ee=async(j,V)=>{console.log("    "),console.log(" ID:",j),console.log(" :",V);try{if(i)console.log(" Firebase  -   ( useEffect  )"),console.log("1 Firestore   "),await Ce.updateRecurringTemplate(j,V,i.uid),console.log("   Firestore  :",j),console.log("2    "),n({type:"UPDATE_RECURRING_TEMPLATE",payload:{id:j,updates:V}}),console.log("     "),console.log("   useEffect  .");else{console.log(" :    ");const q=t.todos.filter(K=>K._templateId===j);console.log(` ${j}   ${q.length} `);for(const K of q)console.log(` : ${K.title} (${K.id})`),n({type:"DELETE_TODO",payload:K.id});n({type:"UPDATE_RECURRING_TEMPLATE",payload:{id:j,updates:V}}),setTimeout(()=>{console.log("     "),N()},100)}console.log("===     ===")}catch(q){console.error("   :",q),n({type:"SET_ERROR",payload:"     ."})}},ce=async j=>{try{i?(n({type:"DELETE_RECURRING_TEMPLATE",payload:j}),console.log("  UI   :",j),await Ce.deleteRecurringTemplate(j,i.uid),console.log("   Firestore  :",j)):(console.log(" :    "),n({type:"DELETE_RECURRING_TEMPLATE",payload:j}),console.log("   - localStorage  ,  "))}catch(V){console.error("   :",V),n({type:"SET_ERROR",payload:"     ."})}},I=async()=>{if(!i)return;console.log("      (Deep Check)");const j={};t.recurringTemplates.forEach(q=>{const oe=[q.title,q.recurrenceType,q.recurrenceType==="weekly"?q.weekday:"",q.recurrenceType==="monthly"?`${q.monthlyDate}-${q.monthlyPattern}-${q.monthlyWeek}-${q.monthlyWeekday}`:""].join("|");j[oe]||(j[oe]=[]),j[oe].push(q)});const V=Object.values(j).filter(q=>q.length>1);if(V.length>0){console.log(` ${V.length}    `);for(const q of V){const K=q.sort((te,Ne)=>new Date(Ne.createdAt).getTime()-new Date(te.createdAt).getTime()),oe=K[0],ie=K.slice(1);console.log(` '${oe.title}'  ${ie.length}  `);for(const te of ie)await ce(te.id)}console.log("   ")}else console.log("   .")};M.useEffect(()=>{if(t.recurringTemplates.length>0&&i){const j=setTimeout(()=>{I()},2e3);return()=>clearTimeout(j)}},[t.recurringTemplates,i]);const N=()=>{if(i){console.log("   -     !");return}if(c){console.log("    -   ");return}let j=[];t.recurringTemplates.filter(V=>V.isActive).forEach(V=>{try{const q=ir.generateInstances(V);j=[...j,...q]}catch(q){console.error(` ${V.id}   :`,q)}}),n({type:"SET_RECURRING_INSTANCES",payload:j})},A=()=>t.recurringTemplates.length===0||t.recurringInstances.length===0?[]:t.recurringInstances.filter(q=>!q.skipped).map(q=>{const K=t.recurringTemplates.find(oe=>oe.id===q.templateId);return K?ir.convertToTodo(q,K):null}).filter(q=>q!==null),_=()=>{const j=t.todos.filter(te=>!te.completed&&(te.order===void 0||te.order===null)),V=A().filter(te=>!te.completed&&(te.order===void 0||te.order===null)),q=[...j,...V];if(q.length===0)return;console.log(" Order   :",q.length,"");const K={urgent:q.filter(te=>te.priority==="urgent"),high:q.filter(te=>te.priority==="high"),medium:q.filter(te=>te.priority==="medium"),low:q.filter(te=>te.priority==="low")},oe=[],ie=[];Object.entries(K).forEach(([te,Ne],pe)=>{if(Ne.length===0)return;const ge=Ne.sort((he,xe)=>new Date(he.createdAt).getTime()-new Date(xe.createdAt).getTime()),je=pe*1e3;ge.forEach((he,xe)=>{const Ie=je+xe*10;if(he._isRecurringInstance){console.log("  order :",he.title,"",Ie);const Je=he._instanceId;ie.push(Je),n({type:"UPDATE_RECURRING_INSTANCE",payload:{id:Je,updates:{order:Ie}}})}else oe.push({...he,order:Ie})})}),oe.forEach(async te=>{try{i&&await Ce.updateTodo(te.id,{order:te.order},i.uid),n({type:"UPDATE_TODO",payload:{id:te.id,updates:{order:te.order}}})}catch(Ne){console.error("Order   :",te.id,Ne)}}),console.log(" Order  :",oe.length,"  ,",ie.length," ")},H=async()=>{if(!i){console.log("   ");return}console.log(" Firestore   ..."),n({type:"SET_LOADING",payload:!0});try{const j=await Ce.getTodos(i.uid);console.log("   :",j.length," "),n({type:"SET_TODOS",payload:j}),n({type:"SET_ERROR",payload:null})}catch(j){console.error("   :",j),n({type:"SET_ERROR",payload:"  ."})}finally{n({type:"SET_LOADING",payload:!1})}},U=async()=>{if(!i){console.log("   ");return}console.log("  : Firebase     ");try{console.log("1      ...");const j=await Ce.getRecurringInstances(i.uid);console.log(`  : ${j.length}`);for(const q of j)await Ce.deleteRecurringInstance(q.id,i.uid),console.log(`  : ${q.id}`);console.log("2    ...");const V=t.recurringTemplates.filter(q=>q.isActive);console.log(`  : ${V.length}`);for(const q of V){console.log(`  : ${q.title} (monthlyDate: ${q.monthlyDate})`);const K=ir.generateInstances(q);console.log(` : ${K.length}`);for(const oe of K){const ie={templateId:oe.templateId,date:oe.date,completed:!1,createdAt:oe.createdAt,updatedAt:oe.updatedAt},te=await Ce.addRecurringInstance(ie,i.uid);console.log(`  : ${te} - ${oe.date.toDateString()}`)}}console.log("3    ..."),await H(),console.log("   !"),alert(`    !
 .`)}catch(j){console.error("   :",j),alert("    .")}},Z=async()=>{if(!i){console.log("   ");return}console.log("    (  )");try{const j=await Ce.getTodos(i.uid);console.log("   :",j.length," "),n({type:"SET_TODOS",payload:j})}catch(j){console.error("   :",j)}},le=M.useCallback(async()=>{if(!i?.uid){console.log("  ...");return}try{console.log("    ");const j=await Tu.cleanupOrphanedInstances(i.uid);console.log("    :",j),alert(`  !
-  : ${j.orphanedInstances}
-  : ${j.orphanedTodos}
-  : ${j.totalCleaned}`),await H()}catch(j){console.error("    :",j),alert("    .")}},[i]),ue=M.useCallback(async()=>{if(!i?.uid){console.log("  ...");return}try{console.log("    ");const j=await Tu.validateTemplateConsistency(i.uid);console.log("     -  "),alert(`  !
 ${j.size}     .`)}catch(j){console.error("    :",j),alert("    .")}},[i]),be=M.useCallback(async()=>{if(!i?.uid){console.log("  ...");return}if(!window.confirm(`   :

 :    
 :    

   . ?`)){console.log("  ");return}try{console.log("   ");const V=await Tu.smartCleanupInstances(i.uid);console.log("   :",V),alert(`   !

: ${V.deletedInstances}  
: ${V.keptInstances}  

   ! `),setTimeout(()=>{window.location.reload()},1e3)}catch(V){console.error("   :",V),alert("     .")}},[i]);M.useEffect(()=>{typeof window<"u"&&(window.fixRecurringInstances=U,window.cleanupOrphanedData=le,window.validateDataConsistency=ue,window.smartCleanupInstances=be,window.checkLoginStatus=()=>{console.log(" :",i?" ":"  "),i&&console.log(":",i.email)},window.forceRegenerateInstances=async()=>{if(!i?.uid){console.log("   ");return}console.log("     ...");try{await Promise.all(t.recurringTemplates.filter(j=>j.isActive!==!1).map(j=>Ce.regenerateRecurringInstances(j.id,i.uid))),console.log("   !  ."),setTimeout(()=>window.location.reload(),1e3)}catch(j){console.error("   :",j)}},window.fixBusinessTripTemplate=async()=>{if(!i?.uid){console.log("   ");return}try{console.log("      ...");const j=t.recurringTemplates.find(q=>q.title.includes("")&&q.title.includes("")&&q.title.includes(""));if(!j){console.log("       "),console.log("  :",t.recurringTemplates.map(q=>q.title));return}console.log("   :",j);const V={monthlyPattern:"weekday",monthlyWeek:"fourth",monthlyWeekday:2,monthlyDate:void 0};console.log("  :"),console.log("  0=, 1=, 2=, 3=, 4=, 5=, 6="),console.log(`   2 = ${["","","","","","",""][2]}`),console.log("  :",V),await Ce.updateRecurringTemplate(j.id,V,i.uid),console.log("      !"),console.log("   ..."),await Ce.regenerateRecurringInstances(j.id,i.uid),console.log("   !  ."),setTimeout(()=>window.location.reload(),1e3)}catch(j){console.error("   :",j)}},console.log("  - cleanupOrphanedData():   "))},[]);const Oe=M.useCallback(()=>{const j={todos:t.todos,recurringTemplates:t.recurringTemplates,recurringInstances:t.recurringInstances,exportedAt:new Date().toISOString(),version:"1.0.0"};return JSON.stringify(j,null,2)},[t]),Le=M.useCallback(async j=>{try{const V=JSON.parse(j);if(!V.todos)throw new Error("Invalid data format");const q=V.todos.map(K=>({...K,createdAt:new Date(K.createdAt),updatedAt:new Date(K.updatedAt),dueDate:K.dueDate?new Date(K.dueDate):void 0,startDate:K.startDate?new Date(K.startDate):void 0,completedAt:K.completedAt?new Date(K.completedAt):void 0}));return n(i?{type:"SET_TODOS",payload:q}:{type:"SET_TODOS",payload:q}),!0}catch(V){return console.error("Import failed:",V),!1}},[i]),we=M.useCallback(async()=>{const j=t.todos.filter(V=>V.completed);for(const V of j)await z(V.id)},[t.todos,z]),pt=M.useCallback(async()=>{await w()},[w]),dn=M.useMemo(()=>({total:t.todos.length,completed:t.todos.filter(j=>j.completed).length,pending:t.todos.filter(j=>!j.completed).length}),[t.todos]),qt={...t,addTodo:C,updateTodo:T,deleteTodo:z,toggleTodo:W,addSubTask:k,updateSubTask:R,deleteSubTask:D,toggleSubTask:E,syncWithFirestore:w,getTodayTodos:P,getWeekTodos:$,getMonthTodos:J,getOverdueTodos:ae,getTomorrowTodos:me,getYesterdayIncompleteTodos:ke,isYesterdayIncompleteTodo:ye,updateTodoOrder:fe,reorderTodos:Re,getFilteredTodos:Ue,addRecurringTemplate:F,updateRecurringTemplate:ee,deleteRecurringTemplate:ce,generateRecurringInstances:N,getRecurringTodos:A,cleanupDuplicateTemplates:I,forceRefresh:H,manualRefresh:Z,initializeOrderValues:_,fixRecurringInstances:U,cleanupOrphanedData:le,validateDataConsistency:ue,smartCleanupInstances:be,exportData:Oe,importData:Le,clearCompleted:we,syncWithCloud:pt,stats:dn};return r.jsx(ky.Provider,{value:qt,children:l})},Ft=()=>{const l=M.useContext(ky);if(l===void 0)throw new Error("useTodos must be used within a TodoProvider");return l},_y=M.createContext(void 0),Ny=()=>{const l=M.useContext(_y);if(l===void 0)throw new Error("useTheme must be used within a ThemeProvider");return l},j_=({children:l})=>{const[t,n]=M.useState(()=>localStorage.getItem("theme")||"system"),[i,c]=M.useState(!1);return M.useEffect(()=>{const d=window.document.documentElement,h=()=>{d.classList.remove("dark");let f;t==="system"?f=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":f=t,f==="dark"&&d.classList.add("dark"),c(f==="dark")};if(h(),t==="system"){const f=window.matchMedia("(prefers-color-scheme: dark)"),m=()=>h();return f.addEventListener("change",m),()=>f.removeEventListener("change",m)}},[t]),M.useEffect(()=>{localStorage.setItem("theme",t)},[t]),r.jsx(_y.Provider,{value:{theme:t,setTheme:n,isDark:i},children:l})},T_=["lkd0115lkd@gmail.com"],Ln=l=>l?T_.includes(l):!1;var ep={};const tp="@firebase/database",sp="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jy="";function S_(l){jy=l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,n){n==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),jt(n))}get(t){const n=this.domStorage_.getItem(this.prefixedName_(t));return n==null?null:lh(n)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,n){n==null?delete this.cache_[t]:this.cache_[t]=n}get(t){return on(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ty=function(l){try{if(typeof window<"u"&&typeof window[l]<"u"){const t=window[l];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new D_(t)}}catch{}return new E_},ha=Ty("localStorage"),C_=Ty("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dr=new Zw("@firebase/database"),A_=function(){let l=1;return function(){return l++}}(),Sy=function(l){const t=Jw(l),n=new ek;n.update(t);const i=n.digest();return tk.encodeByteArray(i)},Xl=function(...l){let t="";for(let n=0;n<l.length;n++){const i=l[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?t+=Xl.apply(null,i):typeof i=="object"?t+=jt(i):t+=i,t+=" "}return t};let El=null,np=!0;const R_=function(l,t){de(!0,"Can't turn on custom loggers persistently."),dr.logLevel=sk.VERBOSE,El=dr.log.bind(dr)},zt=function(...l){if(np===!0&&(np=!1,El===null&&C_.get("logging_enabled")===!0&&R_()),El){const t=Xl.apply(null,l);El(t)}},Kl=function(l){return function(...t){zt(l,...t)}},Yu=function(...l){const t="FIREBASE INTERNAL ERROR: "+Xl(...l);dr.error(t)},ln=function(...l){const t=`FIREBASE FATAL ERROR: ${Xl(...l)}`;throw dr.error(t),new Error(t)},Zt=function(...l){const t="FIREBASE WARNING: "+Xl(...l);dr.warn(t)},O_=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Zt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Dy=function(l){return typeof l=="number"&&(l!==l||l===Number.POSITIVE_INFINITY||l===Number.NEGATIVE_INFINITY)},M_=function(l){if(document.readyState==="complete")l();else{let t=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,l())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},fr="[MIN_NAME]",ma="[MAX_NAME]",yr=function(l,t){if(l===t)return 0;if(l===fr||t===ma)return-1;if(t===fr||l===ma)return 1;{const n=ap(l),i=ap(t);return n!==null?i!==null?n-i===0?l.length-t.length:n-i:-1:i!==null?1:l<t?-1:1}},I_=function(l,t){return l===t?0:l<t?-1:1},vl=function(l,t){if(t&&l in t)return t[l];throw new Error("Missing required key ("+l+") in object: "+jt(t))},uh=function(l){if(typeof l!="object"||l===null)return jt(l);const t=[];for(const i in l)t.push(i);t.sort();let n="{";for(let i=0;i<t.length;i++)i!==0&&(n+=","),n+=jt(t[i]),n+=":",n+=uh(l[t[i]]);return n+="}",n},Ey=function(l,t){const n=l.length;if(n<=t)return[l];const i=[];for(let c=0;c<n;c+=t)c+t>n?i.push(l.substring(c,n)):i.push(l.substring(c,c+t));return i};function Jt(l,t){for(const n in l)l.hasOwnProperty(n)&&t(n,l[n])}const Cy=function(l){de(!Dy(l),"Invalid JSON number");const t=11,n=52,i=(1<<t-1)-1;let c,d,h,f,m;l===0?(d=0,h=0,c=1/l===-1/0?1:0):(c=l<0,l=Math.abs(l),l>=Math.pow(2,1-i)?(f=Math.min(Math.floor(Math.log(l)/Math.LN2),i),d=f+i,h=Math.round(l*Math.pow(2,n-f)-Math.pow(2,n))):(d=0,h=Math.round(l/Math.pow(2,1-i-n))));const p=[];for(m=n;m;m-=1)p.push(h%2?1:0),h=Math.floor(h/2);for(m=t;m;m-=1)p.push(d%2?1:0),d=Math.floor(d/2);p.push(c?1:0),p.reverse();const x=p.join("");let b="";for(m=0;m<64;m+=8){let w=parseInt(x.substr(m,8),2).toString(16);w.length===1&&(w="0"+w),b=b+w}return b.toLowerCase()},U_=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},L_=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function H_(l,t){let n="Unknown Error";l==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":l==="permission_denied"?n="Client doesn't have permission to access the desired data.":l==="unavailable"&&(n="The service is unavailable");const i=new Error(l+" at "+t._path.toString()+": "+n);return i.code=l.toUpperCase(),i}const $_=new RegExp("^-?(0*)\\d{1,10}$"),z_=-2147483648,B_=2147483647,ap=function(l){if($_.test(l)){const t=Number(l);if(t>=z_&&t<=B_)return t}return null},xr=function(l){try{l()}catch(t){setTimeout(()=>{const n=t.stack||"";throw Zt("Exception was thrown by user callback.",n),t},Math.floor(0))}},F_=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Cl=function(l,t){const n=setTimeout(l,t);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(t,n){this.appCheckProvider=n,this.appName=t.name,Jp(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(n,i):n(null)},0)})}addTokenChangeListener(t){this.appCheckProvider?.get().then(n=>n.addTokenListener(t))}notifyForInvalidToken(){Zt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y_{constructor(t,n,i){this.appName_=t,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(c=>this.auth_=c)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(n=>n&&n.code==="auth/token-not-initialized"?(zt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(n,i):n(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(n=>n.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(n=>n.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Zt(t)}}class No{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}No.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hh="5",Ay="v",Ry="s",Oy="r",My="f",Iy=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Uy="ls",Ly="p",qu="ac",Hy="websocket",$y="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(t,n,i,c,d=!1,h="",f=!1,m=!1,p=null){this.secure=n,this.namespace=i,this.webSocketOnly=c,this.nodeAdmin=d,this.persistenceKey=h,this.includeNamespaceInQueryParams=f,this.isUsingEmulator=m,this.emulatorOptions=p,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ha.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&ha.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${n}`}}function q_(l){return l.host!==l.internalHost||l.isCustomHost()||l.includeNamespaceInQueryParams}function By(l,t,n){de(typeof t=="string","typeof type must == string"),de(typeof n=="object","typeof params must == object");let i;if(t===Hy)i=(l.secure?"wss://":"ws://")+l.internalHost+"/.ws?";else if(t===$y)i=(l.secure?"https://":"http://")+l.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);q_(l)&&(n.ns=l.namespace);const c=[];return Jt(n,(d,h)=>{c.push(d+"="+h)}),i+c.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(){this.counters_={}}incrementCounter(t,n=1){on(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=n}get(){return ik(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Su={},Du={};function gh(l){const t=l.toString();return Su[t]||(Su[t]=new G_),Su[t]}function P_(l,t){const n=l.toString();return Du[n]||(Du[n]=t()),Du[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,n){this.closeAfterResponse=t,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,n){for(this.pendingResponses[t]=n;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let c=0;c<i.length;++c)i[c]&&xr(()=>{this.onMessage_(i[c])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rp="start",Q_="close",X_="pLPCommand",K_="pRTLPCB",Fy="id",Vy="pw",Yy="ser",Z_="cb",J_="seg",eN="ts",tN="d",sN="dframe",qy=1870,Gy=30,nN=qy-Gy,aN=25e3,rN=3e4;class cr{constructor(t,n,i,c,d,h,f){this.connId=t,this.repoInfo=n,this.applicationId=i,this.appCheckToken=c,this.authToken=d,this.transportSessionId=h,this.lastSessionId=f,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Kl(t),this.stats_=gh(n),this.urlFn=m=>(this.appCheckToken&&(m[qu]=this.appCheckToken),By(n,$y,m))}open(t,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new W_(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(rN)),M_(()=>{if(this.isClosed_)return;this.scriptTagHolder=new fh((...d)=>{const[h,f,m,p,x]=d;if(this.incrementIncomingBytes_(d),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,h===rp)this.id=f,this.password=m;else if(h===Q_)f?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(f,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+h)},(...d)=>{const[h,f]=d;this.incrementIncomingBytes_(d),this.myPacketOrderer.handleResponse(h,f)},()=>{this.onClosed_()},this.urlFn);const i={};i[rp]="t",i[Yy]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Z_]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Ay]=hh,this.transportSessionId&&(i[Ry]=this.transportSessionId),this.lastSessionId&&(i[Uy]=this.lastSessionId),this.applicationId&&(i[Ly]=this.applicationId),this.appCheckToken&&(i[qu]=this.appCheckToken),typeof location<"u"&&location.hostname&&Iy.test(location.hostname)&&(i[Oy]=My);const c=this.urlFn(i);this.log_("Connecting via long-poll to "+c),this.scriptTagHolder.addTag(c,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){cr.forceAllow_=!0}static forceDisallow(){cr.forceDisallow_=!0}static isAvailable(){return cr.forceAllow_?!0:!cr.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!U_()&&!L_()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const n=jt(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=ok(n),c=Ey(i,nN);for(let d=0;d<c.length;d++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[d]),this.curSegmentNum++}addDisconnectPingFrame(t,n){this.myDisconnFrame=document.createElement("iframe");const i={};i[sN]="t",i[Fy]=t,i[Vy]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const n=jt(t).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class fh{constructor(t,n,i,c){this.onDisconnect=i,this.urlFn=c,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=A_(),window[X_+this.uniqueCallbackIdentifier]=t,window[K_+this.uniqueCallbackIdentifier]=n,this.myIFrame=fh.createIFrame_();let d="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(d='<script>document.domain="'+document.domain+'";<\/script>');const h="<html><body>"+d+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(h),this.myIFrame.doc.close()}catch(f){zt("frame writing exception"),f.stack&&zt(f.stack),zt(f)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||zt("No IE domain setting required")}catch{const i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,n){for(this.myID=t,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[Fy]=this.myID,t[Vy]=this.myPW,t[Yy]=this.currentSerial;let n=this.urlFn(t),i="",c=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Gy+i.length<=qy;){const h=this.pendingSegs.shift();i=i+"&"+J_+c+"="+h.seg+"&"+eN+c+"="+h.ts+"&"+tN+c+"="+h.d,c++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(t,n,i){this.pendingSegs.push({seg:t,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,n){this.outstandingRequests.add(n);const i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},c=setTimeout(i,Math.floor(aN)),d=()=>{clearTimeout(c),i()};this.addTag(t,d)}addTag(t,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){const c=i.readyState;(!c||c==="loaded"||c==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{zt("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lN=16384,iN=45e3;let Oo=null;typeof MozWebSocket<"u"?Oo=MozWebSocket:typeof WebSocket<"u"&&(Oo=WebSocket);class js{constructor(t,n,i,c,d,h,f){this.connId=t,this.applicationId=i,this.appCheckToken=c,this.authToken=d,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Kl(this.connId),this.stats_=gh(n),this.connURL=js.connectionURL_(n,h,f,c,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(t,n,i,c,d){const h={};return h[Ay]=hh,typeof location<"u"&&location.hostname&&Iy.test(location.hostname)&&(h[Oy]=My),n&&(h[Ry]=n),i&&(h[Uy]=i),c&&(h[qu]=c),d&&(h[Ly]=d),By(t,Hy,h)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ha.set("previous_websocket_failure",!0);try{let i;ck(),this.mySock=new Oo(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const c=i.message||i.data;c&&this.log_(c),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const c=i.message||i.data;c&&this.log_(c),this.onClosed_()}}start(){}static forceDisallow(){js.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Oo!==null&&!js.forceDisallow_}static previouslyFailed(){return ha.isInMemoryStorage||ha.get("previous_websocket_failure")===!0}markConnectionHealthy(){ha.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const i=lh(n);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(de(this.frames===null,"We already have a frame buffer"),t.length<=6){const n=Number(t);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;const n=t.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();const n=jt(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=Ey(n,lN);i.length>1&&this.sendString_(String(i.length));for(let c=0;c<i.length;c++)this.sendString_(i[c])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(iN))}sendString_(t){try{this.mySock.send(t)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}js.responsesRequiredToBeHealthy=2;js.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{static get ALL_TRANSPORTS(){return[cr,js]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const n=js&&js.isAvailable();let i=n&&!js.previouslyFailed();if(t.webSocketOnly&&(n||Zt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[js];else{const c=this.transports_=[];for(const d of Il.ALL_TRANSPORTS)d&&d.isAvailable()&&c.push(d);Il.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Il.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oN=6e4,cN=5e3,dN=10*1024,uN=100*1024,Eu="t",lp="d",hN="s",ip="r",gN="e",op="o",cp="a",dp="n",up="p",fN="h";class mN{constructor(t,n,i,c,d,h,f,m,p,x){this.id=t,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=c,this.authToken_=d,this.onMessage_=h,this.onReady_=f,this.onDisconnect_=m,this.onKill_=p,this.lastSessionId=x,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Kl("c:"+this.id+":"),this.transportManager_=new Il(n),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));const c=t.healthyTimeout||0;c>0&&(this.healthyTimeout_=Cl(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>uN?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>dN?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(c)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return n=>{t===this.conn_?this.onConnectionLost_(n):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return n=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(n):t===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(t){const n={t:"d",d:t};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(Eu in t){const n=t[Eu];n===cp?this.upgradeIfSecondaryHealthy_():n===ip?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===op&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const n=vl("t",t),i=vl("d",t);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:up,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:cp,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:dp,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const n=vl("t",t),i=vl("d",t);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const n=vl(Eu,t);if(lp in t){const i=t[lp];if(n===fN){const c={...i};this.repoInfo_.isUsingEmulator&&(c.h=this.repoInfo_.host),this.onHandshake_(c)}else if(n===dp){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let c=0;c<this.pendingDataMessages.length;++c)this.onDataMessage_(this.pendingDataMessages[c]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===hN?this.onConnectionShutdown_(i):n===ip?this.onReset_(i):n===gN?Yu("Server Error: "+i):n===op?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Yu("Unknown control packet command: "+n)}}onHandshake_(t){const n=t.ts,i=t.v,c=t.h;this.sessionId=t.s,this.repoInfo_.host=c,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),hh!==i&&Zt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),Cl(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(oN))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,n){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Cl(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(cN))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:up,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ha.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{put(t,n,i,c){}merge(t,n,i,c){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,n,i){}onDisconnectMerge(t,n,i){}onDisconnectCancel(t,n){}reportStats(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(t){this.allowedEvents_=t,this.listeners_={},de(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const i=[...this.listeners_[t]];for(let c=0;c<i.length;c++)i[c].callback.apply(i[c].context,n)}}on(t,n,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:n,context:i});const c=this.getInitialEvent(t);c&&n.apply(i,c)}off(t,n,i){this.validateEventType_(t);const c=this.listeners_[t]||[];for(let d=0;d<c.length;d++)if(c[d].callback===n&&(!i||i===c[d].context)){c.splice(d,1);return}}validateEventType_(t){de(this.allowedEvents_.find(n=>n===t),"Unknown event: "+t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo extends Wy{static getInstance(){return new Mo}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!oy()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return de(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hp=32,gp=768;class at{constructor(t,n){if(n===void 0){this.pieces_=t.split("/");let i=0;for(let c=0;c<this.pieces_.length;c++)this.pieces_[c].length>0&&(this.pieces_[i]=this.pieces_[c],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=n}toString(){let t="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(t+="/"+this.pieces_[n]);return t||"/"}}function Pe(){return new at("")}function ze(l){return l.pieceNum_>=l.pieces_.length?null:l.pieces_[l.pieceNum_]}function zn(l){return l.pieces_.length-l.pieceNum_}function it(l){let t=l.pieceNum_;return t<l.pieces_.length&&t++,new at(l.pieces_,t)}function Qy(l){return l.pieceNum_<l.pieces_.length?l.pieces_[l.pieces_.length-1]:null}function pN(l){let t="";for(let n=l.pieceNum_;n<l.pieces_.length;n++)l.pieces_[n]!==""&&(t+="/"+encodeURIComponent(String(l.pieces_[n])));return t||"/"}function Xy(l,t=0){return l.pieces_.slice(l.pieceNum_+t)}function Ky(l){if(l.pieceNum_>=l.pieces_.length)return null;const t=[];for(let n=l.pieceNum_;n<l.pieces_.length-1;n++)t.push(l.pieces_[n]);return new at(t,0)}function Tt(l,t){const n=[];for(let i=l.pieceNum_;i<l.pieces_.length;i++)n.push(l.pieces_[i]);if(t instanceof at)for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else{const i=t.split("/");for(let c=0;c<i.length;c++)i[c].length>0&&n.push(i[c])}return new at(n,0)}function Ye(l){return l.pieceNum_>=l.pieces_.length}function Yt(l,t){const n=ze(l),i=ze(t);if(n===null)return t;if(n===i)return Yt(it(l),it(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+l+")")}function mh(l,t){if(zn(l)!==zn(t))return!1;for(let n=l.pieceNum_,i=t.pieceNum_;n<=l.pieces_.length;n++,i++)if(l.pieces_[n]!==t.pieces_[i])return!1;return!0}function Ss(l,t){let n=l.pieceNum_,i=t.pieceNum_;if(zn(l)>zn(t))return!1;for(;n<l.pieces_.length;){if(l.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class yN{constructor(t,n){this.errorPrefix_=n,this.parts_=Xy(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Wo(this.parts_[i]);Zy(this)}}function xN(l,t){l.parts_.length>0&&(l.byteLength_+=1),l.parts_.push(t),l.byteLength_+=Wo(t),Zy(l)}function bN(l){const t=l.parts_.pop();l.byteLength_-=Wo(t),l.parts_.length>0&&(l.byteLength_-=1)}function Zy(l){if(l.byteLength_>gp)throw new Error(l.errorPrefix_+"has a key path longer than "+gp+" bytes ("+l.byteLength_+").");if(l.parts_.length>hp)throw new Error(l.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+hp+") or object contains a cycle "+da(l))}function da(l){return l.parts_.length===0?"":"in property '"+l.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph extends Wy{static getInstance(){return new ph}constructor(){super(["visible"]);let t,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(t){return de(t==="visible","Unknown event type: "+t),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl=1e3,vN=300*1e3,fp=30*1e3,wN=1.3,kN=3e4,_N="server_kill",mp=3;class rn extends Py{constructor(t,n,i,c,d,h,f,m){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=c,this.onServerInfoUpdate_=d,this.authTokenProvider_=h,this.appCheckTokenProvider_=f,this.authOverride_=m,this.id=rn.nextPersistentConnectionId_++,this.log_=Kl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=wl,this.maxReconnectDelay_=vN,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,m)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ph.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Mo.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,i){const c=++this.requestNumber_,d={r:c,a:t,b:n};this.log_(jt(d)),de(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(d),i&&(this.requestCBHash_[c]=i)}get(t){this.initConnection_();const n=new oh,c={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:h=>{const f=h.d;h.s==="ok"?n.resolve(f):n.reject(f)}};this.outstandingGets_.push(c),this.outstandingGetCount_++;const d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),n.promise}listen(t,n,i,c){this.initConnection_();const d=t._queryIdentifier,h=t._path.toString();this.log_("Listen called for "+h+" "+d),this.listens.has(h)||this.listens.set(h,new Map),de(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),de(!this.listens.get(h).has(d),"listen() called twice for same path/queryId.");const f={onComplete:c,hashFn:n,query:t,tag:i};this.listens.get(h).set(d,f),this.connected_&&this.sendListen_(f)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(t){const n=t.query,i=n._path.toString(),c=n._queryIdentifier;this.log_("Listen on "+i+" for "+c);const d={p:i},h="q";t.tag&&(d.q=n._queryObject,d.t=t.tag),d.h=t.hashFn(),this.sendRequest(h,d,f=>{const m=f.d,p=f.s;rn.warnOnListenWarnings_(m,n),(this.listens.get(i)&&this.listens.get(i).get(c))===t&&(this.log_("listen response",f),p!=="ok"&&this.removeListen_(i,c),t.onComplete&&t.onComplete(p,m))})}static warnOnListenWarnings_(t,n){if(t&&typeof t=="object"&&on(t,"w")){const i=hr(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const c='".indexOn": "'+n._queryParams.getIndex().toString()+'"',d=n._path.toString();Zt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${c} at ${d} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ak(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=fp)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,n=rk(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,c=>{const d=c.s,h=c.d||"error";this.authToken_===t&&(d==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(d,h))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const n=t.s,i=t.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(t,n){const i=t._path.toString(),c=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+c),de(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,c)&&this.connected_&&this.sendUnlisten_(i,c,t._queryObject,n)}sendUnlisten_(t,n,i,c){this.log_("Unlisten on "+t+" for "+n);const d={p:t},h="n";c&&(d.q=i,d.t=c),this.sendRequest(h,d)}onDisconnectPut(t,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,n,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:n,onComplete:i})}onDisconnectMerge(t,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,n,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:n,onComplete:i})}onDisconnectCancel(t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(t,n,i,c){const d={p:n,d:i};this.log_("onDisconnect "+t,d),this.sendRequest(t,d,h=>{c&&setTimeout(()=>{c(h.s,h.d)},Math.floor(0))})}put(t,n,i,c){this.putInternal("p",t,n,i,c)}merge(t,n,i,c){this.putInternal("m",t,n,i,c)}putInternal(t,n,i,c,d){this.initConnection_();const h={p:n,d:i};d!==void 0&&(h.h=d),this.outstandingPuts_.push({action:t,request:h,onComplete:c}),this.outstandingPutCount_++;const f=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(f):this.log_("Buffering put: "+n)}sendPut_(t){const n=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,c=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,i,d=>{this.log_(n+" response",d),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),c&&c(d.s,d.d)})}reportStats(t){if(this.connected_){const n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){const d=i.d;this.log_("reportStats","Error sending stats: "+d)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+jt(t));const n=t.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,n){this.log_("handleServerMessage",t,n),t==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):t==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):t==="c"?this.onListenRevoked_(n.p,n.q):t==="ac"?this.onAuthRevoked_(n.s,n.d):t==="apc"?this.onAppCheckRevoked_(n.s,n.d):t==="sd"?this.onSecurityDebugPacket_(n):Yu("Unrecognized action received from server: "+jt(t)+`
Are you using the latest client?`)}onReady_(t,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){de(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=wl,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=wl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>kN&&(this.reconnectDelay_=wl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*wN)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),c=this.id+":"+rn.nextConnectionId_++,d=this.lastSessionId;let h=!1,f=null;const m=function(){f?f.close():(h=!0,i())},p=function(b){de(f,"sendRequest call when we're not connected not allowed."),f.sendRequest(b)};this.realtime_={close:m,sendRequest:p};const x=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[b,w]=await Promise.all([this.authTokenProvider_.getToken(x),this.appCheckTokenProvider_.getToken(x)]);h?zt("getToken() completed but was canceled"):(zt("getToken() completed. Creating connection."),this.authToken_=b&&b.accessToken,this.appCheckToken_=w&&w.token,f=new mN(c,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,i,C=>{Zt(C+" ("+this.repoInfo_.toString()+")"),this.interrupt(_N)},d))}catch(b){this.log_("Failed to get token: "+b),h||(this.repoInfo_.nodeAdmin&&Zt(b),m())}}}interrupt(t){zt("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){zt("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Bm(this.interruptReasons_)&&(this.reconnectDelay_=wl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const n=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const n=this.outstandingPuts_[t];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,n){let i;n?i=n.map(d=>uh(d)).join("$"):i="default";const c=this.removeListen_(t,i);c&&c.onComplete&&c.onComplete("permission_denied")}removeListen_(t,n){const i=new at(t).toString();let c;if(this.listens.has(i)){const d=this.listens.get(i);c=d.get(n),d.delete(n),d.size===0&&this.listens.delete(i)}else c=void 0;return c}onAuthRevoked_(t,n){zt("Auth token revoked: "+t+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=mp&&(this.reconnectDelay_=fp,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,n){zt("App check token revoked: "+t+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=mp&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let n="js";t["sdk."+n+"."+jy.replace(/\./g,"-")]=1,oy()?t["framework.cordova"]=1:lk()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Mo.getInstance().currentlyOnline();return Bm(this.interruptReasons_)&&t}}rn.nextPersistentConnectionId_=0;rn.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(t,n){this.name=t,this.node=n}static Wrap(t,n){return new Be(t,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,n){const i=new Be(fr,t),c=new Be(fr,n);return this.compare(i,c)!==0}minPost(){return Be.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bo;class Jy extends Xo{static get __EMPTY_NODE(){return bo}static set __EMPTY_NODE(t){bo=t}compare(t,n){return yr(t.name,n.name)}isDefinedOn(t){throw Pl("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,n){return!1}minPost(){return Be.MIN}maxPost(){return new Be(ma,bo)}makePost(t,n){return de(typeof t=="string","KeyIndex indexValue must always be a string."),new Be(t,bo)}toString(){return".key"}}const ur=new Jy;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(t,n,i,c,d=null){this.isReverse_=c,this.resultGenerator_=d,this.nodeStack_=[];let h=1;for(;!t.isEmpty();)if(t=t,h=n?i(t.key,n):1,c&&(h*=-1),h<0)this.isReverse_?t=t.left:t=t.right;else if(h===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(t.key,t.value):n={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class Ot{constructor(t,n,i,c,d){this.key=t,this.value=n,this.color=i??Ot.RED,this.left=c??Kt.EMPTY_NODE,this.right=d??Kt.EMPTY_NODE}copy(t,n,i,c,d){return new Ot(t??this.key,n??this.value,i??this.color,c??this.left,d??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,i){let c=this;const d=i(t,c.key);return d<0?c=c.copy(null,null,null,c.left.insert(t,n,i),null):d===0?c=c.copy(null,n,null,null,null):c=c.copy(null,null,null,null,c.right.insert(t,n,i)),c.fixUp_()}removeMin_(){if(this.left.isEmpty())return Kt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,n){let i,c;if(i=this,n(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(t,i.key)===0){if(i.right.isEmpty())return Kt.EMPTY_NODE;c=i.right.min_(),i=i.copy(c.key,c.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,Ot.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,Ot.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}Ot.RED=!0;Ot.BLACK=!1;class NN{copy(t,n,i,c,d){return this}insert(t,n,i){return new Ot(t,n,null)}remove(t,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Kt{constructor(t,n=Kt.EMPTY_NODE){this.comparator_=t,this.root_=n}insert(t,n){return new Kt(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Ot.BLACK,null,null))}remove(t){return new Kt(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ot.BLACK,null,null))}get(t){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(t,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(t){let n,i=this.root_,c=null;for(;!i.isEmpty();)if(n=this.comparator_(t,i.key),n===0){if(i.left.isEmpty())return c?c.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(c=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new vo(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,n){return new vo(this.root_,t,this.comparator_,!1,n)}getReverseIteratorFrom(t,n){return new vo(this.root_,t,this.comparator_,!0,n)}getReverseIterator(t){return new vo(this.root_,null,this.comparator_,!0,t)}}Kt.EMPTY_NODE=new NN;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(l,t){return yr(l.name,t.name)}function yh(l,t){return yr(l,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gu;function TN(l){Gu=l}const ex=function(l){return typeof l=="number"?"number:"+Cy(l):"string:"+l},tx=function(l){if(l.isLeafNode()){const t=l.val();de(typeof t=="string"||typeof t=="number"||typeof t=="object"&&on(t,".sv"),"Priority must be a string or number.")}else de(l===Gu||l.isEmpty(),"priority of unexpected type.");de(l===Gu||l.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pp;class At{static set __childrenNodeConstructor(t){pp=t}static get __childrenNodeConstructor(){return pp}constructor(t,n=At.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,de(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),tx(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new At(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:At.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Ye(t)?this:ze(t)===".priority"?this.priorityNode_:At.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,n){return null}updateImmediateChild(t,n){return t===".priority"?this.updatePriority(n):n.isEmpty()&&t!==".priority"?this:At.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){const i=ze(t);return i===null?n:n.isEmpty()&&i!==".priority"?this:(de(i!==".priority"||zn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,At.__childrenNodeConstructor.EMPTY_NODE.updateChild(it(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,n){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+ex(this.priorityNode_.val())+":");const n=typeof this.value_;t+=n+":",n==="number"?t+=Cy(this.value_):t+=this.value_,this.lazyHash_=Sy(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===At.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof At.__childrenNodeConstructor?-1:(de(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,i=typeof this.value_,c=At.VALUE_TYPE_ORDER.indexOf(n),d=At.VALUE_TYPE_ORDER.indexOf(i);return de(c>=0,"Unknown leaf type: "+n),de(d>=0,"Unknown leaf type: "+i),c===d?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:d-c}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const n=t;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}At.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sx,nx;function SN(l){sx=l}function DN(l){nx=l}class EN extends Xo{compare(t,n){const i=t.node.getPriority(),c=n.node.getPriority(),d=i.compareTo(c);return d===0?yr(t.name,n.name):d}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,n){return!t.getPriority().equals(n.getPriority())}minPost(){return Be.MIN}maxPost(){return new Be(ma,new At("[PRIORITY-POST]",nx))}makePost(t,n){const i=sx(t);return new Be(n,new At("[PRIORITY-POST]",i))}toString(){return".priority"}}const mt=new EN;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CN=Math.log(2);class AN{constructor(t){const n=d=>parseInt(Math.log(d)/CN,10),i=d=>parseInt(Array(d+1).join("1"),2);this.count=n(t+1),this.current_=this.count-1;const c=i(this.count);this.bits_=t+1&c}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Io=function(l,t,n,i){l.sort(t);const c=function(m,p){const x=p-m;let b,w;if(x===0)return null;if(x===1)return b=l[m],w=n?n(b):b,new Ot(w,b.node,Ot.BLACK,null,null);{const C=parseInt(x/2,10)+m,T=c(m,C),z=c(C+1,p);return b=l[C],w=n?n(b):b,new Ot(w,b.node,Ot.BLACK,T,z)}},d=function(m){let p=null,x=null,b=l.length;const w=function(T,z){const W=b-T,k=b;b-=T;const R=c(W+1,k),D=l[W],E=n?n(D):D;C(new Ot(E,D.node,z,null,R))},C=function(T){p?(p.left=T,p=T):(x=T,p=T)};for(let T=0;T<m.count;++T){const z=m.nextBitIsOne(),W=Math.pow(2,m.count-(T+1));z?w(W,Ot.BLACK):(w(W,Ot.BLACK),w(W,Ot.RED))}return x},h=new AN(l.length),f=d(h);return new Kt(i||t,f)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cu;const lr={};class an{static get Default(){return de(lr&&mt,"ChildrenNode.ts has not been loaded"),Cu=Cu||new an({".priority":lr},{".priority":mt}),Cu}constructor(t,n){this.indexes_=t,this.indexSet_=n}get(t){const n=hr(this.indexes_,t);if(!n)throw new Error("No index defined for "+t);return n instanceof Kt?n:null}hasIndex(t){return on(this.indexSet_,t.toString())}addIndex(t,n){de(t!==ur,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let c=!1;const d=n.getIterator(Be.Wrap);let h=d.getNext();for(;h;)c=c||t.isDefinedOn(h.node),i.push(h),h=d.getNext();let f;c?f=Io(i,t.getCompare()):f=lr;const m=t.toString(),p={...this.indexSet_};p[m]=t;const x={...this.indexes_};return x[m]=f,new an(x,p)}addToIndexes(t,n){const i=Eo(this.indexes_,(c,d)=>{const h=hr(this.indexSet_,d);if(de(h,"Missing index implementation for "+d),c===lr)if(h.isDefinedOn(t.node)){const f=[],m=n.getIterator(Be.Wrap);let p=m.getNext();for(;p;)p.name!==t.name&&f.push(p),p=m.getNext();return f.push(t),Io(f,h.getCompare())}else return lr;else{const f=n.get(t.name);let m=c;return f&&(m=m.remove(new Be(t.name,f))),m.insert(t,t.node)}});return new an(i,this.indexSet_)}removeFromIndexes(t,n){const i=Eo(this.indexes_,c=>{if(c===lr)return c;{const d=n.get(t.name);return d?c.remove(new Be(t.name,d)):c}});return new an(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kl;class Ae{static get EMPTY_NODE(){return kl||(kl=new Ae(new Kt(yh),null,an.Default))}constructor(t,n,i){this.children_=t,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&tx(this.priorityNode_),this.children_.isEmpty()&&de(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||kl}updatePriority(t){return this.children_.isEmpty()?this:new Ae(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{const n=this.children_.get(t);return n===null?kl:n}}getChild(t){const n=ze(t);return n===null?this:this.getImmediateChild(n).getChild(it(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,n){if(de(n,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(n);{const i=new Be(t,n);let c,d;n.isEmpty()?(c=this.children_.remove(t),d=this.indexMap_.removeFromIndexes(i,this.children_)):(c=this.children_.insert(t,n),d=this.indexMap_.addToIndexes(i,this.children_));const h=c.isEmpty()?kl:this.priorityNode_;return new Ae(c,h,d)}}updateChild(t,n){const i=ze(t);if(i===null)return n;{de(ze(t)!==".priority"||zn(t)===1,".priority must be the last token in a path");const c=this.getImmediateChild(i).updateChild(it(t),n);return this.updateImmediateChild(i,c)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const n={};let i=0,c=0,d=!0;if(this.forEachChild(mt,(h,f)=>{n[h]=f.val(t),i++,d&&Ae.INTEGER_REGEXP_.test(h)?c=Math.max(c,Number(h)):d=!1}),!t&&d&&c<2*i){const h=[];for(const f in n)h[f]=n[f];return h}else return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+ex(this.getPriority().val())+":"),this.forEachChild(mt,(n,i)=>{const c=i.hash();c!==""&&(t+=":"+n+":"+c)}),this.lazyHash_=t===""?"":Sy(t)}return this.lazyHash_}getPredecessorChildName(t,n,i){const c=this.resolveIndex_(i);if(c){const d=c.getPredecessorKey(new Be(t,n));return d?d.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){const n=this.resolveIndex_(t);if(n){const i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){const n=this.getFirstChildName(t);return n?new Be(n,this.children_.get(n)):null}getLastChildName(t){const n=this.resolveIndex_(t);if(n){const i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){const n=this.getLastChildName(t);return n?new Be(n,this.children_.get(n)):null}forEachChild(t,n){const i=this.resolveIndex_(t);return i?i.inorderTraversal(c=>n(c.name,c.node)):this.children_.inorderTraversal(n)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,n){const i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(t,c=>c);{const c=this.children_.getIteratorFrom(t.name,Be.Wrap);let d=c.peek();for(;d!=null&&n.compare(d,t)<0;)c.getNext(),d=c.peek();return c}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,n){const i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(t,c=>c);{const c=this.children_.getReverseIteratorFrom(t.name,Be.Wrap);let d=c.peek();for(;d!=null&&n.compare(d,t)>0;)c.getNext(),d=c.peek();return c}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Zl?-1:0}withIndex(t){if(t===ur||this.indexMap_.hasIndex(t))return this;{const n=this.indexMap_.addIndex(t,this.children_);return new Ae(this.children_,this.priorityNode_,n)}}isIndexed(t){return t===ur||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const n=t;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const i=this.getIterator(mt),c=n.getIterator(mt);let d=i.getNext(),h=c.getNext();for(;d&&h;){if(d.name!==h.name||!d.node.equals(h.node))return!1;d=i.getNext(),h=c.getNext()}return d===null&&h===null}else return!1;else return!1}}resolveIndex_(t){return t===ur?null:this.indexMap_.get(t.toString())}}Ae.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class RN extends Ae{constructor(){super(new Kt(yh),Ae.EMPTY_NODE,an.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Ae.EMPTY_NODE}isEmpty(){return!1}}const Zl=new RN;Object.defineProperties(Be,{MIN:{value:new Be(fr,Ae.EMPTY_NODE)},MAX:{value:new Be(ma,Zl)}});Jy.__EMPTY_NODE=Ae.EMPTY_NODE;At.__childrenNodeConstructor=Ae;TN(Zl);DN(Zl);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ON=!0;function Mt(l,t=null){if(l===null)return Ae.EMPTY_NODE;if(typeof l=="object"&&".priority"in l&&(t=l[".priority"]),de(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof l=="object"&&".value"in l&&l[".value"]!==null&&(l=l[".value"]),typeof l!="object"||".sv"in l){const n=l;return new At(n,Mt(t))}if(!(l instanceof Array)&&ON){const n=[];let i=!1;if(Jt(l,(h,f)=>{if(h.substring(0,1)!=="."){const m=Mt(f);m.isEmpty()||(i=i||!m.getPriority().isEmpty(),n.push(new Be(h,m)))}}),n.length===0)return Ae.EMPTY_NODE;const d=Io(n,jN,h=>h.name,yh);if(i){const h=Io(n,mt.getCompare());return new Ae(d,Mt(t),new an({".priority":h},{".priority":mt}))}else return new Ae(d,Mt(t),an.Default)}else{let n=Ae.EMPTY_NODE;return Jt(l,(i,c)=>{if(on(l,i)&&i.substring(0,1)!=="."){const d=Mt(c);(d.isLeafNode()||!d.isEmpty())&&(n=n.updateImmediateChild(i,d))}}),n.updatePriority(Mt(t))}}SN(Mt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MN extends Xo{constructor(t){super(),this.indexPath_=t,de(!Ye(t)&&ze(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,n){const i=this.extractChild(t.node),c=this.extractChild(n.node),d=i.compareTo(c);return d===0?yr(t.name,n.name):d}makePost(t,n){const i=Mt(t),c=Ae.EMPTY_NODE.updateChild(this.indexPath_,i);return new Be(n,c)}maxPost(){const t=Ae.EMPTY_NODE.updateChild(this.indexPath_,Zl);return new Be(ma,t)}toString(){return Xy(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN extends Xo{compare(t,n){const i=t.node.compareTo(n.node);return i===0?yr(t.name,n.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,n){return!t.equals(n)}minPost(){return Be.MIN}maxPost(){return Be.MAX}makePost(t,n){const i=Mt(t);return new Be(n,i)}toString(){return".value"}}const UN=new IN;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ax(l){return{type:"value",snapshotNode:l}}function mr(l,t){return{type:"child_added",snapshotNode:t,childName:l}}function Ul(l,t){return{type:"child_removed",snapshotNode:t,childName:l}}function Ll(l,t,n){return{type:"child_changed",snapshotNode:t,childName:l,oldSnap:n}}function LN(l,t){return{type:"child_moved",snapshotNode:t,childName:l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(t){this.index_=t}updateChild(t,n,i,c,d,h){de(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const f=t.getImmediateChild(n);return f.getChild(c).equals(i.getChild(c))&&f.isEmpty()===i.isEmpty()||(h!=null&&(i.isEmpty()?t.hasChild(n)?h.trackChildChange(Ul(n,f)):de(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):f.isEmpty()?h.trackChildChange(mr(n,i)):h.trackChildChange(Ll(n,i,f))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(t,n,i){return i!=null&&(t.isLeafNode()||t.forEachChild(mt,(c,d)=>{n.hasChild(c)||i.trackChildChange(Ul(c,d))}),n.isLeafNode()||n.forEachChild(mt,(c,d)=>{if(t.hasChild(c)){const h=t.getImmediateChild(c);h.equals(d)||i.trackChildChange(Ll(c,d,h))}else i.trackChildChange(mr(c,d))})),n.withIndex(this.index_)}updatePriority(t,n){return t.isEmpty()?Ae.EMPTY_NODE:t.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(t){this.indexedFilter_=new xh(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Hl.getStartPost_(t),this.endPost_=Hl.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return n&&i}updateChild(t,n,i,c,d,h){return this.matches(new Be(n,i))||(i=Ae.EMPTY_NODE),this.indexedFilter_.updateChild(t,n,i,c,d,h)}updateFullNode(t,n,i){n.isLeafNode()&&(n=Ae.EMPTY_NODE);let c=n.withIndex(this.index_);c=c.updatePriority(Ae.EMPTY_NODE);const d=this;return n.forEachChild(mt,(h,f)=>{d.matches(new Be(h,f))||(c=c.updateImmediateChild(h,Ae.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,c,i)}updatePriority(t,n){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const n=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),n)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const n=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),n)}else return t.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(t){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{const i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Hl(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,n,i,c,d,h){return this.rangedFilter_.matches(new Be(n,i))||(i=Ae.EMPTY_NODE),t.getImmediateChild(n).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,n,i,c,d,h):this.fullLimitUpdateChild_(t,n,i,d,h)}updateFullNode(t,n,i){let c;if(n.isLeafNode()||n.isEmpty())c=Ae.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){c=Ae.EMPTY_NODE.withIndex(this.index_);let d;this.reverse_?d=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):d=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let h=0;for(;d.hasNext()&&h<this.limit_;){const f=d.getNext();if(this.withinDirectionalStart(f))if(this.withinDirectionalEnd(f))c=c.updateImmediateChild(f.name,f.node),h++;else break;else continue}}else{c=n.withIndex(this.index_),c=c.updatePriority(Ae.EMPTY_NODE);let d;this.reverse_?d=c.getReverseIterator(this.index_):d=c.getIterator(this.index_);let h=0;for(;d.hasNext();){const f=d.getNext();h<this.limit_&&this.withinDirectionalStart(f)&&this.withinDirectionalEnd(f)?h++:c=c.updateImmediateChild(f.name,Ae.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,c,i)}updatePriority(t,n){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,n,i,c,d){let h;if(this.reverse_){const b=this.index_.getCompare();h=(w,C)=>b(C,w)}else h=this.index_.getCompare();const f=t;de(f.numChildren()===this.limit_,"");const m=new Be(n,i),p=this.reverse_?f.getFirstChild(this.index_):f.getLastChild(this.index_),x=this.rangedFilter_.matches(m);if(f.hasChild(n)){const b=f.getImmediateChild(n);let w=c.getChildAfterChild(this.index_,p,this.reverse_);for(;w!=null&&(w.name===n||f.hasChild(w.name));)w=c.getChildAfterChild(this.index_,w,this.reverse_);const C=w==null?1:h(w,m);if(x&&!i.isEmpty()&&C>=0)return d?.trackChildChange(Ll(n,i,b)),f.updateImmediateChild(n,i);{d?.trackChildChange(Ul(n,b));const z=f.updateImmediateChild(n,Ae.EMPTY_NODE);return w!=null&&this.rangedFilter_.matches(w)?(d?.trackChildChange(mr(w.name,w.node)),z.updateImmediateChild(w.name,w.node)):z}}else return i.isEmpty()?t:x&&h(p,m)>=0?(d!=null&&(d.trackChildChange(Ul(p.name,p.node)),d.trackChildChange(mr(n,i))),f.updateImmediateChild(n,i).updateImmediateChild(p.name,Ae.EMPTY_NODE)):t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=mt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return de(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return de(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fr}hasEnd(){return this.endSet_}getIndexEndValue(){return de(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return de(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ma}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return de(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===mt}copy(){const t=new bh;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function $N(l){return l.loadsAllData()?new xh(l.getIndex()):l.hasLimit()?new HN(l):new Hl(l)}function yp(l){const t={};if(l.isDefault())return t;let n;if(l.index_===mt?n="$priority":l.index_===UN?n="$value":l.index_===ur?n="$key":(de(l.index_ instanceof MN,"Unrecognized index type!"),n=l.index_.toString()),t.orderBy=jt(n),l.startSet_){const i=l.startAfterSet_?"startAfter":"startAt";t[i]=jt(l.indexStartValue_),l.startNameSet_&&(t[i]+=","+jt(l.indexStartName_))}if(l.endSet_){const i=l.endBeforeSet_?"endBefore":"endAt";t[i]=jt(l.indexEndValue_),l.endNameSet_&&(t[i]+=","+jt(l.indexEndName_))}return l.limitSet_&&(l.isViewFromLeft()?t.limitToFirst=l.limit_:t.limitToLast=l.limit_),t}function xp(l){const t={};if(l.startSet_&&(t.sp=l.indexStartValue_,l.startNameSet_&&(t.sn=l.indexStartName_),t.sin=!l.startAfterSet_),l.endSet_&&(t.ep=l.indexEndValue_,l.endNameSet_&&(t.en=l.indexEndName_),t.ein=!l.endBeforeSet_),l.limitSet_){t.l=l.limit_;let n=l.viewFrom_;n===""&&(l.isViewFromLeft()?n="l":n="r"),t.vf=n}return l.index_!==mt&&(t.i=l.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo extends Py{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,n){return n!==void 0?"tag$"+n:(de(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,n,i,c){super(),this.repoInfo_=t,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=c,this.log_=Kl("p:rest:"),this.listens_={}}listen(t,n,i,c){const d=t._path.toString();this.log_("Listen called for "+d+" "+t._queryIdentifier);const h=Uo.getListenId_(t,i),f={};this.listens_[h]=f;const m=yp(t._queryParams);this.restRequest_(d+".json",m,(p,x)=>{let b=x;if(p===404&&(b=null,p=null),p===null&&this.onDataUpdate_(d,b,!1,i),hr(this.listens_,h)===f){let w;p?p===401?w="permission_denied":w="rest_error:"+p:w="ok",c(w,null)}})}unlisten(t,n){const i=Uo.getListenId_(t,n);delete this.listens_[i]}get(t){const n=yp(t._queryParams),i=t._path.toString(),c=new oh;return this.restRequest_(i+".json",n,(d,h)=>{let f=h;d===404&&(f=null,d=null),d===null?(this.onDataUpdate_(i,f,!1,null),c.resolve(f)):c.reject(new Error(f))}),c.promise}refreshAuthToken(t){}restRequest_(t,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([c,d])=>{c&&c.accessToken&&(n.auth=c.accessToken),d&&d.token&&(n.ac=d.token);const h=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+nk(n);this.log_("Sending REST request for "+h);const f=new XMLHttpRequest;f.onreadystatechange=()=>{if(i&&f.readyState===4){this.log_("REST Response for "+h+" received. status:",f.status,"response:",f.responseText);let m=null;if(f.status>=200&&f.status<300){try{m=lh(f.responseText)}catch{Zt("Failed to parse JSON response for "+h+": "+f.responseText)}i(null,m)}else f.status!==401&&f.status!==404&&Zt("Got unsuccessful REST response for "+h+" Status: "+f.status),i(f.status);i=null}},f.open("GET",h,!0),f.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(){this.rootNode_=Ae.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,n){this.rootNode_=this.rootNode_.updateChild(t,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lo(){return{value:null,children:new Map}}function rx(l,t,n){if(Ye(t))l.value=n,l.children.clear();else if(l.value!==null)l.value=l.value.updateChild(t,n);else{const i=ze(t);l.children.has(i)||l.children.set(i,Lo());const c=l.children.get(i);t=it(t),rx(c,t,n)}}function Pu(l,t,n){l.value!==null?n(t,l.value):BN(l,(i,c)=>{const d=new at(t.toString()+"/"+i);Pu(c,d,n)})}function BN(l,t){l.children.forEach((n,i)=>{t(i,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FN{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),n={...t};return this.last_&&Jt(this.last_,(i,c)=>{n[i]=n[i]-c}),this.last_=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bp=10*1e3,VN=30*1e3,YN=300*1e3;class qN{constructor(t,n){this.server_=n,this.statsToReport_={},this.statsListener_=new FN(t);const i=bp+(VN-bp)*Math.random();Cl(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const t=this.statsListener_.get(),n={};let i=!1;Jt(t,(c,d)=>{d>0&&on(this.statsToReport_,c)&&(n[c]=d,i=!0)}),i&&this.server_.reportStats(n),Cl(this.reportStats_.bind(this),Math.floor(Math.random()*2*YN))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ds;(function(l){l[l.OVERWRITE=0]="OVERWRITE",l[l.MERGE=1]="MERGE",l[l.ACK_USER_WRITE=2]="ACK_USER_WRITE",l[l.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Ds||(Ds={}));function lx(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function vh(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function wh(l){return{fromUser:!1,fromServer:!0,queryId:l,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(t,n,i){this.path=t,this.affectedTree=n,this.revert=i,this.type=Ds.ACK_USER_WRITE,this.source=lx()}operationForChild(t){if(Ye(this.path)){if(this.affectedTree.value!=null)return de(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new at(t));return new Ho(Pe(),n,this.revert)}}else return de(ze(this.path)===t,"operationForChild called for unrelated child."),new Ho(it(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(t,n){this.source=t,this.path=n,this.type=Ds.LISTEN_COMPLETE}operationForChild(t){return Ye(this.path)?new $l(this.source,Pe()):new $l(this.source,it(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(t,n,i){this.source=t,this.path=n,this.snap=i,this.type=Ds.OVERWRITE}operationForChild(t){return Ye(this.path)?new pa(this.source,Pe(),this.snap.getImmediateChild(t)):new pa(this.source,it(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zl{constructor(t,n,i){this.source=t,this.path=n,this.children=i,this.type=Ds.MERGE}operationForChild(t){if(Ye(this.path)){const n=this.children.subtree(new at(t));return n.isEmpty()?null:n.value?new pa(this.source,Pe(),n.value):new zl(this.source,Pe(),n)}else return de(ze(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new zl(this.source,it(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(t,n,i){this.node_=t,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(Ye(t))return this.isFullyInitialized()&&!this.filtered_;const n=ze(t);return this.isCompleteForChild(n)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function PN(l,t,n,i){const c=[],d=[];return t.forEach(h=>{h.type==="child_changed"&&l.index_.indexedValueChanged(h.oldSnap,h.snapshotNode)&&d.push(LN(h.childName,h.snapshotNode))}),_l(l,c,"child_removed",t,i,n),_l(l,c,"child_added",t,i,n),_l(l,c,"child_moved",d,i,n),_l(l,c,"child_changed",t,i,n),_l(l,c,"value",t,i,n),c}function _l(l,t,n,i,c,d){const h=i.filter(f=>f.type===n);h.sort((f,m)=>QN(l,f,m)),h.forEach(f=>{const m=WN(l,f,d);c.forEach(p=>{p.respondsTo(f.type)&&t.push(p.createEvent(m,l.query_))})})}function WN(l,t,n){return t.type==="value"||t.type==="child_removed"||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,l.index_)),t}function QN(l,t,n){if(t.childName==null||n.childName==null)throw Pl("Should only compare child_ events.");const i=new Be(t.childName,t.snapshotNode),c=new Be(n.childName,n.snapshotNode);return l.index_.compare(i,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(l,t){return{eventCache:l,serverCache:t}}function Al(l,t,n,i){return Ko(new Bn(t,n,i),l.serverCache)}function ix(l,t,n,i){return Ko(l.eventCache,new Bn(t,n,i))}function $o(l){return l.eventCache.isFullyInitialized()?l.eventCache.getNode():null}function ya(l){return l.serverCache.isFullyInitialized()?l.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Au;const XN=()=>(Au||(Au=new Kt(I_)),Au);class ot{static fromObject(t){let n=new ot(null);return Jt(t,(i,c)=>{n=n.set(new at(i),c)}),n}constructor(t,n=XN()){this.value=t,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,n){if(this.value!=null&&n(this.value))return{path:Pe(),value:this.value};if(Ye(t))return null;{const i=ze(t),c=this.children.get(i);if(c!==null){const d=c.findRootMostMatchingPathAndValue(it(t),n);return d!=null?{path:Tt(new at(i),d.path),value:d.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(Ye(t))return this;{const n=ze(t),i=this.children.get(n);return i!==null?i.subtree(it(t)):new ot(null)}}set(t,n){if(Ye(t))return new ot(n,this.children);{const i=ze(t),d=(this.children.get(i)||new ot(null)).set(it(t),n),h=this.children.insert(i,d);return new ot(this.value,h)}}remove(t){if(Ye(t))return this.children.isEmpty()?new ot(null):new ot(null,this.children);{const n=ze(t),i=this.children.get(n);if(i){const c=i.remove(it(t));let d;return c.isEmpty()?d=this.children.remove(n):d=this.children.insert(n,c),this.value===null&&d.isEmpty()?new ot(null):new ot(this.value,d)}else return this}}get(t){if(Ye(t))return this.value;{const n=ze(t),i=this.children.get(n);return i?i.get(it(t)):null}}setTree(t,n){if(Ye(t))return n;{const i=ze(t),d=(this.children.get(i)||new ot(null)).setTree(it(t),n);let h;return d.isEmpty()?h=this.children.remove(i):h=this.children.insert(i,d),new ot(this.value,h)}}fold(t){return this.fold_(Pe(),t)}fold_(t,n){const i={};return this.children.inorderTraversal((c,d)=>{i[c]=d.fold_(Tt(t,c),n)}),n(t,this.value,i)}findOnPath(t,n){return this.findOnPath_(t,Pe(),n)}findOnPath_(t,n,i){const c=this.value?i(n,this.value):!1;if(c)return c;if(Ye(t))return null;{const d=ze(t),h=this.children.get(d);return h?h.findOnPath_(it(t),Tt(n,d),i):null}}foreachOnPath(t,n){return this.foreachOnPath_(t,Pe(),n)}foreachOnPath_(t,n,i){if(Ye(t))return this;{this.value&&i(n,this.value);const c=ze(t),d=this.children.get(c);return d?d.foreachOnPath_(it(t),Tt(n,c),i):new ot(null)}}foreach(t){this.foreach_(Pe(),t)}foreach_(t,n){this.children.inorderTraversal((i,c)=>{c.foreach_(Tt(t,i),n)}),this.value&&n(t,this.value)}foreachChild(t){this.children.inorderTraversal((n,i)=>{i.value&&t(n,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(t){this.writeTree_=t}static empty(){return new Es(new ot(null))}}function Rl(l,t,n){if(Ye(t))return new Es(new ot(n));{const i=l.writeTree_.findRootMostValueAndPath(t);if(i!=null){const c=i.path;let d=i.value;const h=Yt(c,t);return d=d.updateChild(h,n),new Es(l.writeTree_.set(c,d))}else{const c=new ot(n),d=l.writeTree_.setTree(t,c);return new Es(d)}}}function vp(l,t,n){let i=l;return Jt(n,(c,d)=>{i=Rl(i,Tt(t,c),d)}),i}function wp(l,t){if(Ye(t))return Es.empty();{const n=l.writeTree_.setTree(t,new ot(null));return new Es(n)}}function Wu(l,t){return ba(l,t)!=null}function ba(l,t){const n=l.writeTree_.findRootMostValueAndPath(t);return n!=null?l.writeTree_.get(n.path).getChild(Yt(n.path,t)):null}function kp(l){const t=[],n=l.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(mt,(i,c)=>{t.push(new Be(i,c))}):l.writeTree_.children.inorderTraversal((i,c)=>{c.value!=null&&t.push(new Be(i,c.value))}),t}function Hn(l,t){if(Ye(t))return l;{const n=ba(l,t);return n!=null?new Es(new ot(n)):new Es(l.writeTree_.subtree(t))}}function Qu(l){return l.writeTree_.isEmpty()}function pr(l,t){return ox(Pe(),l.writeTree_,t)}function ox(l,t,n){if(t.value!=null)return n.updateChild(l,t.value);{let i=null;return t.children.inorderTraversal((c,d)=>{c===".priority"?(de(d.value!==null,"Priority writes must always be leaf nodes"),i=d.value):n=ox(Tt(l,c),d,n)}),!n.getChild(l).isEmpty()&&i!==null&&(n=n.updateChild(Tt(l,".priority"),i)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(l,t){return hx(t,l)}function KN(l,t,n,i,c){de(i>l.lastWriteId,"Stacking an older write on top of newer ones"),c===void 0&&(c=!0),l.allWrites.push({path:t,snap:n,writeId:i,visible:c}),c&&(l.visibleWrites=Rl(l.visibleWrites,t,n)),l.lastWriteId=i}function ZN(l,t){for(let n=0;n<l.allWrites.length;n++){const i=l.allWrites[n];if(i.writeId===t)return i}return null}function JN(l,t){const n=l.allWrites.findIndex(f=>f.writeId===t);de(n>=0,"removeWrite called with nonexistent writeId.");const i=l.allWrites[n];l.allWrites.splice(n,1);let c=i.visible,d=!1,h=l.allWrites.length-1;for(;c&&h>=0;){const f=l.allWrites[h];f.visible&&(h>=n&&ej(f,i.path)?c=!1:Ss(i.path,f.path)&&(d=!0)),h--}if(c){if(d)return tj(l),!0;if(i.snap)l.visibleWrites=wp(l.visibleWrites,i.path);else{const f=i.children;Jt(f,m=>{l.visibleWrites=wp(l.visibleWrites,Tt(i.path,m))})}return!0}else return!1}function ej(l,t){if(l.snap)return Ss(l.path,t);for(const n in l.children)if(l.children.hasOwnProperty(n)&&Ss(Tt(l.path,n),t))return!0;return!1}function tj(l){l.visibleWrites=cx(l.allWrites,sj,Pe()),l.allWrites.length>0?l.lastWriteId=l.allWrites[l.allWrites.length-1].writeId:l.lastWriteId=-1}function sj(l){return l.visible}function cx(l,t,n){let i=Es.empty();for(let c=0;c<l.length;++c){const d=l[c];if(t(d)){const h=d.path;let f;if(d.snap)Ss(n,h)?(f=Yt(n,h),i=Rl(i,f,d.snap)):Ss(h,n)&&(f=Yt(h,n),i=Rl(i,Pe(),d.snap.getChild(f)));else if(d.children){if(Ss(n,h))f=Yt(n,h),i=vp(i,f,d.children);else if(Ss(h,n))if(f=Yt(h,n),Ye(f))i=vp(i,Pe(),d.children);else{const m=hr(d.children,ze(f));if(m){const p=m.getChild(it(f));i=Rl(i,Pe(),p)}}}else throw Pl("WriteRecord should have .snap or .children")}}return i}function dx(l,t,n,i,c){if(!i&&!c){const d=ba(l.visibleWrites,t);if(d!=null)return d;{const h=Hn(l.visibleWrites,t);if(Qu(h))return n;if(n==null&&!Wu(h,Pe()))return null;{const f=n||Ae.EMPTY_NODE;return pr(h,f)}}}else{const d=Hn(l.visibleWrites,t);if(!c&&Qu(d))return n;if(!c&&n==null&&!Wu(d,Pe()))return null;{const h=function(p){return(p.visible||c)&&(!i||!~i.indexOf(p.writeId))&&(Ss(p.path,t)||Ss(t,p.path))},f=cx(l.allWrites,h,t),m=n||Ae.EMPTY_NODE;return pr(f,m)}}}function nj(l,t,n){let i=Ae.EMPTY_NODE;const c=ba(l.visibleWrites,t);if(c)return c.isLeafNode()||c.forEachChild(mt,(d,h)=>{i=i.updateImmediateChild(d,h)}),i;if(n){const d=Hn(l.visibleWrites,t);return n.forEachChild(mt,(h,f)=>{const m=pr(Hn(d,new at(h)),f);i=i.updateImmediateChild(h,m)}),kp(d).forEach(h=>{i=i.updateImmediateChild(h.name,h.node)}),i}else{const d=Hn(l.visibleWrites,t);return kp(d).forEach(h=>{i=i.updateImmediateChild(h.name,h.node)}),i}}function aj(l,t,n,i,c){de(i||c,"Either existingEventSnap or existingServerSnap must exist");const d=Tt(t,n);if(Wu(l.visibleWrites,d))return null;{const h=Hn(l.visibleWrites,d);return Qu(h)?c.getChild(n):pr(h,c.getChild(n))}}function rj(l,t,n,i){const c=Tt(t,n),d=ba(l.visibleWrites,c);if(d!=null)return d;if(i.isCompleteForChild(n)){const h=Hn(l.visibleWrites,c);return pr(h,i.getNode().getImmediateChild(n))}else return null}function lj(l,t){return ba(l.visibleWrites,t)}function ij(l,t,n,i,c,d,h){let f;const m=Hn(l.visibleWrites,t),p=ba(m,Pe());if(p!=null)f=p;else if(n!=null)f=pr(m,n);else return[];if(f=f.withIndex(h),!f.isEmpty()&&!f.isLeafNode()){const x=[],b=h.getCompare(),w=d?f.getReverseIteratorFrom(i,h):f.getIteratorFrom(i,h);let C=w.getNext();for(;C&&x.length<c;)b(C,i)!==0&&x.push(C),C=w.getNext();return x}else return[]}function oj(){return{visibleWrites:Es.empty(),allWrites:[],lastWriteId:-1}}function zo(l,t,n,i){return dx(l.writeTree,l.treePath,t,n,i)}function kh(l,t){return nj(l.writeTree,l.treePath,t)}function _p(l,t,n,i){return aj(l.writeTree,l.treePath,t,n,i)}function Bo(l,t){return lj(l.writeTree,Tt(l.treePath,t))}function cj(l,t,n,i,c,d){return ij(l.writeTree,l.treePath,t,n,i,c,d)}function _h(l,t,n){return rj(l.writeTree,l.treePath,t,n)}function ux(l,t){return hx(Tt(l.treePath,t),l.writeTree)}function hx(l,t){return{treePath:l,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dj{constructor(){this.changeMap=new Map}trackChildChange(t){const n=t.type,i=t.childName;de(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),de(i!==".priority","Only non-priority child changes can be tracked.");const c=this.changeMap.get(i);if(c){const d=c.type;if(n==="child_added"&&d==="child_removed")this.changeMap.set(i,Ll(i,t.snapshotNode,c.snapshotNode));else if(n==="child_removed"&&d==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&d==="child_changed")this.changeMap.set(i,Ul(i,c.oldSnap));else if(n==="child_changed"&&d==="child_added")this.changeMap.set(i,mr(i,t.snapshotNode));else if(n==="child_changed"&&d==="child_changed")this.changeMap.set(i,Ll(i,t.snapshotNode,c.oldSnap));else throw Pl("Illegal combination of changes: "+t+" occurred after "+c)}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{getCompleteChild(t){return null}getChildAfterChild(t,n,i){return null}}const gx=new uj;class Nh{constructor(t,n,i=null){this.writes_=t,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(t){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(t))return n.getNode().getImmediateChild(t);{const i=this.optCompleteServerCache_!=null?new Bn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _h(this.writes_,t,i)}}getChildAfterChild(t,n,i){const c=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ya(this.viewCache_),d=cj(this.writes_,c,n,1,i,t);return d.length===0?null:d[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hj(l){return{filter:l}}function gj(l,t){de(t.eventCache.getNode().isIndexed(l.filter.getIndex()),"Event snap not indexed"),de(t.serverCache.getNode().isIndexed(l.filter.getIndex()),"Server snap not indexed")}function fj(l,t,n,i,c){const d=new dj;let h,f;if(n.type===Ds.OVERWRITE){const p=n;p.source.fromUser?h=Xu(l,t,p.path,p.snap,i,c,d):(de(p.source.fromServer,"Unknown source."),f=p.source.tagged||t.serverCache.isFiltered()&&!Ye(p.path),h=Fo(l,t,p.path,p.snap,i,c,f,d))}else if(n.type===Ds.MERGE){const p=n;p.source.fromUser?h=pj(l,t,p.path,p.children,i,c,d):(de(p.source.fromServer,"Unknown source."),f=p.source.tagged||t.serverCache.isFiltered(),h=Ku(l,t,p.path,p.children,i,c,f,d))}else if(n.type===Ds.ACK_USER_WRITE){const p=n;p.revert?h=bj(l,t,p.path,i,c,d):h=yj(l,t,p.path,p.affectedTree,i,c,d)}else if(n.type===Ds.LISTEN_COMPLETE)h=xj(l,t,n.path,i,d);else throw Pl("Unknown operation type: "+n.type);const m=d.getChanges();return mj(t,h,m),{viewCache:h,changes:m}}function mj(l,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const c=i.getNode().isLeafNode()||i.getNode().isEmpty(),d=$o(l);(n.length>0||!l.eventCache.isFullyInitialized()||c&&!i.getNode().equals(d)||!i.getNode().getPriority().equals(d.getPriority()))&&n.push(ax($o(t)))}}function fx(l,t,n,i,c,d){const h=t.eventCache;if(Bo(i,n)!=null)return t;{let f,m;if(Ye(n))if(de(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const p=ya(t),x=p instanceof Ae?p:Ae.EMPTY_NODE,b=kh(i,x);f=l.filter.updateFullNode(t.eventCache.getNode(),b,d)}else{const p=zo(i,ya(t));f=l.filter.updateFullNode(t.eventCache.getNode(),p,d)}else{const p=ze(n);if(p===".priority"){de(zn(n)===1,"Can't have a priority with additional path components");const x=h.getNode();m=t.serverCache.getNode();const b=_p(i,n,x,m);b!=null?f=l.filter.updatePriority(x,b):f=h.getNode()}else{const x=it(n);let b;if(h.isCompleteForChild(p)){m=t.serverCache.getNode();const w=_p(i,n,h.getNode(),m);w!=null?b=h.getNode().getImmediateChild(p).updateChild(x,w):b=h.getNode().getImmediateChild(p)}else b=_h(i,p,t.serverCache);b!=null?f=l.filter.updateChild(h.getNode(),p,b,x,c,d):f=h.getNode()}}return Al(t,f,h.isFullyInitialized()||Ye(n),l.filter.filtersNodes())}}function Fo(l,t,n,i,c,d,h,f){const m=t.serverCache;let p;const x=h?l.filter:l.filter.getIndexedFilter();if(Ye(n))p=x.updateFullNode(m.getNode(),i,null);else if(x.filtersNodes()&&!m.isFiltered()){const C=m.getNode().updateChild(n,i);p=x.updateFullNode(m.getNode(),C,null)}else{const C=ze(n);if(!m.isCompleteForPath(n)&&zn(n)>1)return t;const T=it(n),W=m.getNode().getImmediateChild(C).updateChild(T,i);C===".priority"?p=x.updatePriority(m.getNode(),W):p=x.updateChild(m.getNode(),C,W,T,gx,null)}const b=ix(t,p,m.isFullyInitialized()||Ye(n),x.filtersNodes()),w=new Nh(c,b,d);return fx(l,b,n,c,w,f)}function Xu(l,t,n,i,c,d,h){const f=t.eventCache;let m,p;const x=new Nh(c,t,d);if(Ye(n))p=l.filter.updateFullNode(t.eventCache.getNode(),i,h),m=Al(t,p,!0,l.filter.filtersNodes());else{const b=ze(n);if(b===".priority")p=l.filter.updatePriority(t.eventCache.getNode(),i),m=Al(t,p,f.isFullyInitialized(),f.isFiltered());else{const w=it(n),C=f.getNode().getImmediateChild(b);let T;if(Ye(w))T=i;else{const z=x.getCompleteChild(b);z!=null?Qy(w)===".priority"&&z.getChild(Ky(w)).isEmpty()?T=z:T=z.updateChild(w,i):T=Ae.EMPTY_NODE}if(C.equals(T))m=t;else{const z=l.filter.updateChild(f.getNode(),b,T,w,x,h);m=Al(t,z,f.isFullyInitialized(),l.filter.filtersNodes())}}}return m}function Np(l,t){return l.eventCache.isCompleteForChild(t)}function pj(l,t,n,i,c,d,h){let f=t;return i.foreach((m,p)=>{const x=Tt(n,m);Np(t,ze(x))&&(f=Xu(l,f,x,p,c,d,h))}),i.foreach((m,p)=>{const x=Tt(n,m);Np(t,ze(x))||(f=Xu(l,f,x,p,c,d,h))}),f}function jp(l,t,n){return n.foreach((i,c)=>{t=t.updateChild(i,c)}),t}function Ku(l,t,n,i,c,d,h,f){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let m=t,p;Ye(n)?p=i:p=new ot(null).setTree(n,i);const x=t.serverCache.getNode();return p.children.inorderTraversal((b,w)=>{if(x.hasChild(b)){const C=t.serverCache.getNode().getImmediateChild(b),T=jp(l,C,w);m=Fo(l,m,new at(b),T,c,d,h,f)}}),p.children.inorderTraversal((b,w)=>{const C=!t.serverCache.isCompleteForChild(b)&&w.value===null;if(!x.hasChild(b)&&!C){const T=t.serverCache.getNode().getImmediateChild(b),z=jp(l,T,w);m=Fo(l,m,new at(b),z,c,d,h,f)}}),m}function yj(l,t,n,i,c,d,h){if(Bo(c,n)!=null)return t;const f=t.serverCache.isFiltered(),m=t.serverCache;if(i.value!=null){if(Ye(n)&&m.isFullyInitialized()||m.isCompleteForPath(n))return Fo(l,t,n,m.getNode().getChild(n),c,d,f,h);if(Ye(n)){let p=new ot(null);return m.getNode().forEachChild(ur,(x,b)=>{p=p.set(new at(x),b)}),Ku(l,t,n,p,c,d,f,h)}else return t}else{let p=new ot(null);return i.foreach((x,b)=>{const w=Tt(n,x);m.isCompleteForPath(w)&&(p=p.set(x,m.getNode().getChild(w)))}),Ku(l,t,n,p,c,d,f,h)}}function xj(l,t,n,i,c){const d=t.serverCache,h=ix(t,d.getNode(),d.isFullyInitialized()||Ye(n),d.isFiltered());return fx(l,h,n,i,gx,c)}function bj(l,t,n,i,c,d){let h;if(Bo(i,n)!=null)return t;{const f=new Nh(i,t,c),m=t.eventCache.getNode();let p;if(Ye(n)||ze(n)===".priority"){let x;if(t.serverCache.isFullyInitialized())x=zo(i,ya(t));else{const b=t.serverCache.getNode();de(b instanceof Ae,"serverChildren would be complete if leaf node"),x=kh(i,b)}x=x,p=l.filter.updateFullNode(m,x,d)}else{const x=ze(n);let b=_h(i,x,t.serverCache);b==null&&t.serverCache.isCompleteForChild(x)&&(b=m.getImmediateChild(x)),b!=null?p=l.filter.updateChild(m,x,b,it(n),f,d):t.eventCache.getNode().hasChild(x)?p=l.filter.updateChild(m,x,Ae.EMPTY_NODE,it(n),f,d):p=m,p.isEmpty()&&t.serverCache.isFullyInitialized()&&(h=zo(i,ya(t)),h.isLeafNode()&&(p=l.filter.updateFullNode(p,h,d)))}return h=t.serverCache.isFullyInitialized()||Bo(i,Pe())!=null,Al(t,p,h,l.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vj{constructor(t,n){this.query_=t,this.eventRegistrations_=[];const i=this.query_._queryParams,c=new xh(i.getIndex()),d=$N(i);this.processor_=hj(d);const h=n.serverCache,f=n.eventCache,m=c.updateFullNode(Ae.EMPTY_NODE,h.getNode(),null),p=d.updateFullNode(Ae.EMPTY_NODE,f.getNode(),null),x=new Bn(m,h.isFullyInitialized(),c.filtersNodes()),b=new Bn(p,f.isFullyInitialized(),d.filtersNodes());this.viewCache_=Ko(b,x),this.eventGenerator_=new GN(this.query_)}get query(){return this.query_}}function wj(l){return l.viewCache_.serverCache.getNode()}function kj(l){return $o(l.viewCache_)}function _j(l,t){const n=ya(l.viewCache_);return n&&(l.query._queryParams.loadsAllData()||!Ye(t)&&!n.getImmediateChild(ze(t)).isEmpty())?n.getChild(t):null}function Tp(l){return l.eventRegistrations_.length===0}function Nj(l,t){l.eventRegistrations_.push(t)}function Sp(l,t,n){const i=[];if(n){de(t==null,"A cancel should cancel all event registrations.");const c=l.query._path;l.eventRegistrations_.forEach(d=>{const h=d.createCancelEvent(n,c);h&&i.push(h)})}if(t){let c=[];for(let d=0;d<l.eventRegistrations_.length;++d){const h=l.eventRegistrations_[d];if(!h.matches(t))c.push(h);else if(t.hasAnyCallback()){c=c.concat(l.eventRegistrations_.slice(d+1));break}}l.eventRegistrations_=c}else l.eventRegistrations_=[];return i}function Dp(l,t,n,i){t.type===Ds.MERGE&&t.source.queryId!==null&&(de(ya(l.viewCache_),"We should always have a full cache before handling merges"),de($o(l.viewCache_),"Missing event cache, even though we have a server cache"));const c=l.viewCache_,d=fj(l.processor_,c,t,n,i);return gj(l.processor_,d.viewCache),de(d.viewCache.serverCache.isFullyInitialized()||!c.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),l.viewCache_=d.viewCache,mx(l,d.changes,d.viewCache.eventCache.getNode(),null)}function jj(l,t){const n=l.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(mt,(d,h)=>{i.push(mr(d,h))}),n.isFullyInitialized()&&i.push(ax(n.getNode())),mx(l,i,n.getNode(),t)}function mx(l,t,n,i){const c=i?[i]:l.eventRegistrations_;return PN(l.eventGenerator_,t,n,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vo;class px{constructor(){this.views=new Map}}function Tj(l){de(!Vo,"__referenceConstructor has already been defined"),Vo=l}function Sj(){return de(Vo,"Reference.ts has not been loaded"),Vo}function Dj(l){return l.views.size===0}function jh(l,t,n,i){const c=t.source.queryId;if(c!==null){const d=l.views.get(c);return de(d!=null,"SyncTree gave us an op for an invalid query."),Dp(d,t,n,i)}else{let d=[];for(const h of l.views.values())d=d.concat(Dp(h,t,n,i));return d}}function yx(l,t,n,i,c){const d=t._queryIdentifier,h=l.views.get(d);if(!h){let f=zo(n,c?i:null),m=!1;f?m=!0:i instanceof Ae?(f=kh(n,i),m=!1):(f=Ae.EMPTY_NODE,m=!1);const p=Ko(new Bn(f,m,!1),new Bn(i,c,!1));return new vj(t,p)}return h}function Ej(l,t,n,i,c,d){const h=yx(l,t,i,c,d);return l.views.has(t._queryIdentifier)||l.views.set(t._queryIdentifier,h),Nj(h,n),jj(h,n)}function Cj(l,t,n,i){const c=t._queryIdentifier,d=[];let h=[];const f=Fn(l);if(c==="default")for(const[m,p]of l.views.entries())h=h.concat(Sp(p,n,i)),Tp(p)&&(l.views.delete(m),p.query._queryParams.loadsAllData()||d.push(p.query));else{const m=l.views.get(c);m&&(h=h.concat(Sp(m,n,i)),Tp(m)&&(l.views.delete(c),m.query._queryParams.loadsAllData()||d.push(m.query)))}return f&&!Fn(l)&&d.push(new(Sj())(t._repo,t._path)),{removed:d,events:h}}function xx(l){const t=[];for(const n of l.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function $n(l,t){let n=null;for(const i of l.views.values())n=n||_j(i,t);return n}function bx(l,t){if(t._queryParams.loadsAllData())return Jo(l);{const i=t._queryIdentifier;return l.views.get(i)}}function vx(l,t){return bx(l,t)!=null}function Fn(l){return Jo(l)!=null}function Jo(l){for(const t of l.views.values())if(t.query._queryParams.loadsAllData())return t;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yo;function Aj(l){de(!Yo,"__referenceConstructor has already been defined"),Yo=l}function Rj(){return de(Yo,"Reference.ts has not been loaded"),Yo}let Oj=1;class Ep{constructor(t){this.listenProvider_=t,this.syncPointTree_=new ot(null),this.pendingWriteTree_=oj(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function wx(l,t,n,i,c){return KN(l.pendingWriteTree_,t,n,i,c),c?ei(l,new pa(lx(),t,n)):[]}function ga(l,t,n=!1){const i=ZN(l.pendingWriteTree_,t);if(JN(l.pendingWriteTree_,t)){let d=new ot(null);return i.snap!=null?d=d.set(Pe(),!0):Jt(i.children,h=>{d=d.set(new at(h),!0)}),ei(l,new Ho(i.path,d,n))}else return[]}function Jl(l,t,n){return ei(l,new pa(vh(),t,n))}function Mj(l,t,n){const i=ot.fromObject(n);return ei(l,new zl(vh(),t,i))}function Ij(l,t){return ei(l,new $l(vh(),t))}function Uj(l,t,n){const i=Sh(l,n);if(i){const c=Dh(i),d=c.path,h=c.queryId,f=Yt(d,t),m=new $l(wh(h),f);return Eh(l,d,m)}else return[]}function qo(l,t,n,i,c=!1){const d=t._path,h=l.syncPointTree_.get(d);let f=[];if(h&&(t._queryIdentifier==="default"||vx(h,t))){const m=Cj(h,t,n,i);Dj(h)&&(l.syncPointTree_=l.syncPointTree_.remove(d));const p=m.removed;if(f=m.events,!c){const x=p.findIndex(w=>w._queryParams.loadsAllData())!==-1,b=l.syncPointTree_.findOnPath(d,(w,C)=>Fn(C));if(x&&!b){const w=l.syncPointTree_.subtree(d);if(!w.isEmpty()){const C=$j(w);for(let T=0;T<C.length;++T){const z=C[T],W=z.query,k=jx(l,z);l.listenProvider_.startListening(Ol(W),Bl(l,W),k.hashFn,k.onComplete)}}}!b&&p.length>0&&!i&&(x?l.listenProvider_.stopListening(Ol(t),null):p.forEach(w=>{const C=l.queryToTagMap.get(ec(w));l.listenProvider_.stopListening(Ol(w),C)}))}zj(l,p)}return f}function kx(l,t,n,i){const c=Sh(l,i);if(c!=null){const d=Dh(c),h=d.path,f=d.queryId,m=Yt(h,t),p=new pa(wh(f),m,n);return Eh(l,h,p)}else return[]}function Lj(l,t,n,i){const c=Sh(l,i);if(c){const d=Dh(c),h=d.path,f=d.queryId,m=Yt(h,t),p=ot.fromObject(n),x=new zl(wh(f),m,p);return Eh(l,h,x)}else return[]}function Zu(l,t,n,i=!1){const c=t._path;let d=null,h=!1;l.syncPointTree_.foreachOnPath(c,(w,C)=>{const T=Yt(w,c);d=d||$n(C,T),h=h||Fn(C)});let f=l.syncPointTree_.get(c);f?(h=h||Fn(f),d=d||$n(f,Pe())):(f=new px,l.syncPointTree_=l.syncPointTree_.set(c,f));let m;d!=null?m=!0:(m=!1,d=Ae.EMPTY_NODE,l.syncPointTree_.subtree(c).foreachChild((C,T)=>{const z=$n(T,Pe());z&&(d=d.updateImmediateChild(C,z))}));const p=vx(f,t);if(!p&&!t._queryParams.loadsAllData()){const w=ec(t);de(!l.queryToTagMap.has(w),"View does not exist, but we have a tag");const C=Bj();l.queryToTagMap.set(w,C),l.tagToQueryMap.set(C,w)}const x=Zo(l.pendingWriteTree_,c);let b=Ej(f,t,n,x,d,m);if(!p&&!h&&!i){const w=bx(f,t);b=b.concat(Fj(l,t,w))}return b}function Th(l,t,n){const c=l.pendingWriteTree_,d=l.syncPointTree_.findOnPath(t,(h,f)=>{const m=Yt(h,t),p=$n(f,m);if(p)return p});return dx(c,t,d,n,!0)}function Hj(l,t){const n=t._path;let i=null;l.syncPointTree_.foreachOnPath(n,(p,x)=>{const b=Yt(p,n);i=i||$n(x,b)});let c=l.syncPointTree_.get(n);c?i=i||$n(c,Pe()):(c=new px,l.syncPointTree_=l.syncPointTree_.set(n,c));const d=i!=null,h=d?new Bn(i,!0,!1):null,f=Zo(l.pendingWriteTree_,t._path),m=yx(c,t,f,d?h.getNode():Ae.EMPTY_NODE,d);return kj(m)}function ei(l,t){return _x(t,l.syncPointTree_,null,Zo(l.pendingWriteTree_,Pe()))}function _x(l,t,n,i){if(Ye(l.path))return Nx(l,t,n,i);{const c=t.get(Pe());n==null&&c!=null&&(n=$n(c,Pe()));let d=[];const h=ze(l.path),f=l.operationForChild(h),m=t.children.get(h);if(m&&f){const p=n?n.getImmediateChild(h):null,x=ux(i,h);d=d.concat(_x(f,m,p,x))}return c&&(d=d.concat(jh(c,l,i,n))),d}}function Nx(l,t,n,i){const c=t.get(Pe());n==null&&c!=null&&(n=$n(c,Pe()));let d=[];return t.children.inorderTraversal((h,f)=>{const m=n?n.getImmediateChild(h):null,p=ux(i,h),x=l.operationForChild(h);x&&(d=d.concat(Nx(x,f,m,p)))}),c&&(d=d.concat(jh(c,l,i,n))),d}function jx(l,t){const n=t.query,i=Bl(l,n);return{hashFn:()=>(wj(t)||Ae.EMPTY_NODE).hash(),onComplete:c=>{if(c==="ok")return i?Uj(l,n._path,i):Ij(l,n._path);{const d=H_(c,n);return qo(l,n,null,d)}}}}function Bl(l,t){const n=ec(t);return l.queryToTagMap.get(n)}function ec(l){return l._path.toString()+"$"+l._queryIdentifier}function Sh(l,t){return l.tagToQueryMap.get(t)}function Dh(l){const t=l.indexOf("$");return de(t!==-1&&t<l.length-1,"Bad queryKey."),{queryId:l.substr(t+1),path:new at(l.substr(0,t))}}function Eh(l,t,n){const i=l.syncPointTree_.get(t);de(i,"Missing sync point for query tag that we're tracking");const c=Zo(l.pendingWriteTree_,t);return jh(i,n,c,null)}function $j(l){return l.fold((t,n,i)=>{if(n&&Fn(n))return[Jo(n)];{let c=[];return n&&(c=xx(n)),Jt(i,(d,h)=>{c=c.concat(h)}),c}})}function Ol(l){return l._queryParams.loadsAllData()&&!l._queryParams.isDefault()?new(Rj())(l._repo,l._path):l}function zj(l,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const c=ec(i),d=l.queryToTagMap.get(c);l.queryToTagMap.delete(c),l.tagToQueryMap.delete(d)}}}function Bj(){return Oj++}function Fj(l,t,n){const i=t._path,c=Bl(l,t),d=jx(l,n),h=l.listenProvider_.startListening(Ol(t),c,d.hashFn,d.onComplete),f=l.syncPointTree_.subtree(i);if(c)de(!Fn(f.value),"If we're adding a query, it shouldn't be shadowed");else{const m=f.fold((p,x,b)=>{if(!Ye(p)&&x&&Fn(x))return[Jo(x).query];{let w=[];return x&&(w=w.concat(xx(x).map(C=>C.query))),Jt(b,(C,T)=>{w=w.concat(T)}),w}});for(let p=0;p<m.length;++p){const x=m[p];l.listenProvider_.stopListening(Ol(x),Bl(l,x))}}return h}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(t){this.node_=t}getImmediateChild(t){const n=this.node_.getImmediateChild(t);return new Ch(n)}node(){return this.node_}}class Ah{constructor(t,n){this.syncTree_=t,this.path_=n}getImmediateChild(t){const n=Tt(this.path_,t);return new Ah(this.syncTree_,n)}node(){return Th(this.syncTree_,this.path_)}}const Vj=function(l){return l=l||{},l.timestamp=l.timestamp||new Date().getTime(),l},Cp=function(l,t,n){if(!l||typeof l!="object")return l;if(de(".sv"in l,"Unexpected leaf node or priority contents"),typeof l[".sv"]=="string")return Yj(l[".sv"],t,n);if(typeof l[".sv"]=="object")return qj(l[".sv"],t);de(!1,"Unexpected server value: "+JSON.stringify(l,null,2))},Yj=function(l,t,n){switch(l){case"timestamp":return n.timestamp;default:de(!1,"Unexpected server value: "+l)}},qj=function(l,t,n){l.hasOwnProperty("increment")||de(!1,"Unexpected server value: "+JSON.stringify(l,null,2));const i=l.increment;typeof i!="number"&&de(!1,"Unexpected increment value: "+i);const c=t.node();if(de(c!==null&&typeof c<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!c.isLeafNode())return i;const h=c.getValue();return typeof h!="number"?i:h+i},Gj=function(l,t,n,i){return Rh(t,new Ah(n,l),i)},Tx=function(l,t,n){return Rh(l,new Ch(t),n)};function Rh(l,t,n){const i=l.getPriority().val(),c=Cp(i,t.getImmediateChild(".priority"),n);let d;if(l.isLeafNode()){const h=l,f=Cp(h.getValue(),t,n);return f!==h.getValue()||c!==h.getPriority().val()?new At(f,Mt(c)):l}else{const h=l;return d=h,c!==h.getPriority().val()&&(d=d.updatePriority(new At(c))),h.forEachChild(mt,(f,m)=>{const p=Rh(m,t.getImmediateChild(f),n);p!==m&&(d=d.updateImmediateChild(f,p))}),d}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(t="",n=null,i={children:{},childCount:0}){this.name=t,this.parent=n,this.node=i}}function Mh(l,t){let n=t instanceof at?t:new at(t),i=l,c=ze(n);for(;c!==null;){const d=hr(i.node.children,c)||{children:{},childCount:0};i=new Oh(c,i,d),n=it(n),c=ze(n)}return i}function br(l){return l.node.value}function Sx(l,t){l.node.value=t,Ju(l)}function Dx(l){return l.node.childCount>0}function Pj(l){return br(l)===void 0&&!Dx(l)}function tc(l,t){Jt(l.node.children,(n,i)=>{t(new Oh(n,l,i))})}function Ex(l,t,n,i){n&&t(l),tc(l,c=>{Ex(c,t,!0)})}function Wj(l,t,n){let i=l.parent;for(;i!==null;){if(t(i))return!0;i=i.parent}return!1}function ti(l){return new at(l.parent===null?l.name:ti(l.parent)+"/"+l.name)}function Ju(l){l.parent!==null&&Qj(l.parent,l.name,l)}function Qj(l,t,n){const i=Pj(n),c=on(l.node.children,t);i&&c?(delete l.node.children[t],l.node.childCount--,Ju(l)):!i&&!c&&(l.node.children[t]=n.node,l.node.childCount++,Ju(l))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj=/[\[\].#$\/\u0000-\u001F\u007F]/,Kj=/[\[\].#$\u0000-\u001F\u007F]/,Ru=10*1024*1024,Cx=function(l){return typeof l=="string"&&l.length!==0&&!Xj.test(l)},Ax=function(l){return typeof l=="string"&&l.length!==0&&!Kj.test(l)},Zj=function(l){return l&&(l=l.replace(/^\/*\.info(\/|$)/,"/")),Ax(l)},Rx=function(l,t,n,i){i&&t===void 0||Ih(ih(l,"value"),t,n)},Ih=function(l,t,n){const i=n instanceof at?new yN(n,l):n;if(t===void 0)throw new Error(l+"contains undefined "+da(i));if(typeof t=="function")throw new Error(l+"contains a function "+da(i)+" with contents = "+t.toString());if(Dy(t))throw new Error(l+"contains "+t.toString()+" "+da(i));if(typeof t=="string"&&t.length>Ru/3&&Wo(t)>Ru)throw new Error(l+"contains a string greater than "+Ru+" utf8 bytes "+da(i)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let c=!1,d=!1;if(Jt(t,(h,f)=>{if(h===".value")c=!0;else if(h!==".priority"&&h!==".sv"&&(d=!0,!Cx(h)))throw new Error(l+" contains an invalid key ("+h+") "+da(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);xN(i,h),Ih(l,f,i),bN(i)}),c&&d)throw new Error(l+' contains ".value" child '+da(i)+" in addition to actual children.")}},Ox=function(l,t,n,i){if(!Ax(n))throw new Error(ih(l,t)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Jj=function(l,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ox(l,t,n)},Uh=function(l,t){if(ze(t)===".info")throw new Error(l+" failed = Can't modify data under /.info/")},e1=function(l,t){const n=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!Cx(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!Zj(n))throw new Error(ih(l,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Lh(l,t){let n=null;for(let i=0;i<t.length;i++){const c=t[i],d=c.getPath();n!==null&&!mh(d,n.path)&&(l.eventLists_.push(n),n=null),n===null&&(n={events:[],path:d}),n.events.push(c)}n&&l.eventLists_.push(n)}function Mx(l,t,n){Lh(l,n),Ix(l,i=>mh(i,t))}function $s(l,t,n){Lh(l,n),Ix(l,i=>Ss(i,t)||Ss(t,i))}function Ix(l,t){l.recursionDepth_++;let n=!0;for(let i=0;i<l.eventLists_.length;i++){const c=l.eventLists_[i];if(c){const d=c.path;t(d)?(s1(l.eventLists_[i]),l.eventLists_[i]=null):n=!1}}n&&(l.eventLists_=[]),l.recursionDepth_--}function s1(l){for(let t=0;t<l.events.length;t++){const n=l.events[t];if(n!==null){l.events[t]=null;const i=n.getEventRunner();El&&zt("event: "+n.toString()),xr(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1="repo_interrupt",a1=25;class r1{constructor(t,n,i,c){this.repoInfo_=t,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=c,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new t1,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Lo(),this.transactionQueueTree_=new Oh,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function l1(l,t,n){if(l.stats_=gh(l.repoInfo_),l.forceRestClient_||F_())l.server_=new Uo(l.repoInfo_,(i,c,d,h)=>{Ap(l,i,c,d,h)},l.authTokenProvider_,l.appCheckProvider_),setTimeout(()=>Rp(l,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{jt(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}l.persistentConnection_=new rn(l.repoInfo_,t,(i,c,d,h)=>{Ap(l,i,c,d,h)},i=>{Rp(l,i)},i=>{i1(l,i)},l.authTokenProvider_,l.appCheckProvider_,n),l.server_=l.persistentConnection_}l.authTokenProvider_.addTokenChangeListener(i=>{l.server_.refreshAuthToken(i)}),l.appCheckProvider_.addTokenChangeListener(i=>{l.server_.refreshAppCheckToken(i.token)}),l.statsReporter_=P_(l.repoInfo_,()=>new qN(l.stats_,l.server_)),l.infoData_=new zN,l.infoSyncTree_=new Ep({startListening:(i,c,d,h)=>{let f=[];const m=l.infoData_.getNode(i._path);return m.isEmpty()||(f=Jl(l.infoSyncTree_,i._path,m),setTimeout(()=>{h("ok")},0)),f},stopListening:()=>{}}),$h(l,"connected",!1),l.serverSyncTree_=new Ep({startListening:(i,c,d,h)=>(l.server_.listen(i,d,c,(f,m)=>{const p=h(f,m);$s(l.eventQueue_,i._path,p)}),[]),stopListening:(i,c)=>{l.server_.unlisten(i,c)}})}function Ux(l){const n=l.infoData_.getNode(new at(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Hh(l){return Vj({timestamp:Ux(l)})}function Ap(l,t,n,i,c){l.dataUpdateCount++;const d=new at(t);n=l.interceptServerDataCallback_?l.interceptServerDataCallback_(t,n):n;let h=[];if(c)if(i){const m=Eo(n,p=>Mt(p));h=Lj(l.serverSyncTree_,d,m,c)}else{const m=Mt(n);h=kx(l.serverSyncTree_,d,m,c)}else if(i){const m=Eo(n,p=>Mt(p));h=Mj(l.serverSyncTree_,d,m)}else{const m=Mt(n);h=Jl(l.serverSyncTree_,d,m)}let f=d;h.length>0&&(f=nc(l,d)),$s(l.eventQueue_,f,h)}function Rp(l,t){$h(l,"connected",t),t===!1&&d1(l)}function i1(l,t){Jt(t,(n,i)=>{$h(l,n,i)})}function $h(l,t,n){const i=new at("/.info/"+t),c=Mt(n);l.infoData_.updateSnapshot(i,c);const d=Jl(l.infoSyncTree_,i,c);$s(l.eventQueue_,i,d)}function Lx(l){return l.nextWriteId_++}function o1(l,t,n){const i=Hj(l.serverSyncTree_,t);return i!=null?Promise.resolve(i):l.server_.get(t).then(c=>{const d=Mt(c).withIndex(t._queryParams.getIndex());Zu(l.serverSyncTree_,t,n,!0);let h;if(t._queryParams.loadsAllData())h=Jl(l.serverSyncTree_,t._path,d);else{const f=Bl(l.serverSyncTree_,t);h=kx(l.serverSyncTree_,t._path,d,f)}return $s(l.eventQueue_,t._path,h),qo(l.serverSyncTree_,t,n,null,!0),d},c=>(sc(l,"get for query "+jt(t)+" failed: "+c),Promise.reject(new Error(c))))}function c1(l,t,n,i,c){sc(l,"set",{path:t.toString(),value:n,priority:i});const d=Hh(l),h=Mt(n,i),f=Th(l.serverSyncTree_,t),m=Tx(h,f,d),p=Lx(l),x=wx(l.serverSyncTree_,t,m,p,!0);Lh(l.eventQueue_,x),l.server_.put(t.toString(),h.val(!0),(w,C)=>{const T=w==="ok";T||Zt("set at "+t+" failed: "+w);const z=ga(l.serverSyncTree_,p,!T);$s(l.eventQueue_,t,z),f1(l,c,w,C)});const b=Fx(l,t);nc(l,b),$s(l.eventQueue_,b,[])}function d1(l){sc(l,"onDisconnectEvents");const t=Hh(l),n=Lo();Pu(l.onDisconnect_,Pe(),(c,d)=>{const h=Gj(c,d,l.serverSyncTree_,t);rx(n,c,h)});let i=[];Pu(n,Pe(),(c,d)=>{i=i.concat(Jl(l.serverSyncTree_,c,d));const h=Fx(l,c);nc(l,h)}),l.onDisconnect_=Lo(),$s(l.eventQueue_,Pe(),i)}function u1(l,t,n){let i;ze(t._path)===".info"?i=Zu(l.infoSyncTree_,t,n):i=Zu(l.serverSyncTree_,t,n),Mx(l.eventQueue_,t._path,i)}function h1(l,t,n){let i;ze(t._path)===".info"?i=qo(l.infoSyncTree_,t,n):i=qo(l.serverSyncTree_,t,n),Mx(l.eventQueue_,t._path,i)}function g1(l){l.persistentConnection_&&l.persistentConnection_.interrupt(n1)}function sc(l,...t){let n="";l.persistentConnection_&&(n=l.persistentConnection_.id+":"),zt(n,...t)}function f1(l,t,n,i){t&&xr(()=>{if(n==="ok")t(null);else{const c=(n||"error").toUpperCase();let d=c;i&&(d+=": "+i);const h=new Error(d);h.code=c,t(h)}})}function Hx(l,t,n){return Th(l.serverSyncTree_,t,n)||Ae.EMPTY_NODE}function zh(l,t=l.transactionQueueTree_){if(t||ac(l,t),br(t)){const n=zx(l,t);de(n.length>0,"Sending zero length transaction queue"),n.every(c=>c.status===0)&&m1(l,ti(t),n)}else Dx(t)&&tc(t,n=>{zh(l,n)})}function m1(l,t,n){const i=n.map(p=>p.currentWriteId),c=Hx(l,t,i);let d=c;const h=c.hash();for(let p=0;p<n.length;p++){const x=n[p];de(x.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),x.status=1,x.retryCount++;const b=Yt(t,x.path);d=d.updateChild(b,x.currentOutputSnapshotRaw)}const f=d.val(!0),m=t;l.server_.put(m.toString(),f,p=>{sc(l,"transaction put response",{path:m.toString(),status:p});let x=[];if(p==="ok"){const b=[];for(let w=0;w<n.length;w++)n[w].status=2,x=x.concat(ga(l.serverSyncTree_,n[w].currentWriteId)),n[w].onComplete&&b.push(()=>n[w].onComplete(null,!0,n[w].currentOutputSnapshotResolved)),n[w].unwatcher();ac(l,Mh(l.transactionQueueTree_,t)),zh(l,l.transactionQueueTree_),$s(l.eventQueue_,t,x);for(let w=0;w<b.length;w++)xr(b[w])}else{if(p==="datastale")for(let b=0;b<n.length;b++)n[b].status===3?n[b].status=4:n[b].status=0;else{Zt("transaction at "+m.toString()+" failed: "+p);for(let b=0;b<n.length;b++)n[b].status=4,n[b].abortReason=p}nc(l,t)}},h)}function nc(l,t){const n=$x(l,t),i=ti(n),c=zx(l,n);return p1(l,c,i),i}function p1(l,t,n){if(t.length===0)return;const i=[];let c=[];const h=t.filter(f=>f.status===0).map(f=>f.currentWriteId);for(let f=0;f<t.length;f++){const m=t[f],p=Yt(n,m.path);let x=!1,b;if(de(p!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),m.status===4)x=!0,b=m.abortReason,c=c.concat(ga(l.serverSyncTree_,m.currentWriteId,!0));else if(m.status===0)if(m.retryCount>=a1)x=!0,b="maxretry",c=c.concat(ga(l.serverSyncTree_,m.currentWriteId,!0));else{const w=Hx(l,m.path,h);m.currentInputSnapshot=w;const C=t[f].update(w.val());if(C!==void 0){Ih("transaction failed: Data returned ",C,m.path);let T=Mt(C);typeof C=="object"&&C!=null&&on(C,".priority")||(T=T.updatePriority(w.getPriority()));const W=m.currentWriteId,k=Hh(l),R=Tx(T,w,k);m.currentOutputSnapshotRaw=T,m.currentOutputSnapshotResolved=R,m.currentWriteId=Lx(l),h.splice(h.indexOf(W),1),c=c.concat(wx(l.serverSyncTree_,m.path,R,m.currentWriteId,m.applyLocally)),c=c.concat(ga(l.serverSyncTree_,W,!0))}else x=!0,b="nodata",c=c.concat(ga(l.serverSyncTree_,m.currentWriteId,!0))}$s(l.eventQueue_,n,c),c=[],x&&(t[f].status=2,function(w){setTimeout(w,Math.floor(0))}(t[f].unwatcher),t[f].onComplete&&(b==="nodata"?i.push(()=>t[f].onComplete(null,!1,t[f].currentInputSnapshot)):i.push(()=>t[f].onComplete(new Error(b),!1,null))))}ac(l,l.transactionQueueTree_);for(let f=0;f<i.length;f++)xr(i[f]);zh(l,l.transactionQueueTree_)}function $x(l,t){let n,i=l.transactionQueueTree_;for(n=ze(t);n!==null&&br(i)===void 0;)i=Mh(i,n),t=it(t),n=ze(t);return i}function zx(l,t){const n=[];return Bx(l,t,n),n.sort((i,c)=>i.order-c.order),n}function Bx(l,t,n){const i=br(t);if(i)for(let c=0;c<i.length;c++)n.push(i[c]);tc(t,c=>{Bx(l,c,n)})}function ac(l,t){const n=br(t);if(n){let i=0;for(let c=0;c<n.length;c++)n[c].status!==2&&(n[i]=n[c],i++);n.length=i,Sx(t,n.length>0?n:void 0)}tc(t,i=>{ac(l,i)})}function Fx(l,t){const n=ti($x(l,t)),i=Mh(l.transactionQueueTree_,t);return Wj(i,c=>{Ou(l,c)}),Ou(l,i),Ex(i,c=>{Ou(l,c)}),n}function Ou(l,t){const n=br(t);if(n){const i=[];let c=[],d=-1;for(let h=0;h<n.length;h++)n[h].status===3||(n[h].status===1?(de(d===h-1,"All SENT items should be at beginning of queue."),d=h,n[h].status=3,n[h].abortReason="set"):(de(n[h].status===0,"Unexpected transaction status in abort"),n[h].unwatcher(),c=c.concat(ga(l.serverSyncTree_,n[h].currentWriteId,!0)),n[h].onComplete&&i.push(n[h].onComplete.bind(null,new Error("set"),!1,null))));d===-1?Sx(t,void 0):n.length=d+1,$s(l.eventQueue_,ti(t),c);for(let h=0;h<i.length;h++)xr(i[h])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y1(l){let t="";const n=l.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let c=n[i];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch{}t+="/"+c}return t}function x1(l){const t={};l.charAt(0)==="?"&&(l=l.substring(1));for(const n of l.split("&")){if(n.length===0)continue;const i=n.split("=");i.length===2?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Zt(`Invalid query segment '${n}' in query '${l}'`)}return t}const Op=function(l,t){const n=b1(l),i=n.namespace;n.domain==="firebase.com"&&ln(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&ln("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||O_();const c=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new zy(n.host,n.secure,i,c,t,"",i!==n.subdomain),path:new at(n.pathString)}},b1=function(l){let t="",n="",i="",c="",d="",h=!0,f="https",m=443;if(typeof l=="string"){let p=l.indexOf("//");p>=0&&(f=l.substring(0,p-1),l=l.substring(p+2));let x=l.indexOf("/");x===-1&&(x=l.length);let b=l.indexOf("?");b===-1&&(b=l.length),t=l.substring(0,Math.min(x,b)),x<b&&(c=y1(l.substring(x,b)));const w=x1(l.substring(Math.min(l.length,b)));p=t.indexOf(":"),p>=0?(h=f==="https"||f==="wss",m=parseInt(t.substring(p+1),10)):p=t.length;const C=t.slice(0,p);if(C.toLowerCase()==="localhost")n="localhost";else if(C.split(".").length<=2)n=C;else{const T=t.indexOf(".");i=t.substring(0,T).toLowerCase(),n=t.substring(T+1),d=i}"ns"in w&&(d=w.ns)}return{host:t,port:m,domain:n,subdomain:i,secure:h,scheme:f,pathString:c,namespace:d}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",v1=function(){let l=0;const t=[];return function(n){const i=n===l;l=n;let c;const d=new Array(8);for(c=7;c>=0;c--)d[c]=Mp.charAt(n%64),n=Math.floor(n/64);de(n===0,"Cannot push at time == 0");let h=d.join("");if(i){for(c=11;c>=0&&t[c]===63;c--)t[c]=0;t[c]++}else for(c=0;c<12;c++)t[c]=Math.floor(Math.random()*64);for(c=0;c<12;c++)h+=Mp.charAt(t[c]);return de(h.length===20,"nextPushId: Length should be 20."),h}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(t,n,i,c){this.eventType=t,this.eventRegistration=n,this.snapshot=i,this.prevName=c}getPath(){const t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+jt(this.snapshot.exportVal())}}class k1{constructor(t,n,i){this.eventRegistration=t,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(t,n){this.snapshotCallback=t,this.cancelCallback=n}onValue(t,n){this.snapshotCallback.call(null,t,n)}onCancel(t){return de(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh{constructor(t,n,i,c){this._repo=t,this._path=n,this._queryParams=i,this._orderByCalled=c}get key(){return Ye(this._path)?null:Qy(this._path)}get ref(){return new cn(this._repo,this._path)}get _queryIdentifier(){const t=xp(this._queryParams),n=uh(t);return n==="{}"?"default":n}get _queryObject(){return xp(this._queryParams)}isEqual(t){if(t=Vn(t),!(t instanceof Bh))return!1;const n=this._repo===t._repo,i=mh(this._path,t._path),c=this._queryIdentifier===t._queryIdentifier;return n&&i&&c}toJSON(){return this.toString()}toString(){return this._repo.toString()+pN(this._path)}}class cn extends Bh{constructor(t,n){super(t,n,new bh,!1)}get parent(){const t=Ky(this._path);return t===null?null:new cn(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}}class Fl{constructor(t,n,i){this._node=t,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const n=new at(t),i=Vl(this.ref,t);return new Fl(this._node.getChild(n),i,mt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,c)=>t(new Fl(c,Vl(this.ref,i),mt)))}hasChild(t){const n=new at(t);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Is(l,t){return l=Vn(l),l._checkNotDeleted("ref"),t!==void 0?Vl(l._root,t):l._root}function Vl(l,t){return l=Vn(l),ze(l._path)===null?Jj("child","path",t):Ox("child","path",t),new cn(l._repo,Tt(l._path,t))}function _1(l,t){l=Vn(l),Uh("push",l._path),Rx("push",t,l._path,!0);const n=Ux(l._repo),i=v1(n),c=Vl(l,i),d=Vl(l,i);let h;return h=Promise.resolve(d),c.then=h.then.bind(h),c.catch=h.then.bind(h,void 0),c}function Ip(l){return Uh("remove",l._path),or(l,null)}function or(l,t){l=Vn(l),Uh("set",l._path),Rx("set",t,l._path,!1);const n=new oh;return c1(l._repo,l._path,t,null,n.wrapCallback(()=>{})),n.promise}function Mu(l){l=Vn(l);const t=new Vx(()=>{}),n=new rc(t);return o1(l._repo,l,n).then(i=>new Fl(i,new cn(l._repo,l._path),l._queryParams.getIndex()))}class rc{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,n){const i=n._queryParams.getIndex();return new w1("value",this,new Fl(t.snapshotNode,new cn(n._repo,n._path),i))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,n){return this.callbackContext.hasCancelCallback?new k1(this,t,n):null}matches(t){return t instanceof rc?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function N1(l,t,n,i,c){const d=new Vx(n,void 0),h=new rc(d);return u1(l._repo,l,h),()=>h1(l._repo,l,h)}function Up(l,t,n,i){return N1(l,"value",t)}Tj(cn);Aj(cn);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j1="FIREBASE_DATABASE_EMULATOR_HOST",eh={};let T1=!1;function S1(l,t,n,i){const c=t.lastIndexOf(":"),d=t.substring(0,c),h=rh(d);l.repoInfo_=new zy(t,h,l.repoInfo_.namespace,l.repoInfo_.webSocketOnly,l.repoInfo_.nodeAdmin,l.repoInfo_.persistenceKey,l.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(l.authTokenProvider_=i)}function D1(l,t,n,i,c){let d=i||l.options.databaseURL;d===void 0&&(l.options.projectId||ln("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),zt("Using default host for project ",l.options.projectId),d=`${l.options.projectId}-default-rtdb.firebaseio.com`);let h=Op(d,c),f=h.repoInfo,m;typeof process<"u"&&ep&&(m=ep[j1]),m?(d=`http://${m}?ns=${f.namespace}`,h=Op(d,c),f=h.repoInfo):h.repoInfo.secure;const p=new Y_(l.name,l.options,t);e1("Invalid Firebase Database URL",h),Ye(h.path)||ln("Database URL must point to the root of a Firebase Database (not including a child path).");const x=C1(f,l,p,new V_(l,n));return new A1(x,l)}function E1(l,t){const n=eh[t];(!n||n[l.key]!==l)&&ln(`Database ${t}(${l.repoInfo_}) has already been deleted.`),g1(l),delete n[l.key]}function C1(l,t,n,i){let c=eh[t.name];c||(c={},eh[t.name]=c);let d=c[l.toURLString()];return d&&ln("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),d=new r1(l,T1,n,i),c[l.toURLString()]=d,d}class A1{constructor(t,n){this._repoInternal=t,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(l1(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new cn(this._repo,Pe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(E1(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&ln("Cannot call "+t+" on a deleted database.")}}function R1(l=ey(),t){const n=ty(l,"database").getImmediate({identifier:t});if(!n._instanceStarted){const i=sy("database");i&&O1(n,...i)}return n}function O1(l,t,n,i={}){l=Vn(l),l._checkNotDeleted("useEmulator");const c=`${t}:${n}`,d=l._repoInternal;if(l._instanceStarted){if(c===l._repoInternal.repoInfo_.host&&dk(i,d.repoInfo_.emulatorOptions))return;ln("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let h;if(d.repoInfo_.nodeAdmin)i.mockUserToken&&ln('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),h=new No(No.OWNER);else if(i.mockUserToken){const f=typeof i.mockUserToken=="string"?i.mockUserToken:ry(i.mockUserToken,l.app.options.projectId);h=new No(f)}rh(t)&&(ny(t),ay("Database",!0)),S1(d,c,i,h)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M1(l){S_(Zp),Xp(new Kp("database",(t,{instanceIdentifier:n})=>{const i=t.getProvider("app").getImmediate(),c=t.getProvider("auth-internal"),d=t.getProvider("app-check-internal");return D1(i,c,d,n)},"PUBLIC").setMultipleInstances(!0)),Do(tp,sp,l),Do(tp,sp,"esm2020")}rn.prototype.simpleListen=function(l,t){this.sendRequest("q",{p:l},t)};rn.prototype.echo=function(l,t){this.sendRequest("echo",{d:l},t)};M1();const I1={apiKey:"AIzaSyCaQ6ndqGrR_x6fvTrZxdf5cHTNnRIj2Gg",authDomain:"busvacation-e894a.firebaseapp.com",databaseURL:"https://busvacation-e894a-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"busvacation-e894a",storageBucket:"busvacation-e894a.appspot.com",messagingSenderId:"919121046118",appId:"1:919121046118:web:033047c3f1bba2164e5ba7"},U1=()=>{const l=ly().find(t=>t.name==="vacation-management");return l||iy(I1,"vacation-management")},L1=U1(),Us=R1(L1);class H1{constructor(){this.listeners=new Map}listeners;sanitizeDepartmentCode(t){try{return btoa(encodeURIComponent(t)).replace(/[/+=]/g,"_")}catch{return t.replace(/[^a-zA-Z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")}}getDepartmentPath(t,n){return`departments/${this.sanitizeDepartmentCode(t)}/${n}`}async getEmployees(t){const n=this.getDepartmentPath(t,"employees");try{const i=await Mu(Is(Us,n));return i.exists()?i.val():[]}catch(i){return console.error(` [${t}]    :`,i),[]}}async saveEmployees(t,n){const i=this.getDepartmentPath(t,"employees");try{return await or(Is(Us,i),n),console.log(` [${t}]    `),{success:!0}}catch(c){return console.error(` [${t}]    :`,c),{success:!1,error:c}}}async getVacations(t){const n=this.getDepartmentPath(t,"vacations");try{const i=await Mu(Is(Us,n));if(i.exists()){const c=i.val();return Array.isArray(c)?c:Object.keys(c||{}).map(d=>({...c[d],id:d}))}return[]}catch(i){return console.error(` [${t}]    :`,i),[]}}async saveVacations(t,n){const i=this.getDepartmentPath(t,"vacations");try{return await or(Is(Us,i),n),console.log(` [${t}]    `),{success:!0}}catch(c){return console.error(` [${t}]    :`,c),{success:!1,error:c}}}async addVacation(t,n){const i=this.getDepartmentPath(t,"vacations");try{const c=Is(Us,i),d=_1(c),h={...n,id:d.key,createdAt:Date.now(),updatedAt:Date.now()};return await or(d,h),console.log(` [${t}]   :`,h.id),{success:!0,vacation:h}}catch(c){return console.error(` [${t}]   :`,c),{success:!1,error:c}}}async updateVacation(t,n,i){const c=`${this.getDepartmentPath(t,"vacations")}/${n}`;try{const d={...i,updatedAt:Date.now()};return await or(Is(Us,c),d),console.log(` [${t}]   :`,n),{success:!0}}catch(d){return console.error(` [${t}]   :`,d),{success:!1,error:d}}}async deleteVacation(t,n){const i=`${this.getDepartmentPath(t,"vacations")}/${n}`;try{return await Ip(Is(Us,i)),console.log(` [${t}]   :`,n),{success:!0}}catch(c){return console.error(` [${t}]   :`,c),{success:!1,error:c}}}subscribeToVacations(t,n){const i=this.getDepartmentPath(t,"vacations"),c=Is(Us,i),d=Up(c,f=>{const m=f.exists()?f.val():[],p=Array.isArray(m)?m:Object.keys(m||{}).map(x=>({...m[x],id:x}));n(p)}),h=`vacations_${t}`;return this.listeners.set(h,{ref:c,unsubscribe:d}),()=>{d(),this.listeners.delete(h)}}subscribeToEmployees(t,n){const i=this.getDepartmentPath(t,"employees"),c=Is(Us,i),d=Up(c,f=>{const m=f.exists()?f.val():[];n(m)}),h=`employees_${t}`;return this.listeners.set(h,{ref:c,unsubscribe:d}),()=>{d(),this.listeners.delete(h)}}async testConnection(){try{const t=Is(Us,"connection_test");await or(t,{timestamp:Date.now(),test:!0});const n=await Mu(t),i=n.exists()&&n.val().test===!0;return i&&await Ip(t),console.log(`  Firebase   ${i?"":""}`),i}catch(t){return console.error(" Firebase   :",t),!1}}cleanup(){console.log("  Firebase   ..."),this.listeners.forEach(({unsubscribe:t},n)=>{t(),console.log(`  : ${n}`)}),this.listeners.clear()}}const ua=new H1,Yx=M.createContext(void 0),$1=({children:l})=>{const{currentUser:t}=vs(),[n,i]=M.useState([]),[c,d]=M.useState([]),[h,f]=M.useState(!1),[m,p]=M.useState(()=>{const T=localStorage.getItem("showVacationsInTodos");return T?JSON.parse(T):!0}),x=()=>{const T=!m;p(T),localStorage.setItem("showVacationsInTodos",JSON.stringify(T))},b=async()=>{if(!(!t||!Ln(t.email))){f(!0);try{const[T,z]=await Promise.all([ua.getEmployees(""),ua.getVacations("")]);i(T),d(z)}catch(T){console.error("   :",T)}finally{f(!1)}}},w=T=>{if(!m)return[];const z=new Date(T.getTime()-T.getTimezoneOffset()*6e4),W=z.toISOString().split("T")[0];return console.log("  :",{originalDate:T,localDate:z,dateStr:W,availableVacations:c.map(k=>({id:k.id,date:k.date,type:k.type}))}),c.filter(k=>k.date===W)};M.useEffect(()=>{t&&Ln(t.email)&&b()},[t]);const C={employees:n,vacations:c,loading:h,showVacationsInTodos:m,toggleVacationDisplay:x,refreshVacationData:b,getVacationsForDate:w};return r.jsx(Yx.Provider,{value:C,children:l})},Fh=()=>{const l=M.useContext(Yx);if(l===void 0)throw new Error("useVacation must be used within a VacationProvider");return l},qx=M.createContext(void 0),z1=({children:l,onOpenAddTodo:t,onFocusSearch:n,onToggleSidebar:i,onSwitchToTodayView:c,onSwitchToWeekView:d,onSwitchToMonthView:h})=>{const f={openAddTodoModal:t,focusSearch:n,toggleSidebar:i,switchToTodayView:c,switchToWeekView:d,switchToMonthView:h};return r.jsx(qx.Provider,{value:f,children:l})},B1=()=>{const l=M.useContext(qx);if(l===void 0)throw new Error("useKeyboard must be used within a KeyboardProvider");return l},Gx=M.createContext(void 0),F1=()=>{const l=M.useContext(Gx);if(l===void 0)throw new Error("useFontSize must be used within a FontSizeProvider");return l},V1=({children:l})=>{const[t,n]=M.useState(()=>{const i=localStorage.getItem("fontSizeLevel");return i?parseInt(i,10):3});return M.useEffect(()=>{localStorage.setItem("fontSizeLevel",t.toString());const i=document.documentElement;i.classList.remove("font-size-1","font-size-2","font-size-3","font-size-4","font-size-5"),i.classList.add(`font-size-${t}`);const c={1:.85,2:.925,3:1,4:1.125,5:1.25};i.style.setProperty("--font-scale",c[t].toString())},[t]),r.jsx(Gx.Provider,{value:{fontSizeLevel:t,setFontSizeLevel:n},children:l})},Y1=()=>{const{openAddTodoModal:l,focusSearch:t,toggleSidebar:n,switchToTodayView:i,switchToWeekView:c,switchToMonthView:d}=B1();M.useEffect(()=>{const h=m=>{if(m.ctrlKey||m.metaKey)switch(m.key.toLowerCase()){case"1":m.preventDefault(),i();break;case"2":m.preventDefault(),c();break;case"3":m.preventDefault(),d();break;case"b":m.preventDefault(),n();break;case"n":m.preventDefault(),l();break;case"f":m.preventDefault(),t();break;case"k":m.preventDefault(),f();break}if(m.key==="Escape"){const p=document.querySelectorAll('[role="dialog"]');if(p.length>0){m.preventDefault();const x=p[p.length-1].querySelector('[aria-label=""], [data-close]');x&&x.click()}}},f=()=>{alert(`  :

`+["Ctrl+1:  ","Ctrl+2:  ","Ctrl+3:  ","Ctrl+N:   ","Ctrl+F: ","Ctrl+B:  ","Ctrl+K:  ","ESC:  "].join(`
`))};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[l,t,n,i,c,d])};class q1{metrics=[];observers=[];constructor(){this.setupObservers(),this.measureInitialLoad()}setupObservers(){try{if("PerformanceObserver"in window){const t=new PerformanceObserver(d=>{const h=d.getEntries(),f=h[h.length-1];this.recordMetric("LCP",f.startTime,this.getRating("LCP",f.startTime))});t.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(t);const n=new PerformanceObserver(d=>{for(const h of d.getEntries()){const f=h.processingStart-h.startTime;this.recordMetric("FID",f,this.getRating("FID",f))}});n.observe({entryTypes:["first-input"]}),this.observers.push(n);let i=0;const c=new PerformanceObserver(d=>{for(const h of d.getEntries())h.hadRecentInput||(i+=h.value);this.recordMetric("CLS",i,this.getRating("CLS",i))});c.observe({entryTypes:["layout-shift"]}),this.observers.push(c)}}catch(t){Te.error("Performance observer setup failed:",t)}}measureInitialLoad(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.collectNavigationMetrics()):this.collectNavigationMetrics()}collectNavigationMetrics(){if(performance.getEntriesByType){const t=performance.getEntriesByType("navigation")[0];if(t){const n=t.responseStart-t.requestStart;this.recordMetric("TTFB",n,this.getRating("TTFB",n));const i=t.domContentLoadedEventEnd-t.domContentLoadedEventStart;this.recordMetric("DOM_LOADED",i,this.getRating("DOM_LOADED",i));const c=t.loadEventEnd-t.loadEventStart;this.recordMetric("LOAD_COMPLETE",c,this.getRating("LOAD_COMPLETE",c))}}}getRating(t,n){const c={LCP:{good:2500,poor:4e3},FID:{good:100,poor:300},CLS:{good:.1,poor:.25},TTFB:{good:800,poor:1800},DOM_LOADED:{good:1e3,poor:3e3},LOAD_COMPLETE:{good:2e3,poor:5e3}}[t];return!c||n<=c.good?"good":n<=c.poor?"needs-improvement":"poor"}recordMetric(t,n,i){const c={name:t,value:n,rating:i,timestamp:Date.now()};this.metrics.push(c),Te.log(`Performance metric: ${t} = ${n.toFixed(2)}ms (${i})`),i==="poor"&&Te.warn(`Poor performance detected: ${t} = ${n.toFixed(2)}ms`)}measureMemoryUsage(){if("memory"in performance){const t=performance.memory;Te.log("Memory usage:",{used:`${(t.usedJSHeapSize/1024/1024).toFixed(2)}MB`,total:`${(t.totalJSHeapSize/1024/1024).toFixed(2)}MB`,limit:`${(t.jsHeapSizeLimit/1024/1024).toFixed(2)}MB`})}}getMetrics(){return[...this.metrics]}getSummary(){const t={};return[...new Set(this.metrics.map(i=>i.name))].forEach(i=>{const c=this.metrics.filter(d=>d.name===i).sort((d,h)=>h.timestamp-d.timestamp)[0];c&&(t[i]={value:c.value,rating:c.rating})}),t}cleanup(){this.observers.forEach(t=>t.disconnect()),this.observers=[],this.metrics=[]}}const G1=new q1,P1=l=>{const t=performance.now();return()=>{const i=performance.now()-t;Te.log(`Render time for ${l}: ${i.toFixed(2)}ms`),i>16.67&&Te.warn(`Slow render detected: ${l} took ${i.toFixed(2)}ms`)}};class W1{errors=[];maxErrors=100;constructor(){this.setupGlobalErrorHandling()}setupGlobalErrorHandling(){window.addEventListener("error",t=>{this.trackError({message:t.message,stack:t.error?.stack,severity:"high",context:{filename:t.filename,lineno:t.lineno,colno:t.colno}})}),window.addEventListener("unhandledrejection",t=>{const n=t.reason;this.trackError({message:n?.message||"Unhandled promise rejection",stack:n?.stack,severity:"high",context:{type:"unhandled_promise_rejection",reason:n}})}),window.addEventListener("error",t=>{t.target!==window&&this.trackError({message:"Resource loading failed",severity:"medium",context:{type:"resource_error",element:t.target?.tagName,source:t.target?.src||t.target?.href}})},!0)}trackError(t){const n={id:this.generateErrorId(),message:t.message,stack:t.stack,severity:t.severity,timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent,userId:t.userId,context:t.context,resolved:!1};return this.errors.push(n),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors)),n.severity==="critical"||n.severity==="high"?Te.error(`[ErrorTracker] ${n.severity.toUpperCase()}: ${n.message}`,{id:n.id,stack:n.stack,context:n.context}):Te.warn(`[ErrorTracker] ${n.severity.toUpperCase()}: ${n.message}`),n.id}trackReactError(t,n,i){return this.trackError({message:`React Error: ${t.message}`,stack:t.stack,severity:"high",context:{type:"react_error",componentStack:n.componentStack,errorBoundary:n.errorBoundary},userId:i})}trackFirebaseError(t,n,i){const c=this.getFirebaseErrorSeverity(t.code);return this.trackError({message:`Firebase Error in ${n}: ${t.message}`,stack:t.stack,severity:c,context:{type:"firebase_error",code:t.code,operation:n,customData:t.customData},userId:i})}trackUserActionError(t,n,i){return this.trackError({message:`User Action Error (${t}): ${n.message}`,stack:n.stack,severity:"medium",context:{type:"user_action_error",action:t,timestamp:Date.now()},userId:i})}getFirebaseErrorSeverity(t){const n=["internal","unavailable","data-loss"],i=["permission-denied","unauthenticated","failed-precondition"],c=["not-found","already-exists","invalid-argument"];return n.includes(t)?"critical":i.includes(t)?"high":c.includes(t)?"medium":"low"}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}resolveError(t){const n=this.errors.find(i=>i.id===t);return n?(n.resolved=!0,!0):!1}getErrorStats(){const t=this.errors.length,n=this.errors.filter(h=>h.resolved).length,i=t-n,c=this.errors.reduce((h,f)=>(h[f.severity]=(h[f.severity]||0)+1,h),{}),d=this.errors.slice(-10).sort((h,f)=>f.timestamp-h.timestamp);return{total:t,resolved:n,unresolved:i,bySeverity:c,recent:d}}getCriticalErrors(){return this.errors.filter(t=>(t.severity==="critical"||t.severity==="high")&&!t.resolved)}searchErrors(t){const n=t.toLowerCase();return this.errors.filter(i=>i.message.toLowerCase().includes(n)||i.stack?.toLowerCase().includes(n))}exportErrors(){return JSON.stringify(this.errors,null,2)}cleanup(){this.errors=[]}}const Px=new W1,yS=l=>(t,n)=>{Px.trackReactError(t,{componentStack:n.componentStack,errorBoundary:l})},Q1=()=>{const l=document.querySelector('meta[http-equiv="Content-Security-Policy"]');l&&Te.log("CSP policy found:",l.getAttribute("content"))},X1=()=>{try{const l="_security_test",t="test";localStorage.setItem(l,t);const n=localStorage.getItem(l);localStorage.removeItem(l),n!==t?Te.error("localStorage security test failed"):Te.log("localStorage security validation passed")}catch(l){Te.error("localStorage access error:",l)}},K1=async()=>{try{return typeof window<"u"&&window.firebase?(Te.log("Firebase is properly initialized"),!0):(Te.warn("Firebase not found or not initialized"),!1)}catch(l){return Te.error("Firebase validation error:",l),!1}},Wx=()=>({https:window.location.protocol==="https:",secureContext:window.isSecureContext,cookieSecure:document.cookie.includes("Secure"),localStorage:!!window.localStorage,sessionStorage:!!window.sessionStorage}),Z1=()=>{Q1(),X1(),Wx(),K1(),window.addEventListener("error",l=>{l.error&&l.error.name==="SecurityError"&&Te.error("Security error detected:",l.error)})},Lp=()=>{const l=[],t=Wx();return l.push({name:"HTTPS",status:t.https?"pass":"fail",details:t.https?"Site served over HTTPS":"Site not served over HTTPS"}),l.push({name:"Secure Context",status:t.secureContext?"pass":"fail",details:t.secureContext?"Running in secure context":"Not running in secure context"}),l.push({name:"Local Storage",status:t.localStorage?"pass":"fail",details:t.localStorage?"localStorage available":"localStorage not available"}),{timestamp:Date.now(),checks:l}},Vh=(l,t={})=>{const{minSwipeDistance:n=50,preventDefaultTouchmoveEvent:i=!1}=t,c=M.useRef(null),d=M.useRef(null),h=M.useRef(null),f=M.useRef(null);return{onTouchStart:b=>{c.current=b.touches[0].clientX,d.current=b.touches[0].clientY},onTouchMove:b=>{i&&b.preventDefault()},onTouchEnd:b=>{if(!c.current||!d.current)return;h.current=b.changedTouches[0].clientX,f.current=b.changedTouches[0].clientY;const w=c.current-h.current,C=d.current-f.current;Math.abs(w)>Math.abs(C)&&Math.abs(w)>n&&(w>0?l.onSwipeLeft?.():l.onSwipeRight?.()),c.current=null,d.current=null,h.current=null,f.current=null}}};function J1(l){return l._isRecurringInstance===!0}const Qx=({todoId:l,subTasks:t})=>{const{addSubTask:n,updateSubTask:i,deleteSubTask:c,toggleSubTask:d}=Ft(),[h,f]=M.useState(""),[m,p]=M.useState(!1),[x,b]=M.useState(null),w=R=>{R.preventDefault(),h.trim()&&(n(l,h.trim()),f(""),p(!1))},C=R=>{b({id:R.id,title:R.title})},T=()=>{!x||!x.title.trim()||(i(l,x.id,{title:x.title.trim()}),b(null))},z=()=>{b(null)},W=R=>{confirm("   ?")&&c(l,R)},k=(R,D)=>{R.key==="Enter"?(R.preventDefault(),D==="add"?w(R):T()):R.key==="Escape"&&(D==="add"?(p(!1),f("")):z())};return r.jsxs("div",{className:"mt-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["  (",t.length,")"]}),!m&&r.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-1 px-2 py-1 text-xs text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",children:[r.jsx(Bt,{className:"w-3 h-3"}),""]})]}),r.jsxs("div",{className:"space-y-2",children:[t.map(R=>r.jsx("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg group",children:x?.id===R.id?r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"checkbox",checked:R.completed,onChange:()=>d(l,R.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),r.jsx("input",{type:"text",value:x.title,onChange:D=>b({...x,title:D.target.value}),onKeyDown:D=>k(D,"edit"),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-600 dark:text-white",placeholder:"  ",autoFocus:!0}),r.jsx("button",{onClick:T,className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded",title:"",children:r.jsx(jo,{className:"w-3 h-3"})}),r.jsx("button",{onClick:z,className:"p-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded",title:"",children:r.jsx(ct,{className:"w-3 h-3"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"checkbox",checked:R.completed,onChange:()=>d(l,R.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("span",{className:`text-sm ${R.completed?"line-through text-gray-500":"text-gray-700 dark:text-gray-300"}`,children:R.title}),R.completed&&R.completedAt&&R.completedAt!==null&&r.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[": ",(()=>{try{const D=new Date(R.completedAt);return isNaN(D.getTime())?(console.warn("Invalid Date detected for subtask:",R.id,R.completedAt)," "):D.toLocaleString("ko-KR")}catch(D){return console.error("Date parsing error:",D,R.completedAt)," "}})()]})]}),r.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[r.jsx("button",{onClick:()=>C(R),className:"p-1 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded",title:"",children:r.jsx(Bp,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>W(R.id),className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",title:"",children:r.jsx(ct,{className:"w-3 h-3"})})]})]})},R.id)),m&&r.jsxs("form",{onSubmit:w,className:"flex items-center gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[r.jsx("input",{type:"text",value:h,onChange:R=>f(R.target.value),onKeyDown:R=>k(R,"add"),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-600 dark:text-white",placeholder:"   ",autoFocus:!0}),r.jsx("button",{type:"submit",className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded",title:"",children:r.jsx(jo,{className:"w-3 h-3"})}),r.jsx("button",{type:"button",onClick:()=>{p(!1),f("")},className:"p-1 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded",title:"",children:r.jsx(ct,{className:"w-3 h-3"})})]}),t.length===0&&!m&&r.jsx("div",{className:"text-center py-4 text-sm text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700/30 rounded-lg border-2 border-dashed border-gray-200 dark:border-gray-600",children:"  "})]})]})},lc="pomodoroSessions",Yl="pomodoroStatsCache";function Iu(l){const t=va(),n={...l,id:`pomodoro_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};return t.push(n),localStorage.setItem(lc,JSON.stringify(t)),localStorage.removeItem(Yl),n}function va(){try{const l=localStorage.getItem(lc);return l?JSON.parse(l).map(n=>({...n,startTime:new Date(n.startTime),endTime:new Date(n.endTime)})):[]}catch(l){return console.error("   :",l),[]}}function Xx(l){const t=va(),n=ht(l,"yyyy-MM-dd");return t.filter(i=>i.date===n)}function eT(){const l=new Date,n=Xx(l).filter(c=>c.phase==="work"),i=n.filter(c=>c.completed);return{date:ht(l,"yyyy-MM-dd"),sessions:n.length,completedSessions:i.length,focusTime:i.reduce((c,d)=>c+d.duration,0),completionRate:n.length>0?i.length/n.length*100:0}}function tT(){const t=ch(new Date,{weekStartsOn:0}),c=va().filter(f=>uk(f.startTime,{weekStartsOn:0})).filter(f=>f.phase==="work"),d=c.filter(f=>f.completed),h=[];for(let f=0;f<7;f++){const m=new Date(t);m.setDate(m.getDate()+f);const x=Xx(m).filter(w=>w.phase==="work"),b=x.filter(w=>w.completed);h.push({date:ht(m,"yyyy-MM-dd"),sessions:x.length,completedSessions:b.length,focusTime:b.reduce((w,C)=>w+C.duration,0),completionRate:x.length>0?b.length/x.length*100:0})}return{weekStart:ht(t,"yyyy-MM-dd"),totalSessions:c.length,completedSessions:d.length,totalFocusTime:d.reduce((f,m)=>f+m.duration,0),completionRate:c.length>0?d.length/c.length*100:0,dailyBreakdown:h}}function sT(){const t=cy(new Date),n=va(),c=n.filter(f=>hk(f.startTime)).filter(f=>f.phase==="work"),d=c.filter(f=>f.completed),h=[];for(let f=0;f<4;f++){const m=new Date(t);m.setDate(m.getDate()+f*7);const p=new Date(m);p.setDate(p.getDate()+6);const b=n.filter(C=>{const T=new Date(C.startTime);return T>=m&&T<=p}).filter(C=>C.phase==="work"),w=b.filter(C=>C.completed);h.push({weekStart:ht(m,"yyyy-MM-dd"),totalSessions:b.length,completedSessions:w.length,totalFocusTime:w.reduce((C,T)=>C+T.duration,0),completionRate:b.length>0?w.length/b.length*100:0,dailyBreakdown:[]})}return{monthStart:ht(t,"yyyy-MM-dd"),totalSessions:c.length,completedSessions:d.length,totalFocusTime:d.reduce((f,m)=>f+m.duration,0),completionRate:c.length>0?d.length/c.length*100:0,weeklyBreakdown:h}}function nT(){const n=va().filter(f=>f.phase==="work").reduce((f,m)=>{const p=m.date;return f[p]||(f[p]=[]),f[p].push(m),f},{}),i=Object.keys(n).sort().reverse().map(f=>{const p=n[f].filter(x=>x.completed);return{date:f,hasCompletedSession:p.length>0}});let c=0;for(const f of i)if(f.hasCompletedSession)c++;else break;let d=0,h=0;for(const f of i.reverse())f.hasCompletedSession?(h++,d=Math.max(d,h)):h=0;return{current:c,longest:d}}function Kx(){try{const C=localStorage.getItem(Yl);if(C){const{data:T,timestamp:z}=JSON.parse(C);if(Date.now()-z<600*1e3)return T}}catch{}const l=va(),t=l.filter(C=>C.phase==="work"),n=t.filter(C=>C.completed),i=n.reduce((C,T)=>C+T.duration,0),c=t.length>0?n.length/t.length*100:0,d=nT(),h=eT(),f=tT(),m=sT(),p=new Date;p.setDate(p.getDate()-30);const b=t.filter(C=>C.startTime>=p).length/30,w={totalSessions:t.length,completedSessions:n.length,totalFocusTime:i,completionRate:c,currentStreak:d.current,longestStreak:d.longest,averageSessionsPerDay:b,todayStats:h,weekStats:f,monthStats:m,recentSessions:l.slice(-20)};try{localStorage.setItem(Yl,JSON.stringify({data:w,timestamp:Date.now()}))}catch(C){console.warn("   :",C)}return w}function Nl(l){const t=Math.floor(l/3600),n=Math.floor(l%3600/60);return t>0?`${t} ${n}`:`${n}`}function aT(){const l=va(),t=Kx();return JSON.stringify({exportDate:new Date().toISOString(),sessions:l,stats:t},null,2)}function rT(l){try{const t=JSON.parse(l);return t.sessions&&Array.isArray(t.sessions)?(localStorage.setItem(lc,JSON.stringify(t.sessions)),localStorage.removeItem(Yl),!0):!1}catch(t){return console.error("   :",t),!1}}function lT(){localStorage.removeItem(lc),localStorage.removeItem(Yl)}const iT=({isOpen:l,onClose:t})=>{const[n,i]=M.useState(null),[c,d]=M.useState("overview"),[h,f]=M.useState(!0);M.useEffect(()=>{l&&m()},[l]);const m=async()=>{f(!0);try{const w=Kx();i(w)}catch{}finally{f(!1)}},p=()=>{try{const w=aT(),C=new Blob([w],{type:"application/json"}),T=URL.createObjectURL(C),z=document.createElement("a");z.href=T,z.download=`pomodoro-stats-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(T)}catch{alert("  .")}},x=w=>{const C=w.target.files?.[0];if(!C)return;const T=new FileReader;T.onload=z=>{try{const W=z.target?.result;rT(W)?(alert("  ."),m()):alert("  .")}catch{alert("  .")}},T.readAsText(C),w.target.value=""},b=()=>{confirm("   ?     .")&&(lT(),alert(" ."),m())};return l?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[r.jsx(Lu,{className:"w-5 h-5"})," "]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:p,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:" ",children:r.jsx(th,{className:"w-4 h-4"})}),r.jsxs("label",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg cursor-pointer",title:" ",children:[r.jsx(sh,{className:"w-4 h-4"}),r.jsx("input",{type:"file",accept:".json",onChange:x,className:"hidden"})]}),r.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-red-500",title:" ",children:r.jsx(os,{className:"w-4 h-4"})}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:""})]})]}),r.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:r.jsx("nav",{className:"flex space-x-8 px-4",children:[{id:"overview",label:"",icon:Hu},{id:"daily",label:"",icon:lt},{id:"weekly",label:"",icon:Im},{id:"monthly",label:"",icon:Lu}].map(w=>{const C=w.icon;return r.jsx("button",{onClick:()=>d(w.id),className:`py-3 px-1 border-b-2 font-medium text-sm ${c===w.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(C,{className:"w-4 h-4"}),w.label]})},w.id)})})}),r.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:h?r.jsx("div",{className:"flex items-center justify-center h-32",children:r.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"  ..."})}):n?r.jsxs(r.Fragment,{children:[c==="overview"&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-blue-100",children:" "}),r.jsx("p",{className:"text-2xl font-bold",children:n.totalSessions})]}),r.jsx(Hu,{className:"w-8 h-8 text-blue-200"})]})}),r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-green-100",children:" "}),r.jsx("p",{className:"text-2xl font-bold",children:n.completedSessions})]}),r.jsx(is,{className:"w-8 h-8 text-green-200"})]})}),r.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-lg text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-purple-100",children:"  "}),r.jsx("p",{className:"text-2xl font-bold",children:Nl(n.totalFocusTime)})]}),r.jsx(Im,{className:"w-8 h-8 text-purple-200"})]})}),r.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-lg text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-orange-100",children:" "}),r.jsxs("p",{className:"text-2xl font-bold",children:[n.currentStreak,""]})]}),r.jsx(pw,{className:"w-8 h-8 text-orange-200"})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:" "}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),r.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[n.completionRate.toFixed(1),"%"]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:" "}),r.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[n.longestStreak,""]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:" "}),r.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[n.averageSessionsPerDay.toFixed(1),""]})]})]})]}),r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-3",children:" "}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:" "}),r.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[n.todayStats.completedSessions,""]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:" "}),r.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:Nl(n.todayStats.focusTime)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),r.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[n.todayStats.completionRate.toFixed(1),"%"]})]})]})]})]})]}),c==="daily"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"  "}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:n.todayStats.sessions}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:n.todayStats.completedSessions}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:Nl(n.todayStats.focusTime)}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[n.todayStats.completionRate.toFixed(1),"%"]}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:""})]})]})})]}),c==="weekly"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"  "}),r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:n.weekStats.totalSessions}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:n.weekStats.completedSessions}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:Nl(n.weekStats.totalFocusTime)}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[n.weekStats.completionRate.toFixed(1),"%"]}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:""})]})]}),r.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:" "}),r.jsx("div",{className:"grid grid-cols-7 gap-2",children:["","","","","","",""].map((w,C)=>r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:w}),r.jsxs("div",{className:`h-16 rounded flex flex-col items-center justify-center text-xs ${n.weekStats.dailyBreakdown[C]?.completedSessions>0?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-400"}`,children:[r.jsx("div",{className:"font-bold",children:n.weekStats.dailyBreakdown[C]?.completedSessions||0}),r.jsx("div",{children:""})]})]},w))})]})]}),c==="monthly"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"  "}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:n.monthStats.totalSessions}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:n.monthStats.completedSessions}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:Nl(n.monthStats.totalFocusTime)}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[n.monthStats.completionRate.toFixed(1),"%"]}),r.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:""})]})]})})]})]}):r.jsx("div",{className:"flex items-center justify-center h-32",children:r.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"  ."})})})]})}):null},oT={workTime:25,shortBreak:5,longBreak:15,longBreakInterval:4,autoStartBreaks:!1,autoStartPomodoros:!1,soundEnabled:!0},cT=({isOpen:l,onClose:t,todoTitle:n,todoId:i})=>{const[c,d]=M.useState(oT),[h,f]=M.useState(!1),[m,p]=M.useState("work"),[x,b]=M.useState(c.workTime*60),[w,C]=M.useState(0),[T,z]=M.useState(!1),[W,k]=M.useState(!1),[R,D]=M.useState(null),E=M.useRef(null),O=M.useRef(null);M.useEffect(()=>{const F=localStorage.getItem("pomodoroSettings");if(F){const ee=JSON.parse(F);d(ee),b(ee.workTime*60)}return O.current=new Audio,O.current.src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmoxBSuBzvLZiTYIG2m68OScTwwOUarm7bhqIgU6k9n1vVMvAC6Ew/PfkjUIF2O39uahUxMKRqnh8Mh+Kggp",()=>{E.current&&clearInterval(E.current)}},[]),M.useEffect(()=>(h&&x>0?E.current=setInterval(()=>{b(F=>F<=1?(P(),0):F-1)},1e3):E.current&&(clearInterval(E.current),E.current=null),()=>{E.current&&clearInterval(E.current)}),[h,x]);const P=()=>{if(f(!1),R){const F=new Date,ee=R,ce=Math.floor((F.getTime()-ee.getTime())/1e3);try{Iu({todoId:i||void 0,todoTitle:n||void 0,startTime:ee,endTime:F,duration:ce,phase:m,completed:!0,date:ht(ee,"yyyy-MM-dd")})}catch(I){console.error("   :",I)}}if(c.soundEnabled&&O.current&&O.current.play().catch(()=>{}),"Notification"in window&&Notification.permission==="granted"){const F={work:" !  .",shortBreak:"  .  !",longBreak:"  .   !"};new Notification(" ",{body:F[m],icon:"/favicon.ico"})}m==="work"?(C(ee=>ee+1),(w+1)%c.longBreakInterval===0?(p("longBreak"),b(c.longBreak*60)):(p("shortBreak"),b(c.shortBreak*60)),c.autoStartBreaks?(f(!0),D(new Date)):D(null)):(p("work"),b(c.workTime*60),c.autoStartPomodoros?(f(!0),D(new Date)):D(null))},$=()=>{if(!h)f(!0),D(new Date);else if(f(!1),R){const F=new Date,ee=R,ce=Math.floor((F.getTime()-ee.getTime())/1e3);try{Iu({todoId:i||void 0,todoTitle:n||void 0,startTime:ee,endTime:F,duration:ce,phase:m,completed:!1,date:ht(ee,"yyyy-MM-dd")})}catch(I){console.error("   :",I)}D(null)}},J=()=>{if(h&&R){const F=new Date,ee=R,ce=Math.floor((F.getTime()-ee.getTime())/1e3);try{Iu({todoId:i||void 0,todoTitle:n||void 0,startTime:ee,endTime:F,duration:ce,phase:m,completed:!1,date:ht(ee,"yyyy-MM-dd")})}catch(I){console.error("   :",I)}}f(!1),p("work"),b(c.workTime*60),C(0),D(null)},ae=()=>{P()},me=F=>{const ee=Math.floor(F/60),ce=F%60;return`${ee.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`},ke=()=>{switch(m){case"work":return{name:" ",color:"text-red-600",bgColor:"bg-red-50",icon:Hu};case"shortBreak":return{name:" ",color:"text-green-600",bgColor:"bg-green-50",icon:xu};case"longBreak":return{name:" ",color:"text-blue-600",bgColor:"bg-blue-50",icon:xu}}},ye=F=>{const ee={...c,...F};d(ee),localStorage.setItem("pomodoroSettings",JSON.stringify(ee)),h||b(m==="work"?ee.workTime*60:m==="shortBreak"?ee.shortBreak*60:ee.longBreak*60)};if(!l)return null;const fe=ke(),Re=fe.icon,Ue=m==="work"?(c.workTime*60-x)/(c.workTime*60)*100:m==="shortBreak"?(c.shortBreak*60-x)/(c.shortBreak*60)*100:(c.longBreak*60-x)/(c.longBreak*60)*100;return r.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:" "}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>k(!0),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:" ",children:r.jsx(Lu,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>z(!T),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"",children:r.jsx(Fp,{className:"w-4 h-4"})}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(ct,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"p-6",children:[n&&r.jsxs("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:" "}),r.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n})]}),T&&r.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg space-y-4",children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:""}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"  ()"}),r.jsx("input",{type:"number",value:c.workTime,onChange:F=>ye({workTime:parseInt(F.target.value)||25}),className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",min:"1",max:"60"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"  ()"}),r.jsx("input",{type:"number",value:c.shortBreak,onChange:F=>ye({shortBreak:parseInt(F.target.value)||5}),className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",min:"1",max:"30"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"  ()"}),r.jsx("input",{type:"number",value:c.longBreak,onChange:F=>ye({longBreak:parseInt(F.target.value)||15}),className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",min:"1",max:"60"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:"  "}),r.jsx("input",{type:"number",value:c.longBreakInterval,onChange:F=>ye({longBreakInterval:parseInt(F.target.value)||4}),className:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",min:"2",max:"10"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:c.autoStartBreaks,onChange:F=>ye({autoStartBreaks:F.target.checked}),className:"mr-2"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"  "})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:c.autoStartPomodoros,onChange:F=>ye({autoStartPomodoros:F.target.checked}),className:"mr-2"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"   "})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:c.soundEnabled,onChange:F=>ye({soundEnabled:F.target.checked}),className:"mr-2"}),r.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-center gap-1",children:[c.soundEnabled?r.jsx(yw,{className:"w-4 h-4"}):r.jsx(xw,{className:"w-4 h-4"}),""]})]})]})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${fe.bgColor} ${fe.color} mb-4`,children:[r.jsx(Re,{className:"w-4 h-4"}),fe.name]}),r.jsxs("div",{className:"relative w-48 h-48 mx-auto mb-6",children:[r.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[r.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:"currentColor",strokeWidth:"2",fill:"none",className:"text-gray-200 dark:text-gray-700"}),r.jsx("circle",{cx:"50",cy:"50",r:"45",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeDasharray:`${2*Math.PI*45}`,strokeDashoffset:`${2*Math.PI*45*(1-Ue/100)}`,className:`${fe.color} transition-all duration-1000 ease-linear`,strokeLinecap:"round"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-3xl font-mono font-bold text-gray-900 dark:text-white",children:me(x)}),r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[w," "]})]})})]}),r.jsxs("div",{className:"flex items-center justify-center gap-4",children:[r.jsx("button",{onClick:J,className:"p-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-full transition-colors",title:"",children:r.jsx(Vp,{className:"w-5 h-5"})}),r.jsx("button",{onClick:$,className:`p-4 rounded-full transition-colors ${h?"bg-red-500 hover:bg-red-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,children:h?r.jsx($u,{className:"w-6 h-6"}):r.jsx(zu,{className:"w-6 h-6"})}),r.jsx("button",{onClick:ae,className:"p-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-full transition-colors",title:"",children:r.jsx(xu,{className:"w-5 h-5"})})]})]})]})]}),r.jsx(iT,{isOpen:W,onClose:()=>k(!1)})]})};var dT=Qp();const Yh=({isOpen:l,onClose:t,todo:n,isMobile:i=!1})=>{const{updateTodo:c,updateRecurringTemplate:d}=Ft(),[h,f]=M.useState({title:"",description:"",priority:"medium",type:"simple",startDate:"",startTime:"",dueDate:"",dueTime:"",showStartTime:!1,showDueTime:!1,recurrence:"none",recurrenceDay:1,recurrenceDate:1,project:"shortterm",tags:[],exceptions:[]}),[m,p]=M.useState({}),[x,b]=M.useState(!1);M.useEffect(()=>{if(n&&l){const E=n.id.startsWith("recurring_");b(E),f({title:n.title.replace(" ",""),description:n.description||"",priority:n.priority,type:n.type,startDate:n.startDate?new Date(n.startDate).toISOString().split("T")[0]:"",startTime:n.startTime||"",dueDate:n.dueDate?new Date(n.dueDate).toISOString().split("T")[0]:"",dueTime:n.dueDate?new Date(n.dueDate).toTimeString().split(" ")[0].substring(0,5):n.dueTime||"",showStartTime:n.showStartTime||!1,showDueTime:n.showDueTime||!1,recurrence:n.recurrence||"none",recurrenceDay:n.recurrenceDay||1,recurrenceDate:n.recurrenceDate||1,project:n.project||"shortterm",tags:n.tags||[],exceptions:[]})}},[n,l]);const w=()=>{const E={};if(h.title.trim()||(E.title="  ."),h.startDate&&h.dueDate)try{const O=new Date(`${h.startDate}T${h.startTime||"00:00"}`),P=new Date(`${h.dueDate}T${h.dueTime||"23:59"}`);O>=P&&(E.startDate="   ")}catch(O){console.error("  :",O),E.general="  "}return p(E),Object.keys(E).length===0},C=async E=>{if(E.preventDefault(),!(!w()||!n))try{if(x){const O=n._templateId;O&&d(O,{title:h.title,description:h.description,priority:h.priority,type:h.type,tags:h.tags,exceptions:h.exceptions})}else{const O={title:h.title.trim(),description:h.description.trim()||"",priority:h.priority,type:h.type,tags:h.tags};if(h.startDate)try{O.startDate=new Date(h.startDate),console.log(":  :",O.startDate)}catch(P){throw console.error(":   :",P),new Error("   ")}if(h.startTime&&(O.startTime=h.startTime,console.log(":   :",O.startTime)),O.showStartTime=h.showStartTime,O.showDueTime=h.showDueTime,h.dueDate)try{const P=h.dueDate,$=h.dueTime||"23:59",J=`${P}T${$}:00`;O.dueDate=new Date(J),console.log(`:  : ${P} ${$} `,O.dueDate),h.dueTime&&console.log(":  dueDate :",h.dueTime)}catch(P){throw console.error(":   :",P),new Error(`   : ${h.dueDate} ${h.dueTime||""}`)}h.type==="project"&&(O.project=h.project),await c(n.id,O)}t()}catch(O){console.error("  :",O),p({general:"    ."})}},T=(E,O)=>{f(P=>({...P,[E]:O})),m[E]&&p(P=>({...P,[E]:""}))},z=()=>{f(E=>({...E,exceptions:[...E.exceptions,{type:"date",values:[]}]}))},W=E=>{f(O=>({...O,exceptions:O.exceptions.filter((P,$)=>$!==E)}))},k=(E,O,P)=>{f($=>({...$,exceptions:$.exceptions.map((J,ae)=>ae===E?{...J,[O]:P}:J)}))},R=(E,O)=>{f(P=>({...P,exceptions:P.exceptions.map(($,J)=>J===E?{...$,values:O}:$)}))};if(!l||!n)return null;const D=[{value:1,label:""},{value:2,label:""},{value:3,label:""},{value:4,label:""},{value:5,label:""},{value:6,label:""},{value:0,label:""}];return dT.createPortal(r.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-[9999] ${i?"":"flex items-center justify-center p-4"}`,children:r.jsxs("div",{className:`bg-white dark:bg-gray-800 shadow-xl overflow-y-auto ${i?"w-full h-full fixed inset-0":"w-full max-w-2xl max-h-[90vh] rounded-lg"}`,children:[r.jsxs("div",{className:`flex items-center justify-between border-b border-gray-200 dark:border-gray-700 ${i?"px-4 py-3":"p-6"}`,children:[r.jsxs("h2",{className:`font-semibold text-gray-900 dark:text-white ${i?"text-lg":"text-xl"}`,children:["  ",x?"( )":""]}),r.jsx("button",{onClick:t,className:`hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg ${i?"p-3":"p-2"}`,children:r.jsx(ct,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:C,className:`${i?"px-4 py-4":"p-6"}`,children:[r.jsxs("div",{className:`${i?"space-y-4":"space-y-6"}`,children:[m.general&&r.jsx("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:m.general}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Yp,{className:"w-4 h-4 inline mr-1"})," *"]}),r.jsx("input",{type:"text",value:h.title,onChange:E=>T("title",E.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white ${m.title?"border-red-500":"border-gray-300 dark:border-gray-600"}`,placeholder:" "}),m.title&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.title})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:""}),r.jsx("textarea",{value:h.description,onChange:E=>T("description",E.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"    "})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(qp,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),""]}),r.jsxs("select",{value:h.type,onChange:E=>T("type",E.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"simple",children:" "}),r.jsx("option",{value:"project",children:""})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(nh,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),""]}),r.jsxs("select",{value:h.priority,onChange:E=>T("priority",E.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"low",children:""}),r.jsx("option",{value:"medium",children:""}),r.jsx("option",{value:"high",children:""}),r.jsx("option",{value:"urgent",children:""})]})]})]}),h.type==="project"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:" "}),r.jsxs("div",{className:"flex space-x-4",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"shortterm",checked:h.project==="shortterm",onChange:E=>T("project",E.target.value),className:"mr-2"})," "]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"longterm",checked:h.project==="longterm",onChange:E=>T("project",E.target.value),className:"mr-2"})," "]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(lt,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"})," "]}),r.jsx("input",{type:"date",value:h.startDate,onChange:E=>T("startDate",E.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"})," "]}),r.jsx("input",{type:"time",value:h.startTime,onChange:E=>T("startTime",E.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(lt,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"})," "]}),r.jsx("input",{type:"date",value:h.dueDate,onChange:E=>T("dueDate",E.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(is,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"})," "]}),r.jsx("input",{type:"time",value:h.dueTime,onChange:E=>T("dueTime",E.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),r.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:h.showStartTime,onChange:E=>T("showStartTime",E.target.checked),className:"mr-2"}),r.jsx(is,{className:"w-4 h-4 inline mr-1"})," "]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:h.showDueTime,onChange:E=>T("showDueTime",E.target.checked),className:"mr-2"}),r.jsx(is,{className:"w-4 h-4 inline mr-1"})," "]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:""}),r.jsx("input",{type:"text",value:h.tags.join(", "),onChange:E=>T("tags",E.target.value.split(",").map(O=>O.trim()).filter(O=>O)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"    (: , , )"})]}),h.type==="project"&&n&&!x&&r.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:r.jsx(Qx,{todoId:n.id,subTasks:n.subTasks||[]})}),x&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.jsx(Go,{className:"w-4 h-4 inline mr-1"}),"  (  )"]}),r.jsxs("button",{type:"button",onClick:z,className:"flex items-center gap-1 px-2 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/30",children:[r.jsx(Bt,{className:"w-3 h-3"})," "]})]}),h.exceptions.map((E,O)=>r.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("select",{value:E.type,onChange:P=>k(O,"type",P.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"date",children:" "}),r.jsx("option",{value:"weekday",children:" "}),r.jsx("option",{value:"week",children:" "}),r.jsx("option",{value:"month",children:" "})]}),r.jsx("button",{type:"button",onClick:()=>W(O),className:"ml-2 p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[E.type==="date"&&Array.from({length:31},(P,$)=>$+1).map(P=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:E.values.includes(P),onChange:$=>{const J=E.values,ae=$.target.checked?[...J,P]:J.filter(me=>me!==P);R(O,ae)},className:"text-sm"}),r.jsxs("span",{className:"text-xs",children:[P,""]})]},P)),E.type==="weekday"&&D.map(P=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:E.values.includes(P.value),onChange:$=>{const J=E.values,ae=$.target.checked?[...J,P.value]:J.filter(me=>me!==P.value);R(O,ae)},className:"text-sm"}),r.jsx("span",{className:"text-xs",children:P.label})]},P.value)),E.type==="week"&&[1,2,3,4,-1].map(P=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:E.values.includes(P),onChange:$=>{const J=E.values,ae=$.target.checked?[...J,P]:J.filter(me=>me!==P);R(O,ae)},className:"text-sm"}),r.jsx("span",{className:"text-xs",children:Ql(P)})]},P)),E.type==="month"&&Array.from({length:12},(P,$)=>$+1).map(P=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:E.values.includes(P),onChange:$=>{const J=E.values,ae=$.target.checked?[...J,P]:J.filter(me=>me!==P);R(O,ae)},className:"text-sm"}),r.jsxs("span",{className:"text-xs",children:[P,""]})]},P))]}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:E.values.length>0&&r.jsxs("span",{children:[" ",E.type==="date"?"":E.type==="weekday"?"":E.type==="week"?"":"",": ",E.values.join(", ")]})})]},O))]})]}),r.jsxs("div",{className:`flex justify-end space-x-3 ${i?"mt-6":"mt-8"}`,children:[r.jsx("button",{type:"button",onClick:t,className:`text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg ${i?"px-6 py-3":"px-4 py-2"}`,children:""}),r.jsxs("button",{type:"submit",className:`flex items-center gap-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 ${i?"px-6 py-3":"px-4 py-2"}`,children:[r.jsx(Bu,{className:"w-4 h-4"}),""]})]})]})]})}),document.body)},ql=M.memo(({todo:l})=>{const{toggleTodo:t,isYesterdayIncompleteTodo:n,deleteTodo:i}=Ft(),[c,d]=M.useState(!1),[h,f]=M.useState(!1),[m,p]=M.useState(!1),x=M.useMemo(()=>{const $=l.dueDate?Ak(l.dueDate,l.dueTime):!1,J=n(l),ae=l.type==="project"&&l.subTasks&&l.subTasks.length>0,me=ae?l.subTasks.filter(Re=>Re.completed).length:0,ke=ae?l.subTasks.length:0,ye=ae?me/ke*100:0,fe=J1(l);return{isTaskOverdue:$,isYesterdayTask:J,hasSubTasks:ae,completedSubTasks:me,totalSubTasks:ke,progress:ye,isRecurringInstance:fe}},[l,n]),{isTaskOverdue:b,isYesterdayTask:w,hasSubTasks:C,completedSubTasks:T,totalSubTasks:z,progress:W,isRecurringInstance:k}=x,R=M.useCallback($=>{const J=$.getFullYear(),ae=String($.getMonth()+1).padStart(2,"0"),me=String($.getDate()).padStart(2,"0");return`${J}.${ae}.${me}.`},[]),D=M.useCallback($=>{const J=R($),ae=$.toLocaleTimeString("ko-KR",{hour:"numeric",minute:"2-digit",hour12:!0});return`${J} ${ae}`},[R]),E=M.useCallback(()=>{t(l.id)},[l.id,t]),O=M.useCallback(()=>{confirm(`"${l.title}"  ?`)&&i(l.id)},[l.id,l.title,i]),P=M.useCallback(()=>{C&&d(!c)},[C,c]);return r.jsxs("div",{className:`
        group relative transition-all duration-300 ease-out
        ${l.completed?"glass-panel bg-gray-50/50 dark:bg-gray-800/30 opacity-75":"glass-card hover:scale-[1.01] hover:shadow-lg hover:bg-white/90 dark:hover:bg-gray-800/90"}
        ${b&&!l.completed?"border-l-4 border-l-red-500 bg-red-50/30 dark:bg-red-900/10":""}
        p-4 mb-3
      `,children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("button",{onClick:E,className:`
            flex-shrink-0 mt-0.5 transition-all duration-300
            ${l.completed?"scale-110":"hover:scale-110"}
          `,children:l.completed?r.jsx(To,{className:"w-5 h-5 text-green-500 dark:text-green-400 drop-shadow-sm"}):r.jsx(bw,{className:`w-5 h-5 ${b?"text-red-400":"text-gray-400"} hover:text-blue-500 transition-colors`})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"flex flex-col gap-1 min-w-0 flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[C&&r.jsx("button",{onClick:()=>d(!c),className:"flex-shrink-0 p-0.5 hover:bg-black/5 dark:hover:bg-white/10 rounded transition-colors",title:c?"  ":"  ",children:c?r.jsx(Gp,{className:"w-4 h-4 text-gray-500"}):r.jsx(xa,{className:"w-4 h-4 text-gray-500"})}),r.jsx("h3",{className:`
                    text-base font-medium truncate transition-all duration-300
                    ${l.completed?"line-through text-gray-500 dark:text-gray-500":"text-gray-900 dark:text-white"}
                    ${C?"cursor-pointer hover:text-blue-600 dark:hover:text-blue-400":""}
                  `,onDoubleClick:P,title:C?"   /":"",children:l.title})]}),r.jsxs("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:[r.jsx("span",{className:`px-2 py-0.5 text-[10px] font-medium rounded-full border ${Rk(l.priority)} shadow-sm`,children:Ok(l.priority)}),w&&r.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 rounded-full border border-orange-200 dark:border-orange-800",children:" "}),l.type==="project"&&r.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 rounded-full border border-indigo-200 dark:border-indigo-800",children:l.project==="longterm"?" ":" "}),C&&r.jsxs("span",{className:"px-2 py-0.5 text-[10px] font-medium bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-300 rounded-full border border-gray-200 dark:border-gray-700",children:[T,"/",z," "]}),k&&r.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 text-[10px] font-medium bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 rounded-full border border-blue-100 dark:border-blue-800",children:[r.jsx(Pp,{className:"w-3 h-3"}),""]})]})]}),r.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[r.jsx("button",{onClick:()=>p(!0),className:"p-1.5 hover:bg-blue-50 dark:hover:bg-blue-900/30 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded-lg transition-colors",title:" ",children:r.jsx(So,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>f(!0),className:"p-1.5 hover:bg-purple-50 dark:hover:bg-purple-900/30 text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 rounded-lg transition-colors",title:"  ",disabled:l.completed,children:r.jsx(vw,{className:"w-4 h-4"})}),r.jsx("button",{onClick:O,className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 text-gray-400 hover:text-red-600 dark:hover:text-red-400 rounded-lg transition-colors",title:" ",children:r.jsx(os,{className:"w-4 h-4"})})]})]}),l.description&&r.jsx("p",{className:`text-sm mt-2 line-clamp-2 ${l.completed?"text-gray-400":"text-gray-600 dark:text-gray-300"}`,children:l.description}),C&&r.jsx("div",{className:"mt-3",children:r.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden",children:r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-500 h-1.5 rounded-full transition-all duration-500 ease-out",style:{width:`${W}%`}})})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3 text-xs text-gray-500 dark:text-gray-400",children:[(l.startDate||l.dueDate)&&r.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 dark:bg-gray-800/50 px-2 py-1 rounded-md",children:[l.startDate&&r.jsxs("div",{className:"flex items-center gap-1 text-blue-600 dark:text-blue-400",children:[r.jsx(ww,{className:"w-3 h-3"}),r.jsx("span",{children:R(l.startDate)}),l.startTime&&r.jsxs("span",{className:"text-gray-400",children:["(",l.startTime,")"]})]}),l.startDate&&l.dueDate&&r.jsx("span",{className:"text-gray-300",children:""}),l.dueDate&&r.jsxs("div",{className:`flex items-center gap-1 ${b&&!l.completed?"text-red-500 font-medium":"text-gray-600 dark:text-gray-400"}`,children:[r.jsx(kw,{className:"w-3 h-3"}),r.jsx("span",{children:R(l.dueDate)}),l.dueTime&&r.jsxs("span",{className:"text-gray-400",children:["(",l.dueTime,")"]}),b&&!l.completed&&r.jsx(ah,{className:"w-3 h-3 text-red-500"})]})]}),l.completed&&l.completedAt&&r.jsxs("div",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/10 px-2 py-1 rounded-md",children:[r.jsx(To,{className:"w-3 h-3"}),r.jsxs("span",{children:[": ",D(l.completedAt)]})]})]})]})]}),C&&c&&r.jsx("div",{className:"mt-4 pl-4 border-l-2 border-gray-100 dark:border-gray-700/50 animate-fade-in-up",children:r.jsx(Qx,{todoId:l.id,subTasks:l.subTasks})}),r.jsx(cT,{isOpen:h,onClose:()=>f(!1),todoTitle:l.title,todoId:l.id}),r.jsx(Yh,{isOpen:m,onClose:()=>p(!1),todo:l})]})});ql.displayName="TodoItem";const uT=({vacation:l,employee:t,compact:n=!1})=>{const i=c=>{switch(c){case"":return"bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800";case"":return"bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800";case"":return"bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-300 dark:border-purple-800";case"":return"bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800";case"":return"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800";case"":return"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600";default:return"bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600"}};return n?r.jsx("div",{className:`p-2 mb-1.5 rounded border ${i(l.type)}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[t&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-4 h-4 rounded-full flex items-center justify-center text-white text-xs font-semibold flex-shrink-0",style:{backgroundColor:t.color},children:t.name.charAt(0)}),r.jsx("span",{className:"text-xs font-medium truncate",children:t.name})]}),r.jsx("span",{className:"text-[8px] font-medium px-1 py-0.5 rounded",children:l.type})]})}):r.jsx("div",{className:`p-3 rounded-lg border ${i(l.type)}`,children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("div",{className:"flex items-center gap-2",children:t?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-semibold",style:{backgroundColor:t.color},children:t.name.charAt(0)}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:t.name}),r.jsx("div",{className:"text-xs opacity-75",children:t.team})]})]}):r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Gl,{className:"w-5 h-5"}),r.jsxs("span",{className:"font-medium",children:[" ID: ",l.employeeId]})]})}),r.jsx("span",{className:"text-sm font-medium px-2 py-1 rounded",children:l.type})]})})},Zx=M.memo(({currentView:l,searchTerm:t="",priorityFilter:n="all",typeFilter:i="all",projectFilter:c="all",tagFilter:d=[],completionDateFilter:h="all",selectedDate:f})=>{const{todos:m,getTodayTodos:p,getWeekTodos:x,getMonthTodos:b,reorderTodos:w}=Ft(),{currentUser:C}=vs(),{showVacationsInTodos:T,getVacationsForDate:z,employees:W}=Fh(),[k,R]=M.useState(null),[D,E]=M.useState(null),O=M.useMemo(()=>{let N=[];switch(l){case"today":N=p(f);break;case"week":N=x();break;case"month":N=b();break;default:N=m}const A=N.filter(_=>_.title.includes(""));return A.length>0&&console.log(` ${l} - :`,A.length,", priority:",A[0]?.priority),N},[l,f,p,x,b,m]),P=M.useMemo(()=>(A=>{const _=new Set,H=A.filter(U=>_.has(U.id)?(console.warn(`     : ${U.id}`),!1):(_.add(U.id),!0));if(H.length!==A.length){console.warn(`    : ${A.length}  ${H.length}`);const U=A.map(Z=>Z.id).filter((Z,le,ue)=>ue.indexOf(Z)!==le);console.warn(" ID:",[...new Set(U)])}return H.filter(U=>{if(t){const Z=t.toLowerCase(),le=U.title.toLowerCase().includes(Z),ue=U.description?.toLowerCase().includes(Z)||!1;if(!le&&!ue)return!1}return!(n!=="all"&&U.priority!==n||i!=="all"&&U.type!==i||c!=="all"&&U.type==="project"&&U.project!==c)})})(O),[O,t,n,i,c,d,h]),$=P.filter(N=>!N.completed),J=P.filter(N=>N.completed),ae=[];if(l==="today"){const N=f||new Date;N.setHours(0,0,0,0),P.forEach(A=>{A.subTasks&&A.subTasks.length>0&&A.subTasks.forEach(_=>{if(_.completed&&_.completedAt&&_.completedAt!==null)try{const H=new Date(_.completedAt);H.setHours(0,0,0,0),H.getTime()===N.getTime()&&ae.push({..._,type:"simple",recurrence:"none",isSubTask:!0,parentTitle:A.title,parentDescription:A.description,createdAt:_.createdAt,updatedAt:_.updatedAt})}catch{}})})}const me=[...J,...ae],ke=()=>l==="today"&&f?f:new Date,fe=Ln(C?.email)&&T?z(ke()):[],Re=(N,A)=>{console.log("  :",A,ce[A]?.title),R(A),N.dataTransfer.effectAllowed="move",N.dataTransfer.setData("text/plain",A.toString())},Ue=async(N,A)=>{if(N.preventDefault(),console.log("  :",k,"",A),console.log("  :",ce[k]?.title),console.log("  :",A,A<ce.length?`${ce[A]?.title} `:" "),k!==null){try{if(k!==A){let _=A;A>k&&(_=A-1,console.log(`  : dropIndex ${A}  ${_}`));const H=Array.from(ce),[U]=H.splice(k,1);H.splice(_,0,U),console.log("  :"),H.forEach((Z,le)=>{console.log(`  ${le}: ${Z.title}`)}),await w(k,_,ce),console.log("    ")}}catch(_){console.error("     :",_)}R(null),E(null)}},F=()=>{R(null),E(null)},ce=(N=>{const A={urgent:0,high:1,medium:2,low:3};return N.sort((H,U)=>{const Z=A[H.priority]-A[U.priority];if(Z!==0)return console.log(`  : ${H.title}(${H.priority}) vs ${U.title}(${U.priority})  ${Z}`),Z;const le=H.order,ue=U.order;return le!==void 0&&ue!==void 0&&le!==ue?(console.log(`    order : ${H.title}(${le}) vs ${U.title}(${ue})`),le-ue):le!==void 0&&ue===void 0?-1:le===void 0&&ue!==void 0?1:H.dueDate&&U.dueDate?new Date(H.dueDate).getTime()-new Date(U.dueDate).getTime():H.dueDate?-1:U.dueDate?1:new Date(U.createdAt).getTime()-new Date(H.createdAt).getTime()})})($),I=me.sort((N,A)=>{const _=H=>{if(H.isSubTask&&H.completedAt)try{return new Date(H.completedAt).getTime()}catch{return 0}if(H.completedAt)try{return new Date(H.completedAt).getTime()}catch{return new Date(H.updatedAt).getTime()}return new Date(H.updatedAt).getTime()};return _(A)-_(N)});return P.length===0&&fe.length===0?r.jsxs("div",{className:"card p-8 text-center text-gray-500 dark:text-gray-400",children:[r.jsx("p",{className:"text-lg mb-2",children:" "}),r.jsx("p",{children:"  !"})]}):r.jsxs("div",{className:"space-y-6 relative",children:[fe.length>0&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-purple-700 dark:text-purple-300 mb-4 flex items-center gap-2",children:[r.jsx(lt,{className:"w-5 h-5"}),"  (",fe.length,")"]}),r.jsx("div",{className:"space-y-2",children:fe.map(N=>{const A=W.find(_=>_.id===N.employeeId);return r.jsx(uT,{vacation:N,employee:A,compact:!0},N.id)})})]}),ce.length>0&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["   (",ce.length,")"]}),r.jsx("div",{className:"relative",onDragOver:N=>{if(N.preventDefault(),k===null)return;const A=N.currentTarget,_=A.getBoundingClientRect(),H=N.clientY-_.top,U=A.querySelectorAll("[data-todo-index]");let Z=U.length;console.log("  Y :",H," :",U.length,"  :",k);for(let le=0;le<U.length;le++){const ue=U[le].getBoundingClientRect(),be=ue.top-_.top,Oe=ue.bottom-_.top,Le=be+(Oe-be)/2;if(console.log(`  ${le}: top=${be.toFixed(1)}, mid=${Le.toFixed(1)}, bottom=${Oe.toFixed(1)}`),H<Le){Z=le,console.log(`  ${le}    : ${Z}`);break}}if(console.log(`   : ${Z} (draggedIndex: ${k})`),Z===k){console.log("    "),E(null);return}E(Z)},onDrop:N=>{N.preventDefault(),D!==null&&Ue(N,D)},style:{background:k!==null?"linear-gradient(to bottom, #dbeafe 0%, #dbeafe 100%)":"transparent"},children:ce.map((N,A)=>r.jsxs("div",{className:"relative",children:[k!==null&&D===A&&r.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-500 z-30"}),r.jsx("div",{"data-todo-index":A,draggable:!0,onDragStart:_=>Re(_,A),onDragEnd:F,className:`
                      cursor-grab active:cursor-grabbing transition-all duration-200 relative
                      ${k===A?"scale-105 shadow-lg z-20":""}
                      mb-1
                    `,children:r.jsx(ql,{todo:N})}),k!==null&&D===A+1&&A===ce.length-1&&r.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-blue-500 z-30"})]},N.id))})]}),I.length>0&&(l==="today"||l==="week"||l==="month")&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-green-700 dark:text-green-300 mb-4 flex items-center gap-2",children:[r.jsx(To,{className:"w-5 h-5"}),"  (",I.length,")"]}),r.jsx("div",{className:"space-y-2",children:I.map(N=>{if(N.isSubTask){const A=N,_=A.completedAt?new Date(A.completedAt):new Date(A.updatedAt);return r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(To,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200 line-through",children:N.title}),r.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded border",children:""})]}),r.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300",children:[r.jsx("span",{className:"font-medium",children:" :"})," ",A.parentTitle,A.parentDescription&&r.jsxs("span",{className:"ml-2 opacity-75",children:[" ",A.parentDescription]})]}),r.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[": ",_.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})]})]})]},`subtask-${N.id}`)}return r.jsx(ql,{todo:N},N.id)})})]})]})});Zx.displayName="TodoList";const hT=({isOpen:l,onClose:t,onSelectTemplate:n})=>{const{currentUser:i}=vs(),[c,d]=M.useState([]),[h,f]=M.useState(!1),[m,p]=M.useState(null),[x,b]=M.useState(!1),[w,C]=M.useState({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]});M.useEffect(()=>{if(!i?.uid)return;Te.log("   ",{uid:i.uid});const O=Ce.subscribeProjectTemplates(i.uid,P=>{Te.log("   ",{count:P.length}),d(P)});return()=>O()},[i?.uid]),M.useEffect(()=>{l||(p(null),f(!1),C({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}))},[l]);const T=async()=>{if(!(!w.name.trim()||!i?.uid)){b(!0);try{Te.log("  ",{template:w}),await Ce.addProjectTemplate(w,i.uid),C({name:"",description:"",category:"shortterm",subTasks:[],defaultPriority:"medium",tags:[]}),f(!1)}catch(O){Te.error("  :",O),alert("    .")}finally{b(!1)}}},z=async()=>{if(!(!m||!i?.uid)){b(!0);try{Te.log(" ",{template:m});const{id:O,createdAt:P,updatedAt:$,...J}=m;await Ce.updateProjectTemplate(O,J,i.uid),p(null)}catch(O){Te.error("  :",O),alert("    .")}finally{b(!1)}}},W=async O=>{if(!(!confirm("  ?")||!i?.uid)){b(!0);try{Te.log(" ",{templateId:O}),await Ce.deleteProjectTemplate(O,i.uid)}catch(P){Te.error("  :",P),alert("    .")}finally{b(!1)}}},k=async O=>{if(i?.uid){b(!0);try{const{id:P,createdAt:$,updatedAt:J,...ae}=O,me={...ae,name:`${O.name} ()`};Te.log(" ",{duplicated:me}),await Ce.addProjectTemplate(me,i.uid)}catch(P){Te.error("  :",P),alert("    .")}finally{b(!1)}}},R=(O,P)=>{const $={title:"",completed:!1,priority:"medium"};P({...O,subTasks:[...O.subTasks,$]})},D=(O,P,$,J)=>{const ae=O.subTasks.map((me,ke)=>ke===P?{...me,...$}:me);J({...O,subTasks:ae})},E=(O,P,$)=>{$({...O,subTasks:O.subTasks.filter((J,ae)=>ae!==P)})};return l?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"  "}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(ct,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[r.jsx("div",{className:"mb-6",children:r.jsxs("button",{onClick:()=>f(!0),className:"btn-primary flex items-center gap-2",children:[r.jsx(Bt,{className:"w-4 h-4"}),"  "]})}),h&&r.jsxs("div",{className:"mb-6 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[r.jsx("h3",{className:"text-lg font-medium mb-4",children:" "}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:" "}),r.jsx("input",{type:"text",value:w.name,onChange:O=>C({...w,name:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:": 7   "})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:""}),r.jsxs("select",{value:w.category,onChange:O=>C({...w,category:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"shortterm",children:" "}),r.jsx("option",{value:"longterm",children:" "})]})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:""}),r.jsx("textarea",{value:w.description,onChange:O=>C({...w,description:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:3,placeholder:" "})]}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("label",{className:"block text-sm font-medium",children:" "}),r.jsxs("button",{onClick:()=>R(w,C),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[r.jsx(Bt,{className:"w-3 h-3"})," "]})]}),r.jsx("div",{className:"space-y-2",children:w.subTasks.map((O,P)=>r.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[r.jsx("input",{type:"checkbox",checked:O.completed,onChange:$=>{const J=new Date;D(w,P,{completed:$.target.checked,completedAt:$.target.checked?J:null},C)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),r.jsx("input",{type:"text",value:O.title,onChange:$=>D(w,P,{title:$.target.value},C),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-1 focus:ring-blue-500 dark:bg-gray-600 dark:text-white",placeholder:""}),r.jsxs("select",{value:O.priority,onChange:$=>D(w,P,{priority:$.target.value},C),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",children:[r.jsx("option",{value:"low",children:""}),r.jsx("option",{value:"medium",children:""}),r.jsx("option",{value:"high",children:""}),r.jsx("option",{value:"urgent",children:""})]}),O.completed&&O.completedAt&&r.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[": ",new Date(O.completedAt).toLocaleString()]}),r.jsx("button",{onClick:()=>E(w,P,C),className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:r.jsx(ct,{className:"w-3 h-3"})})]},P))})]}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:""}),r.jsxs("button",{onClick:T,disabled:x,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[x?r.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx(Bu,{className:"w-4 h-4"}),x?" ...":""]})]})]}),m&&r.jsxs("div",{className:"mb-6 p-4 border border-blue-200 dark:border-blue-700 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[r.jsx("h3",{className:"text-lg font-medium mb-4 text-blue-800 dark:text-blue-200",children:" "}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:" "}),r.jsx("input",{type:"text",value:m.name,onChange:O=>p({...m,name:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:": 7   "})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:""}),r.jsxs("select",{value:m.category,onChange:O=>p({...m,category:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"shortterm",children:" "}),r.jsx("option",{value:"longterm",children:" "})]})]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:""}),r.jsx("textarea",{value:m.description,onChange:O=>p({...m,description:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:3,placeholder:" "})]}),r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("label",{className:"block text-sm font-medium",children:" "}),r.jsxs("button",{onClick:()=>R(m,p),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[r.jsx(Bt,{className:"w-3 h-3"})," "]})]}),r.jsx("div",{className:"space-y-2",children:m.subTasks.map((O,P)=>r.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[r.jsx("input",{type:"checkbox",checked:O.completed,onChange:$=>{const J=new Date;D(m,P,{completed:$.target.checked,completedAt:$.target.checked?J:null},p)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),r.jsx("input",{type:"text",value:O.title,onChange:$=>D(m,P,{title:$.target.value},p),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-1 focus:ring-blue-500 dark:bg-gray-600 dark:text-white",placeholder:""}),r.jsxs("select",{value:O.priority,onChange:$=>D(m,P,{priority:$.target.value},p),className:"px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-600 dark:text-white",children:[r.jsx("option",{value:"low",children:""}),r.jsx("option",{value:"medium",children:""}),r.jsx("option",{value:"high",children:""}),r.jsx("option",{value:"urgent",children:""})]}),O.completed&&O.completedAt&&r.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[": ",new Date(O.completedAt).toLocaleString()]}),r.jsx("button",{onClick:()=>E(m,P,p),className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:r.jsx(ct,{className:"w-3 h-3"})})]},P))})]}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:()=>p(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:""}),r.jsxs("button",{onClick:z,disabled:x,className:"btn-primary flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[x?r.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx(Bu,{className:"w-4 h-4"}),x?" ...":" "]})]})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(O=>r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:O.name}),r.jsx("span",{className:`text-xs px-2 py-1 rounded ${O.category==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-300":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:O.category==="longterm"?"":""})]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{onClick:()=>{p(O)},disabled:x,className:"p-1 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:r.jsx(Bp,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>k(O),disabled:x,className:"p-1 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:r.jsx(_w,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>W(O.id),disabled:x,className:"p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"",children:r.jsx(os,{className:"w-3 h-3"})})]})]}),O.description&&r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:O.description}),r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:[" : ",O.subTasks.length,""]}),n&&r.jsx("button",{onClick:()=>{n(O),t()},className:"w-full btn-secondary text-sm",children:"  "})]},O.id))}),c.length===0&&!h&&r.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[r.jsx("p",{children:"  ."}),r.jsx("p",{className:"text-sm",children:"    ."})]})]})]})}):null};class Hp{static timePatterns=[{pattern:/(\d{1,2}):(\d{2})/,type:"hhmm"},{pattern:/\s*(\d{1,2})\s*(\d{1,2})?/,type:"am_with_min"},{pattern:/\s*(\d{1,2})\s*(\d{1,2})?/,type:"pm_with_min"},{pattern:/\s*(\d{1,2})?/,type:"am"},{pattern:/\s*(\d{1,2})?/,type:"pm"},{pattern:/(\d{1,2})\s*(\d{1,2})/,type:"hour_min"},{pattern:/(\d{1,2})/,type:"hour_only"},{pattern:/\s*(\d{1,2})?/,type:"dawn"},{pattern:/\s*(\d{1,2})?/,type:"morning"},{pattern:/\s*(\d{1,2})?/,type:"lunch"},{pattern:/\s*/,type:"late_afternoon"},{pattern:/\s*(\d{1,2})?/,type:"evening"},{pattern:/\s*(\d{1,2})?/,type:"night"},{pattern:/\s*\s*/,type:"in_hour"},{pattern:/(\d+)\s*\s*/,type:"in_hours"},{pattern:/30\s*|\s*\s*/,type:"in_30min"},{pattern:/(\d+)\s*/,type:"in_minutes"}];static priorityPatterns=[{pattern:/|||urgent|asap|!!!/i,priority:"urgent"},{pattern:/||high||!!/i,priority:"high"},{pattern:/|medium||normal|!/i,priority:"medium"},{pattern:/|low||/i,priority:"low"}];static recurrencePatterns=[{pattern:/||daily|every\s*day/i,recurrence:"daily"},{pattern:/||weekly|every\s*week/i,recurrence:"weekly"},{pattern:/|||monthly|every\s*month/i,recurrence:"monthly"},{pattern:/||yearly|every\s*year/i,recurrence:"yearly"}];static weekdayPatterns=[{pattern:/?|monday/i,day:1},{pattern:/?|tuesday/i,day:2},{pattern:/?|wednesday/i,day:3},{pattern:/?|thursday/i,day:4},{pattern:/?|friday/i,day:5},{pattern:/?|saturday/i,day:6},{pattern:/?|sunday/i,day:7}];static tagPatterns=[/#([^\s#]+)/g,/@([^\s@]+)/g,/\[([^\]]+)\]/g];static projectPatterns=[/:\s*([^,\n]+)/i,/project:\s*([^,\n]+)/i,/:\s*([^,\n]+)/i];static parse(t){let n=t.trim();const i={title:""},c=this.extractTime(n);c.time&&c.isTimeSpecified&&(i.dueTime=c.time,n=c.cleanText);const d=this.extractDate(n);d.date&&(i.dueDate=d.date,n=d.cleanText,c.isTimeSpecified||(i.dueTime=void 0));const h=this.extractPriority(n);h.priority&&(i.priority=h.priority,n=h.cleanText);const f=this.extractRecurrence(n);if(f.recurrence&&(i.recurrence=f.recurrence,n=f.cleanText),i.recurrence==="weekly"){const x=this.extractWeekday(n);x.day&&(i.recurrenceDay=x.day,n=x.cleanText)}const m=this.extractTags(n);m.tags.length>0&&(i.tags=m.tags,n=m.cleanText);const p=this.extractProject(n);return p.project&&(i.project=p.project,n=p.cleanText),i.title=n.replace(/\s+/g," ").trim(),i}static extractTime(t){for(const n of this.timePatterns){const i=t.match(n.pattern);if(i){let c=0,d=0,h=!0;switch(n.type){case"hhmm":c=parseInt(i[1]),d=parseInt(i[2]);break;case"am_with_min":c=parseInt(i[1]),d=parseInt(i[2]),c===12&&(c=0);break;case"pm_with_min":c=parseInt(i[1]),d=parseInt(i[2]),c!==12&&(c+=12);break;case"am":c=parseInt(i[1]),d=0,c===12&&(c=0);break;case"pm":c=parseInt(i[1]),d=0,c!==12&&(c+=12);break;case"hour_min":c=parseInt(i[1]),d=parseInt(i[2]);break;case"hour_only":c=parseInt(i[1]),d=0;break;case"dawn":c=i[1]?parseInt(i[1]):5,d=0,c>6&&(c=5);break;case"morning":c=i[1]?parseInt(i[1]):8,d=0,(c>11||c<7)&&(c=8);break;case"lunch":c=i[1]?parseInt(i[1]):12,d=0,(c<12||c>14)&&(c=12);break;case"late_afternoon":c=17,d=0,h=!1;break;case"evening":c=i[1]?parseInt(i[1]):19,d=0,c<18&&(c+=12),c>21&&(c=19);break;case"night":c=i[1]?parseInt(i[1]):22,d=0,c<22&&(c+=12),c>23&&(c=22);break;case"in_hour":const m=new Date;m.setHours(m.getHours()+1),c=m.getHours(),d=m.getMinutes();break;case"in_hours":const p=parseInt(i[1]),x=new Date;x.setHours(x.getHours()+p),c=x.getHours(),d=x.getMinutes();break;case"in_30min":const b=new Date;b.setMinutes(b.getMinutes()+30),c=b.getHours(),d=b.getMinutes();break;case"in_minutes":const w=parseInt(i[1]),C=new Date;C.setMinutes(C.getMinutes()+w),c=C.getHours(),d=C.getMinutes();break}return(c<0||c>23)&&(c=9),(d<0||d>59)&&(d=0),{time:`${c.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`,cleanText:t.replace(i[0],"").trim(),isTimeSpecified:h}}}return{cleanText:t,isTimeSpecified:!1}}static extractDate(t){const n=new Date,i=[{pattern:/(\d{4})\s*(\d{1,2})\s*(\d{1,2})/,type:"yyyy_mm_dd"},{pattern:/(\d{1,2})\s*(\d{1,2})/,type:"mm_dd"},{pattern:/(\d{1,2})\/(\d{1,2})/,type:"mm_slash_dd"},{pattern:/(\d{4})-(\d{1,2})-(\d{1,2})/,type:"yyyy_dash_mm_dash_dd"},{pattern:/|today/i,type:"today"},{pattern:/|tomorrow/i,type:"tomorrow"},{pattern:/|day\s*after\s*tomorrow/i,type:"day_after_tomorrow"},{pattern:/|yesterday/i,type:"yesterday"},{pattern:/(\d+)\s*/,type:"days_later"},{pattern:/(\d+)\s*/,type:"weeks_later"},{pattern:/(\d+)\s*|(\d+)\s*/,type:"months_later"},{pattern:/\s*\s*|/,type:"this_weekend"},{pattern:/\s*\s*|\s*/,type:"next_weekend"},{pattern:/\s*/,type:"this_week"},{pattern:/\s*/,type:"next_week"},{pattern:/\s*\s*|/,type:"end_of_month"},{pattern:/\s*|\s*/,type:"next_month"},{pattern:/(\d{1,2})\s*/,type:"by_day"},{pattern:/\s*\s*(\d{1,2})/,type:"this_month_day"},{pattern:/\s*\s*(\d{1,2})/,type:"next_month_day"}];for(const d of i){const h=t.match(d.pattern);if(h){let f=null;switch(d.type){case"yyyy_mm_dd":f=new Date(parseInt(h[1]),parseInt(h[2])-1,parseInt(h[3]));break;case"mm_dd":f=new Date(n.getFullYear(),parseInt(h[1])-1,parseInt(h[2])),f<n&&f.setFullYear(n.getFullYear()+1);break;case"mm_slash_dd":f=new Date(n.getFullYear(),parseInt(h[1])-1,parseInt(h[2])),f<n&&f.setFullYear(n.getFullYear()+1);break;case"yyyy_dash_mm_dash_dd":f=new Date(parseInt(h[1]),parseInt(h[2])-1,parseInt(h[3]));break;case"today":f=new Date(n);break;case"tomorrow":f=Ls(n,1);break;case"day_after_tomorrow":f=Ls(n,2);break;case"yesterday":f=Ls(n,-1);break;case"days_later":f=Ls(n,parseInt(h[1]));break;case"weeks_later":f=dy(n,parseInt(h[1]));break;case"months_later":const m=parseInt(h[1])||parseInt(h[2]);f=new Date(n),f.setMonth(f.getMonth()+m);break;case"this_weekend":const p=6-n.getDay();f=Ls(n,p);break;case"next_weekend":const x=6-n.getDay()+7;f=Ls(n,x);break;case"this_week":const b=5-n.getDay();f=Ls(n,b>=0?b:b+7);break;case"next_week":const w=1-n.getDay()+7;f=Ls(n,w);break;case"end_of_month":f=new Date(n.getFullYear(),n.getMonth()+1,0);break;case"next_month":f=new Date(n.getFullYear(),n.getMonth()+1,1);break;case"by_day":const C=parseInt(h[1]);f=new Date(n.getFullYear(),n.getMonth(),C),f<n&&f.setMonth(f.getMonth()+1);break;case"this_month_day":f=new Date(n.getFullYear(),n.getMonth(),parseInt(h[1]));break;case"next_month_day":f=new Date(n.getFullYear(),n.getMonth()+1,parseInt(h[1]));break}if(f)return{date:f,cleanText:t.replace(h[0],"").trim()}}}const c=this.extractDayOfWeek(t);return c.date?c:{cleanText:t}}static extractDayOfWeek(t){const n=new Date,i=n.getDay(),c=[{patterns:["","","sunday","sun"],targetDay:0},{patterns:["","","monday","mon"],targetDay:1},{patterns:["","","tuesday","tue"],targetDay:2},{patterns:["","","wednesday","wed"],targetDay:3},{patterns:["","","thursday","thu"],targetDay:4},{patterns:["","","friday","fri"],targetDay:5},{patterns:["","","saturday","sat"],targetDay:6}],d=/\s*|next\s*week/i.test(t),h=/\s*|this\s*week/i.test(t);for(const{patterns:f,targetDay:m}of c)for(const p of f){const x=new RegExp(`\\b${p}\\b`,"i");if(x.test(t)){let b=m-i;return d?(b+=7,b<=0&&(b+=7)):h?b<0&&(b+=7):b<=0&&(b+=7),{date:Ls(n,b),cleanText:t.replace(x,"").replace(/\s*|\s*|next\s*week|this\s*week/gi,"").trim()}}}return{cleanText:t}}static extractPriority(t){for(const{pattern:n,priority:i}of this.priorityPatterns)if(n.test(t))return{priority:i,cleanText:t.replace(n,"").trim()};return{cleanText:t}}static extractRecurrence(t){for(const{pattern:n,recurrence:i}of this.recurrencePatterns)if(n.test(t))return{recurrence:i,cleanText:t.replace(n,"").trim()};return{cleanText:t}}static extractTags(t){const n=[];let i=t;for(const c of this.tagPatterns){const d=t.matchAll(c);for(const h of d)n.push(h[1]),i=i.replace(h[0],"").trim()}return{tags:n,cleanText:i}}static extractProject(t){for(const n of this.projectPatterns){const i=t.match(n);if(i)return{project:i[1].trim(),cleanText:t.replace(i[0],"").trim()}}return{cleanText:t}}static extractWeekday(t){for(const{pattern:n,day:i}of this.weekdayPatterns){const c=t.match(n);if(c)return{day:i,cleanText:t.replace(c[0],"").trim()}}return{cleanText:t}}static getExamples(){return["    2 30 ","    #","   7","    @","  4 15 ","    ","    []","    7","    6","  30 ","  2  ","  3  asap","    ","      []","  12/25  9","       # @","    : "]}}const gT=({isOpen:l,onClose:t})=>{const{addTodo:n,addRecurringTemplate:i,recurringTemplates:c}=Ft(),[d,h]=M.useState({title:"",description:"",priority:"medium",type:"simple",startDate:new Date().toISOString().split("T")[0],startTime:"",dueDate:"",dueTime:"",showStartTime:!1,showDueTime:!1,recurrence:"none",recurrenceDay:1,recurrenceDate:1,holidayHandling:"show",weeklyRecurrenceType:"every_week",monthlyRecurrenceType:"by_date",weekOfMonth:1,recurringEndDate:"",project:"shortterm",tags:[],exceptions:[]}),[f,m]=M.useState({}),[p,x]=M.useState(!1),[b,w]=M.useState(null),[C,T]=M.useState(""),[z,W]=M.useState(!1),[k,R]=M.useState(null),D=()=>({title:"",description:"",priority:"medium",type:"simple",startDate:new Date().toISOString().split("T")[0],startTime:"",dueDate:"",dueTime:"",showStartTime:!1,showDueTime:!1,recurrence:"none",recurrenceDay:1,recurrenceDate:1,holidayHandling:"show",weeklyRecurrenceType:"every_week",monthlyRecurrenceType:"by_date",weekOfMonth:1,recurringEndDate:"",project:"shortterm",tags:[],exceptions:[]}),E=()=>{h(D()),m({}),w(null),T(""),W(!1),R(null)};M.useEffect(()=>{l&&E()},[l]);const O=()=>{const N={};if(d.title.trim()||(N.title="  "),d.startDate&&d.dueDate){const A=new Date(`${d.startDate}T${d.startTime||"00:00"}`),_=new Date(`${d.dueDate}T${d.dueTime||"23:59"}`);A>=_&&(N.startDate="   ")}return d.dueDate&&d.dueTime&&new Date(`${d.dueDate}T${d.dueTime}`)<new Date&&(N.dueDate="    "),m(N),Object.keys(N).length===0},P=N=>{h({...d,title:N.name,description:N.description||"",type:"project",priority:N.defaultPriority,project:N.category}),w(N)},$=async N=>{if(N.preventDefault(),!O())return;const A={title:d.title.trim(),description:d.description.trim()||"",completed:!1,priority:d.priority,type:d.type,tags:d.tags||[],recurrence:d.recurrence||"none"};try{const _=d.startDate||new Date().toISOString().split("T")[0];A.startDate=new Date(_),console.log(" :",A.startDate,"(:",d.startDate,")")}catch(_){throw console.error("  :",_),new Error("   ")}if(d.startTime&&(A.startTime=d.startTime,console.log("  :",A.startTime)),A.showStartTime=d.showStartTime,A.showDueTime=d.showDueTime,d.dueDate)try{const _=d.dueDate,H=d.dueTime||"23:59",U=`${_}T${H}:00`;A.dueDate=new Date(U),console.log(` : ${_} ${H} `,A.dueDate),d.dueTime&&console.log(" dueDate :",d.dueTime)}catch(_){throw console.error("  :",_),new Error(`   : ${d.dueDate} ${d.dueTime||""}`)}if(d.recurrence&&d.recurrence!=="none"&&(A.recurrence=d.recurrence,d.recurrence==="weekly"?A.recurrenceDay=d.recurrenceDay:d.recurrence==="monthly"&&(A.recurrenceDate=d.recurrenceDate),A.holidayHandling=d.holidayHandling),d.type==="project"&&(A.project=d.project,b&&b.subTasks.length>0?A.subTasks=b.subTasks.map(_=>{const H={id:_o(),title:_.title,description:_.description||"",completed:!1,priority:_.priority,createdAt:new Date,updatedAt:new Date};return _.dueDate&&(H.dueDate=new Date(_.dueDate)),H}):A.subTasks=[]),b?.id&&(A.templateId=b.id),d.recurrence!=="none"){const _={title:A.title,description:A.description,priority:A.priority,type:A.type,recurrenceType:d.recurrence,isActive:!0,tags:A.tags||[],exceptions:d.exceptions,holidayHandling:d.holidayHandling};d.recurrence==="weekly"&&(_.weekday=d.recurrenceDay===7?0:d.recurrenceDay),d.recurrence==="monthly"&&(d.monthlyRecurrenceType==="by_date"?(_.monthlyPattern="date",_.monthlyDate=d.recurrenceDate):d.monthlyRecurrenceType==="by_weekday"&&(_.monthlyPattern="weekday",_.monthlyWeek=d.weekOfMonth===1?"first":d.weekOfMonth===2?"second":d.weekOfMonth===3?"third":d.weekOfMonth===4?"fourth":"last",_.monthlyWeekday=d.recurrenceDay===7?0:d.recurrenceDay)),console.log("Creating recurring template:",_);try{await i(_),console.log("   ")}catch(H){throw console.error("   :",H),H}}else{console.log("===    ==="),console.log("formData.startDate:",d.startDate),console.log("   :",A),console.log("  :",!!b),b&&(console.log(" :",b.name),console.log("   :",b.subTasks.length),console.log("todoData   :",A.subTasks?.length||0));try{console.log(" addTodo    todoData:",JSON.stringify(A,null,2)),console.log(" todoData.startDate :",typeof A.startDate),console.log(" todoData.startDate :",A.startDate),await n(A),console.log("   ")}catch(_){throw console.error("   :",_),_}}console.log("  :",b?`: ${b.name}`:" "),E(),t()},J=(N,A)=>{h(_=>({..._,[N]:A})),f[N]&&m(_=>({..._,[N]:""}))},ae=N=>{if(T(N),N.trim()){const A=Hp.parse(N);R(A),h(_=>({..._,title:A.title,startDate:A.startDate?A.startDate.toISOString().split("T")[0]:"",startTime:A.startTime||"",dueDate:A.dueDate?A.dueDate.toISOString().split("T")[0]:"",dueTime:A.dueTime||"",priority:A.priority||_.priority,recurrence:A.recurrence||"none",recurrenceDay:A.recurrenceDay||_.recurrenceDay,tags:A.tags||[]}))}else R(null)},me=()=>{k&&(h(N=>({...N,title:k.title,startDate:k.startDate?k.startDate.toISOString().split("T")[0]:"",startTime:k.startTime||"",dueDate:k.dueDate?k.dueDate.toISOString().split("T")[0]:"",dueTime:k.dueTime||"",priority:k.priority||N.priority,recurrence:k.recurrence||"none",recurrenceDay:k.recurrenceDay||N.recurrenceDay})),W(!1))},ke=()=>{W(!z),z&&C&&me()},ye=()=>{h(N=>({...N,exceptions:[...N.exceptions,{type:"date",values:[]}]}))},fe=N=>{h(A=>({...A,exceptions:A.exceptions.filter((_,H)=>H!==N)}))},Re=(N,A,_)=>{h(H=>({...H,exceptions:H.exceptions.map((U,Z)=>Z===N?{...U,[A]:_}:U)}))},Ue=(N,A)=>{h(_=>({..._,exceptions:_.exceptions.map((H,U)=>U===N?{...H,values:A}:H)}))},F=N=>{const _=d.exceptions[N].values||[],H={targetTemplateTitle:"",scope:"same_week"};Ue(N,[..._,H])},ee=(N,A)=>{const H=d.exceptions[N].values||[];Ue(N,H.filter((U,Z)=>Z!==A))},ce=(N,A,_,H)=>{const le=(d.exceptions[N].values||[]).map((ue,be)=>be===A?{...ue,[_]:H}:ue);Ue(N,le)};if(!l)return null;const I=[{value:1,label:""},{value:2,label:""},{value:3,label:""},{value:4,label:""},{value:5,label:""},{value:6,label:""},{value:0,label:""}];return r.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto","data-testid":"add-todo-modal",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"  "}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(ct,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:$,className:"p-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:" "}),r.jsxs("button",{type:"button",onClick:ke,className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${z?"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}`,children:[r.jsx(Um,{className:"w-4 h-4"}),z?" ":"  "]})]}),z?r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Um,{className:"w-4 h-4 inline mr-1"}),"  "]}),r.jsx("textarea",{value:C,onChange:N=>ae(N.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:`:     2 
   #
   7`}),k&&r.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[r.jsx("h4",{className:"text-sm font-medium text-blue-900 dark:text-blue-200 mb-2",children:" :"}),r.jsxs("div",{className:"space-y-1 text-sm",children:[r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.title]}),k.startDate&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.startDate.toLocaleDateString("ko-KR")]}),k.startTime&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.startTime]}),k.dueDate&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.dueDate.toLocaleDateString("ko-KR")]}),k.dueTime&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.dueTime]}),k.priority&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.priority]}),k.recurrence&&k.recurrence!=="none"&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.recurrence,k.recurrenceDay&&k.recurrence==="weekly"&&r.jsxs("span",{children:[" - ",["","","","","","","",""][k.recurrenceDay],""]})]}),k.tags&&k.tags.length>0&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",k.tags.join(", ")]})]}),r.jsx("button",{type:"button",onClick:me,className:"mt-2 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:"   "})]}),r.jsxs("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[r.jsx("strong",{children:":"})," ",Hp.getExamples().slice(0,2).join("  ")]})]}):r.jsx(r.Fragment,{children:r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"  *"}),r.jsx("input",{type:"text",value:d.title,onChange:N=>J("title",N.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:" "}),f.title&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.title})]})}),!z&&r.jsx(r.Fragment,{children:r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:""}),r.jsx("textarea",{value:d.description,onChange:N=>J("description",N.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"   "})]})}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(qp,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),""]}),r.jsxs("select",{value:d.type,onChange:N=>J("type",N.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"simple",children:" "}),r.jsx("option",{value:"project",children:""})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(nh,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),""]}),r.jsxs("select",{value:d.priority,onChange:N=>J("priority",N.target.value),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"low",children:""}),r.jsx("option",{value:"medium",children:""}),r.jsx("option",{value:"high",children:""}),r.jsx("option",{value:"urgent",children:""})]})]})]}),d.type==="project"&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:" "}),r.jsxs("button",{type:"button",onClick:()=>x(!0),className:"flex items-center gap-1 px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[r.jsx(Yp,{className:"w-4 h-4"})," "]})]}),b&&r.jsx("div",{className:"mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:[": ",b.name]}),r.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-300",children:[b.subTasks.length,"   "]})]}),r.jsx("button",{type:"button",onClick:()=>w(null),className:"text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-800 rounded p-1",children:r.jsx(ct,{className:"w-4 h-4"})})]})}),r.jsxs("div",{className:"flex space-x-4",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"shortterm",checked:d.project==="shortterm",onChange:N=>J("project",N.target.value),className:"mr-2"})," "]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"longterm",checked:d.project==="longterm",onChange:N=>J("project",N.target.value),className:"mr-2"})," "]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(lt,{className:"w-4 h-4 inline mr-1"}),""]}),r.jsx("input",{type:"date",value:d.startDate,onChange:N=>J("startDate",N.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),f.startDate&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.startDate})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(is,{className:"w-4 h-4 inline mr-1"}),""]}),r.jsx("input",{type:"time",value:d.startTime,onChange:N=>J("startTime",N.target.value),disabled:!d.startDate,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(lt,{className:"w-4 h-4 inline mr-1"}),""]}),r.jsx("input",{type:"date",value:d.dueDate,onChange:N=>J("dueDate",N.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),f.dueDate&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:f.dueDate})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(is,{className:"w-4 h-4 inline mr-1"}),""]}),r.jsx("input",{type:"time",value:d.dueTime,onChange:N=>J("dueTime",N.target.value),disabled:!d.dueDate,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white disabled:bg-gray-100 disabled:cursor-not-allowed"})]})]}),!z&&r.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:d.showStartTime,onChange:N=>J("showStartTime",N.target.checked),className:"mr-2"}),r.jsx(is,{className:"w-4 h-4 inline mr-1"})," "]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:d.showDueTime,onChange:N=>J("showDueTime",N.target.checked),className:"mr-2"}),r.jsx(is,{className:"w-4 h-4 inline mr-1"})," "]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Pp,{className:"w-4 h-4 inline mr-1"})," "]}),r.jsxs("select",{value:d.recurrence,onChange:N=>J("recurrence",N.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"none",children:" "}),r.jsx("option",{value:"daily",children:""}),r.jsx("option",{value:"weekly",children:""}),r.jsx("option",{value:"monthly",children:""}),r.jsx("option",{value:"yearly",children:""})]})]}),d.recurrence==="weekly"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:" "}),r.jsx("select",{value:d.recurrenceDay,onChange:N=>J("recurrenceDay",parseInt(N.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:I.map(N=>r.jsx("option",{value:N.value,children:N.label},N.value))})]}),d.recurrence==="monthly"&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:" "}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"by_date",checked:d.monthlyRecurrenceType==="by_date",onChange:N=>J("monthlyRecurrenceType",N.target.value),className:"mr-2"})," (  )"]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"by_weekday",checked:d.monthlyRecurrenceType==="by_weekday",onChange:N=>J("monthlyRecurrenceType",N.target.value),className:"mr-2"})," ( n   )"]})]})]}),d.monthlyRecurrenceType==="by_date"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:" "}),r.jsxs("select",{value:d.recurrenceDate,onChange:N=>J("recurrenceDate",parseInt(N.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[Array.from({length:31},(N,A)=>A+1).map(N=>r.jsxs("option",{value:N,children:[N,""]},N)),r.jsx("option",{value:-1,children:""}),r.jsx("option",{value:-2,children:"  "}),r.jsx("option",{value:-3,children:" "})]})]}),d.monthlyRecurrenceType==="by_weekday"&&r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:""}),r.jsxs("select",{value:d.weekOfMonth,onChange:N=>J("weekOfMonth",parseInt(N.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:1,children:" "}),r.jsx("option",{value:2,children:" "}),r.jsx("option",{value:3,children:" "}),r.jsx("option",{value:4,children:" "}),r.jsx("option",{value:-1,children:" "})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:""}),r.jsx("select",{value:d.recurrenceDay,onChange:N=>J("recurrenceDay",parseInt(N.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:I.map(N=>r.jsx("option",{value:N.value,children:N.label},N.value))})]})]})]}),d.recurrence!=="none"&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.jsx(Go,{className:"w-4 h-4 inline mr-1"}),"  (  )"]}),r.jsxs("button",{type:"button",onClick:ye,className:"flex items-center gap-1 px-2 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/30",children:[r.jsx(Bt,{className:"w-3 h-3"})," "]})]}),d.exceptions.map((N,A)=>r.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("select",{value:N.type,onChange:_=>Re(A,"type",_.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"date",children:" "}),r.jsx("option",{value:"weekday",children:" "}),r.jsx("option",{value:"week",children:" "}),r.jsx("option",{value:"month",children:" "}),r.jsx("option",{value:"conflict",children:"  "})]}),r.jsx("button",{type:"button",onClick:()=>fe(A),className:"ml-2 p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[N.type==="date"&&Array.from({length:31},(_,H)=>H+1).map(_=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:N.values.includes(_),onChange:H=>{const U=N.values,Z=H.target.checked?[...U,_]:U.filter(le=>le!==_);Ue(A,Z)},className:"text-sm"}),r.jsxs("span",{className:"text-xs",children:[_,""]})]},_)),N.type==="weekday"&&I.map(_=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:N.values.includes(_.value),onChange:H=>{const U=N.values,Z=H.target.checked?[...U,_.value]:U.filter(le=>le!==_.value);Ue(A,Z)},className:"text-sm"}),r.jsx("span",{className:"text-xs",children:_.label})]},_.value)),N.type==="week"&&[1,2,3,4,-1].map(_=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:N.values.includes(_),onChange:H=>{const U=N.values,Z=H.target.checked?[...U,_]:U.filter(le=>le!==_);Ue(A,Z)},className:"text-sm"}),r.jsx("span",{className:"text-xs",children:Ql(_)})]},_)),N.type==="month"&&Array.from({length:12},(_,H)=>H+1).map(_=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:N.values.includes(_),onChange:H=>{const U=N.values,Z=H.target.checked?[...U,_]:U.filter(le=>le!==_);Ue(A,Z)},className:"text-sm"}),r.jsxs("span",{className:"text-xs",children:[_,""]})]},_)),N.type==="conflict"&&r.jsxs("div",{className:"col-span-full space-y-3",children:[(N.values||[]).map((_,H)=>r.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:["   ",H+1]}),r.jsx("button",{type:"button",onClick:()=>ee(A,H),className:"text-red-500 hover:text-red-700 p-1",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:" "}),r.jsxs("select",{value:_.targetTemplateTitle,onChange:U=>ce(A,H,"targetTemplateTitle",U.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"",children:" "}),c.map(U=>r.jsx("option",{value:U.title,children:U.title},U.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:" "}),r.jsxs("select",{value:_.scope,onChange:U=>ce(A,H,"scope",U.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"same_date",children:"  "}),r.jsx("option",{value:"same_week",children:"  "}),r.jsx("option",{value:"same_month",children:"  "})]})]})]}),r.jsxs("div",{className:"mt-2 p-2 bg-blue-100 dark:bg-blue-800/30 rounded text-xs text-blue-700 dark:text-blue-300",children:[r.jsx("strong",{children:":"}),' "',_.targetTemplateTitle||" ",'"() ',_.scope==="same_date"?" ":_.scope==="same_week"?" ":" ","      ."]})]},H)),r.jsxs("button",{type:"button",onClick:()=>F(A),className:"w-full py-2 px-3 text-sm border-2 border-dashed border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center gap-2",children:[r.jsx(Bt,{className:"w-4 h-4"}),"  "]})]})]}),r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[N.values.length>0&&N.type!=="conflict"&&r.jsxs("span",{children:[" ",N.type==="date"?"":N.type==="weekday"?"":N.type==="week"?"":"",": ",N.values.join(", ")]}),N.type==="conflict"&&N.values.length>0&&r.jsxs("span",{children:["  : ",N.values.length,""]})]})]},A))]}),d.recurrence!=="none"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:" "}),r.jsxs("div",{className:"flex space-x-4",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"before",checked:d.holidayHandling==="before",onChange:N=>J("holidayHandling",N.target.value),className:"mr-2"})," "]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"after",checked:d.holidayHandling==="after",onChange:N=>J("holidayHandling",N.target.value),className:"mr-2"})," "]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",value:"show",checked:d.holidayHandling==="show",onChange:N=>J("holidayHandling",N.target.value),className:"mr-2"})," "]})]})]})]}),r.jsxs("div",{className:"flex justify-end space-x-3 mt-8",children:[r.jsx("button",{type:"button",onClick:t,className:"btn-secondary",children:""}),r.jsx("button",{type:"submit",className:"btn-primary",children:""})]})]})]}),r.jsx(hT,{isOpen:p,onClose:()=>x(!1),onSelectTemplate:P})]})},$p=({layout:l="sidebar"})=>{const{todos:t,getTodayTodos:n,getWeekTodos:i,getOverdueTodos:c}=Ft(),d=t.length,h=t.filter(k=>k.completed).length,f=d>0?Math.round(h/d*100):0,m=n(),p=m.filter(k=>k.completed).length,x=m.length,b=i(),w=b.filter(k=>k.completed).length,C=b.length,T=C>0?Math.round(w/C*100):0,z=c().length,W=[{title:" ",value:`${f}%`,textColor:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20"},{title:" ",value:`${p}/${x}`,textColor:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{title:" ",value:`${T}%`,textColor:"text-purple-600",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{title:" ",value:z.toString(),textColor:"text-red-600",bgColor:"bg-red-50 dark:bg-red-900/20"}];return l==="compact"?r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsxs("p",{className:"text-green-600 text-xs font-bold leading-none",children:[f,"%"]}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]}),r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsxs("p",{className:"text-blue-600 text-xs font-bold leading-none",children:[p,"/",x]}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]}),r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsxs("p",{className:"text-purple-600 text-xs font-bold leading-none",children:[T,"%"]}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]}),r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsx("p",{className:"text-red-600 text-xs font-bold leading-none",children:z}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]})]}):r.jsx("div",{className:"grid grid-cols-2 gap-2",children:W.map((k,R)=>r.jsx("div",{className:`${k.bgColor} rounded-lg p-2 border border-gray-200 dark:border-gray-700`,children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:k.title}),r.jsx("p",{className:`text-lg font-bold ${k.textColor} dark:text-gray-200`,children:k.value})]})},R))})},zp=({layout:l="full"})=>{const{todos:t}=Ft(),n=t.filter(h=>h.type==="project"),i=n.filter(h=>h.project==="longterm").length,c=n.filter(h=>h.project==="shortterm").length,d=[{label:" ",value:n.length,color:"text-blue-600 dark:text-blue-400"},{label:" ",value:i,color:"text-purple-600 dark:text-purple-400"},{label:" ",value:c,color:"text-green-600 dark:text-green-400"},{label:" ",value:t.length-n.length,color:"text-orange-600 dark:text-orange-400"}];return l==="compact"?r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsx("p",{className:"text-blue-600 text-xs font-bold leading-none",children:n.length}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]}),r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsx("p",{className:"text-orange-600 text-xs font-bold leading-none",children:t.length-n.length}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]}),r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsx("p",{className:"text-purple-600 text-xs font-bold leading-none",children:i}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]}),r.jsxs("div",{className:"text-center min-w-[28px]",children:[r.jsx("p",{className:"text-green-600 text-xs font-bold leading-none",children:c}),r.jsx("p",{className:"text-[9px] text-gray-500 dark:text-gray-400 leading-none mt-0.5",children:""})]})]}):r.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-2 border border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:"mb-2",children:r.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:" "})}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:d.map((h,f)=>r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:`text-sm font-bold ${h.color}`,children:h.value}),r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:h.label})]},f))})]})},fT=({searchTerm:l,onSearchChange:t,priorityFilter:n,onPriorityFilterChange:i,typeFilter:c,onTypeFilterChange:d,projectFilter:h,onProjectFilterChange:f,tagFilter:m,onTagFilterChange:p,completionDateFilter:x,onCompletionDateFilterChange:b,onClearFilters:w,searchInputRef:C,availableTags:T})=>{const[z,W]=M.useState(!1),k=n!=="all"||c!=="all"||h!=="all"||l.length>0||m.length>0||x!=="all",R=D=>{m.includes(D)?p(m.filter(E=>E!==D)):p([...m,D])};return r.jsxs("div",{className:"mb-6 relative z-30",children:[r.jsxs("div",{className:"flex gap-3",children:[r.jsxs("div",{className:"relative flex-1 group",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(Nw,{className:"h-4 w-4 text-gray-400 group-focus-within:text-blue-500 transition-colors"})}),r.jsx("input",{ref:C,type:"text",value:l,onChange:D=>t(D.target.value),className:"block w-full pl-10 pr-3 py-2.5 bg-white/50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 backdrop-blur-sm transition-all duration-200 text-sm placeholder-gray-400 dark:text-white shadow-sm hover:bg-white/80 dark:hover:bg-gray-800/80",placeholder:" ..."})]}),r.jsxs("button",{onClick:()=>W(!z),className:`flex items-center gap-2 px-4 py-2.5 rounded-xl border transition-all duration-200 ${k||z?"bg-blue-500 text-white border-blue-600 shadow-md shadow-blue-500/20":"bg-white/50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 backdrop-blur-sm shadow-sm"}`,children:[r.jsx(Wp,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:""}),k&&r.jsx("span",{className:"bg-white/20 text-white text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:"ON"})]}),k&&r.jsx("button",{onClick:w,className:"flex items-center justify-center w-10 h-10 rounded-xl bg-gray-100 text-gray-500 hover:bg-red-50 hover:text-red-500 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-red-900/30 dark:hover:text-red-400 transition-colors border border-transparent hover:border-red-200 dark:hover:border-red-800",title:" ",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:`
        absolute top-full left-0 right-0 mt-2 p-5 
        glass-panel shadow-xl transform origin-top transition-all duration-300 ease-out
        ${z?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 -translate-y-2 pointer-events-none"}
      `,children:[r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:""}),r.jsxs("select",{value:n,onChange:D=>i(D.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"urgent",children:" "}),r.jsx("option",{value:"high",children:" "}),r.jsx("option",{value:"medium",children:" "}),r.jsx("option",{value:"low",children:" "})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:""}),r.jsxs("select",{value:c,onChange:D=>d(D.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"simple",children:"  "}),r.jsx("option",{value:"project",children:" "})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:" "}),r.jsxs("select",{value:h,onChange:D=>f(D.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:c!=="project"&&c!=="all",children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"longterm",children:"  "}),r.jsx("option",{value:"shortterm",children:"  "})]})]}),r.jsxs("div",{className:"space-y-2 sm:col-span-2 lg:col-span-1",children:[r.jsxs("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[r.jsx(Fu,{className:"w-3 h-3"}),""]}),r.jsx("div",{className:"p-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg max-h-32 overflow-y-auto custom-scrollbar",children:T.length>0?r.jsx("div",{className:"space-y-1",children:T.map(D=>r.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer transition-colors",children:[r.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center transition-colors ${m.includes(D)?"bg-blue-500 border-blue-500 text-white":"border-gray-300 dark:border-gray-600"}`,children:m.includes(D)&&r.jsx(jo,{className:"w-3 h-3"})}),r.jsx("input",{type:"checkbox",checked:m.includes(D),onChange:()=>R(D),className:"hidden"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:D})]},D))}):r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center py-2",children:" "})})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[r.jsx(lt,{className:"w-3 h-3"}),""]}),r.jsxs("select",{value:x,onChange:D=>b(D.target.value),className:"w-full px-3 py-2 bg-white/50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-sm transition-colors",children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"today",children:" "}),r.jsx("option",{value:"yesterday",children:" "}),r.jsx("option",{value:"thisWeek",children:"  "}),r.jsx("option",{value:"lastWeek",children:"  "}),r.jsx("option",{value:"thisMonth",children:"  "})]})]})]}),k&&r.jsx("div",{className:"mt-5 pt-4 border-t border-gray-200/50 dark:border-gray-700/50",children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.length>0&&r.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs font-medium border border-blue-200 dark:border-blue-800",children:[r.jsx(Fu,{className:"w-3 h-3"}),m.length," "]}),x!=="all"&&r.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full text-xs font-medium border border-green-200 dark:border-green-800",children:[r.jsx(lt,{className:"w-3 h-3"}),x==="today"&&" ",x==="yesterday"&&" ",x==="thisWeek"&&"  ",x==="lastWeek"&&"  ",x==="thisMonth"&&"  "]})]})})]})]})},mT=()=>{const{todos:l,addTodo:t,syncWithFirestore:n,syncing:i,loading:c,forceRefresh:d}=Ft(),{currentUser:h}=vs(),[f,m]=M.useState(null),[p,x]=M.useState(!1),b=()=>{try{const C={version:"1.0",exportDate:new Date().toISOString(),todos:l},T=JSON.stringify(C,null,2),z="data:application/json;charset=utf-8,"+encodeURIComponent(T),W=`todos-backup-${new Date().toISOString().split("T")[0]}.json`,k=document.createElement("a");k.setAttribute("href",z),k.setAttribute("download",W),k.click(),m({type:"success",text:"   !"}),setTimeout(()=>m(null),3e3)}catch{m({type:"error",text:"    ."}),setTimeout(()=>m(null),3e3)}},w=C=>{const T=C.target.files?.[0];if(!T)return;const z=new FileReader;z.onload=W=>{try{const k=W.target?.result,R=JSON.parse(k);if(!R.todos||!Array.isArray(R.todos))throw new Error("   .");window.confirm(`${R.todos.length}  ?
  .`)&&(R.todos.forEach(E=>{const{id:O,...P}=E;t({...P,createdAt:new Date(E.createdAt),updatedAt:new Date(E.updatedAt),dueDate:E.dueDate?new Date(E.dueDate):void 0,subTasks:E.subTasks?.map($=>({...$,createdAt:new Date($.createdAt)}))})}),m({type:"success",text:`${R.todos.length}   !`}))}catch{m({type:"error",text:"    .    ."})}C.target.value="",setTimeout(()=>m(null),3e3)},z.readAsText(T)};return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsx("div",{className:`flex items-center justify-center gap-1 px-3 py-2 rounded-lg text-sm ${h?"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:h?r.jsxs(r.Fragment,{children:[r.jsx(jw,{className:"w-4 h-4"}),r.jsx("span",{children:""})]}):r.jsxs(r.Fragment,{children:[r.jsx(Tw,{className:"w-4 h-4"}),r.jsx("span",{children:""})]})}),r.jsxs("button",{onClick:b,className:"flex items-center justify-center gap-2 px-3 py-2 text-sm bg-blue-50 text-blue-700 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-800",title:" ",children:[r.jsx(th,{className:"w-4 h-4"}),""]}),r.jsxs("label",{className:"flex items-center justify-center gap-2 px-3 py-2 text-sm bg-green-50 text-green-700 hover:bg-green-100 dark:bg-green-900/20 dark:text-green-400 dark:hover:bg-green-900/30 rounded-lg border border-green-200 dark:border-green-800 cursor-pointer col-span-2",children:[r.jsx(sh,{className:"w-4 h-4"}),"",r.jsx("input",{type:"file",accept:".json",onChange:w,className:"hidden"})]})]}),f&&r.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 text-sm rounded-lg ${f.type==="success"?"bg-green-50 text-green-700 border border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800":"bg-red-50 text-red-700 border border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800"}`,children:[f.type==="success"?r.jsx(wo,{className:"w-4 h-4"}):r.jsx(ah,{className:"w-4 h-4"}),f.text]})]})},pT={lessThanXSeconds:{one:"1 ",other:"{{count}} "},xSeconds:{one:"1",other:"{{count}}"},halfAMinute:"30",lessThanXMinutes:{one:"1 ",other:"{{count}} "},xMinutes:{one:"1",other:"{{count}}"},aboutXHours:{one:" 1",other:" {{count}}"},xHours:{one:"1",other:"{{count}}"},xDays:{one:"1",other:"{{count}}"},aboutXWeeks:{one:" 1",other:" {{count}}"},xWeeks:{one:"1",other:"{{count}}"},aboutXMonths:{one:" 1",other:" {{count}}"},xMonths:{one:"1",other:"{{count}}"},aboutXYears:{one:" 1",other:" {{count}}"},xYears:{one:"1",other:"{{count}}"},overXYears:{one:"1 ",other:"{{count}} "},almostXYears:{one:" 1",other:" {{count}}"}},yT=(l,t,n)=>{let i;const c=pT[l];return typeof c=="string"?i=c:t===1?i=c.one:i=c.other.replace("{{count}}",t.toString()),n?.addSuffix?n.comparison&&n.comparison>0?i+" ":i+" ":i},xT={full:"y M d EEEE",long:"y M d",medium:"y.MM.dd",short:"y.MM.dd"},bT={full:"a H mm ss zzzz",long:"a H:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},vT={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},wT={date:vu({formats:xT,defaultWidth:"full"}),time:vu({formats:bT,defaultWidth:"full"}),dateTime:vu({formats:vT,defaultWidth:"full"})},kT={lastWeek:"'' eeee p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"'' eeee p",other:"P"},_T=(l,t,n,i)=>kT[l],NT={narrow:["BC","AD"],abbreviated:["BC","AD"],wide:["",""]},jT={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1","2","3","4"]},TT={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1","2","3","4","5","6","7","8","9","10","11","12"],wide:["1","2","3","4","5","6","7","8","9","10","11","12"]},ST={narrow:["","","","","","",""],short:["","","","","","",""],abbreviated:["","","","","","",""],wide:["","","","","","",""]},DT={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},ET={narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},CT=(l,t)=>{const n=Number(l);switch(String(t?.unit)){case"minute":case"second":return String(n);case"date":return n+"";default:return n+""}},AT={ordinalNumber:CT,era:pl({values:NT,defaultWidth:"wide"}),quarter:pl({values:jT,defaultWidth:"wide",argumentCallback:l=>l-1}),month:pl({values:TT,defaultWidth:"wide"}),day:pl({values:ST,defaultWidth:"wide"}),dayPeriod:pl({values:DT,defaultWidth:"wide",formattingValues:ET,defaultFormattingWidth:"wide"})},RT=/^(\d+)(|)?/i,OT=/\d+/i,MT={narrow:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(|)/i},IT={any:[/^(bc|)/i,/^(ad|)/i]},UT={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234]?/i},LT={any:[/1/i,/2/i,/3/i,/4/i]},HT={narrow:/^(1[012]|[123456789])/,abbreviated:/^(1[012]|[123456789])/i,wide:/^(1[012]|[123456789])/i},$T={any:[/^1?$/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},zT={narrow:/^[]/,short:/^[]/,abbreviated:/^[]/,wide:/^[]/},BT={any:[/^/,/^/,/^/,/^/,/^/,/^/,/^/]},FT={any:/^(am|pm|||||||)/i},VT={any:{am:/^(am|)/i,pm:/^(pm|)/i,midnight:/^/i,noon:/^/i,morning:/^/i,afternoon:/^/i,evening:/^/i,night:/^/i}},YT={ordinalNumber:gk({matchPattern:RT,parsePattern:OT,valueCallback:l=>parseInt(l,10)}),era:yl({matchPatterns:MT,defaultMatchWidth:"wide",parsePatterns:IT,defaultParseWidth:"any"}),quarter:yl({matchPatterns:UT,defaultMatchWidth:"wide",parsePatterns:LT,defaultParseWidth:"any",valueCallback:l=>l+1}),month:yl({matchPatterns:HT,defaultMatchWidth:"wide",parsePatterns:$T,defaultParseWidth:"any"}),day:yl({matchPatterns:zT,defaultMatchWidth:"wide",parsePatterns:BT,defaultParseWidth:"any"}),dayPeriod:yl({matchPatterns:FT,defaultMatchWidth:"any",parsePatterns:VT,defaultParseWidth:"any"})},bs={code:"ko",formatDistance:yT,formatLong:wT,formatRelative:_T,localize:AT,match:YT,options:{weekStartsOn:0,firstWeekContainsDate:1}},qT=({searchTerm:l,priorityFilter:t,typeFilter:n,projectFilter:i,tagFilter:c,completionDateFilter:d,onAddTodo:h,isMobile:f=!1})=>{const[m,p]=M.useState(new Date),[x,b]=M.useState({}),[w,C]=M.useState(null),[T,z]=M.useState(!1),[W,k]=M.useState(!1),[R,D]=M.useState([]),[E,O]=M.useState([]),{getFilteredTodos:P,toggleTodo:$,deleteTodo:J}=Ft(),{currentUser:ae}=vs(),{showVacationsInTodos:me,getVacationsForDate:ke,employees:ye}=Fh(),{getCustomHoliday:fe}=Qo(),Re=M.useMemo(()=>{const _=ch(m,{weekStartsOn:0}),H=uy(m,{weekStartsOn:0});return hy({start:_,end:H})},[m]),Ue=M.useMemo(()=>fk(m,{weekStartsOn:0}),[m]);M.useEffect(()=>{(()=>{const H={};Re.forEach(U=>{const Z=dh(U),le=fe(U);le?H[U.toISOString().split("T")[0]]={date:U.toISOString().split("T")[0],name:le.name,isHoliday:!0,type:"custom"}:Z&&(H[U.toISOString().split("T")[0]]=Z)}),b(H)})()},[Re]);const F=M.useMemo(()=>P({searchTerm:l,priorityFilter:t,typeFilter:n,projectFilter:i,tagFilter:c,completionDateFilter:d,includeCompleted:!0}),[l,t,n,i,c,d,P]),ee=_=>{const H=F.filter(Z=>{if(Z.completed&&Z.completedAt)return Dl(Z.completedAt,_);if(!Z.completed){const le=Z.startDate?new Date(Z.startDate):null,ue=Z.dueDate?new Date(Z.dueDate):null;if(le&&ue){const be=new Date(_);return le.setHours(0,0,0,0),ue.setHours(0,0,0,0),be.setHours(0,0,0,0),be.getTime()>=le.getTime()&&be.getTime()<=ue.getTime()}if(le&&!ue){const be=new Date(_);le.setHours(0,0,0,0),be.setHours(0,0,0,0);const Oe=new Date;return Oe.setHours(0,0,0,0),be.getTime()===le.getTime()?!0:be.getTime()>le.getTime()&&be.getTime()<=Oe.getTime()?!Z.completed:!1}return!le&&ue?Dl(ue,_):!1}return!1}),U={urgent:0,high:1,medium:2,low:3};return H.sort((Z,le)=>{const ue=U[Z.priority]-U[le.priority];if(ue!==0)return ue;const be=Z.order||0,Oe=le.order||0;return be!==Oe?be-Oe:new Date(Z.createdAt).getTime()-new Date(le.createdAt).getTime()})},ce=()=>{p(_=>mk(_))},I=()=>{p(_=>dy(_,1))},N=()=>{p(new Date)},A=Vh({onSwipeLeft:I,onSwipeRight:ce},{minSwipeDistance:60});return r.jsxs("div",{className:"space-y-4",...f?{onTouchStart:A.onTouchStart,onTouchMove:A.onTouchMove,onTouchEnd:A.onTouchEnd}:{},children:[r.jsxs("div",{className:`flex items-center ${f?"flex-col gap-2":"justify-between"}`,children:[r.jsxs("div",{className:`flex items-center ${f?"w-full justify-between":"gap-4"}`,children:[r.jsxs("h2",{className:`${f?"text-base":"text-xl"} font-semibold text-gray-900 dark:text-white ${f?"flex-1 text-center min-w-0":""}`,children:[ht(m,"yyyy M",{locale:bs})," ",Ue,""]}),r.jsxs("div",{className:`flex items-center ${f?"gap-1":"gap-2"}`,children:[r.jsx("button",{onClick:ce,className:`${f?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:" ",children:r.jsx(Po,{className:`${f?"w-3 h-3":"w-4 h-4"}`})}),r.jsx("button",{onClick:N,className:`${f?"px-2 py-1 text-xs":"px-3 py-1 text-sm"} bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/40`,children:" "}),r.jsx("button",{onClick:I,className:`${f?"p-1":"p-2"} hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg`,title:" ",children:r.jsx(xa,{className:`${f?"w-3 h-3":"w-4 h-4"}`})})]})]}),!f&&r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[ht(Re[0],"M d",{locale:bs})," - ",ht(Re[6],"M d",{locale:bs})]})]}),r.jsx("div",{className:"grid grid-cols-7 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:Re.map((_,H)=>{const U=ee(_);U.filter(we=>we.completed).length,U.length;const Z=_.toISOString().split("T")[0],le=x[Z],ue=Un(_),be=gr(_),Le=Ln(ae?.email)&&me?ke(_):[];return r.jsxs("div",{className:"border-r border-gray-200 dark:border-gray-700 last:border-r-0 relative flex flex-col",children:[r.jsxs("div",{className:`${f?"p-1":"p-2"} border-b border-gray-200 dark:border-gray-700 text-center cursor-pointer hover:bg-opacity-80 transition-colors ${be?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":le||ue?"bg-red-50 dark:bg-red-900/20":"bg-gray-50 dark:bg-gray-700/50"}`,onClick:()=>{(U.length>0||Le.length>0)&&(D(U),O(Le),k(!0))},children:[r.jsx("div",{className:`text-xs font-medium mb-1 ${le||ue?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"}`,children:ht(_,"E",{locale:bs})}),r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx("div",{className:`text-lg font-semibold ${be?"text-blue-700 dark:text-blue-300":le||ue?"text-red-700 dark:text-red-300":"text-gray-900 dark:text-white"}`,children:ht(_,"d")}),le&&!f&&r.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 font-medium ml-1",children:le.name})]})]}),r.jsxs("div",{className:`${f?"px-0.5 py-1 min-h-[150px] space-y-0.5":"p-2 min-h-[200px] space-y-1"} flex-1`,children:[Le.slice(0,Math.max(0,8-U.length)).map(we=>{const pt=ye.find(dn=>dn.id===we.employeeId);return r.jsx("div",{className:`${f?"p-1 text-[9px]":"p-2 text-xs"} rounded border cursor-pointer hover:shadow-md transition-all ${we.type===""?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-900/30":we.type===""||we.type===""?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30":we.type===""?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30":we.type===""?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800 hover:bg-yellow-100 dark:hover:bg-yellow-900/30"}`,title:pt?`${pt.name} - ${we.type}`:` ${we.employeeId} - ${we.type}`,children:r.jsx("div",{className:"truncate",children:f?`${we.type}`:pt?`${pt.name} ${we.type}`:`${we.employeeId} ${we.type}`})},`vacation-${we.id}`)}),U.slice(0,Math.max(0,8-Le.length)).map(we=>r.jsxs("div",{className:`group relative ${f?"p-1":"p-2"} rounded ${f?"text-[10px]":"text-xs"} border cursor-pointer hover:shadow-md transition-all ${we.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":we.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":we.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800 hover:bg-orange-100 dark:hover:bg-orange-900/30":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30"}`,onClick:()=>{C(we),z(!0)},children:[r.jsx("div",{className:`font-medium truncate ${f?"text-[10px]":"text-xs"} ${we.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:we.title}),r.jsxs("div",{className:`${f?"text-[9px]":"text-xs"} text-gray-500 dark:text-gray-400 ${f?"mt-0.5":"mt-1"}`,children:[we.showStartTime&&we.startTime&&r.jsxs("span",{children:[": ",we.startTime]}),we.showStartTime&&we.startTime&&we.showDueTime&&we.dueDate&&new Date(we.dueDate).getHours()!==23&&new Date(we.dueDate).getMinutes()!==59&&r.jsx("span",{children:" | "}),we.showDueTime&&we.dueDate&&(()=>{const pt=new Date(we.dueDate);return pt.getHours()===23&&pt.getMinutes()===59?null:r.jsxs("span",{children:[": ",pt.toTimeString().slice(0,5)]})})()]}),r.jsxs("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[r.jsx("button",{onClick:pt=>{pt.stopPropagation(),$(we.id)},className:"p-1.5 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-700",title:we.completed?" ":" ",children:r.jsx("div",{className:`w-3 h-3 rounded-full ${we.completed?"bg-green-600":"border border-gray-400"}`})}),r.jsx("button",{onClick:pt=>{pt.stopPropagation(),confirm(`"${we.title}"  ?`)&&J(we.id)},className:"p-1.5 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-900/30",title:"",children:r.jsx(os,{className:"w-3 h-3 text-red-600"})})]})]},we.id)),U.length+Le.length>8&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center py-1 cursor-pointer hover:text-blue-600",onClick:()=>{D(U),O(Le),k(!0)},children:["+",U.length+Le.length-8," "]}),r.jsx("button",{onClick:h,className:`w-full ${f?"h-6":"h-8"} border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center text-gray-400 hover:border-blue-400 hover:text-blue-400 transition-colors`,title:" ",children:r.jsx(Bt,{className:`${f?"w-2.5 h-2.5":"w-3 h-3"}`})})]}),le&&f&&r.jsx("div",{className:"absolute bottom-0 left-0 right-0",children:r.jsx("div",{className:"text-[9px] text-red-600 dark:text-red-400 font-medium text-center bg-red-50 dark:bg-red-900/20 py-0.5 leading-tight",children:le.name})})]},H)})}),Re.some(_=>{const H=ee(_),Z=Ln(ae?.email)&&me?ke(_):[];return H.length>0||Z.length>0})&&r.jsxs("div",{className:"mt-8",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"   "}),r.jsx("div",{className:"space-y-2",children:Re.map(_=>{const H=ee(_),Z=Ln(ae?.email)&&me?ke(_):[];return H.length===0&&Z.length===0?null:r.jsxs("div",{children:[r.jsxs("h4",{className:"text-md font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[r.jsx(lt,{className:"w-4 h-4"}),ht(_,"M d (E)",{locale:bs}),gr(_)&&r.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded",children:""})]}),r.jsxs("div",{className:"space-y-2",children:[Z.map(le=>{const ue=ye.find(be=>be.id===le.employeeId);return r.jsx("div",{className:`p-3 rounded-lg border cursor-pointer hover:shadow-md transition-all ${le.type===""?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":le.type===""||le.type===""?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":le.type===""?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":le.type===""?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[ue&&r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:ue.color},children:ue.name.charAt(0)}),r.jsx("div",{className:"flex-1 truncate",children:r.jsx("div",{className:`font-medium text-gray-900 dark:text-white truncate ${f?"text-sm":"text-base"}`,children:ue?ue.name:` ${le.employeeId}`})}),r.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${le.type===""?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":le.type===""||le.type===""?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":le.type===""?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":le.type===""?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:le.type})]})},`vacation-${le.id}`)}),H.map(le=>r.jsx(ql,{todo:le},le.id))]})]},_.toISOString())})})]}),w&&r.jsx(Yh,{isOpen:T,onClose:()=>{z(!1),C(null)},todo:w,isMobile:f}),W&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>k(!1),children:r.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-xl ${f?"w-[90vw] max-h-[80vh]":"w-[500px] max-h-[600px]"} overflow-hidden`,onClick:_=>_.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[r.jsx(lt,{className:"w-5 h-5"}),R.length>0&&R[0].dueDate?ht(R[0].dueDate,"M d (E)",{locale:bs}):"  "," (",R.length+E.length,")"]}),r.jsx("button",{onClick:()=>k(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"p-4 overflow-y-auto max-h-[500px]",children:R.length>0||E.length>0?r.jsxs("div",{className:"space-y-3",children:[E.map(_=>{const H=ye.find(U=>U.id===_.employeeId);return r.jsx("div",{className:`p-2 rounded border ${_.type===""?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":_.type===""||_.type===""?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":_.type===""?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":_.type===""?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[H&&r.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:H.color},children:H.name.charAt(0)}),r.jsx("div",{className:"flex-1",children:r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:H?H.name:` ${_.employeeId}`})}),r.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${_.type===""?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":_.type===""||_.type===""?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":_.type===""?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":_.type===""?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:_.type})]})},`vacation-${_.id}`)}),R.map(_=>r.jsx("div",{className:`p-2 rounded border cursor-pointer hover:shadow-md transition-all ${_.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":_.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":_.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,onClick:()=>{C(_),z(!0),k(!1)},children:r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:`font-medium truncate ${_.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:_.title}),(_.showStartTime&&_.startTime||_.showDueTime&&_.dueDate)&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[_.showStartTime&&_.startTime&&r.jsxs("span",{children:[": ",_.startTime]}),_.showStartTime&&_.startTime&&_.showDueTime&&_.dueDate&&(()=>{const H=new Date(_.dueDate);return H.getHours()===23&&H.getMinutes()===59?null:r.jsx("span",{children:" | "})})(),_.showDueTime&&_.dueDate&&(()=>{const H=new Date(_.dueDate);return H.getHours()===23&&H.getMinutes()===59?null:r.jsxs("span",{children:[": ",H.toTimeString().slice(0,5)]})})()]})]}),r.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[_.type==="project"&&r.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${_.project==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400"}`,children:_.project==="longterm"?"":""}),_.priority&&_.priority!=="medium"&&r.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${_.priority==="urgent"?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":_.priority==="high"?"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400":"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}`,children:_.priority==="urgent"?"":_.priority==="high"?"":""}),r.jsx("button",{onClick:H=>{H.stopPropagation(),$(_.id)},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-600 border border-gray-200 dark:border-gray-600",title:_.completed?" ":" ",children:r.jsx("div",{className:`w-3 h-3 rounded-full ${_.completed?"bg-green-600":"border border-gray-400"}`})}),r.jsx("button",{onClick:H=>{H.stopPropagation(),confirm(`"${_.title}"  ?`)&&(J(_.id),R.filter(Z=>Z.id!==_.id).length===0&&E.length===0&&k(!1))},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-800 border border-gray-200 dark:border-gray-600",title:"",children:r.jsx(os,{className:"w-3 h-3 text-red-600"})})]})]})},_.id))]}):r.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"   ."})}),r.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end",children:r.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:""})})]})})]})},GT=({searchTerm:l,priorityFilter:t,typeFilter:n,projectFilter:i,tagFilter:c,completionDateFilter:d,onAddTodo:h,isMobile:f=!1})=>{const[m,p]=M.useState(new Date),[x,b]=M.useState(null),[w,C]=M.useState({}),[T,z]=M.useState(null),[W,k]=M.useState(!1),[R,D]=M.useState(!1),{currentUser:E}=vs(),{showVacationsInTodos:O,getVacationsForDate:P,employees:$}=Fh(),{getCustomHoliday:J}=Qo(),[ae,me]=M.useState([]),[ke,ye]=M.useState([]),{getFilteredTodos:fe,toggleTodo:Re,deleteTodo:Ue}=Ft(),F=M.useMemo(()=>{const U=ch(cy(m),{weekStartsOn:0}),Z=uy(pk(m),{weekStartsOn:0});return hy({start:U,end:Z})},[m]);M.useEffect(()=>{(()=>{const Z={};F.forEach(le=>{const ue=dh(le),be=J(le);be?Z[le.toISOString().split("T")[0]]={date:le.toISOString().split("T")[0],name:be.name,isHoliday:!0,type:"custom"}:ue&&(Z[le.toISOString().split("T")[0]]=ue)}),C(Z)})()},[F]);const ee=M.useMemo(()=>fe({searchTerm:l,priorityFilter:t,typeFilter:n,projectFilter:i,tagFilter:c,completionDateFilter:d,includeCompleted:!0}),[l,t,n,i,c,d,fe]),ce=U=>{const Z=ee.filter(ue=>{if(ue.completed&&ue.completedAt)return Dl(ue.completedAt,U);if(!ue.completed){const be=ue.startDate?new Date(ue.startDate):null,Oe=ue.dueDate?new Date(ue.dueDate):null;if(be&&Oe){const Le=new Date(U);return be.setHours(0,0,0,0),Oe.setHours(0,0,0,0),Le.setHours(0,0,0,0),Le.getTime()>=be.getTime()&&Le.getTime()<=Oe.getTime()}if(be&&!Oe){const Le=new Date(U);be.setHours(0,0,0,0),Le.setHours(0,0,0,0);const we=new Date;return we.setHours(0,0,0,0),Le.getTime()===be.getTime()?!0:Le.getTime()>be.getTime()&&Le.getTime()<=we.getTime()?!ue.completed:!1}return!be&&Oe?Dl(Oe,U):!1}return!1}),le={urgent:0,high:1,medium:2,low:3};return Z.sort((ue,be)=>{const Oe=le[ue.priority]-le[be.priority];if(Oe!==0)return Oe;const Le=ue.order||0,we=be.order||0;return Le!==we?Le-we:new Date(ue.createdAt).getTime()-new Date(be.createdAt).getTime()})},I=()=>{p(U=>xk(U))},N=()=>{p(U=>bk(U,1))},A=()=>{p(new Date)},_=Vh({onSwipeLeft:N,onSwipeRight:I},{minSwipeDistance:60}),H=["","","","","","",""];return r.jsxs("div",{className:"space-y-4",...f?{onTouchStart:_.onTouchStart,onTouchMove:_.onTouchMove,onTouchEnd:_.onTouchEnd}:{},children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:ht(m,"yyyy M",{locale:bs})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:" ",children:r.jsx(Po,{className:"w-4 h-4"})}),r.jsx("button",{onClick:A,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/40",children:" "}),r.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:" ",children:r.jsx(xa,{className:"w-4 h-4"})})]})]}),x&&r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[" : ",ht(x,"M d (E)",{locale:bs})]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[r.jsx("div",{className:"grid grid-cols-7 bg-gray-50 dark:bg-gray-700/50",children:H.map((U,Z)=>r.jsx("div",{className:`p-3 text-center text-sm font-medium border-r border-gray-200 dark:border-gray-700 last:border-r-0 ${Z===0||Z===6?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"}`,children:U},U))}),r.jsx("div",{className:"grid grid-cols-7",children:F.map((U,Z)=>{const le=ce(U);le.filter(j=>j.completed).length,le.length;const ue=yk(U,m),be=gr(U),Oe=x&&Dl(U,x),Le=U.toISOString().split("T")[0],we=w[Le],pt=Un(U),qt=Ln(E?.email)&&O?P(U):[];return r.jsxs("div",{className:`relative ${f?"min-h-[80px]":"min-h-[120px]"} border-r border-b border-gray-200 dark:border-gray-700 last:border-r-0 ${ue?"":"bg-gray-50 dark:bg-gray-800/50"} ${Oe?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[r.jsx("div",{className:`p-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${be?"bg-blue-100 dark:bg-blue-900/30":(we||pt)&&ue?"bg-red-50 dark:bg-red-900/20":""}`,onClick:()=>{f||le.length>0||qt.length>0?(me(le),ye(qt),D(!0)):b(Oe?null:U)},children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:`text-sm font-medium ${ue?be?"text-blue-700 dark:text-blue-300":we||pt?"text-red-700 dark:text-red-300":"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}`,children:ht(U,"d")}),we&&ue&&!f&&r.jsx("span",{className:"text-xs text-red-600 dark:text-red-400 font-medium",children:we.name})]})})}),r.jsxs("div",{className:`${f?"px-1 pb-1 space-y-0.5":"px-2 pb-2 space-y-1"}`,children:[qt.map(j=>{const V=$.find(q=>q.id===j.employeeId);return r.jsx("div",{className:`px-1.5 py-0.5 rounded text-[10px] ${f?"text-[9px]":"text-xs"} font-medium ${j.type===""?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":j.type===""||j.type===""?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":j.type===""?"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-200":j.type===""?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200":"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200"}`,title:V?`${V.name} - ${j.type}`:` ${j.employeeId} - ${j.type}`,children:f?`${j.type}`:V?`${V.name} ${j.type}`:`${j.employeeId} ${j.type}`},`vacation-${j.id}`)}),f?le.slice(0,Math.max(0,8-qt.length)).map(j=>r.jsx("div",{className:`px-1.5 py-0.5 rounded text-[10px] cursor-pointer truncate ${j.completed?"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 line-through":j.priority==="urgent"?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200":j.priority==="high"?"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-200":"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200"}`,onClick:()=>{z(j),k(!0)},title:j.title,children:j.title},j.id)):le.slice(0,Math.max(0,8-qt.length)).map(j=>r.jsxs("div",{className:`group relative p-1 rounded text-xs border cursor-pointer hover:shadow-md transition-all ${j.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":j.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 hover:bg-red-100 dark:hover:bg-red-900/30":j.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800 hover:bg-orange-100 dark:hover:bg-orange-900/30":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30"}`,onClick:()=>{z(j),k(!0)},children:[r.jsx("div",{className:`font-medium truncate ${j.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:j.title}),(j.showStartTime&&j.startTime||j.showDueTime&&j.dueDate)&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[j.showStartTime&&j.startTime&&r.jsxs("span",{children:[": ",j.startTime]}),j.showStartTime&&j.startTime&&j.showDueTime&&j.dueDate&&(()=>{const V=new Date(j.dueDate);return V.getHours()===23&&V.getMinutes()===59?null:r.jsx("span",{children:" | "})})(),j.showDueTime&&j.dueDate&&(()=>{const V=new Date(j.dueDate);return V.getHours()===23&&V.getMinutes()===59?null:r.jsxs("span",{children:[": ",V.toTimeString().slice(0,5)]})})()]}),r.jsxs("div",{className:"absolute top-0.5 right-0.5 opacity-0 group-hover:opacity-100 transition-opacity flex gap-0.5",children:[r.jsx("button",{onClick:V=>{V.stopPropagation(),Re(j.id)},className:"p-1 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-700",title:j.completed?" ":" ",children:r.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${j.completed?"bg-green-600":"border border-gray-400"}`})}),r.jsx("button",{onClick:V=>{V.stopPropagation(),confirm(`"${j.title}"  ?`)&&Ue(j.id)},className:"p-1 bg-white dark:bg-gray-800 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-900/30",title:"",children:r.jsx(os,{className:"w-2.5 h-2.5 text-red-600"})})]})]},j.id)),le.length+qt.length>8&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center py-1 cursor-pointer hover:text-blue-600",onClick:()=>{me(le),ye(qt),D(!0)},children:["+",le.length+qt.length-8," "]}),ue&&r.jsx("button",{onClick:h,className:`w-full ${f?"h-5":"h-6"} border border-dashed border-gray-300 dark:border-gray-600 rounded flex items-center justify-center text-gray-400 hover:border-blue-400 hover:text-blue-400 transition-colors`,title:" ",children:r.jsx(Bt,{className:`${f?"w-2.5 h-2.5":"w-3 h-3"}`})})]}),we&&f&&ue&&r.jsx("div",{className:"absolute bottom-0 left-0 right-0",children:r.jsx("div",{className:"text-[9px] text-red-600 dark:text-red-400 font-medium text-center bg-red-50 dark:bg-red-900/20 py-0.5 leading-tight",children:we.name})})]},Z)})})]}),x&&r.jsxs("div",{className:"mt-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[r.jsx(lt,{className:"w-5 h-5"}),ht(x,"M d (E)",{locale:bs})," ",gr(x)&&r.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded",children:""})]}),r.jsx("button",{onClick:()=>b(null),className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:""})]}),r.jsxs("div",{className:"space-y-2",children:[ce(x).map(U=>r.jsx(ql,{todo:U},U.id)),ce(x).length===0&&r.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[r.jsx(lt,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"   ."}),r.jsx("button",{onClick:h,className:"mt-2 text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:" "})]})]})]}),R&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>D(!1),children:r.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-xl ${f?"w-[90vw] max-h-[80vh]":"w-[500px] max-h-[600px]"} overflow-hidden`,onClick:U=>U.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[r.jsx(lt,{className:"w-5 h-5"}),ae.length>0&&ae[0].dueDate?ht(ae[0].dueDate,"M d (E)",{locale:bs}):"  "," (",ae.length+ke.length,")"]}),r.jsx("button",{onClick:()=>D(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"p-4 overflow-y-auto max-h-[500px]",children:ae.length>0||ke.length>0?r.jsxs("div",{className:"space-y-3",children:[ke.map(U=>{const Z=$.find(le=>le.id===U.employeeId);return r.jsx("div",{className:`p-2 rounded border ${U.type===""?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":U.type===""||U.type===""?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":U.type===""?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":U.type===""?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[Z&&r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-sm font-semibold",style:{backgroundColor:Z.color},children:Z.name.charAt(0)}),r.jsx("div",{className:"flex-1",children:r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:Z?Z.name:` ${U.employeeId}`})}),r.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded ${U.type===""?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200":U.type===""||U.type===""?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200":U.type===""?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-200":U.type===""?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200"}`,children:U.type})]})},`vacation-${U.id}`)}),ae.map(U=>r.jsx("div",{className:`p-2 rounded border cursor-pointer hover:shadow-md transition-all ${U.completed?"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 opacity-60":U.priority==="urgent"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":U.priority==="high"?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,onClick:()=>{z(U),k(!0),D(!1)},children:r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:`font-medium truncate ${U.completed?"line-through text-gray-500":"text-gray-900 dark:text-white"}`,children:U.title}),(U.showStartTime&&U.startTime||U.showDueTime&&U.dueDate)&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[U.showStartTime&&U.startTime&&r.jsxs("span",{children:[": ",U.startTime]}),U.showStartTime&&U.startTime&&U.showDueTime&&U.dueDate&&(()=>{const Z=new Date(U.dueDate);return Z.getHours()===23&&Z.getMinutes()===59?null:r.jsx("span",{children:" | "})})(),U.showDueTime&&U.dueDate&&(()=>{const Z=new Date(U.dueDate);return Z.getHours()===23&&Z.getMinutes()===59?null:r.jsxs("span",{children:[": ",Z.toTimeString().slice(0,5)]})})()]})]}),r.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[U.type==="project"&&r.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${U.project==="longterm"?"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400":"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400"}`,children:U.project==="longterm"?"":""}),U.priority&&U.priority!=="medium"&&r.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${U.priority==="urgent"?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":U.priority==="high"?"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400":"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}`,children:U.priority==="urgent"?"":U.priority==="high"?"":""}),r.jsx("button",{onClick:Z=>{Z.stopPropagation(),Re(U.id)},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-gray-100 dark:hover:bg-gray-600 border border-gray-200 dark:border-gray-600",title:U.completed?" ":" ",children:r.jsx("div",{className:`w-3 h-3 rounded-full ${U.completed?"bg-green-600":"border border-gray-400"}`})}),r.jsx("button",{onClick:Z=>{Z.stopPropagation(),confirm(`"${U.title}"  ?`)&&(Ue(U.id),ae.filter(ue=>ue.id!==U.id).length===0&&ke.length===0&&D(!1))},className:"p-1 bg-white dark:bg-gray-700 rounded shadow-sm hover:bg-red-100 dark:hover:bg-red-800 border border-gray-200 dark:border-gray-600",title:"",children:r.jsx(os,{className:"w-3 h-3 text-red-600"})})]})]})},U.id))]}):r.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[r.jsx(lt,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"    ."}),r.jsx("button",{onClick:()=>{D(!1),h()},className:"mt-2 text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:" "})]})})]})}),T&&r.jsx(Yh,{isOpen:W,onClose:()=>{k(!1),z(null)},todo:T,isMobile:f})]})},PT=({isOpen:l,onClose:t})=>{const{addRecurringTemplate:n,recurringTemplates:i}=Ft(),[c,d]=M.useState({title:"",description:"",priority:"medium",type:"simple",recurrenceType:"daily",weekday:1,monthlyDate:1,monthlyPattern:"date",monthlyWeek:"first",monthlyWeekday:3,tags:[],exceptions:[],holidayHandling:"show"}),[h,f]=M.useState(!1),m=()=>{d(k=>({...k,exceptions:[...k.exceptions,{type:"date",values:[]}]}))},p=k=>{d(R=>({...R,exceptions:R.exceptions.filter((D,E)=>E!==k)}))},x=(k,R,D)=>{d(E=>({...E,exceptions:E.exceptions.map((O,P)=>P===k?{...O,[R]:D}:O)}))},b=(k,R)=>{d(D=>({...D,exceptions:D.exceptions.map((E,O)=>O===k?{...E,values:R}:E)}))},w=k=>{const D=c.exceptions[k].values||[],E={targetTemplateTitle:"",scope:"same_week"};b(k,[...D,E])},C=(k,R)=>{const E=c.exceptions[k].values||[];b(k,E.filter((O,P)=>P!==R))},T=(k,R,D,E)=>{const $=(c.exceptions[k].values||[]).map((J,ae)=>ae===R?{...J,[D]:E}:J);b(k,$)},z=[{value:0,label:""},{value:1,label:""},{value:2,label:""},{value:3,label:""},{value:4,label:""},{value:5,label:""},{value:6,label:""}],W=async k=>{if(k.preventDefault(),!!c.title.trim()){f(!0);try{console.log("=== AddRecurringModal    ==="),console.log(" :",c);const R={title:c.title.trim(),description:c.description.trim()||void 0,priority:c.priority,type:c.type,recurrenceType:c.recurrenceType,isActive:!0,tags:c.tags,exceptions:c.exceptions,holidayHandling:c.holidayHandling};console.log("  :",R.holidayHandling),c.recurrenceType==="weekly"?R.weekday=c.weekday:c.recurrenceType==="monthly"&&(c.monthlyPattern==="weekday"?(R.monthlyPattern="weekday",R.monthlyWeek=c.monthlyWeek,R.monthlyWeekday=c.monthlyWeekday):(R.monthlyPattern="date",R.monthlyDate=c.monthlyDate)),console.log("  :",R),await n(R),t(),d({title:"",description:"",priority:"medium",type:"simple",recurrenceType:"daily",weekday:1,monthlyDate:1,monthlyPattern:"date",monthlyWeek:"first",monthlyWeekday:3,tags:[],exceptions:[],holidayHandling:"show"}),console.log("=== AddRecurringModal    ===")}catch(R){console.error("   :",R),alert("   .")}finally{f(!1)}}};return l?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"  "}),r.jsx("button",{onClick:t,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:r.jsx(ct,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:W,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsx("input",{type:"text",value:c.title,onChange:k=>d({...c,title:k.target.value}),placeholder:"   ",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:" ()"}),r.jsx("textarea",{value:c.description,onChange:k=>d({...c,description:k.target.value}),placeholder:"    ",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:2})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 sm:mb-2",children:[r.jsx(nh,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1"}),""]}),r.jsxs("select",{value:c.priority,onChange:k=>d({...c,priority:k.target.value}),className:"w-full px-2 py-1.5 sm:px-3 sm:py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"low",children:""}),r.jsx("option",{value:"medium",children:""}),r.jsx("option",{value:"high",children:""}),r.jsx("option",{value:"urgent",children:""})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:" "}),r.jsxs("select",{value:c.recurrenceType,onChange:k=>d({...c,recurrenceType:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:"daily",children:""}),r.jsx("option",{value:"weekly",children:""}),r.jsx("option",{value:"monthly",children:""})]})]}),c.recurrenceType==="weekly"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsxs("select",{value:c.weekday,onChange:k=>d({...c,weekday:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:0,children:""}),r.jsx("option",{value:1,children:""}),r.jsx("option",{value:2,children:""}),r.jsx("option",{value:3,children:""}),r.jsx("option",{value:4,children:""}),r.jsx("option",{value:5,children:""}),r.jsx("option",{value:6,children:""})]})]}),c.recurrenceType==="monthly"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:" "}),r.jsxs("select",{value:c.monthlyPattern,onChange:k=>d({...c,monthlyPattern:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:"date",children:"  (:  15)"}),r.jsx("option",{value:"weekday",children:"   (:    )"})]})]}),c.monthlyPattern==="date"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsxs("select",{value:c.monthlyDate,onChange:k=>d({...c,monthlyDate:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[Array.from({length:31},(k,R)=>R+1).map(k=>r.jsxs("option",{value:k,children:[k,""]},k)),r.jsx("option",{value:-1,children:""}),r.jsx("option",{value:-2,children:"  "}),r.jsx("option",{value:-3,children:" "})]})]}),c.monthlyPattern==="weekday"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"  "}),r.jsxs("select",{value:c.monthlyWeek,onChange:k=>d({...c,monthlyWeek:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:"first",children:"  "}),r.jsx("option",{value:"second",children:"  "}),r.jsx("option",{value:"third",children:"  "}),r.jsx("option",{value:"fourth",children:"  "}),r.jsx("option",{value:"last",children:" "})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsxs("select",{value:c.monthlyWeekday,onChange:k=>d({...c,monthlyWeekday:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:0,children:""}),r.jsx("option",{value:1,children:""}),r.jsx("option",{value:2,children:""}),r.jsx("option",{value:3,children:""}),r.jsx("option",{value:4,children:""}),r.jsx("option",{value:5,children:""}),r.jsx("option",{value:6,children:""})]})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:" "}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"holidayHandling",value:"before",checked:c.holidayHandling==="before",onChange:k=>d({...c,holidayHandling:k.target.value}),className:"mr-2 text-blue-600"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"  "})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"holidayHandling",value:"after",checked:c.holidayHandling==="after",onChange:k=>d({...c,holidayHandling:k.target.value}),className:"mr-2 text-blue-600"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"  "})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"holidayHandling",value:"show",checked:c.holidayHandling==="show",onChange:k=>d({...c,holidayHandling:k.target.value}),className:"mr-2 text-blue-600"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:" "})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.jsx(Go,{className:"w-4 h-4 inline mr-1"}),"  (  )"]}),r.jsxs("button",{type:"button",onClick:m,className:"flex items-center gap-1 px-2 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/30",children:[r.jsx(Bt,{className:"w-3 h-3"})," "]})]}),c.exceptions.map((k,R)=>r.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("select",{value:k.type,onChange:D=>x(R,"type",D.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"date",children:"  "}),r.jsx("option",{value:"weekday",children:"  "}),r.jsx("option",{value:"week",children:"  "}),r.jsx("option",{value:"month",children:"  "}),r.jsx("option",{value:"conflict",children:"  "})]}),r.jsx("button",{type:"button",onClick:()=>p(R),className:"ml-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[k.type==="date"&&Array.from({length:31},(D,E)=>E+1).map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D]:O.filter($=>$!==D);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsxs("span",{className:"text-xs",children:[D,""]})]},D)),k.type==="weekday"&&z.map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D.value),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D.value]:O.filter($=>$!==D.value);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsx("span",{className:"text-xs",children:D.label})]},D.value)),k.type==="week"&&[1,2,3,4,-1].map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D]:O.filter($=>$!==D);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsx("span",{className:"text-xs",children:Ql(D)})]},D)),k.type==="month"&&Array.from({length:12},(D,E)=>E+1).map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D]:O.filter($=>$!==D);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsxs("span",{className:"text-xs",children:[D,""]})]},D)),k.type==="conflict"&&r.jsxs("div",{className:"col-span-full space-y-3",children:[(k.values||[]).map((D,E)=>r.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:["   ",E+1]}),r.jsx("button",{type:"button",onClick:()=>C(R,E),className:"text-red-500 hover:text-red-700 p-1",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:" "}),r.jsxs("select",{value:D.targetTemplateTitle,onChange:O=>T(R,E,"targetTemplateTitle",O.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"",children:" "}),i.map(O=>r.jsx("option",{value:O.title,children:O.title},O.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:" "}),r.jsxs("select",{value:D.scope,onChange:O=>T(R,E,"scope",O.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"same_date",children:"  "}),r.jsx("option",{value:"same_week",children:"  "}),r.jsx("option",{value:"same_month",children:"  "})]})]})]}),r.jsxs("div",{className:"mt-2 p-2 bg-blue-100 dark:bg-blue-800/30 rounded text-xs text-blue-700 dark:text-blue-300",children:[r.jsx("strong",{children:":"}),' "',D.targetTemplateTitle||" ",'"() ',D.scope==="same_date"?" ":D.scope==="same_week"?" ":" ","      ."]})]},E)),r.jsxs("button",{type:"button",onClick:()=>w(R),className:"w-full py-2 px-3 text-sm border-2 border-dashed border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center gap-2",children:[r.jsx(Bt,{className:"w-4 h-4"}),"  "]})]})]}),r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[k.values.length>0&&k.type!=="conflict"&&r.jsxs("span",{children:[" ",k.type==="date"?"":k.type==="weekday"?"":k.type==="week"?"":"",": ",k.values.join(", ")]}),k.type==="conflict"&&k.values.length>0&&r.jsxs("span",{children:["  : ",k.values.length,""]})]})]},R))]}),r.jsxs("div",{className:"flex gap-3 pt-4 mt-6 border-t",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",disabled:h,children:""}),r.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:h||!c.title.trim(),children:h?" ...":""})]})]})]})}):null},WT=()=>{const{recurringTemplates:l,recurringInstances:t,updateRecurringTemplate:n,deleteRecurringTemplate:i,cleanupDuplicateTemplates:c}=Ft(),[d,h]=M.useState("templates"),[f,m]=M.useState(!1),[p,x]=M.useState(!1),[b,w]=M.useState(null),[C,T]=M.useState({excludeWeeks:[],excludeDates:[]});M.useEffect(()=>{try{const $=localStorage.getItem("globalRecurringExceptions");$&&T(JSON.parse($))}catch($){console.error("   :",$)}},[]);const z=$=>{try{localStorage.setItem("globalRecurringExceptions",JSON.stringify($)),T($)}catch(J){console.error("   :",J)}},W=$=>{const J={...C},ae=J.excludeWeeks.indexOf($);ae===-1?J.excludeWeeks.push($):J.excludeWeeks.splice(ae,1),z(J)},k=l.filter($=>$.isActive),R=l.filter($=>!$.isActive),D=async $=>{const J=l.find(ae=>ae.id===$);J&&await n($,{isActive:!J.isActive})},E=async $=>{confirm("   ?")&&await i($)},O=$=>{w($),x(!0)},P=$=>{if($.recurrenceType==="weekly")return` ${["","","","","","",""][$.weekday||0]}`;if($.recurrenceType==="monthly")if($.monthlyPattern==="weekday"&&$.monthlyWeek&&$.monthlyWeekday!==void 0){const J=["","","","","","",""];return` ${{first:" ",second:" ",third:" ",fourth:" ",last:""}[$.monthlyWeek]}  ${J[$.monthlyWeekday]}`}else return $.monthlyDate===-1?" ":$.monthlyDate===-2?"   ":$.monthlyDate===-3?"  ":` ${$.monthlyDate}`;return""};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:" "}),r.jsxs("button",{onClick:()=>m(!0),className:"btn-primary flex items-center gap-2",children:[r.jsx(Bt,{className:"w-4 h-4"}),"  "]})]}),r.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:r.jsxs("nav",{className:"flex justify-between",children:[r.jsx("button",{onClick:()=>h("templates"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="templates"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:" "}),r.jsxs("div",{className:"flex space-x-4",children:[r.jsx("button",{onClick:()=>h("exceptions"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="exceptions"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:" "}),r.jsx("button",{onClick:()=>h("holidays"),className:`py-4 px-1 border-b-2 font-medium text-sm ${d==="holidays"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:" "})]})]})}),d==="templates"&&r.jsxs("div",{className:"space-y-6",children:[k.length>0&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[r.jsx(zu,{className:"w-5 h-5 text-green-600"}),"   (",k.length,")"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map($=>r.jsx("div",{className:"card p-3 bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1 truncate",children:$.title}),r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 whitespace-nowrap overflow-hidden text-ellipsis",children:P($)})]}),r.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[r.jsx("span",{className:`px-2 py-1 rounded text-xs ${$.priority==="urgent"?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300":$.priority==="high"?"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300":$.priority==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"}`,children:$.priority==="urgent"?"":$.priority==="high"?"":$.priority==="medium"?"":""}),r.jsx("button",{onClick:()=>O($),className:"p-1 hover:bg-blue-100 dark:hover:bg-blue-800 rounded",title:"",children:r.jsx(So,{className:"w-4 h-4 text-blue-600"})}),r.jsx("button",{onClick:()=>D($.id),className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded",title:"",children:r.jsx($u,{className:"w-4 h-4 text-green-600"})}),r.jsx("button",{onClick:()=>E($.id),className:"p-1 hover:bg-red-100 dark:hover:bg-red-800 rounded",title:"",children:r.jsx(os,{className:"w-4 h-4 text-red-600"})})]})]})},$.id))})]}),R.length>0&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[r.jsx($u,{className:"w-5 h-5 text-gray-500"}),"   (",R.length,")"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map($=>r.jsx("div",{className:"card p-3 bg-gray-50 dark:bg-gray-800 opacity-75",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-medium text-gray-600 dark:text-gray-300 mb-1 truncate",children:$.title}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap overflow-hidden text-ellipsis",children:P($)})]}),r.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[r.jsx("button",{onClick:()=>D($.id),className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded",title:"",children:r.jsx(zu,{className:"w-4 h-4 text-green-600"})}),r.jsx("button",{onClick:()=>E($.id),className:"p-1 hover:bg-red-100 dark:hover:bg-red-800 rounded",title:"",children:r.jsx(os,{className:"w-4 h-4 text-red-600"})})]})]})},$.id))})]}),l.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(lt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"  "}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"      ."}),r.jsx("button",{onClick:()=>m(!0),className:"btn-primary",children:"   "})]})]}),d==="exceptions"&&r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"card p-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"    "}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200 mb-3",children:"  "}),r.jsxs("div",{className:"flex gap-1 justify-between overflow-hidden",children:[r.jsx("div",{className:"text-center px-1 py-1 bg-blue-50 dark:bg-blue-900/30 rounded flex-1 min-w-0",children:r.jsx("div",{className:"font-medium text-blue-700 dark:text-blue-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""})}),r.jsx("div",{className:"text-center px-1 py-1 bg-green-50 dark:bg-green-900/30 rounded flex-1 min-w-0",children:r.jsx("div",{className:"font-medium text-green-700 dark:text-green-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""})}),r.jsx("div",{className:"text-center px-1 py-1 bg-yellow-50 dark:bg-yellow-900/30 rounded flex-1 min-w-0",children:r.jsx("div",{className:"font-medium text-yellow-700 dark:text-yellow-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""})}),r.jsx("div",{className:"text-center px-1 py-1 bg-purple-50 dark:bg-purple-900/30 rounded flex-1 min-w-0",children:r.jsx("div",{className:"font-medium text-purple-700 dark:text-purple-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""})}),r.jsx("div",{className:"text-center px-1 py-1 bg-red-50 dark:bg-red-900/30 rounded flex-1 min-w-0",children:r.jsx("div",{className:"font-medium text-red-700 dark:text-red-300 whitespace-nowrap overflow-hidden text-ellipsis",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""})})]}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-3",children:"*      . (4   4, 5   5)"})]}),r.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[r.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200 mb-3",children:"   "}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex gap-1 justify-between overflow-hidden",children:[r.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-blue-50 dark:bg-blue-900/30 rounded cursor-pointer flex-1 min-w-0",children:[r.jsx("span",{className:"text-blue-700 dark:text-blue-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""}),r.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:C.excludeWeeks.includes(1),onChange:()=>W(1)})]}),r.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-green-50 dark:bg-green-900/30 rounded cursor-pointer flex-1 min-w-0",children:[r.jsx("span",{className:"text-green-700 dark:text-green-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""}),r.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:C.excludeWeeks.includes(2),onChange:()=>W(2)})]}),r.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-yellow-50 dark:bg-yellow-900/30 rounded cursor-pointer flex-1 min-w-0",children:[r.jsx("span",{className:"text-yellow-700 dark:text-yellow-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""}),r.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:C.excludeWeeks.includes(3),onChange:()=>W(3)})]}),r.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-purple-50 dark:bg-purple-900/30 rounded cursor-pointer flex-1 min-w-0",children:[r.jsx("span",{className:"text-purple-700 dark:text-purple-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""}),r.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:C.excludeWeeks.includes(4),onChange:()=>W(4)})]}),r.jsxs("label",{className:"flex flex-col items-center space-y-1 px-1 py-1 bg-red-50 dark:bg-red-900/30 rounded cursor-pointer flex-1 min-w-0",children:[r.jsx("span",{className:"text-red-700 dark:text-red-300 whitespace-nowrap overflow-hidden text-ellipsis font-medium",style:{fontSize:"clamp(8px, 2.5vw, 12px)"},children:""}),r.jsx("input",{type:"checkbox",className:"rounded w-3 h-3",checked:C.excludeWeeks.includes(5),onChange:()=>W(5)})]})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"     .      ."}),C.excludeWeeks.length>0&&r.jsxs("div",{className:"mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[r.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 font-medium",children:["  : ",C.excludeWeeks.map($=>Ql($)).join(", ")]}),r.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:"      ."})]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h4",{className:"text-md font-medium text-gray-800 dark:text-gray-200",children:"   "}),r.jsx("button",{className:"btn-secondary px-2 py-1 whitespace-nowrap",style:{fontSize:"clamp(10px, 2vw, 14px)"},children:"  "})]}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-2 rounded-lg",children:r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"         ."})})]})]})]})]})}),d==="holidays"&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Fp,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"  "}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"      ."}),r.jsxs("div",{className:"card p-6 max-w-md mx-auto",children:[r.jsx("h4",{className:"font-medium mb-3",children:" "}),r.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 text-left space-y-2",children:[r.jsx("li",{children:"   "}),r.jsx("li",{children:"    "}),r.jsx("li",{children:"   "}),r.jsx("li",{children:"  "})]})]})]}),r.jsx("div",{className:"card p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:" "}),r.jsx("p",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:l.length})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:""}),r.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:k.length})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:" "}),r.jsx("p",{className:"text-xl font-bold text-purple-600 dark:text-purple-400",children:t.filter($=>{const J=new Date().toDateString();return new Date($.date).toDateString()===J}).length})]})]})}),r.jsx(PT,{isOpen:f,onClose:()=>m(!1)}),p&&b&&r.jsx(QT,{template:b,onClose:()=>{x(!1),w(null)},onSave:async $=>{await n(b.id,$),x(!1),w(null)}})]})},QT=({template:l,onClose:t,onSave:n})=>{const{recurringTemplates:i}=Ft();console.log("=== EditRecurringModal  ==="),console.log(" template:",l),console.log("template.holidayHandling:",l.holidayHandling);const[c,d]=M.useState({title:l.title,description:l.description||"",priority:l.priority,type:l.type,recurrenceType:l.recurrenceType,weekday:l.weekday||0,monthlyDate:l.monthlyDate||1,monthlyPattern:l.monthlyPattern||"date",monthlyWeek:l.monthlyWeek||"first",monthlyWeekday:l.monthlyWeekday||3,tags:l.tags||[],exceptions:l.exceptions||[],holidayHandling:l.holidayHandling||"show"});console.log(" formData.holidayHandling:",c.holidayHandling);const[h,f]=M.useState(!1);M.useEffect(()=>{console.log("=== EditRecurringModal template   ==="),console.log(" template.holidayHandling:",l.holidayHandling),d({title:l.title,description:l.description||"",priority:l.priority,type:l.type,recurrenceType:l.recurrenceType,weekday:l.weekday||0,monthlyDate:l.monthlyDate||1,monthlyPattern:l.monthlyPattern||"date",monthlyWeek:l.monthlyWeek||"first",monthlyWeekday:l.monthlyWeekday||3,tags:l.tags||[],exceptions:l.exceptions||[],holidayHandling:l.holidayHandling||"show"}),console.log(" formData.holidayHandling:",l.holidayHandling||"before")},[l]);const m=()=>{d(k=>({...k,exceptions:[...k.exceptions,{type:"date",values:[]}]}))},p=k=>{d(R=>({...R,exceptions:R.exceptions.filter((D,E)=>E!==k)}))},x=(k,R,D)=>{d(E=>({...E,exceptions:E.exceptions.map((O,P)=>P===k?{...O,[R]:D}:O)}))},b=(k,R)=>{d(D=>({...D,exceptions:D.exceptions.map((E,O)=>O===k?{...E,values:R}:E)}))},w=k=>{const D=c.exceptions[k].values||[],E={targetTemplateTitle:"",scope:"same_week"};b(k,[...D,E])},C=(k,R)=>{const E=c.exceptions[k].values||[];b(k,E.filter((O,P)=>P!==R))},T=(k,R,D,E)=>{const $=(c.exceptions[k].values||[]).map((J,ae)=>ae===R?{...J,[D]:E}:J);b(k,$)},z=[{value:0,label:""},{value:1,label:""},{value:2,label:""},{value:3,label:""},{value:4,label:""},{value:5,label:""},{value:6,label:""}],W=async k=>{k.preventDefault(),f(!0);try{console.log("=== EditRecurringModal   ==="),console.log("  holidayHandling:",l.holidayHandling),console.log("formData holidayHandling:",c.holidayHandling);const R={title:c.title.trim(),description:c.description.trim()||void 0,priority:c.priority,type:c.type,recurrenceType:c.recurrenceType,tags:c.tags,exceptions:c.exceptions,holidayHandling:c.holidayHandling,updatedAt:new Date};console.log("updateData:",R),console.log("updateData.holidayHandling:",R.holidayHandling),c.recurrenceType==="weekly"?R.weekday=c.weekday:c.recurrenceType==="monthly"&&(c.monthlyPattern==="weekday"?(R.monthlyPattern="weekday",R.monthlyWeek=c.monthlyWeek,R.monthlyWeekday=c.monthlyWeekday):(R.monthlyPattern="date",R.monthlyDate=c.monthlyDate)),await n(R),t()}catch(R){console.error("  :",R),alert("  .")}finally{f(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"  "}),r.jsxs("form",{onSubmit:W,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsx("input",{type:"text",value:c.title,onChange:k=>d({...c,title:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsx("textarea",{value:c.description,onChange:k=>d({...c,description:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",rows:2})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsxs("select",{value:c.priority,onChange:k=>d({...c,priority:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:"low",children:""}),r.jsx("option",{value:"medium",children:""}),r.jsx("option",{value:"high",children:""}),r.jsx("option",{value:"urgent",children:""})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:" "}),r.jsxs("select",{value:c.recurrenceType,onChange:k=>d({...c,recurrenceType:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:"daily",children:""}),r.jsx("option",{value:"weekly",children:""}),r.jsx("option",{value:"monthly",children:""})]})]}),c.recurrenceType==="weekly"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsxs("select",{value:c.weekday,onChange:k=>d({...c,weekday:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:0,children:""}),r.jsx("option",{value:1,children:""}),r.jsx("option",{value:2,children:""}),r.jsx("option",{value:3,children:""}),r.jsx("option",{value:4,children:""}),r.jsx("option",{value:5,children:""}),r.jsx("option",{value:6,children:""})]})]}),c.recurrenceType==="monthly"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:" "}),r.jsxs("select",{value:c.monthlyPattern,onChange:k=>d({...c,monthlyPattern:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:"date",children:"  (:  15)"}),r.jsx("option",{value:"weekday",children:"   (:    )"})]})]}),c.monthlyPattern==="date"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsxs("select",{value:c.monthlyDate,onChange:k=>d({...c,monthlyDate:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[Array.from({length:31},(k,R)=>R+1).map(k=>r.jsxs("option",{value:k,children:[k,""]},k)),r.jsx("option",{value:-1,children:""}),r.jsx("option",{value:-2,children:"  "}),r.jsx("option",{value:-3,children:" "})]})]}),c.monthlyPattern==="weekday"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"  "}),r.jsxs("select",{value:c.monthlyWeek,onChange:k=>d({...c,monthlyWeek:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:"first",children:"  "}),r.jsx("option",{value:"second",children:"  "}),r.jsx("option",{value:"third",children:"  "}),r.jsx("option",{value:"fourth",children:"  "}),r.jsx("option",{value:"last",children:" "})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:""}),r.jsxs("select",{value:c.monthlyWeekday,onChange:k=>d({...c,monthlyWeekday:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[r.jsx("option",{value:0,children:""}),r.jsx("option",{value:1,children:""}),r.jsx("option",{value:2,children:""}),r.jsx("option",{value:3,children:""}),r.jsx("option",{value:4,children:""}),r.jsx("option",{value:5,children:""}),r.jsx("option",{value:6,children:""})]})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:" "}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"holidayHandling",value:"before",checked:c.holidayHandling==="before",onChange:k=>d({...c,holidayHandling:k.target.value}),className:"mr-2 text-blue-600"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"  "})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"holidayHandling",value:"after",checked:c.holidayHandling==="after",onChange:k=>d({...c,holidayHandling:k.target.value}),className:"mr-2 text-blue-600"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"  "})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"radio",name:"holidayHandling",value:"show",checked:c.holidayHandling==="show",onChange:k=>d({...c,holidayHandling:k.target.value}),className:"mr-2 text-blue-600"}),r.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:" "})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.jsx(Go,{className:"w-4 h-4 inline mr-1"}),"  (  )"]}),r.jsxs("button",{type:"button",onClick:m,className:"flex items-center gap-1 px-2 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/30",children:[r.jsx(Bt,{className:"w-3 h-3"})," "]})]}),c.exceptions.map((k,R)=>r.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("select",{value:k.type,onChange:D=>x(R,"type",D.target.value),className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"date",children:"  "}),r.jsx("option",{value:"weekday",children:"  "}),r.jsx("option",{value:"week",children:"  "}),r.jsx("option",{value:"month",children:"  "}),r.jsx("option",{value:"conflict",children:"  "})]}),r.jsx("button",{type:"button",onClick:()=>p(R),className:"ml-2 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-2",children:[k.type==="date"&&Array.from({length:31},(D,E)=>E+1).map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D]:O.filter($=>$!==D);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsxs("span",{className:"text-xs",children:[D,""]})]},D)),k.type==="weekday"&&z.map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D.value),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D.value]:O.filter($=>$!==D.value);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsx("span",{className:"text-xs",children:D.label})]},D.value)),k.type==="week"&&[1,2,3,4,-1].map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D]:O.filter($=>$!==D);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsx("span",{className:"text-xs",children:Ql(D)})]},D)),k.type==="month"&&Array.from({length:12},(D,E)=>E+1).map(D=>r.jsxs("label",{className:"flex items-center space-x-1",children:[r.jsx("input",{type:"checkbox",checked:k.values.includes(D),onChange:E=>{const O=k.values,P=E.target.checked?[...O,D]:O.filter($=>$!==D);b(R,P)},className:"text-blue-600 rounded focus:ring-blue-500"}),r.jsxs("span",{className:"text-xs",children:[D,""]})]},D)),k.type==="conflict"&&r.jsxs("div",{className:"col-span-full space-y-3",children:[(k.values||[]).map((D,E)=>r.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:["   ",E+1]}),r.jsx("button",{type:"button",onClick:()=>C(R,E),className:"text-red-500 hover:text-red-700 p-1",children:r.jsx(ct,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:" "}),r.jsxs("select",{value:D.targetTemplateTitle,onChange:O=>T(R,E,"targetTemplateTitle",O.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"",children:" "}),i.filter(O=>O.id!==l.id).map(O=>r.jsx("option",{value:O.title,children:O.title},O.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-blue-800 dark:text-blue-200 mb-1",children:" "}),r.jsxs("select",{value:D.scope,onChange:O=>T(R,E,"scope",O.target.value),className:"w-full px-2 py-1 text-sm border border-blue-300 dark:border-blue-600 rounded focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 dark:text-white",children:[r.jsx("option",{value:"same_date",children:"  "}),r.jsx("option",{value:"same_week",children:"  "}),r.jsx("option",{value:"same_month",children:"  "})]})]})]}),r.jsxs("div",{className:"mt-2 p-2 bg-blue-100 dark:bg-blue-800/30 rounded text-xs text-blue-700 dark:text-blue-300",children:[r.jsx("strong",{children:":"}),' "',D.targetTemplateTitle||" ",'"() ',D.scope==="same_date"?" ":D.scope==="same_week"?" ":" ","      ."]})]},E)),r.jsx("div",{className:"col-span-full",children:r.jsxs("button",{type:"button",onClick:()=>w(R),className:"w-full py-2 px-3 text-sm border-2 border-dashed border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/30 flex items-center justify-center gap-2",children:[r.jsx(Bt,{className:"w-4 h-4"}),"  "]})})]})]}),r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[k.values.length>0&&k.type!=="conflict"&&r.jsxs("span",{children:[" ",k.type==="date"?"":k.type==="weekday"?"":k.type==="week"?"":"",": ",k.values.join(", ")]}),k.type==="conflict"&&k.values.length>0&&r.jsxs("span",{children:["  : ",k.values.length,""]})]})]},R))]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-600 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500",disabled:h,children:""}),r.jsx("button",{type:"submit",className:"flex-1 btn-primary",disabled:h,children:h?" ...":""})]})]})]})})},XT=({searchTerm:l="",priorityFilter:t="all",typeFilter:n="all",projectFilter:i="all",tagFilter:c=[]})=>{const{todos:d,toggleTodo:h,getRecurringTodos:f}=Ft(),[m,p]=M.useState(new Set(["today"])),[x,b]=M.useState("period"),[w,C]=M.useState("yesterday"),T=f(),z=[...d,...T];console.log("   -  :",z.length),console.log("   -  :",d.length),console.log("   -  :",T.length);const W=z.filter(I=>I.completed&&I.completedAt&&(l===""||I.title.toLowerCase().includes(l.toLowerCase())||I.description&&I.description.toLowerCase().includes(l.toLowerCase()))&&(t==="all"||I.priority===t)&&(n==="all"||I.type===n)&&(i==="all"||i==="longterm"&&I.project==="longterm"||i==="shortterm"&&I.project==="shortterm")&&(c.length===0||I.tags&&c.every(N=>I.tags?.includes(N)))),k=[];z.forEach(I=>{I.subTasks&&I.subTasks.length>0&&I.subTasks.filter(N=>N.completed&&N.completedAt&&N.completedAt!==null).forEach(N=>{const A=l===""||N.title.toLowerCase().includes(l.toLowerCase())||N.description&&N.description.toLowerCase().includes(l.toLowerCase()),_=t==="all"||N.priority===t;A&&_&&k.push({...N,type:"simple",recurrence:"none",isSubTask:!0,parentTitle:I.title,parentDescription:I.description,createdAt:N.createdAt,updatedAt:N.updatedAt})})});const R=[...W,...k].sort((I,N)=>{const A=U=>{if(!U)return 0;try{const Z=new Date(U).getTime();return isNaN(Z)?0:Z}catch{return 0}},_=A(I.completedAt);return A(N.completedAt)-_});console.log("   -  :",R.length),console.log("   -   :",R.filter(I=>I._isRecurringInstance).length);const D=R.find(I=>I.title==="");D?console.log("   -  :",{title:D.title,completed:D.completed,completedAt:D.completedAt,_isRecurringInstance:D._isRecurringInstance}):(console.log("   -    "),console.log("   -   :",R.map(I=>I.title)));const E=()=>{const I=new Date,N=new Date(I.getFullYear(),I.getMonth(),I.getDate()),A=new Date(N);A.setDate(A.getDate()-1);const _=new Date(N);_.setDate(N.getDate()-N.getDay());const H=new Date(_);H.setDate(_.getDate()-7),new Date(_).setDate(_.getDate()-1);const Z=new Date(N.getFullYear(),N.getMonth(),1),le=new Date(N.getFullYear(),N.getMonth()-1,1);new Date(N.getFullYear(),N.getMonth(),0);const ue={today:[],yesterday:[],thisWeek:[],lastWeek:[],thisMonth:[],lastMonth:[],older:[]};return R.forEach(be=>{if(!be.completedAt)return;const Oe=new Date(be.completedAt),Le=new Date(Oe.getFullYear(),Oe.getMonth(),Oe.getDate());Le.getTime()===N.getTime()?ue.today.push(be):Le.getTime()===A.getTime()?ue.yesterday.push(be):Oe>=_&&Le<N?ue.thisWeek.push(be):Oe>=H&&Oe<_?ue.lastWeek.push(be):Oe>=Z&&Oe<H?ue.thisMonth.push(be):Oe>=le&&Oe<Z?ue.lastMonth.push(be):Oe<le&&ue.older.push(be)}),Object.values(ue).forEach(be=>{be.sort((Oe,Le)=>!Oe.completedAt||!Le.completedAt?0:new Date(Le.completedAt).getTime()-new Date(Oe.completedAt).getTime())}),ue},O=()=>{const I={};R.forEach(A=>{if(!A.completedAt)return;const H=new Date(A.completedAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",weekday:"short"});I[H]||(I[H]=[]),I[H].push(A)}),Object.values(I).forEach(A=>{A.sort((_,H)=>!_.completedAt||!H.completedAt?0:new Date(H.completedAt).getTime()-new Date(_.completedAt).getTime())});const N=Object.keys(I).sort((A,_)=>{const H=new Date(I[A][0].completedAt);return new Date(I[_][0].completedAt).getTime()-H.getTime()});return{groupedByDay:I,sortedKeys:N}},P=()=>{const I={};R.forEach(A=>{if(!A.completedAt)return;const _=new Date(A.completedAt),H=new Date(_);H.setDate(_.getDate()-_.getDay()),H.setHours(0,0,0,0);const U=new Date(H);U.setDate(H.getDate()+6);const Z=`${H.toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit"})} ~ ${U.toLocaleDateString("ko-KR",{month:"2-digit",day:"2-digit"})}`;I[Z]||(I[Z]=[]),I[Z].push(A)}),Object.values(I).forEach(A=>{A.sort((_,H)=>!_.completedAt||!H.completedAt?0:new Date(H.completedAt).getTime()-new Date(_.completedAt).getTime())});const N=Object.keys(I).sort((A,_)=>{const H=new Date(I[A][0].completedAt);return new Date(I[_][0].completedAt).getTime()-H.getTime()});return{groupedByWeek:I,sortedKeys:N}},$=()=>{const I={};R.forEach(A=>{if(!A.completedAt)return;const H=new Date(A.completedAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit"});I[H]||(I[H]=[]),I[H].push(A)}),Object.values(I).forEach(A=>{A.sort((_,H)=>!_.completedAt||!H.completedAt?0:new Date(H.completedAt).getTime()-new Date(_.completedAt).getTime())});const N=Object.keys(I).sort((A,_)=>{const H=new Date(I[A][0].completedAt);return new Date(I[_][0].completedAt).getTime()-H.getTime()});return{groupedByMonth:I,sortedKeys:N}},J=I=>{const N=new Set(m);N.has(I)?N.delete(I):N.add(I),p(N)},ae=()=>{C(I=>{switch(I){case"yesterday":return"lastWeek";case"lastWeek":return"lastMonth";case"lastMonth":return"yesterday";default:return"yesterday"}})},me=I=>{const N={low:"text-gray-500 bg-gray-100 dark:bg-gray-800",medium:"text-blue-700 bg-blue-100 dark:bg-blue-900/30",high:"text-orange-700 bg-orange-100 dark:bg-orange-900/30",urgent:"text-red-700 bg-red-100 dark:bg-red-900/30"},A=()=>{h(I.id)};return r.jsx("div",{className:"border-l-2 border-green-500 bg-green-50 dark:bg-green-900/10 p-2 sm:p-3 rounded-r-lg",children:r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[r.jsx(wo,{className:"w-3 h-3 text-green-600 flex-shrink-0"}),r.jsx("h3",{className:"text-xs sm:text-sm font-medium text-green-800 dark:text-green-300 line-through truncate",children:I.isSubTask?` ${I.title} (${I.parentTitle})`:I.title})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-1 mb-1",children:[I.isSubTask?I.parentDescription&&r.jsx("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 py-0.5 rounded text-xs",children:I.parentDescription}):I.description&&r.jsx("span",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 py-0.5 rounded text-xs",children:I.description}),r.jsxs("span",{className:`px-1 py-0.5 rounded text-xs ${N[I.priority]}`,children:[I.priority==="low"&&"",I.priority==="medium"&&"",I.priority==="high"&&"",I.priority==="urgent"&&""]}),I.isSubTask&&r.jsx("span",{className:"bg-indigo-200 dark:bg-indigo-800 text-indigo-700 dark:text-indigo-300 px-1 py-0.5 rounded text-xs",children:""}),I._isRecurringInstance&&r.jsx("span",{className:"bg-purple-200 dark:bg-purple-800 text-purple-700 dark:text-purple-300 px-1 py-0.5 rounded text-xs",children:""}),I.type==="project"&&r.jsx("span",{className:"bg-green-200 dark:bg-green-800 text-green-700 dark:text-green-300 px-1 py-0.5 rounded text-xs",children:I.project==="longterm"?"":""})]}),I.completedAt&&r.jsx("div",{className:"text-xs text-green-600 dark:text-green-400",children:r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(is,{className:"w-3 h-3"}),Ck(I.completedAt)," "]})})]}),r.jsx("div",{className:"flex items-start",children:r.jsx("button",{onClick:A,className:"p-1 hover:bg-green-100 dark:hover:bg-green-800 rounded transition-colors",title:" ",children:r.jsx(Vp,{className:"w-3 h-3 text-green-600 dark:text-green-400"})})})]})},I.id)},ke=(I,N,A,_)=>{if(N.length===0)return null;const H=m.has(A);return r.jsxs("div",{className:"mb-4",children:[r.jsxs("button",{onClick:()=>J(A),className:"w-full flex items-center justify-between p-2 sm:p-3 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r.jsx("div",{className:"w-4 h-4 flex-shrink-0",children:_}),r.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-white flex-1 leading-tight",children:[I," (",N.length,")"]})]}),H?r.jsx(Gp,{className:"w-4 h-4 flex-shrink-0"}):r.jsx(xa,{className:"w-4 h-4 flex-shrink-0"})]}),H&&r.jsx("div",{className:"mt-2 space-y-2",children:N.map(me)})]},A)},ye=E(),fe=O(),Re=P(),Ue=$(),F=R.length,ee=()=>{switch(w){case"yesterday":return{count:ye.yesterday.length,label:"",color:"text-orange-600 dark:text-orange-400"};case"lastWeek":return{count:ye.lastWeek.length,label:"",color:"text-indigo-600 dark:text-indigo-400"};case"lastMonth":return{count:ye.lastMonth.length,label:"",color:"text-pink-600 dark:text-pink-400"};default:return{count:ye.yesterday.length,label:"",color:"text-orange-600 dark:text-orange-400"}}},ce=()=>{if(x==="daily"){const{groupedByDay:I,sortedKeys:N}=fe;return r.jsx("div",{className:"space-y-4",children:N.map(A=>ke(A,I[A],`day-${A}`,r.jsx(lt,{className:"w-5 h-5 text-blue-600"})))})}else if(x==="weekly"){const{groupedByWeek:I,sortedKeys:N}=Re;return r.jsx("div",{className:"space-y-4",children:N.map(A=>ke(A,I[A],`week-${A}`,r.jsx(lt,{className:"w-5 h-5 text-purple-600"})))})}else if(x==="monthly"){const{groupedByMonth:I,sortedKeys:N}=Ue;return r.jsx("div",{className:"space-y-4",children:N.map(A=>ke(A,I[A],`month-${A}`,r.jsx(lt,{className:"w-5 h-5 text-indigo-600"})))})}return r.jsxs("div",{className:"space-y-4",children:[ke("  ",ye.today,"today",r.jsx(wo,{className:"w-5 h-5 text-green-600"})),ke("  ",ye.yesterday,"yesterday",r.jsx(lt,{className:"w-5 h-5 text-blue-600"})),ke("   ",ye.thisWeek,"thisWeek",r.jsx(lt,{className:"w-5 h-5 text-purple-600"})),ke("   ",ye.lastWeek,"lastWeek",r.jsx(lt,{className:"w-5 h-5 text-orange-600"})),ke("   ",ye.thisMonth,"thisMonth",r.jsx(lt,{className:"w-5 h-5 text-indigo-600"})),ke("   ",ye.lastMonth,"lastMonth",r.jsx(lt,{className:"w-5 h-5 text-pink-600"})),ke("   ",ye.older,"older",r.jsx(is,{className:"w-5 h-5 text-gray-600"}))]})};return r.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-1",children:" "}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[" ",F,"  "]})]}),r.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:[{key:"period",label:""},{key:"daily",label:""},{key:"weekly",label:""},{key:"monthly",label:""}].map(({key:I,label:N})=>r.jsx("button",{onClick:()=>b(I),className:`flex-1 px-2 py-1.5 text-xs sm:text-sm font-medium rounded-md transition-colors ${x===I?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:N},I))}),x==="period"&&r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border",children:r.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[r.jsxs("div",{className:"text-center px-2 py-2",children:[r.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600 dark:text-green-400",children:ye.today.length}),r.jsx("div",{className:"text-xs text-green-700 dark:text-green-300 leading-tight",children:""})]}),r.jsxs("div",{className:"text-center px-2 py-2",children:[r.jsx("div",{className:"text-lg sm:text-xl font-bold text-blue-600 dark:text-blue-400",children:ye.today.length+ye.yesterday.length+ye.thisWeek.length}),r.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300 leading-tight",children:" "})]}),r.jsxs("div",{className:"text-center px-2 py-2",children:[r.jsx("div",{className:"text-lg sm:text-xl font-bold text-purple-600 dark:text-purple-400",children:F-ye.lastMonth.length-ye.older.length}),r.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300 leading-tight",children:" "})]}),r.jsxs("button",{onClick:ae,className:"text-center px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors cursor-pointer",title:"      ",children:[r.jsx("div",{className:`text-lg sm:text-xl font-bold ${ee().color}`,children:ee().count}),r.jsx("div",{className:`text-xs leading-tight ${ee().color.replace("text-","text-").replace("600","700").replace("400","300")}`,children:ee().label})]})]})}),x==="daily"&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border text-center",children:[r.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:fe.sortedKeys.length}),r.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:" "})]}),x==="weekly"&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border text-center",children:[r.jsx("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:Re.sortedKeys.length}),r.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300",children:" "})]}),x==="monthly"&&r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border text-center",children:[r.jsx("div",{className:"text-lg font-bold text-indigo-600 dark:text-indigo-400",children:Ue.sortedKeys.length}),r.jsx("div",{className:"text-xs text-indigo-700 dark:text-indigo-300",children:" "})]}),r.jsx("div",{className:"space-y-4",children:ce()}),F===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(wo,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"   "}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"    ."})]})]})},KT=({isOpen:l,onClose:t})=>{const{signIn:n,signUp:i,signInWithGoogle:c,signInAsGuest:d}=vs(),[h,f]=M.useState(!1),[m,p]=M.useState(!1),[x,b]=M.useState(""),[w,C]=M.useState({email:"",password:"",displayName:"",confirmPassword:""}),T=async D=>{D.preventDefault(),b(""),p(!0);try{if(h){if(w.password!==w.confirmPassword)throw new Error("  ");await i(w.email,w.password,w.displayName)}else await n(w.email,w.password);t()}catch(E){b(k(E.code||E.message))}finally{p(!1)}},z=async()=>{b(""),p(!0);try{await c(),t()}catch(D){b(k(D.code||D.message))}finally{p(!1)}},W=async()=>{b(""),p(!0);try{await d(),t()}catch(D){b(k(D.code||D.message))}finally{p(!1)}},k=D=>{switch(D){case"auth/user-not-found":case"auth/wrong-password":return"    ";case"auth/email-already-in-use":return"   ";case"auth/weak-password":return" 6  ";case"auth/invalid-email":return"   ";case"auth/popup-closed-by-user":return"Google  ";case"auth/popup-blocked":return" .     ";case"auth/unauthorized-domain":return"  .  ";case"auth/invalid-api-key":return"Firebase   ";case"auth/network-request-failed":return"    ";case"auth/too-many-requests":return"   .    ";default:return console.error("Firebase Auth Error:",D),` : ${D}.  `}},R=(D,E)=>{C(O=>({...O,[D]:E}))};return l?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:h?"":""}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(ct,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6",children:[x&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:x}),r.jsxs("form",{onSubmit:T,className:"space-y-4",children:[h&&r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Gl,{className:"w-4 h-4 inline mr-1"}),""]}),r.jsx("input",{type:"text",value:w.displayName,onChange:D=>R("displayName",D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:" "})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Sw,{className:"w-4 h-4 inline mr-1"}),""]}),r.jsx("input",{type:"email",value:w.email,onChange:D=>R("email",D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:" ",required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Lm,{className:"w-4 h-4 inline mr-1"}),""]}),r.jsx("input",{type:"password",value:w.password,onChange:D=>R("password",D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:" ",required:!0})]}),h&&r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Lm,{className:"w-4 h-4 inline mr-1"})," "]}),r.jsx("input",{type:"password",value:w.confirmPassword,onChange:D=>R("confirmPassword",D.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"  ",required:!0})]}),r.jsx("button",{type:"submit",disabled:m,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:m?" ...":h?"":""})]}),r.jsxs("div",{className:"mt-6",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})}),r.jsx("div",{className:"relative flex justify-center text-sm",children:r.jsx("span",{className:"px-2 bg-white dark:bg-gray-800 text-gray-500",children:""})})]}),r.jsxs("div",{className:"mt-6 space-y-3",children:[r.jsxs("button",{onClick:z,disabled:m,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 disabled:opacity-50",children:[r.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[r.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),r.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),r.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),r.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google "]}),r.jsxs("button",{onClick:W,disabled:m,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 disabled:opacity-50",children:[r.jsx(Dw,{className:"w-5 h-5"})," "]})]})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsx("button",{onClick:()=>f(!h),className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",children:h?"  ? ":" ? "})})]})]})}):null},Jx=({onClick:l})=>{const{theme:t}=Ny(),n=()=>{l()},i=t==="dark"?"bg-indigo-500":"bg-indigo-600",c=t==="dark"?"hover:bg-indigo-600":"hover:bg-indigo-700",d=t==="dark"?"focus:ring-indigo-400":"focus:ring-indigo-500";return r.jsx("button",{onClick:n,className:`md:hidden fixed bottom-6 right-6 w-16 h-16 rounded-full text-white shadow-lg flex items-center justify-center ${i} ${c} transition-all duration-300 ease-in-out focus:outline-none focus:ring-4 ${d}`,"aria-label":"Add new todo",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})},ZT=Object.freeze(Object.defineProperty({__proto__:null,default:Jx},Symbol.toStringTag,{value:"Module"})),JT=({employees:l,vacations:t,onEditVacation:n,onDeleteVacation:i})=>{const[c,d]=M.useState(new Date),[h,f]=M.useState(null),[m,p]=M.useState(!1),[x,b]=M.useState(null),[w,C]=M.useState(null),T=M.useRef(null),z=new Date(c.getFullYear(),c.getMonth(),1),W=new Date(c.getFullYear(),c.getMonth()+1,0),k=new Date(z);k.setDate(k.getDate()-z.getDay());const R=new Date(W);R.setDate(R.getDate()+(6-W.getDay()));const D=[],E=new Date(k);for(;E<=R;)D.push(new Date(E)),E.setDate(E.getDate()+1);const O=fe=>{const Ue=new Date(fe.getTime()-fe.getTimezoneOffset()*6e4).toISOString().split("T")[0];return t.filter(F=>F.date===Ue)},P=fe=>l.find(Re=>Re.id===fe),$=()=>{d(new Date(c.getFullYear(),c.getMonth()-1,1))},J=()=>{d(new Date(c.getFullYear(),c.getMonth()+1,1))},ae=fe=>{C(null),b(fe.targetTouches[0].clientX)},me=fe=>{C(fe.targetTouches[0].clientX)},ke=()=>{if(!x||!w)return;const fe=x-w,Re=fe>50,Ue=fe<-50;Re&&J(),Ue&&$()},ye=fe=>{switch(fe){case"":return"bg-blue-100 text-blue-800 border-blue-200";case"":return"bg-green-100 text-green-800 border-green-200";case"":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"":return"bg-purple-100 text-purple-800 border-purple-200";case"":return"bg-red-100 text-red-800 border-red-200";case"":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden w-full max-w-full",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:r.jsx(Po,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:[c.getFullYear()," ",c.getMonth()+1,""]}),r.jsx("button",{onClick:J,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:r.jsx(xa,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})})]}),r.jsx("div",{className:"grid w-full border-b border-gray-200 dark:border-gray-700",style:{gridTemplateColumns:"0.7fr 1fr 1fr 1fr 1fr 1fr 0.7fr",minWidth:"100%",maxWidth:"100%"},children:["","","","","","",""].map((fe,Re)=>r.jsx("div",{className:`p-3 text-sm font-medium text-center ${Re===0||Re===6?"text-gray-400 dark:text-gray-500":"text-gray-500 dark:text-gray-400"}`,children:fe},fe))}),r.jsx("div",{ref:T,className:"grid w-full",style:{gridTemplateColumns:"0.7fr 1fr 1fr 1fr 1fr 1fr 0.7fr",minWidth:"100%",maxWidth:"100%"},onTouchStart:ae,onTouchMove:me,onTouchEnd:ke,children:D.map(fe=>{const Re=O(fe),Ue=fe.getMonth()===c.getMonth(),F=fe.toDateString()===new Date().toDateString(),ee=fe.getDay()===0||fe.getDay()===6;return r.jsxs("div",{className:`min-h-[120px] border-b border-r border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 overflow-hidden ${ee?"p-1":"p-2"} ${Ue?"":"bg-gray-50 dark:bg-gray-900"} ${F?"bg-blue-50 dark:bg-blue-900/20":""} ${ee?"bg-gray-25 dark:bg-gray-850":""}`,style:{minWidth:0,maxWidth:"100%",width:"100%"},onClick:()=>{Re.length>0&&(f(fe),p(!0))},children:[r.jsx("div",{className:`text-sm font-medium mb-1 ${Ue?F?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-600"}`,children:fe.getDate()}),r.jsxs("div",{className:"space-y-1 w-full overflow-hidden",children:[Re.slice(0,ee?3:6).map(ce=>{const I=P(ce.employeeId);return r.jsx("div",{className:`text-xs rounded border cursor-pointer group ${ye(ce.type)} ${ee?"px-1 py-0.5":"px-2 py-1"}`,style:{minWidth:0,maxWidth:"100%",width:"100%",overflow:"hidden"},onClick:N=>{N.stopPropagation(),n(ce)},children:r.jsxs("div",{className:"flex items-center justify-between",style:{minWidth:0,maxWidth:"100%",width:"100%"},children:[r.jsxs("span",{className:"truncate",style:{minWidth:0,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[I?.name," ",ce.type]}),r.jsxs("div",{className:"hidden group-hover:flex items-center space-x-1 flex-shrink-0",children:[r.jsx("button",{onClick:N=>{N.stopPropagation(),n(ce)},className:"p-1 hover:bg-white/50 rounded",children:r.jsx(So,{className:"h-3 w-3"})}),r.jsx("button",{onClick:N=>{N.stopPropagation(),i(ce.id)},className:"p-1 hover:bg-white/50 rounded",children:r.jsx(os,{className:"h-3 w-3"})})]})]})},ce.id)}),Re.length>(ee?3:6)&&r.jsxs("div",{className:`text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 ${ee?"px-1 py-0.5":"px-2 py-1"}`,style:{minWidth:0,maxWidth:"100%",width:"100%",overflow:"hidden"},children:["+",Re.length-(ee?3:6)," "]})]})]},fe.toISOString())})}),m&&h&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>p(!1),children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden w-full max-w-md max-h-[80vh]",onClick:fe=>fe.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[h.getFullYear()," ",h.getMonth()+1," ",h.getDate()," "]}),r.jsx("button",{onClick:()=>p(!1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:r.jsx(ct,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),r.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:r.jsx("div",{className:"space-y-3",children:O(h).map(fe=>{const Re=P(fe.employeeId);return r.jsx("div",{className:`p-3 rounded-lg border cursor-pointer hover:shadow-md transition-shadow ${ye(fe.type)}`,onClick:()=>{p(!1),n(fe)},children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm",children:Re?.name||"   "}),r.jsxs("div",{className:"text-xs opacity-75",children:[Re?.team,"  ",fe.type]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:Ue=>{Ue.stopPropagation(),p(!1),n(fe)},className:"p-1 hover:bg-white/50 rounded",title:"",children:r.jsx(So,{className:"h-4 w-4"})}),r.jsx("button",{onClick:Ue=>{Ue.stopPropagation(),confirm("   ?")&&(i(fe.id),p(!1))},className:"p-1 hover:bg-white/50 rounded text-red-600",title:"",children:r.jsx(os,{className:"h-4 w-4"})})]})]})},fe.id)})})}),r.jsx("div",{className:"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700",children:r.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:""})})]})})]})},eS=({employees:l,vacation:t,onSave:n,onCancel:i})=>{const[c,d]=M.useState({employeeId:"",date:"",type:""}),[h,f]=M.useState({}),m=["","","","","",""];M.useEffect(()=>{if(t)d({employeeId:t.employeeId.toString(),date:t.date,type:t.type});else{const T=new Date,z=new Date(T.getTime()-T.getTimezoneOffset()*6e4);d({employeeId:"",date:z.toISOString().split("T")[0],type:""})}f({})},[t]);const p=(T,z)=>{d(W=>({...W,[T]:z})),h[T]&&f(W=>({...W,[T]:""}))},x=()=>{const T={};return c.employeeId||(T.employeeId=" ."),c.date||(T.date=" ."),c.type||(T.type="  ."),f(T),Object.keys(T).length===0},b=()=>{if(!x())return;const T={employeeId:parseInt(c.employeeId),date:c.date,type:c.type};n(T)},w=T=>{T.key==="Enter"&&T.ctrlKey?b():T.key==="Escape"&&i()},C=l.find(T=>T.id===parseInt(c.employeeId));return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t?" ":" "}),r.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:r.jsx(ct,{className:"h-5 w-5"})})]}),r.jsxs("div",{className:"p-6 space-y-4",onKeyDown:w,children:[r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Gl,{className:"h-4 w-4 mr-2"}),""]}),r.jsxs("select",{value:c.employeeId,onChange:T=>p("employeeId",T.target.value),className:`w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 ${h.employeeId?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,children:[r.jsx("option",{value:"",children:" "}),l.map(T=>r.jsxs("option",{value:T.id,children:[T.name," (",T.team,")"]},T.id))]}),h.employeeId&&r.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.employeeId}),C&&r.jsxs("div",{className:"mt-2 flex items-center space-x-2 p-2 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[r.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-semibold",style:{backgroundColor:C.color},children:C.name.charAt(0)}),r.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[C.name,"  ",C.team,"  ",C.position]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(lt,{className:"h-4 w-4 mr-2"}),""]}),r.jsx("input",{type:"date",value:c.date,onChange:T=>p("date",T.target.value),className:`w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 ${h.date?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`}),h.date&&r.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.date})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[r.jsx(Fu,{className:"h-4 w-4 mr-2"})," "]}),r.jsx("select",{value:c.type,onChange:T=>p("type",T.target.value),className:`w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 ${h.type?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,children:m.map(T=>r.jsx("option",{value:T,children:T},T))}),h.type&&r.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.type})]})]}),r.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:""}),r.jsx("button",{onClick:b,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:t?"":""})]}),r.jsx("div",{className:"px-6 pb-4",children:r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Ctrl + Enter:  | Esc: "})})]})})},tS=()=>{const{currentUser:l}=vs(),[t,n]=M.useState([]),[i,c]=M.useState([]),[d,h]=M.useState(!0),[f,m]=M.useState(!1),[p,x]=M.useState(null),[b,w]=M.useState({selectedEmployees:[],vacationTypes:{:!0,:!0,:!0,:!0,:!0},dateRange:"all",startDate:"",endDate:""}),[C,T]=M.useState(!1);if(!Ln(l?.email))return r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-6xl mb-4",children:""}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"  "}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"      ."})]})});const z=async()=>{h(!0);try{const[ae,me]=await Promise.all([ua.getEmployees(""),ua.getVacations("")]);n(ae),c(me)}catch(ae){console.error("  :",ae)}finally{h(!1)}},W=ae=>ae.filter(me=>{if(b.selectedEmployees.length>0&&!b.selectedEmployees.includes(me.employeeId)||!b.vacationTypes[me.type])return!1;const ke=new Date(me.date),ye=new Date;if(b.dateRange!=="all")switch(b.dateRange){case"thisMonth":if(ke.getMonth()!==ye.getMonth()||ke.getFullYear()!==ye.getFullYear())return!1;break;case"lastMonth":const fe=new Date(ye.getFullYear(),ye.getMonth()-1);if(ke.getMonth()!==fe.getMonth()||ke.getFullYear()!==fe.getFullYear())return!1;break;case"thisYear":if(ke.getFullYear()!==ye.getFullYear())return!1;break;case"custom":if(b.startDate&&ke<new Date(b.startDate)||b.endDate&&ke>new Date(b.endDate))return!1;break}return!0}),k=()=>{w({selectedEmployees:[],vacationTypes:{:!0,:!0,:!0,:!0,:!0},dateRange:"all",startDate:"",endDate:""})},R=ae=>{w(me=>({...me,selectedEmployees:me.selectedEmployees.includes(ae)?me.selectedEmployees.filter(ke=>ke!==ae):[...me.selectedEmployees,ae]}))},D=()=>{w(ae=>({...ae,selectedEmployees:ae.selectedEmployees.length===t.length?[]:t.map(me=>me.id)}))},E=ae=>{w(me=>({...me,vacationTypes:{...me.vacationTypes,[ae]:!me.vacationTypes[ae]}}))},O=()=>{x(null),m(!0)},P=ae=>{x(ae),m(!0)},$=async ae=>{if(confirm("   ?"))try{await ua.deleteVacation("",ae),await z()}catch(me){console.error("  :",me),alert("    .")}},J=async ae=>{try{p?await ua.updateVacation("",p.id,ae):await ua.addVacation("",ae),m(!1),await z()}catch(me){console.error("  :",me),alert("    .")}};return M.useEffect(()=>{z()},[]),d?r.jsxs("div",{className:"flex items-center justify-center h-64",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),r.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"  ..."})]}):r.jsxs("div",{className:"space-y-6 w-full overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100",children:" "}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:()=>T(!C),className:"flex items-center px-2 py-1.5 md:px-3 md:py-2 text-gray-600 dark:text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[r.jsx(Wp,{className:"h-4 w-4"}),r.jsx("span",{className:"hidden md:inline ml-1",children:""})]}),r.jsxs("button",{onClick:O,className:"flex items-center px-2 py-1.5 md:px-4 md:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[r.jsx(Bt,{className:"h-4 w-4"}),r.jsx("span",{className:"hidden md:inline ml-1",children:" "})]})]})]}),C&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>T(!1),children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden w-full max-w-md max-h-[80vh]",onClick:ae=>ae.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:" "}),r.jsx("button",{onClick:()=>T(!1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:r.jsx(ct,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})})]}),r.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:" "}),r.jsx("button",{onClick:D,className:"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:b.selectedEmployees.length===t.length?" ":" "})]}),r.jsx("div",{className:"grid grid-cols-2 gap-1",children:t.map(ae=>r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-1.5 rounded",children:[r.jsx("input",{type:"checkbox",checked:b.selectedEmployees.includes(ae.id),onChange:()=>R(ae.id),className:"w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),r.jsx("div",{className:"w-4 h-4 rounded-full flex items-center justify-center text-white text-xs font-semibold flex-shrink-0",style:{backgroundColor:ae.color},children:ae.name.charAt(0)}),r.jsx("span",{className:"text-xs text-gray-900 dark:text-gray-100 truncate",children:ae.name})]},ae.id))}),r.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block mb-2",children:" "}),r.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(b.vacationTypes).map(([ae,me])=>r.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 px-2 py-1 rounded text-xs border border-gray-200 dark:border-gray-600",children:[r.jsx("input",{type:"checkbox",checked:me,onChange:()=>E(ae),className:"w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),r.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:ae})]},ae))})]})]})}),r.jsxs("div",{className:"flex justify-between p-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{onClick:k,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors",children:""}),r.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:""})]})]})}),r.jsx(JT,{employees:t,vacations:W(i),onEditVacation:P,onDeleteVacation:$}),f&&r.jsx(eS,{employees:t,vacation:p,onSave:J,onCancel:()=>m(!1)})]})};class sS{notifications=[];listeners=[];constructor(){this.loadNotifications(),this.checkScheduledNotifications(),setInterval(()=>{this.checkScheduledNotifications()},6e4)}loadNotifications(){const t=localStorage.getItem("notifications");if(t)try{this.notifications=JSON.parse(t).map(n=>({...n,scheduledTime:new Date(n.scheduledTime),createdAt:new Date(n.createdAt)}))}catch(n){console.error("Failed to load notifications:",n)}}saveNotifications(){localStorage.setItem("notifications",JSON.stringify(this.notifications))}checkScheduledNotifications(){const t=new Date;this.notifications.filter(i=>i.scheduledTime<=t&&!i.isRead).forEach(i=>{this.showBrowserNotification(i),this.listeners.forEach(c=>c(i))})}showBrowserNotification(t){"Notification"in window&&Notification.permission==="granted"&&new Notification(t.title,{body:t.message,icon:"/favicon.ico",badge:"/favicon.ico"})}requestPermission(){return"Notification"in window?Notification.requestPermission():Promise.resolve("denied")}scheduleReminder(t,n){if(!n.enabled||!t.dueDate)return;const i=new Date(t.dueDate);i.setDate(i.getDate()-n.advanceDays);const[c,d]=n.time.split(":").map(Number);if(i.setHours(c,d,0,0),i<=new Date)return;const h={id:`reminder_${t.id}_${Date.now()}`,todoId:t.id,type:"reminder",title:" ",message:`"${t.title}"  ${n.advanceDays} .`,scheduledTime:i,isRead:!1,createdAt:new Date};this.notifications.push(h),this.saveNotifications()}scheduleOverdueNotification(t){if(!t.dueDate||t.completed)return;const n=new Date(t.dueDate);n.setDate(n.getDate()+1),n.setHours(9,0,0,0);const i={id:`overdue_${t.id}_${Date.now()}`,todoId:t.id,type:"overdue",title:" ",message:`"${t.title}"  .`,scheduledTime:n,isRead:!1,createdAt:new Date};this.notifications.push(i),this.saveNotifications()}suggestRecurringTask(t){if(t.recurrence==="none")return;const n={id:`recurring_${t.id}_${Date.now()}`,todoId:t.id,type:"recurring_suggestion",title:"  ",message:`"${t.title}"    ?`,scheduledTime:new Date,isRead:!1,createdAt:new Date};this.notifications.push(n),this.saveNotifications(),this.listeners.forEach(i=>i(n))}markAsRead(t){const n=this.notifications.find(i=>i.id===t);n&&(n.isRead=!0,this.saveNotifications())}dismissNotification(t){this.notifications=this.notifications.filter(n=>n.id!==t),this.saveNotifications()}getUnreadNotifications(){return this.notifications.filter(t=>!t.isRead)}getAllNotifications(){return[...this.notifications].sort((t,n)=>n.createdAt.getTime()-t.createdAt.getTime())}addListener(t){this.listeners.push(t)}removeListener(t){this.listeners=this.listeners.filter(n=>n!==t)}clearNotificationsForTodo(t){this.notifications=this.notifications.filter(n=>n.todoId!==t),this.saveNotifications()}}const Uu=new sS,nS=({onClose:l})=>{const[t,n]=M.useState("default"),[i,c]=M.useState(!1),[d,h]=M.useState({dueReminders:!0,completionCelebration:!0,dailyReminder:!0,reminderTime:"09:00"});M.useEffect(()=>{n(Notification.permission),c(Uu.isSupported());const x=localStorage.getItem("notification-settings");x&&h(JSON.parse(x))},[]);const f=async()=>{const x=await Uu.requestPermission();n(x?"granted":"denied")},m=(x,b)=>{const w={...d,[x]:b};h(w),localStorage.setItem("notification-settings",JSON.stringify(w))},p=async()=>{await Uu.showNotification({title:" ",body:"  ! ",tag:"test"})};return i?r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:" "}),r.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx("span",{className:"text-xl",children:""})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:" "}),t==="default"&&r.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"text-yellow-600 dark:text-yellow-400",children:""}),r.jsx("span",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"  "})]}),r.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300 mb-3",children:"      ."}),r.jsx("button",{onClick:f,className:"w-full px-3 py-2 bg-yellow-600 text-white text-sm rounded-lg hover:bg-yellow-700 transition-colors",children:"  "})]}),t==="granted"&&r.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"text-green-600 dark:text-green-400",children:""}),r.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"  "})]}),r.jsx("button",{onClick:p,className:"w-full px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:"  "})]}),t==="denied"&&r.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:"text-red-600 dark:text-red-400",children:""}),r.jsx("span",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"  "})]}),r.jsx("p",{className:"text-xs text-red-700 dark:text-red-300",children:"     ."})]})]}),t==="granted"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:" "}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:" "}),r.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"  1  "})]}),r.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:d.dueReminders,onChange:x=>m("dueReminders",x.target.checked),className:"sr-only peer"}),r.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:" "}),r.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"   "})]}),r.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:d.completionCelebration,onChange:x=>m("completionCelebration",x.target.checked),className:"sr-only peer"}),r.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:" "}),r.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"     "})]}),r.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:d.dailyReminder,onChange:x=>m("dailyReminder",x.target.checked),className:"sr-only peer"}),r.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),d.dailyReminder&&r.jsx("div",{className:"pl-4 border-l-2 border-gray-200 dark:border-gray-600",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:" "}),r.jsx("input",{type:"time",value:d.reminderTime,onChange:x=>m("reminderTime",x.target.value),className:"px-2 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})})]})]})]}),r.jsx("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700",children:r.jsx("button",{onClick:l,className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:""})})]})}):r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-4xl mb-4",children:""}),r.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"  "}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"     ."}),r.jsx("button",{onClick:l,className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:""})]})})})},aS=()=>{const{currentUser:l,logout:t}=vs(),{exportData:n,importData:i,clearCompleted:c,stats:d,syncing:h,syncWithCloud:f}=Ft(),{theme:m,setTheme:p}=Ny(),{fontSizeLevel:x,setFontSizeLevel:b}=F1(),{customHolidays:w,addCustomHoliday:C,deleteCustomHoliday:T}=Qo(),[z,W]=M.useState(null),[k,R]=M.useState(!1),[D,E]=M.useState(!1),[O,P]=M.useState(""),[$,J]=M.useState(""),[ae,me]=M.useState(!1),ke=async I=>{if(I.preventDefault(),!(!O||!$))try{await C(O,$,ae),P(""),J(""),me(!1)}catch(N){console.error("Failed to add holiday:",N),alert("  .")}},ye=async I=>{if(confirm("  ?"))try{await T(I)}catch(N){console.error("Failed to delete holiday:",N),alert("  .")}},fe=()=>{const I=n(),N=new Blob([I],{type:"application/json"}),A=URL.createObjectURL(N),_=document.createElement("a");_.href=A,_.download=`todos - backup - ${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(A)},Re=I=>{const N=I.target.files?.[0];if(!N)return;const A=new FileReader;A.onload=async _=>{try{const H=_.target?.result;await i(H)?(W(null),R(!0),setTimeout(()=>R(!1),3e3)):W("  .")}catch{W("   .")}},A.readAsText(N),I.target.value=""},Ue=()=>{const I=d?.completed||0;if(I===0){alert("  .");return}confirm(`  ${I}  ? `)&&c()},F=()=>{try{const I=localStorage.getItem("todolist-app-todos");if(I)return`${(new Blob([I]).size/1024).toFixed(2)} KB`}catch(I){console.error("Storage size calculation failed:",I)}return"0 KB"},ee=async()=>{if(confirm("?"))try{await t()}catch(I){console.error("Logout failed:",I)}},ce=async()=>{try{await f()}catch(I){console.error("Sync failed:",I)}};return r.jsxs("div",{className:"space-y-8 max-w-4xl mx-auto pb-10",children:[r.jsxs("div",{className:"animate-fade-in",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2 tracking-tight",children:""}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"    "})]}),r.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.1s"},children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400",children:r.jsx(Gl,{className:"w-5 h-5",strokeWidth:2})}),""]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-100 dark:border-gray-700/50 backdrop-blur-sm",children:[r.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-900 dark:to-blue-800 rounded-full flex items-center justify-center shadow-inner",children:l?.photoURL?r.jsx("img",{src:l.photoURL,alt:"",className:"w-10 h-10 rounded-full object-cover"}):r.jsx("span",{className:"text-xl font-bold text-blue-600 dark:text-blue-300",children:l?.isAnonymous?"G":l?.email?.charAt(0).toUpperCase()||"U"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-base font-bold text-gray-900 dark:text-white truncate",children:l?.isAnonymous?" ":l?.displayName||""}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:l?.isAnonymous?"   ":l?.email})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[!l?.isAnonymous&&r.jsxs("button",{onClick:ce,disabled:h,className:"flex items-center justify-center gap-2.5 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-2xl hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-all active:scale-[0.98] disabled:opacity-50 disabled:active:scale-100 group",children:[h?r.jsx(Hm,{className:"w-5 h-5 text-blue-600 animate-spin"}):r.jsx(Hm,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 group-hover:rotate-180 transition-transform duration-500"}),r.jsx("span",{className:"font-semibold text-blue-700 dark:text-blue-300",children:h?" ...":" "})]}),r.jsxs("button",{onClick:ee,className:"flex items-center justify-center gap-2.5 p-4 bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/30 rounded-2xl hover:bg-red-100 dark:hover:bg-red-900/30 transition-all active:scale-[0.98] group",children:[r.jsx(Ew,{className:"w-5 h-5 text-red-600 dark:text-red-400 group-hover:-translate-x-1 transition-transform"}),r.jsx("span",{className:"font-semibold text-red-700 dark:text-red-300",children:""})]})]})]})]}),r.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.2s"},children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-2xl bg-purple-50 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400",children:r.jsx(Cw,{className:"w-5 h-5",strokeWidth:2})}),""]}),r.jsx("div",{className:"grid grid-cols-3 gap-4",children:[{key:"light",label:"",icon:Aw},{key:"dark",label:"",icon:Rw},{key:"system",label:"",icon:Ow}].map(I=>{const N=I.icon,A=m===I.key;return r.jsxs("button",{onClick:()=>p(I.key),className:`flex flex-col items-center justify-center gap-3 p-5 rounded-2xl border transition-all duration-300 ${A?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 shadow-md scale-[1.02]":"bg-white/50 dark:bg-gray-700/30 border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:border-gray-200"}`,children:[r.jsx(N,{className:`w-6 h-6 ${A?"text-blue-600 dark:text-blue-400":"text-gray-400"}`}),r.jsx("span",{className:`text-sm font-semibold ${A?"text-blue-700 dark:text-blue-300":"text-gray-600 dark:text-gray-400"}`,children:I.label})]},I.key)})})]}),r.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.3s"},children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-2xl bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:r.jsx(Mw,{className:"w-5 h-5",strokeWidth:2})})," "]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between bg-white/50 dark:bg-gray-700/30 p-6 rounded-xl border border-gray-100 dark:border-gray-700/50",children:[r.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:""}),r.jsx("div",{className:"flex gap-3 items-center",children:[1,2,3,4,5].map(I=>r.jsx("button",{onClick:()=>b(I),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${x===I?"bg-blue-600 text-white shadow-lg shadow-blue-500/30 scale-110":"bg-white dark:bg-gray-600 text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-500"}`,"aria-label":`  ${I} `,children:r.jsx("span",{style:{fontSize:`${.7+I*.1}rem`,fontWeight:600},children:"A"})},I))}),r.jsx("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:""})]}),r.jsxs("div",{className:"p-5 border border-gray-200/60 dark:border-gray-700/60 rounded-xl bg-gray-50/50 dark:bg-gray-800/50 backdrop-blur-sm",children:[r.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 mb-2 uppercase tracking-wider",children:"Preview"}),r.jsx("p",{className:"text-base text-gray-800 dark:text-gray-200 leading-relaxed font-medium",children:"   . The quick brown fox jumps over the lazy dog."})]})]})]}),r.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.4s"},children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-2xl bg-red-50 dark:bg-red-900/30 flex items-center justify-center text-red-600 dark:text-red-400",children:r.jsx(lt,{className:"w-5 h-5",strokeWidth:2})})," "]}),r.jsxs("form",{onSubmit:ke,className:"flex flex-col sm:flex-row gap-3 mb-6",children:[r.jsxs("div",{className:"flex-1 flex gap-3",children:[r.jsx("input",{type:"date",value:O,onChange:I=>P(I.target.value),className:"px-4 py-2.5 border border-gray-200 dark:border-gray-700 rounded-xl bg-white/80 dark:bg-gray-800/80 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",required:!0}),r.jsx("input",{type:"text",value:$,onChange:I=>J(I.target.value),placeholder:" ",className:"flex-1 px-4 py-2.5 border border-gray-200 dark:border-gray-700 rounded-xl bg-white/80 dark:bg-gray-800/80 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",required:!0})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center h-full px-3 bg-white/50 dark:bg-gray-700/30 rounded-xl border border-gray-200 dark:border-gray-700",children:[r.jsx("input",{type:"checkbox",id:"recurringHoliday",checked:ae,onChange:I=>me(I.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800"}),r.jsx("label",{htmlFor:"recurringHoliday",className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap cursor-pointer select-none",children:" "})]}),r.jsx("button",{type:"submit",className:"px-4 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 active:scale-95 transition-all shadow-md shadow-blue-500/20 flex items-center justify-center min-w-[3rem]",title:"",children:r.jsx(Bt,{className:"w-5 h-5"})})]})]}),r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1 custom-scrollbar",children:w.length===0?r.jsx("div",{className:"text-center py-8 bg-gray-50/50 dark:bg-gray-800/30 rounded-xl border border-dashed border-gray-200 dark:border-gray-700",children:r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"  ."})}):w.map(I=>r.jsxs("div",{className:"group flex items-center justify-between p-3 bg-white/60 dark:bg-gray-800/40 rounded-xl border border-gray-100 dark:border-gray-700/50 hover:border-blue-200 dark:hover:border-blue-800 transition-all hover:shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-50 dark:bg-red-900/20 flex items-center justify-center text-red-600 dark:text-red-400 font-bold text-sm border border-red-100 dark:border-red-800/30",children:I.date.split("-")[2]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:I.name}),I.isRecurring&&r.jsx("span",{className:"text-[10px] px-2 py-0.5 bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300 rounded-full font-semibold border border-blue-200 dark:border-blue-800/50",children:""})]}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:I.date})]})]}),r.jsx("button",{onClick:()=>ye(I.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100 focus:opacity-100",title:"",children:r.jsx(os,{className:"w-4 h-4"})})]},I.id))})]}),r.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.5s"},children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-2xl bg-green-50 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400",children:r.jsx(Iw,{className:"w-5 h-5",strokeWidth:2})})," "]}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[{label:" ",value:d?.total||0,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20"},{label:"",value:d?.completed||0,color:"text-green-600 dark:text-green-400",bg:"bg-green-50 dark:bg-green-900/20"},{label:"",value:d?.pending||0,color:"text-orange-600 dark:text-orange-400",bg:"bg-orange-50 dark:bg-orange-900/20"},{label:"",value:F(),color:"text-purple-600 dark:text-purple-400",bg:"bg-purple-50 dark:bg-purple-900/20"}].map((I,N)=>r.jsxs("div",{className:`flex flex-col items-center justify-center p-4 rounded-xl ${I.bg} border border-transparent hover:border-current transition-all duration-300`,children:[r.jsx("div",{className:`text-2xl font-bold ${I.color} mb-1`,children:I.value}),r.jsx("div",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:I.label})]},N))})]}),r.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.6s"},children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-2xl bg-orange-50 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400",children:r.jsx(Uw,{className:"w-5 h-5",strokeWidth:2})})," "]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("button",{onClick:fe,className:"flex flex-col items-center justify-center gap-3 p-6 bg-white/50 dark:bg-gray-700/30 border border-gray-200 dark:border-gray-700 rounded-2xl hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-200 dark:hover:border-blue-800 transition-all group",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-50 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform duration-300",children:r.jsx(th,{className:"w-6 h-6"})}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-base font-bold text-gray-900 dark:text-white group-hover:text-blue-700 dark:group-hover:text-blue-300",children:""}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"JSON  "})]})]}),r.jsxs("div",{className:"relative group",children:[r.jsx("input",{type:"file",accept:".json",onChange:Re,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),r.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 p-6 bg-white/50 dark:bg-gray-700/30 border border-gray-200 dark:border-gray-700 rounded-2xl group-hover:bg-green-50 dark:group-hover:bg-green-900/20 group-hover:border-green-200 dark:group-hover:border-green-800 transition-all h-full",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-green-50 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400 group-hover:scale-110 transition-transform duration-300",children:r.jsx(sh,{className:"w-6 h-6"})}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-base font-bold text-gray-900 dark:text-white group-hover:text-green-700 dark:group-hover:text-green-300",children:""}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"JSON  "})]})]})]}),r.jsxs("button",{onClick:Ue,className:"flex flex-col items-center justify-center gap-3 p-6 bg-white/50 dark:bg-gray-700/30 border border-gray-200 dark:border-gray-700 rounded-2xl hover:bg-orange-50 dark:hover:bg-orange-900/20 hover:border-orange-200 dark:hover:border-orange-800 transition-all group",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-50 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400 group-hover:scale-110 transition-transform duration-300",children:r.jsx(os,{className:"w-6 h-6"})}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-base font-bold text-gray-900 dark:text-white group-hover:text-orange-700 dark:group-hover:text-orange-300",children:""}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"  "})]})]})]}),(z||k)&&r.jsxs("div",{className:`mt-6 p-4 rounded-2xl border flex items-center gap-4 animate-fade-in ${z?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-800 dark:text-red-200":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 text-green-800 dark:text-green-200"}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${z?"bg-red-100 dark:bg-red-900/40":"bg-green-100 dark:bg-green-900/40"}`,children:z?r.jsx(ah,{className:"w-5 h-5"}):r.jsx(jo,{className:"w-5 h-5"})}),r.jsx("span",{className:"font-medium",children:z||"  ."})]})]}),r.jsxs("div",{className:"glass-card rounded-3xl p-8 animate-slide-in",style:{animationDelay:"0.7s"},children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-2xl bg-yellow-50 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-600 dark:text-yellow-400",children:r.jsx($m,{className:"w-5 h-5",strokeWidth:2})}),""]}),r.jsxs("button",{onClick:()=>E(!0),className:"w-full flex items-center justify-between p-5 bg-white/50 dark:bg-gray-700/30 border border-gray-200 dark:border-gray-700 rounded-2xl hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-200 dark:hover:border-blue-800 transition-all group",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-50 dark:bg-yellow-900/20 flex items-center justify-center text-yellow-600 dark:text-yellow-400 group-hover:scale-110 transition-transform",children:r.jsx($m,{className:"w-6 h-6"})}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:"text-base font-bold text-gray-900 dark:text-white group-hover:text-blue-700 dark:group-hover:text-blue-300 transition-colors",children:" "}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:" ,    "})]})]}),r.jsx(xa,{className:"w-5 h-5 text-gray-400 group-hover:text-blue-500 group-hover:translate-x-1 transition-all"})]})]}),r.jsxs("div",{className:"text-center py-6 animate-fade-in",style:{animationDelay:"0.8s"},children:[r.jsx("p",{className:"text-sm font-medium text-gray-400 dark:text-gray-500",children:"ToDo List App v1.0.0"}),r.jsx("p",{className:"text-xs text-gray-300 dark:text-gray-600 mt-1",children:"Designed for simplicity & productivity"})]}),D&&r.jsx(nS,{onClose:()=>E(!1)})]})},rS=({currentView:l,isSidebarOpen:t,onToggleSidebar:n,searchInputRef:i,addTodoModalRef:c,isMobile:d=!1})=>{const[h,f]=M.useState(!1),[m,p]=M.useState(!1),[x,b]=M.useState(""),[w,C]=M.useState("all"),[T,z]=M.useState("all"),[W,k]=M.useState("all"),[R,D]=M.useState([]),[E,O]=M.useState("all"),[P,$]=M.useState(null),[J,ae]=M.useState(new Date),{getTomorrowTodos:me,getYesterdayIncompleteTodos:ke,todos:ye}=Ft(),{currentUser:fe,logout:Re,isAnonymous:Ue}=vs(),F=Array.from(new Set(ye.flatMap(Z=>Z.tags||[]))).sort(),ee=()=>{ae(Z=>vk(Z))},ce=()=>{ae(Z=>Ls(Z,1))},I=()=>{ae(new Date)},A=Vh((()=>{switch(l){case"today":return{onSwipeLeft:ce,onSwipeRight:ee};case"week":return{};case"month":return{};default:return{}}})(),{minSwipeDistance:60});M.useEffect(()=>{c&&(c.current={open:()=>f(!0)})},[c]),M.useEffect(()=>{const Z=()=>{f(!0)},le=()=>{i.current?.focus()},ue=()=>{n()},be=Oe=>{const Le=Oe.detail;$(Le)};return window.addEventListener("openAddTodoModal",Z),window.addEventListener("focusSearch",le),window.addEventListener("toggleSidebar",ue),window.addEventListener("switchView",be),()=>{window.removeEventListener("openAddTodoModal",Z),window.removeEventListener("focusSearch",le),window.removeEventListener("toggleSidebar",ue),window.removeEventListener("switchView",be)}},[i,n]);const _=P||l;M.useEffect(()=>{$(null)},[l]);const H=()=>{b(""),C("all"),z("all"),k("all"),D([]),O("all")},U=Z=>{switch(Z){case"today":return" ";case"week":return"  ";case"month":return"  ";case"recurring":return"  ";case"history":return" ";case"analytics":return"  ";case"vacation":return" ";case"settings":return""}};return r.jsxs("div",{className:"min-h-screen transition-colors duration-300",children:[d&&t&&r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 transition-opacity duration-300",onClick:n}),r.jsxs("main",{className:`transition-all duration-300 ease-in-out min-h-screen
          ${t&&!d?"ml-64":"ml-0"}
          ${d?"p-4 pb-24":"p-8"}
        `,...A,children:[r.jsxs("header",{className:"mb-8 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[!t&&r.jsx("button",{onClick:n,className:"p-2 rounded-xl hover:bg-white/50 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-300 transition-colors",children:r.jsx(Lw,{className:"w-6 h-6"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-3xl font-bold text-gradient-blue tracking-tight animate-fade-in-up",children:U(_)}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-1 animate-fade-in-up",style:{animationDelay:"0.1s"},children:ht(new Date,"yyyy M d EEEE",{locale:bs})})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"hidden md:flex items-center gap-2 px-3 py-1.5 glass-panel",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),r.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:fe?"":" "})]}),fe?r.jsxs("div",{className:"flex items-center gap-3 pl-3 border-l border-gray-200 dark:border-gray-700",children:[r.jsxs("div",{className:"text-right hidden sm:block",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:fe.displayName||""}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:fe.email})]}),r.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white shadow-lg shadow-blue-500/30",children:fe.photoURL?r.jsx("img",{src:fe.photoURL,alt:"Profile",className:"w-full h-full rounded-full"}):r.jsx(Gl,{className:"w-5 h-5"})})]}):r.jsx("button",{onClick:()=>p(!0),className:"glass-button text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:""})]})]}),r.jsxs("div",{className:`${d?"w-full":"max-w-7xl"} mx-auto animate-fade-in-up`,style:{animationDelay:"0.2s"},children:[_!=="recurring"&&_!=="history"&&_!=="analytics"&&_!=="vacation"&&_!=="settings"&&r.jsx("div",{className:"mb-8",children:r.jsx(fT,{searchTerm:x,onSearchChange:b,priorityFilter:w,onPriorityFilterChange:C,typeFilter:T,onTypeFilterChange:z,projectFilter:W,onProjectFilterChange:k,tagFilter:R,onTagFilterChange:D,completionDateFilter:E,onCompletionDateFilterChange:O,onClearFilters:H,searchInputRef:i,availableTags:F})}),_==="recurring"?r.jsx(WT,{}):_==="history"?r.jsx(XT,{searchTerm:x,priorityFilter:w,typeFilter:T,projectFilter:W,tagFilter:R}):_==="today"?r.jsxs("div",{className:`${d?"space-y-6":"grid grid-cols-1 lg:grid-cols-12 gap-8"}`,children:[d&&r.jsx("div",{className:"glass-card px-3 py-2 mb-4 overflow-x-auto",children:r.jsxs("div",{className:"flex justify-center items-center gap-4 min-w-[280px]",children:[r.jsx($p,{layout:"compact"}),r.jsx("div",{className:"w-px h-4 bg-gray-300 dark:bg-gray-600"}),r.jsx(zp,{layout:"compact"})]})}),r.jsx("div",{className:`${d?"":"lg:col-span-3"}`,children:r.jsxs("div",{className:`${d?"":"sticky top-8"}`,children:[r.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[r.jsxs("h3",{className:"text-lg font-bold text-orange-600 dark:text-orange-400 flex items-center gap-2",children:[r.jsx(Hw,{className:"w-5 h-5"}),"  "]}),r.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:ke(J).length})]}),r.jsx("div",{className:"space-y-3",children:ke(J).length===0?r.jsx("div",{className:"glass-panel p-6 text-center",children:r.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"   "})}):ke(J).slice(0,8).map(Z=>r.jsxs("div",{className:"glass-panel p-3 border-l-4 border-l-orange-400 hover:translate-x-1 transition-transform cursor-pointer",children:[r.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 truncate",children:Z.title}),r.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[Z.type==="project"&&r.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:Z.project==="longterm"?"":""}),Z.dueTime&&r.jsxs("span",{className:"text-[10px] text-orange-500 dark:text-orange-400 flex items-center gap-1",children:[r.jsx(is,{className:"w-3 h-3"}),Z.dueTime]})]})]},Z.id))})]})}),r.jsxs("div",{className:`${d?"":"lg:col-span-6"}`,children:[r.jsxs("div",{className:"glass-card p-1 mb-6 flex items-center justify-between sticky top-0 z-10 backdrop-blur-xl bg-white/80 dark:bg-gray-800/80 shadow-sm",children:[r.jsx("button",{onClick:ee,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:r.jsx(Po,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:gr(J)?" ":ht(J,"M d (E)",{locale:bs})}),!gr(J)&&r.jsx("button",{onClick:I,className:"text-xs px-2 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors",children:" "})]}),r.jsx("button",{onClick:ce,className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:r.jsx(xa,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"min-h-[400px]",children:r.jsx(Zx,{currentView:_,searchTerm:x,priorityFilter:w,typeFilter:T,projectFilter:W,tagFilter:R,completionDateFilter:E,selectedDate:J})})]}),r.jsx("div",{className:`${d?"":"lg:col-span-3"}`,children:r.jsxs("div",{className:`${d?"":"sticky top-8"}`,children:[r.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[r.jsxs("h3",{className:"text-lg font-bold text-blue-600 dark:text-blue-400 flex items-center gap-2",children:[r.jsx(lt,{className:"w-5 h-5"})," "]}),r.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",children:me(J).length})]}),r.jsx("div",{className:"space-y-3",children:me(J).length===0?r.jsx("div",{className:"glass-panel p-6 text-center",children:r.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"   "})}):me(J).slice(0,8).map(Z=>r.jsxs("div",{className:"glass-panel p-3 border-l-4 border-l-blue-400 hover:translate-x-1 transition-transform cursor-pointer",children:[r.jsx("div",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 truncate",children:Z.title}),r.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[Z.type==="project"&&r.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",children:Z.project==="longterm"?"":""}),Z.dueTime&&r.jsxs("span",{className:"text-[10px] text-blue-500 dark:text-blue-400 flex items-center gap-1",children:[r.jsx(is,{className:"w-3 h-3"}),Z.dueTime]})]})]},Z.id))})]})})]}):_==="week"?r.jsx(qT,{searchTerm:x,priorityFilter:w,typeFilter:T,projectFilter:W,tagFilter:R,completionDateFilter:E,onAddTodo:()=>f(!0),isMobile:d}):_==="month"?r.jsx(GT,{searchTerm:x,priorityFilter:w,typeFilter:T,projectFilter:W,tagFilter:R,completionDateFilter:E,onAddTodo:()=>f(!0),isMobile:d}):_==="analytics"?r.jsxs("div",{className:"max-w-5xl mx-auto space-y-8",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"glass-card p-6",children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[r.jsx("span",{className:"w-1 h-6 bg-blue-500 rounded-full"})," "]}),r.jsx($p,{layout:"full"})]}),r.jsxs("div",{className:"glass-card p-6",children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[r.jsx("span",{className:"w-1 h-6 bg-purple-500 rounded-full"})," "]}),r.jsx(zp,{layout:"full"})]})]}),r.jsxs("div",{className:"glass-card p-6",children:[r.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[r.jsx("span",{className:"w-1 h-6 bg-green-500 rounded-full"})," "]}),r.jsx(mT,{})]})]}):_==="vacation"?r.jsx("div",{className:"max-w-7xl mx-auto",children:r.jsx(tS,{})}):_==="settings"?r.jsx("div",{className:"max-w-3xl mx-auto",children:r.jsx(aS,{})}):null]})]}),r.jsx(gT,{isOpen:h,onClose:()=>f(!1)}),r.jsx(KT,{isOpen:m,onClose:()=>p(!1)}),r.jsx(Jx,{onClick:()=>f(!0)})]})},lS=M.lazy(()=>Wl(()=>import("./Sidebar-BLLMYq2N.js"),__vite__mapDeps([0,1,2,3,4]))),iS=M.lazy(()=>Wl(()=>import("./PWAInstallPrompt-BHoMEHfS.js"),__vite__mapDeps([5,1,2,3,4])));M.lazy(()=>Wl(()=>Promise.resolve().then(()=>ZT),void 0));const oS=M.lazy(()=>Wl(()=>import("./ErrorBoundary-pdSYDw6p.js"),__vite__mapDeps([6,1,2,3,4]))),cS=M.lazy(()=>Wl(()=>import("./OfflineNotification-BjA2SRGk.js"),__vite__mapDeps([7,1,2,3,4]))),eb=()=>r.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50 dark:bg-gray-900",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});function dS({currentView:l,setCurrentView:t,isSidebarOpen:n,setIsSidebarOpen:i,searchInputRef:c,addTodoModalRef:d,isMobile:h,forceMobile:f,setForceMobile:m}){const p=P1("AppInner");return Y1(),M.useEffect(()=>p,[]),r.jsx(M.Suspense,{fallback:r.jsx(eb,{}),children:r.jsxs("div",{className:`h-screen flex bg-gray-50 dark:bg-gray-900 ${h?"relative":""}`,children:[h&&n&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-40",onClick:()=>i(!1)}),r.jsx(lS,{currentView:l,onViewChange:t,isOpen:n,onToggle:()=>i(!n),isMobile:h,forceMobile:f,onToggleForceMobile:m}),r.jsx(rS,{currentView:l,isSidebarOpen:n,onToggleSidebar:()=>i(!n),searchInputRef:c,addTodoModalRef:d,isMobile:h}),r.jsx(cS,{}),r.jsx(iS,{})]})})}function uS(){const[l,t]=M.useState("today"),[n,i]=M.useState(!0),[c,d]=M.useState(!1),[h,f]=M.useState(null),m=M.useRef(null),p=M.useRef(null);M.useEffect(()=>{Z1(),Lp();const W=setInterval(()=>{G1.measureMemoryUsage()},5e3),k=setInterval(()=>{Px.getErrorStats().total>0},1e4),R=setInterval(()=>{const E=Lp().checks.filter(O=>O.status==="fail");E.length>0&&Te.error("Critical security issues detected:",E)},3e4);return()=>{clearInterval(W),clearInterval(k),clearInterval(R)}},[]),M.useEffect(()=>{const W=()=>{const E=window.innerWidth;if(h!==null){d(h),i(!h);return}const O=E<=768,P="ontouchstart"in window||navigator.maxTouchPoints>0,$=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),J=E>768&&E<=1024&&P,ae=window.matchMedia("(max-width: 768px)").matches,me=window.matchMedia("(pointer: coarse)").matches,ke=E<=500&&P&&$||P&&$&&window.devicePixelRatio>=2||navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("Android")||ae&&P||me&&$;let ye=!1;ke||ae||O||J?ye=!0:ye=!1,d(ye),i(!ye)};W();let k;const R=()=>{clearTimeout(k),k=setTimeout(W,100)};window.addEventListener("resize",R),window.addEventListener("orientationchange",()=>{setTimeout(W,200)});const D=setTimeout(W,300);return()=>{window.removeEventListener("resize",R),window.removeEventListener("orientationchange",W),clearTimeout(k),clearTimeout(D)}},[h]);const x=()=>{p.current?.open()},b=()=>{m.current?.focus()},w=()=>{i(!n)},C=()=>{t("today")},T=()=>{t("week")},z=()=>{t("month")};return r.jsx("div",{children:r.jsx(z1,{onOpenAddTodo:x,onFocusSearch:b,onToggleSidebar:w,onSwitchToTodayView:C,onSwitchToWeekView:T,onSwitchToMonthView:z,children:r.jsx(dS,{currentView:l,setCurrentView:t,isSidebarOpen:n,setIsSidebarOpen:i,searchInputRef:m,addTodoModalRef:p,isMobile:c,forceMobile:h,setForceMobile:f})})})}function hS(){return r.jsx(M.Suspense,{fallback:r.jsx(eb,{}),children:r.jsx(oS,{children:r.jsx(j_,{children:r.jsx(f_,{children:r.jsx(V1,{children:r.jsx($1,{children:r.jsx(w_,{children:r.jsx(N_,{children:r.jsx(uS,{})})})})})})})})})}Sk.createRoot(document.getElementById("root")).render(r.jsx(M.StrictMode,{children:r.jsx(hS,{})}));export{mT as D,Ft as a,vs as b,Fh as c,yS as d,Px as e,Te as f,Ln as i,r as j,Ny as u};
